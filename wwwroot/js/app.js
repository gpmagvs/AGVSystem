(function(){var e={46700:function(e,t,a){var i={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":94470,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":94470,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function s(e){var t=n(e);return a(t)}function n(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}s.keys=function(){return Object.keys(i)},s.resolve=n,e.exports=s,s.id=46700},13635:function(e,t,a){"use strict";var i=a(49963),s=a(66252),n=a(3577);const o={class:"d-flex flex-row","element-loading-text":"GPM AGVS","element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(31, 31, 31, 0.9)"};function r(e,t,a,r,l,d){const c=(0,s.up)("Menu"),u=(0,s.up)("el-aside"),m=(0,s.up)("Header"),h=(0,s.up)("el-header"),g=(0,s.up)("router-view"),p=(0,s.up)("el-main"),_=(0,s.up)("el-container"),w=(0,s.up)("b-modal"),f=(0,s.up)("ConnectionState"),y=(0,s.Q2)("loading");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",o,[(0,s.Wm)(_,null,{default:(0,s.w5)((()=>[(0,s.Wm)(u,{class:"border",style:{width:"auto"}},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{isCollapse:l.menu_collapse},null,8,["isCollapse"])])),_:1}),(0,s.Wm)(_,null,{default:(0,s.w5)((()=>[(0,s.Wm)(h,{style:{padding:"0"}},{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(m,{ref:"header",MenuExpanded:l.menu_collapse,"onUpdate:HasSystemAlarm":t[0]||(t[0]=e=>{l.HeaderShowSysAlarm=!0}),"onUpdate:HasEqpAlarm":t[1]||(t[1]=e=>{l.HeaderShowEqpAlarm=!0}),onOnMenuToggleClicked:d.ToggleMenu},null,8,["MenuExpanded","onOnMenuToggleClicked"]),[[i.F8,!l.loading]])])),_:1}),(0,s.Wm)(p,{style:(0,n.j5)([{padding:"0","overflow-y":"hidden"},d.router_view_style])},{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(g,null,{default:(0,s.w5)((({Component:e})=>[((0,s.wg)(),(0,s.j4)(s.Ob,null,[((0,s.wg)(),(0,s.j4)((0,s.LL)(e)))],1024))])),_:1},512),[[i.F8,!l.loading]])])),_:1},8,["style"])])),_:1})])),_:1}),(0,s.Wm)(w,{modelValue:l.ShowOKOnlyModal,"onUpdate:modelValue":t[2]||(t[2]=e=>l.ShowOKOnlyModal=e),title:`${l.okOnlyModalProps.title}`,centered:!0,okOnly:!0,headerBgVariant:l.okOnlyModalProps.title_variant,headerTextVariant:"light"},{default:(0,s.w5)((()=>[(0,s._)("p",null,(0,n.zw)(l.okOnlyModalProps.content),1)])),_:1},8,["modelValue","title","headerBgVariant"]),(0,s.Wm)(f,{IsMenuExpanded:!l.menu_collapse},null,8,["IsMenuExpanded"])])),[[i.F8,!l.isNoPermission],[y,l.loading]])}const l={class:"menu"},d={class:"menu-top border-bottom p-2",style:{cursor:"pointer"}};function c(e,t,a,i,o,r){const c=(0,s.up)("home_icon"),u=(0,s.up)("el-icon"),m=(0,s.up)("el-menu-item"),h=(0,s.up)("Message"),g=(0,s.up)("cargo_icon"),p=(0,s.up)("Van"),_=(0,s.up)("map_icon"),w=(0,s.up)("el-sub-menu"),f=(0,s.up)("DataAnalysis"),y=(0,s.up)("PieChart"),v=(0,s.up)("Management"),b=(0,s.up)("setting"),S=(0,s.up)("User"),k=(0,s.up)("el-menu");return(0,s.wg)(),(0,s.iD)("div",l,[(0,s._)("div",d,[a.isCollapse?((0,s.wg)(),(0,s.iD)("div",{key:1,class:"gpm-text",onClick:t[1]||(t[1]=(...e)=>r.GoToHomePage&&r.GoToHomePage(...e))},"GPM")):((0,s.wg)(),(0,s.iD)("img",{key:0,onClick:t[0]||(t[0]=(...e)=>r.GoToHomePage&&r.GoToHomePage(...e)),src:"/GPM_Logo.png",alt:"",width:"160"}))]),(0,s.Wm)(k,{"default-active":"2",class:"el-menu-vertical-demo",style:{height:"100vh"},"active-text-color":"rgb(13, 110, 253)",collapse:a.isCollapse,"collapse-transition":!1,onOpen:r.handleOpen,onClose:r.handleClose,onSelect:r.handleSelect},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{index:"/"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Home")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(c)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/alarm"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.System Alarm")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(h,{color:"red"})])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/racks_status"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.wip_manager")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/vehicle"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.vehicle manager")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(p,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1}),r.IsAdmin?((0,s.wg)(),(0,s.j4)(w,{key:0,index:"/map"},{title:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(_,{color:o.IconColor},null,8,["color"])])),_:1}),(0,s._)("span",null,(0,n.zw)(e.$t("Menu.map and display")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(m,{index:"/map/map_editor"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.map edit")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(_,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/map/agv_display"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.agv display")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(_,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1})])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(w,{index:"/data"},{title:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f,{color:o.IconColor},null,8,["color"])])),_:1}),(0,s._)("span",null,(0,n.zw)(e.$t("Menu.Querys")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(m,{index:"/data/task_history"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Task History")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/data/alarm_history"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Alarm History")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/data/agv_locus"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Trajectory")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/data/InstrumentMeasureQuery"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Instruments Measure Result")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(f)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/data/Avalibility"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.utilization rate")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y)])),_:1})])),_:1})])),_:1}),r.IsAdmin?((0,s.wg)(),(0,s.j4)(m,{key:1,index:"/hotrun"},{title:(0,s.w5)((()=>[(0,s.Uk)("Hot Run")])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(v,{color:"red"})])),_:1})])),_:1})):(0,s.kq)("",!0),r.IsAdmin?((0,s.wg)(),(0,s.j4)(w,{key:2,index:"/sys_settings"},{title:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{color:o.IconColor},null,8,["color"])])),_:1}),(0,s._)("span",null,(0,n.zw)(e.$t("Menu.system settings")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(m,{index:"/sys_settings/AGV_Battery_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.vehicle battery managnment")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/sys_settings/Equipment_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.equipment management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/sys_settings/RacksManagement"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.racks management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/sys_settings/User_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.user management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(S)])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/sys_settings/Charge_Station_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.charge station management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1})])),_:1})):(0,s.kq)("",!0)])),_:1},8,["collapse","onOpen","onClose","onSelect"])])}a(57658);var u=a(65781),m=a(53259),h=a(24239),g={components:{DataAnalysis:u.RbR,Document:u.BBB,Message:u.v0C,Location:u.YeX,Setting:u.pEs,User:u.n5m,home_icon:u.Ozs,alarm_icon:u.etl,cargo_icon:u._hA,map_icon:u.Yaq,Management:u.O_g,Van:u.mWD,PieChart:u.ucW},props:{isCollapse:{type:Boolean,default:!0}},data(){return{IconColor:"rgb(6, 53, 125)"}},computed:{IsAdmin(){return h.HP.getters.IsLogin}},methods:{handleOpen(){},handleClose(){},handleSelect(e,t){this.PageSwitch(e)},GoToHomePage(){this.PageSwitch("/")},PageSwitch(e,t=""){var a=this.$router.currentRoute.value.path;e!=a&&setTimeout((()=>{this.$router.push(e),m.Z.emit("/router-change",{route_display_name:t,route_name:e})}),100)}}},p=a(83744);const _=(0,p.Z)(g,[["render",c],["__scopeId","data-v-3afda56f"]]);var w=_;const f=e=>((0,s.dD)("data-v-d8f3f4f8"),e=e(),(0,s.Cn)(),e),y={class:"app-header bg-primary text-light border-bottom border-left"},v={class:"d-flex flex-row py-1",style:{"z-index":"5001"}},b={class:"flex-fill text-start"},S={class:"field-name"},k={class:"options d-flex justify-content-between"},C=f((()=>(0,s._)("i",{class:"bi bi-three-dots-vertical pt-2"},null,-1))),A={class:"mx-1"},T={class:"op-mode-switch-container"},V={class:"mx-1"},D=f((()=>(0,s._)("i",{class:"bi bi-translate"},null,-1))),x=f((()=>(0,s._)("i",{class:"bi bi-caret-down-fill"},null,-1))),M={class:"d-flex flex-column"},W=f((()=>(0,s._)("i",{class:"bi bi-person-circle"},null,-1))),I={key:0,class:"bi bi-caret-down-fill"},E={class:"d-flex flex-column"},P={class:"alarm text-dark"},L={class:"flex-fill"},O=f((()=>(0,s._)("span",{class:"type-text"}," 系統警報 ",-1))),N={class:"alarm-text"},R={class:"opt"},G={class:"flex-fill"},H=f((()=>(0,s._)("span",{class:"type-text"}," 設備警報 ",-1))),U={class:"alarm-text"},B={class:"opt"};function q(e,t,a,o,r,l){const d=(0,s.up)("MenuExpandIcon"),c=(0,s.up)("MenuFoldIcon"),u=(0,s.up)("el-icon"),m=(0,s.up)("el-switch"),h=(0,s.up)("b-button"),g=(0,s.up)("el-popover"),p=(0,s.up)("Login");return(0,s.wg)(),(0,s.iD)("div",y,[(0,s._)("div",v,[(0,s._)("i",{onClick:t[0]||(t[0]=(...e)=>l.ToggleMenu&&l.ToggleMenu(...e)),class:"menu-toggle-icon text-light px-2"},[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[a.MenuExpanded?((0,s.wg)(),(0,s.j4)(d,{key:0,class:"menu-icon"})):((0,s.wg)(),(0,s.j4)(c,{key:1,class:"menu-icon"}))])),_:1})]),(0,s._)("div",b,[(0,s._)("div",S,(0,n.zw)(l.fieldName),1)]),(0,s._)("div",k,[C,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.modes,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{class:"op-mode-switch-container",key:e.name},[(0,s._)("span",A,(0,n.zw)(e.name),1),(0,s.Wm)(m,{modelValue:e.actived,"onUpdate:modelValue":t=>e.actived=t,"active-color":"rgb(95, 171, 80)","inactive-color":"red","active-text":e.active_text,"inactive-text":e.inactive_text,"border-color":"grey","inline-prompt":"","before-change":e.beforeChangeHandler,loading:e.loading,size:"large",width:"75px"},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text","before-change","loading"])])))),128)),(0,s._)("div",T,[(0,s._)("span",V,(0,n.zw)(e.$t("App.Header.view_mode")),1),(0,s.Wm)(m,{modelValue:r.isEasyMode,"onUpdate:modelValue":t[1]||(t[1]=e=>r.isEasyMode=e),onChange:l.HandleViewModeChanged,"before-change":l.CheckUserLoginState,"active-color":"rgb(95, 171, 80)","inactive-color":"red","active-text":"簡易模式","inactive-text":"工程模式","border-color":"grey","inline-prompt":"",size:"large",width:"80px"},null,8,["modelValue","onChange","before-change"])]),(0,s._)("div",null,[(0,s.Wm)(g,{placement:"top",title:"",width:"",trigger:"hover",content:"","popper-class":"bg-light"},{reference:(0,s.w5)((()=>[(0,s.Wm)(h,{class:"mx-1",style:{border:"none","background-color":"transparent",color:"white"}},{default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[D])),_:1}),(0,s.Uk)(" "+(0,n.zw)("zh-TW"==e.$i18n.locale?e.$t("App.Header.chinese"):e.$t("App.Header.english"))+" ",1),x])),_:1})])),default:(0,s.w5)((()=>[(0,s._)("div",M,[(0,s.Wm)(h,{onClick:t[2]||(t[2]=e=>l.LangSwitch("zh-TW")),variant:"zh-TW"==e.$i18n.locale?"primary":"light"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("App.Header.chinese")),1)])),_:1},8,["variant"]),(0,s.Wm)(h,{onClick:t[3]||(t[3]=e=>l.LangSwitch("en-US")),variant:"en-US"==e.$i18n.locale?"primary":"light"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("App.Header.english")),1)])),_:1},8,["variant"])])])),_:1})]),(0,s._)("div",{onClick:t[5]||(t[5]=(...e)=>l.LoginClickHandler&&l.LoginClickHandler(...e))},[(0,s.Wm)(g,{placement:"top",title:"",width:"",trigger:"hover",content:"","popper-class":"bg-light"},{reference:(0,s.w5)((()=>[(0,s.Wm)(h,{style:{border:"none","background-color":"transparent",color:"white"}},{default:(0,s.w5)((()=>[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[W])),_:1}),(0,s.Uk)(" "+(0,n.zw)(l.UserName)+" ",1),l.IsLogin?((0,s.wg)(),(0,s.iD)("i",I)):(0,s.kq)("",!0)])),_:1})])),default:(0,s.w5)((()=>[(0,s._)("div",E,[l.IsLogin?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(h,{key:0,onClick:l.LoginClickHandler,variant:"light"},{default:(0,s.w5)((()=>[(0,s.Uk)("登入")])),_:1},8,["onClick"])),l.IsLogin?((0,s.wg)(),(0,s.j4)(h,{key:1,onClick:l.LogoutQickly,variant:"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)("登出")])),_:1},8,["onClick"])):(0,s.kq)("",!0),l.IsLogin?((0,s.wg)(),(0,s.j4)(h,{key:2,class:"my-1 bg-light text-dark",onClick:t[4]||(t[4]=e=>l.LoginClickHandler("switch"))},{default:(0,s.w5)((()=>[(0,s.Uk)("切換使用者")])),_:1})):(0,s.kq)("",!0)])])),_:1})])]),(0,s.Wm)(p,{ref:"login",IsLogin:l.IsLogin},null,8,["IsLogin"])]),(0,s.wy)((0,s._)("div",P,[(0,s._)("div",{class:(0,n.C_)(["alarm-container",r.system_alarms_classes])},[(0,s._)("div",L,[O,(0,s._)("span",N,(0,n.zw)(r.system_alrm_text),1)]),(0,s._)("div",R,[(0,s._)("div",null,[0!=l.current_user_role?((0,s.wg)(),(0,s.j4)(h,{key:0,onClick:l.ResetSysAlarmsHandler,class:"mb-0",size:"sm",variant:"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)("警報復歸")])),_:1},8,["onClick"])):(0,s.kq)("",!0)]),(0,s._)("i",{class:"bi bi-clock-history",onClick:t[6]||(t[6]=(...e)=>l.NavigateToAlarmView&&l.NavigateToAlarmView(...e))})])],2),(0,s._)("div",{class:(0,n.C_)(["alarm-container",r.equipment_alarms_classes])},[(0,s._)("div",G,[H,(0,s._)("span",U,(0,n.zw)(r.eq_alrm_text),1)]),(0,s._)("div",B,[(0,s._)("div",null,[(0,s.kq)("",!0)]),(0,s._)("i",{class:"bi bi-clock-history",onClick:t[7]||(t[7]=(...e)=>l.NavigateToAlarmView&&l.NavigateToAlarmView(...e))})])],2)],512),[[i.F8,r.showAlarm]])])}const F={class:"login-header"},z=["id"],j={class:"login-content"},Z={class:"login-message"};function $(e,t,a,o,r,l){const d=(0,s.up)("el-divider"),c=(0,s.up)("b-form-input"),u=(0,s.up)("el-form-item"),m=(0,s.up)("b-button"),h=(0,s.up)("el-form"),g=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.j4)(g,{modelValue:r.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>r.dialogVisible=e),"show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,modal:!0,draggable:"",width:"400",style:{"z-index":"9900"}},{header:(0,s.w5)((({titleId:e,login_title:t})=>[(0,s._)("div",F,[(0,s._)("h3",{id:e,class:(0,n.C_)(t)},"使用者登入",10,z),(0,s.Wm)(d)])])),default:(0,s.w5)((()=>[(0,s._)("div",j,[(0,s.Wm)(h,{"label-position":"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{label:"Username",required:!0},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{autofocus:"",autocomplete:"new-password",disabled:l.IsLogin,ref:"account",onKeyup:[(0,i.D2)(l.FocusPasswordInput,["enter"]),(0,i.D2)(l.FocusPasswordInput,["down"]),t[0]||(t[0]=(0,i.D2)((e=>r.UserName=""),["esc"]))],modelValue:r.UserName,"onUpdate:modelValue":t[1]||(t[1]=e=>r.UserName=e),state:""!=r.UserName,placeholder:"請輸入帳號",required:""},null,8,["disabled","onKeyup","modelValue","state"])])),_:1}),(0,s.Wm)(u,{label:"Password",required:!0},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{autocomplete:"new-password",type:"password",disabled:l.IsLogin,ref:"pw_input",onKeyup:[(0,i.D2)(l.PasswordEnterClickHandler,["enter"]),(0,i.D2)(l.FocusAccountInput,["up"]),t[2]||(t[2]=(0,i.D2)((e=>r.Password=""),["esc"]))],modelValue:r.Password,"onUpdate:modelValue":t[3]||(t[3]=e=>r.Password=e),state:""!=r.Password,placeholder:"請輸入密碼",required:""},null,8,["disabled","onKeyup","modelValue","state"])])),_:1}),l.IsLogin?((0,s.wg)(),(0,s.j4)(u,{key:0},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{onClick:t[4]||(t[4]=e=>l.LogoutHandle()),loading:r.logouting,class:"w-100",variant:"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)("Logout")])),_:1},8,["loading"])])),_:1})):(0,s.kq)("",!0),l.IsLogin?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:1},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{onClick:t[5]||(t[5]=e=>l.LoginHandle()),loading:r.logining,class:"w-100",variant:"primary"},{default:(0,s.w5)((()=>[(0,s.Uk)("Login")])),_:1},8,["loading"])])),_:1})),(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(m,{onClick:t[6]||(t[6]=e=>r.dialogVisible=!1),class:"w-100"},{default:(0,s.w5)((()=>[(0,s.Uk)("Cancel")])),_:1})])),_:1})])),_:1}),(0,s._)("div",Z,(0,n.zw)(r.message),1)])])),_:1},8,["modelValue"])}var Y=a(90131),Q={components:{},data(){return{dialogVisible:!1,UserName:"",Password:"",focus_input:"account",keyboard_input:"",message:"",logining:!1,logouting:!1,ShowLogoutDialog:!1}},computed:{IsLogin(){return h.HP.getters.IsLogin}},methods:{FocusPasswordInput(){this.$refs["pw_input"].focus()},FocusAccountInput(){this.$refs["account"].focus()},PasswordEnterClickHandler(){this.LoginHandle()},Show(e="/"){this.current_route=e,this.IsLogin?(this.UserName=h.HP.getters.UserName,this.Password="********************"):this.message=this.UserName=this.Password="",this.dialogVisible=!0},async LoginHandle(){return""==this.UserName?(this.message="請輸入 Account",void this.FocusAccountInput()):""==this.Password?(this.message="請輸入 Passowrd",void this.FocusPasswordInput()):(this.logining=!0,void setTimeout((async()=>{const e={Username:this.UserName,Password:this.Password};var t=await h.HP.dispatch("login",e);void 0!=t&&(t.confirm?(this.dialogVisible=!1,this.$swal.fire({title:"登入成功!",icon:"success",timer:2e3})):this.message=t.message),this.logining=!1}),10))},LogoutHandle(){this.logouting=!0,setTimeout((()=>{(0,Y.yK)(),h.HP.commit("setUser",null),m.Z.emit("/logout",void 0),this.$emit("RoleChanged",0),this.UserName=this.Password="",this.$swal.fire({title:"登出成功!",icon:"success",timer:2e3}),setTimeout((()=>{this.$route.meta.isAdminUse&&this.$router.push("/")}),1e3),this.logouting=!1}),100)},OnInputFocus(e){this.focus_input=e,"account"==this.focus_input?this.keyboard_input=this.UserName+"":this.keyboard_input=this.Password+""},onChange(e){this.message="",console.log(e),this.keyboard_input=e,"account"==this.focus_input?this.UserName=e:(this.$refs.pw_input.focus(),this.Password=e,this.$refs.pw_input.focus())}}};const K=(0,p.Z)(Q,[["render",$],["__scopeId","data-v-06630286"]]);var J=K,X=a(9669),ee=a.n(X),te=a(663),ae=ee().create({baseURL:te.Z.backend_host});async function ie(){var e=await ae.get("api/System/WebSite");return e.data}async function se(e=1){var t=await ae.get("api/system/OperationStates");return t.data}async function ne(e=1,t=!1){var a=await ae.post(`api/system/runmode?mode=${e}&forecing_change=${t}`);return a.data}async function oe(e=1){var t=await ae.post(`api/system/hostconn?mode=${e}`);return t.data}async function re(e=1){var t=await ae.post(`api/system/hostoperation?mode=${e}`);return t.data}async function le(e=1){var t=await ae.post(`api/system/TransferMode?mode=${e}`);return t.data}var de=a(61623),ce=a(30381),ue=a.n(ce),me=a(19906),he=a(22201),ge=a(49996),pe={components:{Login:J,MenuExpandIcon:u.M0b,MenuFoldIcon:u.qFw,UserFilled:u.wvC,Switch:me.rs},data(){return{current_route_info:{route_display_name:"派車系統",route_name:"/"},maintain_mode:!0,modes:{system_operation_mode:{name:"操作模式",actived:!1,active_text:"運轉",inactive_text:"維護",loading:!1,beforeChangeHandler:()=>this.SysOptModeChangeRequest()},transfer_mode:{name:"派工模式",enabled:!1,active_text:"自動",inactive_text:"手動",loading:!1,beforeChangeHandler:()=>this.TransferModeChangeRequest()},host_conn_mode:{name:"HOST連線",enabled:!1,active_text:"Online",inactive_text:"Offline",loading:!1,beforeChangeHandler:()=>this.HostConnModeChangeRequest()},host_operation_mode:{name:"HOST模式",enabled:!1,active_text:"Remote",inactive_text:"Local",loading:!1,beforeChangeHandler:()=>this.HostOptModeChangeRequest()}},system_alarms_classes:["no-alarm"],equipment_alarms_classes:["no-alarm"],system_alrm_text:"",eq_alrm_text:"",showAlarm:!0,isEasyMode:!1,systemAlarmInterval:void 0}},props:{MenuExpanded:{type:Boolean,default:!1}},computed:{IsLogin(){return h.HP.getters.IsLogin},current_user_role(){return h.HP.getters.level},UserName(){var e=h.HP.getters.level,t=h.HP.getters.UserName.toUpperCase();return-1==e?"訪客":0==e?`${t}(OP)`:1==e?`${t}(ENG)`:2==e?`${t}(DEV)`:3==e?`${t}(GOD)`:"VISITOR"},unchecked_alarms(){return h.qz.getters.alarms},SystemAlarms(){return this.unchecked_alarms?this.unchecked_alarms.filter((e=>0==e.Source)):[]},EquipmentAlarms(){return this.unchecked_alarms?this.unchecked_alarms.filter((e=>1==e.Source)):[]},HasSystemAlarm(){return""!=this.system_alrm_text},HasEqpAlarm(){return""!=this.eq_alrm_text},fieldName(){return this.$store.getters.FieldName}},watch:{HasSystemAlarm(e){this.$emit("update:HasSystemAlarm",e),h.g4.commit("IsSystemAlarmShowing",e)},HasEqpAlarm(e){this.$emit("update:HasEqpAlarm",e),h.g4.commit("IsEqpAlarmShowing",e)}},mounted(){this.DownloadSystemOperationsSettings(),m.Z.on("/router-change",(e=>{this.current_route_info=e})),m.Z.on("/show-login-view-invoke",(()=>{this.LoginClickHandler()}));const e=(0,he.yj)();(0,s.YP)((()=>e.path),((e,t)=>{})),this.AlarmDisplayHandler()},methods:{HandleAutoDispatchBtnClick(){h.HP.getters.IsLogin?m.Z.emit("bus-show-task-allocation",{agv_name:"",agv_type:"",action:"",station_data:void 0}):this.$swal.fire({text:"",title:"權限不足 請先登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async DownloadSystemOperationsSettings(e=1e3){setTimeout((async()=>{var e=await se();h.cy.commit("setOperations",e),this.modes.system_operation_mode.actived=1==e.system_run_mode,this.modes.host_conn_mode.actived=1==e.host_online_mode,this.modes.host_operation_mode.actived=1==e.host_remote_mode,this.modes.transfer_mode.actived=1==e.transfer_mode}),e)},ToggleMenu(){this.$emit("onMenuToggleClicked","")},LogoClickHandler(){this.$router.push("/"),this.current_route_info={route_display_name:"Home",route_name:"/"}},LoginClickHandler(e=""){this.$refs["login"].Show(this.current_route_info.route_name)},LogoutQickly(){this.$swal.fire({title:"Logout!",text:"確定要登出?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes"}).then((e=>{e.isConfirmed&&(h.HP.commit("setUser",null),this.$route.meta.isAdminUse&&this.$router.push("/"),this.$swal.fire({title:"登出成功!",icon:"success",timer:3e3}))}))},async TransferModeChangeRequest(){if(0!=this.modes.system_operation_mode.actived){if(!this.CheckUserLoginState())return!1;var e=await le(this.modes.transfer_mode.actived?0:1),t=e.confirm,a="搬運模式切換";return t?(this.ModeRequestSuccessHandler(a),h.cy.commit("setTransferRemote",!this.modes.transfer_mode.actived)):this.ModeRequestFailHandler("搬運模式","搬運模式切換"),t}},HandleViewModeChanged(e){m.Z.emit("view_mode_changed",e)},async SysOptModeChangeRequest(e=!1){if(!this.CheckUserLoginState())return!1;this.modes.system_operation_mode.loading=!0;var t=this.modes.system_operation_mode.actived?"操作模式-MAINTAIN":"操作模式-RUN",a=await ne(this.modes.system_operation_mode.actived?0:1,e),i=a.confirm,s=a.message;if(i)h.cy.commit("setRunMode",!this.modes.system_operation_mode.actived),this.ModeRequestSuccessHandler(t);else{var n=2==h.HP.getters.level||3==h.HP.getters.level;this.ModeRequestFailHandler("操作模式",s,"尚有任務在執行中"==s&&n?"強制切換":"",(async()=>{setTimeout((()=>{this.SysOptModeChangeRequest(!0),this.DownloadSystemOperationsSettings(100)}),500)}))}return this.modes.system_operation_mode.loading=!1,this.modes.system_operation_mode.actived&&(this.modes.transfer_mode.actived=!1),i},async HostConnModeChangeRequest(){if(!this.CheckUserLoginState())return!1;this.modes.host_conn_mode.loading=!0;var e=this.modes.host_conn_mode.actived?"HOST-OFFLINE":"HOST-ONLINE",t=await oe(this.modes.host_conn_mode.actived?0:1),a=t.confirm,i=t.message;return a?(this.ModeRequestSuccessHandler(e),h.cy.commit("setHostOnline",!this.modes.host_conn_mode.actived)):this.ModeRequestFailHandler(`HOST ${e}`,i),this.modes.host_conn_mode.loading=!1,a},async HostOptModeChangeRequest(){if(!this.CheckUserLoginState())return!1;this.modes.host_operation_mode.loading=!0;var e=this.modes.host_operation_mode.actived?"HOST-LOCAL":"HOST-REMOTE",t=await re(this.modes.host_operation_mode.actived?0:1),a=t.confirm,i=t.message;return a?(this.ModeRequestSuccessHandler(e),h.cy.commit("setHostRemote",!this.modes.host_operation_mode.actived)):this.ModeRequestFailHandler(`HOST ${e}`,i),this.modes.host_operation_mode.loading=!1,a},CheckUserLoginState(){return this.IsLogin||this.$swal.fire({text:"",title:"權限不足 請先登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),this.IsLogin},ModeRequestFailHandler(e,t,a="",i=(()=>{})){var s=""!=a;this.$swal.fire({title:`${e} 切換失敗`,text:t+"，請稍後再嘗試切換。",icon:"error",showCancelButton:s,cancelButtonText:a,allowOutsideClick:!s}).then((e=>{!e.isConfirmed&&s&&i()}))},ModeRequestSuccessHandler(e){ge.bM.success({message:`${e}-請求成功`,position:"top-right",duration:2e3})},LangSwitch(e){this.$i18n.locale=e},async ResetSysAlarmsHandler(){await(0,de.gU)(),ge.bM.success({message:"系統警報清除完成",position:"top-right",duration:2e3}),this.ResetSystemAlarmTimer(),this.system_alarms_classes=["no-alarm"],this.system_alrm_text=""},async ResetEqpAlarmsHandler(){await(0,de.F6)(),this.$vs.notify({color:"primary",title:"警報復歸請求",text:"設備警報復歸請求完成",position:"bottom-right",time:1400})},CreateAlarmDisplayText(e){return`${ue()(e.Time).format("yyyy/MM/DD HH:mm:ss")} |Code:${e.AlarmCode}|Source:${e.Equipment_Name}|-${e.Description_Zh}(${e.Description_En})`},AlarmDisplayHandler(){var e=0;this.ResetSystemAlarmTimer(),setInterval((()=>{if(!this.EquipmentAlarms||0==this.EquipmentAlarms.length)return this.equipment_alarms_classes=["no-alarm"],void(this.eq_alrm_text="");var t=this.EquipmentAlarms[e];t?(this.equipment_alarms_classes=[1==t.Level?"alarm":"warning"],this.eq_alrm_text=this.CreateAlarmDisplayText(t)):(this.equipment_alarms_classes=[""],this.eq_alrm_text=""),e+=1,e>=this.EquipmentAlarms.length&&(e=0)}),2e3)},ResetSystemAlarmTimer(){clearInterval(this.systemAlarmInterval);var e=0;this.systemAlarmInterval=setInterval((()=>{if(!this.SystemAlarms||0==this.SystemAlarms.length)return this.system_alarms_classes=["no-alarm"],void(this.system_alrm_text="");var t=this.SystemAlarms[e];t?(this.system_alarms_classes=[1==t.Level?"alarm":"warning"],this.system_alrm_text=this.CreateAlarmDisplayText(t)):(this.system_alarms_classes=[""],this.system_alrm_text=""),e+=1,e>=this.SystemAlarms.length&&(e=0)}),2e3)},NavigateToAlarmView(){this.$router.push("/alarm")}}};const _e=(0,p.Z)(pe,[["render",q],["__scopeId","data-v-d8f3f4f8"]]);var we=_e;const fe=e=>((0,s.dD)("data-v-500f3560"),e=e(),(0,s.Cn)(),e),ye={class:"show-mode border"},ve={class:"d-flex flex-row"},be=fe((()=>(0,s._)("i",{class:"bi bi-chevron-double-down"},null,-1))),Se=fe((()=>(0,s._)("div",{class:"alarm-display-container d-flex flex-row w-100"},[(0,s._)("div",{class:"h-50 w-100 border d-flex flex-row"},[(0,s._)("div",{class:"alarm-type"},"設備異常"),(0,s._)("div",null,"a")]),(0,s._)("div",{class:"h-50 w-100 border d-flex flex-row"},[(0,s._)("div",{class:"alarm-type"},"AGV警報"),(0,s._)("div",null,"b")])],-1))),ke={class:"hidden-mode"},Ce=fe((()=>(0,s._)("i",{class:"bi bi-chevron-double-up"},null,-1)));function Ae(e,t,a,o,r,l){const d=(0,s.up)("b-button");return(0,s.wg)(),(0,s.iD)("div",{class:"alarm-display w-100 fixed-bottom",style:(0,n.j5)(r.dynamic_style_setting)},[(0,s.Wm)(i.uT,{name:"el-zoom-in-bottom"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("div",ye,[(0,s._)("div",ve,[(0,s.Wm)(d,{squared:"",variant:"secondary",onClick:t[0]||(t[0]=e=>r.mode="hidden")},{default:(0,s.w5)((()=>[be])),_:1}),Se])],512),[[i.F8,"show"==r.mode]])])),_:1}),(0,s.wy)((0,s._)("div",ke,[(0,s.Wm)(d,{squared:"",variant:"danger",onClick:t[1]||(t[1]=e=>r.mode="show")},{default:(0,s.w5)((()=>[(0,s.Uk)(" Alarms "),Ce])),_:1})],512),[[i.F8,"hidden"==r.mode]])],4)}var Te=a(2262),Ve={setup(){},data(){return{mode:"show",dynamic_style_setting:{zIndex:2e4}}},mounted(){(0,Te.iH)("");const e=(0,he.yj)();(0,s.YP)((()=>e.path),((e,t)=>{this.mode="/"!=e?"hidden":"show"})),m.Z.on("/alarm_footer_send_to_back",(e=>{this.dynamic_style_setting.zIndex=e?2:2e4}))}};const De=(0,p.Z)(Ve,[["render",Ae],["__scopeId","data-v-500f3560"]]);var xe=De;const Me=e=>((0,s.dD)("data-v-4602d2b6"),e=e(),(0,s.Cn)(),e),We={class:"d-flex flex-row"},Ie=Me((()=>(0,s._)("i",{class:"bi bi-three-dots-vertical"},null,-1))),Ee={class:"conn-block px-1 border-end"},Pe=Me((()=>(0,s._)("label",null,"VMS",-1)));function Le(e,t,a,i,o,r){const l=(0,s.up)("el-tag");return(0,s.wg)(),(0,s.iD)("div",{class:"connection-state d-flex flex-row justify-content-between fixed-bottom bg-light border-top text-start",style:(0,n.j5)({marginLeft:r.marginLeft})},[(0,s._)("div",We,[Ie,(0,s._)("div",Ee,[Pe,(0,s.Wm)(l,{effect:"dark",type:r.VMSAlive?"success":"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(r.VMSAlive?"已連線":"斷線"),1)])),_:1},8,["type"])])]),(0,s._)("div",null,"V"+(0,n.zw)(r.APPVersion),1),(0,s._)("div",{onDblclick:t[0]||(t[0]=(...e)=>r.handleTimeDoubleClick&&r.handleTimeDoubleClick(...e)),class:"sys-time"},(0,n.zw)(o.sys_time),33)],4)}var Oe={data(){return{Connections:[{name:"SERVER",connected:!0},{name:"VMS",connected:()=>h.g4.getters.VMSAlive}],sys_time:""}},mounted(){setInterval((()=>{this.sys_time=ue()(Date.now()).format("yyyy-MM-DD HH:mm:ss")}),1e3)},methods:{handleTimeDoubleClick(){h.HP.dispatch("login",{UserName:"dev",Password:"12345678"})}},props:{IsMenuExpanded:{type:Boolean,default:!1}},computed:{marginLeft(e=200){return this.IsMenuExpanded?"233px":"69px"},VMSAlive(){return h.g4.getters.VMSAlive},APPVersion(){return this.$store.getters.APPVersion}}};const Ne=(0,p.Z)(Oe,[["render",Le],["__scopeId","data-v-4602d2b6"]]);var Re=Ne;const Ge=e=>((0,s.dD)("data-v-216847de"),e=e(),(0,s.Cn)(),e),He={key:0,class:"move_agv_notify"},Ue=Ge((()=>(0,s._)("span",{class:"mx-1"},"移車提示",-1)));function Be(e,t,a,i,o,r){const l=(0,s.up)("Warning"),d=(0,s.up)("el-icon"),c=(0,s.up)("el-button"),u=(0,s.up)("el-badge"),m=(0,s.up)("el-table-column"),h=(0,s.up)("el-table"),g=(0,s.up)("el-dialog");return r.IsAnyAGVNeedToMOVE?((0,s.wg)(),(0,s.iD)("div",He,[(0,s.Wm)(u,{value:r.NeedToMoveAGVNum,class:"item"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{onClick:r.HandleBtnClick,style:{"font-size":"large"},plain:"",type:"warning",size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(l)])),_:1}),Ue])),_:1},8,["onClick"])])),_:1},8,["value"]),(0,s._)("div",null,[(0,s.Wm)(g,{draggable:"",width:"400",modal:!1,title:"移車",modelValue:o.DialogVisible,"onUpdate:modelValue":t[0]||(t[0]=e=>o.DialogVisible=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{"row-key":"AgvName",data:r.WattingAGVInfo},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{label:"被阻車輛",prop:"AgvName"}),(0,s.Wm)(m,{label:"當前地點",prop:"AgvName"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(r.GetCurrentLocInfoByTag(e.row.Tag)),1)])),_:1}),(0,s.Wm)(m,{label:"被阻地點",prop:"AgvName"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(e.row.WaitingInfo.WaitingPoint.Name),1)])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])])):(0,s.kq)("",!0)}var qe=a(95320),Fe={components:{Warning:u.v3j},data(){return{DialogVisible:!1}},computed:{IsAnyAGVNeedToMOVE(){return this.NeedToMoveAGVNum>0},WattingAGVInfo(){var e=qe.p.getters.AGVNavInfo.AGVDisplays,t=e.filter((e=>e.WaitingInfo.IsWaiting));return t},NeedToMoveAGVNum(){return this.WattingAGVInfo.length}},methods:{HandleBtnClick(){this.DialogVisible=!0},GetCurrentLocInfoByTag(e){var t=qe.p.getters.MapData.Points,a=Object.values(t).find((t=>t.TagNumber==e));return`${a.TagNumber}:${a.Name}`}}};const ze=(0,p.Z)(Fe,[["render",Be],["__scopeId","data-v-216847de"]]);var je=ze;const Ze={class:"agv-alarm-messages"};function $e(e,t,a,i,n,o){return(0,s.wg)(),(0,s.iD)("div",Ze)}const Ye={key:0,class:"bi bi-thermometer-high"},Qe={key:1,class:"bi bi-battery"},Ke={key:2,class:"bi bi-reception-1"},Je={key:3,class:"bi bi-exclamation-diamond"},Xe={class:"agv-name"},et={class:"text"};function tt(e,t,a,i,o,r){return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["agv-alarm-item my-2 d-flex rounded",a.alarm_type])},[(0,s._)("div",{class:(0,n.C_)(["icon px-2 text-light","alarm"==a.alarm_type?"bg-danger":"bg-warning"])},[a.isBatteryTemperatureHigh?((0,s.wg)(),(0,s.iD)("i",Ye)):a.isBatteryLowLevel?((0,s.wg)(),(0,s.iD)("i",Qe)):a.isDisconnection?((0,s.wg)(),(0,s.iD)("i",Ke)):((0,s.wg)(),(0,s.iD)("i",Je))],2),(0,s._)("div",Xe,(0,n.zw)(a.agv_name)+"|",1),(0,s._)("div",et,(0,n.zw)(a.text),1)],2)}var at={props:{alarm_type:{type:String,default:"warning"},agv_name:{type:String,default:"AGV_001"},text:{type:String,default:""},isBatteryTemperatureHigh:{type:Boolean,default:!1},isBatteryLowLevel:{type:Boolean,default:!1},isDisconnection:{type:Boolean,default:!1}}};const it=(0,p.Z)(at,[["render",tt],["__scopeId","data-v-7922e32c"]]);var st=it,nt={components:{AGVAlarmItem:st}};const ot=(0,p.Z)(nt,[["render",$e],["__scopeId","data-v-25571013"]]);var rt=ot,lt=a(97318),dt={components:{Header:we,Menu:w,AlarmDisplayVue:xe,ConnectionState:Re,MoveAGVNotifty:je,AGVAlarmMessageDisplay:rt},provide(){return{tableHeaderStyle:lt.R}},data(){return{loading:!0,isNoPermission:!1,showMenuToggleIcon:!0,ShowOKOnlyModal:!1,menu_collapse:!0,okOnlyModalProps:{title:"",content:"",title_variant:"primary"},HeaderShowSysAlarm:!0,HeaderShowEqpAlarm:!0}},computed:{router_view_style(){var e="18px";return e=this.HeaderShowEqpAlarm&&this.HeaderShowSysAlarm?"65px":this.HeaderShowEqpAlarm||this.HeaderShowSysAlarm?"30px":"1px",{position:"relative",paddingTop:e}}},methods:{OpenLoading(){this.$vs.loading(),setTimeout((()=>{this.$vs.loading.close()}),200)},ToggleMenu(){this.menu_collapse=!this.menu_collapse},SideMenuCloseHandler(){this.showMenuToggleIcon=!0},RegistNotifies(){const e=new EventSource(te.Z.agvsystem_notify_url);e.addEventListener("Equipment_Maintain",(e=>{var t=e.data;ge.bM.warning({message:`設備 ${t} 維修中!`})}))}},mounted(){this.$store.dispatch("GetDynamicWebsiteData").then((e=>{var t=e.FieldName;document.title=`[${t}]-GPM AGVS`}));let e=(0,Y.VM)();e.isLogin&&h.HP.commit("setUser",e.login_info),m.Z.on("/ShowOKOnlyModal",(e=>{this.okOnlyModalProps=e,this.ShowOKOnlyModal=!0})),m.Z.on("auto_logout_notify_invoke",(()=>{this.$swal.fire({text:"",title:"因閒置太久，已自動登出。",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{window.location.href="/"}))}));const t=(0,he.yj)();(0,s.YP)((()=>t.path),((e,t)=>{if(("/sys_settings"==e||"/map"==e)&&h.HP.getters.level<=0)return this.$vs.loading.close(),this.loading=!1,this.isNoPermission=!0,void this.$swal.fire({text:"",title:"您沒有足夠的權限訪問此頁面!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"full-sweetalert"}).then((()=>{window.location.href="/"}));setTimeout((async()=>{var t=await h.HP.dispatch("user_route_change",e);"/map"==e&&t.isOtherUserEditingMap&&this.$swal.fire({text:"",title:"注意!目前有其他使用者正在地圖編輯頁面",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}),100)})),setTimeout((()=>{this.loading=!1}),1e3),this.RegistNotifies()}};const ct=(e,t)=>{let a=null;return function(){let i=this,s=arguments;clearTimeout(a),a=setTimeout((function(){e.apply(i,s)}),t)}},ut=window.ResizeObserver;window.ResizeObserver=class extends ut{constructor(e){e=ct(e,16),super(e)}};const mt=(0,p.Z)(dt,[["render",r]]);var ht=mt,gt=a(71588),pt=a(88082),_t=(a(54415),a(55612)),wt=a(79150),ft=a(54489),yt=a.n(ft),vt=a(53982),bt=a.n(vt),St=a(56938),kt=a(64491),Ct=a(29776);function At(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=a.length,s=0;s<e;s++)t+=a.charAt(Math.floor(Math.random()*i));return t}var Tt=At(10);h.HP.commit("setUserID",Tt),(0,kt.H5)().then((e=>h.jU.commit("EqOptions",e))),(0,kt.Qu)().then((e=>h.jU.commit("WIPOptions",e)));const Vt=(0,Ct.X)((function(e){"error"!=e.data&&"closed"!=e.data&&(h.jU.commit("setData",e.data.EQStatus),h.sn.commit("setHotRunStates",e.data.HotRun),h.Ys.commit("StoreTaskData",e.data.TaskData),h.qz.commit("StoreAlarmData",e.data.UncheckedAlarm),qe.p.commit("setControledPathesBySystem",e.data.ControledPathesByTraffic),h.g4.commit("SetVMSAlive",e.data.VMSAliveCheck))}),110),Dt=new Worker("/websocket_worker.js");Dt.onmessage=e=>Vt(e),Dt.postMessage({command:"connect",ws_url:te.Z.backend_ws_host+`/ws?user_id=${Tt}`});const xt=(0,Ct.X)((function(e){if("error"!=e.data&&"closed"!=e.data){if(e.data.VMSStatus){var t=Object.values(e.data.VMSStatus).map((e=>Object.assign(new St.Z,e)));h.sn.commit("storeAgvStates",t)}qe.p.commit("setAGVDynamicPathInfo",e.data.AGVNaviPathsInfoVM),qe.p.commit("setOtherAGVLocateInfo",e.data.OtherAGVLocations)}}),33),Mt=new Worker("/websocket_worker.js");Mt.onmessage=e=>xt(e),Mt.postMessage({command:"connect",ws_url:te.Z.vms_ws_host+`/ws?user_id=${Tt}`});var Wt=0;function It(){Wt=0}setTimeout((()=>{ie().then((e=>{setInterval((()=>{Wt+=1,Wt>=e.WebUserLogoutExipreTime&&(h.HP.getters.IsLogin&&(h.HP.dispatch("logout",null),m.Z.emit("auto_logout_notify_invoke","")),It())}),1e3)}))}),5e3),document.addEventListener("touchstart",It),document.addEventListener("touchmove",It),document.addEventListener("touchend",It),document.addEventListener("mousemove",It),document.addEventListener("mousedown",It),document.addEventListener("keydown",It);class Et{constructor(){this.type=0,this.evt="",this.message="",this.show=!0}get typeStr(){switch(this.type){case 0:return"info";case 1:return"warning";case 2:return"error";case 3:return"success";default:return"info"}}}function Pt(e=!0,t=!0){if(e){let e=new WebSocket(te.Z.backend_ws_host+"/api/event");e.onopen=e=>{ge.bM.success({message:"Notification Connect to AGVS"})},e.onmessage=e=>{var t=e.data;let a=new Et;Object.assign(a,JSON.parse(t)),"Map-Point-Enabled-Property-Changed"===a.message&&m.Z.emit("Map-Point-Enabled-Property-Changed"),a.show&&(0,ge.bM)({title:"AGVSystem "+a.evt,type:a.typeStr,message:a.message})},e.onclose=e=>{setTimeout((()=>{ge.bM.error({message:"Notification Disconnect to AGVS"}),Pt(!0,!1)}),1e3)}}if(t){let e=new WebSocket(te.Z.vms_ws_host+"/api/event");e.onopen=e=>{ge.bM.success({message:"Notification Connect to VMS"})},e.onmessage=e=>{var t=e.data;let a=new Et;Object.assign(a,JSON.parse(t)),"Map-Point-Enabled-Property-Changed"===a.message&&m.Z.emit("Map-Point-Enabled-Property-Changed"),a.show&&(0,ge.bM)({title:"VMS "+a.evt,type:a.typeStr,message:a.message})},e.onclose=e=>{setTimeout((()=>{Pt(!1,!0),ge.bM.error({message:"Notification Disconnect to VMS"})}),1e3)}}}Pt();const Lt=(0,wt.o)({legacy:!1,locale:"zh-TW",fallbackLocale:"en-US",messages:{"zh-TW":a(46687),"en-US":a(19594)}}),Ot={confirmButtonColor:"rgb(13, 110, 253)",cancelButtonColor:"#ff7674"},Nt=(0,i.ri)(ht);Nt.use(yt()),Nt.use(h.ZP),Nt.use(gt.Z),Nt.use(_t.ZP),Nt.use(pt.Z),Nt.use(Lt),Nt.use(bt(),Ot),Nt.mount("#app")},97318:function(e,t,a){"use strict";a.d(t,{R:function(){return i}});var i={color:"white",border:"1px solid rgb(222, 226, 230)",backgroundColor:"rgb(13, 110, 253)"}},56938:function(e,t){"use strict";class a{constructor(e){void 0==e?(this.AGV_Name="",this.AGV_Description="",this.Model="",this.Simulation=!1,this.MainStatus=0,this.OnlineStatus=0,this.CurrentLocation="",this.CurrentCarrierID="",this.BatteryLevel_1=0,this.BatteryLevel_2=0,this.TaskName="",this.TaskRunStatus=0,this.TaskRunAction=0,this.Theta=0,this.Connected=!1,this.StationName="",this.Group=0,this.IsCharging=!1,this.Protocol=0,this.IP="127.0.0.1",this.Port=7025,this.TaskSourceStationName="",this.TaskDestineStationName="",this.TransferProcess=0,this.CurrentAction=0,this.TaskRunAction=0,this.TaskETA="",this.IsExecutingOrder=!1,this.VehicleLength=145,this.VehicleWidth=70,this.LowBatLvThreshold=70,this.MiddleBatLvThreshold=70,this.HighBatLvThreshold=70,this.UIOptions={},this.AppVersion="1.0.0"):(this.AGV_Name=e.AGV_Name,this.AGV_Description=e.AGV_Description,this.Model=e.Model,this.MainStatus=e.MainStatus,this.OnlineStatus=e.OnlineStatus,this.CurrentLocation=e.CurrentLocation,this.CurrentCarrierID=e.CurrentCarrierID,this.BatteryLevel_1=e.BatteryLevel_1,this.BatteryLevel_2=e.BatteryLevel_2,this.TaskName=e.TaskName,this.TaskRunStatus=e.TaskRunStatus,this.TaskRunAction=e.TaskRunAction,this.Theta=e.Theta,this.Connected=e.Connected,this.Simulation=e.Simulation,this.StationName=e.StationName,this.Group=e.Group,this.IsCharging=e.IsCharging,this.Protocol=e.Protocol,this.IP=e.IP,this.Port=e.Port,this.TaskSourceStationName=e.TaskSourceStationName,this.TaskDestineStationName=e.TaskDestineStationName,this.TransferProcess=e.TransferProcess,this.CurrentAction=e.CurrentAction,this.TaskRunAction=e.TaskRunAction,this.TaskETA=e.TaskETA,this.IsExecutingOrder=e.IsExecutingOrder,this.VehicleLength=e.VehicleLength,this.VehicleWidth=e.VehicleWidth,this.UIOptions=e.UIOptions,this.LowBatLvThreshold=e.LowBatLvThreshold,this.MiddleBatLvThreshold=e.MiddleBatLvThreshold,this.HighBatLvThreshold=e.HighBatLvThreshold,this.AppVersion=e.AppVersion)}}t.Z=a},72924:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});class i{constructor(e){this.EqType=e,this.IsConnected=!1,this.EQName="",this.MainStatus=0,this.TransferStatus=0,this.Load_Request=!1,this.Unload_Request=!1,this.Port_Exist=!1,this.Up_Pose=!1,this.Down_Pose=!1,this.Eqp_Status_Down=!1,this.Eqp_Status_Run=!1,this.Eqp_Status_Idle=!1,this.Cmd_Reserve_Up=!1,this.Cmd_Reserve_Low=!1,this.To_EQ_Up=!1,this.To_EQ_Low=!1,this.HS_EQ_L_REQ=!1,this.HS_EQ_U_REQ=!1,this.HS_EQ_READY=!1,this.HS_EQ_UP_READY=!1,this.HS_EQ_LOW_READY=!1,this.HS_EQ_BUSY=!1,this.HS_AGV_VALID=!1,this.HS_AGV_TR_REQ=!1,this.HS_AGV_BUSY=!1,this.HS_AGV_READY=!1,this.HS_AGV_COMPT=!1,this.Region="",this.Tag=0,this.Full_CST=!1,this.Empty_CST=!1,this.To_EQ_Full_CST=!1,this.To_EQ_Empty_CST=!1,this.IsMaintaining=!1,this.IsPartsReplacing=!1}}},61623:function(e,t,a){"use strict";a.d(t,{F6:function(){return l},__:function(){return d},gU:function(){return r},lF:function(){return c}});a(62062);var i=a(9669),s=a.n(i),n=a(663),o=(a(60487),s().create({baseURL:n.Z.backend_host}));async function r(){return await o.get("/api/Alarm/SystemAlarmReset")}async function l(){return await o.get("/api/Alarm/EquipmentAlarmReset")}async function d(e,t,a,i="ALL",s="ALL",n="ALL"){var r=await o.get(`/api/Alarmquery/QueryAlarm?currentpage=${e}&StartTime=${t}&EndTime=${a}&AGV_Name=${i}&TaskName=${s}&AlarmType=${n}`);return r.data}async function c(e,t,a="ALL",i="ALL"){const s=await o.get(`/api/Alarmquery/SaveTocsv?StartTime=${e}&EndTime=${t}&AGV_Name=${a}&TaskName=${i}`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([s.data])),r=document.createElement("a");r.href=n;let l=`AGVS_Alarms_From_${e}_To_${t}.csv`;r.setAttribute("download",l),document.body.appendChild(r),r.click()}},90131:function(e,t,a){"use strict";a.d(t,{Kt:function(){return o},VM:function(){return d},g0:function(){return n},yK:function(){return r}});var i=a(30381),s=a.n(i);const n=()=>{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);return{Authorization:`Bearer ${t.token}`}}return{}},o=()=>{const e=u();return e?`Bearer ${e.token}`:""};function r(){localStorage.removeItem("user")}class l{constructor(e,t){this.isLogin=e,this.login_info=t}}function d(){const e=u();return e?new l(0!=e.Role&&0==c(),e):new l(!1,null)}function c(){const e=u();if(e){var t=s()(e.LoginTime).add(1,"day"),a=Date.now()>t;return a}return!0}function u(){const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);return t}}},43125:function(e,t,a){"use strict";a.d(t,{A:function(){return l},y:function(){return r}});var i=a(9669),s=a.n(i),n=a(663),o=s().create({baseURL:n.Z.backend_host});async function r(){console.log(Date.now());var e=await o.get("api/Availabilitys/Today");return console.log(Date.now()),e.data}async function l(e,t,a){var i=await o.get(`api/Availabilitys/Query?AGVName=${e}&StartDate=${t}&EndDate=${a}`);return i.data}},29776:function(e,t,a){"use strict";a.d(t,{O:function(){return o},X:function(){return r}});var i=a(42152),s=a.n(i),n=a(49996);function o(e){const t=new(s())(".copy-button",{text:()=>e});t.on("success",(()=>{(0,n.bM)({title:e,message:"已複製到剪貼簿",duration:1500}),t.destroy()})),t.on("error",(()=>{t.destroy()}))}function r(e,t){let a;return function(){const i=this,s=arguments;a||(e.apply(i,s),a=!0,setTimeout((()=>a=!1),t))}}},19578:function(e,t){"use strict";class a{constructor(){this.AGVName="ALL",this.Result=0,this.StartTimeStr="",this.EndTimeStr="",this.DataNumPerPage=15,this.Page=1}}t.Z=a},64491:function(e,t,a){"use strict";a.d(t,{Aj:function(){return m},CN:function(){return u},H5:function(){return r},PQ:function(){return h},Qu:function(){return l},k3:function(){return g},qN:function(){return c},wW:function(){return d},yS:function(){return p}});var i=a(9669),s=a.n(i),n=a(663),o=s().create({baseURL:n.Z.backend_host});async function r(){var e=await o.get("/api/Equipment/GetEQOptions");return e.data}async function l(){var e=await o.get("/api/Equipment/GetWIPOptions");return e.data}async function d(e){var t=await o.post("/api/Equipment/SaveEQOptions",e);return t.data}async function c(e){var t=await o.post("/api/Equipment/ConnectTest",e);return t.data}async function u(e){var t=await o.get(`/api/Equipment/GetEQInfoByTag?Tag=${e}`);return t.data}async function m(e,t,a){var i=`/api/Equipment/AgvHsSignal?EqName=${encodeURIComponent(e)}&SignalName=${encodeURIComponent(t)}&State=${a}`,s=await o.post(i);return s.data}const h={async SetState(e,t){var a=`/api/Equipment/Emu/State?EqName=${encodeURIComponent(e)}&State=${t}`,i=await o.get(a);return i.data},async SwitchMaintainstate(e,t){var a=`/api/Equipment/Emu/MaintainStatusSimulation?TagNumber=${e}&isMaintain=${t}`,i=await o.get(a);return i.data},async SwitchPartsReplacing(e,t){var a=`/api/Equipment/Emu/PartsReplcingSimulation?TagNumber=${e}&isPartsReplcing=${t}`,i=await o.get(a);return i.data},async EQAllLoad(){var e="/api/Equipment/Emu/AllLoad",t=await o.get(e);return t.data},async EQAllBusy(){var e="/api/Equipment/Emu/AllBusy",t=await o.get(e);return t.data},async SetEQHsSignal(e,t,a){var i=`/api/Equipment/Emu/HsSignal?EqName=${encodeURIComponent(e)}&SignalName=${encodeURIComponent(t)}&State=${a}`,s=await o.get(i);return s.data}},g={async SetSensorState(e,t,a,i,s){var n=`/api/WIPEmu/SetSensorState?rack_id=${e}&port_id=${t}&cargo_type=${a}&sensor_number=${i}&state=${s}`,r=await o.get(n);return r.data}},p={async SetCurveSetting(e,t,a){var i=`/api/Equipment/ChargeStation/Settings?EqName=${encodeURIComponent(e)}&Item=${encodeURIComponent(t)}&Value=${a}`,s=await o.get(i);return s.data},async SaveUsableAGVSetting(e,t){var a=`/api/Equipment/ChargeStation/SaveUsableAGVSetting?ChargeStationName=${encodeURIComponent(e)}`,i=await o.post(a,t);return i.data},async ModifyTagNumber(e,t){var a=`/api/Equipment/ChargeStation/ModifyTagNumber?ChargeStationName=${encodeURIComponent(e)}`,i=await o.post(a,[t]);return i.data}}},83592:function(e,t,a){"use strict";a.d(t,{Ml:function(){return u},j2:function(){return d}});a(67635);var i=a(9669),s=a.n(i),n=a(663),o=a(95320),r=s().create({baseURL:o.p.getters.MapServerUrl}),l=s().create({baseURL:n.Z.vms_host});async function d(){return await r.get("api/Map/RegionOptions").then((e=>{var t=e.data;return o.p.commit("RegionOptions",t),t})).catch((e=>{}))}const c={GetMapFromLocal(){return r.get("api/Map").then((e=>e.data)).catch((e=>{}))},GetGeoMap(){return r.get("api/Map/GeoMapJson").then((e=>e.data)).catch((e=>{}))},GetMapTags(){return r.get("api/Map/Tags").then((e=>e.data)).catch((e=>{}))},ReloadMap(){return r.get("api/Map/ReloadMap").then((e=>(o.p.dispatch("DownloadMapData"),e.data))).catch((e=>{}))},GetAGVList(){return r.get("api/Map/AGVList").then((e=>e.data)).catch((e=>{}))},PathPlanByTag(e,t){return r.get(`api/Map/PathPlan?fromTag=${e}&toTag=${t}`).then((e=>e.data)).catch((e=>{}))},GetMapStationTemplate(){return r.get("api/Map/MapPointTemplate").then((e=>e.data)).catch((e=>{}))},Regist(e){return l.get(`api/Map/Regist?Tag_Number=${e}`).then((e=>e.data)).catch((e=>{}))},Unregist(e){return l.get(`api/Map/Unregist?Tag_Number=${e}`).then((e=>e.data)).catch((e=>{}))}},u=[{label:"Normal",value:0},{label:"EQ",value:1},{label:"STK",value:2},{label:"Charge",value:3},{label:"Buffer",value:4},{label:"Buffer_EQ",value:41},{label:"Charge & Buffer",value:5},{label:"Charge & STK",value:6},{label:"Battery_Exchanger",value:7},{label:"Escape",value:8},{label:"EQ_LD",value:11},{label:"STK_LD",value:12},{label:"EQ_ULD",value:21},{label:"STK_ULD",value:22},{label:"Fire Door",value:31},{label:"Fire EQ",value:32},{label:"Auto Door",value:33},{label:"Elevator",value:100},{label:"Elevator",value:201},{label:"Elevator_LD",value:201},{label:"Elevator_ULD",value:221},{label:"Repair",value:110}];t.ZP=c},3567:function(e,t,a){"use strict";a.d(t,{AE:function(){return l},Fy:function(){return d},IG:function(){return c},Wp:function(){return u},x0:function(){return m}});var i=a(9669),s=a.n(i),n=a(663),o=a(19578),r=s().create({baseURL:n.Z.backend_host});async function l(e=o.Z){var t=await r.post("/api/InstrumentMeasure",e);return t.data}async function d(){var e=await r.get("/api/InstrumentMeasure/GetMeasureSchedules");return e.data}async function c(e,t){var a=await r.delete(`/api/InstrumentMeasure/DeleteSchedule?time=${e}&agv_name=${t}`);return a.data}async function u(e){var t=await r.post("/api/InstrumentMeasure/AddNewMeasureSchedule",e);return t.data}async function m(e,t,a){var i=await r.post(`/api/InstrumentMeasure/ModifyMeasureSchedule?time=${e}&agv_name=${t}`,a);return i.data}},93867:function(e,t,a){"use strict";var i=a(96425);a(45418),a(79517);let s={Success(e,t="bottom",a=3e3){(0,i.NU)({message:e,position:t,type:"success",duration:a,background:"rgba(7, 193, 96, 0.9)",onclick:()=>{(0,i.rz)()}})},Primary(e,t="top",a=3e3){(0,i.NU)({message:e,position:t,type:"primary",duration:a,onclick:()=>{(0,i.rz)()}})},Danger(e,t="top",a=3e3){(0,i.NU)({message:e,position:t,type:"danger",duration:a,onclick:()=>{(0,i.rz)()}})},Warning(e,t="top",a=3e3){(0,i.NU)({message:e,position:t,type:"warning",duration:a,onclick:()=>{(0,i.rz)()}})}};t.Z=s},20840:function(e,t,a){"use strict";a.d(t,{MM:function(){return r},c6:function(){return c},lF:function(){return l},tQ:function(){return d}});a(62062);var i=a(9669),s=a.n(i),n=a(663),o=s().create({baseURL:n.Z.backend_host});async function r(e,t,a,i="ALL",s="ALL",n="ALL",r="ALL"){var l=await o.get(`/api/TaskQuery/TaskQuery?currentpage=${e}&StartTime=${t}&EndTime=${a}&AGV_Name=${i}&TaskName=${s}&Result=${n}&ActionType=${r}`);return console.info(l.data),l.data}async function l(e,t,a="ALL",i="ALL"){const s=await o.get(`/api/TaskQuery/SaveTocsv?StartTime=${e}&EndTime=${t}&AGV_Name=${a}&TaskName=${i}`),n=window.URL.createObjectURL(new Blob([s.data])),r=document.createElement("a");r.href=n;let l=`AGVS_Task_From_${e}_To_${t}.csv`;r.setAttribute("download",l),document.body.appendChild(r),r.click()}async function d(e,t,a){var i=await o.get(`/api/TaskQuery/GetTasks?agv_name=${a}&start=${e}&end=${t}`);return i.data}async function c(e){var t=await o.get(`/api/TaskQuery/GetTrajectory?taskID=${e}`);return t.data}},8764:function(e,t,a){"use strict";a.d(t,{A5:function(){return v},AZ:function(){return k},FV:function(){return m},J8:function(){return y},Nn:function(){return w},On:function(){return g},Qk:function(){return S},Y4:function(){return h},Z$:function(){return _},ec:function(){return u},fn:function(){return p},gh:function(){return b},mc:function(){return f}});var i=a(9669),s=a.n(i),n=a(663),o=a(30381),r=a.n(o),l=a(90131),d=a(24239),c=s().create({baseURL:n.Z.backend_host,headers:{}});class u{constructor(e,t,a=50,i=!1){this.TaskName=`Move_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=0,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class m{constructor(e,t,a=50,i=!1){this.TaskName=`Measure_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=6,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class h{constructor(e,t,a,i,s=50,n=!1){this.TaskName=`Load_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=7,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot=a+"",this.Carrier_ID=i,this.Priority=s,this.bypass_eq_status_check=n,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class g{constructor(e,t,a,i,s=50,n=!1){this.TaskName=`Unload_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=1,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot=a+"",this.Carrier_ID=i,this.Priority=s,this.bypass_eq_status_check=n,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class p{constructor(e,t,a=50,i=!1){this.TaskName=`Charge_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=8,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class _{constructor(e,t,a=50,i=!1){this.TaskName=`BatEx_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=14,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class w{constructor(e,t,a=50,i=!1){this.TaskName=`Park_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=12,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class f{constructor(e,t,a,i,s,n,o=50,l=!1,d=!1,c=-1,u=""){this.TaskName=`Local_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=9,this.DesignatedAGVName=e,this.From_Station=t+"",this.From_Slot=a+"",this.To_Station=i+"",this.To_Slot=s+"",this.Carrier_ID=n,this.Priority=o,this.bypass_eq_status_check=l,this.need_change_agv=d,this.ChangeAGVMiddleStationTag=c,this.TransferToDestineAGVName=u}}var y={async Task(){c.get("/api/Task/Allocation",{headers:(0,l.g0)()}).then((e=>{console.log("Response:",e.data)})).catch((e=>{console.error("Error:",e)}))},async Cancel(e){try{var t=await c.get(`/api/Task/Cancel?task_name=${e}`,{headers:(0,l.g0)()});return t.data}catch(a){throw a}},async MoveTask(e=new e("agv",1)){return await C("/api/Task/Move",e)},async MeasureTask(e=new e("agv",1)){return await C("/api/Task/Measure",e)},async LoadTask(e=new e("agv",1,1,"CST_ID")){return await C("/api/Task/Load",e)},async UnloadTask(e=new e("agv",1,1,"CST_ID")){return await C("/api/Task/Unload",e)},async CarryTask(e){return await C("/api/Task/Carry",e)},async ChargeTask(e){return await C("/api/Task/Charge",e)},async CancelChargeTask(e){var t=await c.get(`/api/Task/CancelChargeTask?agv_name=${e}`);return t.data},async ExangeBatteryTask(e){return await C("/api/Task/ExangeBattery",e)},async ParkTask(e){return await C("/api/Task/Park",e)}};async function v(e){console.log("post:"+JSON.stringify(e));var t=await c.post("/api/HotRun",e);return t.data}async function b(){var e=await c.get("/api/HotRun");return e.data}async function S(e){var t=await c.get(`/api/HotRun/Start?scriptID=${e}`);return t.data}async function k(e){await c.get(`/api/HotRun/Stop?scriptID=${e}`)}async function C(e,t){var a=`?user=${d.HP.getters.UserName}`;return e+=a,c.post(e,t,{headers:(0,l.g0)()}).then((e=>(console.log("Response:",e.data),{status:e.status,data:e.data}))).catch((e=>(console.error("Error:",e),{status:e.response.status,data:e.response.data,message:e.message})))}},82106:function(e,t,a){"use strict";a.d(t,{FU:function(){return h},HG:function(){return u},hB:function(){return g},jf:function(){return l},l2:function(){return c},m3:function(){return d},mm:function(){return m}});var i=a(9669),s=a.n(i),n=a(663),o=a(90131),r=s().create({baseURL:n.Z.backend_host});async function l(){const e=(0,o.Kt)();var t={};t["Authorization"]=e;var a=await r.get("api/Auth/Users",{headers:t});return a.data}async function d(e){try{var t=await r.post("api/Auth/login",e);return console.info(t),h(t.data),t.data}catch(a){return a.response.data}}async function c(e){const t=(0,o.Kt)();var a={};a["Authorization"]=t;var i=await r.post("api/Auth/modify",e,{headers:a});return i.data}async function u(e){var t=await r.delete(`api/Auth/Delete?user_name=${e}`);return t.data}async function m(e){var t=await r.post("api/Auth/Add",e);return t.data}function h(e){e.LoginTime=Date.now(),localStorage.setItem("user",JSON.stringify(e))}async function g(e,t){var a=await r.get(`api/Auth/UserRouteChange?userID=${e}&current_route=${t}`);return a.data}},38418:function(e,t,a){"use strict";a.d(t,{PX:function(){return l},UT:function(){return r},ZM:function(){return d},bh:function(){return u},fO:function(){return c}});var i=a(9669),s=a.n(i),n=a(663),o=(s().create({baseURL:n.Z.backend_host}),s().create({baseURL:n.Z.vms_host}));async function r(e,t=0){return await o.get(`/api/VmsManager/OnlineRequet?agv_name=${e}&model=${t}`)}async function l(e,t=0){return await o.get(`/api/VmsManager/OfflineRequet?agv_name=${e}&model=${t}`)}async function d(e,t){var a=await o.post(`/api/VmsManager/AGVLocating?agv_name=${e}`,t);return a.data}var c={AddVehicle:async e=>{try{var t=await o.post("/api/VmsManager/AddVehicle",e);return t.data}catch(a){return{confirm:!1,message:`與VMS系統通訊失敗(${a})`}}},EditVehicle:async(e,t)=>{var a=await o.post(`/api/VmsManager/EditVehicle?oriAGVID=${t}`,e);return a.data},DeleteVehicle:async e=>{var t=await o.delete(`/api/VmsManager/DeleteVehicle?AGV_Name=${e}`);return t.data}};const u={GetSettings:async()=>{var e=await o.get("api/vehiclebattery");return e.data},ModifySetting:async(e,t)=>{var a=await o.post(`api/vehiclebattery?agvName=${e}`,t);return a.data}}},60487:function(e,t,a){"use strict";var i=a(663);a(53259),i.Z.backend_host.replace("http","ws")},79072:function(e,t,a){"use strict";a.d(t,{Be:function(){return T},DS:function(){return x},Di:function(){return te},Ew:function(){return F},G:function(){return _},H6:function(){return P},HB:function(){return I},IN:function(){return G},K$:function(){return H},MV:function(){return ae},P0:function(){return Y},Qw:function(){return O},S9:function(){return J},UY:function(){return ee},Xl:function(){return E},bE:function(){return M},eX:function(){return Z},h0:function(){return A},oy:function(){return N},q4:function(){return q},rL:function(){return D},s6:function(){return W},tW:function(){return V},ux:function(){return K},xK:function(){return X},xZ:function(){return U}});a(57658);var i=a(81332),s=a(58958),n=a(35393),o=a(51345),r=a(30283),l=a(47539),d=a(21280),c=a(60188),u=a(69242),m=a(81090),h=(a(45243),a(95320)),g=a(663);function p(){return!1}p()&&g.Z.backend_host;function _(e){var t=h.p.getters.MapData.Points,a=t[e];return a||{}}function w(e){return new i.Z({src:""==e?"/images/eq-icon.png":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"transparent"})}function f(e){return new i.Z({src:""==e?"/images/charging-station.png":e,scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,color:"transparent"})}function y(e){return new i.Z({src:""==e?"/images/rack.png":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"})}function v(e){return new i.Z({src:""==e?"/images/rack_charge_station.png":e,scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,color:"yellow"})}function b(e){return new i.Z({src:""==e?"/images/stk_.jpg":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"})}function S(e){return new i.Z({src:""==e?"/images/lifter_icon.png":e,scale:.35,anchor:[.5,.5],size:[128,128],opacity:1,color:"white"})}const k=new i.Z({src:"/images/location.png",offset:[-25,-5],scale:.5,size:[180,180]}),C=new i.Z({src:"/images/location.png",offset:[-120,-40],scale:.6,size:[300,300]});function A(e=new K){var t="orange";const a=new s.Z({color:"black",width:2});if(e){if(!e.Enable)return new n.Z({fill:new o.Z({color:"red"}),stroke:new s.Z({color:"red",width:2}),points:4,radius:10,radius2:0,angle:Math.PI/4});if(t=e.IsVirtualPoint?"grey":e.IsTrafficCheckPoint?"rgb(13, 110, 253)":"orange",e.IsAvoid)return new n.Z({fill:new o.Z({color:"orange"}),stroke:a,points:3,radius:6,angle:0})}return new r.Z({radius:5,fill:new o.Z({color:t}),stroke:a})}function T(e,t=""){let a=new m.Z({geometry:new c.Z(e)});return a.setStyle(new l.ZP({image:C,text:new d.Z({text:t,font:"bold 20px Calibri,sans-serif",offsetX:-7,offsetY:-82,fill:new o.Z({color:"white"}),stroke:new s.Z({color:"black",width:2}),backgroundFill:new o.Z({color:"rgb(13, 110, 253)"}),padding:[5,5,5,5]})})),a}function V(e,t=!0,a=""){let i=new m.Z({geometry:new c.Z(e)});return i.setStyle(new l.ZP({image:k,text:new d.Z({text:a,font:"bold 16px Calibri,sans-serif",offsetX:14,offsetY:-22,fill:new o.Z({color:"gold"}),stroke:new s.Z({color:"black",width:2})})})),i}function D(e="",t=0,a=new K){var i=A(a);0==t?i=A(a):1==t?i=w(a.Graph.ImageName):2==t||12==t||22==t?i=b(a.Graph.ImageName):4==t||41==t?i=y(a.Graph.ImageName):5==t||6==t?i=v(a.Graph.ImageName):3==t?i=f(a.Graph.ImageName):100!=t&&201!=t||(i=S(a.Graph.ImageName));var n=h.p.getters.Settings.normalStationTextColor,r=h.p.getters.Settings.workStationTextColor,c=h.p.getters.Settings.normalStationTextFontSize,u=h.p.getters.Settings.workStationTextFontSize,m=a.Enable?0==t?n:r:"rgb(255, 102, 92)",g=0==t?c:u,p=new l.ZP({image:i,text:new d.Z({text:e+""+(a.Enable?"":"(已禁用)"),font:`bold ${g}px Calibri,sans-serif`,offsetY:-22,fill:new o.Z({color:m}),backgroundFill:0==t?void 0:new o.Z({color:"rgba(152, 209, 224,.5)"}),stroke:new s.Z({color:"black",width:2}),padding:[4,4,4,4]})});return p}function x(e="red",t=1){const a=[new l.ZP({stroke:new s.Z({color:e,width:t})})];return a}function M(e,t=void 0){var a=h.p.getters.Settings.pathColor,n=(e.get("data"),e.get("isEqLink")),o=e.get("isClose");const r=e.getGeometry(),d=[new l.ZP({stroke:new s.Z({color:o?"red":a,width:2.7,lineDash:n?[4,11]:null})})],u=r.getCoordinates();var m=0;return r.forEachSegment((function(e,t){if(m==u.length-2){const s=t[0]-e[0],r=t[1]-e[1],u=Math.atan2(r,s);if(d.push(new l.ZP({geometry:new c.Z(t),image:new i.Z({src:"/arrow.png",anchor:n?[1.8,.5]:[1.2,.5],rotateWithView:!0,rotation:-u,scale:.2,color:o?"red":a})})),o){e=[(t[0]+e[0])/2,(t[1]+e[1])/2];const a=t[0]-e[0],s=t[1]-e[1],n=Math.atan2(s,a);d.push(new l.ZP({geometry:new c.Z(e),image:new i.Z({src:"/close.png",anchor:[1.2,.5],rotateWithView:!0,rotation:-n,scale:.6})}))}}m+=1})),d}function W(e,t,a){var i=new Z;i.coordination=e,i.index=t,i.station_type=0,i.name=i.index+"",i.tag=i.index,i.graph=e;var s=new K;s.StationType=0,s.X=e[0],s.Y=e[1],s.Graph.X=e[0],s.Graph.Y=e[1],s.Name=s.Graph.Display=i.name,s.TagNumber=i.index,i.data=s;var n=I(i);return n}function I(e=new Z){const t=new m.Z({geometry:new c.Z(e.coordination)});t.set("index",e.index),t.set("name",e.name),t.set("station_type",e.station_type),t.set("targets",e.targets),t.set("feature_type","station"),t.set("data",e.data),t.set("coordination",e.coordination),t.set("graph",e.graph);var a=e.name;t.setStyle(D(a,e.station_type,e.data));var i=t.clone();return e.data.Graph&&i.setGeometry(new c.Z([e.data.Graph.X,e.data.Graph.Y])),t.set("routeModeFeature",i),t}function E(e=new Z,t=0){var a="coordination"==t?e.coordination:e.graph;const i=new m.Z({geometry:new c.Z(a)});i.set("feature_type","lduld"),i.set("data",e.data),i.set("action",0);var n=new l.ZP({image:void 0,text:new d.Z({font:"bold 14px Calibri,sans-serif",offsetX:14,offsetY:-52,stroke:new s.Z({width:1}),fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:"seagreen"}),backgroundStroke:new s.Z({color:"grey",width:2}),rotation:.15,padding:[5,5,5,5]})});return i.setStyle(n),i}function P(e="禁制區",t=[],a=1){var i=0==a,n=i?"rgba(255, 0, 0,0.5)":"rgba(116, 249, 42,0.3)",r=i?"orange":"rgb(139, 171, 206)",h=i?"red":"seagreen",g=i?"forbid":"passible",p=new m.Z(new u.ZP([t]));p.setStyle(new l.ZP({fill:new o.Z({color:n}),stroke:new s.Z({color:h,width:1})})),p.set("type","polygon"),p.set("name",e),p.set("region_type",g);const _=p.getGeometry().getInteriorPoint().getCoordinates();var w=new m.Z({geometry:new c.Z(_),name:e});return w.set("type","text"),w.set("name",e),w.set("region_type",g),w.setStyle(new l.ZP({text:new d.Z({text:w.get("name"),scale:1.1,font:"bold 22px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:r}),padding:[5,5,5,5]})})),{region_feature:p,text_feature:w}}function L(e,t=!1){return t?new i.Z({src:1==e?"images/rack2.png":"images/tray.png",scale:1==e?.6:.8,anchor:1==e?[1.3,.95]:[.8,.65],size:[60,60],opacity:1}):null}function O(e=0,t="",a=!1){return new l.ZP({image:L(e,a),text:new d.Z({text:t,offsetX:-55,offsetY:-45,textAlign:"left",font:"bold 16px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:"rgb(13, 110, 253)"}),padding:[5,8,5,8]})})}function N(e=new m.Z,t=new j){var a=O(t.cargo_type,t.cst_id,t.exist);e.setStyle(a)}var R=(e=void 0,t=void 0)=>{var a=64,s=64,n="blob"==e.substring(0,4),o=n||!p()?e:`${g.Z.backend_host}/AGVImages/AGV_001-Icon.png`;if(t)a=t[0],s=t[1];else{var r=new Image;r.src=o,a=0==r.width?64:r.width,s=0==r.height?64:r.height}return new i.Z({src:o,scale:48/a,anchor:[.5,.5],size:[a,s],opacity:1,rotation:0*Math.PI/180})};function G(e,t){return new l.ZP({image:new i.Z({src:"/agv.png",scale:.6,anchor:[.5,.5],size:[64,64],opacity:1,rotation:0*Math.PI/180}),text:new d.Z({text:e,offsetX:0,offsetY:32,font:"bold 16px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:t}),backgroundStroke:new s.Z({color:"black"}),textAlign:"center",padding:[4,4,4,4]})})}function H(e,t,a=void 0,i=void 0){return new l.ZP({image:R(a),text:new d.Z({text:e,offsetX:0,offsetY:32,font:"bold 16px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:t}),backgroundStroke:new s.Z({color:"black"}),textAlign:"center",padding:[6,8,6,8]})})}function U(e,t=1){var a=document.createElement("div");a.style.color=e,document.body.appendChild(a);var i=window.getComputedStyle(a).color;document.body.removeChild(a);var s=i.replace("rgb","rgba").replace(")",`, ${t})`);return s}function B(e,t=new j){return 0==e?t.exist?"跑貨":"移動":1==e?"取貨":2==e?"放貨停車":3==e?"前進":4==e?"後退":5==e?"Fab?":6==e?"量測":7==e?"放貨":8==e?"充電":9==e?"搬運":10==e?"移出充電站":11==e?"快逃":12==e?"停車":13==e?"離開停車":14==e?"電池交換":15==e?"Hold":16==e?"Break":17==e?"":void 0}class q{constructor(e=1,t=[new F]){this.AGVNum=e,this.AGVDisplays=t}}class F{constructor(e="AGV",t="pink",a=[0,0],i=[],s=new j,n=0,o=0,r=new z,l=0,d=new $,c="",u=145,m=80){this.AgvName=e,this.TextColor=t,this.Coordination=a,this.NavPathCoordinationList=i,this.CargoStatus=s,this.Tag=n,this.Theta=o,this.WaitingInfo=r,this.CurrentAction=d.is_executing_task?B(l,s):"",this.AgvStates=d,this.DisplayText=""==c?e:c,this.vehicleWidth=m,this.vehicleLength=u}}class z{constructor(){this.IsWaiting=!1,this.Descrption="",this.WaitingPoint={}}}class j{constructor(e=!1,t=0,a=""){this.exist=e,this.cargo_type=t,this.cst_id=a}}class Z{constructor(){this.index=0,this.name="name",this.tag=0,this.station_type=1,this.targets=[],this.coordination=[0,0],this.graph=[0,0],this.data={}}}class ${constructor(){this.is_online=!1,this.is_executing_task=!1,this.main_status="IDLE"}}class Y{constructor(){this.Version=1,this.Name=void 0,this.Options=new Q,this.Note="",this.PointIndex=0,this.Map_Image_Size=[400,400],this.Map_Image_Boundary=[-20,-20,20,20],this.Points={},this.BezierCurves={},this.Pathes=[],this.Segments=[],this.Bays={},this.Regions=[new J]}}class Q{constructor(){this.pathColor="rgb(45,42,46)",this.normalStationTextColor="orange",this.workStationTextColor="lime",this.normalStationTextFontSize=12,this.workStationTextFontSize=18,this.fontSizeOfDisplayName=12,this.fontSizeOfAsCandicates=16,this.Rotation=0,this.EQIcons=[],this.gridSize=1,this.defaultShowBackgroudImage=!0}}class K{constructor(){this.X=0,this.Y=0,this.Name="",this.TagNumber=0,this.Direction=0,this.Direction_Secondary_Point=0,this.AGV_Alarm=!1,this.Enable=!0,this.IsStandbyPoint=!1,this.IsSegment=!1,this.IsOverlap=!1,this.IsParking=!1,this.IsAvoid=!1,this.IsVirtualPoint=!1,this.IsAutoDoor=!1,this.IsExtinguishing=!1,this.InvolvePoint="",this.StationType=0,this.LsrMode=1,this.Speed=1,this.Bay="",this.Graph={Display:"",X:0,Y:0,ImageName:"",IsBezierCurvePoint:!1,BezierCurveID:""},this.Target={},this.DodgeMode=0,this.SpinMode=0,this.SubMap="",this.AutoDoor={KeyName:"",KeyPassword:""},this.MotionInfo={ControlBypass:{GroundHoleCCD:"",GroundHoleSensor:"",UltrasonicSensor:""}},this.Region="",this.IsCharge=!1,this.IsEquipment=!1,this.IsSTK=!1,this.IsEQLink=!1,this.IsCross=!1,this.IsRegisted=!1,this.IsTrafficCheckPoint=!1,this.RegistInfo=null}}class J{constructor(e="",t=[],a=1){this.Name=e,this.PolygonCoordinations=t,this.RegionType=a,this.IsOpend=!0,this.IsNarrowPath=!0,this.MaxVehicleCapacity=2,this.SpeedLimit=1,this.EnteryTags=[],this.LeavingTags=[],this.ThetaLimitWhenAGVIdling=0}}class X{constructor(){this.title="title",this.backgroundColor="white",this.feature_type="Station",this.point_data=new K,this.show_task_dispatch=!1,this.task_options=new ee}}class ee{constructor(e){this.StationType=e}}class te{constructor(e=0,t="",a=""){this.tag=e,this.name=t,this.name_display=a}}class ae{constructor(e="pink",t="RRRR"){this.DisplayText=t,this.DisplayColor=e}}},95320:function(e,t,a){"use strict";a.d(t,{p:function(){return r}});a(57658);var i=a(33907),s=a(9669),n=a.n(s),o=a(79072);a(663);const r=(0,i.MT)({state:{MapData:new o.P0,MapGeoJson:null,AGVDynamicPathInfo:void 0,OthersAGVLocateInfo:[],ControledPathesBySystem:{},AGVLocUpload:{},agv_colors:["rgb(13, 110, 253)","limegreen","orange","pink","red","purple"],RegionOptions:null,Settings:{path_color:"red"},worker:new Worker(""),mapBackendServer:`${window.location.protocol}//${window.location.host}`},getters:{MapBackednAxios:e=>{var t=n().create({baseURL:e.mapBackendServer});return t},CustomAGVStyles:e=>{var t=localStorage.getItem("custom-agv-styles");return t?JSON.parse(t):{AGV_001:new o.MV("rgb(13, 110, 253)","AGV_001"),AGV_002:new o.MV("limegreen","AGV_002"),AGV_003:new o.MV("orange","AGV_003"),AGV_004:new o.MV("pink","AGV_004")}},MapData:e=>{var t=localStorage.getItem("mapData");return null==e.MapData&&t?JSON.parse(t):e.MapData},Map_Image_Size:e=>e.MapData.Map_Image_Size,Map_Image_Boundary:e=>e.MapData.Map_Image_Boundary,Pathes:e=>e.MapData.Segments,MapName:e=>null==e.MapData?"Unkown":e.MapData.Name,MapImageName:e=>null==e.MapData?"Unkown":e.MapData.ImageName,Settings:e=>e.MapData.Options,BezierCurves:e=>null==e.MapData?{}:e.MapData.BezierCurves,GeoMapData:e=>e.MapGeoJson,MapServerUrl:e=>e.mapBackendServer,MapStations:(e,t)=>{var a=e.MapData;if(!a)return[];var i=a.Points;if(!i)return[];var s=Object.keys(i),n=[];return s.forEach((e=>{var t=i[e],a=new o.eX;a.index=parseInt(e),a.name=t.Name,a.station_type=t.StationType,a.tag=t.TagNumber,a.coordination=[t.X,t.Y],a.targets=[],a.graph=[t.Graph.X,t.Graph.Y],a.data=t,Object.keys(t.Target).forEach((e=>{a.targets.push(parseInt(e))})),n.push(a)})),n},BaysData:e=>e.MapData?e.MapData.Bays:{},Regions:e=>e.MapData.Regions?e.MapData.Regions:[],AGVDynamicPathInfo:e=>e.AGVDynamicPathInfo,AGVLocUpload:e=>e.AGVLocUpload,AGVNavInfo:(e,t)=>{var a=e.AGVDynamicPathInfo;if(void 0==a)return new o.q4(0,[]);var i=Object.keys(a).length,s=[],n=0;Object.keys(a).forEach((i=>{var r=a[i],l=r.vehicleLength,d=r.vehicleWidth,c=r.nav_path,u=[],m=[0,0];if(r.currentCoordication&&(m=[r.currentCoordication.X,r.currentCoordication.Y]),c){var h=c.length;u.push(m);for(let e=1;e<h;e++){const a=c[e];var g=t.MapStations.find((e=>e.tag==a));g&&u.push(g.coordination)}}var p=t.CustomAGVStyles[i],_="black",w=i;p?(_=p.DisplayColor,w=p.DisplayText):_=e.agv_colors[n];var f=new o.Ew(i,_,m,u,r.cargo_status,r.currentLocation,r.theta,r.waiting_info,r.currentAction,r.states,w,l,d);s.push(f),n+=1}));var r=new o.q4(i,s);return r},OthersAGVLocateInfo:e=>e.OthersAGVLocateInfo,AllNormalStationOptions:e=>{var t=Object.values(e.MapData.Points);t=t.filter((e=>!e.IsVirtualPoint&&0==e.StationType)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return t},AllParkableStationOptions:e=>{var t=Object.values(e.MapData.Points);t=t.filter((e=>e.IsParking)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return t},AllEqStation:(e,t)=>{var a=Object.values(e.MapData.Points),i=a.filter((e=>0!=e.StationType&&3!=e.StationType)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return i.sort(((e,t)=>e.name_display.localeCompare(t.name_display))),i},AllChargeStation:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(3==e.StationType||5==e.StationType||6==e.StationType))).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllExangeBatteryStation:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(16==e.StationType||3==e.StationType))).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllParkingStationOptions:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&1==e.IsParking||4==e.StationType||5==e.StationType)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllBufferStationOptions:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(4==e.StationType||41==e.StationType||5==e.StationType))).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllPointsOptions:e=>{var t=[],a=e.MapData.Points,i=Object.keys(a);return i.forEach((e=>{var i=a[e];t.push({index:e,tag:i.TagNumber,name:i.Graph.Display})})),t},ControledPathesBySystem:e=>e.ControledPathesBySystem,RegionOptions:e=>e.RegionOptions,EqIcons:e=>e.MapData.Options.EQIcons,GridSize:e=>e.MapData.Options.gridSize,Rotation:e=>e.MapData.Options.Rotation?e.MapData.Options.Rotation:0,DefaultShowBackgroundImage:e=>e.MapData.Options.defaultShowBackgroudImage},mutations:{setMapData(e,t){e.MapData=t,localStorage.setItem("mapData",JSON.stringify(t))},setGeoMapData(e,t){e.MapGeoJson=t},setAGVDynamicPathInfo(e,t){e.AGVDynamicPathInfo=t},setOtherAGVLocateInfo(e,t){e.OthersAGVLocateInfo=t},setAGVLocUpload(e,t){e.AGVLocUpload=t},setWorker(e,t){e.worker=t},setControledPathesBySystem(e,t){e.ControledPathesBySystem=t},RegionOptions(e,t){e.RegionOptions=t},setMapGridSize(e,t){e.MapData.Options.gridSize=t,console.log(e.MapData.Options.gridSize)},SaveAGVStyle(e,t){var a=localStorage.getItem("custom-agv-styles"),i={};a&&(i=JSON.parse(a)),i[t.agvname]=t.style,localStorage.setItem("custom-agv-styles",JSON.stringify(i))},SetRotation(e,t){e.MapData.Options.Rotation=t},setPathColor(e,t){e.MapData.Options.pathColor=t},setNormalPointTextColor(e,t){e.MapData.Options.normalStationTextColor=t},setWorkStationPointTextColor(e,t){e.MapData.Options.workStationTextColor=t},setNormalPointTextFontSize(e,t){e.MapData.Options.normalStationTextFontSize=t},setWorkStationPointTextFontSize(e,t){e.MapData.Options.workStationTextFontSize=t}},actions:{async DownloadMapData({commit:e,getters:t}){await t.MapBackednAxios.get("api/Map").then((t=>{e("setMapData",t.data)}))},async GetPointEnableMap({getters:e}){var t=await e.MapBackednAxios.get("api/Map/GetPointEnableMap");return t.data},Save({commit:e}){},GetMapPointByIndex({commit:e,state:t},a){var i=t.MapData.Points;return i[a]},GetMapPointByTag({commit:e,state:t},a){var i=t.MapData.Points;return Object.values(i).find((e=>e.TagNumber+""==a+""))},async SaveMap({commit:e,state:t,actions:a,getters:i},s){var n=s.data,o=s.file;console.log(o);var r=async e=>{const t=new FormData;t.append("image",e),console.log(t),await i.MapBackednAxios.post("api/Map/MapImageUpload",t)};return o&&(n.ImageName=o.name,await r(o)),i.MapBackednAxios.post("api/Map/SaveMap",n).then((t=>(n.Note=t.data,e("setMapData",n),!0))).catch((e=>!1))},UploadCoorFunctionSwitch({commit:e,state:t,getters:a},i){if(a.MapBackednAxios.get(`api/Map/SwitchAGVUploadLocFun?enabled=${i}`),i){const t=new Worker("websocket_worker.js");t.onmessage=t=>{"error"!=t.data&&"closed"!=t.data&&e("setAGVLocUpload",t.data)},t.postMessage({command:"connect",ws_url:a.MapServerUrl.replace("http","ws")+"/ws/AGVLocationUpload"}),e("setWorker",t)}else t.worker.postMessage({command:"disconnect"})},DeleteIcon({commit:e,state:t,getters:a,actions:i},s){a.MapBackednAxios.delete(`api/Map/DeleteIcon?filePath=${s}`)},GetRegionByName({state:e,getters:t},a){var i=t.Regions;return i.find((e=>e.Name==a))},ResetMapXYGraphAsCoordinations({state:e,getters:t,actions:a}){return t.MapBackednAxios.post("api/Map/ResetGraphXYAsCoordinations").then((e=>e.data))}}});r.dispatch("DownloadMapData")},53259:function(e,t,a){"use strict";var i=a(59391);const s=(0,i.Z)();t.Z=s},663:function(e,t,a){"use strict";var i={type:"jw",get backend_host(){return`${window.location.protocol}//${window.location.host}`},get backend_ws_host(){return this.backend_host.replace("http","ws")},get vms_host(){return this.backend_host.replace("5216","5036")},get vms_ws_host(){return this.vms_host.replace("http","ws")},get agvsystem_notify_url(){return this.backend_host+"/api/event"}};t.Z=i},71588:function(e,t,a){"use strict";a.d(t,{Z:function(){return ja},Q:function(){return Fa}});var i=a(22201),s=a(66252),n=a(3577),o=a(49963);const r={class:"home-view h-100 custom-tabs-head"},l={class:"left-col border-right left-panel"},d={class:"resizer text-primary d-flex flex-column"},c={class:"menu-icon"},u=(0,s._)("div",{class:"flex-fill d-flex flex-column justify-content-center"},[(0,s._)("i",{class:"bi bi-three-dots-vertical"})],-1),m={class:"right-panel flex-fill"},h={style:{width:"100%"},class:"border"};function g(e,t,a,i,g,p){const _=(0,s.up)("AGVStatusVue"),w=(0,s.up)("TaskStatusVue"),f=(0,s.up)("MenuExpandIcon"),y=(0,s.up)("el-icon"),v=(0,s.up)("MenuFoldIcon"),b=(0,s.up)("HomeMap"),S=(0,s.up)("el-tab-pane"),k=(0,s.up)("EQStatus"),C=(0,s.up)("el-tabs"),A=(0,s.up)("TaskAllocationVue"),T=(0,s.up)("TaskDispatchNewUI"),V=(0,s.up)("TaskDispathActionButton"),D=(0,s.Q2)("loading");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",{style:(0,n.j5)({visibility:g.isEasyMode?"hidden":"visible"}),class:"d-flex flex-row"},[(0,s.wy)((0,s._)("div",l,[(0,s.Wm)(_),(0,s.Wm)(w,{height:"330px"})],512),[[o.F8,g.MenuExpanded]]),(0,s._)("div",d,[(0,s._)("div",c,[g.MenuExpanded?((0,s.wg)(),(0,s.j4)(y,{key:1},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{onClick:t[1]||(t[1]=()=>{g.MenuExpanded=!1,p.AdjustSizeOfRightSideFullPage()})})])),_:1})):((0,s.wg)(),(0,s.j4)(y,{key:0},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{onClick:t[0]||(t[0]=()=>{g.MenuExpanded=!0,p.RestoreSizeOfRightSide()})})])),_:1}))]),u]),(0,s._)("div",m,[(0,s.Wm)(C,{lazy:"",modelValue:g.right_side_tabSelected,"onUpdate:modelValue":t[2]||(t[2]=e=>g.right_side_tabSelected=e),"tab-position":"top",style:{height:"100%"},type:"border-card"},{default:(0,s.w5)((()=>[(0,s.Wm)(S,{name:"map",label:"地圖"},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{style:{width:"100%"}})])),_:1}),(0,s.Wm)(S,{label:"設備狀態"},{default:(0,s.w5)((()=>[(0,s.Wm)(k)])),_:1})])),_:1},8,["modelValue"])]),(0,s.Wm)(A)],4),(0,s._)("div",{style:(0,n.j5)({visibility:g.isEasyMode?"visible":"hidden",position:"absolute",top:"70px",width:"100%",height:"82vh"}),class:"easy_mode d-flex"},[(0,s._)("div",null,[(0,s.Wm)(_,{IsEasyMode:!0})]),(0,s._)("div",h,[(0,s.Wm)(b,{id:"homemap-easymode"})])],4),(0,s.wy)((0,s.Wm)(T,{class:(0,n.C_)(["new-dispatch-pnl",g.show_new_dispatch_panel?"dispatch-show":"hide"]),onClose:t[3]||(t[3]=()=>{g.show_new_dispatch_panel=!1})},null,8,["class"]),[[o.F8,g.show_new_dispatch_panel]]),p.IsLogin?((0,s.wg)(),(0,s.j4)(V,{key:0,onOnTaskDispatch:t[4]||(t[4]=()=>{g.right_side_tabSelected="map"}),onOnClick:t[5]||(t[5]=()=>{g.show_new_dispatch_panel=!0})})):(0,s.kq)("",!0)])),[[D,g.loading]])}var p=a(8393),_=a(51330);const w=e=>((0,s.dD)("data-v-ff209120"),e=e(),(0,s.Cn)(),e),f={class:"task-dispatch-btn-container"},y=w((()=>(0,s._)("span",null,null,-1))),v={class:"w-100 h-100"},b=w((()=>(0,s._)("div",{class:"w-100 bg-info d-flex"},null,-1))),S={class:"item-name"},k={class:"item-name"},C={class:"item-name"},A={class:"item-name"},T=w((()=>(0,s._)("div",{class:"item-name"},"轉運",-1))),V=w((()=>(0,s._)("div",{class:"item-name"},"轉運站",-1))),D=w((()=>(0,s._)("div",{class:"item-name"},"車輛",-1))),x={class:"w-100 py-1 d-flex border-top",style:{height:"50px"}},M={class:"actions-btn-conatiner"};function W(e,t,a,i,o,r){const l=(0,s.up)("el-col"),d=(0,s.up)("b-button"),c=(0,s.up)("el-row"),u=(0,s.up)("el-option"),m=(0,s.up)("el-select"),h=(0,s.up)("el-checkbox"),g=(0,s.up)("el-popover");return(0,s.wg)(),(0,s.j4)(g,{placement:"right",visible:o.action_menu_visible&&!o.order_info_visible,width:200,content:""},{reference:(0,s.w5)((()=>[(0,s._)("div",f,[(0,s.Wm)(g,{onHide:r.HandleDispathDialogHidden,"show-arrow":!1,"popper-style":o.order_info_style,visible:o.order_info_visible,placement:"right-start",width:455},{reference:(0,s.w5)((()=>[y])),default:(0,s.w5)((()=>[(0,s._)("div",v,[b,(0,s.Wm)(c,{class:"order-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{span:5},{default:(0,s.w5)((()=>[(0,s._)("div",S,(0,n.zw)(e.$t("Action")),1)])),_:1}),(0,s.Wm)(l,{class:"item-value",span:12},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(r.selected_action_display),1)])),_:1}),(0,s.Wm)(l,{class:"item-actions",span:7},{default:(0,s.w5)((()=>[r.IsDeveloper?((0,s.wg)(),(0,s.j4)(d,{key:0,size:"sm",variant:"link",onClick:t[0]||(t[0]=()=>{r.HandleCancelBtnClick(),o.action_menu_visible=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})):(0,s.kq)("",!0)])),_:1})])),_:1}),(0,s.Wm)(c,{class:"order-row",style:(0,n.j5)(o.agv_select_row_class)},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{span:5},{default:(0,s.w5)((()=>[(0,s._)("div",k,(0,n.zw)(e.$t("Vehicle")),1)])),_:1}),(0,s.Wm)(l,{class:"item-value",span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{placeholder:e.選擇車輛,modelValue:o.selected_agv,"onUpdate:modelValue":t[1]||(t[1]=e=>o.selected_agv=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.AgvNameList,(e=>((0,s.wg)(),(0,s.j4)(u,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["placeholder","modelValue"])])),_:1}),(0,s.Wm)(l,{class:"item-actions",span:7})])),_:1},8,["style"]),"carry"==o.selected_action?((0,s.wg)(),(0,s.j4)(c,{key:0,class:"order-row",style:(0,n.j5)(o.source_select_row_class),onClick:r.HandleSelectSoureStationFromMapBtnClick},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{span:5},{default:(0,s.w5)((()=>[(0,s._)("div",C,(0,n.zw)(e.$t("source")),1)])),_:1}),(0,s.Wm)(l,{class:"item-value",span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{placeholder:"從地圖或選單選擇來源",onChange:r.HandleFromSelectChanged,onClick:r.HandleSelectSoureStationFromMapBtnClick,modelValue:o.selected_source.TagNumber,"onUpdate:modelValue":t[2]||(t[2]=e=>o.selected_source.TagNumber=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.FromStationOptions,(e=>((0,s.wg)(),(0,s.j4)(u,{key:e.tag,label:e.name_display,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["onChange","onClick","modelValue"])])),_:1}),(0,s.Wm)(l,{class:"item-actions",span:7},{default:(0,s.w5)((()=>[o.selected_source.Graph&&r.IsSourceStationBuffer?((0,s.wg)(),(0,s.j4)(m,{key:0,placeholder:"選擇PORT",modelValue:o.selected_source_slot,"onUpdate:modelValue":t[3]||(t[3]=e=>o.selected_source_slot=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.GetLayersOfBuffer(o.selected_source.TagNumber),(e=>((0,s.wg)(),(0,s.j4)(u,{key:o.selected_source.Graph.Display+"-"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):(0,s.kq)("",!0)])),_:1})])),_:1},8,["style","onClick"])):(0,s.kq)("",!0),(0,s.Wm)(c,{class:"order-row",style:(0,n.j5)(o.destine_select_row_class),onClick:r.HandleSelectDestineStationFromMapBtnClick},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{span:5},{default:(0,s.w5)((()=>[(0,s._)("div",A,(0,n.zw)(e.$t("TaskDispathActionButton.Destine")),1)])),_:1}),(0,s.Wm)(l,{class:"item-value",span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{placeholder:"從地圖或選單選擇目的地",onChange:r.HandleDestineSelectChanged,onClick:r.HandleSelectDestineStationFromMapBtnClick,modelValue:o.selected_destine.TagNumber,"onUpdate:modelValue":t[4]||(t[4]=e=>o.selected_destine.TagNumber=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(o.downstream_options,(e=>((0,s.wg)(),(0,s.j4)(u,{key:e.tag,label:e.name_display,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["onChange","onClick","modelValue"])])),_:1}),(0,s.Wm)(l,{class:"item-actions",span:7},{default:(0,s.w5)((()=>[o.selected_destine.Graph&&r.IsDestineStationBuffer?((0,s.wg)(),(0,s.j4)(m,{key:0,placeholder:"選擇PORT",modelValue:o.selected_destine_slot,"onUpdate:modelValue":t[5]||(t[5]=e=>o.selected_destine_slot=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.GetLayersOfBuffer(o.selected_destine.TagNumber),(e=>((0,s.wg)(),(0,s.j4)(u,{key:o.selected_destine.Graph.Display+"-"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):(0,s.kq)("",!0)])),_:1})])),_:1},8,["style","onClick"]),r.IsDeveloper&&"carry"==o.selected_action?((0,s.wg)(),(0,s.j4)(c,{key:1,class:"order-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{span:5},{default:(0,s.w5)((()=>[T])),_:1}),(0,s.Wm)(l,{class:"item-value",span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{modelValue:o.IsTransferTaskNeedChangeAGV,"onUpdate:modelValue":t[6]||(t[6]=e=>o.IsTransferTaskNeedChangeAGV=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(l,{class:"item-actions",span:7})])),_:1})):(0,s.kq)("",!0),r.IsDeveloper&&o.IsTransferTaskNeedChangeAGV?((0,s.wg)(),(0,s.j4)(c,{key:2,class:"order-row",style:(0,n.j5)(o.transfer_station_select_row_class),onClick:r.HandleSelectTransferStationFromMapBtnClick},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{span:5},{default:(0,s.w5)((()=>[V])),_:1}),(0,s.Wm)(l,{class:"item-value",span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{placeholder:"從地圖或選單選擇轉運站",onChange:r.HandleTransferStationSelectChanged,onClick:r.HandleSelectTransferStationFromMapBtnClick,modelValue:o.selected_transfer_station.TagNumber,"onUpdate:modelValue":t[7]||(t[7]=e=>o.selected_transfer_station.TagNumber=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.BufferStations,(e=>((0,s.wg)(),(0,s.j4)(u,{key:e.tag,label:e.name_display,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["onChange","onClick","modelValue"])])),_:1}),(0,s.Wm)(l,{class:"item-actions",span:7})])),_:1},8,["style","onClick"])):(0,s.kq)("",!0),o.IsTransferTaskNeedChangeAGV?((0,s.wg)(),(0,s.j4)(c,{key:3,class:"order-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{span:5},{default:(0,s.w5)((()=>[D])),_:1}),(0,s.Wm)(l,{class:"item-value",span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{placeholder:"$t('xuan-ze-che-liang')",modelValue:o.selected_transfer_to_destine_agv,"onUpdate:modelValue":t[8]||(t[8]=e=>o.selected_transfer_to_destine_agv=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.AgvNameList,(e=>((0,s.wg)(),(0,s.j4)(u,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,s.Wm)(l,{class:"item-actions",span:7})])),_:1})):(0,s.kq)("",!0),(0,s._)("div",x,[(0,s.Wm)(d,{onClick:r.HandleConfirmBtnClicked,class:"w-50 mx-1",variant:"primary"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("TaskDispathActionButton.dispatch-confirm")),1)])),_:1},8,["onClick"]),r.IsDeveloper?((0,s.wg)(),(0,s.j4)(d,{key:0,class:"w-50 mx-1",variant:"light",onClick:t[9]||(t[9]=()=>{o.order_info_visible=!1,o.action_menu_visible=!0,r.HandleCancelBtnClick()})},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("TaskDispathActionButton.Back To Select Action")),1)])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(d,{class:"w-50 mx-1",variant:"danger",onClick:r.HandleCancelBtnClick},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Cancel")),1)])),_:1},8,["onClick"])])])])),_:1},8,["onHide","popper-style","visible"]),(0,s.Wm)(d,{squared:"",variant:"primary",onClick:t[10]||(t[10]=()=>{r.IsDeveloper?o.action_menu_visible?o.action_menu_visible=!1:o.order_info_visible||(o.action_menu_visible=!0):r.SelectActionHandle("carry")})},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Dispatch")),1)])),_:1})])])),default:(0,s.w5)((()=>[(0,s._)("div",M,[!r.IsRunMode||r.IsDeveloper?((0,s.wg)(),(0,s.j4)(d,{key:0,class:"w-100 my-1",variant:"light",onClick:t[11]||(t[11]=e=>r.SelectActionHandle("move"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Move")),1)])),_:1})):(0,s.kq)("",!0),!r.IsRunMode||r.IsDeveloper?((0,s.wg)(),(0,s.j4)(d,{key:1,class:"w-100 my-1",variant:"light",onClick:t[12]||(t[12]=e=>r.SelectActionHandle("park"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Park")),1)])),_:1})):(0,s.kq)("",!0),!r.IsRunMode||r.IsDeveloper?((0,s.wg)(),(0,s.j4)(d,{key:2,class:"w-100 my-1",variant:"light",onClick:t[13]||(t[13]=e=>r.SelectActionHandle("unload"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Unload")),1)])),_:1})):(0,s.kq)("",!0),!r.IsRunMode||r.IsDeveloper?((0,s.wg)(),(0,s.j4)(d,{key:3,class:"w-100 my-1",variant:"light",onClick:t[14]||(t[14]=e=>r.SelectActionHandle("load"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Load")),1)])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(d,{class:"w-100 my-1",variant:"primary",onClick:t[15]||(t[15]=e=>r.SelectActionHandle("carry"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Transfer")),1)])),_:1}),(0,s.Wm)(d,{class:"w-100 my-1",variant:"warning",onClick:t[16]||(t[16]=e=>r.SelectActionHandle("charge"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Charge")),1)])),_:1}),(0,s.Wm)(d,{class:"w-100 my-1",variant:"warning",onClick:t[17]||(t[17]=e=>r.SelectActionHandle("exchange_battery"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Exchange Battery")),1)])),_:1}),(0,s.Wm)(d,{class:"w-100 my-1",variant:"warning",onClick:t[18]||(t[18]=e=>r.SelectActionHandle("measure"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Measure")),1)])),_:1}),(0,s.Wm)(d,{class:"w-100 my-1",variant:"danger",onClick:t[19]||(t[19]=()=>{r.HandleCancelBtnClick(),o.action_menu_visible=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Cancel")),1)])),_:1})])])),_:1},8,["visible"])}a(57658);var I=a(53259),E=a(93867),P=a(49996),L=a(79072),O=a(8764),N=a(24239),R=a(95320),G=a(72924),H={data(){return{action_menu_visible:!1,order_info_visible:!1,isSelectTransferToDestinAGV:!1,isDispatchConfirming:!1,selected_action:"",selected_agv:"",selected_transfer_to_destine_agv:"",selected_source:{Graph:{Display:""},StationType:0},selected_destine:{Graph:{Display:""},StationType:0},selected_transfer_station:{Graph:{Display:""},StationType:0},selected_source_slot:0,selected_destine_slot:0,Cst_ID_Input:"",order_info_style:{backgroundColor:"rgba(255, 255, 255,.8)"},source_select_row_class:"",destine_select_row_class:"",transfer_station_select_row_class:"",agv_select_row_class:"",map_events_bus:{agv_selected:"/map/agv_selected",station_selected:"/map/station_selected"},bypass_eq_status_check:!1,equipments_options:[new L.Di],downstream_options:[new L.Di],IsTransferTaskNeedChangeAGV:!1,tagOfMiddleStationTagOfTransferTask:-1,routePath:""}},computed:{IsRunMode(){return N.cy.getters.IsRunMode},IsDeveloper(){return N.HP.getters.IsDeveloperLogining},AgvNameList(){var e=[];function t(e){N.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return this.IsRunMode?(e.push({value:"",label:"自動選車"}),this.IsDeveloper&&t(e)):t(e),e},IsShowBackTo(){return"select-action"!=this.current_progress},selected_action_display(){var e=this.selected_action;return"move"==e?this.$t("Move"):"unload"==e?this.$t("Unload"):"load"==e?this.$t("Load"):"carry"==e?this.$t("Transfer"):"charge"==e?this.$t("Charge"):"park"==e?this.$t("Park"):void 0},IsAutoSelectAGV(){return("carry"==this.selected_action||"unload"==this.selected_action)&&""==this.selected_agv},task_dispatch_btn_pushable(){var e=!!this.IsAutoSelectAGV||""!=this.selected_agv,t=void 0!=this.selected_source&&void 0!=this.selected_source.TagNumber,a=void 0!=this.selected_destine&&void 0!=this.selected_destine.TagNumber;return"carry"==this.selected_action?e&&t&&a:e&&a},EQStations(){return R.p.getters.AllEqStation},BufferStations(){return R.p.getters.AllBufferStationOptions},bay_names(){var e=R.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},FromStationOptions(){var e=[new L.Di];if(Object.assign(e,this.EQStations),this.IsDeveloper)return e;var t=N.sn.getters.AGVNameList,a=0==t.length?[]:t.map((e=>({tag:e,name_display:e}))),i=[new G.Z];Object.assign(i,N.jU.getters.EQData);var s=i.filter((e=>e.Unload_Request)),n=s.map((e=>e.Tag)),o=e.filter((e=>n.includes(e.tag))),r=[...this.BufferStations,...o,...a];return r},IsSourceStationBuffer(){return 4==this.selected_source.StationType||41==this.selected_source.StationType||5==this.selected_source.StationType},IsDestineStationBuffer(){return 4==this.selected_destine.StationType||41==this.selected_destine.StationType||5==this.selected_destine.StationType}},methods:{SelectActionHandle(e){this.$emit("onTaskDispatch"),this.selected_action=e,this.HandleActionSelected(e),this.action_menu_visible=this.IsTransferTaskNeedChangeAGV=!1,this.order_info_visible=!0,this.selected_source=this.selected_destine={TagNumber:void 0},"carry"==e||"unload"==e?(this.selected_agv=this.$t("auto-choise-vehicle"),"carry"==e?this.HandleSelectSoureStationFromMapBtnClick():this.HandleSelectDestineStationFromMapBtnClick()):(this.selected_agv=this.AgvNameList[0].label,this.HandleSelectAGVFromMapBtnClick(),console.log(this.selected_agv))},HandleDispathDialogHidden(e){this.isDispatchConfirming||setTimeout((()=>{this.HandleCancelBtnClick()}),300)},HandleActionSelected(e){this.source_select_row_class=this.destine_select_row_class=this.transfer_station_select_row_class=this.agv_select_row_class="";var t={backgroundColor:"rgb(13, 110, 253)",color:"white",borderRadius:"1px solid black"};"select-agv"==e&&(this.agv_select_row_class=t),"select-source"==e&&(this.source_select_row_class=t),"select-destine"==e&&(this.destine_select_row_class=t),"select-transfer-station"==e&&(this.transfer_station_select_row_class=t)},HandleAGVSelected(e){console.log(e),this.isSelectTransferToDestinAGV?this.selected_transfer_to_destine_agv=e:this.selected_agv=e},HandleSelectAGVFromMapBtnClick(e=!1){this.isSelectTransferToDestinAGV=e,e||this.HandleActionSelected("select-agv"),I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected),I.Z.emit("change_to_select_agv_mode"),this.current_progress="select-agv",this.is_reselecting_flag=!0,I.Z.on(this.map_events_bus.agv_selected,(t=>{console.log(t),e?this.selected_transfer_to_destine_agv=t:(this.selected_agv=t,"carry"!=this.selected_action||this.selected_source.Graph&&""!=this.selected_source.Graph.Display?this.selected_destine.Graph&&""!=this.selected_destine.Graph.Display||(this.HandleSelectDestineStationFromMapBtnClick(),this.HandleActionSelected("select-destine")):(this.HandleSelectSoureStationFromMapBtnClick(),this.HandleActionSelected("select-source")))}))},HandleSelectTransferStationFromMapBtnClick(){this.HandleActionSelected("select-transfer-station"),I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected);var e=this.GetDownStreamEQOptions(this.selected_source.TagNumber);console.info("_destine_options:",e);let t={action_type:this.selected_action,direction:"buffer",stations_to_show:this.BufferStations};I.Z.emit("change_to_select_eq_station_mode",t),this.current_progress="select-transfer-station",this.is_reselecting_flag=!0,I.Z.on(this.map_events_bus.station_selected,(e=>{console.info(e),4==e.StationType&&(I.Z.emit("mark_as_transfer_station",e.TagNumber),this.selected_transfer_station=e,this.tagOfMiddleStationTagOfTransferTask=e.TagNumber)}))},HandleSelectSoureStationFromMapBtnClick(){this.selected_source={Graph:{Display:""}},this.HandleActionSelected("select-source"),I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected),I.Z.emit("change_to_select_eq_station_mode",{action_type:this.selected_action,direction:"source",stations_to_show:this.FromStationOptions}),this.current_progress="select-source",this.is_reselecting_flag=!1,this.selected_destine={Graph:{Display:""}},I.Z.on(this.map_events_bus.station_selected,(e=>{console.info(e);const t=4==e.StationType||5==e.StationType||41==e.StationType;if(e.IsEquipment||t){if(e==this.selected_destine)return;this.selected_source=e,this.HandleFromSelectChanged(this.selected_source.TagNumber),setTimeout((()=>{I.Z.emit("mark_as_start_station",this.selected_source.TagNumber),this.HandleSelectDestineStationFromMapBtnClick(),this.HandleActionSelected("select-destine")}),200)}}))},HandleSelectDestineStationFromMapBtnClick(){this.HandleActionSelected("select-destine"),I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected),"load"!=this.selected_action&&"unload"!=this.selected_action||(this.downstream_options=this.EQStations),"move"==this.selected_action&&(this.downstream_options=R.p.getters.AllNormalStationOptions),"park"==this.selected_action&&(this.downstream_options=R.p.getters.AllParkableStationOptions),"charge"==this.selected_action&&(this.downstream_options=R.p.getters.AllChargeStation);var e=this.downstream_options;this.IsSourceStationBuffer&&(e=[...e,this.BufferStations]),console.info("_destine_options:",e);let t={action_type:this.selected_action,direction:"destine",stations_to_show:e};I.Z.emit("change_to_select_eq_station_mode",t),this.current_progress="select-destine",this.is_reselecting_flag=!0,I.Z.on(this.map_events_bus.station_selected,(e=>{if(console.info(e),("move"!=this.selected_action||0==e.StationType&&!e.IsVirtualPoint)&&("charge"!=this.selected_action||e.IsCharge)&&("load"!=this.selected_action&&"unload"!=this.selected_action&&"carry"!=this.selected_action||e.IsEquipment||4==e.StationType)){if("carry"==this.selected_action){if(e==this.selected_source)return;if(!this.downstream_options.some((t=>t.tag==e.TagNumber)))return}I.Z.emit("mark_as_destine_station",e.TagNumber),this.selected_destine=e,console.log("123A",e),console.log("123B",this.selected_destine)}}))},async HandleDestineSelectChanged(e){this.selected_destine=await R.p.dispatch("GetMapPointByTag",e)},HandleCancelBtnClick(){I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected),this.order_info_visible=!1,this.selected_source=this.selected_destine={Graph:{Display:""}},this.source_select_row_class=this.destine_select_row_class=this.agv_select_row_class=this.transfer_station_select_row_class="",I.Z.emit("change_to_normal_view_mode")},HandleConfirmBtnClicked(){this.isDispatchConfirming=!0,this.order_info_visible=!1,this.$swal.fire({title:"確定要派送此任務?",text:`${this.selected_agv} 執行 ${this.selected_action_display} 任務,終點:${this.selected_destine.Graph.Display}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed?this.TaskDeliveryHandle():this.order_info_visible=!0,this.isDispatchConfirming=!1}))},HandleTransferStationSelectChanged(e){this.tagOfMiddleStationTagOfTransferTask=e,console.warn(e)},async TaskDeliveryHandle(){this.IsDeveloper?this.bypass_eq_status_check=!0:0==N.HP.getters.level&&(this.bypass_eq_status_check=!1);var e={confirm:!0,message:""};console.info("Final",this.selected_destine);var t=this.selected_destine?this.selected_destine.TagNumber:-1,a=this.selected_source?this.selected_source.TagNumber:-1,i="自動選車"==this.selected_agv||""==this.selected_agv?"":this.selected_agv;if("move"==this.selected_action&&(e=await O.J8.MoveTask(new O.ec(i,t,50))),"measure"==this.selected_action&&(e=await O.J8.MeasureTask(new O.FV(i,t))),"load"==this.selected_action&&(e=await O.J8.LoadTask(new O.Y4(i,t,this.selected_destine_slot,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selected_action&&(e=await O.J8.UnloadTask(new O.On(i,t,this.selected_destine_slot,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selected_action&&(e=await O.J8.CarryTask(new O.mc(i,a,this.selected_source_slot,t,this.selected_destine_slot,this.Cst_ID_Input,50,this.bypass_eq_status_check,this.IsTransferTaskNeedChangeAGV,this.tagOfMiddleStationTagOfTransferTask,this.selected_transfer_to_destine_agv))),"exchange_battery"==this.selected_action&&(e=await O.J8.ExangeBatteryTask(new O.Z$(i,t,50,this.bypass_eq_status_check))),"charge"==this.selected_action&&(e=await O.J8.ChargeTask(new O.fn(i,t,50,this.bypass_eq_status_check))),"park"==this.selected_action&&(e=await O.J8.ParkTask(new O.Nn(i,t,50,this.bypass_eq_status_check))),200!=e.status){this.HandleCancelBtnClick();const t=401==e.status;setTimeout((()=>{this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.HandleCancelBtnClick(),t&&(N.HP.dispatch("logout",""),I.Z.emit("/show-login-view-invoke"))}))}),200)}else e.data.confirm?(this.HandleCancelBtnClick(),P.bM.success({message:`任務-[${this.selected_action_display}] 已派送!`,position:"top-right",duration:3e3})):(this.HandleCancelBtnClick(),setTimeout((()=>{this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}),200))},async HandleFromSelectChanged(e){this.selected_source=await R.p.dispatch("GetMapPointByTag",e),this.selected_destine={TagNumber:void 0},this.downstream_options=this.GetDownStreamEQOptions(e),console.log("validable downstream of ",e,this.downstream_options)},GetDownStreamEQOptions(e){var t=[],a=this.BufferStations.find((t=>t.tag==e)),i=N.jU.getters.EqOptions,s=i.find((t=>t.TagID==e));if(s||a){if(a){var n=[new G.Z];Object.assign(n,N.jU.getters.EQData);var o=n.filter((e=>e.Load_Request)),r=o.map((e=>e.Tag));console.log(r),Object.values(i).filter((e=>r.includes(e.TagID))).forEach((e=>{t.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}else{var l=s.ValidDownStreamEndPointNames,d=l.includes("ALL"),c=d?i:i.filter((e=>l.includes(e.Name)));Object.values(c).forEach((e=>{t.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}t=[...t,...this.BufferStations]}return t},GetLayersOfBuffer(e){const t=N.jU.getters.GetRowsByStationTag(e),a=[];for(let i=0;i<t;i++)a.push({label:`第${i+1}層`,value:i});return a},DetermineDestinOptions(){if("measure"==this.selected_action)return this.bay_names;if("move"==this.selected_action)return R.p.getters.AllNormalStationOptions;if("park"==this.selected_action)return R.p.getters.AllParkingStationOptions;if(this.IsSourceStationBuffer||"load"==this.selected_action||"unload"==this.selected_action)return[...this.BufferStations,...this.EQStations];if("charge"==this.selected_action)return R.p.getters.AllChargeStation;if("carry"==this.selected_action){if(this.IsDeveloper)return this.downstream_options;var e=[new G.Z];Object.assign(e,N.jU.getters.EQData);var t=e.filter((e=>e.Load_Request)),a=t.map((e=>e.Tag)),i=this.BufferStations.map((e=>e.tag));a=[...a,...i];var s=this.downstream_options.filter((e=>a.includes(e.tag)));return s}return"exchange_battery"==this.selected_action?R.p.getters.AllExangeBatteryStation:[]}},mounted(){this.routePath=this.$route.path;const e=(0,i.yj)();(0,s.YP)((()=>e.path),((e,t)=>{e!=this.routePath&&this.HandleCancelBtnClick()}))}},U=a(83744);const B=(0,U.Z)(H,[["render",W],["__scopeId","data-v-ff209120"]]);var q=B;const F=e=>((0,s.dD)("data-v-623ecba4"),e=e(),(0,s.Cn)(),e),z={class:"task-dispatch-new-ui"},j={class:"bg-primary text-light d-flex flex-row"},Z=F((()=>(0,s._)("div",{class:"w-100 title-text"}," 任務派送",-1))),$={class:"page-pnl"},Y=F((()=>(0,s._)("div",{class:"head-text"},"請選擇任務動作",-1))),Q={class:"actions-btn-conatiner"},K=F((()=>(0,s._)("label",null,"移動",-1))),J=[K],X=F((()=>(0,s._)("label",null,"取貨",-1))),ee=[X],te=F((()=>(0,s._)("label",null,"放貨",-1))),ae=[te],ie=F((()=>(0,s._)("label",null,"搬運",-1))),se=[ie],ne=F((()=>(0,s._)("label",null,"充電",-1))),oe=[ne],re={class:"page-pnl"},le=F((()=>(0,s._)("div",{class:"head-text"},"請選擇車輛",-1))),de={class:"actions-btn-conatiner"},ce=["onClick"],ue={class:"page-pnl"},me=F((()=>(0,s._)("div",{class:"head-text"},"請選擇來源設備",-1))),he={class:"station-btn-conatiner"},ge=["onClick"],pe={class:"page-pnl"},_e=F((()=>(0,s._)("div",{class:"head-text"},"請選擇目的地",-1))),we={class:"station-btn-conatiner"},fe=["onClick"],ye={class:"page-pnl"},ve=F((()=>(0,s._)("div",{class:"head-text"},"確認派送任務",-1))),be={class:"actions-btn-conatiner"},Se={class:"order-content"},ke={class:"order-row"},Ce=F((()=>(0,s._)("label",{class:"title"},"動作",-1))),Ae={class:"value"},Te={class:"order-row"},Ve=F((()=>(0,s._)("label",{class:"title"},"車輛",-1))),De={class:"value"},xe={key:0,class:"order-row"},Me=F((()=>(0,s._)("label",{class:"title"},"來源",-1))),We={class:"value"},Ie={class:"order-row"},Ee=F((()=>(0,s._)("label",{class:"title"},"目的地",-1))),Pe={class:"value"},Le={class:"d-flex justify-content-center"},Oe=F((()=>(0,s._)("label",null,"確認派送",-1))),Ne=[Oe],Re=F((()=>(0,s._)("label",null,"取消",-1))),Ge=[Re];function He(e,t,a,i,r,l){const d=(0,s.up)("b-button");return(0,s.wg)(),(0,s.iD)("div",z,[(0,s._)("div",j,[Z,(0,s._)("i",{onClick:t[0]||(t[0]=(...e)=>l.Leave&&l.Leave(...e)),class:"close-btn mx-2 bi bi-x-circle"})]),l.IsShowBackTo?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"back-to-last-step px-2",onClick:t[1]||(t[1]=(...e)=>l.HandleBackToPush&&l.HandleBackToPush(...e))},"返回 ["+(0,n.zw)(l.lastProgressDisplay)+"]",1)):(0,s.kq)("",!0),(0,s.wy)((0,s._)("div",$,[Y,(0,s._)("div",Q,[!l.IsRunMode||l.IsDeveloper?((0,s.wg)(),(0,s.iD)("div",{key:0,onClick:t[2]||(t[2]=e=>l.SelectActionHandle("move")),class:"action"},J)):(0,s.kq)("",!0),!l.IsRunMode||l.IsDeveloper?((0,s.wg)(),(0,s.iD)("div",{key:1,onClick:t[3]||(t[3]=e=>l.SelectActionHandle("unload")),class:"action"},ee)):(0,s.kq)("",!0),!l.IsRunMode||l.IsDeveloper?((0,s.wg)(),(0,s.iD)("div",{key:2,onClick:t[4]||(t[4]=e=>l.SelectActionHandle("load")),class:"action"},ae)):(0,s.kq)("",!0),(0,s._)("div",{onClick:t[5]||(t[5]=e=>l.SelectActionHandle("carry")),class:"action"},se),(0,s._)("div",{onClick:t[6]||(t[6]=e=>l.SelectActionHandle("charge")),class:"action"},oe)])],512),[[o.F8,"select-action"==r.current_progress]]),(0,s.wy)((0,s._)("div",re,[le,(0,s._)("div",de,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.AgvNameList,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.value,onClick:t=>l.SelectAgvHandle(e.value),class:"action"},[(0,s._)("label",null,(0,n.zw)(e.label),1)],8,ce)))),128))])],512),[[o.F8,"select-agv"==r.current_progress]]),(0,s.wy)((0,s._)("div",ue,[me,(0,s._)("div",he,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.eq_stations,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.tag,class:"action",onClick:t=>l.SelectSourceHandle(e)},[(0,s._)("label",null,(0,n.zw)(e.name_display),1)],8,ge)))),128))])],512),[[o.F8,"select-source"==r.current_progress]]),(0,s.wy)((0,s._)("div",pe,[_e,(0,s._)("div",we,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.destine_stations,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.tag,class:"action",onClick:t=>l.SelectDestineHandle(e)},[(0,s._)("label",null,(0,n.zw)(e.name_display),1)],8,fe)))),128))])],512),[[o.F8,"select-destine"==r.current_progress]]),(0,s.wy)((0,s._)("div",ye,[ve,(0,s._)("div",be,[(0,s._)("div",Se,[(0,s._)("div",ke,[Ce,(0,s._)("label",Ae,(0,n.zw)(l.selected_action_display),1),(0,s.Wm)(d,{onClick:t[7]||(t[7]=()=>{r.current_progress="select-action",r.is_reselecting_flag=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})]),(0,s._)("div",Te,[Ve,(0,s._)("label",De,(0,n.zw)(""==r.selected_agv?"自動選車":r.selected_agv),1),(0,s.Wm)(d,{onClick:t[8]||(t[8]=()=>{r.current_progress="select-agv",r.is_reselecting_flag=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})]),"carry"==r.selected_action?((0,s.wg)(),(0,s.iD)("div",xe,[Me,(0,s._)("label",We,(0,n.zw)(r.selected_source.name_display),1),(0,s.Wm)(d,{onClick:t[9]||(t[9]=()=>{r.current_progress="select-source",r.is_reselecting_flag=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})])):(0,s.kq)("",!0),(0,s._)("div",Ie,[Ee,(0,s._)("label",Pe,(0,n.zw)(r.selected_destine.name_display),1),(0,s.Wm)(d,{onClick:t[10]||(t[10]=()=>{r.current_progress="select-destine",r.is_reselecting_flag=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})])]),(0,s._)("div",Le,[(0,s._)("div",{onClick:t[11]||(t[11]=(...e)=>l.HandleConfirmBtnClicked&&l.HandleConfirmBtnClicked(...e)),class:"action bg-primary text-light"},Ne),(0,s._)("div",{onClick:t[12]||(t[12]=e=>l.SelectDestineHandle("EQ_B")),class:"action bg-danger text-light"},Ge)])])],512),[[o.F8,"confirm-task"==r.current_progress]])])}var Ue=a(64491),Be={data(){return{current_progress:"select-action",selected_action:"",selected_agv:"",selected_source:"",selected_destine:"",Cst_ID_Input:"",downstream_stations:[],bypass_eq_status_check:!1,is_reselecting_flag:!1}},methods:{SelectActionHandle(e){this.selected_action=e,this.current_progress="select-agv"},SelectAgvHandle(e){this.selected_agv=e,this.is_reselecting_flag?this.current_progress="confirm-task":"carry"==this.selected_action?this.current_progress="select-source":this.current_progress="select-destine"},SelectSourceHandle(e){this.HandleFromSelectChanged(e.tag).then((t=>{this.selected_source=e,this.current_progress="select-destine"}))},SelectDestineHandle(e){this.selected_destine=e,this.is_reselecting_flag&&this.selected_action,this.current_progress="confirm-task"},HandleBackToPush(){this.is_reselecting_flag=!1,"select-agv"==this.current_progress&&(this.current_progress="select-action"),"select-source"==this.current_progress&&(this.current_progress="select-agv"),"select-destine"==this.current_progress&&("carry"==this.selected_action?this.current_progress="select-source":this.current_progress="select-agv"),"confirm-task"==this.current_progress&&(this.current_progress="select-destine")},async HandleFromSelectChanged(e){this.downstream_stations=[];var t=await(0,Ue.H5)(),a=t.find((t=>t.TagID==e));if(a){var i=a.ValidDownStreamEndPointNames,s=t.filter((e=>i.includes(e.Name)));console.info(s),Object.values(s).forEach((e=>{this.downstream_stations.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}return this.downstream_stations},HandleConfirmBtnClicked(){this.$swal.fire({title:"確定要派送此任務?",text:`${this.selected_agv} 執行 ${this.selected_action_display} 任務,終點:${this.selected_destine.name_display}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.TaskDeliveryHandle()}))},async TaskDeliveryHandle(){this.IsDeveloper?this.bypass_eq_status_check=!0:0==N.HP.getters.level&&(this.bypass_eq_status_check=!1);var e={confirm:!0,message:""},t=this.selected_destine.tag,a=this.selected_source.tag,i=this.selected_agv;if("move"==this.selected_action&&(e=await O.J8.MoveTask(new O.ec(i,t,50))),"measure"==this.selected_action&&(e=await O.J8.MeasureTask(new O.FV(i,t))),"load"==this.selected_action&&(e=await O.J8.LoadTask(new O.Y4(i,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selected_action&&(e=await O.J8.UnloadTask(new O.On(i,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selected_action&&(e=await O.J8.CarryTask(new O.mc(i,a,1,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"exchange_battery"==this.selected_action&&(e=await O.J8.ExangeBatteryTask(new O.Z$(i,t,50,this.bypass_eq_status_check))),"charge"==this.selected_action&&(e=await O.J8.ChargeTask(new O.fn(i,t,50,this.bypass_eq_status_check))),"park"==this.selected_action&&(e=await O.J8.ParkTask(new O.Nn(i,t,50,this.bypass_eq_status_check))),200!=e.status){const t=401==e.status;this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{t&&(N.HP.dispatch("logout",""),I.Z.emit("/show-login-view-invoke"),this.Leave())}))}else e.data.confirm?(E.Z.Success(`任務-[${this.selected_action_display}] 已派送!`,"bottom",2e3),this.Leave()):this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},Leave(){this.$emit("close"),this.is_reselecting_flag=!1,this.current_progress="select-action"}},computed:{IsRunMode(){return N.cy.getters.IsRunMode},IsShowBackTo(){return"select-action"!=this.current_progress},lastProgressDisplay(){var e=this.current_progress;return"select-agv"==e?"選擇動作":"select-source"==e?"選擇AGV":"select-destine"==e?"carry"==this.selected_action?"選擇起點":"選擇AGV":"confirm-task"==e?"選擇目的地":void 0},selected_action_display(){var e=this.selected_action;return"move"==e?"移動":"unload"==e?"取貨":"load"==e?"放貨":"carry"==e?"搬運":"charge"==e?"充電":void 0},IsDeveloper(){return N.HP.getters.IsDeveloperLogining},AgvNameList(){var e=[];function t(e){N.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return this.IsRunMode?(e.push({value:"",label:"自動選車"}),this.IsDeveloper&&t(e)):t(e),e},moveable_stations(){return R.p.getters.AllNormalStationOptions},chargable_tags(){return R.p.getters.AllChargeStation},eq_stations(){return R.p.getters.AllEqStation},destine_stations(){return"move"==this.selected_action?this.moveable_stations:"charge"==this.selected_action?this.chargable_tags:"unload"==this.selected_action||"load"==this.selected_action?this.eq_stations:"carry"==this.selected_action?this.downstream_stations:[]}}};const qe=(0,U.Z)(Be,[["render",He],["__scopeId","data-v-623ecba4"]]);var Fe=qe;const ze={class:"eq-status",ref:"eq-status-container"},je={class:"text-start border-bottom p-2 my-2 d-flex flex-row justify-content-space"},Ze={class:"d-flex"},$e=(0,s._)("div",{class:"p-1"},[(0,s._)("i",{class:"bi bi-three-dots-vertical pt-2"}),(0,s.Uk)("顯示模式 ")],-1),Ye={key:0,class:"legend d-flex flex-row px-2"},Qe=(0,s._)("div",{class:"disconnect"},null,-1),Ke=(0,s._)("span",null,"斷線",-1),Je=(0,s._)("div",{class:"signal-on"},null,-1),Xe=(0,s._)("span",null,"訊號[ON]",-1),et=(0,s._)("div",{class:"signal-off"},null,-1),tt=(0,s._)("span",null,"訊號[OFF]",-1),at=[Qe,Ke,Je,Xe,et,tt],it={class:"hs-signals d-flex"},st=(0,s._)("div",{class:"mx-3"},"交握訊號-EQ",-1),nt=["onClick"],ot=["onClick"],rt=["onClick"],lt=["onClick"],dt=["onClick"],ct={class:"hs-signals d-flex"},ut=(0,s._)("div",{class:"mx-3"},"交握訊號-AGV",-1),mt=["onClick"],ht=["onClick"],gt=["onClick"],pt=["onClick"],_t=["onClick"],wt=["onClick"],ft=["onClick"],yt=["onClick"],vt={key:0,class:"d-flex"},bt=(0,s._)("div",{class:"mx-3"},"模擬器:",-1),St=["onClick"],kt={class:"d-flex"};function Ct(e,t,a,i,o,r){const l=(0,s.up)("el-option"),d=(0,s.up)("el-select"),c=(0,s.up)("el-button"),u=(0,s.up)("el-table-column"),m=(0,s.up)("el-tooltip"),h=(0,s.up)("el-tag"),g=(0,s.up)("el-table");return(0,s.wg)(),(0,s.iD)("div",ze,[(0,s._)("div",je,[(0,s._)("div",Ze,[$e,(0,s.Wm)(d,{style:{width:"120px"},modelValue:o.display_mode,"onUpdate:modelValue":t[0]||(t[0]=e=>o.display_mode=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{label:"設備狀態",value:"lduld_state"}),(0,s.Wm)(l,{label:"IO訊號",value:"io_siganl"})])),_:1},8,["modelValue"])]),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",Ye,at))]),(0,s.Wm)(g,{class:"eq-status-table px-1",border:"","scrollbar-always-on":"",siz:"small",style:(0,n.j5)(r.tableStyle),"header-cell-style":{color:"black",backgroundColor:"white"},data:r.display_data,"row-style":{fontWeight:"bold"},"row-class-name":r.eq_connection_status,"row-key":"EQName"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{type:"expand","max-width":"40"},{default:(0,s.w5)((e=>[(0,s._)("div",it,[st,(0,s._)("div",{class:"di-status",onClick:t=>r.HandleHSsignaleChange(e.row.EQName,"L_REQ",!e.row.HS_EQ_L_REQ),style:(0,n.j5)(r.signalOn(e.row.HS_EQ_L_REQ))},"L_REQ",12,nt),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleHSsignaleChange(e.row.EQName,"U_REQ",!e.row.HS_EQ_U_REQ),style:(0,n.j5)(r.signalOn(e.row.HS_EQ_U_REQ))},"U_REQ",12,ot),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleHSsignaleChange(e.row.EQName,"READY",!e.row.HS_EQ_READY),style:(0,n.j5)(r.signalOn(e.row.HS_EQ_READY))},"READY",12,rt),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleHSsignaleChange(e.row.EQName,"UP_READY",!e.row.HS_EQ_UP_READY),style:(0,n.j5)(r.signalOn(e.row.HS_EQ_UP_READY))},"UP_READY",12,lt),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleHSsignaleChange(e.row.EQName,"LOW_READY",!e.row.HS_EQ_LOW_READY),style:(0,n.j5)(r.signalOn(e.row.HS_EQ_LOW_READY))},"LOW_READY",12,dt),(0,s.kq)("",!0)]),(0,s._)("div",ct,[ut,(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"To_EQ_Up",!e.row.To_EQ_Up),style:(0,n.j5)(r.signalOn(e.row.To_EQ_Up))},"To_EQ_Up",12,mt),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"To_EQ_Low",!e.row.To_EQ_Low),style:(0,n.j5)(r.signalOn(e.row.To_EQ_Low))},"To_EQ_Low",12,ht),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"Cmd_Reserve_Up",!e.row.Cmd_Reserve_Up),style:(0,n.j5)(r.signalOn(e.row.Cmd_Reserve_Up))},"Cmd_Reserve_Up",12,gt),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"Cmd_Reserve_Low",!e.row.Cmd_Reserve_Low),style:(0,n.j5)(r.signalOn(e.row.Cmd_Reserve_Low))},"Cmd_Reserve_Low",12,pt),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"VALID",!e.row.HS_AGV_VALID),style:(0,n.j5)(r.signalOn(e.row.HS_AGV_VALID))},"VALID",12,_t),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"TR_REQ",!e.row.HS_AGV_TR_REQ),style:(0,n.j5)(r.signalOn(e.row.HS_AGV_TR_REQ))},"TR_REQ",12,wt),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"BUSY",!e.row.HS_AGV_BUSY),style:(0,n.j5)(r.signalOn(e.row.HS_AGV_BUSY))},"BUSY",12,ft),(0,s.kq)("",!0),(0,s._)("div",{class:"di-status",onClick:t=>r.HandleAGVHSSignaleChange(e.row.EQName,"COMPT",!e.row.HS_AGV_COMPT),style:(0,n.j5)(r.signalOn(e.row.HS_AGV_COMPT))},"COMPT",12,yt)]),r.IsDeveloperLogining?((0,s.wg)(),(0,s.iD)("div",vt,[bt,(0,s.Wm)(c,{onClick:t=>r.LDULD_Emu_State_Switch(e.row.EQName,"busy")},{default:(0,s.w5)((()=>[(0,s.Uk)("切換為Busy")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:t=>r.LDULD_Emu_State_Switch(e.row.EQName,"load")},{default:(0,s.w5)((()=>[(0,s.Uk)("切換為Load")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:t=>r.LDULD_Emu_State_Switch(e.row.EQName,"unload")},{default:(0,s.w5)((()=>[(0,s.Uk)("切換為Unload")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{type:e.row.IsMaintaining?"success":"danger",onClick:t=>r.MaintainEmulation(e.row,"maintain")},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.row.IsMaintaining?"取消維修":"維修模擬"),1)])),_:2},1032,["type","onClick"]),(0,s.Wm)(c,{type:e.row.IsPartsReplacing?"success":"danger",onClick:t=>r.PartsReplacingEmulation(e.row)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.row.IsPartsReplacing?"取消零件更換":"零件更換模擬"),1)])),_:2},1032,["type","onClick"])])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(u,{sortable:"",label:"設備名稱",prop:"EQName",width:"170"},{default:(0,s.w5)((e=>[(0,s._)("div",null,[(0,s.Uk)((0,n.zw)(e.row.EQName)+" ",1),(0,s.Wm)(m,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,s.w5)((()=>[(0,s._)("i",{onClick:t=>r.CopyText(e.row.EQName),class:"copy-button copy-icon bi bi-clipboard"},null,8,St)])),_:2},1024)])])),_:1}),(0,s.Wm)(u,{sortable:"",label:"Tag",prop:"Tag",width:"60",align:"center"}),r.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:0,align:"center",width:"110",label:"主狀態",prop:"MainStatus"},{default:(0,s.w5)((e=>[(0,s.Wm)(h,{style:{width:"80px"},type:r.GetMainStatusTagtype(e.row.MainStatus,e.row.IsConnected),effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(r.GetMainStatusStr(e.row.MainStatus,e.row.IsConnected)),1)])),_:2},1032,["type"])])),_:1})):(0,s.kq)("",!0),r.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:1,align:"center",width:"110",label:"移載狀態",prop:"TransferStatus"},{default:(0,s.w5)((e=>[(0,s.Wm)(h,{style:{width:"80px"},type:r.GetTransferStatusTagtype(e.row.TransferStatus,e.row.IsConnected),effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(r.GetTransferStatusStr(e.row.TransferStatus,e.row.IsConnected)),1)])),_:2},1032,["type"])])),_:1})):(0,s.kq)("",!0),r.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:2,align:"center",label:"帳籍狀態",prop:"TransferStatus"},{default:(0,s.w5)((e=>[r.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:0,align:"center",label:"帳籍狀態"},{default:(0,s.w5)((e=>[(0,s._)("div",kt,[e.row.Port_Exist?((0,s.wg)(),(0,s.j4)(h,{key:0,class:"mx-1",type:"success",effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)("有貨")])),_:1})):(0,s.kq)("",!0),e.row.Port_Exist?((0,s.wg)(),(0,s.j4)(h,{key:1,class:"mx-1",type:"info",effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)("滿框")])),_:1})):(0,s.kq)("",!0),e.row.Port_Exist?((0,s.wg)(),(0,s.j4)(h,{key:2,class:"mx-1",type:"info",effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)("空框")])),_:1})):(0,s.kq)("",!0),e.row.Port_Exist?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(h,{key:3,class:"mx-1",type:"warning",effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)("無貨")])),_:1}))])])),_:2},1024)):(0,s.kq)("",!0),r.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:1,align:"center",label:"ID"})):(0,s.kq)("",!0)])),_:1})):(0,s.kq)("",!0),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:3,label:"可移入",prop:"Load_Request","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(r.signalOn(e.row.Load_Request))},"可移入",4)])),_:1},8,["min-width"])),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:4,label:"可移出",prop:"Unload_Request","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(r.signalOn(e.row.Unload_Request))},"可移出",4)])),_:1},8,["min-width"])),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:5,label:"貨物在席",prop:"Port_Exist","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(r.signalOn(e.row.Port_Exist))},(0,n.zw)(e.row.Port_Exist?"有貨":"無貨"),5)])),_:1},8,["min-width"])),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:6,label:"Down",prop:"Eqp_Status_Down","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(r.signalOn(e.row.Eqp_Status_Down))},(0,n.zw)(0==e.row.EqType?"Normal":"Down"),5)])),_:1},8,["min-width"])),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:7,label:"Run",prop:"Eqp_Status_Run","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(r.signalOn(e.row.Eqp_Status_Run))},"Run",4)])),_:1},8,["min-width"])),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:8,label:"Idle",prop:"Eqp_Status_Idle","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(r.signalOn(e.row.Eqp_Status_Idle))},"Idle",4)])),_:1},8,["min-width"])),r.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:9,label:"維修",prop:"IsMaintaining","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(r.signalOn(e.row.IsMaintaining,!1,"red"))},"維修",4)])),_:1},8,["min-width"]))])),_:1},8,["style","data","row-class-name"])],512)}a(60487);var At=a(91747),Tt=(a(663),a(29776)),Vt={components:{RegionsSelector:At.Z},data(){return{column_width:103,selected_region:"all",display_mode:"lduld_state",previous_eq_data:[],zoomRatio:1}},computed:{IsDeveloperLogining(){return N.HP.getters.IsDeveloperLogining},display_data(){return"all"==this.selected_region?this.eq_data:this.eq_data.filter((e=>e.Region==this.selected_region))},eq_data(){return N.jU.getters.EQData},show_lduld_state(){return"lduld_state"==this.display_mode},tableStyle(){return this.zoomRatio>.9?{height:.75*window.innerHeight+"px"}:{}}},mounted(){document.getElementsByClassName("di-status");I.Z.on("/map_init_done",(()=>{this.eq_data.forEach((e=>{I.Z.emit("/eq_lduld_status_changed",{tagNumber:e.Tag,status:e.TransferStatus})}))})),document.addEventListener("wheel",(e=>{e.ctrlKey&&(this.zoomRatio=window.devicePixelRatio)}),{passive:!1})},methods:{userStoreTest(){alert(N.HP.getters.IsDeveloperLogining)},eq_connection_status(e,t){var a=e.row.IsConnected;return a?"success-row":"error-row"},signalOn(e,t=!1,a="#00e300"){return e?t?{backgroundColor:"blue"}:{backgroundColor:a}:{backgroundColor:"rgb(204, 204, 204)"}},RegionSelectChanged(e){this.selected_region=e},filterRegionData(e,t,a){console.log(t)},CopyText(e){(0,Tt.O)(e)},LDULD_Emu_State_Switch(e="",t="busy|load|unlod"){Ue.PQ.SetState(e,t)},async MaintainEmulation(e){var t=e.IsMaintaining,a=!t;await Ue.PQ.SwitchMaintainstate(e.Tag,a)},async PartsReplacingEmulation(e){var t=e.IsPartsReplacing,a=!t;await Ue.PQ.SwitchPartsReplacing(e.Tag,a)},EmuAllLoad(){Ue.PQ.EQAllLoad()},EmuAllBusy(){Ue.PQ.EQAllBusy()},HandleHSsignaleChange(e,t,a){this.IsDeveloperLogining&&Ue.PQ.SetEQHsSignal(e,t,a)},HandleAGVHSSignaleChange(e,t,a){this.IsDeveloperLogining&&(0,Ue.Aj)(e,t,a)},GetMainStatusStr(e,t){if(!t)return"斷線";switch(e){case 0:return"當機";case 1:return"生產中";case 2:return"閒置";case 3:return"-";default:return e+""}},GetTransferStatusStr(e,t){if(!t)return"斷線";switch(e){case 0:return"斷線";case 1:return"可收料";case 2:return"可出料";case 3:return"No-Request";default:return e+""}},GetTransferStatusTagtype(e,t){if(!t)return"danger";switch(e){case 0:return"info";case 1:return"warning";case 2:return"success";case 3:return"info";case 4:return"success";default:break}},GetMainStatusTagtype(e,t){if(!t)return"danger";switch(e){case 0:return"danger";case 1:return"success";case 2:return"warning";case 3:return"success";default:break}}}};const Dt=(0,U.Z)(Vt,[["render",Ct]]);var xt=Dt,Mt=a(80207),Wt=a(6755),It=a(65781),Et={components:{AGVStatusVue:p.Z,TaskStatusVue:Mt.Z,HomeMap:_.Z,TaskAllocationVue:Wt.Z,EQStatus:xt,TaskDispathActionButton:q,TaskDispatchNewUI:Fe,MenuExpandIcon:It.tsQ,MenuFoldIcon:It.BAP},methods:{AdjustSizeOfRightSideFullPage(){const e=this.$el.querySelector(".right-panel");var t=e.parentElement.offsetWidth;this.previousLeftSideWidth=t-e.offsetWidth,e.style.width=`${t}px`},RestoreSizeOfRightSide(){this.$el.querySelector(".right-panel");const e=this.$el.querySelector(".left-panel");e.style.width=`${this.previousLeftSideWidth}px`},SavePanlWitdthToLocalStorage(e,t){localStorage.setItem("home-resizer",JSON.stringify({right:e,left:t}))},GetPanlWidthFromLocalStorage(){let e=localStorage.getItem("home-resizer");return e?JSON.parse(e):null}},computed:{IsRunMode(){return N.cy.getters.IsRunMode},IsLogin(){return N.HP.getters.IsLogin}},data(){return{isEasyMode:!1,loading:!1,show_new_dispatch_panel:!1,right_side_tabSelected:"map",MenuExpanded:!0,previousLeftSideWidthStyle:""}},mounted(){I.Z.on("view_mode_changed",(e=>{this.loading=!0,this.isEasyMode=e,setTimeout((()=>{this.loading=!1}),300)}));const e=this.$el.querySelector(".resizer"),t=this.$el.querySelector(".left-panel"),a=this.$el.querySelector(".right-panel");let i=!1;var s=t.parentElement.offsetWidth;t.style.width="50vw",a.style.width="50vw";var n=this;setTimeout((()=>{var e=this.GetPanlWidthFromLocalStorage();console.log(e),e&&(t.style.width=e.left,a.style.width=e.right)}),200),e.addEventListener("mousedown",(e=>{i=!0;let o=e.pageX;const r=e=>{if(!i||!n.MenuExpanded)return;const r=e.pageX-o,l=t.offsetWidth+r;var d=s-l;let c=`${l}px`,u=`${d}px`;t.style.width=c,a.style.width=u,n.previousLeftSideWidth=l,o=e.pageX},l=()=>{i&&setTimeout((()=>{this.SavePanlWitdthToLocalStorage(t.style.width,a.style.width)}),299),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l),i=!1};window.addEventListener("mousemove",r),window.addEventListener("mouseup",l)}))}};const Pt=(0,U.Z)(Et,[["render",g]]);var Lt=Pt;const Ot={class:"data-view custom-tabs-head-large"},Nt={class:"w-100"},Rt={class:"w-100"},Gt={class:"w-100"},Ht={class:"w-100"};function Ut(e,t,a,i,n,o){const r=(0,s.up)("TaskQuery"),l=(0,s.up)("b-tab"),d=(0,s.up)("AlarmQuery"),c=(0,s.up)("AGVLocusDisplay"),u=(0,s.up)("InstrumentMeasureQuery"),m=(0,s.up)("AvalibilityQuery"),h=(0,s.up)("b-tabs");return(0,s.wg)(),(0,s.iD)("div",Ot,[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s.Wm)(l,{title:"歷史任務查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",Nt,[(0,s.Wm)(r)])])),_:1}),(0,s.Wm)(l,{title:"歷史警報查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",Rt,[(0,s.Wm)(d)])])),_:1}),(0,s.Wm)(l,{title:"AGV軌跡查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",Gt,[(0,s.Wm)(c)])])),_:1}),(0,s.Wm)(l,{title:"儀器量測結果查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",Ht,[(0,s.Wm)(u)])])),_:1}),(0,s.Wm)(l,{title:"機台稼動"},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{style:{height:"100vh"}},{default:(0,s.w5)((()=>[(0,s.Wm)(l,{title:"查詢"},{default:(0,s.w5)((()=>[(0,s.Wm)(m)])),_:1})])),_:1})])),_:1})])),_:1})])}const Bt={class:"data-view text-start p-2"},qt=(0,s._)("h3",null,"今日稼動狀態",-1),Ft={class:"bg-light py-3 mx-1 border"};function zt(e,t,a,i,n,o){const r=(0,s.up)("AvailabilityTimelineChart");return(0,s.wg)(),(0,s.iD)("div",Bt,[qt,(0,s._)("div",Ft,[(0,s.Wm)(r,{ref:"rt-availbility-chart"},null,512)])])}var jt=a(43125),Zt=a(51455),$t=a(53658),Yt=a(30381),Qt=a.n(Yt),Kt={components:{AvailabilityPieChart:Zt.Z,AvailabilityTimelineChart:$t.Z},data(){return{data:[2,33,1,2,3],todayData:{},pause:!0,timer:void 0}},mounted(){this.FetchTodayDataAndRender();const e=(0,i.yj)();(0,s.YP)((()=>e.path),((e,t)=>{this.pause="/data"!=e,this.pause?this.StopTimer():this.StartTimer()}))},computed:{todayTimelineChart(){return this.$refs["rt-availbility-chart"]}},methods:{async FetchTodayDataAndRender(){this.todayData=await(0,jt.y)(),this.todayTimelineChart&&this.todayTimelineChart.RenderChart(this.todayData)},StartTimer(){this.FetchTodayDataAndRender()},StopTimer(){this.timer&&clearInterval(this.timer)}}};const Jt=(0,U.Z)(Kt,[["render",zt]]);var Xt=Jt,ea=a(5995),ta=a(8725),aa=a(32988),ia=a(76435),sa=a(79370),na={components:{AvailbilitysData:Xt,AvalibilityQuery:ea["default"],AlarmQuery:ta["default"],AGVLocusDisplay:ia["default"],TaskQuery:aa["default"],InstrumentMeasureQuery:sa["default"]}};const oa=(0,U.Z)(na,[["render",Ut]]);var ra=oa;const la={class:"alarm-view"},da={class:"d-flex flex-row mb-2"},ca=(0,s._)("h3",{class:"flex-fill"},"系統警報",-1),ua=(0,s._)("h3",null,"設備警報",-1);function ma(e,t,a,i,o,r){const l=(0,s.up)("b-button"),d=(0,s.up)("el-table-column"),c=(0,s.up)("el-table"),u=(0,s.up)("el-divider");return(0,s.wg)(),(0,s.iD)("div",la,[(0,s._)("div",da,[ca,r.is_user_login?((0,s.wg)(),(0,s.j4)(l,{key:0,variant:"danger",onClick:t[0]||(t[0]=e=>r.ResetSystemAlarm())},{default:(0,s.w5)((()=>[(0,s.Uk)("警報復歸")])),_:1})):(0,s.kq)("",!0)]),(0,s.Wm)(c,{data:r.sys_alarms,border:"","row-class-name":r.row_state_class_name},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"時間",prop:"Time",width:"160"},{default:(0,s.w5)((e=>[(0,s.Uk)((0,n.zw)(r.formatTime(e.row.Time)),1)])),_:1}),(0,s.Wm)(d,{label:"設備名稱",prop:"Equipment_Name",width:"120"}),(0,s.Wm)(d,{label:"警報碼",prop:"AlarmCode",width:"120"}),(0,s.Wm)(d,{label:"警報描述",prop:"Description_En"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(e.row.Description_En)+"("+(0,n.zw)(e.row.Description_Zh)+")",1)])),_:1}),(0,s.Wm)(d,{label:"警報類型",prop:"Level",width:"120"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(1==e.row.Level?"ALARM":"WARNING"),1)])),_:1}),(0,s.Wm)(d,{label:"任務名稱",prop:"Task_Name",width:"160"}),(0,s.Wm)(d,{label:"發生地點",prop:"OccurLocation",width:"120"}),(0,s.Wm)(d,{label:"持續時間",prop:"Duration",width:"120"}),(0,s.Wm)(d,{label:"清除警報人員",prop:"ResetAalrmMemberName",width:"120"})])),_:1},8,["data","row-class-name"]),(0,s.Wm)(u),ua,(0,s.Wm)(c,{data:r.eq_alarms,border:"","row-class-name":r.row_state_class_name},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"時間",prop:"Time",width:"160"},{default:(0,s.w5)((e=>[(0,s.Uk)((0,n.zw)(r.formatTime(e.row.Time)),1)])),_:1}),(0,s.Wm)(d,{label:"設備名稱",prop:"Equipment_Name",width:"150"}),(0,s.Wm)(d,{label:"警報碼",prop:"AlarmCode",width:"120"}),(0,s.Wm)(d,{label:"警報描述",prop:"Description_En"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(e.row.Description_En)+"("+(0,n.zw)(e.row.Description_Zh)+")",1)])),_:1}),(0,s.Wm)(d,{label:"警報類型",prop:"Level",width:"120"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(1==e.row.Level?"ALARM":"WARNING"),1)])),_:1}),(0,s.Wm)(d,{label:"任務名稱",prop:"Task_Name",width:"160"}),(0,s.Wm)(d,{label:"發生地點",prop:"OccurLocation",width:"120"}),(0,s.Wm)(d,{label:"持續時間",prop:"Duration",width:"120"}),(0,s.Wm)(d,{label:"清除警報人員",prop:"ResetAalrmMemberName",width:"120"})])),_:1},8,["data","row-class-name"])])}var ha=a(61623),ga={data(){return{}},computed:{is_user_login(){return N.HP.getters.IsLogin},sys_alarms(){return this.alarms.filter((e=>0==e.Source))},eq_alarms(){return this.alarms.filter((e=>1==e.Source))},alarms(){return N.qz.getters.alarms}},mounted(){},methods:{ResetSystemAlarm(){(0,ha.gU)()},formatTime(e){return Qt()(e).format("yyyy/MM/DD HH:mm:ss")},row_state_class_name({row:e,rowIndex:t}){return 1==e.Level?"ALARM":"WARNING"}}};const pa=(0,U.Z)(ga,[["render",ma]]);var _a=pa;const wa={class:"charge-station-setup",style:{height:"100%"}},fa={class:"charger-states rounded text-start py-3",style:{height:"80%"}},ya={class:"px-3"},va={class:"d-flex w-100"},ba={class:"state p-3"},Sa=(0,s._)("h5",{class:"title"},"充電樁配置",-1),ka={class:"d-flex w-100"},Ca=(0,s._)("div",{class:"w-100 d-flex"},null,-1),Aa={class:"state p-3"},Ta=(0,s._)("h5",{class:"title"},"狀態",-1),Va={class:"d-flex flex-column w-100"},Da={class:"state mx-2 p-3"},xa=(0,s._)("h5",{class:"title"},"充電曲線參數",-1),Ma={class:"d-flex"},Wa={class:"d-flex"},Ia={class:"d-flex"},Ea={class:"d-flex"},Pa=(0,s._)("h6",null,"充電曲線參考圖示",-1),La=(0,s._)("img",{class:"border rounded p-3",src:"/images/charger_curve.png",alt:""},null,-1),Oa={class:"text-start",style:{"font-size":"14px"}},Na=(0,s._)("span",null,"前次更新時間 : ",-1),Ra={class:"d-flex justify-content-end w-100 border-top py-2"};function Ga(e,t,a,i,o,r){const l=(0,s.up)("el-option"),d=(0,s.up)("el-select"),c=(0,s.up)("el-button"),u=(0,s.up)("el-form-item"),m=(0,s.up)("el-input-number"),h=(0,s.up)("el-form"),g=(0,s.up)("el-tag"),p=(0,s.up)("el-input"),_=(0,s.up)("el-tab-pane"),w=(0,s.up)("el-tabs"),f=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.iD)("div",wa,[(0,s.Wm)(w,{class:"h-100",lazy:"",type:"border-card","tab-position":"top",onTabChange:r.HandleTabChange,modelValue:o.selectedTabName,"onUpdate:modelValue":t[4]||(t[4]=e=>o.selectedTabName=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.charge_station_data,((e,a)=>((0,s.wg)(),(0,s.j4)(_,{class:"h-100",key:a,label:a,name:a},{default:(0,s.w5)((()=>[(0,s._)("div",fa,[(0,s._)("h3",ya,(0,n.zw)(a),1),(0,s._)("div",va,[(0,s._)("div",ba,[Sa,(0,s.Wm)(h,{"label-width":"120","label-position":"left"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{label:"可使用AGV"},{default:(0,s.w5)((()=>[(0,s._)("div",ka,[o.IsModify?((0,s.wg)(),(0,s.j4)(d,{key:1,size:"small",modelValue:o.UsableAGVNamesEdit,"onUpdate:modelValue":t[0]||(t[0]=e=>o.UsableAGVNamesEdit=e),multiple:"",placeholder:"Select",style:{width:"1000px"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.GetAGVName,(e=>((0,s.wg)(),(0,s.j4)(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):((0,s.wg)(),(0,s.j4)(d,{key:0,disabled:!0,size:"small",modelValue:e.UsableAGVNames,"onUpdate:modelValue":t=>e.UsableAGVNames=t,multiple:"",placeholder:"Select",style:{width:"1000px"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.GetAGVName,(e=>((0,s.wg)(),(0,s.j4)(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])),(0,s.Wm)(c,{class:"mx-2",type:o.IsModify?"success":"",size:"large",onClick:()=>{o.IsModify=!o.IsModify,o.IsModify?o.UsableAGVNamesEdit=e.UsableAGVNames:r.SaveUsableAGVSetting(a,o.UsableAGVNamesEdit)}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(o.IsModify?"儲存":"修改"),1)])),_:2},1032,["type","onClick"]),o.IsModify?((0,s.wg)(),(0,s.j4)(c,{key:2,class:"mx-2",type:"danger",size:"large",onClick:t[1]||(t[1]=()=>{o.IsModify=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1})):(0,s.kq)("",!0)])])),_:2},1024),(0,s.Wm)(u,{label:"Tag"},{default:(0,s.w5)((()=>[Ca,o.IsTagNumberModify?((0,s.wg)(),(0,s.j4)(m,{key:1,size:"large",class:"flex-fill",modelValue:o.TagNumberForEdit,"onUpdate:modelValue":t[2]||(t[2]=e=>o.TagNumberForEdit=e)},null,8,["modelValue"])):((0,s.wg)(),(0,s.j4)(m,{key:0,size:"large",class:"flex-fill",modelValue:e.TagNumber,"onUpdate:modelValue":t=>e.TagNumber=t,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])),o.IsTagNumberModify?((0,s.wg)(),(0,s.j4)(c,{key:2,size:"large",class:"mx-2",type:"success",onClick:()=>{o.IsTagNumberModify=!o.IsTagNumberModify,r.ChangeTagNumerOfStation(a,o.TagNumberForEdit)}},{default:(0,s.w5)((()=>[(0,s.Uk)("儲存")])),_:2},1032,["onClick"])):((0,s.wg)(),(0,s.j4)(c,{key:3,size:"large",class:"mx-2",onClick:()=>{o.IsTagNumberModify=!o.IsTagNumberModify,o.TagNumberForEdit=e.TagNumber}},{default:(0,s.w5)((()=>[(0,s.Uk)("修改")])),_:2},1032,["onClick"])),o.IsTagNumberModify?((0,s.wg)(),(0,s.j4)(c,{key:4,size:"large",class:"mx-2",type:"danger",onClick:t[3]||(t[3]=()=>{o.IsTagNumberModify=!o.IsTagNumberModify})},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1})):(0,s.kq)("",!0)])),_:2},1024)])),_:2},1024)]),(0,s._)("div",Aa,[Ta,(0,s.Wm)(h,{"label-width":"120","label-position":"left"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{label:"通訊狀態"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{effect:"dark",type:e.Connected?"success":"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Connected?"正常":"斷線"),1)])),_:2},1032,["type"])])),_:2},1024),e.IsUsing?((0,s.wg)(),(0,s.j4)(u,{key:0,label:"運轉狀態"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{effect:"dark",type:r.GetTagType(e)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Connected?0==e.ErrorCodes.length?"Normal":"Warning":"Disconnect"),1)])),_:2},1032,["type"])])),_:2},1024)):((0,s.wg)(),(0,s.j4)(u,{key:1,label:"運轉狀態"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{effect:"dark",type:"warning"},{default:(0,s.w5)((()=>[(0,s.Uk)("閒置中")])),_:1})])),_:1})),(0,s.kq)("",!0),(0,s.Wm)(u,{label:"輸入電壓"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Vin)+" V",1)])),_:2},1024)])),_:2},1024),(0,s.Wm)(u,{label:"輸出電壓"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Vout)+" V",1)])),_:2},1024)])),_:2},1024),(0,s.Wm)(u,{label:"輸出電流"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Iout)+" A",1)])),_:2},1024)])),_:2},1024),(0,s.Wm)(u,{label:"充電器溫度"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Temperature)+" °C",1)])),_:2},1024)])),_:2},1024),(0,s.Wm)(u,{label:"異常"},{default:(0,s.w5)((()=>[(0,s._)("div",Va,[0==e.ErrorCodesDescrptions.length?((0,s.wg)(),(0,s.j4)(g,{key:0,type:"success"},{default:(0,s.w5)((()=>[(0,s.Uk)("尚無異常")])),_:1})):((0,s.wg)(!0),(0,s.iD)(s.HY,{key:1},(0,s.Ko)(e.ErrorCodesDescrptions,(e=>((0,s.wg)(),(0,s.j4)(g,{effect:"dark",class:"w-100",key:e,type:"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e),1)])),_:2},1024)))),128))])])),_:2},1024)])),_:2},1024)]),(0,s._)("div",Da,[xa,(0,s.Wm)(h,{"label-width":"70","label-position":"left"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{label:"CC"},{default:(0,s.w5)((()=>[(0,s._)("div",Ma,[(0,s.Wm)(p,{precision:2,disabled:"",modelValue:e.CC,"onUpdate:modelValue":t=>e.CC=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(c,{disabled:!r.IsLogin,onClick:t=>r.HandleSettingBtnClick(a,"cc",e.CC)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,s.Wm)(u,{label:"CV"},{default:(0,s.w5)((()=>[(0,s._)("div",Wa,[(0,s.Wm)(p,{precision:2,disabled:"",modelValue:e.CV,"onUpdate:modelValue":t=>e.CV=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(c,{disabled:!r.IsLogin,onClick:t=>r.HandleSettingBtnClick(a,"cv",e.CV)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,s.Wm)(u,{label:"FV"},{default:(0,s.w5)((()=>[(0,s._)("div",Ia,[(0,s.Wm)(p,{precision:2,disabled:"",modelValue:e.FV,"onUpdate:modelValue":t=>e.FV=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(c,{disabled:!r.IsLogin,onClick:t=>r.HandleSettingBtnClick(a,"fv",e.FV)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,s.Wm)(u,{label:"TC"},{default:(0,s.w5)((()=>[(0,s._)("div",Ea,[(0,s.Wm)(p,{precision:2,disabled:"",modelValue:e.TC,"onUpdate:modelValue":t=>e.TC=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(c,{disabled:!r.IsLogin,onClick:t=>r.HandleSettingBtnClick(a,"tc",e.TC)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024)])),_:2},1024),Pa,La])])]),(0,s._)("div",Oa,[Na,(0,s.Uk)(" "+(0,n.zw)(r.FormatTime(e.Time)),1)])])),_:2},1032,["label","name"])))),128))])),_:1},8,["onTabChange","modelValue"]),(0,s.Wm)(f,{draggable:"",title:`${o.DialogData.EqName}-${o.DialogData.Item.toUpperCase()} 設定`,width:"300px",modelValue:o.SettingDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>o.SettingDialogVisible=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{class:"border-top py-2","label-width":"60px"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{label:o.DialogData.Item.toUpperCase()},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{step:.1,precision:2,modelValue:o.DialogData.Value,"onUpdate:modelValue":t[5]||(t[5]=e=>o.DialogData.Value=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,s._)("div",Ra,[(0,s.Wm)(c,{type:"success",onClick:r.HandleConfirmClick},{default:(0,s.w5)((()=>[(0,s.Uk)("確定")])),_:1},8,["onClick"]),(0,s.Wm)(c,{type:"danger",onClick:t[6]||(t[6]=e=>o.SettingDialogVisible=!1)},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1})])])),_:1},8,["title","modelValue"])])}var Ha={computed:{charge_station_data(){return N.jU.getters.ChargeStationData},IsLogin(){return N.HP.getters.IsLogin},GetAGVName(){return N.sn.getters.AGVNameList}},data(){return{select:1,selectedTabName:"",previousSelectedTabName:"",SettingDialogVisible:!1,DialogData:{EqName:"",Item:"CC",Value:33,UsableAGVNames:[]},UsableAGVNamesEdit:[],IsModify:!1,IsTagNumberModify:!1,TagNumberForEdit:0}},mounted(){setTimeout((()=>{this.selectedTabName=this.previousSelectedTabName=Object.keys(this.charge_station_data)[0]}),1e3)},methods:{HandleTabChange(e){if(this.previousSelectedTabName!=e&&this.IsModify){var t=this.charge_station_data[this.previousSelectedTabName].UsableAGVNames,a=JSON.stringify(this.UsableAGVNamesEdit)!=JSON.stringify(t);a?this.$swal.fire({text:"",title:`${this.previousSelectedTabName} 可用車輛設定尚未儲存，確定要離開嗎?`,icon:"warning",showCancelButton:!1,confirmButtonText:"OK",cancelButtonText:"返回",showCancelButton:!0,customClass:"my-sweetalert"}).then((t=>{if(!t.isConfirmed)return this.selectedTabName=this.previousSelectedTabName,void(this.IsModify=!0);this.IsModify=!1,this.previousSelectedTabName=e})):(this.IsModify=!1,this.previousSelectedTabName=e)}else this.previousSelectedTabName!=e&&(this.IsModify=!1,this.previousSelectedTabName=e);this.IsTagNumberModify=!1},GetTagType(e){return e.Connected?0==e.ErrorCodes.length?"success":"warning":"danger"},FormatTime(e){return Qt()(e).format("yyyy/MM/DD HH:mm:ss")},HandleSettingBtnClick(e,t,a){this.DialogData.EqName=e,this.DialogData.Item=t,this.DialogData.Value=a,this.SettingDialogVisible=!0},HandleConfirmClick(){this.SettingDialogVisible=!1,this.$swal.fire({text:"",title:`確定要將${this.DialogData.EqName} ${this.DialogData.Item.toUpperCase()} 更改為 ${this.DialogData.Value} ?`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=await Ue.yS.SetCurveSetting(this.DialogData.EqName,this.DialogData.Item,this.DialogData.Value),a=t.confirm?"success":"error";this.$swal.fire({text:t.confirm?"":t.message,title:t.confirm?"修改成功":"修改失敗",icon:a,showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert",timer:t.confirm?3e3:-1}).then((e=>{t.confirm||(this.SettingDialogVisible=!0)}))}else this.SettingDialogVisible=!0}))},async SaveUsableAGVSetting(e,t){var a=await Ue.yS.SaveUsableAGVSetting(e,t);a.confirm?this.$swal.fire({title:`${e} 可用車輛設定已儲存!`,icon:"info",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):this.$swal.fire({text:a.message,title:`${e} 可用車輛設定失敗!`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async ChangeTagNumerOfStation(e="",t=-1){var a=await Ue.yS.ModifyTagNumber(e,t);a.confirm?this.$swal.fire({title:`${e} Tag 設定成功!`,icon:"info",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):(this.IsTagNumberModify=!0,this.$swal.fire({text:a.message,title:`${e} Tag 設定失敗!`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}))}}};const Ua=(0,U.Z)(Ha,[["render",Ga]]);var Ba=Ua;const qa=[{path:"/",name:"home",component:Lt},{path:"/OP",name:"OP",component:()=>a.e(955).then(a.bind(a,93955))},{path:"/maptest",name:"maptest",component:()=>Promise.resolve().then(a.bind(a,91475)),meta:{isAdminUse:!0}},{path:"/map",name:"map",children:[{path:"map_editor",name:"map_editor",component:()=>a.e(214).then(a.bind(a,14214))},{path:"agv_display",name:"agv_display",component:()=>a.e(373).then(a.bind(a,59373))}],meta:{isAdminUse:!0}},{path:"/racks_status",name:"racks_status",component:()=>a.e(547).then(a.bind(a,38547))},{path:"/vehicle",name:"vehicle",component:()=>a.e(888).then(a.bind(a,21888))},{path:"/sys_settings",name:"sys_settings",children:[{path:"AGV_Battery_Setting",name:"AGV_Battery_Setting",component:()=>a.e(215).then(a.bind(a,42215))},{path:"Equipment_Setting",name:"Equipment_Setting",component:()=>a.e(670).then(a.bind(a,45670))},{path:"RacksManagement",name:"RacksManagement",component:()=>a.e(416).then(a.bind(a,69416))},{path:"User_Setting",name:"User_Setting",component:()=>a.e(677).then(a.bind(a,84677))},{path:"Charge_Station_Setting",name:"Charge_Station_Setting",component:Ba}],meta:{isAdminUse:!0}},{path:"/data",name:"data",children:[{path:"task_history",name:"task_history",component:()=>Promise.resolve().then(a.bind(a,32988))},{path:"alarm_history",name:"alarm_history",component:()=>Promise.resolve().then(a.bind(a,8725))},{path:"agv_locus",name:"agv_locus",component:()=>Promise.resolve().then(a.bind(a,76435))},{path:"InstrumentMeasureQuery",name:"InstrumentMeasureQuery",component:()=>Promise.resolve().then(a.bind(a,79370))},{path:"Avalibility",name:"Avalibility",component:()=>Promise.resolve().then(a.bind(a,5995))}]},{path:"/alarm",name:"alarm",component:_a},{path:"/playground",name:"dev_ui",component:()=>a.e(646).then(a.bind(a,15646))},{path:"/hotrun",name:"hotrun",component:()=>a.e(330).then(a.bind(a,41330))}],Fa=[{path:"/",name:"home",component:()=>a.e(726).then(a.bind(a,41726)),children:[{path:"/",name:"/",component:()=>a.e(943).then(a.bind(a,27943)),meta:{Display:"車輛狀態與任務"}},{path:"BirdView",name:"BirdView",component:()=>a.e(705).then(a.bind(a,55705)),meta:{Display:"Bird View"}},{path:"AGVLocus",name:"AGVLocus",component:()=>Promise.resolve().then(a.bind(a,76435)),meta:{Display:"AGV軌跡"}}]},{path:"/map",name:"map",component:()=>a.e(214).then(a.bind(a,14214))},{path:"/alarm",name:"alarm",component:_a},{path:"/data",name:"data",component:ra}],za=(0,i.p7)({history:(0,i.PO)(),routes:qa});var ja=za},24239:function(e,t,a){"use strict";a.d(t,{HP:function(){return m},Ys:function(){return p},cy:function(){return u},g4:function(){return h},jU:function(){return g},qz:function(){return _},sn:function(){return c}});var i=a(33907),s=a(82106),n=(a(83592),a(56938)),o=a(663),r=a(9669),l=a.n(r),d={agvStates:"agv_states"};t.ZP=(0,i.MT)({state:{websiteSetting:{FieldName:"UMTC"}},getters:{GetWebsiteSetting:e=>e.websiteSetting,FieldName:e=>e.websiteSetting.FieldName,APPVersion:e=>e.websiteSetting.APPVersion},mutations:{setAgvsystemConfigs(e,t){e.websiteSetting=t}},actions:{async GetDynamicWebsiteData({commit:e},t){var a=await l().get(`${o.Z.backend_host}/api/system/website`);return e("setAgvsystemConfigs",a.data),a.data}}});const c=(0,i.MT)({state:{agv_states:void 0,hotrun_states:[]},getters:{AGVStatesData:e=>{if(e.agv_states)return e.agv_states;var t=localStorage.getItem(d.agvStates);if(null!=t){var a=JSON.parse(t);return a}return[new n.Z]},AGVNameList:e=>e.agv_states?e.agv_states.map((e=>e.AGV_Name)):[],HotRunStates:e=>e.hotrun_states,VehicleSize:e=>t=>{if(!e.agv_states)return[0,0];var a=e.agv_states.find((e=>e.AGV_Name==t));return a?[a.VehicleLength,a.VehicleWidth]:[0,0]}},mutations:{storeAgvStates(e,t){e.agv_states=t,t.length>0&&localStorage.setItem(d.agvStates,JSON.stringify(t))},setHotRunStates(e,t){e.hotrun_states=t}}}),u=(0,i.MT)({state:{sys_settings:{operations:{system_run_mode:!1,host_online_mode:!1,host_remote_mode:!1,transfer_mode:!1}}},mutations:{setOperations(e,t){e.sys_settings.operations=t},setRunMode(e,t){e.sys_settings.operations.system_run_mode=t},setHostOnline(e,t){e.sys_settings.operations.host_online_mode=t},setHostRemote(e,t){e.sys_settings.operations.host_remote_mode=t},setTransferRemote(e,t){e.sys_settings.operations.transfer_mode=t}},actions:{},getters:{IsRunMode:e=>e.sys_settings.operations.system_run_mode}}),m=(0,i.MT)({state:{user:null,current_route:"",web_user_id:""},mutations:{setUser(e,t){e.user=t,t?(0,s.FU)(t):localStorage.removeItem("user")},setUserID(e,t){e.web_user_id=t,console.log(t)},setRoute(e,t){e.current_route=t,console.log(t)}},actions:{async login({commit:e},t){var a=await(0,s.m3)(t);return a.Success?e("setUser",a):e("setUser",null),console.log(a),{confirm:a.Success,message:a.Message}},logout({commit:e}){e("setUser",null)},async user_route_change({commit:e,state:t},a){e("setRoute",a);var i=await(0,s.hB)(t.web_user_id,a);return i}},getters:{IsLogin:e=>null!=e.user,level:e=>e.user?e.user.Role:-1,UserName:e=>e.user?e.user.UserName:"",IsDeveloperLogining:e=>null!=e.user&&(2==e.user.Role||3==e.user.Role),WebUserID:e=>e.web_user_id}}),h=(0,i.MT)({state:{locus:{},EqpAlarmShowState:!1,SystemAlarmShowState:!1,VMSAliveState:!1},mutations:{IsSystemAlarmShowing(e,t){e.SystemAlarmShowState=t},IsEqpAlarmShowing(e,t){e.EqpAlarmShowState=t},SetVMSAlive(e,t){e.VMSAliveState=t}},getters:{SystemAlarmShowState:e=>e.SystemAlarmShowState,EqpAlarmShowState:e=>e.EqpAlarmShowState,VMSAlive:e=>e.VMSAliveState}}),g=(0,i.MT)({state:{EQ:[],ChargeStation:{charge1:{}},EqOptions:[],WIPOptions:[],WIPsData:[]},getters:{EQData:e=>e.EQ,ChargeStationData:e=>e.ChargeStation,EqOptions:e=>e.EqOptions,WIPData:e=>e.WIPsData,GetRowsByStationTag:e=>e=>3},mutations:{setData(e,t){e.EQ=t.EQPData,e.ChargeStation=t.ChargeStationData,e.WIPsData=t.WIPsData},EqOptions(e,t){e.EqOptions=t},WIPOptions(e,t){e.WIPOptions=t}},actions:{}}),p=(0,i.MT)({state:{IncompletedTaskListData:[],CompletedTaskListData:[]},getters:{IncompletedTaskList:e=>e.IncompletedTaskListData,CompletedTaskList:e=>e.CompletedTaskListData},mutations:{StoreTaskData(e,t){e.CompletedTaskListData=t.completeds,e.IncompletedTaskListData=t.incompleteds}}}),_=(0,i.MT)({state:{alarmsCollection:[]},getters:{alarms:e=>e.alarmsCollection},mutations:{StoreAlarmData(e,t){e.alarmsCollection=t}}})},764:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var i=a(66252);function s(e,t,a,s,n,o){const r=(0,i.up)("el-option"),l=(0,i.up)("el-select");return(0,i.wg)(),(0,i.j4)(l,{modelValue:n.selected,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selected=e),onChange:o.HandleSelectChanged},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.agvNameList,(e=>((0,i.wg)(),(0,i.j4)(r,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])}var n=a(24239),o={props:{default:{type:String}},data(){return{selected:this.value}},methods:{HandleSelectChanged(){}},computed:{agvNameList(){return n.sn.getters.AGVNameList}},mounted(){this.selected=this.default}},r=a(83744);const l=(0,r.Z)(o,[["render",s]]);var d=l},51455:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var i=a(66252);const s={class:"border rounded",style:{height:"600px",width:"95%",display:"flex","flex-direction":"column"}};function n(e,t,a,n,o,r){const l=(0,i.up)("vue3-chart-js");return(0,i.wg)(),(0,i.iD)("div",s,[((0,i.wg)(),(0,i.j4)(l,{key:o.myChart.type,ref:"chartRef",id:o.myChart.id,type:o.myChart.type,data:o.myChart.data,options:o.myChart.options,onBeforeRender:r.beforeRenderLogic},null,8,["id","type","data","options","onBeforeRender"]))])}var o=a(67361),r={components:{Vue3ChartJs:o.Z},props:{ava_datas:{type:Array,default(){return[1,1,1,1,1]}},colorSet:{type:Array,default(){return["rgb(2, 176, 8)","rgb(255, 226, 6)","rgb(255, 92, 92)","rgb(51, 207, 255)","rgb(186, 186, 186)"]}}},data(){return{myChart:{id:"pie",type:"pie",data:{labels:["RUN","IDLE","DOWN","CHARGE","UNKNOWN","UNKNOWN"],datasets:[{backgroundColor:this.colorSet,data:[0,0,0,0,0]}]},options:{responsive:!0,maintainAspectRatio:!1,animations:{tension:{duration:1e3,easing:"linear",from:1,to:0,loop:!0}},scales:{},plugins:{legend:{position:"top"},title:{display:!0,text:"統計資料"}}}}}},methods:{beforeRenderLogic(e){},updateChart(e){this.myChart.type="pie",this.myChart.options.scales=void 0,this.myChart.data.datasets[0].data=e,this.$refs.chartRef.update()},updateStackBarChart(e={dates:[],idle:[],run:[],down:[],charge:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"IDLE",data:e.idle,backgroundColor:this.colorSet[1],stack:"Stack 1"},{label:"RUN",data:e.run,backgroundColor:this.colorSet[0],stack:"Stack 1"},{label:"DOWN",data:e.down,backgroundColor:this.colorSet[2],stack:"Stack 1"},{label:"CHARGE",data:e.charge,backgroundColor:this.colorSet[3],stack:"Stack 1"}];try{this.$refs.chartRef.update()}catch(t){}},updateStackBarChartmttr(e={dates:[],time:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"MTTR",data:e.time,backgroundColor:this.colorSet[1]}];try{this.$refs.chartRef.update()}catch(t){}},updateStackBarChartmtbf(e={dates:[],time:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"MTBF",data:e.time,backgroundColor:this.colorSet[1]}];try{this.$refs.chartRef.update()}catch(t){}},updateStackBarChartMissTags(e={dates:[],count:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"MissTagsCount",data:e.count,backgroundColor:this.colorSet[1]}];try{this.$refs.chartRef.update()}catch(t){}}},mounted(){(0,i.YP)((()=>this.ava_datas),((e,t)=>{this.updateChart(e)}),{deep:!0})}},l=a(83744);const d=(0,l.Z)(r,[["render",n]]);var c=d},53658:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var i=a(66252);const s={class:"w-100 rounded"};function n(e,t,a,n,o,r){const l=(0,i.up)("apexchart"),d=(0,i.Q2)("loading");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(l,{ref:"bat_chart",height:r.chartHeight,options:o.chart_datas.chartOptions,series:o.chart_datas.series},null,8,["height","options","series"])])),[[d,o.loading]])}var o=a(96486),r=a.n(o),l={components:{},props:{id:{type:String,default:"a"},title:{type:String,default:"title"}},computed:{chartHeight(){return.8*window.innerHeight+"px"}},data(){return{loading:!1,myChart:void 0,chart_datas:{series:[{name:"Desktops",data:[10,41]}],chartOptions:{chart:{type:"line",zoom:{enabled:!0},animations:{enabled:!0}},dataLabels:{enabled:!1},legend:{show:!0,position:"top"},title:{text:"電量",align:"center"},xaxis:{type:"datetime",tickAmount:3,labels:{format:"yy-MM-dd",style:{fontSize:"16px"}},title:{text:"時間",style:{fontSize:"16px"}},axisBorder:{show:!0}},yaxis:[{labels:{formatter:function(e){return(e/60/60).toFixed(2)},style:{fontSize:"16px"}},title:{text:"MTTR(小時)",style:{fontSize:"16px"}},axisBorder:{show:!0}},{opposite:!0,labels:{formatter:function(e){return(e/60/60).toFixed(2)},style:{fontSize:"16px"}},title:{text:"MTBF(小時)",style:{fontSize:"16px"}},axisBorder:{show:!0}}],tooltip:{enabled:!0}}}}},methods:{RenderChartWithTimeSeriesData(e){let t=JSON.parse(JSON.stringify(e));this.debounceChartUpdate(t)},debounceChartUpdate:r().debounce((function(e){this.$refs["bat_chart"].updateSeries(e)}),300)},mounted(){this.chart_datas.chartOptions.title.text=this.title}},d=a(83744);const c=(0,d.Z)(l,[["render",n]]);var u=c},76435:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var i=a(66252),s=a(3577);const n=e=>((0,i.dD)("data-v-4893f878"),e=e(),(0,i.Cn)(),e),o={class:"agv-locus border rounded"},r={class:"w-100 d-flex"},l={class:"menu-container bg-light p-2 border"},d={class:"border-bottom my-1 py-2"},c={class:"time-pick text-start d-flex"},u=n((()=>(0,i._)("div",{class:"label"},"車輛選擇",-1))),m=n((()=>(0,i._)("div",{class:"label"},"開始時間",-1))),h=n((()=>(0,i._)("div",{class:"label"},"結束時間",-1))),g=["onClick"],p=n((()=>(0,i._)("i",{class:"view-icon bi bi-eye-fill"},null,-1))),_=[p],w={class:"bg-light border flex-fill"},f={class:"locus-settings bg-dark text-light d-flex py-1 px-3"},y=n((()=>(0,i._)("span",null,"軌跡顏色",-1))),v=n((()=>(0,i._)("span",null,"軌跡寬度",-1))),b={class:"flex-fill text-end"};function S(e,t,a,n,p,S){const k=(0,i.up)("AGVSelector"),C=(0,i.up)("el-date-picker"),A=(0,i.up)("el-button"),T=(0,i.up)("el-table-column"),V=(0,i.up)("el-tag"),D=(0,i.up)("el-table"),x=(0,i.up)("el-color-picker"),M=(0,i.up)("el-option"),W=(0,i.up)("el-select"),I=(0,i.up)("Map"),E=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",r,[(0,i._)("div",l,[(0,i._)("div",d,[(0,i._)("div",c,[(0,i._)("div",null,[u,(0,i.Wm)(k,{modelValue:p.agvname,"onUpdate:modelValue":t[0]||(t[0]=e=>p.agvname=e)},null,8,["modelValue"])]),(0,i._)("div",null,[m,(0,i.Wm)(C,{modelValue:p.timePick.start_time,"onUpdate:modelValue":t[1]||(t[1]=e=>p.timePick.start_time=e),type:"datetime",placeholder:"選擇開始時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,i._)("div",null,[h,(0,i.Wm)(C,{modelValue:p.timePick.end_time,"onUpdate:modelValue":t[2]||(t[2]=e=>p.timePick.end_time=e),type:"datetime",placeholder:"選擇結束時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,i.Wm)(A,{onClick:S.HandleSearchBtnClicked,style:{height:"30px","font-size":"large",width:"120px",position:"relative",top:"16px"},class:"my-2",type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("搜尋")])),_:1},8,["onClick"])])]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(D,{data:p.tableData,style:{width:"720px"},height:"700","highlight-current-row":"",size:"small"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{align:"center",label:"No",width:"50"},{default:(0,i.w5)((e=>[(0,i._)("div",null,(0,s.zw)(S.GetNo(e.row)),1)])),_:1}),(0,i.Wm)(T,{label:"Task ID",prop:"task_id"}),(0,i.Wm)(T,{label:"開始時間",prop:"start_time"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(S.FormatTime(e.row.start_time)),1)])),_:1}),(0,i.Wm)(T,{label:"結束時間",prop:"end_time"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(S.FormatTime(e.row.end_time)),1)])),_:1}),(0,i.Wm)(T,{align:"center",label:"花費時間(秒)",prop:"duration","min-width":"60"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Wm)(V,{effect:"dark",type:"info"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(S.CalculatTimeSpend(e.row)),1)])),_:2},1024)])])),_:1}),(0,i.Wm)(T,{align:"center",label:"顯示軌跡","min-width":"50"},{default:(0,i.w5)((e=>[(0,i._)("div",{class:"w-100",onClick:t=>S.ShowLocusHandler(e.row)},_,8,g)])),_:1})])),_:1},8,["data"])),[[E,p.loading]])]),(0,i._)("div",w,[(0,i._)("div",f,[(0,i._)("div",null,[y,(0,i.Wm)(x,{onChange:S.HandleLocusSettingChange,modelValue:p.locus_settings.color,"onUpdate:modelValue":t[3]||(t[3]=e=>p.locus_settings.color=e)},null,8,["onChange","modelValue"])]),(0,i._)("div",null,[v,(0,i.Wm)(W,{modelValue:p.locus_settings.width,"onUpdate:modelValue":t[4]||(t[4]=e=>p.locus_settings.width=e),onChange:S.HandleLocusSettingChange},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)(12,(e=>(0,i.Wm)(M,{key:e,value:e},null,8,["value"]))),64))])),_:1},8,["modelValue","onChange"])]),(0,i._)("div",b,[(0,i.Wm)(A,{type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("儲存軌跡圖")])),_:1})])]),(0,i.wy)((0,i.Wm)(I,{class:"bg-light border",ref:"map",id:"locus_map",editable:!1,agv_show:!1,station_show:!0},null,512),[[E,p.locus_painting]])])])])}var k=a(764),C=a(91475),A=a(20840),T=a(24239),V=a(95320),D=a(30381),x=a.n(D),M={components:{Map:C["default"],AGVSelector:k.Z},computed:{agvNameList(){return T.sn.getters.AGVNameList},map_station_data(){return V.p.getters.MapStations}},data(){return{tableData:[{task_id:"",start_time:"2023-08-03 12:00:00",end_time:"2023-08-03 12:10:00",duration:600,corrdinations:[[0,0],[-1.2,2.2],[-1.3,2.3],[-1.4,3]]}],agvname:"AGV_001",timePick:{start_time:"2023-08-03 12:00:00",end_time:"2023-08-04 12:00:00"},locus_settings:{color:"red",width:1},showing_row_data:{},loading:!1,locus_painting:!1}},methods:{SetDefaultTimeInterval(){},GetNo(e){return this.tableData.indexOf(e)+1},async ShowLocusHandler(e){try{this.locus_painting=!0,setTimeout((async()=>{if(void 0==e.corrdinations){var t=await(0,A.c6)(e.task_id);t&&(e.corrdinations=t.coordinations.map((e=>[e.X,e.Y])),this.showing_row_data=e)}this.$refs.map.ShowLocus(e.corrdinations,this.locus_settings.color,this.locus_settings.width),this.locus_painting=!1}),300)}catch(t){this.$swal.fire({text:t.response.data,title:"後端服務異常",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},FormatTime(e){return x()(e).format("YYYY/MM/DD HH:mm:ss")},HandleLocusSettingChange(){this.$refs.map.ShowLocus(this.showing_row_data.corrdinations,this.locus_settings.color,this.locus_settings.width)},async HandleSearchBtnClicked(){if(this.SaveLocusSettingsToLocalStroage(),""!=this.agvname){var e=x()(this.timePick.start_time).format("YYYY/MM/DD HH:mm:ss"),t=x()(this.timePick.end_time).format("YYYY/MM/DD HH:mm:ss"),a=[];this.loading=!0,setTimeout((async()=>{a=await(0,A.tQ)(e,t,this.agvname),this.tableData=a.map((e=>({task_id:e.TaskName,start_time:e.RecieveTime,end_time:e.FinishTime,duration:0,corrdinations:void 0}))),this.loading=!1}),200)}else this.$swal.fire({text:"",title:"請選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},SaveLocusSettingsToLocalStroage(){localStorage.setItem("locus",JSON.stringify({locus_paint:this.locus_settings,time:this.timePick}))},ReloadLocusSettingsFromLocalStorage(){var e=localStorage.getItem("locus");if(e){var t=JSON.parse(e);t.locus_paint&&(this.locus_settings=t.locus_paint),t.time?this.timePick=t.time:this.timePick.start_time=this.timePick.end_time=x()(Date.now()).format("YYYY-MM-DD HH:mm:ss")}},CalculatTimeSpend(e){return x()(e.end_time).unix()-x()(e.start_time).unix()}},mounted(){this.SetDefaultTimeInterval(),this.ReloadLocusSettingsFromLocalStorage(),this.tableData=[]}},W=a(83744);const I=(0,W.Z)(M,[["render",S],["__scopeId","data-v-4893f878"]]);var E=I},8725:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return L}});var i=a(66252),s=a(49963),n=a(3577);const o={class:"alarm-query"},r={class:"query-options bg-light d-flex border-bottom w-100 py-2"},l=(0,i._)("label",null,"Start Time",-1),d=(0,i._)("label",null,"End Time",-1),c=(0,i._)("label",null,"警報類型",-1),u=(0,i._)("option",null,"ALL",-1),m=(0,i._)("option",{class:"bg-danger text-light"},"Alarm",-1),h=(0,i._)("option",{class:"bg-warning text-light"},"Warning",-1),g=[u,m,h],p=(0,i._)("label",null,"EQ Name",-1),_=(0,i._)("option",null,"ALL",-1),w=(0,i._)("label",null,"任務名稱",-1),f=["onClick"],y={key:0},v=["href"],b={class:"d-flex flex-row justify-content-center"},S={class:"mx-3 py-2"},k={style:{"font-weight":"bold","font-size":"large"}};function C(e,t,a,u,m,h){const C=(0,i.up)("b-button"),A=(0,i.up)("el-table-column"),T=(0,i.up)("el-tag"),V=(0,i.up)("el-tooltip"),D=(0,i.up)("el-table"),x=(0,i.up)("b-pagination");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",r,[l,(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>m.start_time=e),prop:"Start Time"},null,512),[[s.nr,m.start_time]]),d,(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>m.end_time=e),prop:"End Time"},null,512),[[s.nr,m.end_time]]),c,(0,i.wy)((0,i._)("select",{class:(0,n.C_)("ALL"==m.AlarmTypeSelected?"":"Alarm"==m.AlarmTypeSelected?"bg-danger text-light":"bg-warning text-light"),prop:"EQ Name","onUpdate:modelValue":t[2]||(t[2]=e=>m.AlarmTypeSelected=e)},g,2),[[s.bM,m.AlarmTypeSelected]]),p,(0,i.wy)((0,i._)("select",{prop:"EQ Name","onUpdate:modelValue":t[3]||(t[3]=e=>m.AGVSelected=e)},[_,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.AgvNameList,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e},(0,n.zw)(e),1)))),128))],512),[[s.bM,m.AGVSelected]]),w,(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>m.TaskName=e),placeholder:"ALL",size:"20"},null,512),[[s.nr,m.TaskName]]),(0,i.Wm)(C,{onClick:t[5]||(t[5]=e=>h.QueryAlarm()),QueryAlarm:h.QueryAlarm,class:"Select-Query",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)("搜尋")])),_:1},8,["QueryAlarm"]),(0,i.Wm)(C,{onClick:t[6]||(t[6]=e=>h.SaveTocsv()),SaveTocsv:h.SaveTocsv,class:"SaveTocsv mx-2",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)("輸出csv檔")])),_:1},8,["SaveTocsv"])]),(0,i._)("div",null,[(0,i.Wm)(D,{border:"",data:m.alarms,"empty-text":"No Alarms","row-class-name":h.row_state_class_name,size:"small",style:{width:"100%","font-weight":"bold"},"aria-current":"currentpage",id:"alarmtable"},{default:(0,i.w5)((()=>[(0,i.Wm)(A,{label:"發生時間",prop:"Time",width:"140"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,n.zw)(h.formatTime(e.row.Time)),1)])),_:1}),(0,i.Wm)(A,{label:"AGV名稱",prop:"Equipment_Name",width:"80",align:"center"}),(0,i.Wm)(A,{label:"警報碼",prop:"AlarmCode",width:"60",align:"center"}),(0,i.Wm)(A,{label:"警報描述",prop:"Description_En","min-width":"320"},{default:(0,i.w5)((e=>[(0,i._)("div",null,(0,n.zw)(e.row.Description_En)+"("+(0,n.zw)(e.row.Description_Zh)+")",1)])),_:1}),(0,i.Wm)(A,{label:"警報類型",prop:"Level",width:"100",align:"center"},{default:(0,i.w5)((e=>[(0,i.Wm)(T,{style:{width:"80px"},effect:"dark",type:1==e.row.Level?"danger":"warning"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(1==e.row.Level?"Alarm":"Warning"),1)])),_:2},1032,["type"])])),_:1}),(0,i.Wm)(A,{label:"任務名稱",prop:"Task_Name",width:"210"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Uk)((0,n.zw)(e.row.Task_Name)+" ",1),(0,i.Wm)(V,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,i.w5)((()=>[""!=e.row.Task_Name?((0,i.wg)(),(0,i.iD)("i",{key:0,onClick:t=>h.CopyText(e.row.Task_Name),class:"copy-button copy-icon bi bi-clipboard"},null,8,f)):(0,i.kq)("",!0)])),_:2},1024)])])),_:1}),(0,i.Wm)(A,{label:"發生地點",prop:"OccurLocation",width:"120",align:"center"}),(0,i.Wm)(A,{label:"排除方法",prop:"TrobleShootingMethod",width:"320",align:"center"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[""==e.row.TrobleShootingReference?((0,i.wg)(),(0,i.iD)("span",y,(0,n.zw)(e.row.TrobleShootingMethod),1)):((0,i.wg)(),(0,i.iD)("a",{key:1,href:h.getFullFilePath(e.row.TrobleShootingReference),target:"_blank"}," 📕 "+(0,n.zw)(e.row.TrobleShootingMethod),9,v))])])),_:1}),(0,i.Wm)(A,{label:"持續時間(s)",prop:"Duration",width:"90",align:"center"}),(0,i.Wm)(A,{label:"清除警報人員",prop:"ResetAalrmMemberName","min-width":"120"})])),_:1},8,["data","row-class-name"]),(0,i._)("div",b,[(0,i.Wm)(x,{"per-page":m.per_page_num,"total-rows":m.rows,"aria-controls":"alarmtable",class:"pagination justify-content-center",modelValue:m.currentpage,"onUpdate:modelValue":t[7]||(t[7]=e=>m.currentpage=e),onClick:h.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,i._)("div",S,[(0,i.Uk)(" 共 "),(0,i._)("span",k,(0,n.zw)(m.rows),1),(0,i.Uk)("筆 ")])])])])}var A=a(61623),T=a(30381),V=a.n(T),D=a(93867),x=a(29776),M=a(663),W=a(24239),I={data(){return{start_time:"2023-06-01 00:00:00",end_time:"2023-06-03 00:00:00",AGVSelected:"ALL",AlarmTypeSelected:"ALL",TaskName:"",alarms:[],per_page_num:19,rows:1,currentpage:1,loading:!1}},computed:{AgvNameList(){return W.sn.getters.AGVNameList}},mounted(){const e=new Date;this.end_time=e.toISOString().substring(0,10)+" 23:59:59",this.start_time=V()(this.end_time,"YYYY-MM-DD HH:mm:ss").subtract(7,"days").format("YYYY-MM-DD HH:mm:ss"),setTimeout((()=>{(0,A.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName).then((e=>{this.alarms=e.alarms,this.rows=e.count,this.currentpage=e.currentpage})).catch((e=>{D.Z.Danger("警報查詢失敗後端服務異常")}))}),500)},methods:{formatTime(e){return V()(e).format("yyyy-MM-DD HH:mm:ss")},onmessage(e){this.alarms=JSON.parse(e.data)},row_state_class_name({row:e,rowIndex:t}){if(e.rowIndex<0)return"";var a=this.alarms[t].Level;return 1==a?"alarm-row":"warning-row"},async QueryAlarm(){this.loading=!0,this.alarms=[],this.rows=1,this.currentpage=1,this.payload=2,setTimeout((()=>{(0,A.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.AlarmTypeSelected).then((e=>{this.alarms=e.alarms,this.rows=e.count,this.currentpage=e.currentpage})).then((e=>{})).catch((e=>{this.loading=!1,D.Z.Danger("警報查詢失敗後端服務異常")}))}),300)},async SaveTocsv(){await(0,A.lF)(this.start_time,this.end_time,this.AGVSelected,this.TaskName),D.Z.Primary("檔案儲存成功")},PageChnageHandle(e){(0,A.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.AlarmTypeSelected).then((e=>{this.alarms=e.alarms})).catch((e=>{D.Z.Danger("警報查詢失敗後端服務異常")}))},CopyText(e){(0,x.O)(e)},getFullFilePath(e){const t=M.Z.backend_host;return t+"/TrobleShootingFiles/"+e}}},E=a(83744);const P=(0,E.Z)(I,[["render",C]]);var L=P},5995:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return y}});var i=a(66252);const s={class:"avalibity-query d-flex flex-row"},n={class:"options text-start h-100 p-3 bg-light border"},o={class:"chart-display h-100 w-100 d-flex justify-content-center"},r={class:"w-100 m-1"};function l(e,t,a,l,d,c){const u=(0,i.up)("AGVSelector"),m=(0,i.up)("el-form-item"),h=(0,i.up)("el-date-picker"),g=(0,i.up)("b-button"),p=(0,i.up)("el-form"),_=(0,i.up)("AvailabilityPieChart"),w=(0,i.up)("el-tab-pane"),f=(0,i.up)("MeanTimeChart"),y=(0,i.up)("el-tabs"),v=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i._)("div",n,[(0,i.Wm)(p,{model:d.options},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{label:"AGV名稱"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:d.options.AGVName,"onUpdate:modelValue":t[0]||(t[0]=e=>d.options.AGVName=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(m,{label:"起始日期"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{"value-format":"YYYY-MM-DD",modelValue:d.options.StartDate,"onUpdate:modelValue":t[1]||(t[1]=e=>d.options.StartDate=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(m,{label:"結束日期"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{"value-format":"YYYY-MM-DD",modelValue:d.options.EndDate,"onUpdate:modelValue":t[2]||(t[2]=e=>d.options.EndDate=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{onClick:c.QueryData,class:"w-100",variant:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("查詢")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",r,[(0,i.Wm)(y,{type:"border-card","tab-position":"top",lazy:"",class:"demo-tabs"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{label:"圓餅圖"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"",ref:"piechart"},null,512)])),_:1}),(0,i.Wm)(w,{label:"直條圖"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{ref:"barchart"},null,512)])),_:1}),(0,i.Wm)(w,{label:"MTBF/MTTR"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{ref:"MTChart",id:"mtbf-chart",title:""},null,512)])),_:1})])),_:1})])])),[[v,d.loading]])])}var d=a(43125),c=a(764),u=a(51455),m=a(53658),h=a(24239),g=a(30381),p=a.n(g),_={components:{AvailabilityPieChart:u.Z,MeanTimeChart:m.Z,AGVSelector:c.Z},data(){return{loading:!1,chart_type:"pie",options:{AGVName:"AGV_001",StartDate:"",EndDate:""},query_data:{total:[],days:{dates:[],idle:[],run:[],down:[],charge:[]},BarchartMTTR:{dates:[],time:[]},BarchartMTBF:{dates:[],time:[]},BarchartMissTag:{dates:[],count:[]}}}},computed:{agvNameList(){return h.sn.getters.AGVNameList}},mounted(){this.options.StartDate=p()(Date.now()).add(-7,"days").format("YYYY-MM-DD"),this.options.EndDate=p()(Date.now()).format("YYYY-MM-DD")},methods:{async QueryData(){this.loading=!0,this.query_data=await(0,d.A)(this.options.AGVName,this.options.StartDate,this.options.EndDate),this.$refs["barchart"].updateStackBarChart(this.query_data.days),this.$refs["piechart"].updateChart(this.query_data.total),this.$refs.MTChart.RenderChartWithTimeSeriesData(this.CreateMTData(this.query_data)),setTimeout((()=>{this.loading=!1}),400)},CreateMTData(e){var t=e.BarchartMTTR,a=Object.keys(t).map((e=>({x:e,y:t[e]}))),i=e.BarchartMTBF,s=Object.keys(i).map((e=>({x:e,y:i[e]})));return[{name:"MTTR",data:a},{name:"MTBF",data:s}]},HandleChartTypeChanged(){}}},w=a(83744);const f=(0,w.Z)(_,[["render",l],["__scopeId","data-v-52cc2c3a"]]);var y=f},79370:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var i=a(66252);const s={class:""},n={class:"w-100 my-1 border rounded p-2"};function o(e,t,a,o,r,l){const d=(0,i.up)("CommonOptions"),c=(0,i.up)("b-pagination"),u=(0,i.up)("el-table-column"),m=(0,i.up)("el-table");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(d,{onOnQueryBtnClick:l.HandleQueryBtnClick},null,8,["onOnQueryBtnClick"]),(0,i._)("div",n,[(0,i.Wm)(c,{"per-page":r.QueryResult.DataNumPerPage,"total-rows":r.QueryResult.TotalDataNum,"aria-controls":"measure_result_table",class:"pagination justify-content-start",modelValue:r.QueryResult.Page,"onUpdate:modelValue":t[0]||(t[0]=e=>r.QueryResult.Page=e),onClick:l.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,i.Wm)(m,{border:"",data:r.QueryResult.dataList,style:{width:"1800px"},id:"measure_result_table"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{prop:"TaskName",label:"任務名稱",fixed:"left",width:"210"}),(0,i.Wm)(u,{prop:"AGVName",label:"AGV名稱",fixed:"left",width:"90"}),(0,i.Wm)(u,{prop:"BayName",label:"Bay名稱",fixed:"left",width:"90"}),(0,i.Wm)(u,{prop:"location",label:"量測點位",fixed:"left"}),(0,i.Wm)(u,{formatter:l.TimeFormatter,prop:"StartTime",label:"開始量測時間",fixed:"left",width:"180"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ResultFormatter,prop:"result",label:"量測結果",fixed:"left"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"illuminance",label:"照度(lux)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"decibel",label:"分貝(dB)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"temperature",label:"溫度 (℃)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"humudity",label:"濕度 (%)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"IPA",label:"IPA (異丙醇)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"Acetone",label:"Acetone (丙酮)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"TVOC",label:"TVOC (Non-Target)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"PID",label:"PID"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"partical_03um",label:"微塵粒子(0.3μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"partical_05um",label:"微塵粒子(0.5μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"partical_10um",label:"微塵粒子(1.0μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"partical_30um",label:"微塵粒子(3.0μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"partical_50um",label:"微塵粒子(5.0μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:l.ValFormatter,prop:"partical_100um",label:"微塵粒子(10.0μm)",fixed:"right"},null,8,["formatter"])])),_:1},8,["data"])])])}const r=e=>((0,i.dD)("data-v-41579660"),e=e(),(0,i.Cn)(),e),l={class:"common-options"},d={class:"options d-flex"},c={class:"block"},u=r((()=>(0,i._)("div",{class:"title"},"開始時間",-1))),m={class:"control"},h={class:"block"},g=r((()=>(0,i._)("div",{class:"title"},"結束時間",-1))),p={class:"control"},_={class:"block"},w=r((()=>(0,i._)("div",{class:"title"},"AGV",-1))),f={class:"control"},y={class:"block"},v=r((()=>(0,i._)("div",{class:"title"},"量測結果",-1))),b={class:"control"},S={class:"block"},k=r((()=>(0,i._)("div",{class:"title"},null,-1))),C={class:"my-4"};function A(e,t,a,s,n,o){const r=(0,i.up)("el-date-picker"),A=(0,i.up)("el-option"),T=(0,i.up)("el-select"),V=(0,i.up)("b-button");return(0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",d,[(0,i._)("div",c,[u,(0,i._)("div",m,[(0,i.Wm)(r,{modelValue:n.OPTIONS.StartTimeStr,"onUpdate:modelValue":t[0]||(t[0]=e=>n.OPTIONS.StartTimeStr=e),type:"date",placeholder:"選擇開始日期"},null,8,["modelValue"])])]),(0,i._)("div",h,[g,(0,i._)("div",p,[(0,i.Wm)(r,{modelValue:n.OPTIONS.EndTimeStr,"onUpdate:modelValue":t[1]||(t[1]=e=>n.OPTIONS.EndTimeStr=e),type:"date",placeholder:"選擇結束日期"},null,8,["modelValue"])])]),(0,i._)("div",_,[w,(0,i._)("div",f,[(0,i.Wm)(T,{modelValue:n.OPTIONS.AGVName,"onUpdate:modelValue":t[2]||(t[2]=e=>n.OPTIONS.AGVName=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.AGVNameList,(e=>((0,i.wg)(),(0,i.j4)(A,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,i._)("div",y,[v,(0,i._)("div",b,[(0,i.Wm)(T,{modelValue:n.OPTIONS.Result,"onUpdate:modelValue":t[3]||(t[3]=e=>n.OPTIONS.Result=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.Results,(e=>((0,i.wg)(),(0,i.j4)(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,i._)("div",S,[k,(0,i._)("div",C,[(0,i.Wm)(V,{onClick:o.HandleQueryBtnClick,variant:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("查詢")])),_:1},8,["onClick"])])])])])}a(57658);var T=a(19578),V=a(24239),D={components:{},props:{Results:{type:Array,default(){return[{value:2,label:"ALL"},{value:0,label:"成功"},{value:1,label:"失敗"}]}}},data(){return{OPTIONS:new T.Z}},computed:{AGVNameList(){var e=["ALL"];return V.sn.getters.AGVNameList.forEach((t=>{e.push(t)})),e}},watch:{},methods:{HandleQueryBtnClick(){this.OPTIONS.Page=1,this.$emit("OnQueryBtnClick",this.OPTIONS)}},mounted(){}},x=a(83744);const M=(0,x.Z)(D,[["render",A],["__scopeId","data-v-41579660"]]);var W=M,I=a(3567),E=a(30381),P=a.n(E),L={components:{CommonOptions:W},data(){return{QueryResult:{},Options:{}}},computed:{},watch:{},methods:{async HandleQueryBtnClick(e){this.Options=e,this.QueryResult=await(0,I.AE)(e)},ResultFormatter(e,t,a,i){return"done"==a?"成功":"失敗"},TimeFormatter(e,t,a,i){return P()(a).format("yyyy-MM-DD \r\n HH:mm:ss")},ValFormatter(e,t,a,i){return"-1"==a||"-1.0"==a?"NA":a},PageChnageHandle(){this.Options.Page=this.QueryResult.Page,this.HandleQueryBtnClick(this.Options)}},mounted(){}};const O=(0,x.Z)(L,[["render",o]]);var N=O},32988:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var i=a(66252),s=a(49963),n=a(3577);const o=e=>((0,i.dD)("data-v-e822ca82"),e=e(),(0,i.Cn)(),e),r={class:"Task-query"},l={class:"Task-options bg-light d-flex border-bottom w-100 py-2"},d=o((()=>(0,i._)("label",null,"Start Time",-1))),c=o((()=>(0,i._)("label",null,"End Time",-1))),u=o((()=>(0,i._)("label",null,"任務名稱",-1))),m=o((()=>(0,i._)("label",null,"EQ Name",-1))),h=o((()=>(0,i._)("option",null,"ALL",-1))),g=o((()=>(0,i._)("label",null,"任務類型",-1))),p=o((()=>(0,i._)("option",null,"ALL",-1))),_=o((()=>(0,i._)("option",null,"移動",-1))),w=o((()=>(0,i._)("option",null,"取貨",-1))),f=o((()=>(0,i._)("option",null,"放貨",-1))),y=o((()=>(0,i._)("option",null,"搬運",-1))),v=o((()=>(0,i._)("option",null,"充電",-1))),b=o((()=>(0,i._)("option",null,"量測",-1))),S=o((()=>(0,i._)("option",null,"交換電池",-1))),k=[p,_,w,f,y,v,b,S],C=o((()=>(0,i._)("label",null,"執行結果",-1))),A=o((()=>(0,i._)("option",null,"ALL",-1))),T=o((()=>(0,i._)("option",null,"完成",-1))),V=o((()=>(0,i._)("option",null,"失敗",-1))),D=o((()=>(0,i._)("option",null,"取消",-1))),x=[A,T,V,D],M=["onClick"],W=["onClick"],I={class:"text-danger"},E={class:"d-flex flex-row justify-content-center"},P={class:"mx-3 py-2"},L={style:{"font-weight":"bold","font-size":"large"}};function O(e,t,a,o,p,_){const w=(0,i.up)("b-button"),f=(0,i.up)("el-tooltip"),y=(0,i.up)("el-table-column"),v=(0,i.up)("el-tag"),b=(0,i.up)("el-table"),S=(0,i.up)("b-pagination"),A=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",l,[d,(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>p.start_time=e),prop:"Start Time"},null,512),[[s.nr,p.start_time]]),c,(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>p.end_time=e),prop:"End Time"},null,512),[[s.nr,p.end_time]]),u,(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>p.TaskName=e),placeholder:"ALL",size:"20"},null,512),[[s.nr,p.TaskName]]),m,(0,i.wy)((0,i._)("select",{prop:"EQ Name","onUpdate:modelValue":t[3]||(t[3]=e=>p.AGVSelected=e)},[h,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.AgvNameList,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e},(0,n.zw)(e),1)))),128))],512),[[s.bM,p.AGVSelected]]),g,(0,i.wy)((0,i._)("select",{prop:"EQ Name","onUpdate:modelValue":t[4]||(t[4]=e=>p.ActionTypeSelected=e)},k,512),[[s.bM,p.ActionTypeSelected]]),C,(0,i.wy)((0,i._)("select",{prop:"EQ Name","onUpdate:modelValue":t[5]||(t[5]=e=>p.ExecuteResultSelected=e)},x,512),[[s.bM,p.ExecuteResultSelected]]),(0,i.Wm)(w,{onClick:t[6]||(t[6]=e=>_.TaskQuery()),TaskQuery:_.TaskQuery,class:"Select-Query",variant:"primary mx-1",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)("搜尋")])),_:1},8,["TaskQuery"]),(0,i.Wm)(w,{onClick:t[7]||(t[7]=e=>_.SaveTocsv()),SaveTocsv:_.SaveTocsv,class:"SaveTocsv mx-2",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)("輸出csv檔")])),_:1},8,["SaveTocsv"])]),(0,i._)("div",null,[(0,i.wy)(((0,i.wg)(),(0,i.j4)(b,{data:p.tasks,"empty-text":"No Tasks","row-class-name":"row_state_class_name",size:"small",style:{width:"100%","font-weight":"bold"},border:"","aria-current":"currentpage",id:"Tasktable"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{label:"任務名稱",prop:"TaskName",width:"230"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Uk)((0,n.zw)(e.row.TaskName)+" ",1),(0,i.Wm)(f,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,i.w5)((()=>[(0,i._)("i",{onClick:t=>_.CopyText(e.row.TaskName),class:"copy-button copy-icon bi bi-clipboard"},null,8,M)])),_:2},1024)])])),_:1}),(0,i.Wm)(y,{label:"接收時間",prop:"RecieveTime",width:"160"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,n.zw)(_.formatTime(e.row.RecieveTime)),1)])),_:1}),(0,i.Wm)(y,{label:"結束時間",prop:"FinishTime",width:"160"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,n.zw)(_.formatTime(e.row.FinishTime)),1)])),_:1}),(0,i.Wm)(y,{label:"執行結果",prop:"StateName",width:"100",align:"center"},{default:(0,i.w5)((e=>[(0,i.Wm)(v,{effect:"dark",type:4==e.row.State?"success":6==e.row.State?"danger":"warning"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.row.StateName),1)])),_:2},1032,["type"])])),_:1}),(0,i.Wm)(y,{label:"AGV名稱",prop:"DesignatedAGVName",width:"100",align:"center"}),(0,i.Wm)(y,{label:"任務類型",prop:"ActionName","min-width":"30",align:"center"}),(0,i.Wm)(y,{label:"起點",prop:"From_Station_Display",width:"120",align:"center"}),(0,i.Wm)(y,{label:"起點Slot",prop:"From_Slot",width:"120",align:"center"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,n.zw)(-1==e.row.From_Slot?"-":e.row.From_Slot),1)])),_:1}),(0,i.Wm)(y,{label:"終點",prop:"To_Station_Display",width:"120",align:"center"}),(0,i.Wm)(y,{label:"終點Slot",prop:"To_Slot",width:"120",align:"center"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,n.zw)(-1==e.row.To_Slot?"-":e.row.To_Slot),1)])),_:1}),(0,i.Wm)(y,{label:"載物ID",prop:"Carrier_ID","min-width":"30"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Uk)((0,n.zw)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID)+" ",1),(0,i.Wm)(f,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,i.w5)((()=>["-1"!=e.row.Carrier_ID&&""!=e.row.Carrier_ID?((0,i.wg)(),(0,i.iD)("i",{key:0,onClick:t=>_.CopyText(e.row.Carrier_ID),class:"copy-button copy-icon bi bi-clipboard"},null,8,W)):(0,i.kq)("",!0)])),_:2},1024)])])),_:1}),(0,i.Wm)(y,{label:"派工人員",prop:"DispatcherName",width:"100"}),(0,i.Wm)(y,{label:"失敗原因",prop:"FailureReason","min-width":"120"},{default:(0,i.w5)((e=>[(0,i._)("div",I,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.row.FailureReason.split(","),(e=>((0,i.wg)(),(0,i.iD)("div",{key:e},(0,n.zw)(e),1)))),128))])])),_:1})])),_:1},8,["data"])),[[A,p.loading]]),(0,i._)("div",E,[(0,i.Wm)(S,{"per-page":p.per_page_num,"total-rows":p.rows,"aria-controls":"Tasktable",class:"pagination justify-content-center",modelValue:p.currentpage,"onUpdate:modelValue":t[8]||(t[8]=e=>p.currentpage=e),onClick:_.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,i._)("div",P,[(0,i.Uk)(" 共 "),(0,i._)("span",L,(0,n.zw)(p.rows),1),(0,i.Uk)("筆 ")])])])])}var N=a(20840),R=a(24239),G=a(29776),H=a(30381),U=a.n(H),B=a(93867),q={data(){return{start_time:"2023-06-01 00:00:00",end_time:"2023-06-30 00:00:00",AGVSelected:"ALL",ExecuteResultSelected:"ALL",ActionTypeSelected:"ALL",TaskName:"",tasks:[],per_page_num:19,rows:1,currentpage:1,loading:!1}},computed:{AgvNameList(){return R.sn.getters.AGVNameList}},mounted(){const e=new Date;this.end_time=e.toISOString().substring(0,10)+" 23:59:59",this.start_time=U()(this.end_time,"YYYY-MM-DD HH:mm:ss").subtract(7,"days").format("YYYY-MM-DD HH:mm:ss"),setTimeout((()=>{(0,N.MM)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName).then((e=>{this.tasks=e.tasks,this.rows=e.count,this.currentpage=e.currentpage})).catch((e=>{B.Z.Danger("警報查詢失敗後端服務異常")}))}),500)},methods:{formatTime(e){return U()(e).format("yyyy-MM-DD HH:mm:ss")},onmessage(e){this.tasks=JSON.parse(e.data)},async TaskQuery(){this.loading=!0,this.tasks=[],this.rows=1,this.currentpage=1,this.payload=2,setTimeout((()=>{(0,N.MM)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.ExecuteResultSelected,this.ActionTypeSelected).then((e=>{this.tasks=e.tasks,this.rows=e.count,this.currentpage=e.currentpage,this.loading=!1})).catch((e=>{this.loading=!1,B.Z.Danger("警報查詢失敗後端服務異常")}))}),300)},async SaveTocsv(){(0,N.lF)(this.start_time,this.end_time,this.AGVSelected,this.TaskName),B.Z.Primary("檔案儲存成功")},PageChnageHandle(e){(0,N.MM)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.ExecuteResultSelected,this.ActionTypeSelected).then((e=>{this.tasks=e.tasks})).catch((e=>{B.Z.Danger("警報查詢失敗後端服務異常")}))},CopyText(e){(0,G.O)(e)}}},F=a(83744);const z=(0,F.Z)(q,[["render",O],["__scopeId","data-v-e822ca82"]]);var j=z},8393:function(e,t,a){"use strict";a.d(t,{Z:function(){return Se}});var i=a(66252),s=a(3577),n=a(49963);const o={class:"agv-status card-like"},r={class:"title d-flex flex-row"},l={class:"flex-fill"},d=(0,i._)("i",{class:"bi bi-three-dots-vertical"},null,-1),c={key:0,class:"text-danger"},u={class:"d-flex flex-column"},m={style:{"font-size":"18px"}},h=(0,i._)("i",{class:"bi bi-lightning-charge-fill"},null,-1),g={class:"w-100",style:{position:"absolute",top:"0",left:"0"}},p={class:"h-100 border px-1 py-2 text-center bg-light"},_={class:"h-100 border p-1"},w={class:"h-100 border py-2 text-center bg-light"},f={class:"h-100 w-100 border p-2"},y={class:"h-100 border px-1 py-2 text-center bg-light"},v={class:"h-100 border p-1",style:{cursor:"pointer"}},b={class:"h-100 border py-2 text-center bg-light"},S={class:"w-100 h-100 border p-1 d-flex flex-row"},k={class:"flex-fill"},C=["onClick"],A={class:"h-100 border px-1 py-2 text-center bg-light"},T={class:"h-100 border px-2 py-1 d-flex"},V={class:"w-100",style:{position:"absolute",top:"0",left:"0"}},D=(0,i._)("div",{class:"h-100 border p-2 text-center bg-light"},"ID",-1),x={class:"h-100 border p-1"},M={class:"h-100 border px-1 py-2 text-center bg-light"},W={class:"h-100 border p-1"},I={class:"h-100 border py-2 text-center bg-light"},E={class:"h-100 border p-1"},P={class:"h-100 border px-1 py-2 text-center bg-light"},L={class:"h-100 border p-1 d-flex"},O={class:"h-100 border px-1 py-2 text-center bg-light"},N={class:"h-100 border px-1 py-2 text-center bg-light"},R={key:1,class:"easy-mode"},G={class:"d-flex"},H={class:"mx-1 border-end px-1"},U={class:"border-bottom",style:{"font-weight":"bolder"}},B={class:"py-1"},q=["onClick"],F={style:{"padding-top":"5px"},class:"w-100"},z={class:"d-flex w-100"},j=(0,i._)("div",{class:"item-title"},"狀態",-1),Z={class:"w-100 text-start"},$={class:"d-flex w-100 my-2"},Y=(0,i._)("div",{class:"item-title"},"電量",-1),Q={class:"w-100 px-1 text-start"},K={style:{width:"110px"}},J={class:"d-flex w-100 my-1"},X=(0,i._)("div",{class:"item-title"},"位置",-1),ee={class:"w-100 text-start",style:{"font-size":"14px"}},te=["onClick"],ae={class:"d-flex w-100 my-1"},ie=(0,i._)("div",{class:"item-title"},"載物ID",-1),se={class:"w-100 text-start"},ne={class:"modals"},oe={ref:"online_status_change_noti_txt"},re={key:0},le={class:"dialog-footer"};function de(e,t,a,de,ce,ue){const me=(0,i.up)("b-button"),he=(0,i.up)("el-table-column"),ge=(0,i.up)("el-col"),pe=(0,i.up)("el-tag"),_e=(0,i.up)("el-row"),we=(0,i.up)("el-button"),fe=(0,i.up)("b-progress-bar"),ye=(0,i.up)("b-progress"),ve=(0,i.up)("el-table"),be=(0,i.up)("b-modal"),Se=(0,i.up)("el-input"),ke=(0,i.up)("el-form-item"),Ce=(0,i.up)("el-form"),Ae=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",o,[(0,i._)("div",r,[(0,i._)("div",l,[d,(0,i.Uk)(" "+(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.vehicle-status")),1)]),ue.IsVMSConnect?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",c,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.vms_disconnect")),1))]),a.IsEasyMode?((0,i.wg)(),(0,i.iD)("div",R,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(ue.AGVDatas,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.AGV_Name,class:"easy-mode-car-card border rounded my-2 p-2",style:(0,s.j5)({backgroundColor:e.Connected?"rgb(229, 255, 240)":"rgb(255, 184, 182)"})},[(0,i._)("div",G,[(0,i._)("div",H,[(0,i._)("span",U,(0,s.zw)(e.AGV_Name),1),(0,i._)("div",B,[(0,i._)("img",{src:"agv.png",onClick:t=>ue.HandleShowAGVInMapCenter(e.AGV_Name)},null,8,q),(0,i.Wm)(pe,{effect:"dark",onClick:t=>ue.ShowOnlineStateChangeModal(e.AGV_Name,e.OnlineStatus,e.Model),type:0==e.OnlineStatus?"danger":"success"},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(1==e.OnlineStatus?"ONLINE":"OFFLINE"),1)])),_:2},1032,["onClick","type"])])]),(0,i._)("div",F,[(0,i._)("div",z,[j,(0,i._)("div",Z,[(0,i.Wm)(pe,{effect:"dark",type:ue.AGV_Status_TagType(e.MainStatus)},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(ue.AGVStatusFormatter(e)),1)])),_:2},1032,["type"])])]),(0,i._)("div",$,[Y,(0,i._)("div",Q,[(0,i._)("div",K,[(0,i.Wm)(ye,{class:"flex-fill",max:100,min:0,animated:""},{default:(0,i.w5)((()=>[(0,i.Wm)(fe,{animated:!0,class:(0,s.C_)(ue.BatteryClass(e.BatteryLevel_1)),value:e.BatteryLevel_1,label:`${(e.BatteryLevel_1/100*100).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024),-1!=e.BatteryLevel_2?((0,i.wg)(),(0,i.j4)(ye,{key:0,class:"flex-fill my-1",max:100,min:0,animated:""},{default:(0,i.w5)((()=>[(0,i.Wm)(fe,{animated:!0,class:(0,s.C_)(ue.BatteryClass(e.BatteryLevel_2)),value:e.BatteryLevel_2,label:`${(e.BatteryLevel_2/100*100).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024)):(0,i.kq)("",!0)])])]),(0,i._)("div",J,[X,(0,i._)("div",ee,[(0,i._)("b",null,(0,s.zw)(e.StationName),1),(0,i._)("i",{class:"bi bi-geo-alt-fill",style:{"font-size":"20px",cursor:"pointer"},onClick:t=>ue.HandleShowAGVInMapCenter(e.AGV_Name)},null,8,te)])]),(0,i._)("div",ae,[ie,(0,i._)("div",se,[(0,i._)("b",null,(0,s.zw)(e.Cst),1)])])])])],4)))),128))])):((0,i.wg)(),(0,i.j4)(ve,{key:0,"header-cell-style":{color:"white",border:"1px solid rgb(222, 226, 230)",backgroundColor:ue.IsVMSConnect?"rgb(13, 110, 253)":"red"},data:ue.AGVDatas,size:"small",height:"93%","empty-text":"尚無AGV","row-class-name":ue.connected_class,style:{width:"100%"},"row-key":"AGV_Name",border:"",onRowClick:ue.HandleRowClick},{default:(0,i.w5)((()=>[(0,i.Wm)(he,{label:e.$t("HomeView.AGVStatus.AGVStatus.vehicle-name"),prop:"AGV_Name",align:"center","min-width":"130px",type:"index"},{default:(0,i.w5)((t=>[(0,i._)("div",u,[(0,i._)("div",m,[(0,i._)("b",null,(0,s.zw)(ue.GetDisplayName(t.row.AGV_Name)),1)]),(0,i._)("div",{class:"agv-color-display",style:(0,s.j5)(ue.StyleOfAGVDisplayColor(t.row.AGV_Name))},null,4),ue.IsRunMode?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(me,{key:0,class:"w-20 my-1 mx-2",onClick:e=>ue.ShowOnlineStateChangeModal(t.row.AGV_Name,t.row.OnlineStatus,t.row.Model),size:"sm",style:(0,s.j5)({backgroundColor:1==t.row.OnlineStatus?"red":"#0d6efd"})},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(1==t.row.OnlineStatus?e.$t("HomeView.AGVStatus.AGVStatus.OfflineRequest"):e.$t("HomeView.AGVStatus.AGVStatus.OnlineRequest")),1)])),_:2},1032,["onClick","style"])),ue.IsRunMode?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(me,{key:1,class:"w-20 my-1 mx-2",onClick:e=>ue.ShowAGVChargeConfirmDialog(t.row),size:"sm",variant:"warning"},{default:(0,i.w5)((()=>[h,(0,i.Uk)(" "+(0,s.zw)(2==t.row.Model?e.$t("Exchange Battery"):e.$t("Charge")),1)])),_:2},1032,["onClick"]))])])),_:1},8,["label"]),(0,i.Wm)(he,{label:e.$t("HomeView.AGVStatus.AGVStatus.vehicle-statuslist"),prop:"AGV_Status",align:"left",width:"340"},{default:(0,i.w5)((t=>[(0,i._)("div",g,[(0,i.Wm)(_e,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",p,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.status")),1)])),_:1}),(0,i.Wm)(ge,{span:6},{default:(0,i.w5)((()=>[(0,i._)("div",_,[(0,i.Wm)(pe,{class:"h-100 w-100",effect:"dark",type:ue.AGV_Status_TagType(t.row.MainStatus)},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(ue.AGVStatusFormatter(t.row)),1)])),_:2},1032,["type"])])])),_:2},1024),(0,i.Wm)(ge,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",w,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.carrierid")),1)])),_:1}),(0,i.Wm)(ge,{span:11},{default:(0,i.w5)((()=>[(0,i._)("div",f,[(0,i._)("b",null,(0,s.zw)(t.row.CurrentCarrierID),1)])])),_:2},1024)])),_:2},1024),(0,i.Wm)(_e,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",y,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.vehicleconn")),1)])),_:1}),(0,i.Wm)(ge,{span:6},{default:(0,i.w5)((()=>[(0,i._)("div",v,[(0,i.Wm)(pe,{class:"h-100 w-100",onClick:e=>ue.ShowOnlineStateChangeModal(t.row.AGV_Name,t.row.OnlineStatus,t.row.Model),type:0==t.row.OnlineStatus?"danger":"success"},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(1==t.row.OnlineStatus?e.$t("HomeView.AGVStatus.AGVStatus.Online"):e.$t("HomeView.AGVStatus.AGVStatus.Offline")),1)])),_:2},1032,["onClick","type"])])])),_:2},1024),(0,i.Wm)(ge,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",b,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.position")),1)])),_:1}),(0,i.Wm)(ge,{span:11,class:""},{default:(0,i.w5)((()=>[(0,i._)("div",S,[(0,i._)("div",k,[(0,i._)("i",{class:"bi bi-geo-alt-fill",style:{"font-size":"20px",cursor:"pointer"},onClick:e=>ue.HandleShowAGVInMapCenter(t.row.AGV_Name)},null,8,C),(0,i._)("b",null,(0,s.zw)(t.row.StationName),1)]),(0,i.wy)((0,i.Wm)(we,{class:"",onClick:e=>ue.HandleAGVLocatingClick(t.row)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.Location")),1)])),_:2},1032,["onClick"]),[[n.F8,2==t.row.Model||t.row.Simulation]])])])),_:2},1024)])),_:2},1024),(0,i.Wm)(_e,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",A,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.power")),1)])),_:1}),(0,i.Wm)(ge,{span:21},{default:(0,i.w5)((()=>[(0,i._)("div",T,[(0,i.Wm)(ye,{class:"flex-fill",max:100,min:0,animated:""},{default:(0,i.w5)((()=>[t.row.IsCharging&&ue.IsVMSConnect?((0,i.wg)(),(0,i.iD)("i",{key:0,class:(0,s.C_)([ue.BatteryClass(t.row.BatteryLevel_1,!!ue.IsVMSConnect&&t.row.IsCharging),"bi bi-lightning-charge battery-icon"]),style:{color:"white"}},null,2)):(0,i.kq)("",!0),(0,i.Wm)(fe,{animated:!0,class:(0,s.C_)(ue.BatteryClass(t.row.BatteryLevel_1,!!ue.IsVMSConnect&&t.row.IsCharging)),value:ue.IsVMSConnect?t.row.BatteryLevel_1:0,label:`${(100*(ue.IsVMSConnect?t.row.BatteryLevel_1/100:0)).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024),-1!=t.row.BatteryLevel_2?((0,i.wg)(),(0,i.j4)(ye,{key:0,class:"flex-fill mx-1",max:100,min:0,animated:""},{default:(0,i.w5)((()=>[t.row.IsCharging&&ue.IsVMSConnect?((0,i.wg)(),(0,i.iD)("i",{key:0,class:(0,s.C_)([ue.BatteryClass(t.row.BatteryLevel_2,!!ue.IsVMSConnect&&t.row.IsCharging),"bi bi-lightning-charge battery-icon"]),style:{color:"white"}},null,2)):(0,i.kq)("",!0),(0,i.Wm)(fe,{animated:!0,class:(0,s.C_)(ue.BatteryClass(t.row.BatteryLevel_2,!!ue.IsVMSConnect&&t.row.IsCharging)),value:ue.IsVMSConnect?t.row.BatteryLevel_2:0,label:`${(100*(ue.IsVMSConnect?t.row.BatteryLevel_2/100:0)).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024)):(0,i.kq)("",!0)])])),_:2},1024)])),_:2},1024)])])),_:1},8,["label"]),(0,i.Wm)(he,{label:e.$t("HomeView.AGVStatus.AGVStatus.task-status"),prop:"Task_Status",align:"left","min-width":"380"},{default:(0,i.w5)((t=>[(0,i._)("div",V,[(0,i.Wm)(_e,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[D])),_:1}),(0,i.Wm)(ge,{span:21},{default:(0,i.w5)((()=>[(0,i._)("div",x,[(0,i._)("b",null,(0,s.zw)(t.row.TaskName),1)])])),_:2},1024)])),_:2},1024),(0,i.Wm)(_e,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",M,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.From")),1)])),_:1}),(0,i.Wm)(ge,{span:9},{default:(0,i.w5)((()=>[(0,i._)("div",W,[(0,i.Wm)(pe,{class:"h-100 w-100",effect:"light"},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(t.row.TaskSourceStationName),1)])),_:2},1024)])])),_:2},1024),(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",I,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.To")),1)])),_:1}),(0,i.Wm)(ge,{span:9},{default:(0,i.w5)((()=>[(0,i._)("div",E,[(0,i.Wm)(pe,{class:"h-100 w-100",effect:"light"},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(t.row.TaskDestineStationName),1)])),_:2},1024)])])),_:2},1024)])),_:2},1024),(0,i.Wm)(_e,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",P,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.action")),1)])),_:1}),(0,i.Wm)(ge,{span:9},{default:(0,i.w5)((()=>[(0,i._)("div",L,[(0,i.Wm)(pe,{class:"h-100 w-100",effect:"light"},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(ue.GetTransferProcessDescription(t.row,t.row.TransferProcess,t.row.CurrentAction,t.row.TaskRunAction)),1)])),_:2},1024)])])),_:2},1024),(0,i.Wm)(ge,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",O,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.Time")),1)])),_:1}),(0,i.Wm)(ge,{span:9},{default:(0,i.w5)((()=>[(0,i._)("div",N,(0,s.zw)(""==t.row.TaskName?"":"預計抵達時間:"+ue.Timeformat(t.row.TaskETA,"HH:mm:ss")),1)])),_:2},1024)])),_:2},1024)])])),_:1},8,["label"]),(0,i.Wm)(he,{width:"1"},{default:(0,i.w5)((e=>[(0,i._)("div",{style:(0,s.j5)({height:ue.IsRunMode?"110px":"125px"}),class:"d-flex flex-column"},null,4)])),_:1})])),_:1},8,["header-cell-style","data","row-class-name","onRowClick"]))]),(0,i._)("div",ne,[(0,i.Wm)(be,{modelValue:ce.ShowOnlineStateChange,"onUpdate:modelValue":t[0]||(t[0]=e=>ce.ShowOnlineStateChange=e),title:"ONLINE / OFFLINE REQUEST CONFIRM.",centered:!0,onOk:ue.SendOnlineStateChangeRequest,"no-close-on-esc":!0,"header-bg-variant":"warning","header-text-variant":"light"},{default:(0,i.w5)((()=>[(0,i._)("p",oe,null,512)])),_:1},8,["modelValue","onOk"])]),(0,i.Wm)(Ae,{modelValue:ce.ShowAGVLocatingDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>ce.ShowAGVLocatingDialog=e),width:"400",draggable:"",modal:!1,"close-on-click-modal":!1,title:ce.AGVLocatingPayload.Name+"-定位"},{footer:(0,i.w5)((()=>[(0,i._)("div",le,[(0,i.Wm)(we,{onClick:t[2]||(t[2]=e=>ce.ShowAGVLocatingDialog=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)("Cancel")])),_:1}),(0,i.Wm)(we,{type:"primary",onClick:ue.HandleAGVLocatingCinfirm},{default:(0,i.w5)((()=>[(0,i.Uk)("定位")])),_:1},8,["onClick"])])])),default:(0,i.w5)((()=>[ce.AGVLocatingPayload.isAMCAGV?((0,i.wg)(),(0,i.iD)("div",re,"AMC")):(0,i.kq)("",!0),(0,i.Wm)(Ce,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ke,{label:"Point ID"},{default:(0,i.w5)((()=>[(0,i.Wm)(Se,{type:"number",min:0,clearable:"",placeholder:"0",ref:"locating-tag-input",modelValue:ce.AGVLocatingPayload.currentID,"onUpdate:modelValue":t[1]||(t[1]=e=>ce.AGVLocatingPayload.currentID=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"])],64)}a(57658);var ce=a(93867),ue=a(53259),me=a(90131),he=a(38418),ge=a(8764),pe=a(24239),_e=a(30381),we=a.n(_e),fe=a(95320),ye={mounted(){},data(){return{ShowOnlineStateChange:!1,ShowChargeConfirmDialog:!1,ShowAGVLocatingDialog:!1,OnlineStatusReq:{AGV_Name:"",Online_Status:"",Model:0},AGVLocatingPayload:{Name:"",currentID:100,x:0,y:0,theata:0,isAMCAGV:!1}}},props:{IsEasyMode:{type:Boolean,default:!1}},methods:{StyleOfAGVDisplayColor(e){var t="blue";return fe.p.getters.CustomAGVStyles[e]&&(t=fe.p.getters.CustomAGVStyles[e].DisplayColor),{backgroundColor:t}},GetDisplayName(e){return fe.p.getters.CustomAGVStyles[e]?fe.p.getters.CustomAGVStyles[e].DisplayText:e},Timeformat(e,t="YYYY/MM/DD HH:mm:ss"){return we()(e).format(t)},HandleRowClick(e,t){},HandleShowAGVInMapCenter(e){ue.Z.emit("/show_agv_at_center",e)},ShowTaskAllocationView(e){(0,me.VM)().isLogin?ue.Z.emit("bus-show-task-allocation",{agv_name:e.AGV_Name,agv_type:e.Model,action:"",station_data:void 0}):this.$swal.fire({title:"權限不足",text:"您沒有指派任務的權限，請先進行登入。",icon:"warning",showCancelButton:!0}).then((e=>{e.isConfirmed&&ue.Z.emit("/show-login-view-invoke","")}))},ShowOnlineStateChangeModal(e,t,a){if(this.IsLogin){this.OnlineStatusReq.AGV_Name=e,this.OnlineStatusReq.Online_Status=0==t?"Online":"Offline",this.OnlineStatusReq.Model=a;var i="Online"==this.OnlineStatusReq.Online_Status?"上線":"下線";this.$swal.fire({text:`確定要將 ${this.OnlineStatusReq.AGV_Name} ${i}?`,title:`${this.OnlineStatusReq.AGV_Name} - ${i}`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed)await this.SendOnlineStateChangeRequest()}))}else this.$swal.fire({text:"",title:"沒有請求車子上下線的權限，請先進行登入",icon:"warning",showCancelButton:!0,confirmButtonText:"登入",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&ue.Z.emit("/show-login-view-invoke","")}))},async SendOnlineStateChangeRequest(){ce.Z.Primary(`${this.OnlineStatusReq.AGV_Name} ${this.OnlineStatusReq.Online_Status} 請求已送出`,"top",2e3);var e=null;try{if("Online"==this.OnlineStatusReq.Online_Status){var t=await(0,he.UT)(this.OnlineStatusReq.AGV_Name,this.OnlineStatusReq.Model);e=t.data}else{t=await(0,he.PX)(this.OnlineStatusReq.AGV_Name,this.OnlineStatusReq.Model);e=t.data}0!=e.ReturnCode&&this.$swal.fire({text:`${this.OnlineStatusReq.AGV_Name} ${this.OnlineStatusReq.Online_Status} 失敗:${e.Message}`,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}catch(a){this.$swal.fire({title:"VMS系統通訊異常",text:`${a.message} , Please confirm that the VMS is currently in service.`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},HandleAGVLocatingClick(e){console.log(e),this.AGVLocatingPayload.currentID=Number.parseInt(e.CurrentLocation),this.AGVLocatingPayload.Name=e.AGV_Name,this.AGVLocatingPayload.isAMCAGV=2==e.Model,this.ShowAGVLocatingDialog=!0,setTimeout((()=>{this.$refs["locating-tag-input"].focus(),this.$refs["locating-tag-input"].select()}),500)},async HandleAGVLocatingCinfirm(){this.ShowAGVLocatingDialog=!1;var e=this.AGVLocatingPayload.Name,t=await(0,he.ZM)(e,this.AGVLocatingPayload);console.log(t),t&&t.confirm?this.$swal.fire({text:`${e}-定位完成!`,title:"",icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):(this.$swal.fire({text:`${e}-定位失敗`,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),this.ShowAGVLocatingDialog=!0)},ShowAGVChargeConfirmDialog(e){if(pe.HP.getters.level<0)this.$swal.fire({title:"權限不足",text:"您沒有指派AGV充電的權限，請先進行登入。",icon:"warning",showCancelButton:!0}).then((e=>{e.isConfirmed&&ue.Z.emit("/show-login-view-invoke","")}));else{this.Agv_Selected=e.AGV_Name;var t=2==e.Model;this.$swal.fire({title:`確定要將${e.AGV_Name}${t?"派送至交換戰站交換電池?":"派送至充電站充電?"}`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.AGVChargeTask(t)}))}},async AGVChargeTask(e=!1){var t={};t=e?await ge.J8.ExangeBatteryTask(new ge.Z$(this.Agv_Selected,-1)):await ge.J8.ChargeTask(new ge.fn(this.Agv_Selected,-1)),console.log(t),this.HandleChargeTaskDispatchResult(t)},HandleChargeTaskDispatchResult(e){e.data.confirm||(82==e.data.alarm_code?this.$swal.fire({text:"是否要改為指派新的充電任務",title:e.data.message,icon:"warning",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=await ge.J8.CancelChargeTask(this.Agv_Selected);t.confirm?this.AGVChargeTask():this.$swal.fire({text:"",title:t.message,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}})):this.$swal.fire({text:"Error Code: "+e.data.alarm_code,title:e.data.message,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}))},AGV_Status_TagType(e){return 1==e?"warning":2==e?"success":3==e?"danger":""},GetTaskRunStatusString(e){return 1==e?"等待":2==e?"執行中":3==e?"完成":4==e?"失敗":"Unknown"},GetAGVStatusString(e){return 1==e?"閒置中":2==e?"執行中":3==e?"當機":4==e?"充電中":"Unknown"},GetTransferProcessDescription(e,t,a=0,i=0){if(!e.IsExecutingOrder||0==t||500==t)return"";if(1==t)return"移動中";if(2==t)return"前往來源設備";if(3==t){if(8==i)return"前往充電站";if(7==i||9==i)return"前往終點設備放貨";if(1==i)return"前往終點設備取貨"}else{if(4==t)return"取貨中";if(5!=t)return 6==t?"停車-充電站":7==t?"退出設備中":8==t?"退出停車點/充電站":13==t?"避車":"Unknown";if(7==a)return"放貨中";if(1==a)return"取貨中"}},AGVStatusFormatter(e,t){if(void 0==e)return this.GetAGVStatusString(999);var a=e.MainStatus;return this.GetAGVStatusString(a)},connected_class({row:e,rowIndex:t}){var a=this.IsRunMode?"agv-row-no-operation":"agv-row";return e.Connected&&this.IsVMSConnect?`${a} connect`:`${a} disconnect`},BatteryClass(e,t=!1){return t?"batter-charging":e>=30?"batter-full-level":e>10&&e<30?"batter-mid-level":"batter-low-level"}},computed:{AGVDatas(){return pe.sn.getters.AGVStatesData},Groups(){function e(e){return 0==e?"Fork AGV":1==e?"潛盾 AGV":2==e?"YUNTECH AGV":3==e?"巡檢 AGV":"GROUP"}var t=this.AGVDatas.map((e=>e.Group));const a=[...new Set(t)];var i=[];for(let n=0;n<a.length;n++){const t=a[n];var s=this.AGVDatas.filter((e=>e.Group==t));i.push({group:t,group_name:e(t),agv_states:s})}return i},IsLogin(){return pe.HP.getters.IsLogin},IsRunMode(){return pe.cy.getters.IsRunMode},AGV_Names(){var e=[];return this.AGVDatas.forEach((t=>{e.push(t.AGV_Name)})),e},IsVMSConnect(){return pe.g4.getters.VMSAlive}}},ve=a(83744);const be=(0,ve.Z)(ye,[["render",de]]);var Se=be},51330:function(e,t,a){"use strict";a.d(t,{Z:function(){return V}});var i=a(66252);const s={class:"map card-like"};function n(e,t,a,n,o,r){const l=(0,i.up)("Map"),d=(0,i.up)("CargoTransferDialog");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(l,{canva_height:"100%",onOnTransferRequst:r.HandleTransferReq,id:a.id,class:"w-100",task_dispatch_menu_show:!0,eq_lduld_status_show:!0},null,8,["onOnTransferRequst","id"]),(0,i.Wm)(d,{ref:"transfer_dialog"},null,512)])}var o=a(91475),r=a(95320),l=a(3577);const d=e=>((0,i.dD)("data-v-3ff74ab2"),e=e(),(0,i.Cn)(),e),c={class:"justify-content-center px-5 cargo-transfer"},u=d((()=>(0,i._)("div",{class:"w-100 border-bottom my-1"},[(0,i._)("h3",null,"車輛選擇")],-1))),m={class:"w-100 border-bottom my-1"},h={style:{color:"blue"}},g={style:{color:"seagreen"}},p={class:"text-danger"};function _(e,t,a,s,n,o){const r=(0,i.up)("el-option"),d=(0,i.up)("el-select"),_=(0,i.up)("el-divider"),w=(0,i.up)("el-table-column"),f=(0,i.up)("b-button"),y=(0,i.up)("el-popconfirm"),v=(0,i.up)("el-table"),b=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.j4)(b,{"destroy-on-close":"",modal:!1,style:{"z-index":"0"},modelValue:n.show_dialog,"onUpdate:modelValue":t[2]||(t[2]=e=>n.show_dialog=e),draggable:"",title:`${n.source_station.Name}-搬運任務`},{default:(0,i.w5)((()=>[(0,i._)("div",c,[u,o.isRunMode?((0,i.wg)(),(0,i.j4)(d,{key:1,disabled:"",class:"w-100",modelValue:n.autoSelectAGVName,"onUpdate:modelValue":t[1]||(t[1]=e=>n.autoSelectAGVName=e)},null,8,["modelValue"])):((0,i.wg)(),(0,i.j4)(d,{key:0,class:"w-100",modelValue:n.selectedAGVName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedAGVName=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.AgvNameList,(e=>((0,i.wg)(),(0,i.j4)(r,{key:e,label:"Assigning"==e?"自動選車":e,value:"Assigning"==e?"":e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])),(0,i.Wm)(_),(0,i._)("div",m,[(0,i._)("h3",null,(0,l.zw)("unload"==n.action?"下游設備列表":"來源設備列表"),1)]),(0,i.Wm)(v,{size:"small",border:"",data:n.CandicateEQOptions},{default:(0,i.w5)((()=>["unload"==n.action?((0,i.wg)(),(0,i.j4)(w,{key:0,label:"起點"},{default:(0,i.w5)((e=>[(0,i._)("b",h,(0,l.zw)(n.source_station.Graph.Display),1)])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(w,{label:"unload"==n.action?"下游設備":"上游設備",prop:"Name"},{default:(0,i.w5)((e=>[(0,i._)("b",null,(0,l.zw)(e.row.Name),1)])),_:1},8,["label"]),"load"==n.action?((0,i.wg)(),(0,i.j4)(w,{key:1,label:"終點"},{default:(0,i.w5)((e=>[(0,i._)("b",g,(0,l.zw)(n.source_station.Graph.Display),1)])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(w,{align:"center",label:"TAG",prop:"TagID"}),(0,i.Wm)(w,{align:"center",label:"動作"},{default:(0,i.w5)((e=>[(0,i.Wm)(y,{width:"220","confirm-button-text":"確定","cancel-button-text":"取消","icon-color":"#626AEF",title:"確定要進行此搬運任務?",onConfirm:t=>o.HandleTransferBtnClick(e.row.TagID)},{reference:(0,i.w5)((()=>[(0,i.Wm)(f,{style:{width:"90px"},size:"sm",variant:"primary",disabled:!o.Transferable(e.row.TagID)},{default:(0,i.w5)((()=>[(0,i.Uk)("搬運")])),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"])])),_:1}),(0,i.Wm)(w,{width:"300",label:"說明"},{default:(0,i.w5)((e=>[(0,i._)("div",p,(0,l.zw)(o.GetNoTransferActionReason(e.row.TagID)),1)])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue","title"])}var w=a(64491),f=a(24239),y=a(8764),v=a(65781),b={components:{InfoFilled:v.cEj},data(){return{show_dialog:!1,confirm_dialog_show:!1,source_station:{},EQOptions:[],CandicateEQOptions:[],action:"",selectedAGVName:"",autoSelectAGVName:"自動指派"}},methods:{ShowDialog(e,t="load"){this.isRunMode?this.selectedAGVName="Assigning":""==this.selectedAGVName&&(this.selectedAGVName=this.AgvNameList[0]),this.source_station=e,this.action=t,this.CandicateEQOptions=[];var a=e.TagNumber;(0,w.H5)().then((i=>{var s=i.find((e=>e.TagID==a));if(s){var n=s.ValidDownStreamEndPointNames;this.EQOptions=i,this.CandicateEQOptions="unload"==t?i.filter((e=>n.includes(e.Name))):i.filter((t=>t.ValidDownStreamEndPointNames.includes(e.Name))),this.show_dialog=!0}}))},Transferable(e){if(void 0==e)return!0;var t=this.eq_status_data.find((t=>t.Tag==e));if("load"==this.action){if(0==t.EqType)return t.Unload_Request&&t.Up_Pose&&t.IsConnected&&t.Eqp_Status_Down;if(1==t.EqType)return t.Unload_Request&&t.IsConnected&&t.Eqp_Status_Idle}else{if(0==t.EqType)return t.Load_Request&&t.Down_Pose&&t.IsConnected&&t.Eqp_Status_Down;if(1==t.EqType)return t.Load_Request&&t.IsConnected&&t.Eqp_Status_Idle}},GetNoTransferActionReason(e){if(void 0==e)return"";var t=this.eq_status_data.find((t=>t.Tag==e)),a="load"==this.action?"unload":"load";if(!t.IsConnected)return`${t.EQName} 機台尚未連線`;if(!t.Eqp_Status_Down&&0==t.EqType)return`${t.EQName} 機台狀態異常(Eqp_Status_Down)`;if(t.Eqp_Status_Down&&1==t.EqType)return`${t.EQName} 機台狀態異常(Eqp_Status_Down)`;if("load"==a){if(!t.Load_Request)return`${t.EQName} 機台未發起載入請求(Load_Request)`;if(!t.Down_Pose&&0==t.EqType)return`${t.EQName} 設備機構位置錯誤(Down_Pose)`}if("unload"==a){if(!t.Unload_Request)return`${t.EQName} 機台未發起移出請求(Unload_Request)`;if(!t.Up_Pose&&0==t.EqType)return`${t.EQName} 設備機構位置錯誤(Up_Pose)`}return""},HandleTransferBtnClick(e){if(""==this.selectedAGVName)return this.show_dialog=!1,void this.$swal.fire({text:"",title:"請選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{this.show_dialog=!0}));var t="-1",a="-1";"load"==this.action?(t=e,a=this.source_station.TagNumber):(t=this.source_station.TagNumber,a=e);var i="Assigning"==this.selectedAGVName?"":this.selectedAGVName;y.J8.CarryTask(new y.mc(i,t,1,a,1,"-1",5))}},computed:{eq_status_data(){return f.jU.getters.EQData},isRunMode(){return f.cy.getters.IsRunMode},AgvNameList(){return f.sn.getters.AGVNameList}}},S=a(83744);const k=(0,S.Z)(b,[["render",_],["__scopeId","data-v-3ff74ab2"]]);var C=k,A=(a(79072),{props:{id:{type:String,default:"homemap"}},components:{Map:o["default"],CargoTransferDialog:C},data(){return{navPathDisplayData:{},agv_colors:["#42c2f5","limegreen","orange","pink","red","purple"]}},computed:{map_station_data(){return r.p.getters.MapStations},agvs_info(){return r.p.getters.AGVNavInfo}},mounted(){},methods:{HandleTransferReq(e={station_data:{},action:"load"}){this.$refs.transfer_dialog.ShowDialog(e.station_data,e.action)}}});const T=(0,S.Z)(A,[["render",n],["__scopeId","data-v-5f2e9868"]]);var V=T},6755:function(e,t,a){"use strict";a.d(t,{Z:function(){return A}});var i=a(66252),s=a(3577);const n={class:"task-allocation"},o={class:"d-flex"},r={class:"flex-fill text-center"},l={class:"drawer-content border-top"},d={class:"d-flex flex-row py-1 w-100 h-100"},c={key:0,class:"img charge"},u={key:1,class:"img delivery"};function m(e,t,a,m,h,g){const p=(0,i.up)("el-button"),_=(0,i.up)("el-option"),w=(0,i.up)("el-select"),f=(0,i.up)("el-form-item"),y=(0,i.up)("el-input"),v=(0,i.up)("b-button"),b=(0,i.up)("el-checkbox"),S=(0,i.up)("el-form"),k=(0,i.up)("Map"),C=(0,i.up)("el-drawer"),A=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(C,{"show-close":!1,modelValue:h.show,"onUpdate:modelValue":t[8]||(t[8]=e=>h.show=e),header:!1,size:"95%",direction:"btt",modal:!1,"z-index":123,onClosed:g.HandleDrawerClosed},{header:(0,i.w5)((()=>[(0,i._)("div",o,[(0,i.Wm)(p,{onClick:t[0]||(t[0]=()=>{h.show=!1}),size:"large",style:{"margin-left":"53px","font-size":"larger"},type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("←返回(ESC)")])),_:1}),(0,i._)("h3",r,"Local任務派送-車輛:"+(0,s.zw)(h.selectedAGVName),1)])])),default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",d,[(0,i.Wm)(S,{"label-width":"100px","label-position":"left",size:"large",style:{width:"500px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{label:"AGV車輛選擇"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"w-100",modelValue:h.selectedAGVName,"onUpdate:modelValue":t[1]||(t[1]=e=>h.selectedAGVName=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.AgvNameList,(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(f,{label:"AGV任務動作"},{default:(0,i.w5)((()=>[2!=h.agv_type?((0,i.wg)(),(0,i.j4)(w,{key:0,class:"w-100",modelValue:h.selectedAction,"onUpdate:modelValue":t[2]||(t[2]=e=>h.selectedAction=e),placeholder:"請選擇Action",onChange:g.ActionChangeHandler},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{label:"移動",value:"move"}),(0,i.Wm)(_,{label:"停車",value:"park"}),(0,i.Wm)(_,{label:"搬運",value:"carry"}),(0,i.Wm)(_,{label:"放貨",value:"load"}),(0,i.Wm)(_,{label:"取貨",value:"unload"}),(0,i.Wm)(_,{label:"充電",value:"charge"}),g.IsDeveloper?((0,i.wg)(),(0,i.j4)(_,{key:0,label:"巡檢量測",value:"measure"})):(0,i.kq)("",!0)])),_:1},8,["modelValue","onChange"])):((0,i.wg)(),(0,i.j4)(w,{key:1,class:"w-100",modelValue:h.selectedAction,"onUpdate:modelValue":t[3]||(t[3]=e=>h.selectedAction=e),placeholder:"請選擇Action",onChange:g.ActionChangeHandler},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{label:"移動",value:"move"}),(0,i.Wm)(_,{label:"交換電池",value:"exchange_battery"}),(0,i.Wm)(_,{label:"巡檢量測",value:"measure"}),(0,i.Wm)(_,{label:"進Bay",value:"in-bay"}),(0,i.Wm)(_,{label:"出Bay",value:"out-bay"})])),_:1},8,["modelValue","onChange"]))])),_:1}),"carry"==h.selectedAction?((0,i.wg)(),(0,i.j4)(f,{key:0,label:"起點"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"w-100",modelValue:h.sourceTag,"onUpdate:modelValue":t[4]||(t[4]=e=>h.sourceTag=e),onChange:g.HandleFromSelectChanged,placeholder:"選擇站點"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.tags,(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.tag,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,{label:"目的地"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"w-100",modelValue:h.destinTag,"onUpdate:modelValue":t[5]||(t[5]=e=>h.destinTag=e),placeholder:"選擇站點"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.DetermineDestinOptions(),(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.tag,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"carry"===h.selectedAction|"unload"===h.selectedAction?((0,i.wg)(),(0,i.j4)(f,{key:1,label:"貨物ID"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{class:"w-100",modelValue:h.Cst_ID_Input,"onUpdate:modelValue":t[6]||(t[6]=e=>h.Cst_ID_Input=e),autocomplete:""},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,{class:"w-100 my-2",onClick:g.TaskDeliveryBtnClickHandle,variant:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("派送任務")])),_:1},8,["onClick"])])),_:1}),g.IsDeveloper?((0,i.wg)(),(0,i.j4)(f,{key:2,label:"Bypass 設備狀態檢查"},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{class:"w-100",modelValue:h.bypass_eq_status_check,"onUpdate:modelValue":t[7]||(t[7]=e=>h.bypass_eq_status_check=e)},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(k,{canva_height:"750px",id:"task_allocation_map",class:"w-100 border rounded mx-2",ref:"_map"},null,512)]),"charge"==h.selectedAction?((0,i.wg)(),(0,i.iD)("div",c)):((0,i.wg)(),(0,i.iD)("div",u))])),[[A,h.wait_task_confirm]])])),_:1},8,["modelValue","onClosed"])])}a(57658),a(67635);var h=a(93867),g=a(53259),p=a(56938),_=a(91475),w=a(95320),f=a(8764),y=a(24239),v=a(79072),b=a(64491),S={components:{Map:_["default"]},data(){return{show:!1,clsAgvStatus:new p.Z,confirm_dialog_show:!1,notify_dialog_show:!1,wait_task_confirm:!1,bypass_eq_status_check:!1,notify_text:"",selectedAGVName:"",selectedAction:"move",sourceTag:"",destinTag:"",Cst_ID_Input:"",moveable_tags:[{tag:1,name:"標籤1"}],parkable_tags:[],stock_tags:[{tag:1,name:"標籤1"},{tag:2,name:"標籤2"}],chargable_tags:[{tag:50,name:"充電站(TAG-50)"},{tag:70,name:"充電站(TAG-70)"}],downstream_tags:[{tag:1,name:"標籤1"},{tag:2,name:"標籤2"}],csts:[{tag:1,name:""}],agv_type:0,equipments_options:void 0}},computed:{Map(){return this.$refs["_map"]},AgvNameList(){var e=[];function t(e){y.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return y.cy.getters.IsRunMode?(e.push({value:"",label:"自動選車"}),this.IsDeveloper&&t(e)):t(e),e},tags(){return"move"==this.selectedAction?this.moveable_tags:"charge"==this.selectedAction?this.chargable_tags:"load"==this.selectedAction|"unload"==this.selectedAction|"carry"==this.selectedAction?this.stock_tags:this.parkable_tags},IsDeveloper(){return y.HP.getters.IsDeveloperLogining},IsUserLogin(){return 0!=y.HP.getters.level},bay_names(){var e=w.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},exchanger_options(){return w.p.getters.AllExangeBatteryStation}},methods:{ActionChangeHandler(e){this.sourceTag=void 0,this.destinTag=void 0;var t="blue";"move"==e&&this.Map.HighLightFeaturesByStationType(0,t),"carry"==e|"load"==e|"unload"==e&&this.Map.HighLightFeaturesByStationType(1,t),"charge"==e&&this.Map.HighLightFeaturesByStationType(3,t)},HandleNavPathPreviewBtnClick(){},DetermineDestinOptions(){return"measure"==this.selectedAction?this.bay_names:"carry"==this.selectedAction?this.downstream_tags:"exchange_battery"==this.selectedAction?this.exchanger_options:this.tags},TaskDeliveryBtnClickHandle(){if(this.selectedAGVName||y.cy.getters.IsRunMode)if(this.selectedAction)if(""==this.destinTag|void 0==this.destinTag)this.$swal.fire({text:"",title:"尚未選擇目的地",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else if("carry"==this.selectedAction&&""==this.sourceTag|void 0==this.sourceTag)this.$swal.fire({text:"",title:"尚未選擇起點",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else{var e=this.destinTag;this.$swal.fire({title:"確定要派送此任務?",text:`${this.selectedAGVName} 執行 ${this.selectedAction.toUpperCase()} 任務,終點:${e}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.TaskDeliveryHandle()}))}else this.$swal.fire({text:"",title:"尚未選擇動作",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else this.$swal.fire({text:"",title:"尚未選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async TaskDeliveryHandle(){0==y.HP.getters.level&&(this.bypass_eq_status_check=!1),this.wait_task_confirm=!0;var e={confirm:!0,message:""};if("move"==this.selectedAction&&(e=await f.J8.MoveTask(new f.ec(this.selectedAGVName,this.destinTag,50))),"measure"==this.selectedAction&&(e=await f.J8.MeasureTask(new f.FV(this.selectedAGVName,this.destinTag))),"load"==this.selectedAction&&(e=await f.J8.LoadTask(new f.Y4(this.selectedAGVName,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selectedAction&&(e=await f.J8.UnloadTask(new f.On(this.selectedAGVName,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selectedAction&&(e=await f.J8.CarryTask(new f.mc(this.selectedAGVName,this.sourceTag,1,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"exchange_battery"==this.selectedAction&&(e=await f.J8.ExangeBatteryTask(new f.Z$(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),"charge"==this.selectedAction&&(e=await f.J8.ChargeTask(new f.fn(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),"park"==this.selectedAction&&(e=await f.J8.ParkTask(new f.Nn(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),this.wait_task_confirm=!1,200!=e.status){const t=401==e.status;this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{t&&(this.show=!1,y.HP.dispatch("logout",""),g.Z.emit("/show-login-view-invoke"))}))}else e.data.confirm?(h.Z.Success(`任務-[${this.selectedAction.toUpperCase()}] 已派送!`,"bottom",2e3),setTimeout((()=>{this.show=!1}),400)):this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},HandleDrawerClosed(){},MapStationClicked(e){if(e){var t=e.StationType;0==t&&(this.selectedAction="move"),1==t&&(this.selectedAction="unload"),3==t&&(this.selectedAction="charge");var a=this.tags.findLast((t=>t.tag==e.TagNumber));console.info(a),a&&(this.sourceTag=e.TagNumber)}},async HandleFromSelectChanged(e){this.destinTag=void 0,this.downstream_tags=[],this.equipments_options=await(0,b.H5)();var t=this.equipments_options.find((t=>t.TagID==e));if(t){var a=t.ValidDownStreamEndPointNames;console.info(a);var i=this.equipments_options.filter((e=>a.includes(e.Name)));console.info(i),Object.values(i).forEach((e=>{this.downstream_tags.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`})}))}}},mounted(){g.Z.on("bus-show-task-allocation",((e={agv_name:void 0,agv_type:0,action:"",station_data:new v.ux})=>{this.IsUserLogin||y.cy.getters.IsRunMode?(this.agv_type=e.agv_type,this.sourceTag=void 0,this.destinTag=void 0,this.selectedAGVName=y.cy.getters.IsRunMode?"":void 0,this.moveable_tags=w.p.getters.AllNormalStationOptions,this.stock_tags=w.p.getters.AllEqStation,this.chargable_tags=w.p.getters.AllChargeStation,this.parkable_tags=w.p.getters.AllParkingStationOptions,this.selectedAction=e.action,e.agv_name&&(this.selectedAGVName=e.agv_name),e.station_data&&("carry"==this.selectedAction?(this.sourceTag=e.station_data.TagNumber,this.HandleFromSelectChanged(this.sourceTag)):this.destinTag=e.station_data.TagNumber),this.show=!0):setTimeout((()=>{this.$swal.fire({text:"",title:"請先進行登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{g.Z.emit("/show-login-view-invoke")}))}),200)}))}},k=a(83744);const C=(0,k.Z)(S,[["render",m],["__scopeId","data-v-e301d28c"]]);var A=C},80207:function(e,t,a){"use strict";a.d(t,{Z:function(){return R}});var i=a(66252),s=a(3577),n=a(49963);const o=e=>((0,i.dD)("data-v-1bd34481"),e=e(),(0,i.Cn)(),e),r={class:"task-status card-like"},l={class:"title d-flex flex-row justify-content-between"},d=o((()=>(0,i._)("i",{class:"bi bi-three-dots-vertical"},null,-1))),c={key:0,class:""},u={key:1,class:"column-display-mode"},m=o((()=>(0,i._)("div",{class:"title-display"},"等待/執行中任務",-1))),h=o((()=>(0,i._)("div",{class:"title-display"},"已結束任務",-1))),g={class:"setting-container w-100 bg-light text-start"};function p(e,t,a,o,p,_){const w=(0,i.up)("RunningTaskTable"),f=(0,i.up)("el-tab-pane"),y=(0,i.up)("CompletedTaskTable"),v=(0,i.up)("el-tabs"),b=(0,i.up)("el-checkbox"),S=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",r,[(0,i.wy)((0,i._)("div",l,[(0,i._)("div",null,[d,(0,i.Uk)((0,s.zw)(e.$t("HomeView.TaskStatus")),1)]),(0,i._)("div",null,[(0,i._)("i",{class:"bi bi-sliders",onClick:t[0]||(t[0]=e=>p.ShowSettingsDrawer=!0)})])],512),[[n.F8,a.show_card_title]]),"tabs"==a.display_mode?((0,i.wg)(),(0,i.iD)("div",c,[(0,i.Wm)(v,{lazy:"",size:"",type:"border-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{label:e.$t("IncompleteTasks")},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{height:a.height,IncompletedTaskList:_.IncompletedTaskListTbData},null,8,["height","IncompletedTaskList"])])),_:1},8,["label"]),(0,i.Wm)(f,{label:e.$t("CompleteTasks")},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{height:a.height,CompletedTaskList:_.CompletedTaskListTbData},null,8,["height","CompletedTaskList"])])),_:1},8,["label"])])),_:1})])):((0,i.wg)(),(0,i.iD)("div",u,[m,(0,i.Wm)(w,{height:a.height,IncompletedTaskList:_.IncompletedTaskListTbData},null,8,["height","IncompletedTaskList"]),h,(0,i.Wm)(y,{height:a.height,CompletedTaskList:_.CompletedTaskListTbData},null,8,["height","CompletedTaskList"])])),(0,i.Wm)(S,{modelValue:p.ShowSettingsDrawer,"onUpdate:modelValue":t[2]||(t[2]=e=>p.ShowSettingsDrawer=e),title:"任務狀態設定"},{default:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i.Wm)(b,{onChange:e.HandleShowTrafficCkbChg,modelValue:p.Settings.ShowTrafficTask,"onUpdate:modelValue":t[1]||(t[1]=e=>p.Settings.ShowTrafficTask=e),label:"顯示交管任務"},null,8,["onChange","modelValue"])])])),_:1},8,["modelValue"])])}a(30381);a(663);var _=a(24239);const w={class:"running-task-table"},f={class:"agv-name"};function y(e,t,a,o,r,l){const d=(0,i.up)("el-table-column"),c=(0,i.up)("el-tag"),u=(0,i.up)("b-button"),m=(0,i.up)("el-table");return(0,i.wg)(),(0,i.iD)("div",w,[(0,i.Wm)(m,{"header-cell-style":{color:"black",backgroundColor:"white"},data:a.IncompletedTaskList,"row-key":"TaskName",size:"small","row-class-name":l.row_class_name,"empty-text":e.$t("TaskTable.NoTasks"),onHeaderDragend:l.HandleHeaderDragEnd,border:"",fit:"",height:a.height},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{label:e.$t("TaskTable.TaskName"),width:"180",prop:"TaskName"},null,8,["label"]),(0,i.Wm)(d,{label:e.$t("TaskTable.Time"),align:"center",prop:"RecieveTime_Formated",width:"80"},null,8,["label"]),(0,i.Wm)(d,{label:e.$t("TaskTable.Action"),align:"center",prop:"ActionName",width:"60"},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{effect:"dark",type:8==e.row.Action||14==e.row.Action?"warning":""},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(e.row.ActionName),1)])),_:2},1032,["type"])])),_:1},8,["label"]),(0,i.Wm)(d,{label:e.$t("TaskTable.TaskStatus"),align:"center",prop:"StateName",width:l.getColumnSize("StateName",80)},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{effect:"dark",type:l.GetTaskStateType(e.row.State)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.StateName),1)])),_:2},1032,["type"])])),_:1},8,["label","width"]),(0,i.Wm)(d,{label:e.$t("TaskTable.ExcuteAgvName"),align:"center",width:l.getColumnSize("DesignatedAGVName",120),prop:"DesignatedAGVName"},{default:(0,i.w5)((e=>[(0,i._)("div",f,(0,s.zw)(e.row.DesignatedAGVName),1)])),_:1},8,["label","width"]),(0,i.Wm)(d,{label:e.$t("TaskTable.Source"),align:"center",prop:"From_Station",width:l.getColumnSize("From_Station",110)},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(l.GetStationName(e.row.From_Station)),1)])),_:1},8,["label","width"]),(0,i.Wm)(d,{label:e.$t("TaskTable.Destine"),align:"center",prop:"To_Station",width:l.getColumnSize("To_Station",110),"min-width":"100%"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(l.GetStationName(e.row.To_Station)),1)])),_:1},8,["label","width"]),(0,i.Wm)(d,{label:e.$t("TaskTable.CstID"),align:"center",width:l.getColumnSize("Carrier_ID",120),prop:"Carrier_ID"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID),1)])),_:1},8,["label","width"]),(0,i.Wm)(d,{label:e.$t("TaskTable.Dispatcher"),width:l.getColumnSize("DispatcherName"),prop:"DispatcherName"},null,8,["label","width"]),(0,i.wy)((0,i.Wm)(d,{fixed:"right",width:"100"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Wm)(u,{size:"sm",variant:"danger",onClick:t=>l.CancelTaskHandler(e.row.TaskName)},{default:(0,i.w5)((()=>[(0,i.Uk)("取消任務")])),_:2},1032,["onClick"])])])),_:1},512),[[n.F8,l.taskCancelable]])])),_:1},8,["data","row-class-name","empty-text","onHeaderDragend","height"])])}a(57658);var v=a(8764);function b(e){return 1==e||2==e||3==e||4==e?"success":6==e?"danger":7==e?"warning":"info"}var S=a(95320);class k{constructor(e="''",t=100){this.propName=e,this.width=t}}function C(e,t=[new k]){localStorage.setItem(e,JSON.stringify(t))}function A(e){var t=[new k];let a=localStorage.getItem(e);return a&&Object.assign(t,JSON.parse(a)),t}var T=a(53259),V={props:{IncompletedTaskList:{type:Array,default(){return[]}},height:{type:String,default(){return"260px"}}},data(){return{showCancelTaskConfirm:!1,cancelTaskName:"",columnsSizeSetting:[new k("From_Station",100),new k("To_Station",100)]}},computed:{taskCancelable(){return _.HP.getters.IsLogin},MapPoints(){return Object.values(S.p.getters.MapData.Points)}},methods:{getColumnSize(e="",t=100){var a=this.columnsSizeSetting.find((t=>t.propName==e));return a?a.width:t},HandleHeaderDragEnd(e,t,a,i){let s=a.property,n=this.columnsSizeSetting.find((e=>e.propName==s));n?n.width=e:this.columnsSizeSetting.push(new k(s,e)),C("runningTaskTable-column-size",this.columnsSizeSetting)},CancelTaskHandler(e){this.cancelTaskName=e;e.includes("HR");this.$swal.fire({title:"確定要取消任務?",text:"任務ID "+e,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.SendCancelTaskRequest()}))},async SendCancelTaskRequest(){try{await v.J8.Cancel(this.cancelTaskName)}catch(e){e.response&&401===e.response.status&&(console.error("Unauthorized access. Please log in again."),_.HP.commit("setUser",null),this.$swal.fire({text:"",title:"請先進行登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{T.Z.emit("/show-login-view-invoke")})))}},GetTaskStateType(e){return b(e)},GetStationName(e){if(-1==e)return"-";var t=this.MapPoints.find((t=>t.TagNumber+""==e));return t?t.Graph.Display:e},row_class_name({row:e,rowIndex:t}){return"task-row"}},mounted(){this.columnsSizeSetting=A("runningTaskTable-column-size")}},D=a(83744);const x=(0,D.Z)(V,[["render",y]]);var M=x;const W={class:"completed-task-table"};function I(e,t,a,n,o,r){const l=(0,i.up)("el-table-column"),d=(0,i.up)("el-tag"),c=(0,i.up)("el-table");return(0,i.wg)(),(0,i.iD)("div",W,[(0,i.Wm)(c,{"header-cell-style":{color:"black",backgroundColor:"white"},data:a.CompletedTaskList,"row-key":"TaskName",size:"small",border:"",height:a.height,"row-class-name":r.row_class_name,"empty-text":e.$t("TaskTable.NoTasks")},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{label:e.$t("TaskTable.TaskName"),prop:"TaskName",width:"180"},null,8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.ExcuteAgvName"),prop:"DesignatedAGVName"},null,8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.RecievedTime"),prop:"RecieveTime_Formated",width:"80"},null,8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.FinishTime"),prop:"FinishTime_Formated",width:"80"},null,8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.TaskStatus"),prop:"StateName",width:"80"},{default:(0,i.w5)((e=>[(0,i.Wm)(d,{effect:"dark",type:r.GetTaskStateType(e.row.State)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.StateName),1)])),_:2},1032,["type"])])),_:1},8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.Action"),prop:"ActionName",width:"60"},{default:(0,i.w5)((e=>[(0,i.Wm)(d,{effect:"dark",type:8==e.row.Action||14==e.row.Action?"warning":""},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(e.row.ActionName),1)])),_:2},1032,["type"])])),_:1},8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.CstID"),prop:"Carrier_ID"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID),1)])),_:1},8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.Source")},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(r.GetStationName(e.row.From_Station)),1)])),_:1},8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.Destine")},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(r.GetStationName(e.row.To_Station)),1)])),_:1},8,["label"]),(0,i.Wm)(l,{label:e.$t("TaskTable.Dispatcher"),prop:"DispatcherName"},null,8,["label"])])),_:1},8,["data","height","row-class-name","empty-text"])])}var E={props:{CompletedTaskList:{type:Array,default(){return[]}},height:{type:String,default(){return"210px"}}},computed:{MapPoints(){return Object.values(S.p.getters.MapData.Points)}},methods:{GetTaskStateType(e){return b(e)},GetStationName(e){if(-1==e)return"-";var t=this.MapPoints.find((t=>t.TagNumber+""==e));return t?t.Graph.Display:e},row_class_name({row:e,rowIndex:t}){return"task-row"}}};const P=(0,D.Z)(E,[["render",I]]);var L=P,O={components:{RunningTaskTable:M,CompletedTaskTable:L},props:{display_mode:{type:String,default:"tabs"},show_card_title:{type:Boolean,default:!0},height:{type:String,defualt:"310px"}},data(){return{showCancelTaskConfirm:!1,cancelTaskName:"",ShowSettingsDrawer:!1,Settings:{ShowTrafficTask:!0}}},mounted(){},computed:{taskCancelable(){return _.HP.getters.IsLogin},IncompletedTaskListTbData(){return this.Settings.ShowTrafficTask?this.IncompletedTaskList:this.IncompletedTaskList.filter((e=>!e.DispatcherName.toUpperCase().includes("TRAFFIC")))},CompletedTaskListTbData(){return this.Settings.ShowTrafficTask?this.CompletedTaskList:this.CompletedTaskList.filter((e=>!e.DispatcherName.toUpperCase().includes("TRAFFIC")))},IncompletedTaskList(){return _.Ys.getters.IncompletedTaskList},CompletedTaskList(){return _.Ys.getters.CompletedTaskList}},methods:{}};const N=(0,D.Z)(O,[["render",p],["__scopeId","data-v-1bd34481"]]);var R=N},91475:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Et}});var i=a(66252),s=a(3577),n=a(49963);const o=e=>((0,i.dD)("data-v-2da63161"),e=e(),(0,i.Cn)(),e),r={id:"map",class:"map-component"},l={class:"d-flex flex-row h-100"},d={class:"flex-fill d-flex flex-column"},c={key:0,class:"w-100 bg-primary text-light rounded p-2 select-mode"},u={class:"d-flex h-100",style:{"overflow-y":"hidden"}},m={key:0,class:"p-0 m-0 w-100"},h={key:1,class:"tab-open text-start"},g={class:"p-2 action-buttons border-bottom"},p={class:"text-start border p-3"},_={class:"border p-3"},w={class:"border p-3"},f={class:"w-100 h-100 d-flex"},y={class:"notifiers",style:{position:"absolute",width:"622px",margin:"12px 60px"}},v={key:0,class:"cursour-coordination-show d-flex flex-column"},b={style:{color:"rgb(24, 24, 24)"}},S={class:"grid-size-text"},k=["id"],C={class:"options bg-light border-start text-start px-1 py-3"},A={key:0,class:"rounded d-flex flex-column"},T=o((()=>(0,i._)("span",{class:"border-bottom"},"顯示名稱",-1))),V=o((()=>(0,i._)("span",{class:"mx-1"},"地圖模式",-1))),D={key:1},x=o((()=>(0,i._)("span",{class:"mx-1"},"AGV 顯示",-1))),M=o((()=>(0,i._)("span",{class:"mx-1"},"地圖背景",-1))),W=o((()=>(0,i._)("span",{class:"mx-1"},"路網顯示",-1))),I=o((()=>(0,i._)("span",{class:"mx-1"},"管制區顯示",-1))),E={key:2,class:"rounded"},P=o((()=>(0,i._)("span",{class:"mx-1"},"AGV上報點位模式",-1))),L={class:"bg-light text-start d-flex py-2"};function O(e,t,a,o,O,N){const R=(0,i.up)("b-button"),G=(0,i.up)("el-radio-button"),H=(0,i.up)("el-radio-group"),U=(0,i.up)("el-form-item"),B=(0,i.up)("el-popover"),q=(0,i.up)("el-form"),F=(0,i.up)("b-tab"),z=(0,i.up)("el-input-number"),j=(0,i.up)("el-divider"),Z=(0,i.up)("el-button"),$=(0,i.up)("ImageEditor"),Y=(0,i.up)("el-dialog"),Q=(0,i.up)("el-switch"),K=(0,i.up)("el-color-picker"),J=(0,i.up)("el-slider"),X=(0,i.up)("el-table-column"),ee=(0,i.up)("el-table"),te=(0,i.up)("b-tabs"),ae=(0,i.up)("el-alert"),ie=(0,i.up)("el-radio"),se=(0,i.up)("el-tooltip"),ne=(0,i.up)("PointContextMenu"),oe=(0,i.up)("MapPointSettingDrawer"),re=(0,i.up)("MapPathSettingDrawer"),le=(0,i.up)("MapRegionEditDrawer"),de=(0,i.up)("el-tag"),ce=(0,i.Q2)("loading");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",l,[(0,i._)("div",d,[O.IsSelectAGVMode?((0,i.wg)(),(0,i.iD)("div",c,"選擇 AGV")):(0,i.kq)("",!0),O.IsSelectEQStationMode?((0,i.wg)(),(0,i.iD)("div",{key:1,class:(0,s.C_)(["w-100 text-light rounded p-2 select-mode","charge"==O.TaskDispatchOptions.action_type?"bg-warning":"bg-primary"])},(0,s.zw)("charge"==O.TaskDispatchOptions.action_type?"選擇[充電站]":""+("source"==O.TaskDispatchOptions.direction?"選擇[來源]設備":"選擇[終點]設備")),3)):(0,i.kq)("",!0),(0,i._)("div",u,["edit"==O.EditorOption.EditMode&&a.editable?((0,i.wg)(),(0,i.iD)("div",{key:0,class:(0,s.C_)([O.left_tab_class_name,"border bg-light"])},["tab-close"==O.left_tab_class_name?((0,i.wg)(),(0,i.iD)("div",m,[(0,i._)("i",{onClick:t[0]||(t[0]=()=>{O.left_tab_class_name="tab-open"==O.left_tab_class_name?"tab-close":"tab-open"}),class:"bi bi-chevron-double-right"})])):((0,i.wg)(),(0,i.iD)("div",h,[(0,i._)("i",{onClick:t[1]||(t[1]=()=>{O.left_tab_class_name="tab-open"==O.left_tab_class_name?"tab-close":"tab-open"}),class:"bi bi-chevron-double-left"}),(0,i._)("div",g,[(0,i.Wm)(R,{size:"sm",variant:"primary",onClick:N.HandlerSaveBtnClick},{default:(0,i.w5)((()=>[(0,i.Uk)("儲存")])),_:1},8,["onClick"]),(0,i.Wm)(R,{size:"sm",variant:"danger",onClick:N.ReloadMap},{default:(0,i.w5)((()=>[(0,i.Uk)("重新載入")])),_:1},8,["onClick"]),(0,i.Wm)(R,{size:"sm",variant:"danger",onClick:N.ClearMap},{default:(0,i.w5)((()=>[(0,i.Uk)("重置圖資")])),_:1},8,["onClick"])]),(0,i.Wm)(te,{style:{"background-color":"white"},fill:"",class:"p-1",modelValue:O.selectedSettingTabIndex,"onUpdate:modelValue":t[25]||(t[25]=e=>O.selectedSettingTabIndex=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{title:"路網編輯",active:""},{default:(0,i.w5)((()=>[(0,i._)("div",p,[(0,i.Wm)(q,{size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{label:"點位"},{default:(0,i.w5)((()=>[(0,i.Wm)(H,{style:(0,s.j5)(N.radio_group_style),disabled:"edit"!=O.EditorOption.EditMode,modelValue:O.EditorOption.EditAction,"onUpdate:modelValue":t[2]||(t[2]=e=>O.EditorOption.EditAction=e),onChange:t[3]||(t[3]=()=>{N.RemoveAllInteractions(),N.RemoveInteraction(O.draw_forbid_regions_interaction),N.AddEditMapInteraction()}),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(G,{size:"small",label:"add-station"},{default:(0,i.w5)((()=>[(0,i.Uk)("新增點位[1]")])),_:1}),(0,i.Wm)(G,{size:"small",label:"edit-station"},{default:(0,i.w5)((()=>[(0,i.Uk)("編輯點位[2]")])),_:1}),(0,i.Wm)(G,{size:"small",label:"remove-station"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除點位[3]")])),_:1})])),_:1},8,["style","disabled","modelValue"])])),_:1}),(0,i.Wm)(U,{label:"路徑"},{default:(0,i.w5)((()=>[(0,i.Wm)(H,{class:"mx-1",disabled:"edit"!=O.EditorOption.EditMode,modelValue:O.EditorOption.EditAction,"onUpdate:modelValue":t[6]||(t[6]=e=>O.EditorOption.EditAction=e),onChange:t[7]||(t[7]=()=>{N.RemoveAllInteractions(),O.PathEditTempStore=[],N.RemoveInteraction(O.draw_forbid_regions_interaction),N.AddEditMapInteraction()}),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{placement:"bottom-end",title:"路徑方向",width:180,trigger:"click",teleported:!1,visible:"add-path"==O.EditorOption.EditAction},{reference:(0,i.w5)((()=>[(0,i.Wm)(G,{size:"small",label:"add-path"},{default:(0,i.w5)((()=>[(0,i.Uk)("新增路徑[4]")])),_:1})])),default:(0,i.w5)((()=>[(0,i.Wm)(H,{class:"mx-1 my-1",modelValue:O.EditorOption.AddPathMode.Direction,"onUpdate:modelValue":t[4]||(t[4]=e=>O.EditorOption.AddPathMode.Direction=e),onChange:t[5]||(t[5]=()=>{N.RemoveInteraction(O.draw_forbid_regions_interaction)}),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(G,{label:"one-direction"},{default:(0,i.w5)((()=>[(0,i.Uk)("單向")])),_:1}),(0,i.Wm)(G,{label:"bi-direction"},{default:(0,i.w5)((()=>[(0,i.Uk)("雙向")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["visible"]),(0,i.Wm)(G,{size:"small",label:"edit-path"},{default:(0,i.w5)((()=>[(0,i.Uk)("編輯路徑[5]")])),_:1}),(0,i.Wm)(G,{size:"small",label:"remove-path"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除路徑[6]")])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1}),(0,i.Wm)(U,{label:"區域"},{default:(0,i.w5)((()=>[(0,i.Wm)(H,{class:"mx-1",disabled:"edit"!=O.EditorOption.EditMode,modelValue:O.EditorOption.EditAction,"onUpdate:modelValue":t[12]||(t[12]=e=>O.EditorOption.EditAction=e),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{placement:"bottom-end",title:"管制區域類型",width:180,trigger:"click",teleported:!1,visible:"add-forbid-region"==O.EditorOption.EditAction},{reference:(0,i.w5)((()=>[(0,i.Wm)(G,{onClick:t[8]||(t[8]=e=>N.HandleAddForbidRegionClicked(O.EditorOption.AddRegionMode.Mode)),size:"small",label:"add-forbid-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("新增管制區[7]")])),_:1})])),default:(0,i.w5)((()=>[(0,i.Wm)(H,{class:"mx-1 my-1",modelValue:O.EditorOption.AddRegionMode.Mode,"onUpdate:modelValue":t[11]||(t[11]=e=>O.EditorOption.AddRegionMode.Mode=e),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(G,{onClick:t[9]||(t[9]=e=>N.HandleAddForbidRegionClicked("forbid")),size:"small",label:"forbid"},{default:(0,i.w5)((()=>[(0,i.Uk)("禁制區")])),_:1}),(0,i.Wm)(G,{onClick:t[10]||(t[10]=e=>N.HandleAddForbidRegionClicked("passible")),size:"small",label:"passible"},{default:(0,i.w5)((()=>[(0,i.Uk)("通行區")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["visible"]),(0,i.Wm)(G,{onClick:N.HandleEditForbidRegionClicked,size:"small",label:"edit-forbid-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("編輯管制區[8]")])),_:1},8,["onClick"]),(0,i.Wm)(G,{onClick:N.HandleDeleteForbidRegionClicked,size:"small",label:"remove-forbid-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除管制區[9]")])),_:1},8,["onClick"]),(0,i.Wm)(G,{onClick:N.HandleDrawGlobalPathRegionClicked,size:"small",label:"add-global-path-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("繪製道路區域")])),_:1},8,["onClick"])])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1})])])),_:1}),(0,i.Wm)(F,{title:"地圖與網格"},{default:(0,i.w5)((()=>[(0,i._)("div",_,[(0,i.Wm)(q,{size:"large","label-width":"120","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{label:"網格尺寸(公尺)"},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{min:1,step:.1,onChange:N.ModifyGridSize,modelValue:O.MapGridSizeStore,"onUpdate:modelValue":t[13]||(t[13]=e=>O.MapGridSizeStore=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(U,{label:"水平Offset(公尺)"},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{step:.1,onChange:N.ModifyGridOffset,modelValue:O.MapGridSizeXOffset,"onUpdate:modelValue":t[14]||(t[14]=e=>O.MapGridSizeXOffset=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(U,{label:"垂直Offset(公尺)"},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{step:.1,onChange:N.ModifyGridOffset,modelValue:O.MapGridSizeYOffset,"onUpdate:modelValue":t[15]||(t[15]=e=>O.MapGridSizeYOffset=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(U,{label:"旋轉"},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{step:1,min:-180,max:180,onChange:N.ModifyMapRotation,modelValue:O.MapRotation,"onUpdate:modelValue":t[16]||(t[16]=e=>O.MapRotation=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(j),(0,i.Wm)(U,{class:"",label:"地圖背景編輯"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{size:"large",onClick:N.ImageEditClick},{default:(0,i.w5)((()=>[(0,i.Uk)("上傳與修改")])),_:1},8,["onClick"]),(0,i.Wm)(Y,{modelValue:O.ShowImageEditorDialog,"onUpdate:modelValue":t[17]||(t[17]=e=>O.ShowImageEditorDialog=e),class:""},{default:(0,i.w5)((()=>[(0,i.Wm)($,{onOnCropDone:N.HandleImageCropedDone,ref:"imageEditor"},null,8,["onOnCropDone"])])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(U,{label:"調整圖片位置"},{default:(0,i.w5)((()=>[(0,i.Wm)(Q,{size:"large","active-text":"開啟","inactive-text":"關閉","inline-prompt":"",modelValue:O.DragBackgroundImageMode,"onUpdate:modelValue":t[18]||(t[18]=e=>O.DragBackgroundImageMode=e),onChange:t[19]||(t[19]=()=>{O.new_map_img_extent=N.map_img_extent,"visible"!=O.map_image_display&&O.DragBackgroundImageMode&&(O.map_image_display="visible",N.SlamImageDisplayOptHandler())})},null,8,["modelValue"])])),_:1}),(0,i.Wm)(j),(0,i.Wm)(U,{label:"重置路網顯示"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{type:"danger",onClick:N.ResetRouteModeDisplay},{default:(0,i.w5)((()=>[(0,i.Uk)("重置")])),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1}),(0,i.Wm)(F,{title:"樣式"},{default:(0,i.w5)((()=>[(0,i._)("div",w,[(0,i.Wm)(q,{size:"large","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{"content-position":"left"},{default:(0,i.w5)((()=>[(0,i.Uk)("路徑")])),_:1}),(0,i.Wm)(U,{label:"顏色"},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{"show-alpha":"",size:"large",modelValue:O.MapStyles.PathColor,"onUpdate:modelValue":t[20]||(t[20]=e=>O.MapStyles.PathColor=e),onActiveChange:N.HandlePathColorSelected},null,8,["modelValue","onActiveChange"])])),_:1}),(0,i.Wm)(j,{"content-position":"left"},{default:(0,i.w5)((()=>[(0,i.Uk)("一般點位")])),_:1}),(0,i.Wm)(U,{label:"顯示顏色"},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{"show-alpha":"",size:"large",modelValue:O.MapStyles.NormalPointNameColor,"onUpdate:modelValue":t[21]||(t[21]=e=>O.MapStyles.NormalPointNameColor=e),onActiveChange:N.HandleNormalPointNameColorSelected},null,8,["modelValue","onActiveChange"])])),_:1}),(0,i.Wm)(U,{label:"字體大小"},{default:(0,i.w5)((()=>[(0,i.Wm)(J,{onChange:N.HandleNormalStationTextSizeChanged,size:"large",modelValue:O.MapStyles.NormalPointTextFontSize,"onUpdate:modelValue":t[22]||(t[22]=e=>O.MapStyles.NormalPointTextFontSize=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(j,{"content-position":"left"},{default:(0,i.w5)((()=>[(0,i.Uk)("設備點位")])),_:1}),(0,i.Wm)(U,{label:"顯示顏色"},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{"show-alpha":"",size:"large",modelValue:O.MapStyles.WorkStationPointNameColor,"onUpdate:modelValue":t[23]||(t[23]=e=>O.MapStyles.WorkStationPointNameColor=e),onActiveChange:N.HandleWorkStationNameColorSelected},null,8,["modelValue","onActiveChange"])])),_:1}),(0,i.Wm)(U,{label:"字體大小"},{default:(0,i.w5)((()=>[(0,i.Wm)(J,{onChange:N.HandleWorkStationTextSizeChanged,size:"large",modelValue:O.MapStyles.WorkStationPointTextFontSize,"onUpdate:modelValue":t[24]||(t[24]=e=>O.MapStyles.WorkStationPointTextFontSize=e)},null,8,["onChange","modelValue"])])),_:1})])),_:1})])])),_:1}),(0,i.kq)("",!0),(0,i.kq)("",!0)])),_:1},8,["modelValue"])]))],2)):(0,i.kq)("",!0),(0,i._)("div",f,[(0,i._)("div",y,[a.editable&&"add-station"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:0,class:"notify-text",title:"使用滑鼠[右鍵]點擊地圖新增點位",type:"success"})):(0,i.kq)("",!0),a.editable&&"edit-station"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:1,class:"notify-text",title:"使用滑鼠[右鍵]選擇欲編輯之點位",type:"success"})):(0,i.kq)("",!0),a.editable&&"remove-station"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:2,class:"notify-text",title:"使用滑鼠[左鍵]選擇欲刪除之點位",type:"error"})):(0,i.kq)("",!0),a.editable&&"add-path"==O.EditorOption.EditAction&&"one-direction"==O.EditorOption.AddPathMode.Direction?((0,i.wg)(),(0,i.j4)(ae,{key:3,class:"notify-text",title:"使用滑鼠[左鍵]點擊地圖上任意兩個點位以新增一條單行道",type:"success"})):(0,i.kq)("",!0),a.editable&&"add-path"==O.EditorOption.EditAction&&"bi-direction"==O.EditorOption.AddPathMode.Direction?((0,i.wg)(),(0,i.j4)(ae,{key:4,class:"notify-text",title:"使用滑鼠[左鍵]點擊地圖上任意兩個點位以新增一條雙向道",type:"success"})):(0,i.kq)("",!0),a.editable&&"edit-path"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:5,class:"notify-text",title:"使用滑鼠[右鍵]選擇欲編輯之路徑",type:"success"})):(0,i.kq)("",!0),a.editable&&"remove-path"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:6,class:"notify-text",title:"使用滑鼠[左鍵]選擇欲刪除之路徑",type:"error"})):(0,i.kq)("",!0),a.editable&&"add-forbid-region"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:7,class:"notify-text",title:`使用滑鼠[左鍵/右鍵]在地圖上繪製[${"forbid"==O.EditorOption.AddRegionMode.Mode?"禁制":"通行"}]區(按下[ESC]可取消繪製)`,type:"success"},null,8,["title"])):(0,i.kq)("",!0),a.editable&&"edit-forbid-region"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:8,class:"notify-text",title:"使用滑鼠[左鍵]在地圖上選取欲編輯之管制區)",type:"success"})):(0,i.kq)("",!0),a.editable&&"remove-forbid-region"==O.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(ae,{key:9,class:"notify-text",title:"使用滑鼠[左鍵]在地圖上點擊欲刪除之管制區",type:"error"})):(0,i.kq)("",!0),a.editable&&O.DragBackgroundImageMode?((0,i.wg)(),(0,i.j4)(ae,{key:10,class:"notify-text",title:"使用滑鼠[右鍵]點擊並拖曳背景圖片進行位置調整",type:"error"})):(0,i.kq)("",!0)]),((0,i.wg)(),(0,i.iD)("div",v,[(0,i._)("span",b,(0,s.zw)(N.MouseCoordinationDisplay),1),(0,i._)("div",S,"Grid Size:"+(0,s.zw)(N.MapGridSize)+"m",1)])),(0,i._)("div",{id:a.id,class:"agv_map flex-fll",onContextmenu:t[26]||(t[26]=e=>N.showContextMenu(e))},null,40,k),(0,i._)("div",C,[a.station_show?((0,i.wg)(),(0,i.iD)("div",A,[T,(0,i.Wm)(H,{modelValue:O.station_name_display_mode,"onUpdate:modelValue":t[27]||(t[27]=e=>O.station_name_display_mode=e),onChange:N.StationNameDisplayOptHandler},{default:(0,i.w5)((()=>[(0,i.Wm)(ie,{label:"index",size:"large"},{default:(0,i.w5)((()=>[(0,i.Uk)("Index")])),_:1}),(0,i.Wm)(ie,{label:"name",size:"large"},{default:(0,i.w5)((()=>[(0,i.Uk)("Name")])),_:1}),(0,i.Wm)(ie,{label:"tag",size:"large"},{default:(0,i.w5)((()=>[(0,i.Uk)("Tag")])),_:1})])),_:1},8,["modelValue","onChange"])])):(0,i.kq)("",!0),(0,i._)("div",null,[V,(0,i.Wm)(Q,{onChange:N.MapDisplayModeOptHandler,"inactive-value":"router","active-value":"coordination",width:"70",modelValue:O.map_display_mode,"onUpdate:modelValue":t[28]||(t[28]=e=>O.map_display_mode=e),"inline-prompt":"","inactive-text":"路網","active-text":"Slam","inactive-color":"seagreen"},null,8,["onChange","modelValue"])]),a.agv_show?((0,i.wg)(),(0,i.iD)("div",D,[x,(0,i.Wm)(Q,{onChange:N.AgvDisplayOptHandler,"inactive-value":"none","active-value":"visible",width:"70",modelValue:O.agv_display,"onUpdate:modelValue":t[29]||(t[29]=e=>O.agv_display=e),"inline-prompt":"","inactive-text":"隱藏","active-text":"顯示","inactive-color":"rgb(146, 148, 153)"},null,8,["onChange","modelValue"])])):(0,i.kq)("",!0),(0,i._)("div",null,[M,(0,i.Wm)(Q,{modelValue:O.map_image_display,"onUpdate:modelValue":t[30]||(t[30]=e=>O.map_image_display=e),"inactive-value":"none","inactive-text":"隱藏","active-value":"visible","active-text":"顯示","inactive-color":"rgb(146, 148, 153)","inline-prompt":"",width:"70",onChange:N.SlamImageDisplayOptHandler},null,8,["modelValue","onChange"])]),(0,i._)("div",null,[W,(0,i.Wm)(Q,{modelValue:O.routePathsVisible,"onUpdate:modelValue":t[31]||(t[31]=e=>O.routePathsVisible=e),"inactive-text":"隱藏","active-text":"顯示","inline-prompt":"","inactive-color":"rgb(146, 148, 153)",width:"70",onChange:t[32]||(t[32]=e=>{e?"router"==O.map_display_mode?(O.PathLayerForCoordination.setVisible(!1),O.PathLayerForRouter.setVisible(!0)):(O.PathLayerForCoordination.setVisible(!0),O.PathLayerForRouter.setVisible(!1)):(O.PathLayerForCoordination.setVisible(!1),O.PathLayerForRouter.setVisible(!1)),N.HideNormalStations(!e)})},null,8,["modelValue"])]),(0,i._)("div",null,[I,(0,i.Wm)(Q,{disabled:"coordination"!=O.map_display_mode,modelValue:O.regionsVisible,"onUpdate:modelValue":t[33]||(t[33]=e=>O.regionsVisible=e),"inactive-text":"隱藏","active-text":"顯示","inline-prompt":"","inactive-color":"rgb(146, 148, 153)",width:"70",onChange:t[34]||(t[34]=e=>{O.RegionLayer.setVisible(e&&"coordination"==O.map_display_mode)})},null,8,["disabled","modelValue"])]),a.editable?((0,i.wg)(),(0,i.iD)("div",E,[(0,i.Wm)(se,{content:"開啟後於車載畫面上傳座標資訊後將會自動新增點位至地圖上"},{default:(0,i.w5)((()=>[P])),_:1}),(0,i.Wm)(Q,{class:"my-2","inactive-text":"OFF","active-text":"ON","inline-prompt":"",width:"70",modelValue:O.agv_upload_coordination_mode,"onUpdate:modelValue":t[35]||(t[35]=e=>O.agv_upload_coordination_mode=e),onChange:N.HandleAGVUploadCorrdinationChanged},null,8,["modelValue","onChange"])])):(0,i.kq)("",!0)])])])])]),(0,i.wy)((0,i.Wm)(ne,{ref:"EditModeContextMenu",mouse_click_position:[O.contextMenuTop,O.contextMenuLeft],options:O.contextMenuOptions,onOnTaskBtnClick:N.HandleMenuTaskBtnClick,onOnPtSettingBtnClick:N.HandlePtSettingBtnClick},null,8,["mouse_click_position","options","onOnTaskBtnClick","onOnPtSettingBtnClick"]),[[n.F8,O.editModeContextMenuVisible]]),(0,i.Wm)(oe,{ref:"ptsetting",onOnLeve:N.HandlePtSettingDrawerLeaved,onOnPointSettingChanged:N.PointSettingChangedHandle},null,8,["onOnLeve","onOnPointSettingChanged"]),(0,i.Wm)(re,{SettingsChangedHandler:()=>{N.UpdateStationPathLayer(),N.HandlePathTbRowClick(O.SelectedPathData)},onClosed:N.HandlePathSetingDrawerClosed,ref:"path_editor"},null,8,["SettingsChangedHandler","onClosed"]),(0,i.Wm)(le,{onClosed:N.HandleForbidRegionEditDrawerClosed,ref:"forbid_region_editor",SettingsChangedHandler:()=>{}},null,8,["onClosed"]),(0,i.Wm)(Y,{onClosed:t[38]||(t[38]=()=>{O.selected_path_feature&&N.RestoreOriginalPathStyle(O.selected_path_feature)}),draggable:"",width:"600",title:"路徑選取",modelValue:O.ShowPathSelectDialog,"onUpdate:modelValue":t[39]||(t[39]=e=>O.ShowPathSelectDialog=e)},{default:(0,i.w5)((()=>[(0,i._)("div",L,[(0,i.Wm)(R,{size:"sm",variant:"success",onClick:t[36]||(t[36]=()=>{O.PathesCandicats.forEach((e=>{e.IsPassable=!0})),N.UpdateStationPathLayer(),N.HandlePathTbRowClick(O.SelectedPathData)})},{default:(0,i.w5)((()=>[(0,i.Uk)("開放所有道路")])),_:1}),(0,i.Wm)(R,{class:"mx-2",variant:"danger",size:"sm",onClick:t[37]||(t[37]=()=>{O.PathesCandicats.forEach((e=>{e.IsPassable=!1})),N.UpdateStationPathLayer(),N.HandlePathTbRowClick(O.SelectedPathData)})},{default:(0,i.w5)((()=>[(0,i.Uk)("關閉所有道路")])),_:1})]),(0,i.Wm)(ee,{data:O.PathesCandicats,border:""},{default:(0,i.w5)((()=>[(0,i.Wm)(X,{label:"ID",prop:"PathID"},{default:(0,i.w5)((e=>[(0,i.Wm)(de,{effect:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.PathID),1)])),_:2},1024)])),_:1}),(0,i.Wm)(X,{label:"起點Index",prop:"StartPtIndex"}),(0,i.Wm)(X,{label:"終點Index",prop:"EndPtIndex"}),(0,i.Wm)(X,{label:"狀態",prop:"IsPassable"},{default:(0,i.w5)((e=>[(0,i.Wm)(de,{effect:"dark",type:e.row.IsPassable?"success":"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.IsPassable?"開放":"封閉"),1)])),_:2},1032,["type"])])),_:1}),(0,i.Wm)(X,null,{default:(0,i.w5)((e=>[(0,i.Wm)(R,{variant:"primary",onClick:t=>N.HandlePathSelected(e.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("選取")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])),[[ce,O.loading]])}a(57658);var N=a(81090),R=a(42763),G=a(60188),H=a(33376),U=a(92083),B=a(63267),q=a(14515),F=a(40809),z=a(29619),j=a(3138),Z=a(12327),$=a(19649),Y=a(74818),Q=a(47539),K=a(58958),J=a(51345),X=a(21280),ee=a(30283),te=a(81332),ae=a(69242),ie=a(57276),se=a(98683),ne=a(53259),oe=a(79072),re=a(95320),le=a(24239);const de=(0,i._)("div",null," ??? ",-1);function ce(e,t,a,s,n,o){const r=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.j4)(r,{draggable:"",modal:!1,title:"地圖設置",modelValue:n.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.show=e)},{default:(0,i.w5)((()=>[de])),_:1},8,["modelValue"])}var ue={data(){return{show:!1}}},me=a(83744);const he=(0,me.Z)(ue,[["render",ce]]);var ge=he;const pe={key:0,class:"menu task"},_e={key:0},we={key:1,class:"d-flex flex-column"},fe={key:2},ye={key:3},ve={key:1,class:"menu edit"},be={class:"my-header"},Se={class:"w-100 text-center",style:{"padding-left":"50px"}};function ke(e,t,a,n,o,r){const l=(0,i.up)("b-button"),d=(0,i.up)("RackVue"),c=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.iD)("div",{class:"map-menu border",style:(0,s.j5)(r.menu_style)},[(0,i._)("div",{class:(0,s.C_)(["title border-bottom",r.station_data.Enable?"text-primary":"text-danger"])},(0,s.zw)(a.options.title+(r.station_data.Enable?"":"(已禁用)")),3),a.options.show_task_dispatch?((0,i.wg)(),(0,i.iD)("div",pe,[(0,i._)("span",null,"站點類型 : "+(0,s.zw)(r.station_data.IsVirtualPoint?"虛擬點":a.options.task_options.StationType),1),0!=r.station_type||r.station_data.IsVirtualPoint?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",_e,[(0,i.Wm)(l,{variant:"primary",onClick:t[0]||(t[0]=()=>{e.$emit("OnTaskBtnClick",{action:"move",station_data:r.station_data})})},{default:(0,i.w5)((()=>[(0,i.Uk)("移動")])),_:1})])),1==r.station_type||2==r.station_type||4==r.station_type||5==r.station_type?((0,i.wg)(),(0,i.iD)("div",we,[4==r.station_type||41==r.station_type||5==r.station_type?((0,i.wg)(),(0,i.j4)(l,{key:0,variant:"primary",onClick:r.ShowRackInfoBtnClick},{default:(0,i.w5)((()=>[(0,i.Uk)("RACK資訊")])),_:1},8,["onClick"])):(0,i.kq)("",!0),(0,i.Wm)(l,{variant:"primary",onClick:t[1]||(t[1]=()=>{e.$emit("OnTaskBtnClick",{action:"unload",station_data:r.station_data})})},{default:(0,i.w5)((()=>[(0,i.Uk)("取貨")])),_:1}),(0,i.Wm)(l,{variant:"primary",onClick:t[2]||(t[2]=()=>{e.$emit("OnTaskBtnClick",{action:"load",station_data:r.station_data})})},{default:(0,i.w5)((()=>[(0,i.Uk)("放貨")])),_:1}),(0,i.Wm)(l,{variant:"primary",onClick:t[3]||(t[3]=()=>{e.$emit("OnTaskBtnClick",{action:"carry",station_data:r.station_data})})},{default:(0,i.w5)((()=>[(0,i.Uk)("搬運")])),_:1}),5==r.station_type?((0,i.wg)(),(0,i.j4)(l,{key:1,variant:"primary",onClick:t[4]||(t[4]=()=>{e.$emit("OnTaskBtnClick",{action:"charge",station_data:r.station_data})})},{default:(0,i.w5)((()=>[(0,i.Uk)("充電")])),_:1})):(0,i.kq)("",!0)])):(0,i.kq)("",!0),3==r.station_type?((0,i.wg)(),(0,i.iD)("div",fe,[(0,i.Wm)(l,{variant:"primary",onClick:t[5]||(t[5]=()=>{e.$emit("OnTaskBtnClick",{action:"charge",station_data:r.station_data})})},{default:(0,i.w5)((()=>[(0,i.Uk)("充電")])),_:1})])):(0,i.kq)("",!0),r.station_data.IsParking&&!r.station_data.IsVirtualPoint?((0,i.wg)(),(0,i.iD)("div",ye,[(0,i.Wm)(l,{variant:"primary",onClick:t[6]||(t[6]=()=>{e.$emit("OnTaskBtnClick",{action:"park",station_data:r.station_data})})},{default:(0,i.w5)((()=>[(0,i.Uk)("停車")])),_:1})])):(0,i.kq)("",!0)])):((0,i.wg)(),(0,i.iD)("div",ve,[(0,i.Wm)(l,{variant:"primary",onClick:t[7]||(t[7]=()=>{e.$emit("OnPtSettingBtnClick","")})},{default:(0,i.w5)((()=>[(0,i.Uk)("設定點位")])),_:1})])),(0,i.Wm)(c,{style:(0,s.j5)({height:o.RackShowDialogHeight}),width:o.RackShowDialogWidth,modelValue:o.showRack,"onUpdate:modelValue":t[8]||(t[8]=e=>o.showRack=e),draggable:"",modal:!1},{header:(0,i.w5)((({})=>[(0,i._)("div",be,(0,s.zw)(o.RackName),1)])),default:(0,i.w5)((()=>[(0,i._)("div",Se,[(0,i.Wm)(d,{class:"mx-3",rackName:o.RackName},null,8,["rackName"])])])),_:1},8,["style","width","modelValue"])],4)}var Ce=a(3741),Ae={components:{RackVue:Ce.Z},props:{mouse_click_position:{type:Array,default(){return[0,0]}},options:{type:oe.xK,default(){return new oe.xK}}},computed:{menu_style(){return{top:this.mouse_click_position[0]+"px",left:this.mouse_click_position[1]+"px",backgroundColor:this.options.backgroundColor}},station_type(){return this.options.task_options.StationType},station_data(){return this.options.point_data}},data(){return{showRack:!1,RackName:"",RackShowDialogWidth:"50%",RackShowDialogHeight:"400px"}},methods:{ShowRackInfoBtnClick(){var e=le.jU.getters.WIPData;const t=e.filter((e=>{const t=Object.values(e.ColumnsTagMap);return t.some((e=>e.includes(this.station_data.TagNumber)))}));if(t){var a=t[0];console.log(a),this.RackName=a.WIPName,this.RackShowDialogWidth=200*a.Columns+"pt",this.RackShowDialogHeight=200*a.Rows+"pt",this.showRack=!0}}}};const Te=(0,me.Z)(Ae,[["render",ke],["__scopeId","data-v-44017bf1"]]);var Ve=Te;const De=e=>((0,i.dD)("data-v-11ba4c68"),e=e(),(0,i.Cn)(),e),xe={class:"map-point-setting-drawer"},Me={class:"header border-bottom"},We={class:"draw-content w-100 px-2"},Ie={class:"text-start py-2 d-flex"},Ee={class:"text-start d-flex"},Pe={class:"settings px-2"},Le={class:"d-flex mx-1 bg-light",style:{"flex-wrap":"wrap"}},Oe=De((()=>(0,i._)("div",{class:"image-slot"}," 錯誤 ",-1))),Ne={class:"tag"},Re=De((()=>(0,i._)("span",null,"ID",-1))),Ge=De((()=>(0,i._)("span",null,"X",-1))),He=De((()=>(0,i._)("span",null,"Y",-1))),Ue={class:"d-flex flex-column"},Be={class:"text-start"};function qe(e,t,a,o,r,l){const d=(0,i.up)("b-button"),c=(0,i.up)("el-input"),u=(0,i.up)("el-form-item"),m=(0,i.up)("el-button"),h=(0,i.up)("el-image"),g=(0,i.up)("el-upload"),p=(0,i.up)("el-option"),_=(0,i.up)("el-select"),w=(0,i.up)("el-input-number"),f=(0,i.up)("el-form"),y=(0,i.up)("el-collapse-item"),v=(0,i.up)("el-checkbox"),b=(0,i.up)("el-table-column"),S=(0,i.up)("el-table"),k=(0,i.up)("RegionsSelector"),C=(0,i.up)("el-collapse"),A=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",xe,[(0,i.Wm)(A,{modelValue:r.show,"onUpdate:modelValue":t[33]||(t[33]=e=>r.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,"show-close":!1,modal:!0,"modal-class":"modal-style","before-close":l.CancelBtnClickHandle},{header:(0,i.w5)((()=>[(0,i._)("div",Me,[(0,i._)("h3",null,"點位設定-"+(0,s.zw)(r.index),1)])])),default:(0,i.w5)((()=>[(0,i._)("div",We,[(0,i._)("div",Ie,[(0,i.Wm)(d,{variant:"danger",onClick:l.CancelBtnClickHandle},{default:(0,i.w5)((()=>[(0,i.Uk)("離開")])),_:1},8,["onClick"]),(0,i.Wm)(d,{variant:"primary",onClick:l.SaveBtnClickHandle},{default:(0,i.w5)((()=>[(0,i.Uk)("儲存")])),_:1},8,["onClick"]),(0,i.wy)((0,i._)("div",Ee,[(0,i.Wm)(d,{size:"sm",variant:"primary",onClick:l.Regist},{default:(0,i.w5)((()=>[(0,i.Uk)("註冊")])),_:1},8,["onClick"]),(0,i.Wm)(d,{size:"sm",variant:"danger",onClick:l.Unregist},{default:(0,i.w5)((()=>[(0,i.Uk)("解註冊")])),_:1},8,["onClick"])],512),[[n.F8,!0]])]),(0,i._)("div",Pe,[(0,i.Wm)(C,{modelValue:r.activeNames,"onUpdate:modelValue":t[32]||(t[32]=e=>r.activeNames=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{title:"基本設定",name:"1"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{"label-width":"120px","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{label:"Point Index"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:r.index,"onUpdate:modelValue":t[0]||(t[0]=e=>r.index=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"顯示名稱"},{default:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(c,{modelValue:r.pointData_editing.Graph.Display,"onUpdate:modelValue":t[1]||(t[1]=e=>r.pointData_editing.Graph.Display=e)},null,8,["modelValue"])]),(0,i._)("div",null,[(0,i.wy)((0,i.Wm)(m,{onClick:t[2]||(t[2]=e=>r.pointData_editing.Graph.Display=r.BindingEQInfo.Name)},{default:(0,i.w5)((()=>[(0,i.Uk)("使用繫連的EQ名稱")])),_:1},512),[[n.F8,l.IsEQPoint]])])])),_:1}),l.IsWorkStation?((0,i.wg)(),(0,i.j4)(u,{key:0,label:"顯示圖示"},{default:(0,i.w5)((()=>[(0,i._)("div",Le,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.EqIcons,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"icon-container",style:{width:"64px",height:"84px"},key:e},[(0,i.Wm)(h,{style:(0,s.j5)([{border:e==r.pointData_editing.Graph.ImageName?"3px solid rgb(49, 132, 253)":""},{width:"64px",height:"64px",padding:"3px","border-radius":"8px",cursor:"pointer"}]),src:e,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,fit:"cover",onClick:t=>l.HandleImageClick(e)},{error:(0,i.w5)((()=>[Oe])),_:2},1032,["style","src","onClick"]),(0,i.Wm)(d,{squared:"",class:"delete-btn",style:{position:"relative",bottom:"26px",width:"100%"},variant:"danger",size:"sm",onClick:t=>l.HandleIconDelete(e)},{default:(0,i.w5)((()=>[(0,i.Uk)("刪除")])),_:2},1032,["onClick"])])))),128)),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.fileList,(e=>((0,i.wg)(),(0,i.j4)(h,{key:e,style:(0,s.j5)([{border:e.url==r.pointData_editing.Graph.ImageName?"3px solid rgb(49, 132, 253)":""},{width:"64px",height:"64px",padding:"3px","border-radius":"8px",cursor:"pointer",border:"1px dashed red"}]),src:e.url,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,fit:"cover",onClick:t=>l.HandleImageClick(e)},null,8,["style","src","onClick"])))),128)),(0,i.Wm)(g,{"file-list":r.fileList,"onUpdate:fileList":t[3]||(t[3]=e=>r.fileList=e),action:l.icon_upload_url,"list-type":"picture-card","auto-upload":!0,"on-success":l.OnIconUploadSuccess,"show-file-list":!1},{default:(0,i.w5)((()=>[(0,i.Uk)(" 上傳圖示 ")])),_:1},8,["file-list","action","on-success"])])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(u,{label:"Tag"},{default:(0,i.w5)((()=>[(0,i._)("div",Ne,[(0,i._)("div",null,[Re,(0,i.Wm)(c,{modelValue:r.pointData_editing.TagNumber,"onUpdate:modelValue":t[4]||(t[4]=e=>r.pointData_editing.TagNumber=e),modelModifiers:{number:!0}},null,8,["modelValue"])]),(0,i._)("div",null,[Ge,(0,i.Wm)(c,{modelValue:r.pointData_editing.X,"onUpdate:modelValue":t[5]||(t[5]=e=>r.pointData_editing.X=e)},null,8,["modelValue"])]),(0,i._)("div",null,[He,(0,i.Wm)(c,{modelValue:r.pointData_editing.Y,"onUpdate:modelValue":t[6]||(t[6]=e=>r.pointData_editing.Y=e)},null,8,["modelValue"])])])])),_:1}),(0,i.Wm)(u,{label:"站點類型"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{modelValue:r.pointData_editing.StationType,"onUpdate:modelValue":t[7]||(t[7]=e=>r.pointData_editing.StationType=e),onChange:l.StationTypeOnChange},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.stationTypes,(e=>((0,i.wg)(),(0,i.j4)(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),(0,i.wy)((0,i._)("div",null,[(0,i.Wm)(c,{disabled:"",modelValue:r.BindingEQInfo.Name,"onUpdate:modelValue":t[8]||(t[8]=e=>r.BindingEQInfo.Name=e)},null,8,["modelValue"])],512),[[n.F8,l.IsEQPoint]])])),_:1}),(0,i.Wm)(u,{label:"角度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:r.pointData_editing.Direction,"onUpdate:modelValue":t[9]||(t[9]=e=>r.pointData_editing.Direction=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"避車角度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:r.pointData_editing.Direction_Avoid,"onUpdate:modelValue":t[10]||(t[10]=e=>r.pointData_editing.Direction_Avoid=e)},null,8,["modelValue"])])),_:1}),0!=r.pointData_editing.StationType?((0,i.wg)(),(0,i.j4)(u,{key:1,label:"二次定位點角度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:r.pointData_editing.Direction_Secondary_Point,"onUpdate:modelValue":t[11]||(t[11]=e=>r.pointData_editing.Direction_Secondary_Point=e)},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(u,{label:"雷射模式"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:r.pointData_editing.LsrMode,"onUpdate:modelValue":t[12]||(t[12]=e=>r.pointData_editing.LsrMode=e),step:1},null,8,["modelValue"]),(0,i._)("i",{class:"bi bi-question-circle information",onClick:t[13]||(t[13]=(...e)=>l.HandleLaserModeInfoIconClick&&l.HandleLaserModeInfoIconClick(...e))})])),_:1}),(0,i.Wm)(u,{label:"速度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:r.pointData_editing.Speed,"onUpdate:modelValue":t[14]||(t[14]=e=>r.pointData_editing.Speed=e),step:.1,precision:1},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"AGV閃避模式"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{modelValue:r.pointData_editing.DodgeMode,"onUpdate:modelValue":t[15]||(t[15]=e=>r.pointData_editing.DodgeMode=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{label:"0",value:0}),(0,i.Wm)(p,{label:"1",value:1}),(0,i.Wm)(p,{label:"2",value:2}),(0,i.Wm)(p,{label:"3",value:3}),(0,i.Wm)(p,{label:"4-一般道路橫向移動(巡檢AGV)",value:4}),(0,i.Wm)(p,{label:"5-電池交換橫向移動(巡檢AGV)",value:5}),(0,i.Wm)(p,{label:"6",value:6}),(0,i.Wm)(p,{label:"7",value:7}),(0,i.Wm)(p,{label:"8",value:8}),(0,i.Wm)(p,{label:"9",value:9}),(0,i.Wm)(p,{label:"10-取消任務時Pass站點(用於避免與WIP內AGV旋轉干涉)",value:10}),(0,i.Wm)(p,{label:"11-地標輔助修正(用於轉角或長走道起點，AGV會追Tag中心)",value:11}),(0,i.Wm)(p,{label:"12-里程計輔助定位(用於窄道)",value:12}),(0,i.Wm)(p,{label:"13",value:13}),(0,i.Wm)(p,{label:"14-里程計輔助定位、偵測色帶(用於窄道、脫離色帶會上報異常)",value:14})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"Direction"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{modelValue:r.pointData_editing.SpinMode,"onUpdate:modelValue":t[16]||(t[16]=e=>r.pointData_editing.SpinMode=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{label:"0-可旋轉",value:0}),(0,i.Wm)(p,{label:"1-不可旋轉",value:1}),(0,i.Wm)(p,{label:"2-向右旋轉",value:2}),(0,i.Wm)(p,{label:"3-向左旋轉",value:3})])),_:1},8,["modelValue"])])),_:1}),l.IsWorkStation?((0,i.wg)(),(0,i.j4)(u,{key:2,label:"任務權重"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{min:1,modelValue:r.pointData_editing.PriorityOfTask,"onUpdate:modelValue":t[17]||(t[17]=e=>r.pointData_editing.PriorityOfTask=e)},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1}),(0,i.Wm)(y,{title:"功能設定",name:"2"},{default:(0,i.w5)((()=>[(0,i._)("div",Ue,[(0,i.Wm)(v,{modelValue:r.pointData_editing.Enable,"onUpdate:modelValue":t[18]||(t[18]=e=>r.pointData_editing.Enable=e),label:"啟用"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsTrafficCheckPoint,"onUpdate:modelValue":t[19]||(t[19]=e=>r.pointData_editing.IsTrafficCheckPoint=e),label:"交管檢查點"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsStandbyPoint,"onUpdate:modelValue":t[20]||(t[20]=e=>r.pointData_editing.IsStandbyPoint=e),label:"停駐點"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsSegment,"onUpdate:modelValue":t[21]||(t[21]=e=>r.pointData_editing.IsSegment=e),label:"二次定位點"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsParking,"onUpdate:modelValue":t[22]||(t[22]=e=>r.pointData_editing.IsParking=e),label:"可停車點"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsAvoid,"onUpdate:modelValue":t[23]||(t[23]=e=>r.pointData_editing.IsAvoid=e),label:"避車點"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsVirtualPoint,"onUpdate:modelValue":t[24]||(t[24]=e=>r.pointData_editing.IsVirtualPoint=e),label:"虛擬點"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsAutoDoor,"onUpdate:modelValue":t[25]||(t[25]=e=>r.pointData_editing.IsAutoDoor=e),label:"自動門"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsExtinguishing,"onUpdate:modelValue":t[26]||(t[26]=e=>r.pointData_editing.IsExtinguishing=e),label:"消防設備"},null,8,["modelValue"]),(0,i.Wm)(v,{modelValue:r.pointData_editing.IsNarrowPath,"onUpdate:modelValue":t[27]||(t[27]=e=>r.pointData_editing.IsNarrowPath=e),label:"窄道"},null,8,["modelValue"])])])),_:1}),(0,i.Wm)(y,{title:"註冊點",name:"3"},{default:(0,i.w5)((()=>[(0,i._)("div",Be,[(0,i.Wm)(m,{onClick:t[28]||(t[28]=()=>{r.RegistersTable.push({index:void 0,tag:void 0,name:void 0})})},{default:(0,i.w5)((()=>[(0,i.Uk)("新增")])),_:1})]),(0,i.Wm)(S,{"row-key":"index",height:"320px",border:"",data:r.RegistersTable},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{label:"Index",prop:"index"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Wm)(_,{onChange:t=>l.HandleIndexSelected(e.row),modelValue:e.row.index,"onUpdate:modelValue":t=>e.row.index=t},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.pointsOptions,(e=>((0,i.wg)(),(0,i.j4)(p,{key:e.index,label:e.index,value:e.index},null,8,["label","value"])))),128))])),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])])])),_:1}),(0,i.Wm)(b,{label:"Tag",prop:"tag"}),(0,i.Wm)(b,{label:"Name",prop:"name"}),(0,i.Wm)(b,{label:"Name"},{default:(0,i.w5)((e=>[(0,i.Wm)(m,{onClick:()=>{r.RegistersTable.splice(r.RegistersTable.indexOf(e.row),1)},type:"danger",size:"small"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),(0,i.Wm)(y,{title:"分區設定",name:"4"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{label:"所屬區域"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{modelValue:r.pointData_editing.Region,"onUpdate:modelValue":t[29]||(t[29]=e=>r.pointData_editing.Region=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),3==r.pointData_editing.StationType||7==r.pointData_editing.StationType?((0,i.wg)(),(0,i.j4)(y,{key:0,title:"進出點位設定",name:"5"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{label:"進入點"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:r.pointData_editing.TagOfInPoint,"onUpdate:modelValue":t[30]||(t[30]=e=>r.pointData_editing.TagOfInPoint=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"退出點"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:r.pointData_editing.TagOfOutPoint,"onUpdate:modelValue":t[31]||(t[31]=e=>r.pointData_editing.TagOfOutPoint=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1},8,["modelValue"])])])])),_:1},8,["modelValue","before-close"])])}var Fe=a(64491),ze=a(83592),je=a(91747),Ze=a(49996),$e={components:{RegionsSelector:je.Z},data(){return{show:!1,index:-1,pointData:{},pointData_editing:new oe.ux,RegistersTable:[{index:0,tag:1,name:"1"}],activeNames:[],BindingEQInfo:{ConnOptions:{ConnMethod:0,IP:"127.0.0.1",Port:503,ComPort:"COM1"},Name:"LDULD#2",TagID:2},fileList:[]}},mounted(){},computed:{hasAnyChange(){var e=JSON.stringify(this.pointData),t=JSON.stringify(this.pointData_editing);return e!=t},IsEQPoint(){return 1==this.pointData_editing.StationType},IsWorkStation(){return 0!=this.pointData_editing.StationType},stationTypes(){return ze.Ml},potinFullName(){return`[${this.index}] ${this.pointData.Name}`},pointsOptions(){return re.p.getters.AllPointsOptions},icon_upload_url(){return"http://localhost:5216/api/map/IconUpload"},EqIcons(){return re.p.getters.EqIcons}},methods:{async Show(e){e.point&&(this.index=e.index,this.pointData=e.point,this.pointData_editing=JSON.parse(JSON.stringify(e.point)),this.InitRegisterTableData(),this.IsEQPoint&&(this.BindingEQInfo=await(0,Fe.CN)(this.pointData.TagNumber)),this.show=!0)},InitRegisterTableData(){this.RegistersTable=[];var e=this.pointData_editing.RegistsPointIndexs;e&&e.forEach((async e=>{var t=await re.p.dispatch("GetMapPointByIndex",e);t&&this.RegistersTable.push({index:e,tag:t.TagNumber,name:t.Name})}))},ResetRegistPointIndexData(){this.pointData_editing.RegistsPointIndexs=this.RegistersTable.map((e=>e.index))},async StationTypeOnChange(e){1==e&&(this.BindingEQInfo=await(0,Fe.CN)(this.pointData.TagNumber))},SaveBtnClickHandle(){this.ResetRegistPointIndexData(),this.$emit("OnPointSettingChanged",{index:this.index,pointData:this.pointData_editing}),(0,Ze.bM)({title:"Success",message:`${this.potinFullName} 站點設定已暫存，請記得儲存圖資`,duration:1e3}),this.pointData=this.pointData_editing},CheckTagRepeat(){if(this.pointData_editing.TagNumber==this.pointData.TagNumber)return!1;var e=this.pointsOptions.filter((e=>e.tag+""==this.pointData_editing.TagNumber+""));return alert(JSON.stringify(e)),1==e.length},CancelBtnClickHandle(){this.hasAnyChange?(this.show=!1,this.$swal.fire({title:"點位尚未儲存",text:`點位-${this.potinFullName} 設定值變更但尚未儲存，確定要離開?`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",customClass:"my-sweetalert"}).then((e=>{this.show=!e.isConfirmed,this.show||this.$emit("OnLeve")}))):(this.show=!1,this.$emit("OnLeve"))},async Regist(){var e=await ze.ZP.Regist(this.pointData_editing.TagNumber),t=e.result;this.show=!1,this.$swal.fire({text:"",title:`${this.pointData_editing.TagNumber} ${t?"註冊成功":"註冊失敗"}`,icon:t?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.show=!0}))},async Unregist(){var e=await ze.ZP.Unregist(this.pointData_editing.TagNumber),t=e.result;this.show=!1,this.$swal.fire({text:"",title:`${this.pointData_editing.TagNumber} ${t?"解除註冊成功":"解除註冊失敗"}`,icon:t?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.show=!0}))},HandleIndexSelected(e){var t=e.index;re.p.dispatch("GetMapPointByIndex",t).then((t=>{e.tag=t.TagNumber,e.name=t.Name}))},HandleDodgeModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">4:一般道路橫向移動(巡檢AGV)<br>5:電池交換橫向移動(巡檢AGV)<br>10:取消任務時Pass站點(用於避免與WIP內AGV旋轉干涉)<br>11:地標輔助修正(用於轉角或長走道起點，AGV會追Tag中心)<br>12:里程計輔助定位(用於窄道)<br>14:里程計輔助定位、偵測色帶(用於窄道、脫離色帶會上報異常)</div>',title:"Dodge Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleSpinModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">0:不可旋轉<br>1:可旋轉<br>2:向右旋轉<br>3:向左旋轉</div>',title:"Spin Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleLaserModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">0:Bypass<br>1:Normal<br>2:二次定位<br>3:Normal_Short<br>5:Turning<br>7:Loading<br>10:Special<br>12:Narrow(窄道)<br>13:Norrow_Long</div>',title:"Laser Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleImageClick(e){this.pointData_editing.Graph.ImageName=e},HandleUploadIconBtnClick(){},OnIconUploadPreview(e){console.info(e)},OnIconUploadSuccess(e,t,a){console.info(e),this.fileList=[],re.p.dispatch("DownloadMapData")},HandleIconDelete(e){re.p.dispatch("DeleteIcon",e),re.p.dispatch("DownloadMapData")}}};const Ye=(0,me.Z)($e,[["render",qe],["__scopeId","data-v-11ba4c68"]]);var Qe=Ye;const Ke={class:"map-path-editor"},Je={class:"header border-bottom"},Xe={class:"draw-content"};function et(e,t,a,n,o,r){const l=(0,i.up)("el-input"),d=(0,i.up)("el-form-item"),c=(0,i.up)("el-input-number"),u=(0,i.up)("el-checkbox"),m=(0,i.up)("el-form"),h=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",Ke,[(0,i.Wm)(h,{modelValue:o.show,"onUpdate:modelValue":t[12]||(t[12]=e=>o.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,onClosed:t[13]||(t[13]=t=>e.$emit("closed",o.PathDataEdit)),"show-close":!1,modal:!0,"modal-class":"modal-style"},{header:(0,i.w5)((()=>[(0,i._)("div",Je,[(0,i._)("h3",null,"路徑設定:"+(0,s.zw)(o.PathDataEdit.StartPtIndex)+"->"+(0,s.zw)(o.PathDataEdit.EndPtIndex),1)])])),default:(0,i.w5)((()=>[(0,i._)("div",Xe,[(0,i.Wm)(m,{"label-width":"140","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{label:"Path ID"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{disabled:"",modelValue:o.PathDataEdit.PathID,"onUpdate:modelValue":t[0]||(t[0]=e=>o.PathDataEdit.PathID=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"權重"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:o.PathDataEdit.Weight,"onUpdate:modelValue":t[1]||(t[1]=e=>o.PathDataEdit.Weight=e),step:.1,min:1e-4,max:100},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"起點(Index)"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{disabled:"",modelValue:o.PathDataEdit.StartPtIndex,"onUpdate:modelValue":t[2]||(t[2]=e=>o.PathDataEdit.StartPtIndex=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"終點(Index)"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{disabled:"",modelValue:o.PathDataEdit.EndPtIndex,"onUpdate:modelValue":t[3]||(t[3]=e=>o.PathDataEdit.EndPtIndex=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"工位路徑"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{disabled:"",modelValue:o.PathDataEdit.IsEQLink,"onUpdate:modelValue":t[4]||(t[4]=e=>o.PathDataEdit.IsEQLink=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"道路開放"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{onChange:a.SettingsChangedHandler,modelValue:o.PathDataEdit.IsPassable,"onUpdate:modelValue":t[5]||(t[5]=e=>o.PathDataEdit.IsPassable=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(d,{label:"僅允許一台車通行"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.PathDataEdit.IsSingleCar,"onUpdate:modelValue":t[6]||(t[6]=e=>o.PathDataEdit.IsSingleCar=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"是否可旋轉"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.PathDataEdit.IsRotationable,"onUpdate:modelValue":t[7]||(t[7]=e=>o.PathDataEdit.IsRotationable=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"消防通道"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.PathDataEdit.IsExtinguishingPath,"onUpdate:modelValue":t[8]||(t[8]=e=>o.PathDataEdit.IsExtinguishingPath=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"雷射模式"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:o.PathDataEdit.LsrMode,"onUpdate:modelValue":t[9]||(t[9]=e=>o.PathDataEdit.LsrMode=e),step:1},null,8,["modelValue"]),(0,i._)("i",{class:"bi bi-question-circle information",onClick:t[10]||(t[10]=(...t)=>e.HandleLaserModeInfoIconClick&&e.HandleLaserModeInfoIconClick(...t))})])),_:1}),(0,i.Wm)(d,{label:"限速"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:o.PathDataEdit.Speed,"onUpdate:modelValue":t[11]||(t[11]=e=>o.PathDataEdit.Speed=e),step:.1,precision:1},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}var tt={data(){return{show:!1,PathDataEdit:{StartPtIndex:5,EndPtIndex:0,StartCoordination:[2.653,6.213],EndCoordination:[.531,6.217],PathID:"5_0",IsEQLink:!1,IsSingleCar:!1,IsRotationable:!1,IsPassable:!1,IsExtinguishingPath:!1,Speed:1,LsrMode:0,DodgeMode:0,SpinMode:0,Weight:1}}},props:{SettingsChangedHandler:{type:Function,default(){return()=>{}}}},methods:{Show(e){e&&(this.PathDataEdit=e,this.show=!0)}}};const at=(0,me.Z)(tt,[["render",et]]);var it=at;const st={class:"forbid-region-edit-drawer"},nt={class:"header border-bottom"},ot={class:"draw-content"};function rt(e,t,a,n,o,r){const l=(0,i.up)("el-input"),d=(0,i.up)("el-form-item"),c=(0,i.up)("el-option"),u=(0,i.up)("el-select"),m=(0,i.up)("el-input-number"),h=(0,i.up)("el-checkbox"),g=(0,i.up)("el-form"),p=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",st,[(0,i.Wm)(p,{modelValue:o.show,"onUpdate:modelValue":t[5]||(t[5]=e=>o.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,onClosed:t[6]||(t[6]=t=>e.$emit("closed",e.PathDataEdit)),"show-close":!1,modal:!0,"modal-class":"modal-style"},{header:(0,i.w5)((()=>[(0,i._)("div",nt,[(0,i._)("h3",null,"區域設置:"+(0,s.zw)(o.region_name),1)])])),default:(0,i.w5)((()=>[(0,i._)("div",ot,[(0,i.Wm)(g,{"label-width":"140","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{label:"名稱"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{modelValue:o.RegionData.Name,"onUpdate:modelValue":t[0]||(t[0]=e=>o.RegionData.Name=e),onInput:r.ChangeNameDisplay},null,8,["modelValue","onInput"])])),_:1}),(0,i.Wm)(d,{label:"類型"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.RegionData.RegionType,"onUpdate:modelValue":t[1]||(t[1]=e=>o.RegionData.RegionType=e)},{default:(0,i.w5)((()=>[(0,i.Uk)("2 "),(0,i.Wm)(c,{value:0,label:"禁制區"}),(0,i.Wm)(c,{value:1,label:"通行區"})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"可容納車輛數"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onChange:r.HandlePropChanged,min:1,max:20,step:1,modelValue:o.RegionData.MaxVehicleCapacity,"onUpdate:modelValue":t[2]||(t[2]=e=>o.RegionData.MaxVehicleCapacity=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(d,{label:"閒置時停車角度限制"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onChange:r.HandlePropChanged,min:-180,max:180,step:.1,modelValue:o.RegionData.ThetaLimitWhenAGVIdling,"onUpdate:modelValue":t[3]||(t[3]=e=>o.RegionData.ThetaLimitWhenAGVIdling=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(d,{label:"窄道區域"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{onChange:r.HandlePropChanged,modelValue:o.RegionData.IsNarrowPath,"onUpdate:modelValue":t[4]||(t[4]=e=>o.RegionData.IsNarrowPath=e)},null,8,["onChange","modelValue"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}var lt={data(){return{show:!1,region_name:"",textFeature:new N.Z,ploygonFeature:new N.Z,RegionData:new oe.S9("",[])}},props:{SettingsChangedHandler:{type:Function,default(){return()=>{}}}},methods:{Show(e,t=new N.Z,a=new N.Z){this.region_name=e,this.textFeature=t,this.ploygonFeature=a,setTimeout((async()=>{this.RegionData=JSON.parse(JSON.stringify(await re.p.dispatch("GetRegionByName",e))),this.show=!0}),10)},ChangeNameDisplay(e){var t=this.textFeature.getStyle().clone(),a=t.getText().clone();a.setText(e),t.setText(a),this.textFeature.setStyle(t),this.textFeature.set("name",e),this.ploygonFeature.set("name",e);let i=new oe.S9("",[],-1);Object.assign(i,this.ploygonFeature.get("data")),i.Name=e,this.ploygonFeature.set("data",i),console.log(e),console.log(i)},HandlePropChanged(){this.ploygonFeature.set("data",this.RegionData)}}};const dt=(0,me.Z)(lt,[["render",rt]]);var ct=dt;const ut={class:"map-quickly-action"},mt=["textContent"];function ht(e,t,a,n,o,r){return(0,i.wg)(),(0,i.iD)("div",ut,[(0,i._)("span",{textContent:(0,s.zw)(r.mapname)},null,8,mt)])}var gt={computed:{mapname(){return re.p.getters.MapName}}};const pt=(0,me.Z)(gt,[["render",ht],["__scopeId","data-v-3192d018"]]);var _t=pt;a(29776);const wt={class:"my-2 py-1 border-bottom d-flex flex-row"},ft=(0,i._)("span",{class:"flex-fill"},null,-1),yt={class:""},vt={key:0},bt={class:"w-100"},St={class:"preview"},kt=["src"];function Ct(e,t,a,n,o,r){const l=(0,i.up)("el-button"),d=(0,i.up)("VuePictureCropper"),c=(0,i.up)("el-divider"),u=(0,i.up)("el-slider");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",wt,[(0,i.Wm)(l,{type:"button",onClick:t[0]||(t[0]=()=>{e.$refs.fileInput.click()})},{default:(0,i.w5)((()=>[(0,i.Uk)("選擇圖片")])),_:1}),(0,i._)("input",{type:"file",ref:"fileInput",onChange:t[1]||(t[1]=(...e)=>r.selectFile&&r.selectFile(...e)),accept:"image/jpg, image/jpeg, image/png, image/gif",style:{display:"none"}},null,544),(0,i.Wm)(l,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Reset")])),_:1}),(0,i.Wm)(l,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Clear")])),_:1}),ft,(0,i.Wm)(l,{onClick:r.getResult,type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("裁剪")])),_:1},8,["onClick"])]),(0,i._)("div",yt,[(0,i.Wm)(d,{boxStyle:{width:"100%",height:"100%",backgroundColor:"#f8f8f8",margin:"auto"},img:o.pic,options:{viewMode:0,dragMode:"crop"},onReady:r.ready},null,8,["img","onReady"]),o.result.dataURL&&o.result.blobURL?((0,i.wg)(),(0,i.iD)("div",vt,[(0,i.Wm)(c),(0,i._)("div",bt,[(0,i.Wm)(l,{onClick:r.UseCropedImgClick,class:"text-end"},{default:(0,i.w5)((()=>[(0,i.Uk)("確定使用此圖片")])),_:1},8,["onClick"])]),(0,i.Wm)(u,{min:.1,max:1,step:.05,modelValue:o.previewImgScale,"onUpdate:modelValue":t[2]||(t[2]=e=>o.previewImgScale=e),onChange:r.OnPreviewImgSliderChanged},null,8,["modelValue","onChange"]),(0,i.Uk)(" "+(0,s.zw)(o.result.blobURL)+" ",1),(0,i._)("div",St,[(0,i._)("img",{style:(0,s.j5)(o.previewImgStyle),src:o.result.blobURL},null,12,kt)])])):(0,i.kq)("",!0)])],64)}a(62062);var At=a(59984),Tt={components:{VuePictureCropper:At.Z},props:{pic_used:{type:String,default:""}},data(){return{pic:"/images/eq-icon.png",ori_pic:"",result:{dataURL:"",blobURL:"",file:void 0},previewImgScale:.5,previewImgStyle:{transform:"scale(0.5)",transformOrigin:"top left"},uploadFile:void 0}},watch:{pic_used(e,t){console.log(e,t)}},methods:{UseCropedImgClick(){this.$emit("onCropDone",this.result)},ready(){},crop(){At.n.crop()},OnPreviewImgSliderChanged(){this.previewImgStyle.transform=`scale(${this.previewImgScale})`},async getResult(){if(!At.n)return;const e=At.n.getDataURL(),t=await At.n.getBlob();if(!t)return;const a=await At.n.getFile({fileName:this.uploadFile.name.split(".")[0]});console.log({base64:e,blob:t,file:a}),this.result.dataURL=e,this.result.blobURL=URL.createObjectURL(t),this.result.file=a},selectFile(e){this.pic="",this.result.dataURL="",this.result.blobURL="";const{files:t}=e.target;if(!t||!t.length)return;const a=t[0],i=new FileReader;i.readAsDataURL(a),i.onload=()=>{this.uploadFile=a,this.pic=String(i.result),this.$refs.uploadInput&&(this.$refs.uploadInput.value="")}}}};const Vt=(0,me.Z)(Tt,[["render",Ct]]);var Dt=Vt,xt=a(72924),Mt=a(663),Wt={components:{QuicklyAction:_t,MapSettingsDialog:ge,PointContextMenu:Ve,MapPointSettingDrawer:Qe,MapPathSettingDrawer:it,MapRegionEditDrawer:ct,ImageEditor:Dt},props:{editable:{type:Boolean,default:!1},agv_show:{type:Boolean,default:!0},station_show:{type:Boolean,default:!0},eq_lduld_status_show:{type:Boolean,default:!1},agv_upload_coordi_data:{type:Object,default(){return{}}},task_dispatch_menu_show:{type:Boolean,default:!1},id:{type:String,default(){return"map"}},canva_height:{type:String,default:"670px"}},data(){return{map:new R.Z,map_name:"Unkown",zoom:2,zoom_route:2,center:[0,0],center_route:[0,0],loading:!1,ShowPathSelectDialog:!1,DragBackgroundImageMode:!1,ShowImageEditorDialog:!1,IsPathEditing:!1,selectedSettingTabIndex:0,new_map_img_extent:[],SelectedPathData:{},PathesCandicats:[],_map_stations:[],dragStartPosition:null,map_img_url_for_editor:null,to_upload_image_file:null,ImageLayer:new $.Z,PointLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:12}),PointRouteLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:13}),EQLDULDStatusLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:4}),PathLayerForCoordination:new Y.Z({source:new H.Z({features:[]}),zIndex:5}),PathLayerForRouter:new Y.Z({source:new H.Z({features:[]}),zIndex:6}),AGVLocLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:17}),EQMaintainIconLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:4}),AGVLocusLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:18}),CustomLayer:new Y.Z({source:new H.Z({features:[]})}),gridLayer:new Y.Z,TransferTaskIconLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:22}),RegionLayer:new Y.Z({source:new H.Z({features:[]}),zIndex:1}),AGVFeatures:{},MouseCoordination:void 0,FeatureKeys:{Station:"station",path:"path",nav_path:"nav_path",agv:"agv"},IsDragging:!1,IsAddPathMode:!0,PathEditTempStore:[],EditorOption:{EditMode:"edit",EditAction:"none",AddPathMode:{Direction:"one-direction"},AddRegionMode:{Mode:"forbid"}},map_display_mode:"router",station_name_display_mode:"name",agv_display:"visible",map_image_display:"visible",left_tab_class_name:"tab-open",previousSelectedFeatures:[],agv_upload_coordination_mode:!1,editModeContextMenuVisible:!1,taskDispatchContextMenuVisible:!1,routePathsVisible:!0,regionsVisible:!1,contextMenuTop:0,contextMenuLeft:0,contextMenuOptions:new oe.xK,firstUseFlag:!0,selected_path_feature:void 0,path_highlight_style:new Q.ZP({stroke:new K.Z({color:"blue",width:8})}),PathesSegmentsForEdit:[],IsSelectAGVMode:!1,IsSelectEQStationMode:!1,TaskDispatchOptions:{action_type:"",direction:"",stations_to_show:[]},draw_forbid_regions_interaction:void 0,draw_global_path_regions_interaction:void 0,delete_forbid_regions_interaction:void 0,edit_forbid_regions_interaction:void 0,mapEditsInteraction:void 0,MapGridSizeStore:0,MapGridSizeXOffset:0,MapGridSizeYOffset:0,MapRotation:0,MapStyles:{PathColor:"red",NormalPointNameColor:"orange",WorkStationPointNameColor:"lime",NormalPointTextFontSize:12,WorkStationPointTextFontSize:18},AgvOperation:{operatingAgvName:"",display:!1,Show(e){this.operatingAgvName=e,this.display=!0}},featureHighlightTimerID:"",highlightingFeatures:[],renderLDULD_StatusTimerId:"",prviousEQDataJson:""}},computed:{MapServerUrl(){return re.p.getters.MapServerUrl},map_image_url(){return this.map_img_url_for_editor?this.map_img_url_for_editor:`${this.MapServerUrl}/MapFiles/${re.p.getters.MapImageName}?version=1`},map_name_with_url(){return`map-${this.$route.name}`},map_img_extent(){return re.p.getters.Map_Image_Boundary},map_img_size(){return re.p.getters.Map_Image_Size},PathesSegments(){return re.p.getters.Pathes},previousSelectedFeature(){return this.previousSelectedFeatures[0]},MouseCoordinationDisplay(){return this.MouseCoordination?`(${this.MouseCoordination[0].toFixed(2)},${this.MouseCoordination[1].toFixed(2)})`:"(-1,-1)"},StationPointsFeatures(){return"coordination"==this.map_display_mode?this.PointLayer.getSource().getFeatures():this.PointRouteLayer.getSource().getFeatures()},AGVMapFeatures(){return this.AGVLocLayer.getSource().getFeatures()},ShowWarningNotify(){return"view"!=this.EditorOption.EditMode&&"coordination"==this.map_display_mode},map_station_data(){return re.p.getters.MapStations},BezierCurves(){return re.p.getters.BezierCurves},agvs_info(){return re.p.getters.AGVNavInfo},agvs_info_other_system(){return re.p.getters.OthersAGVLocateInfo},eq_data(){return le.jU.getters.EQData},ControledPathesBySystem(){return re.p.getters.ControledPathesBySystem},radio_group_style(){return"add-path"==this.EditorOption.EditAction||"add-forbid-region"==this.EditorOption.EditAction?{position:"relative",top:"-15px"}:{}},MapGridSize(){return re.p.getters.GridSize}},methods:{GetPointName(e){var t=(0,oe.G)(e);if(t)return t.Name},ClearMap(){this.$swal.fire({text:"地圖資料將會被清空，變成空白地圖",title:"確定要重置地圖?",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&(this.PathesSegmentsForEdit=[],this.PathLayerForCoordination.getSource().clear(),this.PathLayerForRouter.getSource().clear(),this.PointRouteLayer.getSource().clear(),this.PointLayer.getSource().clear(),this.TransferTaskIconLayer.getSource().clear())}))},HandlePathRemoveBtnClick(e){var t=this.PathesSegmentsForEdit.indexOf(e);this.PathesSegmentsForEdit.splice(t,1),this.UpdateStationPathLayer()},HandlePathTbRowClick(e,t,a){this.selected_path_feature&&this.RestoreOriginalPathStyle(this.selected_path_feature);var i=this.PathLayerForCoordination.getSource(),s=i.getFeatures().find((t=>t.get("path_id")==e.PathID));if(s){var n=s.getStyle();if(n[0]=this.path_highlight_style,s.setStyle(n),this.selected_path_feature=s,!this.IsPathEditing){var o=s.getGeometry().getCoordinates()[0];this.map.getView().setCenter(o)}}},RestoreOriginalPathStyle(e){if(e){var t=e.get("ori_stroke_style"),a=e.getStyle();a[0]=t,e.setStyle(a)}},UpdateStationPointLayer(){var e=[],t=[],a=[];for(let l=0;l<this._map_stations.length;l++){var i=this._map_stations[l],s=(0,oe.HB)(i);e.push(s),0!=i.data.StationType&&a.push(this.CreateEqMaintainingFeature(i.data,s.getGeometry().getCoordinates()));var n=s.get("routeModeFeature");n&&t.push(n)}var o=this.PointLayer.getSource();o.clear(),o.addFeatures(e),this.EQMaintainIconLayer.getSource().addFeatures(a);var r=this.PointRouteLayer.getSource();r.clear(),r.addFeatures(t),this.UpdateEQLDULDFeature()},UpdateStationPathLayer(){var e=this.PathLayerForCoordination.getSource(),t=this.PathLayerForRouter.getSource();e.clear(),t.clear();var a=[],i=[],s=this.PathesSegmentsForEdit,n=function(e,t){e.set("start_pt_index",t.StartPtIndex),e.set("end_pt_index",t.EndPtIndex),e.set("path_id",t.PathID),e.set("isEqLink",t.IsEQLink),e.set("feature_type","path"),e.set("isClose",!t.IsPassable);var a=(0,oe.bE)(e);e.setStyle(a),e.set("ori_stroke_style",a[0])};s.forEach((e=>{let t=new N.Z({geometry:new U.Z([e.StartCoordination,e.EndCoordination])});var s=this._map_stations.find((t=>t.index==e.StartPtIndex)),o=this._map_stations.find((t=>t.index==e.EndPtIndex));let r=new N.Z({geometry:new U.Z([[s.data.Graph.X,s.data.Graph.Y],[o.data.Graph.X,o.data.Graph.Y]])});n(t,e),n(r,e),a.push(t),i.push(r)})),e.addFeatures(a),t.addFeatures(i)},UpdateEQLDULDFeature(){if(!this.editable){var e=[];for(let i=0;i<this._map_stations.length;i++){var t=this._map_stations[i],a=(0,oe.Xl)(t,this.map_display_mode);e.push(a)}var i=this.EQLDULDStatusLayer.getSource();i.clear(),i.addFeatures(e)}},UpdateForbidPointLayer(){this.RegionLayer.getSource().clear();var e=re.p.getters.Regions;e.forEach((e=>{var t=(0,oe.H6)(e.Name,e.PolygonCoordinations,e.RegionType);t.region_feature.set("data",e),this.RegionLayer.getSource().addFeatures([t.region_feature,t.text_feature])}))},UpdateAGVLocationOfOtherSystem(e=[]){var t=this.AGVLocLayer.getSource(),a=t.getFeatures(),i=e=>{var t=this.StationPointsFeatures.find((t=>t.get("data").Graph.Display==e));return t?t.getGeometry().getCoordinates():[0,0]};e.forEach((e=>{var s=e.AGVName,n=e.Location,o=`other-agv-${s}`,r=a.find((e=>e.get("agv-addition")==o)),l=i(n),d=0==l[0]&&0==l[1];if(!d)if(r)r.setGeometry(new G.Z(l));else{var c=new N.Z({geometry:new G.Z(l)}),u=(0,oe.IN)(s,"blue");c.setStyle(u),c.set("agvname",s),c.set("feature_type",this.FeatureKeys.agv),c.set("agv-addition",o),t.addFeature(c)}}))},UpdateAGVLayer(){if("visible"!=this.agv_display)return;var e=(e,t)=>{localStorage.setItem(e,t)},t=e=>{var t=localStorage.getItem(e);return t||""};this.agvs_info.AGVDisplays.forEach((a=>{le.sn.getters.VehicleSize(a.AgvName);const i=a.vehicleLength/100,s=a.vehicleWidth/100,n=Mt.Z.backend_host+"/AGVImages/"+a.AgvName+"-Icon.png",o=Math.sqrt(Math.pow(i/2,2)+Math.pow(s/2,2));var r=this.CalculateAGVPolygonCoordination(a.Coordination,i,s,a.Theta),l=this.AGVFeatures[a.AgvName];if(l){var d=JSON.stringify(a),c=t(a.AgvName);if(d==c)return;e(a.AgvName,d);var u=a.Coordination,m=a.NavPathCoordinationList;if("router"==this.map_display_mode){m=[];var h=this.StationPointsFeatures.find((e=>e.get("data").TagNumber==a.Tag));h&&(u=h.getGeometry().getCoordinates(),r=this.CalculateAGVPolygonCoordination(u,i,s,a.Theta));var g=this.PointLayer.getSource().getFeatures();const e=a.NavPathCoordinationList.length,t=0==e;if(!t)for(let i=0;i<e;i++){const e=a.NavPathCoordinationList[i];h=g.find((t=>t.getGeometry().getCoordinates()[0]==e[0]&&t.getGeometry().getCoordinates()[1]==e[1]));if(h){var p=this.StationPointsFeatures.find((e=>e.get("index")==h.get("index")));m.push(p.getGeometry().getCoordinates())}}}l.agv_feature.setGeometry(new G.Z(u)),l.cargo_icon_feature.setGeometry(new G.Z(u)),l.safty_region_feture.getGeometry().setCenter(u),l.agv_body_feture.setGeometry(new ae.ZP(r));var _=l.agv_feature.getStyle(),w=_.getImage();"router"!=this.map_display_mode&&(w.setRotation(-1*(a.Theta-90-this.MapRotation)*Math.PI/180),_.setImage(w));var f=a.CurrentAction,y=_.getText(),v=a.DisplayText+(""==f?"":`(${f})`);v+=a.WaitingInfo.IsWaiting?"\r\n"+a.WaitingInfo.Descrption:"",y.setText(v);var b=y.getBackgroundFill();b.setColor(a.AgvStates.is_online?a.TextColor:"rgb(147, 147, 147)"),y.setBackgroundFill(b),l.agv_feature.setStyle(_),l.path_feature.setGeometry(new U.Z(m)),(0,oe.oy)(l.cargo_icon_feature,a.CargoStatus)}else try{var S=new N.Z({geometry:new G.Z(a.Coordination)});const e=new ie.Z(a.Coordination,o),t=new ae.ZP(r);var k=this.convertColorNameToRGBA(a.TextColor,1),C=this.convertColorNameToRGBA(a.TextColor,.4),A=this.convertColorNameToRGBA(a.TextColor,.2);const i=new N.Z(e);i.setStyle(new Q.ZP({fill:new J.Z({color:A}),stroke:new K.Z({color:A,width:1,lineDash:[5,2]}),text:new X.Z({text:""})}));const s=new N.Z(t);s.setStyle(new Q.ZP({fill:new J.Z({color:C}),stroke:new K.Z({color:"black",width:1})}));var T=(0,oe.K$)(a.DisplayText,k,n+`?version=${Date.now()}`);S.setStyle(T),S.set("agvname",a.AgvName),S.set("feature_type",this.FeatureKeys.agv);var V=new N.Z({geometry:new U.Z([])});V.setStyle((0,oe.DS)(k,7));var D=S.clone();D.setStyle((0,oe.Qw)()),this.AGVFeatures[a.AgvName]={agv_feature:S,path_feature:V,cargo_icon_feature:D,safty_region_feture:i,agv_body_feture:s};var x=this.AGVLocLayer.getSource();x.addFeature(D),x.addFeature(S),x.addFeature(i),x.addFeature(s),x.addFeature(V)}catch{console.log("errror")}}))},async ResetRouteModeDisplay(){this.$swal.fire({text:"",title:"確定要重置路網模式?",icon:"warning",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=await re.p.dispatch("ResetMapXYGraphAsCoordinations","");console.log(t);var a=t.confirm,i=t.message;this.$swal.fire({text:a?"":i,title:a?"重置成功":"重置失敗",icon:a?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),this.ReloadMap(!1)}}))},CalculateAGVPolygonCoordination(e,t,a,i){let s=i*Math.PI/180,n=Math.cos(s),o=Math.sin(s),[r,l]=e,d=[[r-t/2,l-a/2],[r+t/2,l-a/2],[r+t/2,l+a/2],[r-t/2,l+a/2]],c=d.map((e=>{let[t,a]=e,i=t-r,s=a-l,d=i*n-s*o+r,c=i*o+s*n+l;return[d,c]}));var u=[c.map((e=>[e[0],e[1]]))];return u},UpdateAGVLocByMapMode(e="router",t=new oe.Ew){var a=this.AGVFeatures[t.AgvName];if(a){var i=this.StationPointsFeatures.find((e=>e.get("data").TagNumber==t.Tag));if(i){var s=i.getGeometry().getCoordinates();a.agv_feature.setGeometry(new G.Z(s)),a.safty_region_feture.getGeometry().setCenter(s);const e=le.sn.getters.VehicleSize(t.AgvName),n=e[0]/100,o=e[1]/100;a.agv_body_feture.setGeometry(new ae.ZP(this.CalculateAGVPolygonCoordination(s,n,o)))}}},convertColorNameToRGBA(e,t=1){var a=document.createElement("div");a.style.color=e,document.body.appendChild(a);var i=window.getComputedStyle(a).color;document.body.removeChild(a);var s=i.replace("rgb","rgba").replace(")",`, ${t})`);return s},setDragPanEnabled(e){this.map.getInteractions().forEach((function(t){t instanceof B.Z&&t.setActive(e)}))},InitMapEventHandler(){this.map.on("pointermove",(e=>{if(this.DragBackgroundImageMode&&this.dragStartPosition){e.preventDefault();let t=e.coordinate[0]-this.dragStartPosition[0],a=e.coordinate[1]-this.dragStartPosition[1];console.log(t,a),this.new_map_img_extent[0]+=t,this.new_map_img_extent[1]+=a,this.new_map_img_extent[2]+=t,this.new_map_img_extent[3]+=a,this.ResetImageExtend(this.new_map_img_extent),this.dragStartPosition=e.coordinate}this.MouseCoordination=e.coordinate;var t=this.map.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));this.map.getTargetElement().style.cursor=t?"pointer":""})),this.map.on("pointerup",(e=>{this.DragBackgroundImageMode&&(this.dragStartPosition=null),"add-station"==this.EditorOption.EditAction?this.map.getTargetElement().style.cursor="crosshair":this.map.getTargetElement().style.cursor="default"})),this.map.on("pointerdown",(e=>{const t=2==e.originalEvent.button;this.DragBackgroundImageMode&&t?this.dragStartPosition=e.coordinate:this.map.getTargetElement().style.cursor="grabbing"})),this.map.on("moveend",(e=>{this.SaveSettingsToLocalStorage()})),this.map.on("click",(e=>{this.map.forEachFeatureAtPixel(e.pixel,(e=>{if("agv"===e.get("feature_type")){const t=e.get("agvname");this.AgvOperation.Show(t)}}))}))},HandleDeleteForbidRegionClicked(){var e=()=>{this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.mapEditsInteraction),this.RemoveInteraction(this.edit_forbid_regions_interaction)};e();var t="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(t),this.AddRemoveForbidRegionInteraction()},HandleEditForbidRegionClicked(){var e=()=>{this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.mapEditsInteraction)};e();var t="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(t),this.AddEditForbidRegionInteraction()},HandleAddForbidRegionClicked(e){var t=()=>{this.RemoveInteraction(this.mapEditsInteraction),this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.edit_forbid_regions_interaction)};t(),this.regionsVisible=!0;var a="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(a),this.AddDrawForbidActionInteraction(e)},HandleDrawGlobalPathRegionClicked(){var e="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(e),this.AddDrawGlobalPathActionInteraction()},AddEditMapInteraction(){this.RemoveForbidRegionOperationInteractions();var e=this;this.mapEditsInteraction=new q.Z({handleDownEvent:function(t){const a=2==t.originalEvent.button;e.editModeContextMenuVisible=!1,e.ClearSelectedFeature();var i=t.map,s=i.forEachFeatureAtPixel(t.pixel,(function(e){return e}));this.coordinate_=t.coordinate;var n=e.EditorOption.EditAction;if(!a||!s||"path"!=s.get("feature_type")||"add-station"!=n){if(!s||s.get("grid_line")){if(e.IsDragging=!1,"add-station"!=n||!a)return!1;s=(0,oe.s6)(t.coordinate,e.GenNewIndexOfStation())}else{if("polygon"==s.get("type")||"text"==s.get("type"))return!1;var o=s.get("feature_type"),r=()=>e.IsSelectAGVMode&&"agv"==o,l=()=>e.IsSelectEQStationMode&&"station"==o;if(r()){var d=s.get("agvname");ne.Z.emit("/map/agv_selected",d)}if(l()){var c=s.get("data");ne.Z.emit("/map/station_selected",c)}}if("lduld"==s.get("feature_type")){var u=s.get("action");return e.HandleLDULDLabelClick(s.get("data"),u),!1}if(e.HighLightFeatureSelected([s]),"view"==e.EditorOption.EditMode)return!1;var m=s.get("feature_type");return this.feature_=s,e.IsDragging=!a,"none"==n&&m!=e.FeatureKeys.Station?!1:(0==t.originalEvent.button?m==e.FeatureKeys.Station&&"remove-station"==n?e.RemoveStation(s):m==e.FeatureKeys.path&&"remove-path"==n?e.RemovePath(s):"add-path"==n&&e.PushPathEndPointData(s):2==t.originalEvent.button&&m==e.FeatureKeys.path&&"edit-path"==n&&e.OpenPath_editor(s),!0)}e.InsertPointAtPathes(s,t.coordinate)},handleDragEvent:function(t){if(e.IsDragging){var a=e.editable,i=e.EditorOption.EditMode,s=e.EditorOption.EditAction;if(a&&"edit"==i&&"add-path"!=s&&"edit-path"!=s&&"remove-path"!=s&&"path"!==this.feature_.get("feature_type")){var n=t.coordinate[0]-this.coordinate_[0],o=t.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(n,o),e.MouseCoordination=this.coordinate_=t.coordinate,r=this.feature_.getGeometry();var l=this.feature_.get("data");if(l){var d=r.getCoordinates();"coordination"==e.map_display_mode?(l.X=d[0],l.Y=d[1]):(l.Graph.X=d[0],l.Graph.Y=d[1]),this.feature_.set("data",l)}}}},handleUpEvent:function(t){if("view"!=e.EditorOption.EditMode){var a=e.EditorOption.EditAction;if("add-path"!=a&&"remove-path"!=a){if(2==t.originalEvent.button)if("edit-station"==a)e.HandlePtSettingBtnClick();else if("add-station"==a)try{e.AddFeatureToMapLayers(this.feature_)}catch(s){console.error(s),e.HandlePtSettingBtnClick()}e.IsDragging=!1;try{var i=this.feature_.get("index");e.ResetPathLinkOfRouteMode(i),e.ResetPathLinkOfCoordinationMode(i)}catch(s){}}this.feature_=null,this.coordinate_=null}},handleMoveEvent:function(t){var a=e.EditorOption.EditAction;if("view"!=e.EditorOption.EditMode){e.MouseCoordination=t.coordinate;var i=t.map,s=i.forEachFeatureAtPixel(t.pixel,(function(e,t){return e})),n="";if(s){var o=s.get("grid_line");if(o)return;var r=s.get("feature_type"),l={"add-path":e.FeatureKeys.Station,"remove-station":e.FeatureKeys.Station,"remove-path":e.FeatureKeys.path};n="pointer",l[a]&&r!=l[a]&&(n="not-allowed")}else"add-station"==a&&(n="crosshair"),this.feature_=void 0;i.getTargetElement().style.cursor=n}}}),this.map.addInteraction(this.mapEditsInteraction)},AddDrawGlobalPathActionInteraction(){this.RemoveForbidRegionOperationInteractions(),this.RemoveInteraction(this.draw_global_path_regions_interaction);const e="rgba(152, 209, 224,.5)";this.draw_global_path_regions_interaction=new F.ZP({source:this.RegionLayer.getSource(),type:"Polygon",condition:se.rM,style:new Q.ZP({fill:new J.Z({color:e}),stroke:new K.Z({color:"blue",width:1})})});var t=this;this.draw_global_path_regions_interaction.on("drawend",(a=>{var i=t.GetGlobalPathRegionCount(),s=`道路區域-${i}`;const n="path",o=a.feature;o.set("type","polygon"),o.set("name",s),o.set("region_type",n);const r=o.getGeometry().getInteriorPoint().getCoordinates();console.info(r),o.setStyle(new Q.ZP({fill:new J.Z({color:e}),stroke:new K.Z({width:1})}));const l=new N.Z({geometry:new G.Z(r)});l.set("type","text"),l.set("name",s),l.set("region_type",n),l.setStyle(new Q.ZP({text:new X.Z({text:s,scale:1.2,fill:new J.Z({color:"black"})})})),t.RegionLayer.getSource().addFeature(l)})),this.map.addInteraction(this.draw_global_path_regions_interaction)},AddDrawForbidActionInteraction(e="forbid|passible"){this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.draw_global_path_regions_interaction);const t="Polygon";var a=this,i="forbid"==e,s=i?"rgba(255, 0, 0,0.5)":"rgba(116, 249, 42,0.5)",n=i?"red":"seagreen";"None"!==t&&(this.draw_forbid_regions_interaction=new F.ZP({source:this.RegionLayer.getSource(),type:t,condition:se.rM,style:new Q.ZP({fill:new J.Z({color:s}),stroke:new K.Z({color:"blue",width:1})})}),this.draw_forbid_regions_interaction.on("drawend",(t=>{var o=i?a.GetForbidRegionCount():a.GetPassibleRegionCount(),r=i?"orange":"rgb(139, 171, 206)",l=i?`禁制區-${o+1}`:`通行區-${o+1}`;const d=t.feature;d.set("type","polygon"),d.set("name",l),d.set("region_type",e);const c=d.getGeometry().getInteriorPoint().getCoordinates();console.info(c),d.setStyle(new Q.ZP({fill:new J.Z({color:s}),stroke:new K.Z({color:n,width:1})}));const u=new N.Z({geometry:new G.Z(c)});u.set("type","text"),u.set("name",l),u.set("region_type",e),u.setStyle(new Q.ZP({text:new X.Z({text:l,scale:1.1,font:"bold 22px Arial",fill:new J.Z({color:"white"}),backgroundFill:new J.Z({color:r}),padding:[5,5,5,5]})})),a.RegionLayer.getSource().addFeature(u)})),this.map.addInteraction(this.draw_forbid_regions_interaction))},AddRemoveForbidRegionInteraction(){this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.draw_global_path_regions_interaction);var e=this.RegionLayer.getSource();this.delete_forbid_regions_interaction=new q.Z({handleDownEvent:function(t){var a=t.map,i=a.forEachFeatureAtPixel(t.pixel,(function(e){return e}));if(i&&"polygon"==i.get("type")){var s=i.get("name");e.removeFeature(i);var n=e.getFeatures().find((e=>e.get("name")==s));e.removeFeature(n),(0,Ze.bM)({title:"管制區修改",message:`管制區-${s} 已刪除`,position:"bottom-right",duration:1e3})}}}),this.map.addInteraction(this.delete_forbid_regions_interaction)},AddEditForbidRegionInteraction(){this.RemoveInteraction(this.edit_forbid_regions_interaction),this.RemoveInteraction(this.draw_global_path_regions_interaction);var e=this.$refs["forbid_region_editor"],t=this.RemoveKeyboardPressEventListener;let a=this;this.edit_forbid_regions_interaction=new q.Z({handleDownEvent:function(i){var s=i.map,n=s.forEachFeatureAtPixel(i.pixel,(function(e){return e}));if(!n||"polygon"!=n.get("type"))return;var o=n.get("name");let r=a.RegionLayer.getSource().getFeatures();var l=r.find((e=>e.get("name")==o&&"text"==e.get("type"))),d=r.find((e=>e.get("name")==o&&"polygon"==e.get("type")));t(),e.Show(o,l,d)}}),this.map.addInteraction(this.edit_forbid_regions_interaction)},RemoveAllInteractions(){this.draw_forbid_regions_interaction&&this.map.removeInteraction(this.draw_forbid_regions_interaction),this.draw_global_path_regions_interaction&&this.map.removeInteraction(this.draw_global_path_regions_interaction),this.delete_forbid_regions_interaction&&this.map.removeInteraction(this.delete_forbid_regions_interaction),this.edit_forbid_regions_interaction&&this.map.removeInteraction(this.edit_forbid_regions_interaction),this.mapEditsInteraction&&this.map.removeInteraction(this.mapEditsInteraction)},RemoveInteraction(e){e&&this.map.removeInteraction(e)},RemoveKeyboardPressEventListener(){document.removeEventListener("keydown",this.EditModeKeybordEvents)},HideNormalStations(e){var t=this.StationPointsFeatures.filter((e=>0==e.get("station_type")));t.forEach((t=>{if(e){var a=new Q.ZP({fill:new J.Z({color:"rgba(0, 0, 0, 0)"}),stroke:new K.Z({color:"rgba(0, 0, 0, 0)"}),image:new ee.Z({radius:0})}),i=t.getStyle().clone();t.set("visible-style",i),t.setStyle(a)}else{var s=t.get("visible-style");t.setStyle(s)}}))},SaveSettingsToLocalStorage(){var e=this.map.getView().getZoom(),t=this.map.getView().getCenter();"coordination"==this.map_display_mode?(this.zoom=e,this.center=t):(this.zoom_route=e,this.center_route=t),localStorage.setItem(this.map_name_with_url,JSON.stringify({zoom:this.zoom,zoom_route:this.zoom_route,mode:this.map_display_mode,center:this.center,center_route:this.center_route,station_name_display_mode:this.station_name_display_mode}))},RestoreSettingsFromLocalStorage(){var e=localStorage.getItem(this.map_name_with_url);if(console.log(e),e){var t=JSON.parse(e);this.station_name_display_mode=t.station_name_display_mode,this.map_display_mode=this.editable?"router":t.mode,this.zoom=t.zoom,this.map.getView().setCenter(t.center),this.map.getView().setZoom(t.zoom)}},RemoveStation(e=new N.Z){var t=function(e,t){var a=e.getFeatures().find((e=>e.get("index")==t));e.removeFeature(a)},a=function(e,t,a){var i=a.get("index"),s=t.filter((e=>e.StartPtIndex==i||e.EndPtIndex==i));s.forEach((a=>{var i=a.PathID,s=e.getFeatures().find((e=>e.get("path_id")==i));e.removeFeature(s);var n=t.indexOf(a);-1!=n&&t.splice(n,1)}))},i=e.get("index");t(this.PointLayer.getSource(),i),t(this.PointRouteLayer.getSource(),i),a(this.PointLayer.getSource(),this.PathesSegmentsForEdit,e),this.UpdateStationPathLayer()},AddFeatureToMapLayers(e){this.PointLayer.getSource().addFeature(e),this.PointRouteLayer.getSource().addFeature(e);var t=new oe.eX;t.index=t.name=e.get("index"),t.tag=e.get("tag"),t.station_type=e.get("station_type"),t.targets=e.get("targets"),t.coordination=e.get("coordination"),t.graph=e.get("graph"),t.data=e.get("data"),this._map_stations.push(t)},RemovePath(e,t=!1){var a=[],i=e.get("path_id"),s=i.split("_"),n=parseInt(s[0]),o=parseInt(s[1]),r=this.PointLayer.getSource().getFeatures().find((e=>e.get("index")==n)),l=r.get("data");delete l.Target[o];l=r.set("data",l);this.PathLayerForCoordination.getSource().removeFeature(e);var d=this.PathesSegmentsForEdit.find((e=>e.PathID==i));if(d){var c=this.PathesSegmentsForEdit.indexOf(d);if(-1!=c&&(this.PathesSegmentsForEdit.splice(c,1),this.UpdateStationPathLayer(),a.push(d)),t){var u=`${o}_${n}`,m=this.PathLayerForCoordination.getSource().getFeatures().find((e=>e.get("path_id")==u));if(m){var h=this.RemovePath(m,!1);h.forEach((e=>{a.push(e)}))}}}return a},InsertPointAtPathes(e,t){var a=(0,oe.s6)(t,this.GenNewIndexOfStation()),i=this.RemovePath(e,!0);this.AddFeatureToMapLayers(a);var s="router"==this.map_display_mode?this.PointRouteLayer.getSource().getFeatures():this.PointLayer.getSource().getFeatures();i.forEach((e=>{var t=s.find((t=>t.get("index")==e.StartPtIndex)),i=a,n=a,o=s.find((t=>t.get("index")==e.EndPtIndex));this.GenPath([t,i]),this.GenPath([n,o])}));this.CalculateNewPointRatioOfPathStart(i[0],a)},CalculateNewPointRatioOfPathStart(e,t){var a="router"==this.map_display_mode?this.PointRouteLayer.getSource().getFeatures():this.PointLayer.getSource().getFeatures(),i=a.find((t=>t.get("index")==e.StartPtIndex)),s=a.find((t=>t.get("index")==e.EndPtIndex)),n=i.getGeometry().getCoordinates(),o=s.getGeometry().getCoordinates(),r=t.getGeometry().getCoordinates(),l=Math.sqrt(Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2)),d=Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2)),c=d/l;return c},ResetNewPointCoordination(e,t){this.PointRouteLayer.getSource().getFeatures();var a=this.PointLayer.getSource().getFeatures(),i=t.get("index"),s=a.find((e=>e.get("targets").includes(i))),n=a.find((e=>e.get("index")==t.get("targets")[0])),o=s.getGeometry().getCoordinates(),r=n.getGeometry().getCoordinates(),l=o[0]+(r[0]-o[0])*e,d=o[1]+(r[1]-o[1])*e,c=a.find((e=>e.get("index")==i)),u=c.get("data"),m=[l,d];u.X=m[0],u.Y=m[1],c.set("data",u),this.ResetPathLinkOfRouteMode(i),this.ResetPathLinkOfCoordinationMode(i)},ResetPathLinkOfCoordinationMode(e,t=!1){var a=this.PointLayer.getSource().getFeatures().find((t=>t.get("index")==e)),i=this.PathLayerForCoordination.getSource().getFeatures();try{for(var s=i.filter((t=>t.get("start_pt_index")==e)),n=0;n<s.length;n++){var o=s[n],r=o.get("path_id"),l=this.PathesSegmentsForEdit.find((e=>e.PathID==r));if(o)if(t)source.removeFeature(o),this.PathesSegmentsForEdit.remove(l);else{var d=o.getGeometry(),c=d.getCoordinates()[1],u=a.getGeometry().getCoordinates(),m=new U.Z([u,c]);o.setGeometry(m),o.setStyle((0,oe.bE)(o)),l.StartCoordination=u}}}catch(w){}try{for(s=i.filter((t=>t.get("end_pt_index")==e)),n=0;n<s.length;n++){var h=s[n],g=this.PathesSegmentsForEdit.find((e=>e.PathID==h.get("path_id")));if(t)source.removeFeature(h),this.PathesSegmentsForEdit.remove(g);else{d=h.getGeometry();var p=d.getCoordinates()[0],_=a.getGeometry().getCoordinates();m=new U.Z([p,_]);h.setGeometry(m),h.setStyle((0,oe.bE)(h)),g.EndCoordination=_}}}catch(w){}},ResetPathLinkOfRouteMode(e,t=!1){var a=this.PointRouteLayer.getSource().getFeatures().find((t=>t.get("index")==e)),i=this.PathLayerForRouter.getSource().getFeatures();try{for(var s=i.filter((t=>t.get("start_pt_index")==e)),n=0;n<s.length;n++){var o=s[n],r=o.get("path_id"),l=this.PathesSegmentsForEdit.find((e=>e.PathID==r));if(o)if(t)source.removeFeature(o),this.PathesSegmentsForEdit.remove(l);else{var d=o.getGeometry(),c=d.getCoordinates()[1],u=a.getGeometry().getCoordinates(),m=new U.Z([u,c]);o.setGeometry(m),o.setStyle((0,oe.bE)(o))}}}catch(w){}try{for(s=i.filter((t=>t.get("end_pt_index")==e)),n=0;n<s.length;n++){var h=s[n],g=this.PathesSegmentsForEdit.find((e=>e.PathID==h.get("path_id")));if(t)source.removeFeature(h),this.PathesSegmentsForEdit.remove(g);else{d=h.getGeometry();var p=d.getCoordinates()[0],_=a.getGeometry().getCoordinates();m=new U.Z([p,_]);h.setGeometry(m),h.setStyle((0,oe.bE)(h))}}}catch(w){}},ResetPathLink(e,t,a=!1){var i=e.getSource(),s=i.getFeatures(),n=s.find((e=>e.get("index")==t));try{var o=s.filter((e=>e.get("start_pt_index")==t));o.forEach((e=>{var t=e.get("path_id"),s=this.PathesSegmentsForEdit.find((e=>e.PathID==t));if(e)if(a)i.removeFeature(e),this.PathesSegmentsForEdit.remove(s);else{var o=e.getGeometry(),r=o.getCoordinates()[1],l=n.getGeometry().getCoordinates(),d=new U.Z([l,r]);e.setGeometry(d),e.setStyle((0,oe.bE)(e)),s.StartCoordination=l}}))}catch(l){}try{var r=s.filter((e=>e.get("end_pt_index")==t));r.forEach((e=>{var t=this.PathesSegmentsForEdit.find((t=>t.PathID==e.get("path_id")));if(a)i.removeFeature(e),this.PathesSegmentsForEdit.remove(t);else{var s=e.getGeometry(),o=s.getCoordinates()[0],r=n.getGeometry().getCoordinates(),l=new U.Z([o,r]);e.setGeometry(l),e.setStyle((0,oe.bE)(e)),t.EndCoordination=r}}))}catch(l){}},PushPathEndPointData(e=new N.Z){if(e.get("feature_type")==this.FeatureKeys.Station){if(2==this.PathEditTempStore.length)this.PathEditTempStore=[];else if(1==this.PathEditTempStore.length&&this.PathEditTempStore[0].get("index")==e.get("index"))return;if(this.PathEditTempStore.push(e),2==this.PathEditTempStore.length&&(this.GenPath(this.PathEditTempStore),"bi-direction"==this.EditorOption.AddPathMode.Direction)){var t=[this.PathEditTempStore[1],this.PathEditTempStore[0]];this.GenPath(t)}}},GenPath(e=[]){var t=e[0],a=e[1],i=t.get("index"),s=a.get("index"),n=t.get("data").X,o=t.get("data").Y,r=a.get("data").X,l=a.get("data").Y,d=t.getGeometry().getCoordinates(),c=a.getGeometry().getCoordinates(),u=[(d[0]+c[0])/2,(d[1]+c[1])/2],m=((0,oe.s6)(u,this.GenNewIndexOfStation()),0!=a.get("station_type")||0!=t.get("station_type")),h=`${i}_${s}`;if(!this.PathLayerForCoordination.getSource().getFeatures().find((e=>e.get("path_id")==h))){var g={PathID:h,StartPtIndex:i,EndPtIndex:s,StartCoordination:[n,o],EndCoordination:[r,l],IsEQLink:m,IsSingleCar:!1,IsPassable:!0,IsExtinguishingPath:!1,Speed:1,LsrMode:0,DodgeMode:0,SpinMode:0};this.PathesSegmentsForEdit.push(g);var p=t.get("targets");p||(p=[]);var _=t.get("data");_.Target[s]=1,t.set("data",_),p.push(s),t.set("targets",p),this.UpdateStationPathLayer()}},GenNewIndexOfStation(){var e=this.PointLayer.getSource().getFeatures().map((e=>e.get("index"))),t=e.filter((e=>void 0!=e)).sort(((e,t)=>e-t)),a=0==t.length?0:t[t.length-1]+1;return a},AgvDisplayOptHandler(){this.AGVLocLayer.setVisible("visible"==this.agv_display)},SlamImageDisplayOptHandler(){"coordination"!=this.map_display_mode&&this.UpdateStationPathLayer(),this.ImageLayer.setVisible("visible"==this.map_image_display)},MapDisplayModeOptHandler(e=!0){var t="coordination"==this.map_display_mode;this.UpdateStationPathLayer(),this.StationNameDisplayOptHandler(),this.PointLayer.setVisible(t),this.PointRouteLayer.setVisible(!t),this.PathLayerForCoordination.setVisible(t),this.PathLayerForRouter.setVisible(!t),this.RegionLayer.setVisible(t&&this.regionsVisible),this.UpdateEQLDULDFeature(),this.UpdateAGVLocLocation(),e&&this.map.getView().setCenter(t?this.GetMidPointOfCoordinationMode():this.GetMidPointOfRouterMode())},UpdateAGVLocLocation(){this.agvs_info.AGVDisplays.forEach((e=>{this.UpdateAGVLocByMapMode(this.map_display_mode,e)}))},GetMidPointOfRouterMode(){var e=[...this._map_stations];e.sort(((e,t)=>e.graph[0]-t.graph[0]));var t=e[0],a=e[e.length-1],i=(a.graph[0]+t.graph[0])/2;e.sort(((e,t)=>e.graph[1]-t.graph[1])),t=e[0],a=e[e.length-1];var s=(a.graph[1]+t.graph[1])/2;return[i,s]},GetMidPointOfCoordinationMode(){var e=[...this._map_stations];e.sort(((e,t)=>e.coordination[0]-t.coordination[0]));var t=e[0],a=e[e.length-1],i=(a.coordination[0]+t.coordination[0])/2;e.sort(((e,t)=>e.coordination[1]-t.coordination[1])),t=e[0],a=e[e.length-1];var s=(a.coordination[1]+t.coordination[1])/2;return console.log(i,s),[i,s]},StationNameDisplayOptHandler(){this.StationPointsFeatures.forEach((e=>{var t=e.get("index"),a=e.get("data"),i="";"index"==this.station_name_display_mode&&(i=t+""),"name"==this.station_name_display_mode&&(i=a.Graph.Display),"tag"==this.station_name_display_mode&&(i=a.TagNumber+"");var s=a.StationType;e.setStyle((0,oe.rL)(i,s,a))})),this.SaveSettingsToLocalStorage()},ShowLocus(e=[],t="red",a=1){var i=this.AGVLocusLayer.getSource();if(i){var s=[];i.clear();let n=(0,oe.tW)(e[e.length-1],!1),o=new N.Z({geometry:new U.Z(e)});o.setStyle((0,oe.DS)(t,a)),s.push(o),s.push(n),i.addFeatures(s)}},HandlerSaveBtnClick(){var e={};this.PointLayer.getSource().getFeatures().forEach((t=>{var a=t.get("index"),i=t.get("data");e[a]=i}));var t={Points:e,Pathes:this.PathesSegmentsForEdit,Regions:this.GetRegionsDataFromLayer(),ImageFile:this.to_upload_image_file,ImageExtent:this.new_map_img_extent};this.$emit("save",t)},HandlePtSettingBtnClick(){this.RemoveKeyboardPressEventListener(),this.editModeContextMenuVisible=!1,this.$refs.ptsetting.Show({index:this.previousSelectedFeature.get("index"),point:this.previousSelectedFeature.get("data")})},ReloadMap(e=!0){var t=async()=>{this.loading=e,this.map_img_url_for_editor=null,await re.p.dispatch("DownloadMapData",""),console.log("re-done"),this.RefreshMap(),this.loading=!1};e?this.$swal.fire({text:"確定要重新載入圖資?",title:"",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((async e=>{e.isConfirmed&&t()})):t()},DeepClonePathSegmentData(){this.PathesSegmentsForEdit=JSON.parse(JSON.stringify(this.PathesSegments))},InitMap(){this.map_image_display=re.p.getters.DefaultShowBackgroundImage?"visible":"";const e=re.p.getters.Rotation;this.new_map_img_extent=this.map_img_extent;const t=this.map_img_extent,a=new z.Z({code:"xkcd-image",units:"pixels",extent:t});this.map_name=re.p.getters.MapName,this.ImageLayer=new $.Z({source:new j.Z({url:this.map_image_url,projection:a,imageExtent:t,imageSize:this.map_img_size}),visible:"visible"==this.map_image_display}),this.AGVLocusLayer=new Y.Z({source:new H.Z({features:[]})}),this.map=new R.Z({layers:[this.ImageLayer,this.RegionLayer,this.EQMaintainIconLayer,this.TransferTaskIconLayer,this.EQLDULDStatusLayer,this.PathLayerForCoordination,this.PathLayerForRouter,this.PointLayer,this.PointRouteLayer,this.AGVLocLayer,this.AGVLocusLayer],target:this.id,renderer:"canvas",view:new Z.ZP({projection:a,center:[0,0],zoom:1,maxZoom:20,rotation:e*Math.PI/180,animation:!1,duration:0,smoothResolutionConstraint:!1,smoothExtentConstraint:!1,showFullExtent:!0})}),this.AGVLocLayer.setVisible(this.agv_show),this.editable&&(this.PointLayer.setVisible(!1),this.PathLayerForCoordination.setVisible(!1),this.PointRouteLayer.setVisible(!0),this.PathLayerForRouter.setVisible(!0)),this.EQLDULDStatusLayer.setVisible(!this.editable),this.InitMapEventHandler(),this.initGrid(this.map,this.MapGridSize,t)},ResetImageExtend(e){var t=new j.Z({url:this.map_image_url,projection:new z.Z({code:"xkcd-image",units:"pixels",extent:e}),imageExtent:e,imageSize:this.map_img_size});this.ImageLayer.setSource(t)},ResetImage(e){var t=new j.Z({url:e,projection:new z.Z({code:"xkcd-image",units:"pixels",extent:this.map_img_extent}),imageExtent:this.map_img_extent,imageSize:this.map_img_size});this.ImageLayer.setSource(t)},initGrid(e,t,a=[-25,-25,15,15],i=-2,s=0){const n=a.map((e=>10*e)),o=t,r=new H.Z;for(let l=n[0];l<=n[2];l+=o){const e=new N.Z(new U.Z([[l+i,n[1]+s],[l+i,n[3]+s]]));e.set("grid_line",!0),r.addFeature(e)}for(let l=n[1];l<=n[3];l+=o){const e=new N.Z(new U.Z([[n[0]+i,l+s],[n[2]+i,l+s]]));e.set("grid_line",!0),r.addFeature(e)}this.gridLayer=new Y.Z({source:r,name:"gridLayer",style:new Q.ZP({stroke:new K.Z({color:"rgb(221, 221, 221)",width:1})})}),e.addLayer(this.gridLayer)},GetForbidRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"forbid"==e.get("region_type")));return t.length},GetPassibleRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"passible"==e.get("region_type")));return t.length},GetGlobalPathRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"path"==e.get("region_type")));return t.length},GetRegionsDataFromLayer(){let e=[];var t=this.RegionLayer.getSource().getFeatures(),a=t.filter((e=>"polygon"==e.get("type")));return a.forEach((t=>{var a=t.get("name"),i=t.get("region_type");let s=new oe.S9("",[],-1);Object.assign(s,t.get("data"));var n=t.getGeometry().flatCoordinates;function o(e){const t=[];let a=[];for(let i=0;i<e.length;i++)a.push(e[i]),i%2===1&&(t.push(a),a=[]);return t}let r=o(n);s.Name=a||`禁制區-${GetForbidRegionCount()+1}`,s.PolygonCoordinations=r,s.RegionType="forbid"==i?0:1,e.push(s)})),console.log(e),e},ResetMapCenterViaAGVLoc(e){var t=this.AGVFeatures[e];if(t){var a=t.agv_feature.getGeometry().getCoordinates();this.map.getView().setCenter(a)}},HandleSettingBtnClick(){this.$refs.settings.show=!0},ClearSelectedFeature(){if(!this.editable){try{this.previousSelectedFeatures.forEach((e=>{var t=e.get("oristyle");e.setStyle(t)}));var e=this.previousSelectedFeature.get("oristyle");this.previousSelectedFeature.setStyle(e)}catch{}this.previousSelectedFeatures=[]}},HighLightFeatureSelected(e=[new N.Z],t="red"){if(this.editable)return this.previousSelectedFeatures=[],void this.previousSelectedFeatures.push(e[0]);try{this.ClearSelectedFeature(),e.forEach((e=>{var a=e.getStyle();if(a){e.set("oristyle",a.clone());var i=a.clone(),s=i.getText();if(s){var n=s.getStroke();if(n){var o=n.clone();o.setColor(t),s.setStroke(o),e.setStyle(i)}}}this.previousSelectedFeatures.push(e)}))}catch(a){}},HighLightFeaturesByStationType(e=0,t="red"){var a=this.StationPointsFeatures.filter((t=>t.get("station_type")==e));this.HighLightFeatureSelected(a,t)},HandleAGVUploadData(e=[{TagNumber:0,X:0,Y:0,Theta:0}]){var t=this.PointLayer.getSource().getFeatures();Object.values(e).forEach((e=>{var a=t.find((t=>t.get("data").TagNumber==e.TagNumber));if(a){a.setGeometry(new G.Z([e.X,e.Y]));var i=a.get("data");i.Direction=parseInt(Math.round(e.Theta)),a.set("data",i)}else{var s=new oe.eX;s.coordination=[e.X,e.Y],s.index=this.GenNewIndexOfStation(),s.station_type=0,s.name=e.TagNumber+"",s.tag=e.TagNumber;var n=new oe.ux;n.StationType=0,n.X=e.X,n.Y=e.Y,n.Graph.X=parseInt(Math.round(e.X)),n.Graph.Y=parseInt(Math.round(e.Y)),n.Name=e.TagNumber+"",n.TagNumber=e.TagNumber,n.Direction=parseInt(Math.round(e.Theta)),s.data=n;var o=(0,oe.HB)(s);this.PointLayer.getSource().addFeature(o)}}))},showContextMenu(e){if(e.preventDefault(),!this.editable&&"add-station"!=this.EditorOption.EditAction&&this.previousSelectedFeature){this.contextMenuTop=e.clientY,this.contextMenuLeft=e.clientX;var t=this.previousSelectedFeature.get("feature_type");this.contextMenuOptions.feature_type=t;var a=this.previousSelectedFeature.get("data");a&&(this.contextMenuOptions.title=a.Name,this.contextMenuOptions.point_data=a,this.contextMenuOptions.task_options=new oe.UY(a.StationType),this.contextMenuOptions.show_task_dispatch=this.task_dispatch_menu_show),this.editModeContextMenuVisible=!0}},HandlePtSettingDrawerLeaved(){this.RemoveKeyboardPressEventListener(),document.addEventListener("keydown",this.EditModeKeybordEvents)},PointSettingChangedHandle(e){var t=e.index,a=e.pointData,i=function(e,t,a,i=!1){var s=e.getFeatures().find((e=>e.get("index")==t));s.set("data",a),s.set("station_type",a.StationType),s.setStyle((0,oe.rL)(a.Name,a.StationType,a));var n=s.getStyle(),o=n.clone(),r=o.getText();r.setText(a.Graph.Display);var l=r.getStroke();if(l){var d=l.clone();d.setColor("blue"),r.setStroke(d)}s.setStyle(o),i&&s.setGeometry(new G.Z([a.X,a.Y]))};i(this.PointLayer.getSource(),t,a,!0),i(this.PointRouteLayer.getSource(),t,a);for(var s=0!=a.StationType,n=this.PathesSegmentsForEdit.filter((e=>e.StartPtIndex==t)),o=this.PathesSegmentsForEdit.filter((e=>e.EndPtIndex==t)),r=0;r<n.length;r++)n[r].IsEQLink=s,n[r].StartCoordination=[a.X,a.Y];for(r=0;r<o.length;r++)o[r].IsEQLink=s,o[r].EndCoordination=[a.X,a.Y];this.UpdateStationPathLayer()},HandleMenuTaskBtnClick(e={action:"",station_data:{}}){this.editModeContextMenuVisible=!1;var t=0;"move"==e.action?t=0:"load"==e.action|"unload"==e.action|"carry"==e.action?t=1:"charge"==e.action&&(t=3),this.HighLightFeaturesByStationType(t,"blue"),ne.Z.emit("bus-show-task-allocation",e)},HandleAGVUploadCorrdinationChanged(e){re.p.dispatch("UploadCoorFunctionSwitch",e)},HandleLDULDLabelClick(e,t){},EqMaintainIconDisplay(e,t){var a=this.EQMaintainIconLayer.getSource().getFeatures(),i=a.find((t=>t.get("tag")==e));if(i){var s=i.getStyle();s.getImage().setOpacity(t?1:0),i.setStyle(s)}},CreateEqMaintainingFeature(e,t){var a=t,i=new N.Z({geometry:new G.Z(a)});return i.set("tag",e.TagNumber),i.setStyle(new Q.ZP({image:new te.Z({src:"/maintain-64.png",scale:.8,anchor:[.01,1.6],size:[64,64],opacity:0})})),i},ChangeLDULDStatus(e,t,a){try{var i=1!=t&&2!=t,s=1==t?"load":"unload",n=this.EQLDULDStatusLayer.getSource().getFeatures(),o=n.find((t=>t.get("data").TagNumber==e));if(!o)return;var r=o.getStyle();if(!r)return;var l=r.getText();if(!l)return;this.EqMaintainIconDisplay(e,a);var d="";1!=t&&2!=t||(d=1==t?" 入料請求":"出料請求"),l.setText(d),l.setBackgroundFill(new J.Z({color:i?"":1==t?"orange":"blue"})),r.setText(l),o.set("action",s),o.setStyle(r),o.changed()}catch(c){console.error(c)}},RenderEQLDULDStatus(){var e=JSON.stringify(this.eq_data);this.prviousEQDataJson!=e&&(this.eq_data.forEach((e=>{let t=new xt.Z;Object.assign(t,e),this.ChangeLDULDStatus(t.Tag,t.TransferStatus,t.IsMaintaining)})),this.prviousEQDataJson=e)},RefreshMap(){this._map_stations=JSON.parse(JSON.stringify(this.map_station_data)),this.DeepClonePathSegmentData(),this.UpdateStationPathLayer(),this.UpdateStationPointLayer(),this.MapDisplayModeOptHandler(!1),this.UpdateForbidPointLayer(),this.ModifyMapRotation(re.p.getters.Rotation),this.ResetImageExtend(this.map_img_extent)},RemoveForbidRegionOperationInteractions(){this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.edit_forbid_regions_interaction),this.RemoveInteraction(this.delete_forbid_regions_interaction)},EditModeKeybordEvents(e){if(0==this.selectedSettingTabIndex&&!this.IsPathEditing&&"edit"==this.EditorOption.EditMode){var t=e.key.toLowerCase();"e"==t&&(this.EditorOption.EditMode="edit"),"v"==t&&(this.EditorOption.EditMode="view"),"escape"==t&&(this.draw_forbid_regions_interaction&&this.draw_forbid_regions_interaction.abortDrawing(),this.draw_global_path_regions_interaction&&this.draw_global_path_regions_interaction.abortDrawing()),"1"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="add-station",this.AddEditMapInteraction()),"2"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="edit-station",this.AddEditMapInteraction()),"3"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="remove-station",this.AddEditMapInteraction()),"4"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="add-path",this.AddEditMapInteraction()),"5"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="edit-path",this.AddEditMapInteraction()),"6"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="remove-path",this.AddEditMapInteraction()),"7"==t&&(this.EditorOption.EditAction="add-forbid-region",this.RemoveInteraction(this.mapEditsInteraction),this.AddDrawForbidActionInteraction(this.EditorOption.AddRegionMode.Mode))}},OpenPath_editor(e=new N.Z){var t=e.get("path_id");if(t){var a=this.PathesSegmentsForEdit.find((e=>e.PathID==t)),i=a.EndPtIndex+"_"+a.StartPtIndex,s=this.PathesSegmentsForEdit.find((e=>e.PathID==i));this.IsPathEditing=!0,this.SelectedPathData=a,this.HandlePathTbRowClick(a),s?(this.ShowPathSelectDialog=!0,this.PathesCandicats=[a,s]):(this.HandlePathTbRowClick(a),this.$refs["path_editor"].Show(a))}},HandlePathSelected(e){this.IsPathEditing=!0,this.ShowPathSelectDialog=!1,this.SelectedPathData=e,setTimeout((()=>{this.HandlePathTbRowClick(e)}),1e3),this.$refs["path_editor"].Show(e)},HandlePathSetingDrawerClosed(e){this.IsPathEditing=!1,this.selected_path_feature&&this.RestoreOriginalPathStyle(this.selected_path_feature)},HandleForbidRegionEditDrawerClosed(){document.addEventListener("keydown",this.EditModeKeybordEvents)},SetPathesAsBeControledStyle(){var e=Object.keys(this.ControledPathesBySystem);if(0!=e.length){var t=this.PathLayerForCoordination.getSource();e.forEach((e=>{var a=t.getFeatures().find((t=>t.get("path_id")==e));if(a){var i=a.getStyle(),s=i[0].getStroke();s&&(s.setColor("orange"),i[0].setStroke(s),a.setStyle(i))}})),this.map.render()}},ChangeToSelectAGVMode(){this.RestoredFillColorOfChangedFeature(),this.ChangeFeaturesAsIgnoreStyle(this.StationPointsFeatures,"rgb(222, 222, 222)"),this.IsSelectAGVMode=!0,this.IsSelectEQStationMode=!1,this.AGVLocLayer.setVisible(!0)},ChangeToSelectEQStationMode(){var e="move"==this.TaskDispatchOptions.action_type,t="load"==this.TaskDispatchOptions.action_type,a="unload"==this.TaskDispatchOptions.action_type,i="charge"==this.TaskDispatchOptions.action_type,s="park"==this.TaskDispatchOptions.action_type,n=(this.TaskDispatchOptions.action_type,"destine"==this.TaskDispatchOptions.direction);this.highlightingFeatures=[],"source"==this.TaskDispatchOptions.direction&&(this.RestoredFillColorOfChangedFeature(),this.TransferTaskIconLayer.getSource().clear());var o=this.StationPointsFeatures.filter((e=>e.get("data").IsCharge)),r=this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge)),l=this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge&&0!=e.get("data").StationType)),d=(this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge&&4!=e.get("data").StationType)),this.StationPointsFeatures.filter((e=>0==e.get("data").StationType))),c=this.StationPointsFeatures.filter((e=>e.get("data").IsParking||4==e.get("data").StationType||e.get(5=="data".StationType))),u=d.filter((e=>e.get("data").IsVirtualPoint));if(this.AGVLocLayer.setVisible(!1),this.RestoredFillColorOfChangedFeature(),this.ChangeFeaturesAsIgnoreStyle(this.AGVMapFeatures),"charge"==this.TaskDispatchOptions.action_type)this.ChangeFeaturesAsIgnoreStyle(r),console.info(o),this.ChangeFeaturesAsCandicatingStyle(o);else if(this.ChangeFeaturesAsIgnoreStyle(o),this.TaskDispatchOptions.stations_to_show&&0!=this.TaskDispatchOptions.stations_to_show.length){var m=this.TaskDispatchOptions.stations_to_show.map((e=>e.tag)),h=this.StationPointsFeatures.filter((e=>!m.includes(e.get("data").TagNumber))),g=this.StationPointsFeatures.filter((e=>m.includes(e.get("data").TagNumber)));this.ChangeFeaturesAsIgnoreStyle(h),this.ChangeFeaturesAsCandicatingStyle(g)}else n&&(e?(this.ChangeFeaturesAsIgnoreStyle(l),this.ChangeFeaturesAsIgnoreStyle(u)):a||t?(this.ChangeFeaturesAsIgnoreStyle(o),this.ChangeFeaturesAsIgnoreStyle(d),this.ChangeFeaturesAsCandicatingStyle(l)):i?(this.ChangeFeaturesAsIgnoreStyle(l),this.ChangeFeaturesAsIgnoreStyle(d)):s?(this.ChangeFeaturesAsIgnoreStyle(l),this.ChangeFeaturesAsIgnoreStyle(d),this.ChangeFeaturesAsCandicatingStyle(c)):this.ChangeFeaturesAsIgnoreStyle(this.StationPointsFeatures));if(this.IsSelectAGVMode=!1,this.IsSelectEQStationMode=!0,clearInterval(this.featureHighlightTimerID),!e){var p=0;this.featureHighlightTimerID=setInterval((()=>{var e=(e,t,a)=>{var i=e.getStyle().clone(),s=i.getText(),n=s.getFill().clone(),o=s.getBackgroundFill();if(o){var r=o.clone();r.setColor(a),s.setBackgroundFill(r)}n.setColor(t),s.setFill(n),i.setText(s),e.setStyle(i)};this.highlightingFeatures.forEach((t=>{let a=0==p?"white":"gold",i=0==p?"rgb(9, 76, 176)":"rgb(2, 20, 48)";e(t,a,i)})),p=0==p?1:0}),600)}},ChangeToNormalViewMode(){this.highlightingFeatures=[],clearInterval(this.featureHighlightTimerID),this.AGVLocLayer.setVisible(!0),this.StationNameDisplayOptHandler(),this.IsSelectAGVMode=this.IsSelectEQStationMode=!1,this.TransferTaskIconLayer.getSource().clear(),this.RestoredFillColorOfChangedFeature(),setTimeout((()=>{clearInterval(this.featureHighlightTimerID)}),600)},RestoredFillColorOfChangedFeature(){this.StationPointsFeatures.forEach((e=>{e.get("oriStyle")&&e.setStyle(e.get("oriStyle"))})),this.AGVLocLayer.getSource().getFeatures().forEach((e=>{e.get("oriStyle")&&e.setStyle(e.get("oriStyle"))}))},ChangeFeaturesAsIgnoreStyle(e,t="rgb(222, 222, 222)"){e.forEach((e=>{e.set("isSelectable",!1);var a=e.getStyle();if(a){e.set("oriStyle",a);try{var i=a.clone(),s=i.getImage();if(s){var n=s.clone();n.setOpacity(.5),i.setImage(n)}var o=i.getText();if(o){var r=o.getFill();if(r){var l=r.clone();l.setColor(t),o.setFill(l),e.setStyle(i)}}}catch{}}}))},ChangeFeaturesAsCandicatingStyle(e,t="rgb(222,180,9)"){e.forEach((e=>{var a=e.getStyle();if(a){e.set("oriStyle",a.clone());try{var i=a.clone(),s=i.getImage();if(s){var n=s.clone();n.setScale(.75),i.setImage(n)}var o=i.getText();if(o){o.setFont("bold 22px Arial");var r=o.getFill();if(r){var l=r.clone();l.setColor(t),o.setFill(l),e.setStyle(i),this.highlightingFeatures.push(e)}}}catch(d){console.info(d)}}}))},CreateDestineMarkIcon(e){if(!this.editable){var t=()=>{var e={move:"目的地",carry:"搬運終點",load:"目標放貨設備",unload:"目標取貨設備",charge:"目標充電站"};return e[this.TaskDispatchOptions.action_type]};if("carry"!=this.TaskDispatchOptions.action_type)this.TransferTaskIconLayer.getSource().clear();else{var a=this.TransferTaskIconLayer.getSource().getFeatures();this.TransferTaskIconLayer.getSource().removeFeature(a[1])}this.AddMarkIconWithText(e,t())}},AddMarkIconWithText(e,t){var a=this.StationPointsFeatures.find((t=>t.get("data").TagNumber==e));if(a){var i=a.getGeometry().getCoordinates(),s=this.TransferTaskIconLayer.getSource(),n=(0,oe.Be)(i,t);s.addFeature(n)}},ModifyGridSize(e){this.RemoveGridLayer(),this.initGrid(this.map,e,this.map_img_extent),re.p.commit("setMapGridSize",e)},ModifyGridOffset(){this.RemoveGridLayer(),this.initGrid(this.map,this.MapGridSize,this.map_img_extent,this.MapGridSizeXOffset,this.MapGridSizeYOffset)},ModifyMapRotation(e=void 0){var t=e||this.MapRotation,a=this.map.getView();a.setRotation(t*Math.PI/180),this.map.setView(a),re.p.commit("SetRotation",t),this.MapRotation=t},RemoveGridLayer(){var e=this.map.getLayers().getArray(),t=e.find((e=>"gridLayer"===e.get("name")));t&&this.map.removeLayer(t)},ImageEditClick(){this.ShowImageEditorDialog=!0,setTimeout((()=>{var e=this.$refs["imageEditor"];console.info(e),e.pic=this.map_image_url}),100)},HandleImageCropedDone(e){this.ShowImageEditorDialog=!1,this.map_img_url_for_editor=e.blobURL,this.to_upload_image_file=e.file,this.ResetImage(this.map_img_url_for_editor)},HandlePathColorSelected(e){this.SetPathColor(e)},HandleWorkStationNameColorSelected(e){re.p.commit("setWorkStationPointTextColor",e),this.GetAllPointsFeatures().filter((e=>0!=e.get("station_type"))).forEach((t=>{this.SetPointTextFillColor(t,e)}))},HandleNormalPointNameColorSelected(e){re.p.commit("setNormalPointTextColor",e),this.GetAllPointsFeatures().filter((e=>0==e.get("station_type"))).forEach((t=>{this.SetPointTextFillColor(t,e)}))},HandleWorkStationTextSizeChanged(e){re.p.commit("setWorkStationPointTextFontSize",e),this.GetAllPointsFeatures().filter((e=>0!=e.get("station_type"))).forEach((t=>{this.SetPointTextFontSize(t,e)}))},HandleNormalStationTextSizeChanged(e){re.p.commit("setNormalPointTextFontSize",e),this.GetAllPointsFeatures().filter((e=>0==e.get("station_type"))).forEach((t=>{this.SetPointTextFontSize(t,e)}))},GetAllPointsFeatures(){return[...this.PointLayer.getSource().getFeatures(),...this.PointRouteLayer.getSource().getFeatures()]},SetPointTextFillColor(e,t){var a=e.getStyle(),i=a.getText();i.getFill().setColor(t),a.setText(i),e.setStyle(a)},SetPointTextFontSize(e,t){var a=e.getStyle(),i=a.getText();i.setFont(`bold ${t}px Calibri,sans-serif`),a.setText(i),e.setStyle(a)},SetPathColor(e){re.p.commit("setPathColor",e);var t=[...this.PathLayerForRouter.getSource().getFeatures(),...this.PathLayerForCoordination.getSource().getFeatures()];t.forEach((t=>{var a=t.getStyle(),i=a[0];if(i){var s=i.getStroke();s.setColor(e),i.setStroke(s),a[0]=i,t.setStyle(a)}}))},ResetPointEnableStatus(e={1:!0}){var t=this.PointLayer.getSource().getFeatures(),a=this.PointRouteLayer.getSource().getFeatures();let i=(e=1)=>{var i=t.find((t=>t.get("data").TagNumber==e)),s=a.find((t=>t.get("data").TagNumber==e));return[i,s]},s=(e=new N.Z,t=!0)=>{if(e){var a=re.p.getters.Settings.normalStationTextColor,i=re.p.getters.Settings.workStationTextColor,s=e.get("data");s.Enable=t,e.set("data",s);var n=0==s.StationType,o=s.Graph.Display,r=e.getStyle().clone(),l=r.getText(),d=l.getFill().clone(),c=n?a:i,u=t?c:"rgb(255, 102, 92)";if(d.setColor(u),l.setFill(d),l.setText(`${o}${t?"":"(已禁用)"}`),n){var m=(0,oe.h0)(s);r.setImage(m)}r.setText(l),e.setStyle(r),e.changed()}};Object.keys(e).forEach((t=>{let a=e[t];var n=i(t);s(n[0],a),s(n[1],a)}))}},mounted(){this.loading=!0,this.editable&&(this.RemoveKeyboardPressEventListener(),document.addEventListener("keydown",this.EditModeKeybordEvents)),this.loading=!0;var e=document.getElementById("map");e&&e.addEventListener("contextmenu",(function(e){e.preventDefault()})),setTimeout((()=>{this.DeepClonePathSegmentData(),this.InitMap(),this.RestoreSettingsFromLocalStorage(),this.AddEditMapInteraction(),(0,i.YP)((()=>this.map_station_data),((e,t)=>{e&&this.RefreshMap()}),{deep:!0,immediate:!0}),(0,i.YP)((()=>this.agvs_info),((e,t)=>{e&&JSON.stringify(e)!=JSON.stringify(t)&&this.UpdateAGVLayer()}),{deep:!0,immediate:!0}),(0,i.YP)((()=>this.agvs_info_other_system),((e,t)=>{e&&this.UpdateAGVLocationOfOtherSystem(e)}),{deep:!0,immediate:!0}),ne.Z.on("/show_agv_at_center",(e=>{this.ResetMapCenterViaAGVLoc(e)})),ne.Z.on("/rerender_agv_layer",(()=>{console.log("rerender_agv_layer"),this.AGVLocLayer.getSource().clear(),this.AGVFeatures={}})),(0,i.YP)((()=>this.agv_upload_coordi_data),((e={},t)=>{this.agv_upload_coordination_mode&&this.HandleAGVUploadData(e)}),{deep:!0,immediate:!0}),ne.Z.on("change_to_select_agv_mode",(()=>{this.editable||this.ChangeToSelectAGVMode()})),ne.Z.on("change_to_select_eq_station_mode",(e=>{this.editable||(this.TaskDispatchOptions=JSON.parse(JSON.stringify(e)),this.ChangeToSelectEQStationMode())})),ne.Z.on("change_to_normal_view_mode",(()=>{this.editable||this.ChangeToNormalViewMode()})),ne.Z.on("mark_as_start_station",(e=>{this.editable||(this.TransferTaskIconLayer.getSource().clear(),this.AddMarkIconWithText(e,"搬運起點"))})),ne.Z.on("mark_as_destine_station",(e=>{this.CreateDestineMarkIcon(e)})),this.renderLDULD_StatusTimerId=setInterval((()=>{this.RenderEQLDULDStatus()}),200);var e=document.getElementById(this.id);e&&e.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.UpdateAGVLocLocation(),this.loading=!1,this.MapGridSizeStore=this.MapGridSize}),10),ne.Z.on("Map-Point-Enabled-Property-Changed",(async()=>{var e=await re.p.dispatch("GetPointEnableMap");this.ResetPointEnableStatus(e)}))}};const It=(0,me.Z)(Wt,[["render",O],["__scopeId","data-v-2da63161"]]);var Et=It},3741:function(e,t,a){"use strict";a.d(t,{Z:function(){return P}});var i=a(66252),s=a(3577);const n={class:"rack p-3"};function o(e,t,a,o,r,l){const d=(0,i.up)("RackPortImageVue");return(0,i.wg)(),(0,i.iD)("div",n,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.rowAry,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"d-flex flex-row",key:"row-"+e},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.colAry,(t=>((0,i.wg)(),(0,i.j4)(d,{key:"col-"+t,class:(0,s.C_)(t>1?"shit-left":""),col:t,row:e,hasRack:l.CargoExist(t,e),CarrierID:l.CarrierID(t,e),onOnPortClick:l.HandlePortClicked,isBottom:0==e},null,8,["class","col","row","hasRack","CarrierID","onOnPortClick","isBottom"])))),128))])))),128))])}a(57658);var r=a(49963),l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAa8AAAKKCAMAAAC9PCQrAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABXUExURQAAAAAAAAAcOQArOQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMkMgAAAAAAAAAAAAQkNAAAAAAAAAAAAAAAAAEFCAENEgIRGAMfLAQjMwQkM4NUYAYAAAAWdFJOUwAREhImO0BQZXl6gI6Pk6O4v8bN4vc8jN88AAAACXBIWXMAADLAAAAywAEoZFrbAAAPV0lEQVR4Xu3b65Ld1mEFYceOc4+TyAl90/s/Z2Cy5eEBqdaAc0ZeKPXnPyQ2tAdeXayiXOVffcid1Ote6nUv9bqXet1Lve6lXvdSr3up173U617qdS/1upd63Uu97qVe91Kve6nXvdTrXup1L/W6l3rdS73upV73Uq97qde91Ote6nUv9bqXet3La3r9Kj8L5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb3bbXb3/PL57rf/6JX/wdMLe6a69/fafP+vDh3/nVz4+51T17/eN/v9dnHff+3YJ9HPsnPLnXb777/gff/Zpnz/cv/3fxs17v43/hJxf7HYscfsejr/r4s3/Cc3v9+iXX+wX7h/+6+lkXfLr6qcE+y+XBPv1s99ReD7neK9g//+/Vz7qCu59Y7CGXBuNHq2f2OuV6n2D/wUe9c6+nBTvlsmD8ZPXEXl/keodgv/0933Tg0XNx9189pdgXuSQYP1c9r9dXch3BfsPpc/wbX/QRz56Luz96QrCv5PrxYPxY9bxeL7n+cvznB99x+gwf/xb/gqfPxd2fvPlfnr+a60eD8VPV83rxLd//+Q/HP/KHP/O77zl9gk9/i3/B4+fi7h+88Y8YG3z//R//etkf+c2PjfLxJ/6Ep/f6mOuzYJy+2Q9/i3/BwXNx99+87Y8YG3zK9Vkwjk8+veSe3utTriMYv+f0rf72t/gXnDwXd3/mLX/E2IBcL8E4PuEl9exef+Gf+fDh0++f1Os/ufRzHD0Xd3/uDcHYgIsOPOD4hHfUs3u9fBu/5/RNPv9b/AsOn4u7H31zMTbgmgMPOD7hHXWHXg9/i3/B6XNx98m3BmMDbjnwgOMT3lF36MWFZ5w+F3efcXoVG3DJgQccn/COqtcj7j7j9Co24JIDDzg+4R1Vr0fcfcbpVWzAJQcecHzCO6pej7j7jNOr2IBLDjzg+IR3VL0ecfcZp1exAZcceMDxCe+oej3i7jNOr2IDLjnwgOMT3lH1esTdZ5xexQZccuABxye8o+r1iLvPOL2KDbjkwAOOT3hH1esRd59xehUbcMmBBxyf8I6q1yPuPuP0KjbgkgMPOD7hHVWvR9x9xulVbMAlBx5wfMI7ql6PuPuM06vYgEsOPOD4hHdUvR5x9xmnV7EBlxx4wPEJ76h6PeLuM06vYgMuOfCA4xPeUfV6xN1nnF7FBlxy4AHHJ7yj6vWIu884vYoNuOTAA45PeEfV6xF3n3F6FRtwyYEHHJ/wjqrXI+4+4/QqNuCSAw84PuEdVa9H3H3G6VVswCUHHnB8wjuqXo+4+4zTq9iASw484PiEd1S9HnH3GadXsQGXHHjA8QnvqHo94u4zTq9iAy458IDjE95R9XrE3WecXsUGXHLgAccnvKPq9Yi7zzi9ig245MADjk94R9XrEXefcXoVG3DJgQccn/COqtcj7j7j9Co24JIDDzg+4R1Vr0fcfcbpVWzAJQcecHzCO6pej7j7jNOr2IBLDjzg+IR3VL0ecfcZp1exAZcceMDxCe+oej3i7jNOr2IDLjnwgOMT3lH1esTdZ5xexQZccuABxye8o+r1iLvPOL2KDbjkwAOOT3hH3bjXz4kvuYoNuOTAA45PeEfV61X4kqvYgEsOPOD4hHdUvV6FL7mKDbjkwAOOT3hH1etV+JKr2IBLDjzg+IR3VL1ehS+5ig245MADjk94R9XrVfiSq9iASw484PiEd1S9XoUvuYoNuOTAA45PeEfV61X4kqvYgEsOPOD4hHdUvV6FL7mKDbjkwAOOT3hH1etV+JKr2IBLDjzg+IR31PPG4FPOOP1lYoMvcPwN6vWe2OALHH+Der0nNvgCx9+gXu+JDb7A8Teo13tigy9w/A2e1+tPfMujP3H6y/T1Td4yyvN6ffXjftm5fiTYW0Z5Yq/8DOp1L/W6l3rdS73upV738ppe/M/HeWfMreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHc6lUvZUa97qVe91Kve6nXvdTrXup1L/W6l3rdS73upV73Uq97qde91Ote6nUv9bqXet1Lve6lXvdSr3up173U617qdS/1upd63Uu97qVe91Kve6nXvbymF//3ibwz5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuZW9drB3KpeO5hb1WsHc6t67WBuVa8dzK3qtYO5Vb12MLeq1w7mVvXawdyqXjuYW9VrB3Oreu1gblWvHcyt6rWDuVW9djC3qtcO5lb12sHcql47mFvVawdzq3rtYG5Vrx3Mreq1g7lVvXYwt6rXDuYWHz78P2wCJnDMPwoyAAAAAElFTkSuQmCC",d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATMAAAE7CAMAAACG1ZYBAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAPUExURQQkM9nZ2TZPWn9/fwAAACWTLiwAAAAFdFJOU/////8A+7YOUwAAAAlwSFlzAAAywAAAMsABKGRa2wAABMRJREFUeF7t2rGOFTAUxNAF/v+fmSc5ElVwCrbBp5zS1ZWSryRJkm/wI39Hq4M1N7Q6WHNDq4M1N7Q6WHNDq4M1N7Q6WHNDq4M1N7Q6WHNDq4M1N7Q6WHNDq4P142f+RJUPWh2sHz+Z8lGzdzV7V7N3NXtXs3c1e/fW7Nd/jARTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEc2mWJEnyL3GB5IZWB2tuaHWw5oZWB2tuaHWw5oZWB2tuaHWw5oZWB2tuaHWw5oZWSZIk34EL5OO8b+bj7U04HzV7198DiwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBFMziwRTM4sEUzOLBPPWLB81e1ezdzV7V7N3NXtXs3c1eyeb5U9U+aDVwZobWh2suaHVwZobWh2suaHVwZobWh2suaHVwZobWh2suaHVwZobWh2suaHVwZobWiVJkvw7X1+/AQrO+r6NFracAAAAAElFTkSuQmCC",c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATMAAAE6CAMAAABNiUWkAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAkUExURQAAAAAkNwMjNAQlNAQjMwQjMwQkMxo0QTdKU0ZVXHF1d39/fyltJHkAAAAFdFJOUwAcWHbRMrqtrAAAAAlwSFlzAAAywAAAMsABKGRa2wAABWxJREFUeF7t20FyFDsURNEG2xib/e8XAympnozrZWp87+R39PDEjw6ktB6rb88/6Kuev0mpBNlt/0ODrOkzGmRtOxpkRhUNMqsrGmT3vei/F7RF9vr+iz73/iqfiQZZ244GmVFFg8yqoEHmdUF76ANkXQttmEHWNtFk9gJZ3/s/q/n/mb6mu2SFWZCsMAuS1TD7qa/p637KapiRH2Z5j+/6QG7fH6CFfZCBlvWXDLQkkYHmN8n+9KQv6eueZKUgcypokHld0CBzm2iL7E0nK6q9yWeiQda3oUHmVNAg87qi6QNkXQttmkHWNdGGGWR9A22Y6Wu6S1aYBckKsyBZ8Xvmt/+ekR9medxpxJXDEzlth3Tq+3QZRF0iA81vkvEQxWw9Q4Gsi7c7efVFBWRWOxpkRhUNMquCBpnXBW2e0SFrWmjDDLK2iSYz3u4Y8XbnIFlhFiQrzIJkNcx4u9PH253zMMvj79zjeLsTx9udON7uxPF2J2693WEPuI89IK/e0kJmtaNBZlTRILMqaJB5XdDmeROypoU2zCBrm2gyYw8wYg84SFaYBckKsyBZDTP2gD72gPMwy+PuLI49II49II49II49IG7tAQwCXmsOgKyLDSWv3mxDZrWjQWZU0SCzKmiQeV3Q5hkdsqaFNswga5toMmNDMWJDOUhWmAXJCrMgWQ0zNpQ+NpTzMMvjvjGODSWODSWODSWODSVubSjsAfexB+TVW1rIrHY0yIwqGmRWBQ0yrwvaPG9C1rTQhhlkbRNNZuwBRuwBB8kKsyBZYRYkq2HGHtDHHnAeZnncncWxB8SxB8SxB8SxB8StPYBBwGvNAZB1saHk1ZttyKx2NMiMKhpkVgUNMq8L2jyjQ9a00IYZZG0TTWZsKEZsKAfJCrMgWWEWJKthxobSx4ZyHmZ53DfGsaHEsaHEsaHEsaHErQ2FPeA+9oC8eksLmdWOBplRRYPMqqBB5nVBm+dNyJoW2jCDrG2iyYw9wIg94CBZYRYkK8yCZDXM2AP62APOwyyPu7M49oA49oA49oA49oC4tQcwCHitOQCyLjaUvHqzDZnVjgaZUUWDzKqgQeZ1QZtndMiaFtowg6xtosmMDcWIDeUgWWEWJCvMgmQ1zNhQ+thQzsMsj/vGODaUODaUODaUODaUuLWhsAfcxx6QV29pIbPa0SAzqmiQWRU0yLwuaPO8CVnTQhtmkLVNNJmxBxixBxwkK8yCZIVZkKyGGXtAH3vAeZjlcXcWxx4Qxx4Qxx4Qxx4Qt/YABgGvNQdA1sWGkldvtiGz2tEgM6pokFkVNMi8LmjzjA5Z00IbZpC1TTSZsaEYsaEcJCvMgmSFWZCshhkbSh8bynmY5XHfGMeGEseGEseGEseGErc2FPaA+9gD8uotLWRWOxpkRhUNMquCBpnXBW2eNyFrWmjDDLK2iSYz9gAj9oCDZIVZkKwwC5LVMGMP6GMPOA+zPO7O4tgD4tgD4tgD4tgD4tYe8HjSV3Tfk7w+gsxtoi2yN/2Ll2pv8plokPVtaJA5FTTIvK5o+gBZ10KbZpB1TbRhBlnfQBtm+prukhVmQbLCLEhW/J757b9n5IdZHncaceXwRE7bIZ36Pl0GUZfIQPObZDwQMFvPAyDr4k1FXv1Ld8isdjTIjCoaZFYFDTKvC9o8o0PWtNCGGWRtE01mvKkw4k3FQbLCLEhWmAXJapjxpqKPNxXnYZbH3x/H8aYijjcVcbypiONNRdx6U8EecB97QF69pYXMakeDzKiiQWZV0CDzuqDN8yZkTQttmEHWNtFkxh5gxB5wkKwwC5IVZkGyGmbsAX3sAedhlsfdWRx7QBx7QBx7QBx7QNwH2ePxG4YEpGOGM03CAAAAAElFTkSuQmCC",u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAasAAAHACAMAAAAr/LfGAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAABsUExURQAAAAAAAAAcOQArOQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMkMgAAAAAAAAAAAAAAAAAAAAAAAAQkNAQkMwAAAAAAAAAAAAAAAAAAAAEFCAENEgIRGAMfLAQjMwQkMxkk28IAAAAddFJOUwAJEhIWIzA9QEpYZXJ/gIyTmaaztL/BxsfO2+j11oxMwwAAAAlwSFlzAAAywAAAMsABKGRa2wAAC+JJREFUeF7t2OuSHMUBRGEMBt+wjbGN8GW57fu/o4ueI3bVW05tzfSg7ND5+KPt6ii18gQRCn3yoLOw1XnY6jxsdR62Og9bnYetzsNW52Gr87DVedjqPGx1HrY6D1udh63Ow1bnYavzsNV52Oo8bHUetjoPW52Hrc7DVudhq/Ow1XnY6jxsdR62Oo/XtPpE98fWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2KoEWye2KsHWia1KsHViqxJsndiqBFsntirB1omtSrB1YqsSbJ3YqgRbJ7YqwdaJrUqwdWKrEmyd2Grzz9/ziw+GrZOztfriG35xrIeHv/CrD4Wtk5O1+vJOXzP+lB841mXq6JhWn715fOvbz3h2B5///VVfc4Xtz3lwra9YZPiKR8H2BdkhrT59SvX4+OZTnh7uT/991ddcY/tzHhvrWarXxLp8QXREq3dS3S3Wb79+3ddc5XL1kbXeSfWKWHxAckCrXao7xfrjf173Ndfh7uNi7VK9Pxa/f3J7qxep7hHrN3/jW+7d6uGYv72/SPXeWPz2yc2tnv214smbg/+C8Yd/8ykDj47F3ZsD/teapHpfLH7z5OZW3/Ilj48/jf/eesPpMf7Kh2x4dizuvrg51jTVe2Lxeyc3t+I7Hn/8brz53Y/89MjpEX73r8tngKfH4u63bqzFBo+P3/982ff8kEfZft/sqFZbqmexOD3An7eLn/D4WNz9i9tiscEl1bNYHE9dXo2OanVJNWLxM6c3++IbLv4FB8fi7mduqcUGpHqKxfEUryYHtfqJVx8eLj8f1epLbn2Gk2Nx93M3xGIDLhp4wPEUbyYHtXr6Ln7m9Daf/4NLn+PsWNz9juv/9s4G3DPwgOMp3kyaW13+TWmPw2Nx9861/2uxAbcMPOB4ijeT4lb8m9Iep8fi7j1OV7EBlww84HiKN5PiVly4x+mxuHuP01VswCUDDzie4s3EVhvu3uN0FRtwycADjqd4M7HVhrv3OF3FBlwy8IDjKd5MbLXh7j1OV7EBlww84HiKNxNbbbh7j9NVbMAlAw84nuLNxFYb7t7jdBUbcMnAA46neDOx1Ya79zhdxQZcMvCA4yneTGy14e49TlexAZcMPOB4ijcTW224e4/TVWzAJQMPOJ7izcRWG+7e43QVG3DJwAOOp3gzsdWGu/c4XcUGXDLwgOMp3kxsteHuPU5XsQGXDDzgeIo3E1ttuHuP01VswCUDDzie4s3EVhvu3uN0FRtwycADjqd4M7HVhrv3OF3FBlwy8IDjKd5MbLXh7j1OV7EBlww84HiKNxNbbbh7j9NVbMAlAw84nuLNxFYb7t7jdBUbcMnAA46neDOx1Ya79zhdxQZcMvCA4yneTGy14e49TlexAZcMPOB4ijcTW224e4/TVWzAJQMPOJ7izcRWG+7e43QVG3DJwAOOp3gzsdWGu/c4XcUGXDLwgOMp3kxsteHuPU5XsQGXDDzgeIo3E1ttuHuP01VswCUDDzie4s3EVhvu3uN0FRtwycADjqd4M7HVhrv3OF3FBlwy8IDjKd5MbLXh7j1OV7EBlww84HiKNxNbbbh7j9NVbMAlAw84nuLNxFYb7t7jdBUbcMnAA46neDOx1Ya79zhdxQZcMvCA4yneTM7X6tfEl6xiAy4ZeMDxFG8mtkr4klVswCUDDzie4s3EVglfsooNuGTgAcdTvJnYKuFLVrEBlww84HiKNxNbJXzJKjbgkoEHHE/xZmKrhC9ZxQZcMvCA4yneTGyV8CWr2IBLBh5wPMWbia0SvmQVG3DJwAOOp3gzsVXCl6xiAy4ZeMDxFG8mtkr4klVswCUDDzie4s3k5kX4jD1OP05s8ALH17LVHbDBCxxfy1Z3wAYvcHwtW90BG7zA8bVsdQds8ALH17q51Q98x7t+4PTjNN/k5lFubjX9sI871f+JdfMot7fSr8VW52Gr87DVedjqPGx1HrY6i4eH/wFm7VbkCryzJAAAAABJRU5ErkJggg==";const m=e=>((0,i.dD)("data-v-45edce5f"),e=e(),(0,i.Cn)(),e),h={key:0,class:"rack-port rack-bottom-port",style:{width:"170px"}},g=m((()=>(0,i._)("img",{class:"port-img",src:l,width:"170"},null,-1))),p={key:0,class:"rack-tray-img",src:d,width:"170"},_={key:1,class:"rack-tray-img",src:c,width:"170"},w={key:1,class:"rack-port",style:{width:"170px"}},f=m((()=>(0,i._)("img",{class:"port-img",src:u,width:"170"},null,-1))),y={key:0,class:"rack-tray-img",src:d,width:"170"},v={key:1,class:"rack-tray-img",src:c,width:"170"},b={key:2,class:"qr-code d-flex flex-column"},S=m((()=>(0,i._)("i",{class:"bi bi-qr-code"},null,-1))),k=m((()=>(0,i._)("label",{for:""},"0",-1))),C=[S,k],A=m((()=>(0,i._)("div",{class:"selected-border",style:{width:"100%",height:"170px",position:"absolute",top:"0"}},null,-1)));function T(e,t,a,n,o,l){const d=(0,i.up)("el-tag");return(0,i.wg)(),(0,i.iD)("div",{onClick:t[0]||(t[0]=(...e)=>l.PortClick&&l.PortClick(...e)),class:(0,s.C_)(["rack-port-container",a.colBeSelected?"rack-col-selected":""]),style:(0,s.j5)({position:"relative",top:12*a.row+"px",left:-15*a.col+"px"})},[a.isBottom?((0,i.wg)(),(0,i.iD)("div",h,[g,a.hasRack?((0,i.wg)(),(0,i.iD)("img",p)):(0,i.kq)("",!0),a.hasTray?((0,i.wg)(),(0,i.iD)("img",_)):(0,i.kq)("",!0)])):((0,i.wg)(),(0,i.iD)("div",w,[f,a.hasRack?((0,i.wg)(),(0,i.iD)("img",y)):(0,i.kq)("",!0),a.hasTray?((0,i.wg)(),(0,i.iD)("img",v)):(0,i.kq)("",!0)])),(0,i.wy)((0,i.Wm)(d,{effect:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(a.CarrierID),1)])),_:1},512),[[r.F8,a.CarrierID&&""!=a.CarrierID]]),0==a.row?((0,i.wg)(),(0,i.iD)("div",b,C)):(0,i.kq)("",!0),A],6)}var V={props:{isBottom:{type:Boolean,default:!1},col:{type:Number,default:0},row:{type:Number,default:0},colBeSelected:{type:Boolean,dafault:!0},hasRack:{type:Boolean,dafault:!1},hasTray:{type:Boolean,dafault:!1},CarrierID:{type:String,default:""}},data(){return{}},methods:{PortClick(){this.$emit("on-port-click",{row:this.row,col:this.col,hasCargo:this.hasRack||this.hasTray,carrierID:this.CarrierID})}}},D=a(83744);const x=(0,D.Z)(V,[["render",T],["__scopeId","data-v-45edce5f"]]);var M=x,W=a(24239),I={components:{RackPortImageVue:M},props:{rackName:{type:String,default:""},isEdit:{type:Boolean,default:!1},editProps:{type:Object,default(){return{col:1,row:1}}}},data(){return{col:3,row:3}},computed:{colOfRack(){return this.isEdit?this.editProps.col:this.RackData?this.RackData.Columns:0},rowOfRack(){return this.isEdit?this.editProps.row:this.RackData?this.RackData.Rows:0},rowAry(){const e=[];for(let t=this.rowOfRack-1;t>=0;t--)e.push(t);return e},colAry(){const e=[];for(let t=0;t<this.colOfRack;t++)e.push(t);return e},RacksData(){return W.jU.getters.WIPData},RackData(){return this.RacksData.find((e=>e.WIPName==this.rackName))}},methods:{HandlePortClicked(e){alert(JSON.stringify(e))},GetPortByColRow(e,t){if(this.RackData&&this.RackData.Ports)return this.RackData.Ports.find((a=>a.Properties.Row==t&&a.Properties.Column==e))},CargoExist(e,t){if(this.isEdit)return!1;var a=this.GetPortByColRow(e,t);return!!a&&a.CargoExist},CarrierID(e,t){if(this.isEdit)return"";var a=this.GetPortByColRow(e,t);return!!a&&a.CarrierID}},mounted(){}};const E=(0,D.Z)(I,[["render",o],["__scopeId","data-v-2017133c"]]);var P=E},91747:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var i=a(66252);function s(e,t,a,s,n,o){const r=(0,i.up)("el-option"),l=(0,i.up)("el-select");return(0,i.wg)(),(0,i.j4)(l,{size:"small",style:{width:"120px"},modelValue:n.selectedRegion,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedRegion=e),onChange:o.handleChange},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.valid_map_regions_options,(e=>((0,i.wg)(),(0,i.j4)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])}var n=a(95320),o=a(83592),r={props:{default:{type:String}},data(){return{selectedRegion:this.default,valid_map_regions_options:[]}},methods:{handleChange(e){this.selectedRegion=e,this.$emit("input",e)}},mounted(){setTimeout((async()=>{this.valid_map_regions_options=n.p.getters.RegionOptions,this.valid_map_regions_options||(this.valid_map_regions_options=await(0,o.j2)()),this.valid_map_regions_options.unshift({label:"不分區",value:"all"})}),10)}},l=a(83744);const d=(0,l.Z)(r,[["render",s]]);var c=d},19594:function(e){"use strict";e.exports=JSON.parse('{"App":{"Header":{"view_mode":"View Mode","chinese":"Chinese","english":"English"}},"Menu":{"Home":"Home","System Alarm":"System Alarm","wip_manager":"Rack Status","vehicle manager":"Vehicles Settings","system settings":"System Settings","map and display":"Map and Display","map edit":"Map Edit","agv display":"AGV Visualize","vehicle battery managnment":"AGV battery Settings","equipment management":"Equipments Settings","racks management":"Racks Settings","charge station management":"Chargers Data","user management":"Users settings","Querys":"Data Query","Task History":"Task History","Alarm History":"Alarm History","Trajectory":"Trajectory","Instruments Measure Result":"Instruments Measure","utilization rate":"Utilization"},"HomeView":{"AGVStatus":{"AGVStatus":{"vehicle-status":"Vehicle Status","vms_disconnect":"VMS DisConnect","vehicle-name":"Name","vehicle-statuslist":"Status","task-status":"Task Status","status":"Status","carrierid":"Carrier ID","vehicleconn":"AGVC","position":"Locate","power":"Bat LV","From":"From","To":"To","action":"Action","Time":"Time","Online":"Online","Offline":"Offline","Location":"Locate","OnlineRequest":"Online Reqeust","OfflineRequest":"Offline Requset"}},"TaskStatus":"TASK STATUS"},"source":"From","TaskDispathActionButton":{"Destine":"To","dispatch-confirm":"Dispatch","Back To Select Action":"Back"},"auto-choise-vehicle":"Auto","IncompleteTasks":"Incomplete","CompleteTasks":"Completed","TaskTable":{"NoTasks":"No Tasks","TaskName":"ID","Time":"Time","Action":"Action","TaskStatus":"Status","ExcuteAgvName":"AGV Name","Source":"From","Destine":"Destine","Dispatcher":"Dispatcher","CstID":"Cargo ID","FinishTime":"End Time","RecievedTime":"Recieve Time"}}')},46687:function(e){"use strict";e.exports=JSON.parse('{"App":{"Header":{"view_mode":"檢視模式","chinese":"中文","english":"英文"}},"Menu":{"Home":"主頁","System Alarm":"系統警報","wip_manager":"帳籍管理","vehicle manager":"車輛管理","system settings":"系統設置","map and display":"地圖與顯示","map edit":"地圖編輯","agv display":"AGV 視覺化","vehicle battery managnment":"電量管理","equipment management":"設備管理","racks management":"Rack管理","charge station management":"充電站管理","user management":"用戶管理","Querys":"資料查詢","Task History":"歷史任務","Alarm History":"歷史警報","Trajectory":"軌跡查詢","Instruments Measure Result":"儀器量測結果查詢","utilization rate":"稼動率"},"HomeView":{"AGVStatus":{"AGVStatus":{"vehicle-status":"車輛狀態","vms_disconnect":"VMS 斷線","vehicle-name":"車輛名稱","vehicle-statuslist":"AGV 狀態","task-status":"任務狀態","status":"狀態","carrierid":"載物ID","vehicleconn":"車載","position":"位置","power":"電量","From":"起點","To":"目的地","action":"動作","Time":"時間","Online":"已上線","Offline":"離線","Location":"定位","OnlineRequest":"請求上線","OfflineRequest":"請求離線"}},"TaskStatus":"任務狀態"},"Action":"動作","Vehicle":"車輛","source":"來源","TaskDispathActionButton":{"Destine":"目的地","dispatch-confirm":"派送","Back To Select Action":"返回選擇動作"},"Cancel":"取消","auto-choise-vehicle":"自動選車","Transfer":"搬運","Charge":"充電","Exchange Battery":"交換電池","Measure":"巡檢量測","Move":"移動","Park":"停車","Unload":"取貨","Load":"放貨","Dispatch":"任務派送","IncompleteTasks":"未完成任務","CompleteTasks":"已完成任務","TaskTable":{"NoTasks":"沒有任務","TaskName":"任務ID","Time":"時間","Action":"動作","TaskStatus":"狀態","ExcuteAgvName":"執行車輛","Source":"起點","Destine":"終點","Dispatcher":"派工人原","CstID":"貨物ID","FinishTime":"結束時間","RecievedTime":"接收時間"}}')}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=e,function(){var e=[];a.O=function(t,i,s,n){if(!i){var o=1/0;for(c=0;c<e.length;c++){i=e[c][0],s=e[c][1],n=e[c][2];for(var r=!0,l=0;l<i.length;l++)(!1&n||o>=n)&&Object.keys(a.O).every((function(e){return a.O[e](i[l])}))?i.splice(l--,1):(r=!1,n<o&&(o=n));if(r){e.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,s,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,i){return a.f[i](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+e+".js"}}(),function(){a.miniCssF=function(e){return"css/"+e+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="gpm_agvs:";a.l=function(i,s,n,o){if(e[i])e[i].push(s);else{var r,l;if(void 0!==n)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+n){r=u;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,a.nc&&r.setAttribute("nonce",a.nc),r.setAttribute("data-webpack",t+n),r.src=i),e[i]=[s];var m=function(t,a){r.onerror=r.onload=null,clearTimeout(h);var s=e[i];if(delete e[i],r.parentNode&&r.parentNode.removeChild(r),s&&s.forEach((function(e){return e(a)})),t)return t(a)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=m.bind(null,r.onerror),r.onload=m.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){a.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,i,s){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css";var o=function(a){if(n.onerror=n.onload=null,"load"===a.type)i();else{var o=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=r,n.parentNode&&n.parentNode.removeChild(n),s(l)}};return n.onerror=n.onload=o,n.href=t,a?a.parentNode.insertBefore(n,a.nextSibling):document.head.appendChild(n),n},t=function(e,t){for(var a=document.getElementsByTagName("link"),i=0;i<a.length;i++){var s=a[i],n=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(n===e||n===t))return s}var o=document.getElementsByTagName("style");for(i=0;i<o.length;i++){s=o[i],n=s.getAttribute("data-href");if(n===e||n===t)return s}},i=function(i){return new Promise((function(s,n){var o=a.miniCssF(i),r=a.p+o;if(t(o,r))return s();e(i,r,null,s,n)}))},s={143:0};a.f.miniCss=function(e,t){var a={214:1,215:1,330:1,373:1,416:1,547:1,646:1,670:1,677:1,888:1,943:1};s[e]?t.push(s[e]):0!==s[e]&&a[e]&&t.push(s[e]=i(e).then((function(){s[e]=0}),(function(t){throw delete s[e],t})))}}}(),function(){var e={143:0};a.f.j=function(t,i){var s=a.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise((function(a,i){s=e[t]=[a,i]}));i.push(s[2]=n);var o=a.p+a.u(t),r=new Error,l=function(i){if(a.o(e,t)&&(s=e[t],0!==s&&(e[t]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",r.name="ChunkLoadError",r.type=n,r.request=o,s[1](r)}};a.l(o,l,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,i){var s,n,o=i[0],r=i[1],l=i[2],d=0;if(o.some((function(t){return 0!==e[t]}))){for(s in r)a.o(r,s)&&(a.m[s]=r[s]);if(l)var c=l(a)}for(t&&t(i);d<o.length;d++)n=o[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},i=self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=a.O(void 0,[998],(function(){return a(13635)}));i=a.O(i)})();
//# sourceMappingURL=app.js.map