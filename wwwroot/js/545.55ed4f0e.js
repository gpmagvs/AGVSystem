"use strict";(self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[]).push([[545],{78545:function(e,a,l){l.r(a),l.d(a,{default:function(){return v}});var t=l(66252),n=l(3577);const o=e=>((0,t.dD)("data-v-e2aef2e8"),e=e(),(0,t.Cn)(),e),s={class:"equipment-manager border-start border-end"},i={class:"text-start px-1"},d={class:""},_={class:"w-100 d-flex flex-row"},r={class:"w-100"},m={class:"hs-signals d-flex"},c=o((()=>(0,t._)("div",{class:"mx-3"},"交握訊號-EQ",-1))),u={class:"hs-signals d-flex"},p=o((()=>(0,t._)("div",{class:"mx-3"},"交握訊號-AGV",-1)));function w(e,a,l,o,w,g){const h=(0,t.up)("b-button"),E=(0,t.up)("el-table-column"),C=(0,t.up)("b-form-input"),f=(0,t.up)("el-button"),q=(0,t.up)("el-option"),V=(0,t.up)("el-select"),D=(0,t.up)("el-checkbox"),v=(0,t.up)("el-table"),b=(0,t.up)("el-form-item"),S=(0,t.up)("el-input"),H=(0,t.up)("el-form"),N=(0,t.up)("el-drawer"),k=(0,t.Q2)("loading");return(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",s,[(0,t._)("p",i,[(0,t.Wm)(h,{variant:"primary",squared:"",onClick:g.SaveSettingHandler},{default:(0,t.w5)((()=>[(0,t.Uk)("儲存設定")])),_:1},8,["onClick"]),(0,t.Wm)(h,{variant:"info",squared:"",class:"mx-2",onClick:g.AddNewEqHandler},{default:(0,t.w5)((()=>[(0,t.Uk)("新增設備")])),_:1},8,["onClick"]),(0,t.Wm)(h,{squared:"",onClick:g.ReloadSettingsHandler},{default:(0,t.w5)((()=>[(0,t.Uk)("重新載入")])),_:1},8,["onClick"])]),(0,t.Wm)(v,{"header-cell-style":{color:"white",backgroundColor:"rgb(13, 110, 253)",fontSize:"12px"},data:w.EqDatas,"row-key":w.rowKey,size:"small",border:"","scrollbar-always-on":"",height:"80vh","table-layout":"fixed",ref:"eqTable",style:{width:"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(E,{label:"Index",prop:"index",width:"80",align:"center",fixed:"left"}),(0,t.Wm)(E,{label:"設備名稱",prop:"Name",width:"210",fixed:"left"},{default:(0,t.w5)((e=>[(0,t._)("div",d,[(0,t.Wm)(C,{state:w.ValidName(e.row),modelValue:e.row.Name,"onUpdate:modelValue":a=>e.row.Name=a,placeholder:"設備名稱",style:{width:"160px"},"no-wheel":!0,size:"sm",min:1,onInput:a=>g.HandleEqNameChange(e.row,e.row.Name)},null,8,["state","modelValue","onUpdate:modelValue","onInput"]),(0,t.Wm)(f,{class:"my-1",size:"small",onClick:a=>g.HandleUseMapDataDisplayName(e.row.TagID)},{default:(0,t.w5)((()=>[(0,t.Uk)("使用圖資設定")])),_:2},1032,["onClick"])])])),_:1}),(0,t.Wm)(E,{label:"Tag ID",prop:"TagID",width:"120",align:"center",fixed:"left"},{default:(0,t.w5)((e=>[(0,t.Wm)(C,{type:"number",state:w.ValidTag(e.row),modelValue:e.row.TagID,"onUpdate:modelValue":a=>e.row.TagID=a,modelModifiers:{number:!0},placeholder:"tag id",size:"sm",min:1},null,8,["state","modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(E,{label:"下游設備",width:"850"},{default:(0,t.w5)((e=>[(0,t._)("div",_,[(0,t.Wm)(V,{size:"small",modelValue:e.row.ValidDownStreamEndPointNames,"onUpdate:modelValue":a=>e.row.ValidDownStreamEndPointNames=a,multiple:"",placeholder:"Select",style:{width:"1000px"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(g.GetAvaluableEqNameList(e.row.Name),(e=>((0,t.wg)(),(0,t.j4)(q,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(f,{class:"mx-1",size:"small",type:"default",onClick:()=>{e.row.ValidDownStreamEndPointNames=g.GetAvaluableEqNameList(e.row.Name)}},{default:(0,t.w5)((()=>[(0,t.Uk)("使用所有設備")])),_:2},1032,["onClick"]),(0,t.Wm)(f,{size:"small",type:"danger",onClick:()=>{e.row.ValidDownStreamEndPointNames=[]}},{default:(0,t.w5)((()=>[(0,t.Uk)("清除")])),_:2},1032,["onClick"])])])),_:1}),(0,t.Wm)(E,{label:"允入車款",width:"120"},{default:(0,t.w5)((e=>[(0,t.Wm)(V,{size:"small",modelValue:e.row.Accept_AGV_Type,"onUpdate:modelValue":a=>e.row.Accept_AGV_Type=a},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{value:0,label:"0-不限"}),(0,t.Wm)(q,{value:1,label:"1-叉車AGV"}),(0,t.Wm)(q,{value:2,label:"2-潛盾AGV"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(E,{label:"可移載貨物類型",width:"130"},{default:(0,t.w5)((e=>[(0,t.Wm)(V,{size:"small",modelValue:e.row.EQAcceeptCargoType,"onUpdate:modelValue":a=>e.row.EQAcceeptCargoType=a},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{value:0,label:"0-不限"}),(0,t.Wm)(q,{value:200,label:"200-Tray"}),(0,t.Wm)(q,{value:201,label:"201-子母框"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(E,{label:"空框/實框 訊號檢查",width:"100",align:"center"},{default:(0,t.w5)((e=>[(0,t.Wm)(D,{modelValue:e.row.RackCapcityCheck,"onUpdate:modelValue":a=>e.row.RackCapcityCheck=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(E,{label:"操作","min-width":"100",fixed:"right"},{default:(0,t.w5)((e=>[(0,t._)("div",null,[(0,t.Wm)(f,{size:"small",type:"default",onClick:a=>g.ConnectionSettingBtnHandle(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("連線設定")])),_:2},1032,["onClick"]),(0,t.Wm)(f,{size:"small",type:"danger",onClick:a=>g.RemoveHandle(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("移除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["header-cell-style","data","row-key"]),(0,t.Wm)(N,{"z-index":1,modelValue:w.connection_setting_drawer,"onUpdate:modelValue":a[5]||(a[5]=e=>w.connection_setting_drawer=e),title:`${w.selected_eq.Name}-連線設定`},{default:(0,t.w5)((()=>[(0,t._)("div",r,[(0,t.Wm)(H,{"label-position":"left","label-width":"100"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{label:"通訊方式"},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{modelValue:w.selected_eq.ConnOptions.ConnMethod,"onUpdate:modelValue":a[0]||(a[0]=e=>w.selected_eq.ConnOptions.ConnMethod=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(q,{label:"Modbus TCP",value:0}),(0,t.Wm)(q,{label:"Modbus RTU",value:1}),(0,t.Wm)(q,{label:"TCP/IP",value:2}),(0,t.Wm)(q,{label:"Serial Port",value:3}),(0,t.Wm)(q,{label:"MC Protocol",value:5})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(b,{label:"IP"},{default:(0,t.w5)((()=>[(0,t.Wm)(S,{disabled:1==w.selected_eq.ConnOptions.ConnMethod,modelValue:w.selected_eq.ConnOptions.IP,"onUpdate:modelValue":a[1]||(a[1]=e=>w.selected_eq.ConnOptions.IP=e)},null,8,["disabled","modelValue"])])),_:1}),(0,t.Wm)(b,{label:"PORT"},{default:(0,t.w5)((()=>[(0,t.Wm)(S,{disabled:1==w.selected_eq.ConnOptions.ConnMethod,modelValue:w.selected_eq.ConnOptions.Port,"onUpdate:modelValue":a[2]||(a[2]=e=>w.selected_eq.ConnOptions.Port=e),modelModifiers:{number:!0}},null,8,["disabled","modelValue"])])),_:1}),(0,t.Wm)(b,{label:"COMPORT"},{default:(0,t.w5)((()=>[(0,t.Wm)(S,{disabled:0==w.selected_eq.ConnOptions.ConnMethod,modelValue:w.selected_eq.ConnOptions.ComPort,"onUpdate:modelValue":a[3]||(a[3]=e=>w.selected_eq.ConnOptions.ComPort=e)},null,8,["disabled","modelValue"])])),_:1})])),_:1}),(0,t.Wm)(f,{loading:w.connection_testing,type:"default",onClick:a[4]||(a[4]=e=>g.ConnectTestHandle(w.selected_eq))},{default:(0,t.w5)((()=>[(0,t.Uk)("通訊測試")])),_:1},8,["loading"])])])),_:1},8,["modelValue","title"]),(0,t.Wm)(N,{modelValue:w.io_check_drawer,"onUpdate:modelValue":a[19]||(a[19]=e=>w.io_check_drawer=e),direction:"btt"},{default:(0,t.w5)((()=>[(0,t._)("div",m,[c,(0,t._)("div",{class:"di-status",onClick:a[6]||(a[6]=a=>e.HandleHSsignaleChange(g.selected_eq_io_data.EQName,"L_REQ",!e.scope.row.HS_EQ_L_REQ)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_EQ_L_REQ))},"L_REQ",4),(0,t._)("div",{class:"di-status",onClick:a[7]||(a[7]=a=>e.HandleHSsignaleChange(g.selected_eq_io_data.EQName,"U_REQ",!e.scope.row.HS_EQ_U_REQ)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_EQ_U_REQ))},"U_REQ",4),(0,t._)("div",{class:"di-status",onClick:a[8]||(a[8]=a=>e.HandleHSsignaleChange(g.selected_eq_io_data.EQName,"READY",!e.scope.row.HS_EQ_READY)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_EQ_READY))},"READY",4),(0,t._)("div",{class:"di-status",onClick:a[9]||(a[9]=a=>e.HandleHSsignaleChange(g.selected_eq_io_data.EQName,"UP_READY",!e.scope.row.HS_EQ_UP_READY)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_EQ_UP_READY))},"UP_READY",4),(0,t._)("div",{class:"di-status",onClick:a[10]||(a[10]=a=>e.HandleHSsignaleChange(g.selected_eq_io_data.EQName,"LOW_READY",!e.scope.row.HS_EQ_LOW_READY)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_EQ_LOW_READY))},"LOW_READY",4),(0,t.kq)("",!0)]),(0,t._)("div",u,[p,(0,t._)("div",{class:"di-status",onClick:a[12]||(a[12]=a=>e.HandleAGVHSSignaleChange(g.selected_eq_io_data.EQName,"To_EQ_Up",!e.scope.row.To_EQ_Up)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.To_EQ_Up))},"To_EQ_Up",4),(0,t._)("div",{class:"di-status",onClick:a[13]||(a[13]=a=>e.HandleAGVHSSignaleChange(g.selected_eq_io_data.EQName,"To_EQ_Low",!e.scope.row.To_EQ_Low)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.To_EQ_Low))},"To_EQ_Low",4),(0,t._)("div",{class:"di-status",onClick:a[14]||(a[14]=a=>e.HandleAGVHSSignaleChange(g.selected_eq_io_data.EQName,"VALID",!e.scope.row.HS_AGV_VALID)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_AGV_VALID))},"VALID",4),(0,t._)("div",{class:"di-status",onClick:a[15]||(a[15]=a=>e.HandleAGVHSSignaleChange(g.selected_eq_io_data.EQName,"TR_REQ",!e.scope.row.HS_AGV_TR_REQ)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_AGV_TR_REQ))},"TR_REQ",4),(0,t._)("div",{class:"di-status",onClick:a[16]||(a[16]=a=>e.HandleAGVHSSignaleChange(g.selected_eq_io_data.EQName,"BUSY",!e.scope.row.HS_AGV_BUSY)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_AGV_BUSY))},"BUSY",4),(0,t.kq)("",!0),(0,t._)("div",{class:"di-status",onClick:a[18]||(a[18]=a=>e.HandleAGVHSSignaleChange(g.selected_eq_io_data.EQName,"COMPT",!e.scope.row.HS_AGV_COMPT)),style:(0,n.j5)(e.signalOn(g.selected_eq_io_data.HS_AGV_COMPT))},"COMPT",4)])])),_:1},8,["modelValue"])])),[[k,w.loading]])}l(57658);var g=l(64491),h=l(91747),E=l(95320),C=l(24239),f=l(49996),q=(l(30381),{components:{RegionsSelector:h.Z},data(){return{cell_item_size:"",io_check_drawer:!1,connection_setting_drawer:!1,EqDatas:[],EqDatas_Orignal:[],ValidTag:e=>{var a=e.TagID,l=this.EqDatas.filter((a=>a.Name!=e.Name)),t=l.filter((e=>e.TagID==a));return 0==t.length&&a>=1},ValidName:e=>{var a=e.Name,l=this.EqDatas.filter((a=>a.Name==e.Name));return 1==l.length&&""!=a},selected_eq:{},connection_testing:!1,loading:!0,rowKey:"index"}},methods:{GetAvaluableEqNameList(e){var a=this.EqNames.filter((a=>a!=e));return["ALL",...a]},async SaveSettingHandler(){var e=await(0,g.wW)(this.EqDatas);e.confirm?(setTimeout((()=>{this.ReloadSettingsHandler(!1)}),1e3),this.$swal.fire({title:"儲存成功",icon:"success",timer:2e3})):this.$swal.fire({title:"參數設定有誤",text:e.message,icon:"error"})},async DownloadEQOptions(){this.EqDatas=[];var e=C.jU.getters.EqOptions;for(let l=0;l<e.length;l++){var a=e[l];a.index=l,this.EqDatas.push(a),console.info(a)}this.CloneEQDatas()},CloneEQDatas(){this.EqDatas_Orignal=JSON.parse(JSON.stringify(this.EqDatas))},ReloadSettingsHandler(e=!0){this.loading=e,setTimeout((()=>{(0,g.H5)().then((e=>C.jU.commit("EqOptions",e))),this.DownloadEQOptions(),this.$refs.eqTable.setScrollTop(0),this.loading=!1}),300)},AddNewEqHandler(){this.EqDatas.push({index:this.EqDatas.length,Name:`New_EQ_${this.EqDatas.length}`,TagID:1,ConnOptions:{ConnMethod:0,IP:"127.0.0.1",Port:502,ComPort:"COM1"}}),setTimeout((()=>{this.$refs.eqTable.setScrollTop(window.innerHeight)}),300)},RemoveHandle(e){var a=this.EqDatas.filter((a=>a.Name!=e.Name));this.EqDatas=a},async IOCheckBtnHandle(e){this.selected_eq=e,this.io_check_drawer=!0},async ConnectionSettingBtnHandle(e){this.selected_eq=e,this.connection_setting_drawer=!0},async ConnectTestHandle(e){this.connection_testing=!0;var a=await(0,g.qN)(e.ConnOptions);this.connection_testing=!1;var l="";l=0==e.ConnOptions.ConnMethod?`Modbus TCP - ${e.ConnOptions.IP}:${e.ConnOptions.Port}`:`Modbus RTU - ${e.ConnOptions.ComPort}`,a.Connected?this.$swal.fire({title:"OK",text:l,icon:"success"}):this.$swal.fire({title:"Fail",text:l,icon:"error"})},beforeRouteLeave(e,a,l){alert("leave!")},async HandleUseMapDataDisplayName(e){var a=await E.p.dispatch("GetMapPointByTag",e);if(a){var l=this.EqDatas.find((a=>a.TagID==e)),t=a.Graph.Display;l.Name=t,this.HandleEqNameChange(l,t),(0,f.bM)({message:`Get Display Name From Map Success(Tag ${e} = ${t})`,duration:1e3,type:"success",title:"設備同步名稱"})}else(0,f.bM)({message:"Get Display Name From Map Fail",duration:1e3,type:"error",title:"設備同步名稱失敗"})},HandleEqNameChange(e,a){var l=e.TagID,t=this.EqDatas_Orignal.find((e=>e.TagID==l));if(t){var n=t.Name,o=this.EqDatas.filter((e=>e.ValidDownStreamEndPointNames.includes(n)));o.forEach((e=>{var l=e.ValidDownStreamEndPointNames.indexOf(n);e.ValidDownStreamEndPointNames[l]=a})),this.CloneEQDatas()}}},mounted(){setTimeout((()=>{this.DownloadEQOptions(),this.loading=!1}),400)},computed:{EqNames(){return this.EqDatas.map((e=>e.Name))},eq_data(){return C.jU.getters.EQData},selected_eq_io_data(){return this.eq_data.find((e=>e.EQName==this.selected_eq.EQName))}}}),V=l(83744);const D=(0,V.Z)(q,[["render",w],["__scopeId","data-v-e2aef2e8"]]);var v=D}}]);
//# sourceMappingURL=545.55ed4f0e.js.map