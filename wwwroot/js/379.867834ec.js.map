{"version":3,"file":"js/379.867834ec.js","mappings":"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","sources":["webpack://gpm_agvs/./src/views/MapManager.vue","webpack://gpm_agvs/./src/views/MapManager.vue?c5a5"],"sourcesContent":["<template>\r\n  <div class=\"map-view h-100 d-flex flex-row my-1\">\r\n    <div></div>\r\n    <Map\r\n      id=\"editable_map\"\r\n      :agv_upload_coordi_data=\"agv_upload_data\"\r\n      @save=\"SaveMapClickHandle\"\r\n      :editable=\"true\"\r\n      :agv_show=\"true\"\r\n      canva_height=\"750px\"\r\n      ref=\"map_editing\"></Map>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Map from '@/components/Map/Map.vue';\r\nimport MapAPI from '@/api/MapAPI';\r\nimport Notifier from '@/api/NotifyHelper';\r\nimport bus from '@/event-bus.js'\r\nimport { MapStore } from '@/components/Map/store'\r\n\r\nexport default {\r\n  components: {\r\n    Map,\r\n  },\r\n  async mounted() {\r\n    this.tags = await MapAPI.GetMapTags();\r\n  },\r\n  data() {\r\n    return {\r\n      path_plan_point_type: 'Tag',\r\n      path_plan_point_from: 1,\r\n      path_plan_point_to: 2,\r\n      tags: [1, 2, 3, 59, 11],\r\n      map_saving: false\r\n    }\r\n  },\r\n  computed: {\r\n    IsEditable() {\r\n      return this.mode_selected == '編輯'\r\n    },\r\n    map_station_data() {\r\n      return MapStore.getters.MapStations\r\n    },\r\n    agv_upload_data() {\r\n      return MapStore.getters.AGVLocUpload\r\n    },\r\n    loadingText() {\r\n      return \"圖資儲存中...\"\r\n    }\r\n  },\r\n  methods: {\r\n\r\n    async SaveMapClickHandle(mapDataSave) {\r\n      var mapData = JSON.parse(JSON.stringify(MapStore.getters.MapData))\r\n      mapData.Points = mapDataSave.Points;\r\n      mapData.Segments = mapDataSave.Pathes;\r\n      mapData.Regions = mapDataSave.Regions;\r\n      var _check_result = this.CheckMapContentHasAnyError(mapData);\r\n      if (!_check_result.correct) {\r\n        this.$swal.fire(\r\n          {\r\n            text: _check_result.message,\r\n            title: '',\r\n            icon: 'error',\r\n            showCancelButton: false,\r\n            confirmButtonText: 'OK',\r\n            customClass: 'my-sweetalert'\r\n          })\r\n        return;\r\n      }\r\n      this.map_saving = true;\r\n      this.$swal.fire(\r\n        {\r\n          text: '',\r\n          title: '圖資儲存中...',\r\n          icon: 'warning',\r\n          showCancelButton: false,\r\n          showConfirmButton: false,\r\n          customClass: 'my-sweetalert',\r\n        })\r\n      var success = await MapStore.dispatch('SaveMap', mapData);\r\n      this.map_saving = false;\r\n      if (success) {\r\n        bus.emit('/map_save');\r\n        //Notifier.Success('圖資儲存成功');\r\n        this.$swal.fire({\r\n          title: '圖資儲存成功',\r\n          icon: 'success',\r\n          showCancelButton: false,\r\n          showConfirmButton: false,\r\n          customClass: 'my-sweetalert',\r\n          timer: 1500,\r\n        })\r\n\r\n      }\r\n      else {\r\n        Notifier.Danger('圖資儲存失敗');\r\n        this.$swal.fire({\r\n          title: '圖資儲存失敗',\r\n          icon: 'error',\r\n          showCancelButton: false,\r\n          showConfirmButton: true,\r\n          customClass: 'my-sweetalert',\r\n        })\r\n      }\r\n    },\r\n    CheckMapContentHasAnyError(mapData) {\r\n      var _tags_settings = Object.values(mapData.Points).map(pt => { return pt.TagNumber })\r\n      var non_repeat_tags = [...new Set(_tags_settings)]\r\n      if (non_repeat_tags.length != _tags_settings.length) {\r\n        const duplicatesTags = []\r\n        const seen = {}\r\n        _tags_settings.forEach((item, index) => {\r\n          if (seen.hasOwnProperty(item)) {\r\n            duplicatesTags.push(item)\r\n          } else {\r\n            seen[item] = index\r\n          }\r\n        });\r\n        var _error_set = [...new Set(duplicatesTags)].map(tag => {\r\n          var _points_same_tag = Object.values(mapData.Points).filter(pt => pt.TagNumber == tag);\r\n          return `Tag-${tag}於 ${_points_same_tag.map(pt => { return pt.Graph.Display }).join(\"、\")}重複設置`\r\n        })\r\n        return { correct: false, message: `${_error_set.join(\";\")} ，\\n請再檢查圖資設定` }\r\n      }\r\n      return { correct: true, message: '' }\r\n    },\r\n    async GetPathPlanedFromServer() {\r\n      var result = {}\r\n      if (this.path_plan_point_type == 'Tag')\r\n        result = await MapAPI.PathPlanByTag(this.path_plan_point_from, this.path_plan_point_to);\r\n\r\n      if (result) {\r\n\r\n        var tags = result.tags;\r\n        this.$refs['map'].UpdatePathPlanRender(tags);\r\n      }\r\n\r\n    }\r\n  },\r\n  mounted() {\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.map-view {\r\n  position: absolute;\r\n  top: 50px;\r\n  width: 100%;\r\n}\r\n</style>","import { render } from \"./MapManager.vue?vue&type=template&id=39dd0c86&scoped=true\"\nimport script from \"./MapManager.vue?vue&type=script&lang=js\"\nexport * from \"./MapManager.vue?vue&type=script&lang=js\"\n\nimport \"./MapManager.vue?vue&type=style&index=0&id=39dd0c86&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-39dd0c86\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","_createElementBlock","_hoisted_1","_hoisted_2","_createVNode","_component_Map","id","agv_upload_coordi_data","$options","agv_upload_data","onSave","SaveMapClickHandle","editable","agv_show","canva_height","ref","components","Map","async","this","tags","MapAPI","GetMapTags","data","path_plan_point_type","path_plan_point_from","path_plan_point_to","map_saving","computed","IsEditable","mode_selected","map_station_data","MapStore","getters","MapStations","AGVLocUpload","loadingText","methods","mapDataSave","mapData","JSON","parse","stringify","MapData","Points","Segments","Pathes","Regions","_check_result","CheckMapContentHasAnyError","correct","$swal","fire","text","title","icon","showCancelButton","showConfirmButton","customClass","success","dispatch","bus","emit","timer","Notifier","Danger","message","confirmButtonText","_tags_settings","Object","values","map","pt","TagNumber","non_repeat_tags","Set","length","duplicatesTags","seen","forEach","item","index","hasOwnProperty","push","_error_set","tag","_points_same_tag","filter","Graph","Display","join","result","PathPlanByTag","$refs","UpdatePathPlanRender","mounted","__exports__","render"],"sourceRoot":""}