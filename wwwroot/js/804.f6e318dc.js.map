{"version":3,"file":"js/804.f6e318dc.js","mappings":"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","sources":["webpack://gpm_agvs/./src/views/MapManager.vue","webpack://gpm_agvs/./src/views/MapManager.vue?c5a5"],"sourcesContent":["<template>\r\n  <div class=\"map-view h-100 d-flex flex-row my-1\">\r\n    <div></div>\r\n    <Map\r\n      id=\"editable_map\"\r\n      :agv_upload_coordi_data=\"agv_upload_data\"\r\n      @save=\"SaveMapClickHandle\"\r\n      @tempSave=\"TempSaveHandler\"\r\n      :editable=\"true\"\r\n      :agv_show=\"true\"\r\n      canva_height=\"750px\"\r\n      ref=\"map_editing\"\r\n    ></Map>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Map from '@/components/Map/Map.vue';\r\nimport MapAPI from '@/api/MapAPI';\r\nimport Notifier from '@/api/NotifyHelper';\r\nimport bus from '@/event-bus.js'\r\nimport { MapStore } from '@/components/Map/store'\r\nimport { UIStore } from '@/store'\r\n\r\nexport default {\r\n  components: {\r\n    Map,\r\n  },\r\n  async mounted() {\r\n    this.tags = await MapAPI.GetMapTags();\r\n  },\r\n  data() {\r\n    return {\r\n      path_plan_point_type: 'Tag',\r\n      path_plan_point_from: 1,\r\n      path_plan_point_to: 2,\r\n      tags: [1, 2, 3, 59, 11],\r\n      map_saving: false\r\n    }\r\n  },\r\n  computed: {\r\n    StyleBiding() {\r\n\r\n      var _sysAlarmShowing = UIStore.getters.SystemAlarmShowState;\r\n      var _eqpAlarmShowing = UIStore.getters.EqpAlarmShowState;\r\n\r\n      if (!_sysAlarmShowing && !_eqpAlarmShowing)\r\n        return {\r\n          top: '-10px'\r\n        }\r\n      else if (_sysAlarmShowing && _eqpAlarmShowing)\r\n        return {\r\n          top: '50px'\r\n        }\r\n      else {\r\n        return {\r\n          top: '12px'\r\n        }\r\n      }\r\n    },\r\n    IsEditable() {\r\n      return this.mode_selected == '編輯'\r\n    },\r\n    map_station_data() {\r\n      return MapStore.getters.MapStations\r\n    },\r\n    agv_upload_data() {\r\n      return MapStore.getters.AGVLocUpload\r\n    },\r\n    loadingText() {\r\n      return \"圖資儲存中...\"\r\n    }\r\n  },\r\n  methods: {\r\n    async TempSaveHandler(mapDataSave) {\r\n      var tempMapData = JSON.parse(JSON.stringify(MapStore.getters.MapData))\r\n      this.UpdateMapData(tempMapData, mapDataSave);\r\n      await MapStore.dispatch('AddMapDataCache', tempMapData)\r\n    },\r\n    async SaveMapClickHandle(mapDataSave) {\r\n      var mapData = JSON.parse(JSON.stringify(MapStore.getters.MapData))\r\n      this.UpdateMapData(mapData, mapDataSave);\r\n\r\n      var _check_result = this.CheckMapContentHasAnyError(mapData);\r\n      if (!_check_result.correct) {\r\n        this.$swal.fire(\r\n          {\r\n            text: _check_result.message,\r\n            title: '',\r\n            icon: 'error',\r\n            showCancelButton: false,\r\n            confirmButtonText: 'OK',\r\n            customClass: 'my-sweetalert'\r\n          })\r\n        return;\r\n      }\r\n      this.map_saving = true;\r\n      this.$swal.fire(\r\n        {\r\n          text: '',\r\n          title: '圖資儲存中...',\r\n          icon: 'warning',\r\n          showCancelButton: false,\r\n          showConfirmButton: false,\r\n          customClass: 'my-sweetalert',\r\n        })\r\n\r\n\r\n      var success = await MapStore.dispatch('SaveMap', { data: mapData, file: mapDataSave.ImageFile });\r\n      this.map_saving = false;\r\n      if (success) {\r\n        bus.emit('/map_save');\r\n        this.$swal.fire({\r\n          title: '圖資儲存成功',\r\n          icon: 'success',\r\n          showCancelButton: false,\r\n          showConfirmButton: false,\r\n          customClass: 'my-sweetalert',\r\n          timer: 1500,\r\n        })\r\n\r\n      }\r\n      else {\r\n        Notifier.Danger('圖資儲存失敗');\r\n        this.$swal.fire({\r\n          title: '圖資儲存失敗',\r\n          icon: 'error',\r\n          showCancelButton: false,\r\n          showConfirmButton: true,\r\n          customClass: 'my-sweetalert',\r\n        })\r\n      }\r\n    },\r\n    UpdateMapData(mapDataExist, newData) {\r\n      mapDataExist.Points = newData.Points;\r\n      mapDataExist.Segments = newData.Pathes;\r\n      mapDataExist.Regions = newData.Regions;\r\n      mapDataExist.Map_Image_Boundary = newData.ImageExtent;\r\n    },\r\n    CheckMapContentHasAnyError(mapData) {\r\n      var _tags_settings = Object.values(mapData.Points).map(pt => { return pt.TagNumber })\r\n      var non_repeat_tags = [...new Set(_tags_settings)]\r\n      if (non_repeat_tags.length != _tags_settings.length) {\r\n        const duplicatesTags = []\r\n        const seen = {}\r\n        _tags_settings.forEach((item, index) => {\r\n          if (seen.hasOwnProperty(item)) {\r\n            duplicatesTags.push(item)\r\n          } else {\r\n            seen[item] = index\r\n          }\r\n        });\r\n        var _error_set = [...new Set(duplicatesTags)].map(tag => {\r\n          var _points_same_tag = Object.values(mapData.Points).filter(pt => pt.TagNumber == tag);\r\n          return `Tag-${tag}於 ${_points_same_tag.map(pt => { return pt.Graph.Display }).join(\"、\")}重複設置`\r\n        })\r\n        return { correct: false, message: `${_error_set.join(\";\")} ，\\n請再檢查圖資設定` }\r\n      }\r\n      return { correct: true, message: '' }\r\n    },\r\n    async GetPathPlanedFromServer() {\r\n      var result = {}\r\n      if (this.path_plan_point_type == 'Tag')\r\n        result = await MapAPI.PathPlanByTag(this.path_plan_point_from, this.path_plan_point_to);\r\n\r\n      if (result) {\r\n\r\n        var tags = result.tags;\r\n        this.$refs['map'].UpdatePathPlanRender(tags);\r\n      }\r\n\r\n    }\r\n  },\r\n  mounted() {\r\n  },\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.map-view {\r\n  position: absolute;\r\n  width: 100%;\r\n}\r\n</style>","import { render } from \"./MapManager.vue?vue&type=template&id=88c769cc&scoped=true\"\nimport script from \"./MapManager.vue?vue&type=script&lang=js\"\nexport * from \"./MapManager.vue?vue&type=script&lang=js\"\n\nimport \"./MapManager.vue?vue&type=style&index=0&id=88c769cc&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-88c769cc\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","_createElementBlock","_hoisted_1","_hoisted_2","_createVNode","_component_Map","id","agv_upload_coordi_data","$options","agv_upload_data","onSave","SaveMapClickHandle","onTempSave","TempSaveHandler","editable","agv_show","canva_height","ref","components","Map","async","this","tags","MapAPI","GetMapTags","data","path_plan_point_type","path_plan_point_from","path_plan_point_to","map_saving","computed","StyleBiding","_sysAlarmShowing","UIStore","getters","SystemAlarmShowState","_eqpAlarmShowing","EqpAlarmShowState","top","IsEditable","mode_selected","map_station_data","MapStore","MapStations","AGVLocUpload","loadingText","methods","mapDataSave","tempMapData","JSON","parse","stringify","MapData","UpdateMapData","dispatch","mapData","_check_result","CheckMapContentHasAnyError","correct","$swal","fire","text","title","icon","showCancelButton","showConfirmButton","customClass","success","file","ImageFile","bus","emit","timer","Notifier","Danger","message","confirmButtonText","mapDataExist","newData","Points","Segments","Pathes","Regions","Map_Image_Boundary","ImageExtent","_tags_settings","Object","values","map","pt","TagNumber","non_repeat_tags","Set","length","duplicatesTags","seen","forEach","item","index","hasOwnProperty","push","_error_set","tag","_points_same_tag","filter","Graph","Display","join","result","PathPlanByTag","$refs","UpdatePathPlanRender","mounted","__exports__","render"],"sourceRoot":""}