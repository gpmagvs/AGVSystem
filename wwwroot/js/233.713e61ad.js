"use strict";(self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[]).push([[233],{34233:function(e,t,a){a.r(t),a.d(t,{default:function(){return U}});var l=a(66252);function i(e,t,a,i,d,n){const o=(0,l.up)("DedicatedVehiclesSetting"),s=(0,l.up)("b-tab"),c=(0,l.up)("b-tabs");return(0,l.wg)(),(0,l.j4)(c,{class:"w-100 my-2",modelValue:d.tabSelected,"onUpdate:modelValue":t[0]||(t[0]=e=>d.tabSelected=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(s,{class:"",title:"專用/優先車輛指派設定"},{default:(0,l.w5)((()=>[(0,l.Wm)(o)])),_:1}),(0,l.Wm)(s,{class:"",title:"尚未開放"})])),_:1},8,["modelValue"])}var d=a(3577);const n={class:"w-100 m-2",style:{height:"90vh"}},o={class:"d-flex border-bottom my-1 py-2"},s={class:"d-flex h-100"},c={class:"mx-2"},u={class:"d-flex justify-content-start"},r=(0,l._)("span",{class:"mx-2"},"優先指派之充電站/停車位",-1),p=(0,l._)("i",{class:"bi bi-info-circle text-primary"},null,-1),m={class:"d-flex"},h={class:"mx-2"},f={key:0,class:"bg-light w-100 border"},w={class:"d-flex justify-content-between"},g=(0,l._)("i",{class:"bi bi-chevron-double-right"},null,-1),b={class:"d-flex px-2"},k=(0,l._)("span",{class:"mx-2 text-primary"},"可選擇的站點",-1);function _(e,t,a,i,_,S){const C=(0,l.up)("el-button"),v=(0,l.up)("el-tag"),y=(0,l.up)("el-option"),x=(0,l.up)("el-select"),D=(0,l.up)("el-table-column"),q=(0,l.up)("el-tooltip"),W=(0,l.up)("el-table"),N=(0,l.up)("Map"),B=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",n,[(0,l._)("div",o,[(0,l.Wm)(C,{type:"success",onClick:S.handleSaveButtonClicked},{default:(0,l.w5)((()=>[(0,l.Uk)("儲存")])),_:1},8,["onClick"]),(0,l.Wm)(C,{type:"info",onClick:S.handleAddButtonClicked},{default:(0,l.w5)((()=>[(0,l.Uk)("新增")])),_:1},8,["onClick"]),(0,l.Wm)(C,{type:"primary",onClick:S.downloadFromBackend},{default:(0,l.w5)((()=>[(0,l.Uk)("Reload")])),_:1},8,["onClick"])]),(0,l.wy)(((0,l.wg)(),(0,l.iD)("div",s,[(0,l.Wm)(W,{class:"w-100",data:_.tableData,border:"",size:"large"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{label:"站點名稱",prop:"eqName",width:"220"},{default:(0,l.w5)((e=>[(0,l.Wm)(x,{filterable:"",modelValue:e.row.tag,"onUpdate:modelValue":t=>e.row.tag=t,placeholder:"站點",onChange:t=>S.handleEqNameChange(e.row)},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(S.eqStationOptions,(e=>((0,l.wg)(),(0,l.j4)(y,{key:e.value,label:e.label,value:e.value},{default:(0,l.w5)((()=>[(0,l._)("span",null,[(0,l.Wm)(v,{effect:"dark",type:"info"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,d.zw)(e.value),1)])),_:2},1024)]),(0,l._)("span",c,(0,d.zw)(e.label),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,l.Wm)(D,{prop:"dedicatedStation"},{header:(0,l.w5)((()=>[(0,l._)("div",u,[r,(0,l.Wm)(q,{content:"選擇車輛時，將優先指派停在這些站點的車輛(將依距離目的地遠近進行指派)",placement:"right"},{default:(0,l.w5)((()=>[p])),_:1})])])),default:(0,l.w5)((e=>[(0,l._)("div",m,[(0,l.Wm)(x,{modelValue:e.row.dedicatedStations,"onUpdate:modelValue":t=>e.row.dedicatedStations=t,multiple:"",filterable:"",clearable:"",placeholder:"站點",onFocus:t=>S.handleDedicatedStationSelectFocus(e.row)},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(S.stationOptions,(e=>((0,l.wg)(),(0,l.j4)(y,{key:e.value,label:e.label,value:e.value},{default:(0,l.w5)((()=>[(0,l._)("span",null,["charge"==e.type?((0,l.wg)(),(0,l.j4)(v,{key:0,effect:"dark",type:"info"},{default:(0,l.w5)((()=>[(0,l.Uk)("充電站")])),_:1})):(0,l.kq)("",!0),"parkable"==e.type?((0,l.wg)(),(0,l.j4)(v,{key:1,effect:"dark",type:"success"},{default:(0,l.w5)((()=>[(0,l.Uk)("停車位")])),_:1})):(0,l.kq)("",!0)]),(0,l._)("span",h,(0,d.zw)(e.label),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onFocus"]),(0,l.Wm)(C,{class:"text-primary",text:"",onClick:t=>S.handleMapSelectButtonClicked(e.row)},{default:(0,l.w5)((()=>[(0,l.Uk)("從地圖選擇")])),_:2},1032,["onClick"])])])),_:1}),(0,l.Wm)(D,{width:"100"},{default:(0,l.w5)((e=>[(0,l.Wm)(C,{type:"danger",onClick:t=>S.handleDeleteButtonClicked(e.row)},{default:(0,l.w5)((()=>[(0,l.Uk)("刪除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),_.mapShow?((0,l.wg)(),(0,l.iD)("div",f,[(0,l._)("div",w,[(0,l.Wm)(C,{text:"",type:"primary",onClick:t[0]||(t[0]=()=>{S.offMapFeatureClicked(),_.mapShow=!1})},{default:(0,l.w5)((()=>[g])),_:1}),(0,l._)("div",b,[(0,l._)("div",{style:(0,d.j5)({backgroundColor:_.mapHighLightColor,width:"40px",height:"15px",fontWeight:"bold",borderRadius:"5px","margin-top":"5px"})},null,4),k])]),(0,l.Wm)(N,{class:"bg-light border",ref:"map",id:"dedicated_vehicles_map",editable:!1,agv_show:!1,station_show:!0,rackInfoShow:!1,eq_lduld_status_show:!1},null,512)])):(0,l.kq)("",!0)])),[[B,_.isLoading]])])}a(57658);var S=a(95320),C=a(98307),v=a(53259),y=a(38418),x=a(81348),D={components:{Map:C["default"]},data(){return{tableData:[],selectedStationIndex:null,mapShow:!1,isLoading:!1,mapHighLightColor:"lime"}},computed:{eqStationOptions(){return S.p.getters.AllEqStation.map((e=>({value:e.tag,label:e.name_display})))},stationOptions(){const e=S.p.getters.AllChargeStation.map((e=>({value:e.tag,label:e.name_display,type:"charge"}))),t=S.p.getters.AllParkableStationOptions.filter((t=>!e.find((e=>e.value==t.tag)))).map((e=>({value:e.tag,label:e.name_display,type:"parkable"})));return[...e,...t]}},methods:{downloadFromBackend(){this.isLoading=!0,y.y.GetEQStationDedicatedSetting().then((e=>{this.tableData=e,setTimeout((()=>{this.isLoading=!1}),400)}))},handleSaveButtonClicked(){y.y.SetEQStationDedicatedSetting(this.tableData).then((e=>{this.$swal.fire({text:"儲存成功",icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}))},handleAddButtonClicked(){this.tableData.push({eqName:"",dedicatedStations:[]})},handleDeleteButtonClicked(e){this.tableData.splice(this.tableData.findIndex((t=>t.eqName==e.eqName&&t.dedicatedStations==e.dedicatedStations)),1)},handleEqNameChange(e){this.tableData.filter((t=>t.eqName==e.eqName)).length>1&&(this.$swal.fire({text:"已經有此站點",title:"",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),e.eqName=""),this.selectedStationIndex=this.tableData.findIndex((t=>t.eqName==e.eqName))},handleMapSelectButtonClicked(e){this.offMapFeatureClicked(),v.Z.on("/map/feature_clicked",this.handleMapFeatureClicked),this.selectedStationIndex=this.tableData.findIndex((t=>t.eqName==e.eqName&&t.dedicatedStations==e.dedicatedStations)),this.mapShow=!0,setTimeout((()=>{const e=this.stationOptions.map((e=>e.value));this.$refs.map.HighLightSpeficFeatureWithTags(e,this.mapHighLightColor)}),300)},handleMapFeatureClicked(e){const t=e.get("data");if(!t)return;let a=this.tableData[this.selectedStationIndex].dedicatedStations;const l=t.TagNumber,i=this.stationOptions.find((e=>e.value==l));a.includes(l)?x.z8.warning("已經選擇過此站點"):i&&a.push(l)},offMapFeatureClicked(){v.Z.off("/map/feature_clicked",this.handleMapFeatureClicked)},handleDedicatedStationSelectFocus(e){this.selectedStationIndex=this.tableData.findIndex((t=>t.eqName==e.eqName))}},mounted(){this.downloadFromBackend()}},q=a(83744);const W=(0,q.Z)(D,[["render",_]]);var N=W,B={components:{DedicatedVehiclesSetting:N},data(){return{tabSelected:0}}};const F=(0,q.Z)(B,[["render",i]]);var U=F}}]);
//# sourceMappingURL=233.713e61ad.js.map