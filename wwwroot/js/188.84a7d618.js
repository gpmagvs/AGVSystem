"use strict";(self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[]).push([[188],{76188:function(t,a,e){e.r(a),e.d(a,{default:function(){return g}});var n=e(79003);const s=t=>((0,n.pushScopeId)("data-v-29d9a8da"),t=t(),(0,n.popScopeId)(),t),o={class:"map-view h-100 d-flex flex-row my-1"},r=s((()=>(0,n.createElementVNode)("div",null,null,-1)));function i(t,a,e,s,i,p){const l=(0,n.resolveComponent)("MapShow");return(0,n.openBlock)(),(0,n.createElementBlock)("div",o,[r,(0,n.createVNode)(l,{id:"editable_map",agv_upload_coordi_data:p.agv_upload_data,onSave:p.SaveMapClickHandle,editable:!0,agv_show:!0,canva_height:"750px",ref:"map_editing"},null,8,["agv_upload_coordi_data","onSave"])])}e(57658);var p=e(76105),l=e(83592),c=e(93867),h=e(53259),d=e(95320),u={components:{MapShow:p["default"]},async mounted(){this.tags=await l.ZP.GetMapTags()},data(){return{path_plan_point_type:"Tag",path_plan_point_from:1,path_plan_point_to:2,tags:[1,2,3,59,11],map_saving:!1}},computed:{IsEditable(){return"編輯"==this.mode_selected},map_station_data(){return d.p.getters.MapStations},agv_upload_data(){return d.p.getters.AGVLocUpload},loadingText(){return"圖資儲存中..."}},methods:{async SaveMapClickHandle(t){var a=JSON.parse(JSON.stringify(d.p.getters.MapData));a.Points=t.Points,a.Segments=t.Pathes,a.Regions=t.Regions;var e=this.CheckMapContentHasAnyError(a);if(e.correct){this.map_saving=!0,this.$swal.fire({text:"",title:"圖資儲存中...",icon:"warning",showCancelButton:!1,showConfirmButton:!1,customClass:"my-sweetalert"});var n=await d.p.dispatch("SaveMap",a);this.map_saving=!1,n?(h.Z.emit("/map_save"),this.$swal.fire({title:"圖資儲存成功",icon:"success",showCancelButton:!1,showConfirmButton:!1,customClass:"my-sweetalert",timer:1500})):(c.Z.Danger("圖資儲存失敗"),this.$swal.fire({title:"圖資儲存失敗",icon:"error",showCancelButton:!1,showConfirmButton:!0,customClass:"my-sweetalert"}))}else this.$swal.fire({text:e.message,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},CheckMapContentHasAnyError(t){var a=Object.values(t.Points).map((t=>t.TagNumber)),e=[...new Set(a)];if(e.length!=a.length){const e=[],s={};a.forEach(((t,a)=>{s.hasOwnProperty(t)?e.push(t):s[t]=a}));var n=[...new Set(e)].map((a=>{var e=Object.values(t.Points).filter((t=>t.TagNumber==a));return`Tag-${a}於 ${e.map((t=>t.Graph.Display)).join("、")}重複設置`}));return{correct:!1,message:`${n.join(";")} ，\n請再檢查圖資設定`}}return{correct:!0,message:""}},async GetPathPlanedFromServer(){var t={};if("Tag"==this.path_plan_point_type&&(t=await l.ZP.PathPlanByTag(this.path_plan_point_from,this.path_plan_point_to)),t){var a=t.tags;this.$refs["map"].UpdatePathPlanRender(a)}}},mounted(){}},m=e(40089);const _=(0,m.Z)(u,[["render",i],["__scopeId","data-v-29d9a8da"]]);var g=_}}]);
//# sourceMappingURL=188.84a7d618.js.map