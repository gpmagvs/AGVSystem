"use strict";(self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[]).push([[174],{14174:function(e,t,l){l.r(t),l.d(t,{default:function(){return g}});l(57658);var a=l(79003);const o={class:"border p-2 text-start"},n={class:"w-100 border-bottom my-1"},r={class:"mx-2"},i=["id"],s={class:"px-2 text-start"},c={class:"text-start w-100"},d={key:0},u={key:1};function m(e,t,l,m,p,_){const w=(0,a.resolveComponent)("el-button"),h=(0,a.resolveComponent)("el-table-column"),V=(0,a.resolveComponent)("el-option"),v=(0,a.resolveComponent)("el-select"),g=(0,a.resolveComponent)("el-tag"),C=(0,a.resolveComponent)("el-input-number"),k=(0,a.resolveComponent)("el-input"),f=(0,a.resolveComponent)("el-table"),N=(0,a.resolveComponent)("el-drawer");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createElementVNode)("div",o,[(0,a.createElementVNode)("div",n,[(0,a.createVNode)(w,{class:"my-1",type:"danger",onClick:t[0]||(t[0]=()=>{p.hotRunScripts.push({no:p.hotRunScripts.length+1,agv_name:void 0,loop_num:10,finish_num:0,action_num:9,state:"IDLE",actions:[]})})},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("新增動作")])),_:1}),(0,a.createVNode)(w,{onClick:_.HandleSaveBtnClick,type:"primary"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("儲存設定")])),_:1},8,["onClick"])]),(0,a.createVNode)(f,{"row-key":"no",data:p.hotRunScripts,"default-expand-all":!1,border:""},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(h,{label:"NO.",prop:"no",width:"60",align:"center"}),(0,a.createVNode)(h,{label:"執行AGV",prop:"agv_name",width:"150"},{default:(0,a.withCtx)((e=>[(0,a.createElementVNode)("div",null,[(0,a.createVNode)(v,{modelValue:e.row.agv_name,"onUpdate:modelValue":t=>e.row.agv_name=t},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(_.AgvNameList,(e=>((0,a.openBlock)(),(0,a.createBlock)(V,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])])),_:1}),(0,a.createVNode)(h,{label:"狀態",prop:"state",width:"120",align:"center"},{default:(0,a.withCtx)((e=>[(0,a.createElementVNode)("div",null,[(0,a.createVNode)(g,{effect:"dark",type:"Running"==e.row.state?"success":"warning"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.row.state),1)])),_:2},1032,["type"])])])),_:1}),(0,a.createVNode)(h,{label:"已完成次數",prop:"finish_num",width:"100",align:"center"},{default:(0,a.withCtx)((e=>[(0,a.createElementVNode)("div",null,(0,a.toDisplayString)(e.row.finish_num)+"/"+(0,a.toDisplayString)(e.row.loop_num),1)])),_:1}),(0,a.createVNode)(h,{label:"Loop次數",prop:"finish_num",width:"120",align:"center"},{default:(0,a.withCtx)((e=>[(0,a.createVNode)(C,{size:"small",style:{width:"80px"},step:1,precision:0,modelValue:e.row.loop_num,"onUpdate:modelValue":t=>e.row.loop_num=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,a.createVNode)(h,{label:"動作數",width:"140"},{default:(0,a.withCtx)((e=>[(0,a.createElementVNode)("div",null,[(0,a.createElementVNode)("span",r,(0,a.toDisplayString)(e.row.actions.length),1),(0,a.createVNode)(w,{size:"small",onClick:()=>{p.action_drawer_visible=!0,p.selected_script_name=e.row.agv_name,p.selected_script_actions=e.row.actions}},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("動作設定")])),_:2},1032,["onClick"])])])),_:1}),(0,a.createVNode)(h,{label:"Comment",width:"240"},{default:(0,a.withCtx)((e=>[(0,a.createVNode)(k,{modelValue:e.row.comment,"onUpdate:modelValue":t=>e.row.comment=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,a.createVNode)(h,null,{default:(0,a.withCtx)((e=>[(0,a.createElementVNode)("div",null,[(0,a.createVNode)(w,{type:"Running"==e.row.state?"danger":"success",size:"small",onClick:t=>_.HandleStartBtnClick(e.row)},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)("Running"==e.row.state?"中止":"執行"),1)])),_:2},1032,["type","onClick"]),(0,a.createVNode)(w,{size:"small",onClick:t=>_.HandleDeleteScript(e.row),type:"danger"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("刪除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"]),(0,a.createVNode)(N,{modelValue:p.action_drawer_visible,"onUpdate:modelValue":t[2]||(t[2]=e=>p.action_drawer_visible=e),direction:"rtl",size:"60%"},{header:(0,a.withCtx)((({titleId:e,titleClass:t})=>[(0,a.createElementVNode)("h4",{class:(0,a.normalizeClass)(["text-danger px-5 text-center",t]),id:e},"HOT RUN Actions Setting : "+(0,a.toDisplayString)(p.selected_script_name),11,i)])),default:(0,a.withCtx)((()=>[(0,a.createElementVNode)("div",s,[(0,a.createVNode)(w,{class:"mx-2",type:"danger",onClick:t[1]||(t[1]=()=>{p.selected_script_actions.push({no:p.selected_script_actions.length+1,action:"move",source_tag:void 0,destine_tag:void 0})})},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("新增動作")])),_:1}),(0,a.createVNode)(w,{class:"mx-2",onClick:_.HandleSaveBtnClickInDrawer,type:"primary"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("儲存設定")])),_:1},8,["onClick"]),(0,a.createVNode)(f,{"row-key":"no",style:{width:"1024px"},border:"",class:"m-2",data:p.selected_script_actions},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(h,{width:"50"},{default:(0,a.withCtx)((e=>[(0,a.createElementVNode)("div",c,[(0,a.createVNode)(w,{class:"w-100",size:"small",onClick:t=>_.action_move_up(e.row)},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("▲")])),_:2},1032,["onClick"]),(0,a.createVNode)(w,{class:"w-100",size:"small",onClick:t=>_.action_move_down(e.row)},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("▼")])),_:2},1032,["onClick"])])])),_:1}),(0,a.createVNode)(h,{label:"NO.",prop:"no",width:"60",align:"center"}),(0,a.createVNode)(h,{label:"動作",prop:"action",width:"120"},{default:(0,a.withCtx)((e=>[(0,a.createVNode)(v,{class:"w-100",modelValue:e.row.action,"onUpdate:modelValue":t=>e.row.action=t,placeholder:"請選擇Action"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(V,{label:"移動",value:"move"}),(0,a.createVNode)(V,{label:"停車",value:"park"}),(0,a.createVNode)(V,{label:"搬運",value:"carry"}),(0,a.createVNode)(V,{label:"放貨",value:"load"}),(0,a.createVNode)(V,{label:"取貨",value:"unload"}),(0,a.createVNode)(V,{label:"充電",value:"charge"}),(0,a.createVNode)(V,{label:"巡檢量測",value:"measure"}),(0,a.createVNode)(V,{label:"交換電池",value:"exchangebattery"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,a.createVNode)(h,{label:"起點",prop:"source_tag",width:"250"},{default:(0,a.withCtx)((e=>[(0,a.createVNode)(v,{disabled:"carry"!=e.row.action,class:"w-100",modelValue:e.row.source_tag,"onUpdate:modelValue":t=>e.row.source_tag=t,placeholder:"請選擇起點"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(_.GetOption(e.row.action),(e=>((0,a.openBlock)(),(0,a.createBlock)(V,{key:e,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:2},1032,["disabled","modelValue","onUpdate:modelValue"]),_.slotSelectable(e.row.action)?((0,a.openBlock)(),(0,a.createBlock)(v,{key:0,disabled:"carry"!=e.row.action,class:"w-100",modelValue:e.row.source_slot,"onUpdate:modelValue":t=>e.row.source_slot=t,placeholder:"請選擇Slot"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(_.SlotOptions,(e=>((0,a.openBlock)(),(0,a.createBlock)(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])):(0,a.createCommentVNode)("",!0)])),_:1}),(0,a.createVNode)(h,{label:"卡匣ID",width:"150"},{default:(0,a.withCtx)((e=>[(0,a.createVNode)(k,{disabled:"carry"!=e.row.action&&"unload"!=e.row.action,modelValue:e.row.cst_id,"onUpdate:modelValue":t=>e.row.cst_id=t},null,8,["disabled","modelValue","onUpdate:modelValue"])])),_:1}),(0,a.createVNode)(h,{label:"終點",prop:"destine_tag",width:"250"},{default:(0,a.withCtx)((e=>["measure"!=e.row.action?((0,a.openBlock)(),(0,a.createElementBlock)("div",d,[(0,a.createVNode)(v,{class:"w-100",modelValue:e.row.destine_tag,"onUpdate:modelValue":t=>e.row.destine_tag=t,placeholder:"請選擇終點"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(_.GetOption(e.row.action),(e=>((0,a.openBlock)(),(0,a.createBlock)(V,{key:e,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),_.slotSelectable(e.row.action)?((0,a.openBlock)(),(0,a.createBlock)(v,{key:0,class:"w-100",modelValue:e.row.destine_slot,"onUpdate:modelValue":t=>e.row.destine_slot=t,placeholder:"請選擇Slot"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(_.SlotOptions,(e=>((0,a.openBlock)(),(0,a.createBlock)(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(0,a.createCommentVNode)("",!0)])):((0,a.openBlock)(),(0,a.createElementBlock)("div",u,[(0,a.createVNode)(v,{class:"w-100",modelValue:e.row.destine_name,"onUpdate:modelValue":t=>e.row.destine_name=t,placeholder:"請選擇終點"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(_.GetOption(e.row.action),(e=>((0,a.openBlock)(),(0,a.createBlock)(V,{key:e,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])]))])),_:1}),(0,a.createVNode)(h,null,{default:(0,a.withCtx)((e=>[(0,a.createVNode)(w,{onClick:t=>_.HandleDeleteHotRunAction(e.row),size:"small",type:"danger"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Delete")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue"])])])}var p=l(24239),_=l(95320),w=l(8764),h={data(){return{hotRunScripts:[{no:1,agv_name:"AGV_001",loop_num:10,finish_num:0,state:"IDLE",actions:[{no:1,action:"move",source_tag:0,source_slot:0,destine_tag:2,destine_slot:0,cst_id:""},{no:2,action:"move",source_tag:0,destine_tag:2,cst_id:""}]}],action_drawer_visible:!1,selected_script_name:"123",selected_script_actions:[]}},methods:{GetOption(e){return"move"==e?this.moveable_tags:"park"==e?this.parkable_tags:"load"==e|"unload"==e|"carry"==e?this.stock_tags:"charge"==e||"exchangebattery"==e?this.chargable_tags:"measure"==e?this.bay_tags:void 0},action_move_up(e){var t=this.selected_script_actions.indexOf(e);0!=t&&(this.selected_script_actions=this.move_element_up(this.selected_script_actions,t))},action_move_down(e){var t=this.selected_script_actions.indexOf(e);t!=this.selected_script_actions.length-1&&(this.selected_script_actions=this.move_element_down(this.selected_script_actions,t))},move_element_up(e,t){if(t>0&&t<e.length){const l=e[t];e.splice(t,1),e.splice(t-1,0,l);for(let t=0;t<e.length;t++)e[t].no=t+1;return e}},move_element_down(e,t){if(t>=0&&t<e.length-1){const l=e[t];e.splice(t,1),e.splice(t+1,0,l);for(let t=0;t<e.length;t++)e[t].no=t+1;return e}},slotSelectable(e){return"carry"==e||"unload"==e||"load"==e},async HandleStartBtnClick(e){"IDLE"==e.state?this.$swal.fire({text:"",title:"執行Hot Run ?",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async t=>{if(t.isConfirmed){var l=await(0,w.Qk)(e.no);l.confirm?this.$swal.fire({text:"",title:"HOT RUN Start!",icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):this.$swal.fire({text:l.message,title:"無法執行HOT RUN",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}})):this.$swal.fire({text:"",title:"確定要終止?",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((t=>{t.isConfirmed&&(0,w.AZ)(e.no)}))},async HandleSaveBtnClick(){var e=await(0,w.A5)(this.hotRunScripts);this.$swal.fire({text:e.result?"":e.message,title:e.result?"儲存成功":"儲存失敗",icon:e.result?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert",timer:e.result?1e3:void 0})},async HandleSaveBtnClickInDrawer(){this.action_drawer_visible=!1,setTimeout((async()=>{await this.HandleSaveBtnClick(),setTimeout((()=>{this.action_drawer_visible=!0}),1e3)}),100)},HandleDeleteHotRunAction(e){var t=this.selected_script_actions.indexOf(e);this.selected_script_actions.splice(t,1)},HandleDeleteScript(e){this.$swal.fire({text:"",title:"確定要刪除此腳本?",icon:"warning",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((t=>{if(t.isConfirmed){"Running"==e.state&&(0,w.AZ)(e.no),this.hotRunScripts.splice(this.hotRunScripts.indexOf(e),1);for(let e=0;e<this.hotRunScripts.length;e++)this.hotRunScripts[e].no=e+1}}))}},computed:{AgvNameList(){return p.sn.getters.AGVNameList},moveable_tags(){return _.p.getters.AllNormalStationOptions},stock_tags(){return _.p.getters.AllEqStation},chargable_tags(){return _.p.getters.AllChargeStation},parkable_tags(){return _.p.getters.AllParkingStationOptions},bay_tags(){var e=_.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},hot_run_states(){return p.sn.getters.HotRunStates},SlotOptions(){return[{value:0,label:"第1層"},{value:1,label:"第2層"},{value:2,label:"第3層"}]}},mounted(){setTimeout((async()=>{this.hotRunScripts=await(0,w.gh)(),(0,a.watch)((()=>this.hot_run_states),((e,t)=>{for(let a=0;a<e.length;a++){const t=e[a];var l=this.hotRunScripts.find((e=>e.no==t.no));l&&(l.state=t.state,l.finish_num=t.finish_num)}}),{deep:!0,immediate:!0})}),100)}},V=l(40089);const v=(0,V.Z)(h,[["render",m],["__scopeId","data-v-a688b7a8"]]);var g=v}}]);
//# sourceMappingURL=174.d5aab479.js.map