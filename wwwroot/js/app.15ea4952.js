(function(){var e={46700:function(e,t,a){var o={"./af":63906,"./af.js":63906,"./ar":40902,"./ar-dz":3853,"./ar-dz.js":3853,"./ar-kw":20299,"./ar-kw.js":20299,"./ar-ly":96825,"./ar-ly.js":96825,"./ar-ma":66379,"./ar-ma.js":66379,"./ar-sa":87700,"./ar-sa.js":87700,"./ar-tn":2059,"./ar-tn.js":2059,"./ar.js":40902,"./az":76043,"./az.js":76043,"./be":7936,"./be.js":7936,"./bg":34078,"./bg.js":34078,"./bm":14014,"./bm.js":14014,"./bn":29554,"./bn-bd":17114,"./bn-bd.js":17114,"./bn.js":29554,"./bo":6529,"./bo.js":6529,"./br":65437,"./br.js":65437,"./bs":19647,"./bs.js":19647,"./ca":59951,"./ca.js":59951,"./cs":26113,"./cs.js":26113,"./cv":37965,"./cv.js":37965,"./cy":35858,"./cy.js":35858,"./da":33515,"./da.js":33515,"./de":62831,"./de-at":6263,"./de-at.js":6263,"./de-ch":51127,"./de-ch.js":51127,"./de.js":62831,"./dv":4510,"./dv.js":4510,"./el":68616,"./el.js":68616,"./en-au":24595,"./en-au.js":24595,"./en-ca":73545,"./en-ca.js":73545,"./en-gb":79609,"./en-gb.js":79609,"./en-ie":43727,"./en-ie.js":43727,"./en-il":93302,"./en-il.js":93302,"./en-in":46305,"./en-in.js":46305,"./en-nz":39128,"./en-nz.js":39128,"./en-sg":84569,"./en-sg.js":84569,"./eo":50650,"./eo.js":50650,"./es":26358,"./es-do":64214,"./es-do.js":64214,"./es-mx":38639,"./es-mx.js":38639,"./es-us":30232,"./es-us.js":30232,"./es.js":26358,"./et":47279,"./et.js":47279,"./eu":15515,"./eu.js":15515,"./fa":27981,"./fa.js":27981,"./fi":37090,"./fi.js":37090,"./fil":79208,"./fil.js":79208,"./fo":2799,"./fo.js":2799,"./fr":23463,"./fr-ca":2213,"./fr-ca.js":2213,"./fr-ch":52848,"./fr-ch.js":52848,"./fr.js":23463,"./fy":41468,"./fy.js":41468,"./ga":88163,"./ga.js":88163,"./gd":2898,"./gd.js":2898,"./gl":76312,"./gl.js":76312,"./gom-deva":20682,"./gom-deva.js":20682,"./gom-latn":49178,"./gom-latn.js":49178,"./gu":31400,"./gu.js":31400,"./he":52795,"./he.js":52795,"./hi":17009,"./hi.js":17009,"./hr":46506,"./hr.js":46506,"./hu":69565,"./hu.js":69565,"./hy-am":93864,"./hy-am.js":93864,"./id":5626,"./id.js":5626,"./is":36649,"./is.js":36649,"./it":90151,"./it-ch":95348,"./it-ch.js":95348,"./it.js":90151,"./ja":79830,"./ja.js":79830,"./jv":33751,"./jv.js":33751,"./ka":63365,"./ka.js":63365,"./kk":85980,"./kk.js":85980,"./km":99571,"./km.js":99571,"./kn":25880,"./kn.js":25880,"./ko":16809,"./ko.js":16809,"./ku":96773,"./ku.js":96773,"./ky":65505,"./ky.js":65505,"./lb":50553,"./lb.js":50553,"./lo":51237,"./lo.js":51237,"./lt":91563,"./lt.js":91563,"./lv":61057,"./lv.js":61057,"./me":96495,"./me.js":96495,"./mi":83096,"./mi.js":83096,"./mk":43874,"./mk.js":43874,"./ml":46055,"./ml.js":46055,"./mn":87747,"./mn.js":87747,"./mr":17113,"./mr.js":17113,"./ms":8687,"./ms-my":7948,"./ms-my.js":7948,"./ms.js":8687,"./mt":14532,"./mt.js":14532,"./my":4655,"./my.js":4655,"./nb":56961,"./nb.js":56961,"./ne":2512,"./ne.js":2512,"./nl":48448,"./nl-be":72936,"./nl-be.js":72936,"./nl.js":48448,"./nn":49031,"./nn.js":49031,"./oc-lnc":5174,"./oc-lnc.js":5174,"./pa-in":30118,"./pa-in.js":30118,"./pl":93448,"./pl.js":93448,"./pt":33518,"./pt-br":62447,"./pt-br.js":62447,"./pt.js":33518,"./ro":70817,"./ro.js":70817,"./ru":10262,"./ru.js":10262,"./sd":58990,"./sd.js":58990,"./se":43842,"./se.js":43842,"./si":37711,"./si.js":37711,"./sk":80756,"./sk.js":80756,"./sl":3772,"./sl.js":3772,"./sq":6187,"./sq.js":6187,"./sr":40732,"./sr-cyrl":75713,"./sr-cyrl.js":75713,"./sr.js":40732,"./ss":99455,"./ss.js":99455,"./sv":69770,"./sv.js":69770,"./sw":80959,"./sw.js":80959,"./ta":36459,"./ta.js":36459,"./te":25302,"./te.js":25302,"./tet":67975,"./tet.js":67975,"./tg":71294,"./tg.js":71294,"./th":2385,"./th.js":2385,"./tk":24613,"./tk.js":24613,"./tl-ph":58668,"./tl-ph.js":58668,"./tlh":58190,"./tlh.js":58190,"./tr":74506,"./tr.js":74506,"./tzl":63440,"./tzl.js":63440,"./tzm":69852,"./tzm-latn":42350,"./tzm-latn.js":42350,"./tzm.js":69852,"./ug-cn":70730,"./ug-cn.js":70730,"./uk":40099,"./uk.js":40099,"./ur":72100,"./ur.js":72100,"./uz":96002,"./uz-latn":26322,"./uz-latn.js":26322,"./uz.js":96002,"./vi":14207,"./vi.js":14207,"./x-pseudo":24674,"./x-pseudo.js":24674,"./yo":10570,"./yo.js":10570,"./zh-cn":73644,"./zh-cn.js":73644,"./zh-hk":22591,"./zh-hk.js":22591,"./zh-mo":89503,"./zh-mo.js":89503,"./zh-tw":88080,"./zh-tw.js":88080};function n(e){var t=i(e);return a(t)}function i(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}n.keys=function(){return Object.keys(o)},n.resolve=i,e.exports=n,n.id=46700},56938:function(e,t){"use strict";class a{constructor(e){void 0==e?(this.AGV_Name="",this.AGV_Description="",this.Model="",this.MainStatus=0,this.OnlineStatus=0,this.CurrentLocation="",this.CurrentCarrierID="",this.BatteryLevel_1=0,this.BatteryLevel_2=0,this.TaskName="",this.TaskRunStatus=0,this.TaskRunAction=0,this.Theta=0,this.Connected=!1,this.StationName="",this.Group=0,this.IsCharging=!1,this.IP="127.0.0.1",this.Port=7025,this.TaskSourceStationName="",this.TaskDestineStationName="",this.TransferProcess=0,this.OrderAction=0,this.TaskETA=""):(this.AGV_Name=e.AGV_Name,this.AGV_Description=e.AGV_Description,this.Model=e.Model,this.MainStatus=e.MainStatus,this.OnlineStatus=e.OnlineStatus,this.CurrentLocation=e.CurrentLocation,this.CurrentCarrierID=e.CurrentCarrierID,this.BatteryLevel_1=e.BatteryLevel_1,this.BatteryLevel_2=e.BatteryLevel_2,this.TaskName=e.TaskName,this.TaskRunStatus=e.TaskRunStatus,this.TaskRunAction=e.TaskRunAction,this.Theta=e.Theta,this.Connected=e.Connected,this.StationName=e.StationName,this.Group=e.Group,this.IsCharging=e.IsCharging,this.IP=e.IP,this.Port=e.Port,this.TaskSourceStationName=e.TaskSourceStationName,this.TaskDestineStationName=e.TaskDestineStationName,this.TransferProcess=e.TransferProcess,this.OrderAction=e.OrderAction,this.TaskETA=e.TaskETA)}}t.Z=a},61623:function(e,t,a){"use strict";a.d(t,{F6:function(){return d},__:function(){return c},gU:function(){return l},lF:function(){return m},yy:function(){return u}});a(62062);var o=a(56265),n=a.n(o),i=a(663),s=a(60487),r=n().create({baseURL:i.Z.backend_host});async function l(){return await r.get("/api/Alarm/SystemAlarmReset")}async function d(){return await r.get("/api/Alarm/EquipmentAlarmReset")}async function c(e,t,a,o="ALL",n="ALL",i="ALL"){var s=await r.get(`/api/Alarmquery/QueryAlarm?currentpage=${e}&StartTime=${t}&EndTime=${a}&AGV_Name=${o}&TaskName=${n}&AlarmType=${i}`);return s.data}async function m(e,t,a="ALL",o="ALL"){const n=await r.get(`/api/Alarmquery/SaveTocsv?StartTime=${e}&EndTime=${t}&AGV_Name=${a}&TaskName=${o}`,{responseType:"blob"}),i=window.URL.createObjectURL(new Blob([n.data])),s=document.createElement("a");s.href=i;let l=`AGVS_Alarms_From_${e}_To_${t}.csv`;s.setAttribute("download",l),document.body.appendChild(s),s.click()}class u{constructor(e=(e=>{})){this.onmessageHandler=e;var t=new s.Z("/UncheckedAlarm");t.Connect(),t.onmessage=e}}},90131:function(e,t,a){"use strict";a.d(t,{Kt:function(){return s},VM:function(){return d},g0:function(){return i},yK:function(){return r}});var o=a(36797),n=a.n(o);const i=()=>{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);return{Authorization:`Bearer ${t.token}`}}return{}},s=()=>{const e=m();return e?`Bearer ${e.token}`:""};function r(){localStorage.removeItem("user")}class l{constructor(e,t){this.isLogin=e,this.login_info=t}}function d(){const e=m();return e?new l(0!=e.Role&&0==c(),e):new l(!1,null)}function c(){const e=m();if(e){var t=n()(e.LoginTime).add(1,"day"),a=Date.now()>t;return console.log(a),a}return!0}function m(){const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);return t}}},19578:function(e,t){"use strict";class a{constructor(){this.AGVName="ALL",this.Result=0,this.StartTimeStr="",this.EndTimeStr="",this.DataNumPerPage=15,this.Page=1}}t.Z=a},64491:function(e,t,a){"use strict";a.d(t,{Aj:function(){return u},CN:function(){return m},H5:function(){return r},PQ:function(){return h},Qu:function(){return l},k3:function(){return p},qN:function(){return c},wW:function(){return d},yS:function(){return g}});var o=a(56265),n=a.n(o),i=a(663),s=n().create({baseURL:i.Z.backend_host});async function r(){var e=await s.get("/api/Equipment/GetEQOptions");return e.data}async function l(){var e=await s.get("/api/Equipment/GetWIPOptions");return e.data}async function d(e){var t=await s.post("/api/Equipment/SaveEQOptions",e);return t.data}async function c(e){var t=await s.post("/api/Equipment/ConnectTest",e);return t.data}async function m(e){var t=await s.get(`/api/Equipment/GetEQInfoByTag?Tag=${e}`);return t.data}async function u(e,t,a){var o=`/api/Equipment/AgvHsSignal?EqName=${encodeURIComponent(e)}&SignalName=${encodeURIComponent(t)}&State=${a}`,n=await s.post(o);return n.data}const h={async SetState(e,t){var a=`/api/Equipment/Emu/State?EqName=${encodeURIComponent(e)}&State=${t}`,o=await s.get(a);return o.data},async EQAllLoad(){var e="/api/Equipment/Emu/AllLoad",t=await s.get(e);return t.data},async EQAllBusy(){var e="/api/Equipment/Emu/AllBusy",t=await s.get(e);return t.data},async SetEQHsSignal(e,t,a){var o=`/api/Equipment/Emu/HsSignal?EqName=${encodeURIComponent(e)}&SignalName=${encodeURIComponent(t)}&State=${a}`,n=await s.get(o);return n.data}},p={async SetSensorState(e,t,a,o,n){var i=`/api/WIPEmu/SetSensorState?rack_id=${e}&port_id=${t}&cargo_type=${a}&sensor_number=${o}&state=${n}`,r=await s.get(i);return r.data}},g={async SetCurveSetting(e,t,a){var o=`/api/Equipment/ChargeStation/Settings?EqName=${encodeURIComponent(e)}&Item=${encodeURIComponent(t)}&Value=${a}`,n=await s.get(o);return n.data}}},83592:function(e,t,a){"use strict";a.d(t,{GR:function(){return u},Ml:function(){return m},j2:function(){return d}});a(67635);var o=a(56265),n=a.n(o),i=a(663),s=a(95320),r=n().create({baseURL:s.p.getters.MapServerUrl}),l=n().create({baseURL:i.Z.vms_host});async function d(){return await r.get("api/Map/RegionOptions").then((e=>{var t=e.data;return s.p.commit("RegionOptions",t),t})).catch((e=>{}))}const c={GetMapFromLocal(){return r.get("api/Map").then((e=>e.data)).catch((e=>{}))},GetGeoMap(){return r.get("api/Map/GeoMapJson").then((e=>e.data)).catch((e=>{}))},GetMapTags(){return r.get("api/Map/Tags").then((e=>e.data)).catch((e=>{}))},ReloadMap(){return r.get("api/Map/ReloadMap").then((e=>(s.p.dispatch("DownloadMapData"),e.data))).catch((e=>{}))},GetAGVList(){return r.get("api/Map/AGVList").then((e=>e.data)).catch((e=>{}))},PathPlanByTag(e,t){return r.get(`api/Map/PathPlan?fromTag=${e}&toTag=${t}`).then((e=>e.data)).catch((e=>{}))},GetMapStationTemplate(){return r.get("api/Map/MapPointTemplate").then((e=>e.data)).catch((e=>{}))},Regist(e){return l.get(`api/Map/Regist?Tag_Number=${e}`).then((e=>e.data)).catch((e=>{}))},Unregist(e){return l.get(`api/Map/Unregist?Tag_Number=${e}`).then((e=>e.data)).catch((e=>{}))}},m=[{label:"Normal",value:0},{label:"EQ",value:1},{label:"STK",value:2},{label:"Charge",value:3},{label:"Buffer",value:4},{label:"Charge & Buffer",value:5},{label:" Charge & STK",value:6},{label:"Escape",value:8},{label:"EQ_LD",value:11},{label:"STK_LD",value:12},{label:"EQ_ULD",value:21},{label:"STK_ULD",value:22},{label:"Fire Door",value:31},{label:"Fire EQ",value:32},{label:"Auto Door",value:33},{label:"Elevator",value:100},{label:"Elevator",value:201},{label:"Elevator_LD",value:201},{label:"Elevator_ULD",value:221},{label:"Repair",value:110}];function u(e){var t=m.findLast((t=>t.value==e));return t?t.label:e+""}t.ZP=c},3567:function(e,t,a){"use strict";a.d(t,{AE:function(){return l},Fy:function(){return d},IG:function(){return c},Wp:function(){return m},x0:function(){return u}});var o=a(56265),n=a.n(o),i=a(663),s=a(19578),r=n().create({baseURL:i.Z.backend_host});async function l(e=s.Z){var t=await r.post("/api/InstrumentMeasure",e);return t.data}async function d(){var e=await r.get("/api/InstrumentMeasure/GetMeasureSchedules");return e.data}async function c(e,t){var a=await r.delete(`/api/InstrumentMeasure/DeleteSchedule?time=${e}&agv_name=${t}`);return a.data}async function m(e){var t=await r.post("/api/InstrumentMeasure/AddNewMeasureSchedule",e);return t.data}async function u(e,t,a){var o=await r.post(`/api/InstrumentMeasure/ModifyMeasureSchedule?time=${e}&agv_name=${t}`,a);return o.data}},93867:function(e,t,a){"use strict";var o=a(17014);a(33555),a(26349);let n={Success(e,t="bottom",a=3e3){(0,o.NU)({message:e,position:t,type:"success",duration:a,background:"rgba(7, 193, 96, 0.9)",onclick:()=>{(0,o.rz)()}})},Primary(e,t="top",a=3e3){(0,o.NU)({message:e,position:t,type:"primary",duration:a,onclick:()=>{(0,o.rz)()}})},Danger(e,t="top",a=3e3){(0,o.NU)({message:e,position:t,type:"danger",duration:a,onclick:()=>{(0,o.rz)()}})},Warning(e,t="top",a=3e3){(0,o.NU)({message:e,position:t,type:"warning",duration:a,onclick:()=>{(0,o.rz)()}})}};t.Z=n},20840:function(e,t,a){"use strict";a.d(t,{MM:function(){return r},c6:function(){return c},lF:function(){return l},tQ:function(){return d}});a(62062);var o=a(56265),n=a.n(o),i=a(663),s=n().create({baseURL:i.Z.backend_host});async function r(e,t,a,o="ALL",n="ALL",i="ALL",r="ALL"){var l=await s.get(`/api/TaskQuery/TaskQuery?currentpage=${e}&StartTime=${t}&EndTime=${a}&AGV_Name=${o}&TaskName=${n}&Result=${i}&ActionType=${r}`);return console.info(l.data),l.data}async function l(e,t,a="ALL",o="ALL"){const n=await s.get(`/api/TaskQuery/SaveTocsv?StartTime=${e}&EndTime=${t}&AGV_Name=${a}&TaskName=${o}`),i=window.URL.createObjectURL(new Blob([n.data])),r=document.createElement("a");r.href=i,r.setAttribute("download","TaskQuery.csv"),document.body.appendChild(r),r.click()}async function d(e,t,a){var o=await s.get(`/api/TaskQuery/GetTasks?agv_name=${a}&start=${e}&end=${t}`);return o.data}async function c(e){var t=await s.get(`/api/TaskQuery/GetTrajectory?taskID=${e}`);return t.data}},8764:function(e,t,a){"use strict";a.d(t,{A5:function(){return y},AZ:function(){return N},FV:function(){return u},J8:function(){return w},Nn:function(){return v},On:function(){return p},Qk:function(){return C},Y4:function(){return h},Z$:function(){return _},ec:function(){return m},fn:function(){return g},gh:function(){return V},mc:function(){return f}});var o=a(56265),n=a.n(o),i=a(663),s=a(36797),r=a.n(s),l=a(90131),d=a(24239),c=n().create({baseURL:i.Z.backend_host,headers:{}});class m{constructor(e,t,a=50,o=!1){this.TaskName=`Move_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=0,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=o}}class u{constructor(e,t,a=50,o=!1){this.TaskName=`Measure_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=6,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t,this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=o}}class h{constructor(e,t,a,o,n=50,i=!1){this.TaskName=`Load_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=7,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot=a+"",this.Carrier_ID=o,this.Priority=n,this.bypass_eq_status_check=i}}class p{constructor(e,t,a,o,n=50,i=!1){this.TaskName=`Unload_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=1,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot=a+"",this.Carrier_ID=o,this.Priority=n,this.bypass_eq_status_check=i}}class g{constructor(e,t,a=50,o=!1){this.TaskName=`Charge_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=8,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=o}}class _{constructor(e,t,a=50,o=!1){this.TaskName=`BatEx_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=14,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=o}}class v{constructor(e,t,a=50,o=!1){this.TaskName=`Park_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=12,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=o}}class f{constructor(e,t,a,o,n,i,s=50,l=!1){this.TaskName=`Local_${r()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=9,this.DesignatedAGVName=e,this.From_Station=t+"",this.From_Slot=a+"",this.To_Station=o+"",this.To_Slot=n+"",this.Carrier_ID=i,this.Priority=s,this.bypass_eq_status_check=l}}var w={async Task(){c.get("/api/Task/Allocation",{headers:(0,l.g0)()}).then((e=>{console.log("Response:",e.data)})).catch((e=>{console.error("Error:",e)}))},async Cancel(e){try{var t=await c.get(`/api/Task/Cancel?task_name=${e}`,{headers:(0,l.g0)()});return t.data}catch(a){throw a}},async MoveTask(e=new e("agv",1)){return await b("/api/Task/Move",e)},async MeasureTask(e=new e("agv",1)){return await b("/api/Task/Measure",e)},async LoadTask(e=new e("agv",1,1,"CST_ID")){return await b("/api/Task/Load",e)},async UnloadTask(e=new e("agv",1,1,"CST_ID")){return await b("/api/Task/Unload",e)},async CarryTask(e){return await b("/api/Task/Carry",e)},async ChargeTask(e){return await b("/api/Task/Charge",e)},async ExangeBatteryTask(e){return await b("/api/Task/ExangeBattery",e)},async ParkTask(e){return await b("/api/Task/Park",e)}};async function y(e){var t=await c.post("/api/Task/HotRun",e);return t.data}async function V(){var e=await c.get("/api/Task/HotRun");return e.data}async function C(e){var t=await c.get(`/api/Task/HotRun/Start?no=${e}`);return t.data}async function N(e){await c.get(`/api/Task/HotRun/Stop?no=${e}`)}async function b(e,t){var a=`?user=${d.HP.getters.UserName}`;return e+=a,c.post(e,t,{headers:(0,l.g0)()}).then((e=>(console.log("Response:",e.data),{status:e.status,data:e.data}))).catch((e=>(console.error("Error:",e),{status:e.response.status,data:e.response.data,message:e.message})))}},82106:function(e,t,a){"use strict";a.d(t,{FU:function(){return h},HG:function(){return m},hB:function(){return p},jf:function(){return l},l2:function(){return c},m3:function(){return d},mm:function(){return u}});var o=a(56265),n=a.n(o),i=a(663),s=a(90131),r=n().create({baseURL:i.Z.backend_host});async function l(){const e=(0,s.Kt)();var t={};t["Authorization"]=e;var a=await r.get("api/Auth/Users",{headers:t});return a.data}async function d(e){try{var t=await r.post("api/Auth/login",e);return console.info(t),h(t.data),t.data}catch(a){return a.response.data}}async function c(e){const t=(0,s.Kt)();var a={};a["Authorization"]=t;var o=await r.post("api/Auth/modify",e,{headers:a});return o.data}async function m(e){var t=await r.delete(`api/Auth/Delete?user_name=${e}`);return t.data}async function u(e){var t=await r.post("api/Auth/Add",e);return t.data}function h(e){e.LoginTime=Date.now(),localStorage.setItem("user",JSON.stringify(e))}async function p(e,t){var a=await r.get(`api/Auth/UserRouteChange?userID=${e}&current_route=${t}`);return a.data}},60487:function(e,t,a){"use strict";var o=a(663),n=a(53259),i=o.Z.backend_host.replace("http","ws");class s{constructor(e,t){this.wssocket=null,this.closed_actived=!1,this.previousWsState=WebSocket.CLOSED,n.Z.on("/ws_force_close",(()=>{this.Close()})),e.startsWith("/")&&(e=e.substr(1)),this.ws_path=e,this.ws_url=void 0==t?`${i}/${this.ws_path}`:`${t}/${this.ws_path}`}Connect(){const e=new WebSocket(`${this.ws_url}`);e.onerror=e=>{console.info(`Try Connect to : ${this.ws_url} ON ＥＲＲＯＲ FAIL`)},this.wssocket=e}ReconnectWorker(){this.wssocket=new WebSocket(`${this.ws_url}`),this.wssocket.onmessage=this.onmessageHandler,this.wssocket.onclose=this.oncloseHandler,this.wssocket.onopen=this.onopenHandler}Close(){this.closed_actived=!0,clearInterval(this.alive_check_timer),this.wssocket&&this.wssocket.close()}set onerror(e){this.onopenHandler=e,this.wssocket.onerror=e}get onerror(){return this.wssocket.onerror}set onclose(e){this.oncloseHandler=e,this.wssocket.onclose=e}get onclose(){return this.wssocket.onclose}set onopen(e){this.onopenHandler=e,this.wssocket.onopen=e}get onopen(){return this.wssocket.onopen}set onmessage(e){this.onmessageHandler=e,this.wssocket.onmessage=e}get onmessage(){return this.wssocket.onmessage}}t.Z=s},79072:function(e,t,a){"use strict";a.d(t,{Be:function(){return b},DS:function(){return x},Di:function(){return K},Ew:function(){return R},G:function(){return p},H6:function(){return A},HB:function(){return D},K$:function(){return M},P0:function(){return $},Qw:function(){return B},S9:function(){return Q},UY:function(){return Y},Xl:function(){return P},bE:function(){return E},eX:function(){return U},oy:function(){return L},q4:function(){return G},rL:function(){return S},s6:function(){return T},tW:function(){return k},ux:function(){return z},xK:function(){return j}});a(57658);var o=a(88437),n=a(19966),i=a(67339),s=a(7712),r=a(96241),l=a(22205),d=a(17983),c=a(92949),m=a(54404),u=a(1508),h=(a(73153),a(95320));function p(e){var t=h.p.getters.MapData.Points,a=t[e];return a||{}}function g(e){return new o.Z({src:""==e?"/images/eq-icon.png":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"transparent"})}function _(e){return new o.Z({src:""==e?"/images/charging-station.png":e,scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,color:"transparent"})}function v(e){return new o.Z({src:""==e?"/images/rack.png":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"})}function f(e){return new o.Z({src:""==e?"/images/rack_charge_station.png":e,scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,color:"yellow"})}function w(e){return new o.Z({src:""==e?"/images/stk_.jpg":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"})}function y(e){return new o.Z({src:""==e?"/images/lifter_icon.png":e,scale:.35,anchor:[.5,.5],size:[128,128],opacity:1,color:"white"})}const V=new o.Z({src:"/images/location.png",offset:[-25,-5],scale:.5,size:[180,180]}),C=new o.Z({src:"/images/location.png",offset:[-120,-40],scale:.6,size:[300,300]});function N(e={}){var t="orange";const a=new n.Z({color:"black",width:2});if(e){if(!e.Enable)return new i.Z({fill:new s.Z({color:"red"}),stroke:new n.Z({color:"red",width:2}),points:4,radius:10,radius2:0,angle:Math.PI/4});if(t=e.IsVirtualPoint?"grey":"orange",e.IsAvoid)return new i.Z({fill:new s.Z({color:"orange"}),stroke:a,points:3,radius:6,angle:0})}return new r.Z({radius:4,fill:new s.Z({color:t}),stroke:a})}function b(e,t=""){let a=new u.Z({geometry:new c.Z(e)});return a.setStyle(new l.ZP({image:C,text:new d.Z({text:t,font:"bold 18px Calibri,sans-serif",offsetX:-7,offsetY:-82,fill:new s.Z({color:"gold"}),stroke:new n.Z({color:"black",width:2}),backgroundFill:new s.Z({color:"black"})})})),a}function k(e,t=!0,a=""){let o=new u.Z({geometry:new c.Z(e)});return o.setStyle(new l.ZP({image:V,text:new d.Z({text:a,font:"bold 16px Calibri,sans-serif",offsetX:14,offsetY:-22,fill:new s.Z({color:"gold"}),stroke:new n.Z({color:"black",width:2})})})),o}function S(e="",t=0,a){var o=N(a);0==t?o=N(a):1==t?o=g(a.Graph.ImageName):2==t||12==t||22==t?o=w(a.Graph.ImageName):4==t?o=v(a.Graph.ImageName):5==t||6==t?o=f(a.Graph.ImageName):3==t?o=_(a.Graph.ImageName):100!=t&&201!=t||(o=y(a.Graph.ImageName));var i=new l.ZP({image:o,text:new d.Z({text:e,font:"bold 16px Calibri,sans-serif",offsetX:14,offsetY:-22,fill:new s.Z({color:0==t?"gold":"rgb(87, 203, 87)"}),stroke:new n.Z({color:"black",width:2})})});return i}function x(e="red",t=1){const a=[new l.ZP({stroke:new n.Z({color:e,width:t})})];return a}function E(e,t=void 0){var a=h.p.getters.Settings.pathColor,i=(e.get("data"),e.get("isEqLink")),s=e.get("isClose");const r=e.getGeometry(),d=[new l.ZP({stroke:new n.Z({color:s?"red":a,width:2.7,lineDash:i?[4,11]:null})})],m=r.getCoordinates();var u=0;return r.forEachSegment((function(e,t){if(u==m.length-2){const n=t[0]-e[0],r=t[1]-e[1],m=Math.atan2(r,n);if(d.push(new l.ZP({geometry:new c.Z(t),image:new o.Z({src:"arrow.png",anchor:i?[1.8,.5]:[1.2,.5],rotateWithView:!0,rotation:-m,scale:.2,color:s?"red":a})})),s){e=[(t[0]+e[0])/2,(t[1]+e[1])/2];const a=t[0]-e[0],n=t[1]-e[1],i=Math.atan2(n,a);d.push(new l.ZP({geometry:new c.Z(e),image:new o.Z({src:"close.png",anchor:[1.2,.5],rotateWithView:!0,rotation:-i,scale:.6})}))}}u+=1})),d}function T(e,t,a){var o=new U;o.coordination=e,o.index=t,o.station_type=0,o.name=o.index+"",o.tag=o.index,o.graph=e;var n=new z;n.StationType=0,n.X=e[0],n.Y=e[1],n.Graph.X=e[0],n.Graph.Y=e[1],n.Name=n.Graph.Display=o.name,n.TagNumber=o.index,o.data=n;var i=D(o);return i}function D(e=new U){const t=new u.Z({geometry:new c.Z(e.coordination)});t.set("index",e.index),t.set("name",e.name),t.set("station_type",e.station_type),t.set("targets",e.targets),t.set("feature_type","station"),t.set("data",e.data),t.set("coordination",e.coordination),t.set("graph",e.graph);var a=e.name;t.setStyle(S(a,e.station_type,e.data));var o=t.clone();return e.data.Graph&&o.setGeometry(new c.Z([e.data.Graph.X,e.data.Graph.Y])),t.set("routeModeFeature",o),t}function P(e=new U,t=0){var a="coordination"==t?e.coordination:e.graph;const o=new u.Z({geometry:new c.Z(a)});if(o.set("feature_type","lduld"),o.set("data",e.data),o.set("action",0),1!=e.station_type)return o;var i=new l.ZP({image:void 0,text:new d.Z({text:"",font:"bold 12px Calibri,sans-serif",offsetX:14,offsetY:-52,fill:new s.Z({color:"white"}),backgroundFill:new s.Z({color:"seagreen"}),backgroundStroke:new n.Z({color:"black",width:3})})});return o.setStyle(i),o}function A(e="禁制區",t=[],a=1){var o=0==a,i=o?"rgba(255, 0, 0,0.5)":"rgba(116, 249, 42,0.5)",r=o?"red":"seagreen",h=o?"forbid":"passible",p=new u.Z(new m.ZP([t]));p.setStyle(new l.ZP({fill:new s.Z({color:i}),stroke:new n.Z({color:r,width:1})})),p.set("type","polygon"),p.set("name",e),p.set("region_type",h);const g=p.getGeometry().getInteriorPoint().getCoordinates();var _=new u.Z({geometry:new c.Z(g),name:e});return _.set("type","text"),_.set("name",e),_.set("region_type",h),_.setStyle(new l.ZP({text:new d.Z({text:_.get("name"),scale:1.2,fill:new s.Z({color:"black"})})})),{region_feature:p,text_feature:_}}function I(e,t=!1){return t?new o.Z({src:1==e?"images/rack2.png":"images/tray.png",scale:1==e?.6:.8,anchor:1==e?[1.3,.95]:[.8,.65],size:[60,60],opacity:1}):null}function B(e=0,t="",a=!1){return new l.ZP({image:I(e,a),text:new d.Z({text:t,offsetX:-45,offsetY:-35,textAlign:"left",font:"bold 9px Arial",fill:new s.Z({color:"white"}),backgroundFill:new s.Z({color:"grey"})})})}function L(e=new u.Z,t=new F){var a=B(t.cargo_type,t.cst_id,t.exist);e.setStyle(a)}function M(e,t){return new l.ZP({image:new o.Z({src:"/agv.png",scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,rotateWithView:!0,rotation:0*Math.PI/180}),text:new d.Z({text:e,offsetX:0,offsetY:32,font:"bold 16px Arial",fill:new s.Z({color:"white"}),backgroundFill:new s.Z({color:t}),backgroundStroke:new n.Z({color:"black"}),textAlign:"center",padding:[4,4,4,4]})})}function O(e,t=new F){return 0==e?t.exist?"跑貨":"移動":1==e?"取貨":2==e?"放貨停車":3==e?"前進":4==e?"後退":5==e?"Fab?":6==e?"量測":7==e?"放貨":8==e?"充電":9==e?"搬運":10==e?"移出充電站":11==e?"快逃":12==e?"停車":13==e?"離開停車":14==e?"電池交換":15==e?"Hold":16==e?"Break":17==e?"":void 0}class G{constructor(e=1,t=[new R]){this.AGVNum=e,this.AGVDisplays=t}}class R{constructor(e="AGV",t="pink",a=[0,0],o=[],n=new F,i=0,s=0,r=new H,l=0,d=new Z){this.AgvName=e,this.TextColor=t,this.Coordination=a,this.NavPathCoordinationList=o,this.CargoStatus=n,this.Tag=i,this.Theta=s,this.WaitingInfo=r,this.CurrentAction=d.is_executing_task?O(l,n):"",this.AgvStates=d}}class H{constructor(){this.IsWaiting=!1,this.Descrption="",this.WaitingPoint={}}}class F{constructor(e=!1,t=0,a=""){this.exist=e,this.cargo_type=t,this.cst_id=a}}class U{constructor(){this.index=0,this.name="name",this.tag=0,this.station_type=1,this.targets=[],this.coordination=[0,0],this.graph=[0,0],this.data={}}}class Z{constructor(){this.is_online=!1,this.is_executing_task=!1,this.main_status="IDLE"}}class ${constructor(){this.Version=1,this.Name=void 0,this.Options=new q,this.Note="",this.PointIndex=0,this.Map_Image_Size=[400,400],this.Map_Image_Boundary=[-20,-20,20,20],this.Points={},this.BezierCurves={},this.Pathes=[],this.Segments=[],this.Bays={},this.Regions=[new Q]}}class q{constructor(){this.pathColor="rgb(45,42,46)",this.fontSizeOfDisplayName=12,this.fontSizeOfAsCandicates=16,this.EQIcons=[]}}class z{constructor(){this.X=0,this.Y=0,this.Name="",this.TagNumber=0,this.Direction=0,this.Direction_Secondary_Point=0,this.AGV_Alarm=!1,this.Enable=!0,this.IsStandbyPoint=!1,this.IsSegment=!1,this.IsOverlap=!1,this.IsParking=!1,this.IsAvoid=!1,this.IsVirtualPoint=!1,this.IsAutoDoor=!1,this.IsExtinguishing=!1,this.InvolvePoint="",this.StationType=0,this.LsrMode=0,this.Speed=1,this.Bay="",this.Graph={Display:"",X:0,Y:0,ImageName:"",IsBezierCurvePoint:!1,BezierCurveID:""},this.Target={},this.DodgeMode=0,this.SpinMode=0,this.SubMap="",this.AutoDoor={KeyName:"",KeyPassword:""},this.MotionInfo={ControlBypass:{GroundHoleCCD:"",GroundHoleSensor:"",UltrasonicSensor:""}},this.Region="",this.IsCharge=!1,this.IsEquipment=!1,this.IsSTK=!1,this.IsEQLink=!1,this.IsCross=!1,this.IsRegisted=!1,this.RegistInfo=null}}class Q{constructor(e,t,a=1){this.Name=e,this.PolygonCoordinations=t,this.RegionType=a}}class j{constructor(){this.title="title",this.backgroundColor="white",this.feature_type="Station",this.point_data=new z,this.show_task_dispatch=!1,this.task_options=new Y}}class Y{constructor(e){this.StationType=e}}class K{constructor(e=0,t="",a=""){this.tag=e,this.name=t,this.name_display=a}}},95320:function(e,t,a){"use strict";a.d(t,{p:function(){return r}});a(57658);var o=a(20065),n=a(56265),i=a.n(n),s=a(79072);const r=(0,o.MT)({state:{MapData:new s.P0,MapGeoJson:null,AGVDynamicPathInfo:void 0,ControledPathesBySystem:{},AGVLocUpload:{},agv_colors:["rgb(13, 110, 253)","limegreen","orange","pink","red","purple"],RegionOptions:null,Settings:{path_color:"red"},worker:new Worker(""),mapBackendServer:`${window.location.protocol}//${window.location.host}`},getters:{MapBackednAxios:e=>{var t=i().create({baseURL:e.mapBackendServer});return t},MapData:e=>{var t=localStorage.getItem("mapData");return null==e.MapData&&t?JSON.parse(t):e.MapData},Map_Image_Size:e=>e.MapData.Map_Image_Size,Map_Image_Boundary:e=>e.MapData.Map_Image_Boundary,Pathes:e=>e.MapData.Segments,MapName:e=>null==e.MapData?"Unkown":e.MapData.Name,Settings:e=>e.MapData.Options,BezierCurves:e=>null==e.MapData?{}:e.MapData.BezierCurves,GeoMapData:e=>e.MapGeoJson,MapServerUrl:e=>e.mapBackendServer,MapStations:(e,t)=>{var a=e.MapData;if(!a)return[];var o=a.Points;if(!o)return[];var n=Object.keys(o),i=[];return n.forEach((e=>{var t=o[e],a=new s.eX;a.index=parseInt(e),a.name=t.Name,a.station_type=t.StationType,a.tag=t.TagNumber,a.coordination=[t.X,t.Y],a.targets=[],a.graph=[t.Graph.X,t.Graph.Y],a.data=t,Object.keys(t.Target).forEach((e=>{a.targets.push(parseInt(e))})),i.push(a)})),i},BaysData:e=>e.MapData?e.MapData.Bays:{},Regions:e=>e.MapData.Regions?e.MapData.Regions:[],AGVDynamicPathInfo:e=>e.AGVDynamicPathInfo,AGVLocUpload:e=>e.AGVLocUpload,AGVNavInfo:(e,t)=>{var a=e.AGVDynamicPathInfo;if(void 0==a)return new s.q4(0,[]);var o=Object.keys(a).length,n=[],i=0;Object.keys(a).forEach((o=>{var r=a[o],l=r.nav_path,d=[];l&&l.forEach((e=>{var a=t.MapStations.find((t=>t.tag==e));a&&d.push(a.coordination)}));var c=[0,0];r.currentCoordication&&(c=[r.currentCoordication.X,r.currentCoordication.Y]),n.push(new s.Ew(o,e.agv_colors[i],c,d,r.cargo_status,r.currentLocation,r.theta,r.waiting_info,r.currentAction,r.states)),i+=1}));var r=new s.q4(o,n);return r},AllNormalStationOptions:e=>{var t=Object.values(e.MapData.Points);t=t.filter((e=>!e.IsVirtualPoint&&0==e.StationType)).map((e=>new s.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return t},AllEqStation:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(1==e.StationType||4==e.StationType))).map((e=>new s.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllChargeStation:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(3==e.StationType||5==e.StationType||6==e.StationType))).map((e=>new s.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllExangeBatteryStation:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(16==e.StationType||3==e.StationType))).map((e=>new s.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllParkingStationOptions:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&1==e.IsParking)).map((e=>new s.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllPointsOptions:e=>{var t=[],a=e.MapData.Points,o=Object.keys(a);return o.forEach((e=>{var o=a[e];t.push({index:e,tag:o.TagNumber,name:o.Graph.Display})})),t},ControledPathesBySystem:e=>e.ControledPathesBySystem,RegionOptions:e=>e.RegionOptions,EqIcons:e=>e.MapData.Options.EQIcons},mutations:{setMapData(e,t){e.MapData=t,localStorage.setItem("mapData",JSON.stringify(t))},setGeoMapData(e,t){e.MapGeoJson=t},setAGVDynamicPathInfo(e,t){e.AGVDynamicPathInfo=t},setAGVLocUpload(e,t){e.AGVLocUpload=t},setWorker(e,t){e.worker=t},setControledPathesBySystem(e,t){e.ControledPathesBySystem=t},RegionOptions(e,t){e.RegionOptions=t}},actions:{async DownloadMapData({commit:e,getters:t}){await t.MapBackednAxios.get("api/Map").then((t=>{console.log("[MapStore] get map data",t.data),e("setMapData",t.data)}))},Save({commit:e}){},GetMapPointByIndex({commit:e,state:t},a){var o=t.MapData.Points;return o[a]},GetMapPointByTag({commit:e,state:t},a){var o=t.MapData.Points;return Object.values(o).find((e=>e.TagNumber+""==a+""))},SaveMap({commit:e,state:t,actions:a,getters:o},n){return o.MapBackednAxios.post("api/Map/SaveMap",n).then((t=>(n.Note=t.data,e("setMapData",n),!0))).catch((e=>!1))},UploadCoorFunctionSwitch({commit:e,state:t,getters:a},o){if(a.MapBackednAxios.get(`api/Map/SwitchAGVUploadLocFun?enabled=${o}`),o){const t=new Worker("websocket_worker.js");t.onmessage=t=>{"error"!=t.data&&"closed"!=t.data&&e("setAGVLocUpload",t.data)},t.postMessage({command:"connect",ws_url:a.MapServerUrl.replace("http","ws")+"/ws/AGVLocationUpload"}),e("setWorker",t)}else t.worker.postMessage({command:"disconnect"})},DeleteIcon({commit:e,state:t,getters:a,actions:o},n){a.MapBackednAxios.delete(`api/Map/DeleteIcon?filePath=${n}`)},GetRegionByName({state:e,getters:t},a){var o=t.Regions;return o.find((e=>e.Name==a))}}})},53259:function(e,t,a){"use strict";var o=a(1373);const n=(0,o.Z)();t.Z=n},663:function(e,t,a){"use strict";var o={type:"jw",get backend_host(){return`${window.location.protocol}//${window.location.host}`},get backend_ws_host(){return this.backend_host.replace("http","ws")},get vms_host(){return this.backend_host.replace("5216","5036")},get vms_ws_host(){return this.vms_host.replace("http","ws")}};t.Z=o},4239:function(e,t,a){"use strict";var o=a(79003);const n={class:"d-flex flex-row","element-loading-text":"GPM AGVS","element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(31, 31, 31, 0.9)"};function i(e,t,a,i,s,r){const l=(0,o.resolveComponent)("Header"),d=(0,o.resolveComponent)("SideMenu"),c=(0,o.resolveComponent)("router-view"),m=(0,o.resolveComponent)("b-modal"),u=(0,o.resolveComponent)("MoveAGVNotifty"),h=(0,o.resolveComponent)("ConnectionState"),p=(0,o.resolveComponent)("SideMenuDrawer"),g=(0,o.resolveDirective)("loading");return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("div",n,[(0,o.createElementVNode)("div",null,[(0,o.withDirectives)((0,o.createVNode)(l,{onOnMenuToggleClicked:r.ToggleMenu},null,8,["onOnMenuToggleClicked"]),[[o.vShow,!s.loading]])]),(0,o.createVNode)(d),(0,o.createElementVNode)("div",{class:"flex-fill",style:(0,o.normalizeStyle)(s.router_view_style)},[(0,o.withDirectives)((0,o.createVNode)(c,null,{default:(0,o.withCtx)((({Component:e})=>[((0,o.openBlock)(),(0,o.createBlock)(o.KeepAlive,null,[((0,o.openBlock)(),(0,o.createBlock)((0,o.resolveDynamicComponent)(e)))],1024))])),_:1},512),[[o.vShow,!s.loading]])],4),(0,o.createVNode)(m,{modelValue:s.ShowOKOnlyModal,"onUpdate:modelValue":t[0]||(t[0]=e=>s.ShowOKOnlyModal=e),title:`${s.okOnlyModalProps.title}`,centered:!0,okOnly:!0,headerBgVariant:s.okOnlyModalProps.title_variant,headerTextVariant:"light"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("p",null,(0,o.toDisplayString)(s.okOnlyModalProps.content),1)])),_:1},8,["modelValue","title","headerBgVariant"]),(0,o.createVNode)(u),(0,o.createVNode)(h)])),[[o.vShow,!s.isNoPermission],[g,s.loading]]),(0,o.createVNode)(p,{onClose:r.SideMenuCloseHandler,ref:"side_menu"},null,8,["onClose"])],64)}const s=e=>((0,o.pushScopeId)("data-v-07bba205"),e=e(),(0,o.popScopeId)(),e),r={class:"side-menu"},l={class:"text-start"},d=s((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"},null,-1))),c=s((()=>(0,o.createElementVNode)("span",null,"Home",-1))),m=s((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"},null,-1))),u=s((()=>(0,o.createElementVNode)("span",null,"Rack",-1))),h=s((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"},null,-1))),p=s((()=>(0,o.createElementVNode)("span",null,"Map",-1))),g=s((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"},null,-1))),_=s((()=>(0,o.createElementVNode)("span",null,"Data",-1))),v=s((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"},null,-1))),f=s((()=>(0,o.createElementVNode)("span",null,"Alarm",-1))),w=s((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"},null,-1))),y=s((()=>(0,o.createElementVNode)("span",null,"SETTINGS",-1))),V=s((()=>(0,o.createElementVNode)("div",{class:"bottom"},[(0,o.createElementVNode)("img",{src:"GPM_Logo.png",width:"220",alt:"GPM"})],-1)));function C(e,t,a,n,i,s){const C=(0,o.resolveComponent)("el-drawer");return(0,o.openBlock)(),(0,o.createElementBlock)("div",r,[(0,o.createVNode)(C,{modelValue:i.show_draw,"onUpdate:modelValue":t[6]||(t[6]=e=>i.show_draw=e),direction:"ltr",title:"GPM AGVS",size:"18%",onClose:s.CLoseEventHandle},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>s.PageSwitch("/","Home")),class:"menu-item-container"},[d,(0,o.createTextVNode)("主頁 "),c]),(0,o.createElementVNode)("div",{onClick:t[1]||(t[1]=e=>s.PageSwitch("/racks_status","帳籍管理")),class:"menu-item-container"},[m,(0,o.createTextVNode)("帳籍管理 "),u]),(0,o.withDirectives)((0,o.createElementVNode)("div",{onClick:t[2]||(t[2]=e=>s.PageSwitch("/map","圖資管理")),class:"menu-item-container"},[h,(0,o.createTextVNode)("圖資管理 "),p],512),[[o.vShow,s.IsUserLogin]]),(0,o.createElementVNode)("div",{onClick:t[3]||(t[3]=e=>s.PageSwitch("/data","資料")),class:"menu-item-container"},[g,(0,o.createTextVNode)("資料 "),_]),(0,o.createElementVNode)("div",{onClick:t[4]||(t[4]=e=>s.PageSwitch("/alarm","警報")),class:"menu-item-container"},[v,(0,o.createTextVNode)("警報 "),f]),(0,o.withDirectives)((0,o.createElementVNode)("div",{onClick:t[5]||(t[5]=e=>s.PageSwitch("/sys_settings","系統設定")),class:"menu-item-container"},[w,(0,o.createTextVNode)("設定 "),y],512),[[o.vShow,s.IsUserLogin]])]),V])),_:1},8,["modelValue","onClose"])])}a(57658);var N=a(53259),b=a(24239),k={data(){return{show_draw:!1}},computed:{IsUserLogin(){return b.HP.getters.IsLogin}},methods:{Show(){N.Z.emit("/alarm_footer_send_to_back",!0),this.show_draw=!0},CLoseEventHandle(){this.$emit("close",""),N.Z.emit("/alarm_footer_send_to_back",!1)},PageSwitch(e,t=""){var a=this.$router.currentRoute.value.path;e!=a&&setTimeout((()=>{this.$router.push(e),N.Z.emit("/router-change",{route_display_name:t,route_name:e})}),100),this.show_draw=!1}},mounted(){}},S=a(40089);const x=(0,S.Z)(k,[["render",C],["__scopeId","data-v-07bba205"]]);var E=x;const T=e=>((0,o.pushScopeId)("data-v-689b0418"),e=e(),(0,o.popScopeId)(),e),D={class:"side-menu-fixed fixed-left"},P={class:""},A=T((()=>(0,o.createElementVNode)("div",{class:"logo-text"},[(0,o.createTextVNode)(" GPM "),(0,o.createElementVNode)("div",{class:"log-sub-text"},"AGVS")],-1))),I=[A],B={class:"menu-icon round"},L=["height"],M={class:"menu-icon round"},O=["height"],G={class:"menu-icon round"},R=["height"],H={class:"menu-icon round"},F=["height"],U={class:"menu-icon round"},Z=["height"],$={class:"menu-icon round"},q=["height"];function z(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-tooltip");return(0,o.openBlock)(),(0,o.createElementBlock)("div",D,[(0,o.createElementVNode)("div",P,[(0,o.createVNode)(r,{placement:"right",content:"Home"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",{class:"side-item",onClick:t[0]||(t[0]=e=>s.PageSwitch("/","派車系統"))},I)])),_:1}),(0,o.createVNode)(r,{placement:"right",content:"Home"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",{style:(0,o.normalizeStyle)(s.Selected("/")),class:"side-item",onClick:t[1]||(t[1]=e=>s.PageSwitch("/","派車系統"))},[(0,o.createElementVNode)("div",B,[(0,o.createElementVNode)("img",{src:"images/home.png",height:i.icon_size,alt:""},null,8,L)])],4)])),_:1}),(0,o.createVNode)(r,{placement:"right",content:"系統警報"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",{style:(0,o.normalizeStyle)(s.Selected("/alarm")),class:"side-item",onClick:t[2]||(t[2]=e=>s.PageSwitch("/alarm","系統警報"))},[(0,o.createElementVNode)("div",M,[(0,o.createElementVNode)("img",{src:"images/alarm.png",height:i.icon_size,alt:""},null,8,O)])],4)])),_:1}),(0,o.createVNode)(r,{placement:"right",content:"帳籍管理"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",{style:(0,o.normalizeStyle)(s.Selected("/racks_status")),class:"side-item",onClick:t[3]||(t[3]=e=>s.PageSwitch("/racks_status","帳籍管理"))},[(0,o.createElementVNode)("div",G,[(0,o.createElementVNode)("img",{src:"images/rack.png",height:i.icon_size,alt:""},null,8,R)])],4)])),_:1}),(0,o.createVNode)(r,{placement:"right",content:"圖資管理"},{default:(0,o.withCtx)((()=>[(0,o.withDirectives)((0,o.createElementVNode)("div",{style:(0,o.normalizeStyle)(s.Selected("/map")),class:"side-item",onClick:t[4]||(t[4]=e=>s.PageSwitch("/map","圖資管理"))},[(0,o.createElementVNode)("div",H,[(0,o.createElementVNode)("img",{src:"images/map.png",height:i.icon_size,alt:""},null,8,F)])],4),[[o.vShow,s.IsUserLogin]])])),_:1}),(0,o.createVNode)(r,{placement:"right",content:"資料查詢"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",{style:(0,o.normalizeStyle)(s.Selected("/data")),class:"side-item",onClick:t[5]||(t[5]=e=>s.PageSwitch("/data","資料查詢"))},[(0,o.createElementVNode)("div",U,[(0,o.createElementVNode)("img",{src:"images/database.png",height:i.icon_size,alt:""},null,8,Z)])],4)])),_:1}),(0,o.createVNode)(r,{placement:"right",content:"系統設定"},{default:(0,o.withCtx)((()=>[(0,o.withDirectives)((0,o.createElementVNode)("div",{style:(0,o.normalizeStyle)(s.Selected("/sys_settings")),class:"side-item",onClick:t[6]||(t[6]=e=>s.PageSwitch("/sys_settings","系統設定"))},[(0,o.createElementVNode)("div",$,[(0,o.createElementVNode)("img",{src:"images/settings.png",height:i.icon_size,alt:""},null,8,q)])],4),[[o.vShow,s.IsUserLogin]])])),_:1})])])}var Q=a(22483),j={data(){return{icon_size:35,active_item:"/"}},computed:{IsUserLogin(){return b.HP.getters.IsLogin}},methods:{CLoseEventHandle(){this.$emit("close",""),N.Z.emit("/alarm_footer_send_to_back",!1)},PageSwitch(e,t=""){var a=this.$router.currentRoute.value.path;e!=a&&setTimeout((()=>{this.$router.push(e),N.Z.emit("/router-change",{route_display_name:t,route_name:e})}),100)},Selected(e){return{backgroundColor:this.active_item==e?"rgb(13, 110, 253)":""}}},mounted(){const e=(0,Q.yj)();(0,o.watch)((()=>e.path),((e,t)=>{this.active_item=e}))}};const Y=(0,S.Z)(j,[["render",z],["__scopeId","data-v-689b0418"]]);var K=Y;const W=e=>((0,o.pushScopeId)("data-v-4c7b52f8"),e=e(),(0,o.popScopeId)(),e),J={class:"app-header bg-primary text-light border-bottom border-left fixed-top"},X={class:"d-flex flex-row py-1"},ee={key:0,class:"matain-mode-notify py-2 px-3"},te={class:"page-name-display mx-2"},ae=W((()=>(0,o.createElementVNode)("div",{class:"flex-fill"},null,-1))),oe={class:"options d-flex justify-content-between"},ne=W((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical pt-2"},null,-1))),ie={class:"mx-1"},se={class:"op-mode-switch-container"},re=W((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"檢視模式",-1))),le=W((()=>(0,o.createElementVNode)("i",{class:"bi bi-caret-down-fill"},null,-1))),de={class:"d-flex flex-column"},ce={key:0,class:"bi bi-caret-down-fill"},me={class:"d-flex flex-column"},ue={class:"alarm text-dark"},he={class:"flex-fill"},pe=W((()=>(0,o.createElementVNode)("span",{class:"type-text"}," 系統警報 ",-1))),ge={class:"alarm-text"},_e={class:"opt"},ve={class:"flex-fill"},fe=W((()=>(0,o.createElementVNode)("span",{class:"type-text"}," 設備警報 ",-1))),we={class:"alarm-text"},ye={class:"opt"};function Ve(e,t,a,n,i,s){const r=(0,o.resolveComponent)("b-button"),l=(0,o.resolveComponent)("el-switch"),d=(0,o.resolveComponent)("el-popover"),c=(0,o.resolveComponent)("Login");return(0,o.openBlock)(),(0,o.createElementBlock)("div",J,[(0,o.createElementVNode)("div",X,[i.modes.system_operation_mode.actived?((0,o.openBlock)(),(0,o.createBlock)(r,{key:1,class:"mx-2",onClick:s.HandleAutoDispatchBtnClick,style:{width:"100px","font-weight":"bold","font-size":"large","text-decoration":"underline"},variant:"light",size:"sm"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("自動派工")])),_:1},8,["onClick"])):((0,o.openBlock)(),(0,o.createElementBlock)("div",ee,"維護模式:自動派車、充電功能已關閉。")),(0,o.createElementVNode)("div",te,(0,o.toDisplayString)(i.current_route_info.route_display_name),1),ae,(0,o.createElementVNode)("div",oe,[ne,((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(i.modes,((e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{class:"op-mode-switch-container",key:t},[(0,o.createElementVNode)("span",ie,(0,o.toDisplayString)(e.name),1),(0,o.createVNode)(l,{modelValue:e.actived,"onUpdate:modelValue":t=>e.actived=t,"active-color":"rgb(95, 171, 80)","inactive-color":"red","active-text":e.active_text,"inactive-text":e.inactive_text,"border-color":"grey","inline-prompt":"","before-change":e.beforeChangeHandler,loading:e.loading,size:"large",width:"75px"},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text","before-change","loading"])])))),128)),(0,o.createElementVNode)("div",se,[re,(0,o.createVNode)(l,{modelValue:i.isEasyMode,"onUpdate:modelValue":t[0]||(t[0]=e=>i.isEasyMode=e),onChange:s.HandleViewModeChanged,"before-change":s.CheckUserLoginState,"active-color":"rgb(95, 171, 80)","inactive-color":"red","active-text":"簡易模式","inactive-text":"工程模式","border-color":"grey","inline-prompt":"",size:"large",width:"80px"},null,8,["modelValue","onChange","before-change"])]),(0,o.createElementVNode)("div",null,[(0,o.createVNode)(d,{placement:"top",title:"",width:"",trigger:"hover",content:"","popper-class":"bg-light"},{reference:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{size:"sm",class:"mx-1",variant:"light"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 中文 "),le])),_:1})])),default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",de,[(0,o.createVNode)(r,{onClick:t[1]||(t[1]=e=>s.LangSwitch("zh-TW")),variant:"light"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("中文")])),_:1}),(0,o.createVNode)(r,{onClick:t[2]||(t[2]=e=>s.LangSwitch("en-US")),variant:"light"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("ENGLISH")])),_:1})])])),_:1})]),(0,o.createElementVNode)("div",{onClick:t[4]||(t[4]=(...e)=>s.LoginClickHandler&&s.LoginClickHandler(...e))},[(0,o.createVNode)(d,{placement:"top",title:"",width:"",trigger:"hover",content:"","popper-class":"bg-light"},{reference:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{size:"sm",variant:"light"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(s.UserName)+" ",1),s.IsLogin?((0,o.openBlock)(),(0,o.createElementBlock)("i",ce)):(0,o.createCommentVNode)("",!0)])),_:1})])),default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",me,[s.IsLogin?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(r,{key:0,onClick:s.LoginClickHandler,variant:"light"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("登入")])),_:1},8,["onClick"])),s.IsLogin?((0,o.openBlock)(),(0,o.createBlock)(r,{key:1,onClick:s.LogoutQickly,variant:"danger"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("登出")])),_:1},8,["onClick"])):(0,o.createCommentVNode)("",!0),s.IsLogin?((0,o.openBlock)(),(0,o.createBlock)(r,{key:2,class:"my-1 bg-light text-dark",onClick:t[3]||(t[3]=e=>s.LoginClickHandler("switch"))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("切換使用者")])),_:1})):(0,o.createCommentVNode)("",!0)])])),_:1})])]),(0,o.createVNode)(c,{ref:"login",IsLogin:s.IsLogin},null,8,["IsLogin"])]),(0,o.withDirectives)((0,o.createElementVNode)("div",ue,[(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["alarm-container",i.system_alarms])},[(0,o.createElementVNode)("div",he,[pe,(0,o.createElementVNode)("span",ge,(0,o.toDisplayString)(i.system_alrm_text),1)]),(0,o.createElementVNode)("div",_e,[(0,o.createElementVNode)("div",null,[0!=s.current_user_role?((0,o.openBlock)(),(0,o.createBlock)(r,{key:0,onClick:s.ResetSysAlarmsHandler,class:"mb-2",size:"sm",variant:"danger"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("警報復歸")])),_:1},8,["onClick"])):(0,o.createCommentVNode)("",!0)]),(0,o.createElementVNode)("i",{class:"bi bi-clock-history",onClick:t[5]||(t[5]=(...e)=>s.NavigateToAlarmView&&s.NavigateToAlarmView(...e))})])],2),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["alarm-container",i.equipment_alarms])},[(0,o.createElementVNode)("div",ve,[fe,(0,o.createElementVNode)("span",we,(0,o.toDisplayString)(i.eq_alrm_text),1)]),(0,o.createElementVNode)("div",ye,[(0,o.createElementVNode)("div",null,[(0,o.createCommentVNode)("",!0)]),(0,o.createElementVNode)("i",{class:"bi bi-clock-history",onClick:t[6]||(t[6]=(...e)=>s.NavigateToAlarmView&&s.NavigateToAlarmView(...e))})])],2)],512),[[o.vShow,i.showAlarm]])])}const Ce={class:"login-header"},Ne=["id"],be={class:"login-content"},ke={class:"login-message"};function Se(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-divider"),l=(0,o.resolveComponent)("b-form-input"),d=(0,o.resolveComponent)("el-form-item"),c=(0,o.resolveComponent)("b-button"),m=(0,o.resolveComponent)("el-form"),u=(0,o.resolveComponent)("el-dialog");return(0,o.openBlock)(),(0,o.createBlock)(u,{modelValue:i.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>i.dialogVisible=e),"show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,modal:!0,draggable:"",width:"400",style:{"z-index":"9900"}},{header:(0,o.withCtx)((({titleId:e,login_title:t})=>[(0,o.createElementVNode)("div",Ce,[(0,o.createElementVNode)("h3",{id:e,class:(0,o.normalizeClass)(t)},"使用者登入",10,Ne),(0,o.createVNode)(r)])])),default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",be,[(0,o.createVNode)(m,{"label-position":"top"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{label:"Username",required:!0},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{autofocus:"",autocomplete:"new-password",disabled:s.IsLogin,ref:"account",onKeyup:[(0,o.withKeys)(s.FocusPasswordInput,["enter"]),(0,o.withKeys)(s.FocusPasswordInput,["down"]),t[0]||(t[0]=(0,o.withKeys)((e=>i.UserName=""),["esc"]))],modelValue:i.UserName,"onUpdate:modelValue":t[1]||(t[1]=e=>i.UserName=e),state:""!=i.UserName,placeholder:"請輸入帳號",required:""},null,8,["disabled","onKeyup","modelValue","state"])])),_:1}),(0,o.createVNode)(d,{label:"Password",required:!0},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{autocomplete:"new-password",type:"password",disabled:s.IsLogin,ref:"pw_input",onKeyup:[(0,o.withKeys)(s.PasswordEnterClickHandler,["enter"]),(0,o.withKeys)(s.FocusAccountInput,["up"]),t[2]||(t[2]=(0,o.withKeys)((e=>i.Password=""),["esc"]))],modelValue:i.Password,"onUpdate:modelValue":t[3]||(t[3]=e=>i.Password=e),state:""!=i.Password,placeholder:"請輸入密碼",required:""},null,8,["disabled","onKeyup","modelValue","state"])])),_:1}),s.IsLogin?((0,o.openBlock)(),(0,o.createBlock)(d,{key:0},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{onClick:t[4]||(t[4]=e=>s.LogoutHandle()),loading:i.logouting,class:"w-100",variant:"danger"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Logout")])),_:1},8,["loading"])])),_:1})):(0,o.createCommentVNode)("",!0),s.IsLogin?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(d,{key:1},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{onClick:t[5]||(t[5]=e=>s.LoginHandle()),loading:i.logining,class:"w-100",variant:"primary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Login")])),_:1},8,["loading"])])),_:1})),(0,o.createVNode)(d,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{onClick:t[6]||(t[6]=e=>i.dialogVisible=!1),class:"w-100"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Cancel")])),_:1})])),_:1})])),_:1}),(0,o.createElementVNode)("div",ke,(0,o.toDisplayString)(i.message),1)])])),_:1},8,["modelValue"])}function xe(e,t,a,n,i,s){return(0,o.openBlock)(),(0,o.createElementBlock)("div",{class:(0,o.normalizeClass)(a.keyboardClass)},null,2)}var Ee=a(5179),Te=a.n(Ee),De={name:"SimpleKeyboard",props:{keyboardClass:{default:"simple-keyboard",type:String},input:{type:String}},data:()=>({keyboard:null}),mounted(){this.keyboard=new(Te())(this.keyboardClass,{onChange:this.onChange,onKeyPress:this.onKeyPress})},methods:{onChange(e){this.$emit("onChange",e)},onKeyPress(e){this.$emit("onKeyPress",e),"{shift}"!==e&&"{lock}"!==e||this.handleShift()},handleShift(){let e=this.keyboard.options.layoutName,t="default"===e?"shift":"default";this.keyboard.setOptions({layoutName:t})}},watch:{input(e){this.keyboard.setInput(e)}}};const Pe=(0,S.Z)(De,[["render",xe]]);var Ae=Pe,Ie=a(90131),Be={components:{KeyBoard:Ae},data(){return{dialogVisible:!1,UserName:"",Password:"",focus_input:"account",keyboard_input:"",message:"",logining:!1,logouting:!1,ShowLogoutDialog:!1}},computed:{IsLogin(){return b.HP.getters.IsLogin}},methods:{FocusPasswordInput(){this.$refs["pw_input"].focus()},FocusAccountInput(){this.$refs["account"].focus()},PasswordEnterClickHandler(){this.LoginHandle()},Show(e="/"){this.current_route=e,this.IsLogin?(this.UserName=b.HP.getters.UserName,this.Password="********************"):this.message=this.UserName=this.Password="",this.dialogVisible=!0},async LoginHandle(){return""==this.UserName?(this.message="請輸入 Account",void this.FocusAccountInput()):""==this.Password?(this.message="請輸入 Passowrd",void this.FocusPasswordInput()):(this.logining=!0,void setTimeout((async()=>{const e={Username:this.UserName,Password:this.Password};var t=await b.HP.dispatch("login",e);void 0!=t&&(t.confirm?(this.dialogVisible=!1,this.$swal.fire({title:"登入成功!",icon:"success",timer:3e3})):this.message=t.message),this.logining=!1}),10))},LogoutHandle(){this.logouting=!0,setTimeout((()=>{(0,Ie.yK)(),b.HP.commit("setUser",null),N.Z.emit("/logout",void 0),this.$emit("RoleChanged",0),this.UserName=this.Password="",this.$swal.fire({title:"登出成功!",icon:"success",timer:3e3}),setTimeout((()=>{this.$route.meta.isAdminUse&&this.$router.push("/")}),1e3),this.logouting=!1}),100)},OnInputFocus(e){this.focus_input=e,"account"==this.focus_input?this.keyboard_input=this.UserName+"":this.keyboard_input=this.Password+""},onChange(e){this.message="",console.log(e),this.keyboard_input=e,"account"==this.focus_input?this.UserName=e:(this.$refs.pw_input.focus(),this.Password=e,this.$refs.pw_input.focus())}}};const Le=(0,S.Z)(Be,[["render",Se],["__scopeId","data-v-b9c8e9c6"]]);var Me=Le,Oe=a(56265),Ge=a.n(Oe),Re=a(663),He=Ge().create({baseURL:Re.Z.backend_host});async function Fe(){var e=await He.get("api/System/WebSite");return e.data}async function Ue(e=1){var t=await He.get("api/system/OperationStates");return t.data}async function Ze(e=1,t=!1){var a=await He.post(`api/system/runmode?mode=${e}&forecing_change=${t}`);return a.data}async function $e(e=1){var t=await He.post(`api/system/hostconn?mode=${e}`);return t.data}async function qe(e=1){var t=await He.post(`api/system/hostoperation?mode=${e}`);return t.data}async function ze(e=1){var t=await He.post(`api/system/TransferMode?mode=${e}`);return t.data}var Qe=a(61623),je=a(36797),Ye=a.n(je),Ke={components:{Login:Me},data(){return{current_route_info:{route_display_name:"派車系統",route_name:"/"},maintain_mode:!0,modes:{system_operation_mode:{name:"操作模式",actived:!1,active_text:"運轉",inactive_text:"維護",loading:!1,beforeChangeHandler:this.SysOptModeChangeRequest},transfer_mode:{name:"派工模式",enabled:!1,active_text:"自動",inactive_text:"手動",loading:!1,beforeChangeHandler:this.TransferModeChangeRequest},host_conn_mode:{name:"HOST連線",enabled:!1,active_text:"Online",inactive_text:"Offline",loading:!1,beforeChangeHandler:this.HostConnModeChangeRequest},host_operation_mode:{name:"HOST模式",enabled:!1,active_text:"Remote",inactive_text:"Local",loading:!1,beforeChangeHandler:this.HostOptModeChangeRequest}},system_alarms:[""],equipment_alarms:[""],system_alrm_text:"",eq_alrm_text:"",unchecked_alarms:[],showAlarm:!0,isEasyMode:!1}},computed:{IsLogin(){return b.HP.getters.IsLogin},current_user_role(){return b.HP.getters.level},UserName(){var e=b.HP.getters.level,t=b.HP.getters.UserName.toUpperCase();return-1==e?"訪客":0==e?`${t}(OP)`:1==e?`${t}(ENG)`:2==e?`${t}(DEV)`:3==e?`${t}(GOD)`:"VISITOR"},SystemAlarms(){return this.unchecked_alarms?this.unchecked_alarms.filter((e=>0==e.Source)):[]},EquipmentAlarms(){return this.unchecked_alarms?this.unchecked_alarms.filter((e=>1==e.Source)):[]}},mounted(){this.DownloadSystemOperationsSettings(),N.Z.on("/router-change",(e=>{this.current_route_info=e})),N.Z.on("/show-login-view-invoke",(()=>{this.LoginClickHandler()}));const e=(0,Q.yj)();(0,o.watch)((()=>e.path),((e,t)=>{this.showAlarm="/alarm"!=e&&"/map"!=e&&"/sys_settings"!=e&&"/data"!=e}));new Qe.yy(this.on_alarm_message);this.AlarmDisplayHandler()},methods:{HandleAutoDispatchBtnClick(){b.HP.getters.IsLogin?N.Z.emit("bus-show-task-allocation",{agv_name:"",agv_type:"",action:"",station_data:void 0}):this.$swal.fire({text:"",title:"權限不足 請先登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async DownloadSystemOperationsSettings(e=1e3){setTimeout((async()=>{var e=await Ue();b.cy.commit("setOperations",e),this.modes.system_operation_mode.actived=1==e.system_run_mode,this.modes.host_conn_mode.actived=1==e.host_online_mode,this.modes.host_operation_mode.actived=1==e.host_remote_mode,this.modes.transfer_mode.actived=1==e.transfer_mode}),e)},on_alarm_message(e){this.unchecked_alarms=JSON.parse(e.data)},ToggleMenu(){this.$emit("onMenuToggleClicked","")},LogoClickHandler(){this.$router.push("/"),this.current_route_info={route_display_name:"Home",route_name:"/"}},LoginClickHandler(e=""){!this.IsLogin|"switch"==e&&this.$refs["login"].Show(this.current_route_info.route_name)},LogoutQickly(){this.$swal.fire({title:"Logout!",text:"確定要登出?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes"}).then((e=>{e.isConfirmed&&(b.HP.commit("setUser",null),this.$route.meta.isAdminUse&&this.$router.push("/"),this.$swal.fire({title:"登出成功!",icon:"success",timer:3e3}))}))},async TransferModeChangeRequest(){if(!this.CheckUserLoginState())return!1;var e=await ze(this.modes.transfer_mode.actived?0:1),t=e.confirm,a="搬運模式切換";return t?(this.ModeRequestSuccessHandler(a),b.cy.commit("setTransferRemote",!this.modes.transfer_mode.actived)):this.ModeRequestFailHandler("搬運模式","搬運模式切換"),t},HandleViewModeChanged(e){N.Z.emit("view_mode_changed",e)},async SysOptModeChangeRequest(e=!1){if(!this.CheckUserLoginState())return!1;this.modes.system_operation_mode.loading=!0;var t=this.modes.system_operation_mode.actived?"操作模式-MAINTAIN":"操作模式-RUN",a=await Ze(this.modes.system_operation_mode.actived?0:1,e),o=a.confirm,n=a.message;if(o)b.cy.commit("setRunMode",!this.modes.system_operation_mode.actived),this.ModeRequestSuccessHandler(t);else{var i=2==b.HP.getters.level||3==b.HP.getters.level;this.ModeRequestFailHandler("操作模式",n,"尚有任務在執行中"==n&&i?"強制切換":"",(async()=>{setTimeout((()=>{this.SysOptModeChangeRequest(!0),this.DownloadSystemOperationsSettings(100)}),500)}))}return this.modes.system_operation_mode.loading=!1,o},async HostConnModeChangeRequest(){if(!this.CheckUserLoginState())return!1;this.modes.host_conn_mode.loading=!0;var e=this.modes.host_conn_mode.actived?"OFFLINE":"ONLINE",t=await $e(this.modes.host_conn_mode.actived?0:1),a=t.confirm,o=t.message;return a?(this.ModeRequestSuccessHandler(e),b.cy.commit("setHostOnline",!this.modes.host_conn_mode.actived)):this.ModeRequestFailHandler(`HOST ${e}`,o),this.modes.host_conn_mode.loading=!1,a},async HostOptModeChangeRequest(){if(!this.CheckUserLoginState())return!1;this.modes.host_operation_mode.loading=!0;var e=this.modes.host_operation_mode.actived?"LOCAL":"REMOTE",t=await qe(this.modes.host_operation_mode.actived?0:1),a=t.confirm,o=t.message;return a?(this.ModeRequestSuccessHandler(e),b.cy.commit("setHostRemote",!this.modes.host_operation_mode.actived)):this.ModeRequestFailHandler(`HOST ${e}`,o),this.modes.host_operation_mode.loading=!1,a},CheckUserLoginState(){return this.IsLogin||this.$swal.fire({text:"",title:"權限不足 請先登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),this.IsLogin},ModeRequestFailHandler(e,t,a="",o=(()=>{})){var n=""!=a;this.$swal.fire({title:`${e} 切換失敗`,text:t+"，請稍後再嘗試切換。",icon:"error",showCancelButton:n,cancelButtonText:a,allowOutsideClick:!n}).then((e=>{!e.isConfirmed&&n&&o()}))},ModeRequestSuccessHandler(e){this.$vs.notify({color:"success",title:`${e}請求`,text:`${e}請求成功`,position:"bottom-right",time:2e3})},LangSwitch(e){this.$i18n.locale=e},async ResetSysAlarmsHandler(){await(0,Qe.gU)(),this.$vs.notify({color:"primary",title:"警報復歸請求",text:"系統警報復歸請求完成",position:"bottom-right",time:1400}),this.system_alarms=[""],this.system_alrm_text=""},async ResetEqpAlarmsHandler(){await(0,Qe.F6)(),this.$vs.notify({color:"primary",title:"警報復歸請求",text:"設備警報復歸請求完成",position:"bottom-right",time:1400})},CreateAlarmDisplayText(e){return`${Ye()(e.Time).format("yyyy/MM/DD HH:mm:ss")} |${e.AlarmCode}|${e.Equipment_Name}|-${e.Description_Zh}(${e.Description_En})`},AlarmDisplayHandler(){var e=0,t=0;setInterval((()=>{if(!this.SystemAlarms||0==this.SystemAlarms.length)return this.system_alarms=[""],void(this.system_alrm_text="");var t=this.SystemAlarms[e];t?(this.system_alarms=[1==t.Level?"alarm":"warning"],this.system_alrm_text=this.CreateAlarmDisplayText(t)):(this.system_alarms=[""],this.system_alrm_text=""),e+=1,e>=this.SystemAlarms.length&&(e=0)}),2e3),setInterval((()=>{if(!this.EquipmentAlarms||0==this.EquipmentAlarms.length)return this.equipment_alarms=[""],void(this.eq_alrm_text="");var e=this.EquipmentAlarms[t];e?(this.equipment_alarms=[1==e.Level?"alarm":"warning"],this.eq_alrm_text=this.CreateAlarmDisplayText(e)):(this.equipment_alarms=[""],this.eq_alrm_text=""),t+=1,t>=this.EquipmentAlarms.length&&(t=0)}),2e3)},NavigateToAlarmView(){this.$router.push("/alarm")}}};const We=(0,S.Z)(Ke,[["render",Ve],["__scopeId","data-v-4c7b52f8"]]);var Je=We;const Xe=e=>((0,o.pushScopeId)("data-v-500f3560"),e=e(),(0,o.popScopeId)(),e),et={class:"show-mode border"},tt={class:"d-flex flex-row"},at=Xe((()=>(0,o.createElementVNode)("i",{class:"bi bi-chevron-double-down"},null,-1))),ot=Xe((()=>(0,o.createElementVNode)("div",{class:"alarm-display-container d-flex flex-row w-100"},[(0,o.createElementVNode)("div",{class:"h-50 w-100 border d-flex flex-row"},[(0,o.createElementVNode)("div",{class:"alarm-type"},"設備異常"),(0,o.createElementVNode)("div",null,"a")]),(0,o.createElementVNode)("div",{class:"h-50 w-100 border d-flex flex-row"},[(0,o.createElementVNode)("div",{class:"alarm-type"},"AGV警報"),(0,o.createElementVNode)("div",null,"b")])],-1))),nt={class:"hidden-mode"},it=Xe((()=>(0,o.createElementVNode)("i",{class:"bi bi-chevron-double-up"},null,-1)));function st(e,t,a,n,i,s){const r=(0,o.resolveComponent)("b-button");return(0,o.openBlock)(),(0,o.createElementBlock)("div",{class:"alarm-display w-100 fixed-bottom",style:(0,o.normalizeStyle)(i.dynamic_style_setting)},[(0,o.createVNode)(o.Transition,{name:"el-zoom-in-bottom"},{default:(0,o.withCtx)((()=>[(0,o.withDirectives)((0,o.createElementVNode)("div",et,[(0,o.createElementVNode)("div",tt,[(0,o.createVNode)(r,{squared:"",variant:"secondary",onClick:t[0]||(t[0]=e=>i.mode="hidden")},{default:(0,o.withCtx)((()=>[at])),_:1}),ot])],512),[[o.vShow,"show"==i.mode]])])),_:1}),(0,o.withDirectives)((0,o.createElementVNode)("div",nt,[(0,o.createVNode)(r,{squared:"",variant:"danger",onClick:t[1]||(t[1]=e=>i.mode="show")},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" Alarms "),it])),_:1})],512),[[o.vShow,"hidden"==i.mode]])],4)}var rt={setup(){},data(){return{mode:"show",dynamic_style_setting:{zIndex:2e4}}},mounted(){(0,o.ref)("");const e=(0,Q.yj)();(0,o.watch)((()=>e.path),((e,t)=>{this.mode="/"!=e?"hidden":"show"})),N.Z.on("/alarm_footer_send_to_back",(e=>{this.dynamic_style_setting.zIndex=e?2:2e4}))}};const lt=(0,S.Z)(rt,[["render",st],["__scopeId","data-v-500f3560"]]);var dt=lt;const ct=e=>((0,o.pushScopeId)("data-v-0f865be7"),e=e(),(0,o.popScopeId)(),e),mt={class:"connection-state d-flex flex-row justify-content-between fixed-bottom text-dark text-start"},ut={class:"d-flex flex-row"},ht=ct((()=>(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"},null,-1)));function pt(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-tag");return(0,o.openBlock)(),(0,o.createElementBlock)("div",mt,[(0,o.createElementVNode)("div",ut,[ht,((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(i.Connections,(e=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{class:"conn-block px-1 border-end",key:e.name},[(0,o.createElementVNode)("label",null,(0,o.toDisplayString)(e.name),1),(0,o.createVNode)(r,{effect:"dark",type:e.connected?"success":"danger"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.connected?"已連線":"斷線"),1)])),_:2},1032,["type"])])))),128))]),(0,o.createElementVNode)("div",{onDblclick:t[0]||(t[0]=(...e)=>s.handleTimeDoubleClick&&s.handleTimeDoubleClick(...e)),class:"sys-time"},(0,o.toDisplayString)(i.sys_time),33)])}var gt=a(60487),_t={data(){return{Connections:[{name:"SERVER",connected:!1},{name:"VMS",connected:!1}],sys_time:""}},mounted(){setInterval((()=>{this.sys_time=Ye()(Date.now()).format("yyyy-MM-DD HH:mm:ss")}),1e3),this.ConnectionCheck(void 0,"/ws/VMSAliveCheck",0),this.ConnectionCheck(Re.Z.vms_ws_host,"/ws/VMSAliveCheck",1)},methods:{ConnectionCheck(e,t,a){var o=new gt.Z(t,e);o.Connect(),o.onclose=o=>{console.log(t+" onclose"),this.Connections[a].connected=!1,setTimeout((()=>{this.ConnectionCheck(e,t,a)}),1e3)},o.onopen=e=>{this.Connections[a].connected=!0}},handleTimeDoubleClick(){b.HP.dispatch("login",{UserName:"dev",Password:"12345678"})}}};const vt=(0,S.Z)(_t,[["render",pt],["__scopeId","data-v-0f865be7"]]);var ft=vt;const wt=e=>((0,o.pushScopeId)("data-v-237d485d"),e=e(),(0,o.popScopeId)(),e),yt={key:0,class:"move_agv_notify"},Vt=wt((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"移車提示",-1)));function Ct(e,t,a,n,i,s){const r=(0,o.resolveComponent)("Warning"),l=(0,o.resolveComponent)("el-icon"),d=(0,o.resolveComponent)("el-button"),c=(0,o.resolveComponent)("el-badge"),m=(0,o.resolveComponent)("el-table-column"),u=(0,o.resolveComponent)("el-table"),h=(0,o.resolveComponent)("el-dialog");return s.IsAnyAGVNeedToMOVE?((0,o.openBlock)(),(0,o.createElementBlock)("div",yt,[(0,o.createVNode)(c,{value:s.NeedToMoveAGVNum,class:"item"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{onClick:s.HandleBtnClick,style:{"font-size":"large"},plain:"",type:"warning",size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r)])),_:1}),Vt])),_:1},8,["onClick"])])),_:1},8,["value"]),(0,o.createElementVNode)("div",null,[(0,o.createVNode)(h,{draggable:"",width:"400",modal:!1,title:"移車",modelValue:i.DialogVisible,"onUpdate:modelValue":t[0]||(t[0]=e=>i.DialogVisible=e)},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(u,{"row-key":"AgvName",data:s.WattingAGVInfo},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(m,{label:"被阻車輛",prop:"AgvName"}),(0,o.createVNode)(m,{label:"當前地點",prop:"AgvName"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",null,(0,o.toDisplayString)(s.GetCurrentLocInfoByTag(e.row.Tag)),1)])),_:1}),(0,o.createVNode)(m,{label:"被阻地點",prop:"AgvName"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",null,(0,o.toDisplayString)(e.row.WaitingInfo.WaitingPoint.Name),1)])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])])):(0,o.createCommentVNode)("",!0)}var Nt=a(95320),bt=a(72748),kt={components:{Warning:bt.v3j},data(){return{DialogVisible:!1}},computed:{IsAnyAGVNeedToMOVE(){return this.NeedToMoveAGVNum>0},WattingAGVInfo(){var e=Nt.p.getters.AGVNavInfo.AGVDisplays,t=e.filter((e=>e.WaitingInfo.IsWaiting));return t},NeedToMoveAGVNum(){return this.WattingAGVInfo.length}},methods:{HandleBtnClick(){this.DialogVisible=!0},GetCurrentLocInfoByTag(e){var t=Nt.p.getters.MapData.Points,a=Object.values(t).find((t=>t.TagNumber==e));return`${a.TagNumber}:${a.Name}`}}};const St=(0,S.Z)(kt,[["render",Ct],["__scopeId","data-v-237d485d"]]);var xt=St;const Et={class:"agv-alarm-messages"};function Tt(e,t,a,n,i,s){return(0,o.openBlock)(),(0,o.createElementBlock)("div",Et)}const Dt={key:0,class:"bi bi-thermometer-high"},Pt={key:1,class:"bi bi-battery"},At={key:2,class:"bi bi-reception-1"},It={key:3,class:"bi bi-exclamation-diamond"},Bt={class:"agv-name"},Lt={class:"text"};function Mt(e,t,a,n,i,s){return(0,o.openBlock)(),(0,o.createElementBlock)("div",{class:(0,o.normalizeClass)(["agv-alarm-item my-2 d-flex rounded",a.alarm_type])},[(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["icon px-2 text-light","alarm"==a.alarm_type?"bg-danger":"bg-warning"])},[a.isBatteryTemperatureHigh?((0,o.openBlock)(),(0,o.createElementBlock)("i",Dt)):a.isBatteryLowLevel?((0,o.openBlock)(),(0,o.createElementBlock)("i",Pt)):a.isDisconnection?((0,o.openBlock)(),(0,o.createElementBlock)("i",At)):((0,o.openBlock)(),(0,o.createElementBlock)("i",It))],2),(0,o.createElementVNode)("div",Bt,(0,o.toDisplayString)(a.agv_name)+"|",1),(0,o.createElementVNode)("div",Lt,(0,o.toDisplayString)(a.text),1)],2)}var Ot={props:{alarm_type:{type:String,default:"warning"},agv_name:{type:String,default:"AGV_001"},text:{type:String,default:""},isBatteryTemperatureHigh:{type:Boolean,default:!1},isBatteryLowLevel:{type:Boolean,default:!1},isDisconnection:{type:Boolean,default:!1}}};const Gt=(0,S.Z)(Ot,[["render",Mt],["__scopeId","data-v-7922e32c"]]);var Rt=Gt,Ht={components:{AGVAlarmItem:Rt}};const Ft=(0,S.Z)(Ht,[["render",Tt],["__scopeId","data-v-25571013"]]);var Ut=Ft,Zt={components:{Header:Je,AlarmDisplayVue:dt,SideMenuDrawer:E,SideMenu:K,ConnectionState:ft,MoveAGVNotifty:xt,AGVAlarmMessageDisplay:Ut},data(){return{loading:!0,isNoPermission:!1,showMenuToggleIcon:!0,ShowOKOnlyModal:!1,okOnlyModalProps:{title:"",content:"",title_variant:"primary"},router_view_style:{position:"relative",height:"100vh",paddingTop:"140px",paddingRight:"95px",left:"70px"}}},methods:{OpenLoading(){this.$vs.loading(),setTimeout((()=>{this.$vs.loading.close()}),400)},ToggleMenu(){this.showMenuToggleIcon=!1,this.$refs.side_menu.Show()},SideMenuCloseHandler(){this.showMenuToggleIcon=!0}},mounted(){document.title="GPM 派車系統";let e=(0,Ie.VM)();e.isLogin&&b.HP.commit("setUser",e.login_info),N.Z.on("/ShowOKOnlyModal",(e=>{this.okOnlyModalProps=e,this.ShowOKOnlyModal=!0})),N.Z.on("auto_logout_notify_invoke",(()=>{this.$swal.fire({text:"",title:"因閒置太久，已自動登出。",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{window.location.href="/"}))}));const t=(0,Q.yj)();(0,o.watch)((()=>t.path),((e,t)=>{if(("/sys_settings"==e||"/map"==e)&&b.HP.getters.level<=0)return this.$vs.loading.close(),this.loading=!1,this.isNoPermission=!0,void this.$swal.fire({text:"",title:"您沒有足夠的權限訪問此頁面!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"full-sweetalert"}).then((()=>{window.location.href="/"}));this.OpenLoading(),this.router_view_style.paddingTop="/alarm"==e?"50px":"150px",setTimeout((async()=>{var t=await b.HP.dispatch("user_route_change",e);console.log(t),"/map"==e&&t.isOtherUserEditingMap&&this.$swal.fire({text:"",title:"注意!目前有其他使用者正在地圖編輯頁面",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}),100)})),setTimeout((()=>{this.loading=!1}),2e3)}};const $t=(e,t)=>{let a=null;return function(){let o=this,n=arguments;clearTimeout(a),a=setTimeout((function(){e.apply(o,n)}),t)}},qt=window.ResizeObserver;window.ResizeObserver=class extends qt{constructor(e){e=$t(e,16),super(e)}};const zt=(0,S.Z)(Zt,[["render",i]]);var Qt=zt,jt=a(52286),Yt=a(13609),Kt=(a(54415),a(70227)),Wt=a(5658);class Jt{constructor(){N.Z.on("/OKOnlyModal_Ok",(()=>{alert("ok")})),N.Z.on("/OKOnlyModal_Cancel",(()=>{alert("cancel")}))}static install(e){e.config.globalProperties.$Modal=new Jt}ShowOKModal(e,t,a="primary"){this.props={title:e,content:t,title_variant:a},N.Z.emit("/ShowOKOnlyModal",this.props)}}var Xt=Jt,ea=a(90704),ta=a.n(ea),aa=a(60407),oa=a.n(aa),na=a(86553),ia=a.n(na),sa=a(27657),ra=a(56938),la=a(64491);function da(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*o));return t}var ca=da(10);b.HP.commit("setUserID",ca),(0,la.H5)().then((e=>b.jU.commit("EqOptions",e))),(0,la.Qu)().then((e=>b.jU.commit("WIPOptions",e)));const ma=new Worker("websocket_worker.js");ma.onmessage=e=>{if("error"!=e.data&&"closed"!=e.data){var t=Object.values(e.data).map((e=>new ra.Z(e)));b.sn.commit("storeAgvStates",t)}},ma.postMessage({command:"connect",ws_url:Re.Z.backend_ws_host+`/ws/VMSStatus?user_id=${ca}`});const ua=new Worker("websocket_worker.js");ua.onmessage=e=>{"error"!=e.data&&"closed"!=e.data&&b.jU.commit("setData",e.data)},ua.postMessage({command:"connect",ws_url:Re.Z.backend_ws_host+"/ws/EQStatus"});const ha=new Worker("websocket_worker.js");ha.onmessage=e=>{"error"!=e.data&&"closed"!=e.data&&Nt.p.commit("setAGVDynamicPathInfo",e.data)},ha.postMessage({command:"connect",ws_url:Re.Z.vms_ws_host+"/ws/AGVNaviPathsInfo"});const pa=new Worker("websocket_worker.js");pa.onmessage=e=>{"error"!=e.data&&"closed"!=e.data&&b.sn.commit("setHotRunStates",e.data)},pa.postMessage({command:"connect",ws_url:Re.Z.backend_ws_host+"/ws/HotRun"});const ga=new Worker("websocket_worker.js");ga.onmessage=e=>{"error"!=e.data&&"closed"!=e.data&&Nt.p.commit("setControledPathesBySystem",e.data.ControledPathesByTraffic)},ga.postMessage({command:"connect",ws_url:Re.Z.vms_ws_host+"/ws/DynamicTrafficData"});var _a=0;function va(){_a=0}Fe().then((e=>{setInterval((()=>{_a+=1,_a>=e.WebUserLogoutExipreTime&&(b.HP.getters.IsLogin&&(b.HP.dispatch("logout",null),N.Z.emit("auto_logout_notify_invoke","")),va())}),1e3)})),document.addEventListener("touchstart",va),document.addEventListener("touchmove",va),document.addEventListener("touchend",va),document.addEventListener("mousemove",va),document.addEventListener("mousedown",va),document.addEventListener("keydown",va),document.title="GPV AGVS";const fa=(0,Wt.o)({legacy:!1,locale:"zh-TW",fallbackLocale:"en-US",messages:{"zh-TW":a(46687),"en-US":a(19594)}}),wa={confirmButtonColor:"rgb(13, 110, 253)",cancelButtonColor:"#ff7674"},ya=(0,o.createApp)(Qt);ya.config.globalProperties.$=ya.config.globalProperties,Xt.install(ya);const Va={...b.ZP,...b.HP};ya.use(Va),ya.use(oa()),ya.use(ta()),ya.use(Va),ya.use(jt.Z),ya.use(Kt.ZP),ya.use(Yt.Z),ya.use(fa),ya.use(ia(),wa),ya.use(sa.Z),ya.mount("#app")},52286:function(e,t,a){"use strict";a.d(t,{Z:function(){return Fi},Q:function(){return Ri}});var o=a(22483),n=a(79003);const i={class:"home-view h-100 custom-tabs-head"},s={class:"left-col border-right flex-fill"},r={style:{height:"800px"},class:"border"},l={class:"border w-100"},d={style:{width:"100%","padding-right":"50px"},class:"border"};function c(e,t,a,o,c,m){const u=(0,n.resolveComponent)("AGVStatusVue"),h=(0,n.resolveComponent)("TaskStatusVue"),p=(0,n.resolveComponent)("HomeMap"),g=(0,n.resolveComponent)("b-tab"),_=(0,n.resolveComponent)("EQStatus"),v=(0,n.resolveComponent)("b-tabs"),f=(0,n.resolveComponent)("TaskAllocationVue"),w=(0,n.resolveComponent)("TaskDispatchNewUI"),y=(0,n.resolveComponent)("TaskDispathActionButton"),V=(0,n.resolveDirective)("loading");return(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)("div",i,[(0,n.createElementVNode)("div",{style:(0,n.normalizeStyle)({visibility:c.isEasyMode?"hidden":"visible"}),class:"d-flex flex-row"},[(0,n.createElementVNode)("div",s,[(0,n.createVNode)(u),(0,n.createVNode)(h,{height:"500px"})]),(0,n.createVNode)(v,{style:{width:"60%"},"model-value":c.right_side_tabSelected,onActivateTab:m.TabActiveHandle},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(g,{title:"地圖"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",r,[(0,n.createVNode)(p)])])),_:1}),(0,n.createVNode)(g,{title:"設備狀態"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",l,[(0,n.createVNode)(_)])])),_:1})])),_:1},8,["model-value","onActivateTab"]),(0,n.createVNode)(f)],4),(0,n.createElementVNode)("div",{style:(0,n.normalizeStyle)({visibility:c.isEasyMode?"visible":"hidden",position:"absolute",top:"140px",width:"100%",height:"82vh"}),class:"easy_mode d-flex"},[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(u,{IsEasyMode:!0})]),(0,n.createElementVNode)("div",d,[(0,n.createVNode)(p,{id:"homemap-easymode"})])],4),(0,n.withDirectives)((0,n.createVNode)(w,{class:(0,n.normalizeClass)(["new-dispatch-pnl",c.show_new_dispatch_panel?"dispatch-show":"hide"]),onClose:t[0]||(t[0]=()=>{c.show_new_dispatch_panel=!1})},null,8,["class"]),[[n.vShow,c.show_new_dispatch_panel]]),m.IsLogin?((0,n.openBlock)(),(0,n.createBlock)(y,{key:0,onOnTaskDispatch:t[1]||(t[1]=()=>{c.right_side_tabSelected=0}),onOnClick:t[2]||(t[2]=()=>{c.show_new_dispatch_panel=!0})})):(0,n.createCommentVNode)("",!0)])),[[V,c.loading]])}var m=a(46058),u=a(96114);const h={style:{height:"600px",width:"800px"}};function p(e,t,a,o,i,s){const r=(0,n.resolveComponent)("l-geo-json"),l=(0,n.resolveComponent)("l-map");return(0,n.openBlock)(),(0,n.createElementBlock)("div",h,[(0,n.createVNode)(l,{zoom:o.mapZoom,center:o.mapCenter,style:{height:"100%"}},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{geojson:o.pointsGeoJson,options:o.pointsGeoJsonOptions},null,8,["geojson","options"]),(0,n.createVNode)(r,{geojson:o.linesGeoJson,options:o.linesGeoJsonOptions},null,8,["geojson","options"])])),_:1},8,["zoom","center"])])}var g=a(79772),_=a(95320),v={components:{LMap:g.iA,LTileLayer:g.Hw,LGeoJson:g.jK},setup(){const e=(0,n.ref)([0,0]),t=(0,n.ref)(2),a="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";var o=(0,n.ref)({type:"FeatureCollection",features:[{type:"Feature",properties:{color:"red",name:"red658856885687"},geometry:{type:"Point",coordinates:[0,1]}},{type:"Feature",properties:{color:"blue",name:"blue"},geometry:{type:"Point",coordinates:[0,2]}},{type:"Feature",properties:{color:"green",name:"green"},geometry:{type:"Point",coordinates:[0,3]}}]}),i=(0,n.ref)({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[[0,1],[0,2]]}},{type:"Feature",geometry:{type:"LineString",coordinates:[[0,1],[22,3]]}}]});const s=(0,n.ref)({pointToLayer:(e,t)=>{const a=L.divIcon({className:"custom-icon station-icon",html:`<span>${e.properties.name}</span>`});return L.marker(t,{icon:a})}}),r=(0,n.ref)({style:{color:"green",weight:3}});async function l(){var e=await _.p.dispatch("DownloadGeoMapData");return e}return{mapCenter:e,mapZoom:t,tileLayerUrl:a,pointsGeoJson:o,pointsGeoJsonOptions:s,linesGeoJson:i,linesGeoJsonOptions:r,GetMapData:l}},async mounted(){var e=await this.GetMapData();this.pointsGeoJson=e.PointsGeoJsonData,this.linesGeoJson=e.LinesGeoJsonData}},f=a(40089);const w=(0,f.Z)(v,[["render",p]]);var y=w;const V=e=>((0,n.pushScopeId)("data-v-81f30df6"),e=e(),(0,n.popScopeId)(),e),C={class:"task-dispatch-btn-container"},N=V((()=>(0,n.createElementVNode)("span",null,null,-1))),b={class:"w-100 h-100"},k=V((()=>(0,n.createElementVNode)("div",{class:"w-100 bg-info d-flex"},null,-1))),S=V((()=>(0,n.createElementVNode)("div",{class:"item-name"},"動作",-1))),x=V((()=>(0,n.createElementVNode)("div",{class:"item-name"},"車輛",-1))),E=V((()=>(0,n.createElementVNode)("div",{class:"item-name"},"來源",-1))),T=V((()=>(0,n.createElementVNode)("div",{class:"item-name"},"目的地",-1))),D={class:"w-100 py-1 d-flex border-top",style:{height:"50px"}},P={class:"actions-btn-conatiner"};function A(e,t,a,o,i,s){const r=(0,n.resolveComponent)("el-col"),l=(0,n.resolveComponent)("b-button"),d=(0,n.resolveComponent)("el-row"),c=(0,n.resolveComponent)("el-option"),m=(0,n.resolveComponent)("el-select"),u=(0,n.resolveComponent)("el-popover");return(0,n.openBlock)(),(0,n.createBlock)(u,{placement:"left-start",visible:i.action_menu_visible,width:200,content:""},{reference:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",C,[(0,n.createVNode)(u,{"popper-style":i.order_info_style,visible:i.order_info_visible,placement:"left-start",width:475},{reference:(0,n.withCtx)((()=>[N])),default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",b,[k,(0,n.createVNode)(d,{class:"order-row"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{span:5},{default:(0,n.withCtx)((()=>[S])),_:1}),(0,n.createVNode)(r,{class:"item-value",span:12},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.selected_action_display),1)])),_:1}),(0,n.createVNode)(r,{class:"item-actions",span:7},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{size:"sm",variant:"link",onClick:t[0]||(t[0]=()=>{s.HandleCancelBtnClick(),i.action_menu_visible=!0})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("重新選取")])),_:1})])),_:1})])),_:1}),(0,n.createVNode)(d,{class:"order-row",style:(0,n.normalizeStyle)(i.agv_select_row_class),onClick:s.HandleSelectAGVFromMapBtnClick},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{span:5},{default:(0,n.withCtx)((()=>[x])),_:1}),(0,n.createVNode)(r,{class:"item-value",span:12},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(m,{placeholder:"從地圖或選單選擇車輛",onClick:s.HandleSelectAGVFromMapBtnClick,size:"large",modelValue:i.selected_agv,"onUpdate:modelValue":t[1]||(t[1]=e=>i.selected_agv=e)},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.AgvNameList,(e=>((0,n.openBlock)(),(0,n.createBlock)(c,{key:e.value,label:e.label},null,8,["label"])))),128))])),_:1},8,["onClick","modelValue"])])),_:1}),(0,n.createVNode)(r,{class:"item-actions",span:7})])),_:1},8,["style","onClick"]),"carry"==i.selected_action?((0,n.openBlock)(),(0,n.createBlock)(d,{key:0,class:"order-row",style:(0,n.normalizeStyle)(i.source_select_row_class),onClick:s.HandleSelectSoureStationFromMapBtnClick},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{span:5},{default:(0,n.withCtx)((()=>[E])),_:1}),(0,n.createVNode)(r,{class:"item-value",span:12},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(m,{placeholder:"從地圖或選單選擇來源",onChange:s.HandleFromSelectChanged,onClick:s.HandleSelectSoureStationFromMapBtnClick,size:"large",modelValue:i.selected_source.TagNumber,"onUpdate:modelValue":t[2]||(t[2]=e=>i.selected_source.TagNumber=e)},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.FromStationOptions,(e=>((0,n.openBlock)(),(0,n.createBlock)(c,{key:e.tag,label:e.name_display,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["onChange","onClick","modelValue"])])),_:1}),(0,n.createVNode)(r,{class:"item-actions",span:7})])),_:1},8,["style","onClick"])):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(d,{class:"order-row",style:(0,n.normalizeStyle)(i.destine_select_row_class),onClick:s.HandleSelectDestineStationFromMapBtnClick},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{span:5},{default:(0,n.withCtx)((()=>[T])),_:1}),(0,n.createVNode)(r,{class:"item-value",span:12},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(m,{placeholder:"從地圖或選單選擇目的地",onChange:s.HandleDestineSelectChanged,onClick:s.HandleSelectDestineStationFromMapBtnClick,size:"large",modelValue:i.selected_destine.TagNumber,"onUpdate:modelValue":t[3]||(t[3]=e=>i.selected_destine.TagNumber=e)},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.DetermineDestinOptions(),(e=>((0,n.openBlock)(),(0,n.createBlock)(c,{key:e.tag,label:e.name_display,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["onChange","onClick","modelValue"])])),_:1}),(0,n.createVNode)(r,{class:"item-actions",span:7})])),_:1},8,["style","onClick"]),(0,n.createElementVNode)("div",D,[(0,n.createVNode)(l,{onClick:s.HandleConfirmBtnClicked,disabled:!s.task_dispatch_btn_pushable,class:"w-50 mx-1",variant:"primary"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("確認派送")])),_:1},8,["onClick","disabled"]),(0,n.createVNode)(l,{class:"w-50 mx-1",variant:"light",onClick:t[4]||(t[4]=()=>{i.order_info_visible=!1,i.action_menu_visible=!0})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("返回選擇動作")])),_:1}),(0,n.createVNode)(l,{class:"w-50 mx-1",variant:"danger",onClick:s.HandleCancelBtnClick},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("取消")])),_:1},8,["onClick"])])])])),_:1},8,["popper-style","visible"]),(0,n.createVNode)(l,{squared:"",variant:"primary",onClick:t[5]||(t[5]=()=>{i.action_menu_visible?i.action_menu_visible=!1:i.order_info_visible||(i.action_menu_visible=!0)})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("任務派送")])),_:1})])])),default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",P,[!s.IsRunMode||s.IsDeveloper?((0,n.openBlock)(),(0,n.createBlock)(l,{key:0,class:"w-100 my-1",variant:"light",onClick:t[6]||(t[6]=e=>s.SelectActionHandle("move"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 移動")])),_:1})):(0,n.createCommentVNode)("",!0),!s.IsRunMode||s.IsDeveloper?((0,n.openBlock)(),(0,n.createBlock)(l,{key:1,class:"w-100 my-1",variant:"light",onClick:t[7]||(t[7]=e=>s.SelectActionHandle("unload"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 取貨 ")])),_:1})):(0,n.createCommentVNode)("",!0),!s.IsRunMode||s.IsDeveloper?((0,n.openBlock)(),(0,n.createBlock)(l,{key:2,class:"w-100 my-1",variant:"light",onClick:t[8]||(t[8]=e=>s.SelectActionHandle("load"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 放貨 ")])),_:1})):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(l,{class:"w-100 my-1",variant:"primary",onClick:t[9]||(t[9]=e=>s.SelectActionHandle("carry"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 搬運 ")])),_:1}),(0,n.createVNode)(l,{class:"w-100 my-1",variant:"warning",onClick:t[10]||(t[10]=e=>s.SelectActionHandle("charge"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 充電 ")])),_:1}),(0,n.createVNode)(l,{class:"w-100 my-1",variant:"danger",onClick:t[11]||(t[11]=()=>{i.action_menu_visible=!1})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" 取消 ")])),_:1})])])),_:1},8,["visible"])}a(57658);var I=a(53259),B=a(93867),M=a(8764),O=a(24239),G={data(){return{action_menu_visible:!1,order_info_visible:!1,selected_action:"",selected_agv:"",selected_source:{Graph:{Display:""}},selected_destine:{Graph:{Display:""}},Cst_ID_Input:"",order_info_style:{backgroundColor:"rgba(255, 255, 255,.8)"},source_select_row_class:"",destine_select_row_class:"",agv_select_row_class:"",map_events_bus:{agv_selected:"/map/agv_selected",station_selected:"/map/station_selected"},bypass_eq_status_check:!1,equipments_options:[],downstream_options:[]}},computed:{IsRunMode(){return O.cy.getters.IsRunMode},IsDeveloper(){return O.HP.getters.IsDeveloperLogining},AgvNameList(){var e=[];function t(e){O.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return this.IsRunMode?(e.push({value:"",label:"自動選車"}),this.IsDeveloper&&t(e)):t(e),e},IsShowBackTo(){return"select-action"!=this.current_progress},selected_action_display(){var e=this.selected_action;return"move"==e?"移動":"unload"==e?"取貨":"load"==e?"放貨":"carry"==e?"搬運":"charge"==e?"充電":void 0},IsAutoSelectAGV(){return("carry"==this.selected_action||"unload"==this.selected_action)&&""==this.selected_agv},task_dispatch_btn_pushable(){return"carry"==this.selected_action?(""!=this.selected_agv||this.IsAutoSelectAGV)&&void 0!=this.selected_source&&void 0!=this.selected_destine:(""!=this.selected_agv||this.IsAutoSelectAGV)&&void 0!=this.selected_destine},EQStations(){return _.p.getters.AllEqStation},bay_names(){var e=_.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},FromStationOptions(){var e=O.sn.getters.AGVNameList.map((e=>({tag:e,name_display:e}))),t=[...this.EQStations,...e];return t}},methods:{SelectActionHandle(e){this.$emit("onTaskDispatch"),this.selected_action=e,this.HandleActionSelected(e),this.action_menu_visible=!1,this.order_info_visible=!0,"carry"==e||"unload"==e?(this.selected_agv="自動選車","carry"==e?this.HandleSelectSoureStationFromMapBtnClick():this.HandleSelectDestineStationFromMapBtnClick()):this.HandleSelectAGVFromMapBtnClick()},HandleActionSelected(e){this.source_select_row_class=this.destine_select_row_class=this.agv_select_row_class="";var t={backgroundColor:"rgb(13, 110, 253)",color:"white",borderRadius:"1px solid black"};"select-agv"==e&&(this.agv_select_row_class=t),"select-source"==e&&(this.source_select_row_class=t),"select-destine"==e&&(this.destine_select_row_class=t)},HandleSelectAGVFromMapBtnClick(){this.HandleActionSelected("select-agv"),I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected),I.Z.emit("change_to_select_agv_mode"),this.current_progress="select-agv",this.is_reselecting_flag=!0,I.Z.on(this.map_events_bus.agv_selected,(e=>{this.selected_agv=e,"carry"==this.selected_action&&""==this.selected_source.Graph.Display?(this.HandleSelectSoureStationFromMapBtnClick(),this.HandleActionSelected("select-source")):""==this.selected_destine.Graph.Display&&(this.HandleSelectDestineStationFromMapBtnClick(),this.HandleActionSelected("select-destine"))}))},HandleSelectSoureStationFromMapBtnClick(){this.selected_source={Graph:{Display:""}},this.HandleActionSelected("select-source"),I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected),I.Z.emit("change_to_select_eq_station_mode",{action_type:this.selected_action,direction:"source"}),this.current_progress="select-source",this.is_reselecting_flag=!1,this.selected_destine={Graph:{Display:""}},I.Z.on(this.map_events_bus.station_selected,(e=>{if(console.info(e),e.IsEquipment||4==e.StationType){if(e==this.selected_destine)return;this.selected_source=e,this.HandleFromSelectChanged(this.selected_source.TagNumber),I.Z.emit("mark_as_start_station",this.selected_source.TagNumber),this.HandleSelectDestineStationFromMapBtnClick(),this.HandleActionSelected("select-destine")}}))},HandleSelectDestineStationFromMapBtnClick(){this.HandleActionSelected("select-destine"),I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected);var e=this.GetDownStreamEQOptions(this.selected_source.TagNumber);console.info("_destine_options:",e);let t={action_type:this.selected_action,direction:"destine",stations_to_show:e};I.Z.emit("change_to_select_eq_station_mode",t),this.current_progress="select-destine",this.is_reselecting_flag=!0,I.Z.on(this.map_events_bus.station_selected,(e=>{if(console.info(e),("charge"!=this.selected_action||e.IsCharge)&&("load"!=this.selected_action&&"unload"!=this.selected_action&&"carry"!=this.selected_action||e.IsEquipment||4==e.StationType)){if("carry"==this.selected_action){if(e==this.selected_source)return;if(!this.downstream_options.some((t=>t.tag==e.TagNumber)))return}console.log(this.downstream_options),I.Z.emit("mark_as_destine_station",e.TagNumber),this.selected_destine=e}}))},async HandleDestineSelectChanged(e){this.selected_destine=await _.p.dispatch("GetMapPointByTag",e)},HandleCancelBtnClick(){I.Z.off(this.map_events_bus.agv_selected),I.Z.off(this.map_events_bus.station_selected),this.order_info_visible=!1,this.selected_source=this.selected_destine={Graph:{Display:""}},this.source_select_row_class=this.destine_select_row_class=this.agv_select_row_class="",I.Z.emit("change_to_normal_view_mode")},HandleConfirmBtnClicked(){this.$swal.fire({title:"確定要派送此任務?",text:`${this.selected_agv} 執行 ${this.selected_action_display} 任務,終點:${this.selected_destine.Graph.Display}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.TaskDeliveryHandle()}))},async TaskDeliveryHandle(){this.IsDeveloper?this.bypass_eq_status_check=!0:0==O.HP.getters.level&&(this.bypass_eq_status_check=!1);var e={confirm:!0,message:""},t=this.selected_destine?this.selected_destine.TagNumber:-1,a=this.selected_source?this.selected_source.TagNumber:-1,o="自動選車"==this.selected_agv||""==this.selected_agv?"":this.selected_agv;if("move"==this.selected_action&&(e=await M.J8.MoveTask(new M.ec(o,t,50))),"measure"==this.selected_action&&(e=await M.J8.MeasureTask(new M.FV(o,t))),"load"==this.selected_action&&(e=await M.J8.LoadTask(new M.Y4(o,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selected_action&&(e=await M.J8.UnloadTask(new M.On(o,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selected_action&&(e=await M.J8.CarryTask(new M.mc(o,a,1,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"exchange_battery"==this.selected_action&&(e=await M.J8.ExangeBatteryTask(new M.Z$(o,t,50,this.bypass_eq_status_check))),"charge"==this.selected_action&&(e=await M.J8.ChargeTask(new M.fn(o,t,50,this.bypass_eq_status_check))),"park"==this.selected_action&&(e=await M.J8.ParkTask(new M.Nn(o,t,50,this.bypass_eq_status_check))),200!=e.status){const t=401==e.status;this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{t&&(O.HP.dispatch("logout",""),I.Z.emit("/show-login-view-invoke"))}))}else e.data.confirm?(this.HandleCancelBtnClick(),B.Z.Success(`任務-[${this.selected_action_display}] 已派送!`,"bottom",2e3)):this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async HandleFromSelectChanged(e){this.selected_source=await _.p.dispatch("GetMapPointByTag",e),this.selected_destine={TagNumber:void 0},this.downstream_options=this.GetDownStreamEQOptions(e)},GetDownStreamEQOptions(e){var t=[],a=O.jU.getters.EqOptions,o=a.find((t=>t.TagID==e));if(o){var n=o.ValidDownStreamEndPointNames,i=n.includes("ALL"),s=i?a:a.filter((e=>n.includes(e.Name)));Object.values(s).forEach((e=>{t.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}return t},DetermineDestinOptions(){return"measure"==this.selected_action?this.bay_names:"move"==this.selected_action?_.p.getters.AllNormalStationOptions:"load"==this.selected_action||"unload"==this.selected_action?_.p.getters.AllEqStation:"charge"==this.selected_action?_.p.getters.AllChargeStation:"carry"==this.selected_action?this.downstream_options:"exchange_battery"==this.selected_action?_.p.getters.AllExangeBatteryStation:this.tags}}};const R=(0,f.Z)(G,[["render",A],["__scopeId","data-v-81f30df6"]]);var H=R;const F=e=>((0,n.pushScopeId)("data-v-364f358a"),e=e(),(0,n.popScopeId)(),e),U={class:"task-dispatch-new-ui"},Z={class:"bg-primary text-light d-flex flex-row"},$=F((()=>(0,n.createElementVNode)("div",{class:"w-100 title-text"}," 任務派送",-1))),q={class:"page-pnl"},z=F((()=>(0,n.createElementVNode)("div",{class:"head-text"},"請選擇任務動作",-1))),Q={class:"actions-btn-conatiner"},j=F((()=>(0,n.createElementVNode)("label",null,"移動",-1))),Y=[j],K=F((()=>(0,n.createElementVNode)("label",null,"取貨",-1))),W=[K],J=F((()=>(0,n.createElementVNode)("label",null,"放貨",-1))),X=[J],ee=F((()=>(0,n.createElementVNode)("label",null,"搬運",-1))),te=[ee],ae=F((()=>(0,n.createElementVNode)("label",null,"充電",-1))),oe=[ae],ne={class:"page-pnl"},ie=F((()=>(0,n.createElementVNode)("div",{class:"head-text"},"請選擇車輛",-1))),se={class:"actions-btn-conatiner"},re=["onClick"],le={class:"page-pnl"},de=F((()=>(0,n.createElementVNode)("div",{class:"head-text"},"請選擇來源設備",-1))),ce={class:"station-btn-conatiner"},me=["onClick"],ue={class:"page-pnl"},he=F((()=>(0,n.createElementVNode)("div",{class:"head-text"},"請選擇目的地",-1))),pe={class:"station-btn-conatiner"},ge=["onClick"],_e={class:"page-pnl"},ve=F((()=>(0,n.createElementVNode)("div",{class:"head-text"},"確認派送任務",-1))),fe={class:"actions-btn-conatiner"},we={class:"order-content"},ye={class:"order-row"},Ve=F((()=>(0,n.createElementVNode)("label",{class:"title"},"動作",-1))),Ce={class:"value"},Ne={class:"order-row"},be=F((()=>(0,n.createElementVNode)("label",{class:"title"},"車輛",-1))),ke={class:"value"},Se={key:0,class:"order-row"},xe=F((()=>(0,n.createElementVNode)("label",{class:"title"},"來源",-1))),Ee={class:"value"},Te={class:"order-row"},De=F((()=>(0,n.createElementVNode)("label",{class:"title"},"目的地",-1))),Pe={class:"value"},Ae={class:"d-flex justify-content-center"},Ie=F((()=>(0,n.createElementVNode)("label",null,"確認派送",-1))),Be=[Ie],Le=F((()=>(0,n.createElementVNode)("label",null,"取消",-1))),Me=[Le];function Oe(e,t,a,o,i,s){const r=(0,n.resolveComponent)("b-button");return(0,n.openBlock)(),(0,n.createElementBlock)("div",U,[(0,n.createElementVNode)("div",Z,[$,(0,n.createElementVNode)("i",{onClick:t[0]||(t[0]=(...e)=>s.Leave&&s.Leave(...e)),class:"close-btn mx-2 bi bi-x-circle"})]),s.IsShowBackTo?((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:0,class:"back-to-last-step px-2",onClick:t[1]||(t[1]=(...e)=>s.HandleBackToPush&&s.HandleBackToPush(...e))},"返回 ["+(0,n.toDisplayString)(s.lastProgressDisplay)+"]",1)):(0,n.createCommentVNode)("",!0),(0,n.withDirectives)((0,n.createElementVNode)("div",q,[z,(0,n.createElementVNode)("div",Q,[!s.IsRunMode||s.IsDeveloper?((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:0,onClick:t[2]||(t[2]=e=>s.SelectActionHandle("move")),class:"action"},Y)):(0,n.createCommentVNode)("",!0),!s.IsRunMode||s.IsDeveloper?((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:1,onClick:t[3]||(t[3]=e=>s.SelectActionHandle("unload")),class:"action"},W)):(0,n.createCommentVNode)("",!0),!s.IsRunMode||s.IsDeveloper?((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:2,onClick:t[4]||(t[4]=e=>s.SelectActionHandle("load")),class:"action"},X)):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",{onClick:t[5]||(t[5]=e=>s.SelectActionHandle("carry")),class:"action"},te),(0,n.createElementVNode)("div",{onClick:t[6]||(t[6]=e=>s.SelectActionHandle("charge")),class:"action"},oe)])],512),[[n.vShow,"select-action"==i.current_progress]]),(0,n.withDirectives)((0,n.createElementVNode)("div",ne,[ie,(0,n.createElementVNode)("div",se,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.AgvNameList,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:e.value,onClick:t=>s.SelectAgvHandle(e.value),class:"action"},[(0,n.createElementVNode)("label",null,(0,n.toDisplayString)(e.label),1)],8,re)))),128))])],512),[[n.vShow,"select-agv"==i.current_progress]]),(0,n.withDirectives)((0,n.createElementVNode)("div",le,[de,(0,n.createElementVNode)("div",ce,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.eq_stations,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:e.tag,class:"action",onClick:t=>s.SelectSourceHandle(e)},[(0,n.createElementVNode)("label",null,(0,n.toDisplayString)(e.name_display),1)],8,me)))),128))])],512),[[n.vShow,"select-source"==i.current_progress]]),(0,n.withDirectives)((0,n.createElementVNode)("div",ue,[he,(0,n.createElementVNode)("div",pe,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.destine_stations,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:e.tag,class:"action",onClick:t=>s.SelectDestineHandle(e)},[(0,n.createElementVNode)("label",null,(0,n.toDisplayString)(e.name_display),1)],8,ge)))),128))])],512),[[n.vShow,"select-destine"==i.current_progress]]),(0,n.withDirectives)((0,n.createElementVNode)("div",_e,[ve,(0,n.createElementVNode)("div",fe,[(0,n.createElementVNode)("div",we,[(0,n.createElementVNode)("div",ye,[Ve,(0,n.createElementVNode)("label",Ce,(0,n.toDisplayString)(s.selected_action_display),1),(0,n.createVNode)(r,{onClick:t[7]||(t[7]=()=>{i.current_progress="select-action",i.is_reselecting_flag=!1})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("重新選取")])),_:1})]),(0,n.createElementVNode)("div",Ne,[be,(0,n.createElementVNode)("label",ke,(0,n.toDisplayString)(""==i.selected_agv?"自動選車":i.selected_agv),1),(0,n.createVNode)(r,{onClick:t[8]||(t[8]=()=>{i.current_progress="select-agv",i.is_reselecting_flag=!0})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("重新選取")])),_:1})]),"carry"==i.selected_action?((0,n.openBlock)(),(0,n.createElementBlock)("div",Se,[xe,(0,n.createElementVNode)("label",Ee,(0,n.toDisplayString)(i.selected_source.name_display),1),(0,n.createVNode)(r,{onClick:t[9]||(t[9]=()=>{i.current_progress="select-source",i.is_reselecting_flag=!1})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("重新選取")])),_:1})])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",Te,[De,(0,n.createElementVNode)("label",Pe,(0,n.toDisplayString)(i.selected_destine.name_display),1),(0,n.createVNode)(r,{onClick:t[10]||(t[10]=()=>{i.current_progress="select-destine",i.is_reselecting_flag=!0})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("重新選取")])),_:1})])]),(0,n.createElementVNode)("div",Ae,[(0,n.createElementVNode)("div",{onClick:t[11]||(t[11]=(...e)=>s.HandleConfirmBtnClicked&&s.HandleConfirmBtnClicked(...e)),class:"action bg-primary text-light"},Be),(0,n.createElementVNode)("div",{onClick:t[12]||(t[12]=e=>s.SelectDestineHandle("EQ_B")),class:"action bg-danger text-light"},Me)])])],512),[[n.vShow,"confirm-task"==i.current_progress]])])}var Ge=a(64491),Re={data(){return{current_progress:"select-action",selected_action:"",selected_agv:"",selected_source:"",selected_destine:"",Cst_ID_Input:"",downstream_stations:[],bypass_eq_status_check:!1,is_reselecting_flag:!1}},methods:{SelectActionHandle(e){this.selected_action=e,this.current_progress="select-agv"},SelectAgvHandle(e){this.selected_agv=e,this.is_reselecting_flag?this.current_progress="confirm-task":"carry"==this.selected_action?this.current_progress="select-source":this.current_progress="select-destine"},SelectSourceHandle(e){this.HandleFromSelectChanged(e.tag).then((t=>{this.selected_source=e,this.current_progress="select-destine"}))},SelectDestineHandle(e){this.selected_destine=e,this.is_reselecting_flag&&this.selected_action,this.current_progress="confirm-task"},HandleBackToPush(){this.is_reselecting_flag=!1,"select-agv"==this.current_progress&&(this.current_progress="select-action"),"select-source"==this.current_progress&&(this.current_progress="select-agv"),"select-destine"==this.current_progress&&("carry"==this.selected_action?this.current_progress="select-source":this.current_progress="select-agv"),"confirm-task"==this.current_progress&&(this.current_progress="select-destine")},async HandleFromSelectChanged(e){this.downstream_stations=[];var t=await(0,Ge.H5)(),a=t.find((t=>t.TagID==e));if(a){var o=a.ValidDownStreamEndPointNames,n=t.filter((e=>o.includes(e.Name)));console.info(n),Object.values(n).forEach((e=>{this.downstream_stations.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}return this.downstream_stations},HandleConfirmBtnClicked(){this.$swal.fire({title:"確定要派送此任務?",text:`${this.selected_agv} 執行 ${this.selected_action_display} 任務,終點:${this.selected_destine.name_display}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.TaskDeliveryHandle()}))},async TaskDeliveryHandle(){this.IsDeveloper?this.bypass_eq_status_check=!0:0==O.HP.getters.level&&(this.bypass_eq_status_check=!1);var e={confirm:!0,message:""},t=this.selected_destine.tag,a=this.selected_source.tag,o=this.selected_agv;if("move"==this.selected_action&&(e=await M.J8.MoveTask(new M.ec(o,t,50))),"measure"==this.selected_action&&(e=await M.J8.MeasureTask(new M.FV(o,t))),"load"==this.selected_action&&(e=await M.J8.LoadTask(new M.Y4(o,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selected_action&&(e=await M.J8.UnloadTask(new M.On(o,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selected_action&&(e=await M.J8.CarryTask(new M.mc(o,a,1,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"exchange_battery"==this.selected_action&&(e=await M.J8.ExangeBatteryTask(new M.Z$(o,t,50,this.bypass_eq_status_check))),"charge"==this.selected_action&&(e=await M.J8.ChargeTask(new M.fn(o,t,50,this.bypass_eq_status_check))),"park"==this.selected_action&&(e=await M.J8.ParkTask(new M.Nn(o,t,50,this.bypass_eq_status_check))),200!=e.status){const t=401==e.status;this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{t&&(O.HP.dispatch("logout",""),I.Z.emit("/show-login-view-invoke"),this.Leave())}))}else e.data.confirm?(B.Z.Success(`任務-[${this.selected_action_display}] 已派送!`,"bottom",2e3),this.Leave()):this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},Leave(){this.$emit("close"),this.is_reselecting_flag=!1,this.current_progress="select-action"}},computed:{IsRunMode(){return O.cy.getters.IsRunMode},IsShowBackTo(){return"select-action"!=this.current_progress},lastProgressDisplay(){var e=this.current_progress;return"select-agv"==e?"選擇動作":"select-source"==e?"選擇AGV":"select-destine"==e?"carry"==this.selected_action?"選擇起點":"選擇AGV":"confirm-task"==e?"選擇目的地":void 0},selected_action_display(){var e=this.selected_action;return"move"==e?"移動":"unload"==e?"取貨":"load"==e?"放貨":"carry"==e?"搬運":"charge"==e?"充電":void 0},IsDeveloper(){return O.HP.getters.IsDeveloperLogining},AgvNameList(){var e=[];function t(e){O.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return this.IsRunMode?(e.push({value:"",label:"自動選車"}),this.IsDeveloper&&t(e)):t(e),e},moveable_stations(){return _.p.getters.AllNormalStationOptions},chargable_tags(){return _.p.getters.AllChargeStation},eq_stations(){return _.p.getters.AllEqStation},destine_stations(){return"move"==this.selected_action?this.moveable_stations:"charge"==this.selected_action?this.chargable_tags:"unload"==this.selected_action||"load"==this.selected_action?this.eq_stations:"carry"==this.selected_action?this.downstream_stations:[]}}};const He=(0,f.Z)(Re,[["render",Oe],["__scopeId","data-v-364f358a"]]);var Fe=He;const Ue={class:"eq-status",ref:"eq-status-container"},Ze={class:"text-start border-bottom p-2 my-2 d-flex flex-row justify-content-space"},$e={class:"d-flex"},qe=(0,n.createElementVNode)("div",{class:"p-1"},[(0,n.createElementVNode)("i",{class:"bi bi-three-dots-vertical pt-2"}),(0,n.createTextVNode)("區域選擇 ")],-1),ze={class:"d-flex"},Qe=(0,n.createElementVNode)("div",{class:"p-1"},[(0,n.createElementVNode)("i",{class:"bi bi-three-dots-vertical pt-2"}),(0,n.createTextVNode)("顯示模式 ")],-1),je={key:0,class:"legend d-flex flex-row px-2"},Ye=(0,n.createElementVNode)("div",{class:"disconnect"},null,-1),Ke=(0,n.createElementVNode)("span",null,"斷線",-1),We=(0,n.createElementVNode)("div",{class:"signal-on"},null,-1),Je=(0,n.createElementVNode)("span",null,"訊號[ON]",-1),Xe=(0,n.createElementVNode)("div",{class:"signal-off"},null,-1),et=(0,n.createElementVNode)("span",null,"訊號[OFF]",-1),tt=[Ye,Ke,We,Je,Xe,et],at={class:"hs-signals d-flex"},ot=(0,n.createElementVNode)("div",{class:"mx-3"},"交握訊號-EQ",-1),nt=["onClick"],it=["onClick"],st=["onClick"],rt=["onClick"],lt=["onClick"],dt={class:"hs-signals d-flex"},ct=(0,n.createElementVNode)("div",{class:"mx-3"},"交握訊號-AGV",-1),mt=["onClick"],ut=["onClick"],ht=["onClick"],pt=["onClick"],gt=["onClick"],_t=["onClick"],vt={key:0,class:"d-flex"},ft=(0,n.createElementVNode)("div",{class:"mx-3"},"模擬器:",-1),wt=["onClick"],yt={class:"d-flex"};function Vt(e,t,a,o,i,s){const r=(0,n.resolveComponent)("RegionsSelector"),l=(0,n.resolveComponent)("el-option"),d=(0,n.resolveComponent)("el-select"),c=(0,n.resolveComponent)("el-button"),m=(0,n.resolveComponent)("el-table-column"),u=(0,n.resolveComponent)("el-tooltip"),h=(0,n.resolveComponent)("el-tag"),p=(0,n.resolveComponent)("el-table");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Ue,[(0,n.createElementVNode)("div",Ze,[(0,n.createElementVNode)("div",$e,[qe,(0,n.createVNode)(r,{modelValue:i.selected_region,"onUpdate:modelValue":t[0]||(t[0]=e=>i.selected_region=e)},null,8,["modelValue"])]),(0,n.createElementVNode)("div",ze,[Qe,(0,n.createVNode)(d,{style:{width:"120px"},modelValue:i.display_mode,"onUpdate:modelValue":t[1]||(t[1]=e=>i.display_mode=e)},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"設備狀態",value:"lduld_state"}),(0,n.createVNode)(l,{label:"IO訊號",value:"io_siganl"})])),_:1},8,["modelValue"])]),s.show_lduld_state?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createElementBlock)("div",je,tt))]),(0,n.createVNode)(p,{class:"px-1",border:"",siz:"small",style:{height:"68vh"},"header-cell-style":{color:"black",backgroundColor:"white"},data:s.display_data,"row-style":{fontWeight:"bold"},"row-class-name":s.eq_connection_status,"row-key":"EQName"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(m,{type:"expand","max-width":"40"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",at,[ot,(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleHSsignaleChange(e.row.EQName,"L_REQ",!e.row.HS_EQ_L_REQ),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_EQ_L_REQ))},"L_REQ",12,nt),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleHSsignaleChange(e.row.EQName,"U_REQ",!e.row.HS_EQ_U_REQ),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_EQ_U_REQ))},"U_REQ",12,it),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleHSsignaleChange(e.row.EQName,"READY",!e.row.HS_EQ_READY),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_EQ_READY))},"READY",12,st),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleHSsignaleChange(e.row.EQName,"UP_READY",!e.row.HS_EQ_UP_READY),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_EQ_UP_READY))},"UP_READY",12,rt),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleHSsignaleChange(e.row.EQName,"LOW_READY",!e.row.HS_EQ_LOW_READY),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_EQ_LOW_READY))},"LOW_READY",12,lt),(0,n.createCommentVNode)("",!0)]),(0,n.createElementVNode)("div",dt,[ct,(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleAGVHSSignaleChange(e.row.EQName,"To_EQ_Up",!e.row.To_EQ_Up),style:(0,n.normalizeStyle)(s.signalOn(e.row.To_EQ_Up))},"To_EQ_Up",12,mt),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleAGVHSSignaleChange(e.row.EQName,"To_EQ_Low",!e.row.To_EQ_Low),style:(0,n.normalizeStyle)(s.signalOn(e.row.To_EQ_Low))},"To_EQ_Low",12,ut),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleAGVHSSignaleChange(e.row.EQName,"VALID",!e.row.HS_AGV_VALID),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_AGV_VALID))},"VALID",12,ht),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleAGVHSSignaleChange(e.row.EQName,"TR_REQ",!e.row.HS_AGV_TR_REQ),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_AGV_TR_REQ))},"TR_REQ",12,pt),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleAGVHSSignaleChange(e.row.EQName,"BUSY",!e.row.HS_AGV_BUSY),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_AGV_BUSY))},"BUSY",12,gt),(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",{class:"di-status",onClick:t=>s.HandleAGVHSSignaleChange(e.row.EQName,"COMPT",!e.row.HS_AGV_COMPT),style:(0,n.normalizeStyle)(s.signalOn(e.row.HS_AGV_COMPT))},"COMPT",12,_t)]),s.IsDeveloperLogining?((0,n.openBlock)(),(0,n.createElementBlock)("div",vt,[ft,(0,n.createVNode)(c,{onClick:t=>s.LDULD_Emu_State_Switch(e.row.EQName,"busy")},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("切換為Busy")])),_:2},1032,["onClick"]),(0,n.createVNode)(c,{onClick:t=>s.LDULD_Emu_State_Switch(e.row.EQName,"load")},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("切換為Load")])),_:2},1032,["onClick"]),(0,n.createVNode)(c,{onClick:t=>s.LDULD_Emu_State_Switch(e.row.EQName,"unload")},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("切換為Unload")])),_:2},1032,["onClick"])])):(0,n.createCommentVNode)("",!0)])),_:1}),(0,n.createVNode)(m,{sortable:"",label:"設備名稱",prop:"EQName",width:"170"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createTextVNode)((0,n.toDisplayString)(e.row.EQName)+" ",1),(0,n.createVNode)(u,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("i",{onClick:t=>s.CopyText(e.row.EQName),class:"copy-button copy-icon bi bi-clipboard"},null,8,wt)])),_:2},1024)])])),_:1}),(0,n.createVNode)(m,{sortable:"",label:"Tag",prop:"Tag",width:"60",align:"center"}),s.show_lduld_state?((0,n.openBlock)(),(0,n.createBlock)(m,{key:0,align:"center",label:"主狀態",prop:"MainStatus"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(h,{style:{width:"150px"},type:s.GetMainStatusTagtype(e.row.MainStatus,e.row.IsConnected),effect:"dark"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.GetMainStatusStr(e.row.MainStatus,e.row.IsConnected)),1)])),_:2},1032,["type"])])),_:1})):(0,n.createCommentVNode)("",!0),s.show_lduld_state?((0,n.openBlock)(),(0,n.createBlock)(m,{key:1,align:"center",label:"移載狀態",prop:"TransferStatus"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(h,{style:{width:"150px"},type:s.GetTransferStatusTagtype(e.row.TransferStatus,e.row.IsConnected),effect:"dark"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.GetTransferStatusStr(e.row.TransferStatus,e.row.IsConnected)),1)])),_:2},1032,["type"])])),_:1})):(0,n.createCommentVNode)("",!0),s.show_lduld_state?((0,n.openBlock)(),(0,n.createBlock)(m,{key:2,align:"center",label:"帳籍狀態",prop:"TransferStatus"},{default:(0,n.withCtx)((e=>[s.show_lduld_state?((0,n.openBlock)(),(0,n.createBlock)(m,{key:0,align:"center",label:"帳籍狀態"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",yt,[e.row.Port_Exist?((0,n.openBlock)(),(0,n.createBlock)(h,{key:0,class:"mx-1",type:"success",effect:"dark"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("有貨")])),_:1})):(0,n.createCommentVNode)("",!0),e.row.Port_Exist?((0,n.openBlock)(),(0,n.createBlock)(h,{key:1,class:"mx-1",type:"info",effect:"dark"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("滿框")])),_:1})):(0,n.createCommentVNode)("",!0),e.row.Port_Exist?((0,n.openBlock)(),(0,n.createBlock)(h,{key:2,class:"mx-1",type:"info",effect:"dark"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("空框")])),_:1})):(0,n.createCommentVNode)("",!0),e.row.Port_Exist?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(h,{key:3,class:"mx-1",type:"warning",effect:"dark"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("無貨")])),_:1}))])])),_:2},1024)):(0,n.createCommentVNode)("",!0),s.show_lduld_state?((0,n.openBlock)(),(0,n.createBlock)(m,{key:1,align:"center",label:"ID"})):(0,n.createCommentVNode)("",!0)])),_:1})):(0,n.createCommentVNode)("",!0),s.show_lduld_state?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(m,{key:3,label:"可移入",prop:"Load_Request","min-width":i.column_width},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",{class:"di-status",style:(0,n.normalizeStyle)(s.signalOn(e.row.Load_Request))},"可移入",4)])),_:1},8,["min-width"])),s.show_lduld_state?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(m,{key:4,label:"可移出",prop:"Unload_Request","min-width":i.column_width},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",{class:"di-status",style:(0,n.normalizeStyle)(s.signalOn(e.row.Unload_Request))},"可移出",4)])),_:1},8,["min-width"])),s.show_lduld_state?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(m,{key:5,label:"貨物在席",prop:"Port_Exist","min-width":i.column_width},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",{class:"di-status",style:(0,n.normalizeStyle)(s.signalOn(e.row.Port_Exist))},(0,n.toDisplayString)(e.row.Port_Exist?"有貨":"無貨"),5)])),_:1},8,["min-width"])),s.show_lduld_state?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(m,{key:6,label:"Down",prop:"Eqp_Status_Down","min-width":i.column_width},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",{class:"di-status",style:(0,n.normalizeStyle)(s.signalOn(e.row.Eqp_Status_Down))},(0,n.toDisplayString)(0==e.row.EqType?"Normal":"Down"),5)])),_:1},8,["min-width"])),s.show_lduld_state?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(m,{key:7,label:"Run",prop:"Eqp_Status_Run","min-width":i.column_width},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",{class:"di-status",style:(0,n.normalizeStyle)(s.signalOn(e.row.Eqp_Status_Run))},"Run",4)])),_:1},8,["min-width"])),s.show_lduld_state?(0,n.createCommentVNode)("",!0):((0,n.openBlock)(),(0,n.createBlock)(m,{key:8,label:"Idle",prop:"Eqp_Status_Idle","min-width":i.column_width},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",{class:"di-status",style:(0,n.normalizeStyle)(s.signalOn(e.row.Eqp_Status_Idle))},"Idle",4)])),_:1},8,["min-width"]))])),_:1},8,["data","row-class-name"])],512)}a(60487);var Ct=a(90633),Nt=a(663),bt=a(18134),kt=a.n(bt),St=a(26666);function xt(e){const t=new(kt())(".copy-button",{text:()=>e});t.on("success",(()=>{(0,St.bM)({title:e,message:"已複製到剪貼簿",duration:1500}),t.destroy()})),t.on("error",(()=>{t.destroy()}))}var Et={components:{RegionsSelector:Ct.Z},data(){return{column_width:103,selected_region:"all",display_mode:"lduld_state",previous_eq_data:[]}},computed:{IsDeveloperLogining(){return O.HP.getters.IsDeveloperLogining},display_data(){return"all"==this.selected_region?this.eq_data:this.eq_data.filter((e=>e.Region==this.selected_region))},eq_data(){return O.jU.getters.EQData},show_lduld_state(){return"lduld_state"==this.display_mode}},mounted(){document.getElementsByClassName("di-status");I.Z.on("/map_init_done",(()=>{this.eq_data.forEach((e=>{I.Z.emit("/eq_lduld_status_changed",{tagNumber:e.Tag,status:e.TransferStatus})}))}))},methods:{userStoreTest(){alert(O.HP.getters.IsDeveloperLogining)},eq_connection_status(e,t){var a=e.row.IsConnected;return a?"success-row":"error-row"},signalOn(e,t=!1){return e?t?{backgroundColor:"blue"}:{backgroundColor:"lime"}:{backgroundColor:"rgb(204, 204, 204)"}},RegionSelectChanged(e){this.selected_region=e},filterRegionData(e,t,a){console.log(t)},CopyText(e){xt(e)},LDULD_Emu_State_Switch(e="",t="busy|load|unlod"){Ge.PQ.SetState(e,t)},EmuAllLoad(){Ge.PQ.EQAllLoad()},EmuAllBusy(){Ge.PQ.EQAllBusy()},HandleHSsignaleChange(e,t,a){this.IsDeveloperLogining&&Ge.PQ.SetEQHsSignal(e,t,a)},HandleAGVHSSignaleChange(e,t,a){this.IsDeveloperLogining&&(0,Ge.Aj)(e,t,a)},GetMainStatusStr(e,t){if(!t)return"斷線";switch(e){case 0:return"當機";case 1:return"生產中";case 2:return"閒置";case 3:return"-";default:return e+""}},GetTransferStatusStr(e,t){if(!t)return"斷線";switch(e){case 0:return"斷線";case 1:return"可收料";case 2:return"可出料";case 3:return"No-Request";default:return e+""}},GetTransferStatusTagtype(e,t){if(!t)return"danger";switch(e){case 0:return"info";case 1:return"warning";case 2:return"success";case 3:return"info";case 4:return"success";default:break}},GetMainStatusTagtype(e,t){if(!t)return"danger";switch(e){case 0:return"danger";case 1:return"success";case 2:return"warning";case 3:return"success";default:break}}}};const Tt=(0,f.Z)(Et,[["render",Vt]]);var Dt=Tt,Pt=a(49857),At=a(14464),It={components:{AGVStatusVue:m.Z,TaskStatusVue:Pt.Z,HomeMap:u.Z,TaskAllocationVue:At.Z,EQStatus:Dt,LMap:y,TaskDispathActionButton:H,TaskDispatchNewUI:Fe},methods:{TabActiveHandle(e){this.right_side_tabSelected=e}},computed:{IsRunMode(){return O.cy.getters.IsRunMode},IsLogin(){return O.HP.getters.IsLogin}},data(){return{isEasyMode:!1,loading:!1,show_new_dispatch_panel:!1,right_side_tabSelected:0}},mounted(){I.Z.on("view_mode_changed",(e=>{this.loading=!0,this.isEasyMode=e,setTimeout((()=>{this.loading=!1}),300)}))}};const Bt=(0,f.Z)(It,[["render",c]]);var Lt=Bt;const Mt={class:"sys-settings custom-tabs-head-large p-1"},Ot={class:"setting-tab"},Gt={class:"setting-tab"},Rt={class:"setting-tab"},Ht={class:"setting-tab"},Ft={class:"setting-tab"};function Ut(e,t,a,o,i,s){const r=(0,n.resolveComponent)("AGVBatterySetting"),l=(0,n.resolveComponent)("b-tab"),d=(0,n.resolveComponent)("UserManager"),c=(0,n.resolveComponent)("ChargeStationView"),m=(0,n.resolveComponent)("EQManager"),u=(0,n.resolveComponent)("HotRUniew"),h=(0,n.resolveComponent)("b-tabs");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Mt,[(0,n.createVNode)(h,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{title:"AGV 電量設定",active:""},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ot,[(0,n.createVNode)(r)])])),_:1}),(0,n.createVNode)(l,{title:"用戶管理"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Gt,[(0,n.createVNode)(d,{ref:"user_manager"},null,512)])])),_:1}),(0,n.createVNode)(l,{title:"充電站設置"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Rt,[(0,n.createVNode)(c)])])),_:1}),(0,n.createVNode)(l,{title:"設備管理"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ht,[(0,n.createVNode)(m)])])),_:1}),(0,n.createVNode)(l,{title:"HOT RUN"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ft,[(0,n.createVNode)(u)])])),_:1})])),_:1})])}const Zt={class:"user-manager"},$t={class:"d-flex flex-row"},qt=(0,n.createElementVNode)("span",{class:"flex-fill"},null,-1),zt={class:"border"};function Qt(e,t,a,o,i,s){const r=(0,n.resolveComponent)("OperatieButtonSet"),l=(0,n.resolveComponent)("el-button"),d=(0,n.resolveComponent)("el-table-column"),c=(0,n.resolveComponent)("el-input"),m=(0,n.resolveComponent)("el-option"),u=(0,n.resolveComponent)("el-select"),h=(0,n.resolveComponent)("el-table"),p=(0,n.resolveComponent)("el-form-item"),g=(0,n.resolveComponent)("b-button"),_=(0,n.resolveComponent)("el-form"),v=(0,n.resolveComponent)("el-dialog");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Zt,[(0,n.createElementVNode)("div",$t,[(0,n.createVNode)(r,{onSave:s.SaveSetting,onRestore:s.HandleRestoreBtnClicked},null,8,["onSave","onRestore"]),qt,(0,n.createVNode)(l,{onClick:t[0]||(t[0]=()=>{i.NewUser={UserName:"",Password:"",Role:1},i.AddNewUserDialogShow=!0}),style:{"font-weight":"bold","font-size":"20px"},type:"primary",size:"large"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("新增使用者")])),_:1})]),(0,n.createElementVNode)("div",zt,[(0,n.createVNode)(h,{data:i.UserData,"empty-text":"沒有使用者",size:"large"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{label:"使用者名稱",prop:"UserName",width:"180"}),(0,n.createVNode)(d,{label:"使用者密碼",prop:"Password",width:"220"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(c,{type:"Password",modelValue:e.row.Password,"onUpdate:modelValue":t=>e.row.Password=t,"show-password":""},null,8,["modelValue","onUpdate:modelValue"])])])),_:1}),(0,n.createVNode)(d,{label:"使用者群組",prop:"Role",width:"180"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(u,{modelValue:e.row.Role,"onUpdate:modelValue":t=>e.row.Role=t},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.RoleOptions,(e=>((0,n.openBlock)(),(0,n.createBlock)(m,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])])),_:1}),(0,n.createVNode)(d,{label:"操作","min-width":"120"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(l,{onClick:t=>s.DeleteUser(e.row),type:"danger"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("刪除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"])]),(0,n.createVNode)(v,{modelValue:i.AddNewUserDialogShow,"onUpdate:modelValue":t[4]||(t[4]=e=>i.AddNewUserDialogShow=e),width:"500",title:"新增使用者",draggable:""},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(_,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)(p,{label:"使用者名稱"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(c,{modelValue:i.NewUser.UserName,"onUpdate:modelValue":t[1]||(t[1]=e=>i.NewUser.UserName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,n.createVNode)(p,{label:"使用者密碼"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(c,{modelValue:i.NewUser.Password,"onUpdate:modelValue":t[2]||(t[2]=e=>i.NewUser.Password=e),type:"password",autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,n.createVNode)(p,{label:"使用者群組"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(u,{modelValue:i.NewUser.Role,"onUpdate:modelValue":t[3]||(t[3]=e=>i.NewUser.Role=e)},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.RoleOptions,(e=>((0,n.openBlock)(),(0,n.createBlock)(m,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,n.createVNode)(g,{disabled:""==i.NewUser.UserName||""==i.NewUser.Password,onClick:s.HandleAddNewUserClick,class:"w-100",variant:"primary"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("新增")])),_:1},8,["disabled","onClick"])])),_:1})])])),_:1},8,["modelValue"])])}const jt={class:"save-default-buttons-group border-bottom bg-default text-start"};function Yt(e,t,a,o,i,s){const r=(0,n.resolveComponent)("el-button");return(0,n.openBlock)(),(0,n.createElementBlock)("div",jt,[(0,n.createVNode)(r,{onClick:s.HandleSaveBtnClick,type:"primary",size:"large"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("儲存")])),_:1},8,["onClick"]),(0,n.createVNode)(r,{onClick:s.HandleRestoreBtnClick,type:"danger",size:"large"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("預設值")])),_:1},8,["onClick"])])}var Kt={methods:{HandleRestoreBtnClick(){this.$emit("restore","")},HandleSaveBtnClick(){this.$emit("save","")}}};const Wt=(0,f.Z)(Kt,[["render",Yt],["__scopeId","data-v-6bebdf16"]]);var Jt=Wt,Xt=a(82106),ea={components:{OperatieButtonSet:Jt},data(){return{AddNewUserDialogShow:!1,UserData:[{UserName:"jinwei",Password:"1020",Role:2},{UserName:"eng",Password:"tset-pw2",Role:1},{UserName:"test",Password:"tset-pw3",Role:0}],NewUser:{UserName:"eng",Password:"tset-pw2",Role:1},OriginUserData:{},RoleOptions:[{label:"Operator",value:0},{label:"工程師",value:1},{label:"開發人員",value:2}]}},mounted(){this.DownloadUsers()},methods:{async DeleteUser(e){this.$swal.fire({text:`確定要刪除使用者-${e.UserName} ?`,title:"刪除使用者",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async t=>{t.isConfirmed&&(await(0,Xt.HG)(e.UserName),this.DownloadUsers(),B.Z.Danger(`使用者-${e.UserName}已刪除`,"top",1e3))}))},async DownloadUsers(){this.UserData=await(0,Xt.jf)(),this.SaveAsOriginUserData()},async SaveSetting(){var e=await(0,Xt.l2)(this.UserData);e.Success?B.Z.Success("使用者資料修改成功","bottom",3e3):B.Z.Danger("使用者資料修改失敗","bottom",3e3)},async HandleRestoreBtnClicked(){this.$swal.fire({text:"",title:"確定要載入預設值?",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&(this.DownloadUsers(),B.Z.Success("使用者資料已重新載入","top",2e3))}))},SaveAsOriginUserData(){this.OriginUserData=JSON.parse(JSON.stringify(this.UserData))},async HandleAddNewUserClick(){var e=await(0,Xt.mm)(this.NewUser);this.AddNewUserDialogShow=!1,e.Success?this.$swal.fire({text:"",title:`使用者 ${this.NewUser.UserName}-新增成功`,icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):this.$swal.fire({text:`${e.Message}`,title:"使用者新增失敗",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{this.AddNewUserDialogShow=!0})),this.DownloadUsers()}}};const ta=(0,f.Z)(ea,[["render",Qt]]);var aa=ta;const oa=e=>((0,n.pushScopeId)("data-v-ad1a2d62"),e=e(),(0,n.popScopeId)(),e),na={class:"equipment-manager border-start border-end"},ia={class:"text-start px-1"},sa={class:"d-flex"},ra={class:"w-100 d-flex flex-row"},la={class:"w-100"},da={class:"hs-signals d-flex"},ca=oa((()=>(0,n.createElementVNode)("div",{class:"mx-3"},"交握訊號-EQ",-1))),ma={class:"hs-signals d-flex"},ua=oa((()=>(0,n.createElementVNode)("div",{class:"mx-3"},"交握訊號-AGV",-1)));function ha(e,t,a,o,i,s){const r=(0,n.resolveComponent)("b-button"),l=(0,n.resolveComponent)("el-table-column"),d=(0,n.resolveComponent)("b-form-input"),c=(0,n.resolveComponent)("RegionsSelector"),m=(0,n.resolveComponent)("el-option"),u=(0,n.resolveComponent)("el-select"),h=(0,n.resolveComponent)("el-button"),p=(0,n.resolveComponent)("el-table"),g=(0,n.resolveComponent)("el-form-item"),_=(0,n.resolveComponent)("el-input"),v=(0,n.resolveComponent)("el-form"),f=(0,n.resolveComponent)("el-drawer");return(0,n.openBlock)(),(0,n.createElementBlock)("div",na,[(0,n.createElementVNode)("p",ia,[(0,n.createVNode)(r,{variant:"primary",squared:"",onClick:s.SaveSettingHandler},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("儲存設定")])),_:1},8,["onClick"]),(0,n.createVNode)(r,{variant:"info",squared:"",class:"mx-2",onClick:s.AddNewEqHandler},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("新增設備")])),_:1},8,["onClick"]),(0,n.createVNode)(r,{squared:"",onClick:s.ReloadSettingsHandler},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("重新載入")])),_:1},8,["onClick"])]),(0,n.createVNode)(p,{"header-cell-style":{color:"white",backgroundColor:"rgb(13, 110, 253)",fontSize:"16px"},data:i.EqDatas,"row-key":"TagID",size:"small",border:"",height:"680","table-layout":"fixed",style:{width:"1800px"}},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"Index",prop:"index",width:"80",align:"center",fixed:"left"}),(0,n.createVNode)(l,{label:"設備名稱",prop:"Name",width:"250",fixed:"left"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",sa,[(0,n.createVNode)(d,{state:i.ValidName(e.row),modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,placeholder:"設備名稱",style:{width:"120px"},"no-wheel":!0,size:"sm",min:1,onInput:t=>s.HandleEqNameChange(e.row,e.row.Name)},null,8,["state","modelValue","onUpdate:modelValue","onInput"]),(0,n.createVNode)(r,{class:"mx-1",size:"sm",variant:"primary",onClick:t=>s.HandleUseMapDataDisplayName(e.row.TagID)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("使用圖資設定")])),_:2},1032,["onClick"])])])),_:1}),(0,n.createVNode)(l,{label:"Tag ID",prop:"TagID",width:"100",align:"center",fixed:"left"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(d,{type:"number",state:i.ValidTag(e.row),modelValue:e.row.TagID,"onUpdate:modelValue":t=>e.row.TagID=t,modelModifiers:{number:!0},placeholder:"tag id","no-wheel":!0,size:"sm",min:1},null,8,["state","modelValue","onUpdate:modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"區域",prop:"Region",width:"130"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(c,{modelValue:e.row.Region,"onUpdate:modelValue":t=>e.row.Region=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"下游設備",width:"950px"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",ra,[(0,n.createVNode)(u,{modelValue:e.row.ValidDownStreamEndPointNames,"onUpdate:modelValue":t=>e.row.ValidDownStreamEndPointNames=t,multiple:"",placeholder:"Select",style:{width:"1000px"}},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.GetAvaluableEqNameList(e.row.Name),(e=>((0,n.openBlock)(),(0,n.createBlock)(m,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,n.createVNode)(h,{type:"default",onClick:()=>{e.row.ValidDownStreamEndPointNames=s.GetAvaluableEqNameList(e.row.Name)}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("使用所有設備")])),_:2},1032,["onClick"]),(0,n.createVNode)(h,{type:"danger",onClick:()=>{e.row.ValidDownStreamEndPointNames=[]}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("清除")])),_:2},1032,["onClick"])])])),_:1}),(0,n.createVNode)(l,{label:"操作","min-width":"170",fixed:"right"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(h,{size:i.cell_item_size,type:"default",onClick:t=>s.ConnectionSettingBtnHandle(e.row)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("連線設定")])),_:2},1032,["size","onClick"]),(0,n.createVNode)(h,{size:i.cell_item_size,type:"danger",onClick:t=>s.RemoveHandle(e.row)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("移除")])),_:2},1032,["size","onClick"])])])),_:1})])),_:1},8,["header-cell-style","data"]),(0,n.createVNode)(f,{modelValue:i.connection_setting_drawer,"onUpdate:modelValue":t[5]||(t[5]=e=>i.connection_setting_drawer=e),title:`${i.selected_eq.Name}-連線設定`},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",la,[(0,n.createVNode)(v,{"label-position":"left","label-width":"100"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(g,{label:"通訊方式"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(u,{modelValue:i.selected_eq.ConnOptions.ConnMethod,"onUpdate:modelValue":t[0]||(t[0]=e=>i.selected_eq.ConnOptions.ConnMethod=e)},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(m,{label:"Modbus TCP",value:0}),(0,n.createVNode)(m,{label:"Modbus RTU",value:1}),(0,n.createVNode)(m,{label:"TCP/IP",value:2}),(0,n.createVNode)(m,{label:"Serial Port",value:3})])),_:1},8,["modelValue"])])),_:1}),(0,n.createVNode)(g,{label:"IP"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(_,{disabled:1==i.selected_eq.ConnOptions.ConnMethod,modelValue:i.selected_eq.ConnOptions.IP,"onUpdate:modelValue":t[1]||(t[1]=e=>i.selected_eq.ConnOptions.IP=e)},null,8,["disabled","modelValue"])])),_:1}),(0,n.createVNode)(g,{label:"PORT"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(_,{disabled:1==i.selected_eq.ConnOptions.ConnMethod,modelValue:i.selected_eq.ConnOptions.Port,"onUpdate:modelValue":t[2]||(t[2]=e=>i.selected_eq.ConnOptions.Port=e),modelModifiers:{number:!0}},null,8,["disabled","modelValue"])])),_:1}),(0,n.createVNode)(g,{label:"COMPORT"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(_,{disabled:0==i.selected_eq.ConnOptions.ConnMethod,modelValue:i.selected_eq.ConnOptions.ComPort,"onUpdate:modelValue":t[3]||(t[3]=e=>i.selected_eq.ConnOptions.ComPort=e)},null,8,["disabled","modelValue"])])),_:1})])),_:1}),(0,n.createVNode)(h,{type:"default",onClick:t[4]||(t[4]=e=>s.ConnectTestHandle(i.selected_eq))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("通訊測試")])),_:1})])])),_:1},8,["modelValue","title"]),(0,n.createVNode)(f,{modelValue:i.io_check_drawer,"onUpdate:modelValue":t[19]||(t[19]=e=>i.io_check_drawer=e),direction:"btt"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",da,[ca,(0,n.createElementVNode)("div",{class:"di-status",onClick:t[6]||(t[6]=t=>e.HandleHSsignaleChange(s.selected_eq_io_data.EQName,"L_REQ",!e.scope.row.HS_EQ_L_REQ)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_EQ_L_REQ))},"L_REQ",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[7]||(t[7]=t=>e.HandleHSsignaleChange(s.selected_eq_io_data.EQName,"U_REQ",!e.scope.row.HS_EQ_U_REQ)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_EQ_U_REQ))},"U_REQ",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[8]||(t[8]=t=>e.HandleHSsignaleChange(s.selected_eq_io_data.EQName,"READY",!e.scope.row.HS_EQ_READY)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_EQ_READY))},"READY",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[9]||(t[9]=t=>e.HandleHSsignaleChange(s.selected_eq_io_data.EQName,"UP_READY",!e.scope.row.HS_EQ_UP_READY)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_EQ_UP_READY))},"UP_READY",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[10]||(t[10]=t=>e.HandleHSsignaleChange(s.selected_eq_io_data.EQName,"LOW_READY",!e.scope.row.HS_EQ_LOW_READY)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_EQ_LOW_READY))},"LOW_READY",4),(0,n.createCommentVNode)("",!0)]),(0,n.createElementVNode)("div",ma,[ua,(0,n.createElementVNode)("div",{class:"di-status",onClick:t[12]||(t[12]=t=>e.HandleAGVHSSignaleChange(s.selected_eq_io_data.EQName,"To_EQ_Up",!e.scope.row.To_EQ_Up)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.To_EQ_Up))},"To_EQ_Up",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[13]||(t[13]=t=>e.HandleAGVHSSignaleChange(s.selected_eq_io_data.EQName,"To_EQ_Low",!e.scope.row.To_EQ_Low)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.To_EQ_Low))},"To_EQ_Low",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[14]||(t[14]=t=>e.HandleAGVHSSignaleChange(s.selected_eq_io_data.EQName,"VALID",!e.scope.row.HS_AGV_VALID)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_AGV_VALID))},"VALID",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[15]||(t[15]=t=>e.HandleAGVHSSignaleChange(s.selected_eq_io_data.EQName,"TR_REQ",!e.scope.row.HS_AGV_TR_REQ)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_AGV_TR_REQ))},"TR_REQ",4),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[16]||(t[16]=t=>e.HandleAGVHSSignaleChange(s.selected_eq_io_data.EQName,"BUSY",!e.scope.row.HS_AGV_BUSY)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_AGV_BUSY))},"BUSY",4),(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",{class:"di-status",onClick:t[18]||(t[18]=t=>e.HandleAGVHSSignaleChange(s.selected_eq_io_data.EQName,"COMPT",!e.scope.row.HS_AGV_COMPT)),style:(0,n.normalizeStyle)(e.signalOn(s.selected_eq_io_data.HS_AGV_COMPT))},"COMPT",4)])])),_:1},8,["modelValue"])])}var pa=a(36797),ga=a.n(pa),_a={components:{RegionsSelector:Ct.Z},data(){return{cell_item_size:"",io_check_drawer:!1,connection_setting_drawer:!1,EqDatas:[],EqDatas_Orignal:[],ValidTag:e=>{var t=e.TagID,a=this.EqDatas.filter((t=>t.Name!=e.Name)),o=a.filter((e=>e.TagID==t));return 0==o.length&&t>=1},ValidName:e=>{var t=e.Name,a=this.EqDatas.filter((t=>t.Name==e.Name));return 1==a.length&&""!=t},selected_eq:{}}},methods:{GetAvaluableEqNameList(e){var t=this.EqNames.filter((t=>t!=e));return["ALL",...t]},async SaveSettingHandler(){var e=await(0,Ge.wW)(this.EqDatas);e.confirm?this.$swal.fire({title:"儲存成功",icon:"success",timer:2e3}):this.$swal.fire({title:"參數設定有誤",text:e.message,icon:"error"})},async DownloadEQOptions(){this.EqDatas=[];var e=O.jU.getters.EqOptions;for(let t=0;t<e.length;t++){const a=e[t];a.index=t,this.EqDatas.push(a)}this.CloneEQDatas()},CloneEQDatas(){this.EqDatas_Orignal=JSON.parse(JSON.stringify(this.EqDatas))},ReloadSettingsHandler(){this.DownloadEQOptions()},AddNewEqHandler(){this.EqDatas.push({index:this.EqDatas.length,Name:`New_EQ_${this.EqDatas.length}`,TagID:1,ConnOptions:{ConnMethod:0,IP:"127.0.0.1",Port:502,ComPort:"COM1"}})},RemoveHandle(e){var t=this.EqDatas.filter((t=>t.Name!=e.Name));this.EqDatas=t},async IOCheckBtnHandle(e){this.selected_eq=e,this.io_check_drawer=!0},async ConnectionSettingBtnHandle(e){this.selected_eq=e,this.connection_setting_drawer=!0},async ConnectTestHandle(e){var t=await(0,Ge.qN)(e.ConnOptions),a="";a=0==e.ConnOptions.ConnMethod?`Modbus TCP - ${e.ConnOptions.IP}:${e.ConnOptions.Port}`:`Modbus RTU - ${e.ConnOptions.ComPort}`,t.Connected?this.$swal.fire({title:"OK",text:a,icon:"success"}):this.$swal.fire({title:"Fail",text:a,icon:"error"})},beforeRouteLeave(e,t,a){alert("leave!")},async HandleUseMapDataDisplayName(e){var t=await _.p.dispatch("GetMapPointByTag",e);if(t){var a=this.EqDatas.find((t=>t.TagID==e)),o=t.Graph.Display;a.Name=o,this.HandleEqNameChange(a,t.Name),(0,St.bM)({message:`Get Display Name From Map Success(Tag ${e} = ${o})`,duration:1e3,type:"success",title:"設備同步名稱"})}else(0,St.bM)({message:"Get Display Name From Map Fail",duration:1e3,type:"error",title:"設備同步名稱失敗"})},HandleEqNameChange(e,t){var a=e.TagID,o=this.EqDatas_Orignal.find((e=>e.TagID==a)),n=o.Name,i=this.EqDatas.filter((e=>e.ValidDownStreamEndPointNames.includes(n)));i.forEach((e=>{var a=e.ValidDownStreamEndPointNames.indexOf(n);e.ValidDownStreamEndPointNames[a]=t})),this.CloneEQDatas()}},mounted(){setTimeout((()=>{this.DownloadEQOptions()}),1e3)},computed:{EqNames(){return this.EqDatas.map((e=>e.Name))},eq_data(){return O.jU.getters.EQData},selected_eq_io_data(){return this.eq_data.find((e=>e.EQName==this.selected_eq.EQName))}}};const va=(0,f.Z)(_a,[["render",ha],["__scopeId","data-v-ad1a2d62"]]);var fa=va;const wa={class:"agv-battery-setting"};function ya(e,t,a,o,i,s){const r=(0,n.resolveComponent)("el-table-column"),l=(0,n.resolveComponent)("el-table");return(0,n.openBlock)(),(0,n.createElementBlock)("div",wa,[(0,n.createVNode)(l,{"header-cell-style":{color:"white",backgroundColor:"rgb(13, 110, 253)",fontSize:"16px"},size:"small",border:"",height:"680"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{label:"車輛名稱"}),(0,n.createVNode)(r,{label:"低電量提醒"}),(0,n.createVNode)(r,{label:"閒置-強制充電"}),(0,n.createVNode)(r,{label:"AGV 名稱"})])),_:1},8,["header-cell-style"])])}var Va={};const Ca=(0,f.Z)(Va,[["render",ya]]);var Na=Ca;const ba={class:"charge-station-setup",style:{height:"100%"}},ka={class:"charger-states border rounded text-start"},Sa={class:"px-2"},xa={class:"d-flex w-100"},Ea={class:"state p-3"},Ta=(0,n.createElementVNode)("h5",{class:"title"},"狀態",-1),Da={class:"row",style:{width:"390px","padding-left":"12px"}},Pa={class:"state mx-2 p-3"},Aa=(0,n.createElementVNode)("h5",{class:"title"},"充電曲線參數",-1),Ia={class:"d-flex"},Ba={class:"d-flex"},La={class:"d-flex"},Ma={class:"d-flex"},Oa=(0,n.createElementVNode)("h6",null,"充電曲線參考圖示",-1),Ga=(0,n.createElementVNode)("img",{class:"border rounded p-3",src:"images/charger_curve.png",alt:""},null,-1),Ra={class:"text-start",style:{"font-size":"14px"}},Ha=(0,n.createElementVNode)("span",null,"更新時間",-1),Fa={class:"d-flex justify-content-end w-100 border-top py-2"};function Ua(e,t,a,o,i,s){const r=(0,n.resolveComponent)("el-tag"),l=(0,n.resolveComponent)("el-form-item"),d=(0,n.resolveComponent)("el-form"),c=(0,n.resolveComponent)("el-input"),m=(0,n.resolveComponent)("el-button"),u=(0,n.resolveComponent)("el-tab-pane"),h=(0,n.resolveComponent)("el-tabs"),p=(0,n.resolveComponent)("el-input-number"),g=(0,n.resolveComponent)("el-dialog");return(0,n.openBlock)(),(0,n.createElementBlock)("div",ba,[(0,n.createVNode)(h,{"tab-position":"top"},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.charge_station_data,((e,t)=>((0,n.openBlock)(),(0,n.createBlock)(u,{key:t,label:t},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",ka,[(0,n.createElementVNode)("h3",Sa,(0,n.toDisplayString)(t),1),(0,n.createElementVNode)("div",xa,[(0,n.createElementVNode)("div",Ea,[Ta,(0,n.createVNode)(d,{"label-width":"120","label-position":"left"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"連線狀態"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{effect:"dark",type:e.Connected?"primary":"danger"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.Connected?"Connected":"Disconnect"),1)])),_:2},1032,["type"])])),_:2},1024),(0,n.createVNode)(l,{label:"狀態"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{effect:"dark",type:s.GetTagType(e)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.Connected?0==e.ErrorCodes.length?"Normal":"Warning":"Disconnect"),1)])),_:2},1032,["type"])])),_:2},1024),(0,n.createVNode)(l,{label:"異常碼"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Da,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.ErrorCodes,(e=>((0,n.openBlock)(),(0,n.createBlock)(r,{effect:"dark",class:"col-sm-3",key:e,type:"danger"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e),1)])),_:2},1024)))),128))])])),_:2},1024),(0,n.createVNode)(l,{label:"輸入電壓"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,null,{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.Vin)+" V",1)])),_:2},1024)])),_:2},1024),(0,n.createVNode)(l,{label:"輸出電壓"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,null,{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.Vout)+" V",1)])),_:2},1024)])),_:2},1024),(0,n.createVNode)(l,{label:"輸出電流"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,null,{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.Iout)+" A",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)]),(0,n.createElementVNode)("div",Pa,[Aa,(0,n.createVNode)(d,{"label-width":"70","label-position":"left"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"CC"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ia,[(0,n.createVNode)(c,{precision:2,disabled:"",modelValue:e.CC,"onUpdate:modelValue":t=>e.CC=t},null,8,["modelValue","onUpdate:modelValue"]),(0,n.createVNode)(m,{disabled:!s.IsLogin,onClick:a=>s.HandleSettingBtnClick(t,"cc",e.CC)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,n.createVNode)(l,{label:"CV"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ba,[(0,n.createVNode)(c,{precision:2,disabled:"",modelValue:e.CV,"onUpdate:modelValue":t=>e.CV=t},null,8,["modelValue","onUpdate:modelValue"]),(0,n.createVNode)(m,{disabled:!s.IsLogin,onClick:a=>s.HandleSettingBtnClick(t,"cv",e.CV)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,n.createVNode)(l,{label:"FV"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",La,[(0,n.createVNode)(c,{precision:2,disabled:"",modelValue:e.FV,"onUpdate:modelValue":t=>e.FV=t},null,8,["modelValue","onUpdate:modelValue"]),(0,n.createVNode)(m,{disabled:!s.IsLogin,onClick:a=>s.HandleSettingBtnClick(t,"fv",e.FV)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,n.createVNode)(l,{label:"TC"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ma,[(0,n.createVNode)(c,{precision:2,disabled:"",modelValue:e.TC,"onUpdate:modelValue":t=>e.TC=t},null,8,["modelValue","onUpdate:modelValue"]),(0,n.createVNode)(m,{disabled:!s.IsLogin,onClick:a=>s.HandleSettingBtnClick(t,"tc",e.TC)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024)])),_:2},1024),Oa,Ga])])]),(0,n.createElementVNode)("div",Ra,[Ha,(0,n.createTextVNode)(" "+(0,n.toDisplayString)(s.FormatTime(e.UpdateTime)),1)])])),_:2},1032,["label"])))),128))])),_:1}),(0,n.createVNode)(g,{draggable:"",title:`${i.DialogData.EqName}-${i.DialogData.Item.toUpperCase()} 設定`,width:"300px",modelValue:i.SettingDialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>i.SettingDialogVisible=e)},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{class:"border-top py-2","label-width":"60px"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:i.DialogData.Item.toUpperCase()},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(p,{step:.1,precision:2,modelValue:i.DialogData.Value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.DialogData.Value=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,n.createElementVNode)("div",Fa,[(0,n.createVNode)(m,{type:"primary",onClick:s.HandleConfirmClick},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("確定")])),_:1},8,["onClick"]),(0,n.createVNode)(m,{type:"danger",onClick:t[1]||(t[1]=e=>i.SettingDialogVisible=!1)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("取消")])),_:1})])])),_:1},8,["title","modelValue"])])}var Za={computed:{charge_station_data(){return O.jU.getters.ChargeStationData},IsLogin(){return O.HP.getters.IsLogin}},data(){return{select:1,SettingDialogVisible:!1,DialogData:{EqName:"",Item:"CC",Value:33}}},methods:{GetTagType(e){return e.Connected?0==e.ErrorCodes.length?"success":"warning":"danger"},FormatTime(e){return ga()(e).format("yyyy/MM/DD HH:mm:ss")},HandleSettingBtnClick(e,t,a){this.DialogData.EqName=e,this.DialogData.Item=t,this.DialogData.Value=a,this.SettingDialogVisible=!0},HandleConfirmClick(){this.SettingDialogVisible=!1,this.$swal.fire({text:"",title:`確定要將${this.DialogData.EqName} ${this.DialogData.Item.toUpperCase()} 更改為 ${this.DialogData.Value} ?`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=await Ge.yS.SetCurveSetting(this.DialogData.EqName,this.DialogData.Item,this.DialogData.Value),a=t.confirm?"success":"error";this.$swal.fire({text:t.confirm?"":t.message,title:t.confirm?"修改成功":"修改失敗",icon:a,showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert",timer:t.confirm?3e3:-1}).then((e=>{t.confirm||(this.SettingDialogVisible=!0)}))}else this.SettingDialogVisible=!0}))}}};const $a=(0,f.Z)(Za,[["render",Ua]]);var qa=$a;const za={class:"border p-2 text-start"},Qa={class:"w-100 border-bottom my-1"},ja={class:"mx-2"},Ya=["id"],Ka={class:"px-2 text-start"},Wa={class:"text-start w-100"};function Ja(e,t,a,o,i,s){const r=(0,n.resolveComponent)("el-button"),l=(0,n.resolveComponent)("el-table-column"),d=(0,n.resolveComponent)("el-option"),c=(0,n.resolveComponent)("el-select"),m=(0,n.resolveComponent)("el-tag"),u=(0,n.resolveComponent)("el-input-number"),h=(0,n.resolveComponent)("el-input"),p=(0,n.resolveComponent)("el-table"),g=(0,n.resolveComponent)("el-drawer");return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[(0,n.createElementVNode)("div",za,[(0,n.createElementVNode)("div",Qa,[(0,n.createVNode)(r,{class:"my-1",type:"danger",onClick:t[0]||(t[0]=()=>{i.hotRunScripts.push({no:i.hotRunScripts.length+1,agv_name:void 0,loop_num:10,finish_num:0,action_num:9,state:"IDLE",actions:[]})})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("新增動作")])),_:1}),(0,n.createVNode)(r,{onClick:s.HandleSaveBtnClick,type:"primary"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("儲存設定")])),_:1},8,["onClick"])]),(0,n.createVNode)(p,{"row-key":"no",data:i.hotRunScripts,"default-expand-all":!1,border:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"NO.",prop:"no",width:"60",align:"center"}),(0,n.createVNode)(l,{label:"執行AGV",prop:"agv_name",width:"150"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(c,{modelValue:e.row.agv_name,"onUpdate:modelValue":t=>e.row.agv_name=t},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.AgvNameList,(e=>((0,n.openBlock)(),(0,n.createBlock)(d,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])])),_:1}),(0,n.createVNode)(l,{label:"狀態",prop:"state",width:"120",align:"center"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(m,{effect:"dark",type:"Running"==e.row.state?"success":"warning"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.row.state),1)])),_:2},1032,["type"])])])),_:1}),(0,n.createVNode)(l,{label:"已完成次數",prop:"finish_num",width:"100",align:"center"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,(0,n.toDisplayString)(e.row.finish_num)+"/"+(0,n.toDisplayString)(e.row.loop_num),1)])),_:1}),(0,n.createVNode)(l,{label:"Loop次數",prop:"finish_num",width:"120",align:"center"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(u,{size:"small",style:{width:"80px"},step:1,precision:0,modelValue:e.row.loop_num,"onUpdate:modelValue":t=>e.row.loop_num=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"動作數",width:"140"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createElementVNode)("span",ja,(0,n.toDisplayString)(e.row.actions.length),1),(0,n.createVNode)(r,{size:"small",onClick:()=>{i.action_drawer_visible=!0,i.selected_script_name=e.row.agv_name,i.selected_script_actions=e.row.actions}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("動作設定")])),_:2},1032,["onClick"])])])),_:1}),(0,n.createVNode)(l,{label:"Comment",width:"240"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(h,{modelValue:e.row.comment,"onUpdate:modelValue":t=>e.row.comment=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,n.createVNode)(l,null,{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createVNode)(r,{type:"Running"==e.row.state?"danger":"success",size:"small",onClick:t=>s.HandleStartBtnClick(e.row)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)("Running"==e.row.state?"中止":"執行"),1)])),_:2},1032,["type","onClick"]),(0,n.createVNode)(r,{size:"small",onClick:t=>s.HandleDeleteScript(e.row),type:"danger"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("刪除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"]),(0,n.createVNode)(g,{modelValue:i.action_drawer_visible,"onUpdate:modelValue":t[2]||(t[2]=e=>i.action_drawer_visible=e),direction:"rtl",size:"60%"},{header:(0,n.withCtx)((({titleId:e,titleClass:t})=>[(0,n.createElementVNode)("h4",{class:(0,n.normalizeClass)(["text-danger px-5 text-center",t]),id:e},"HOT RUN Actions Setting : "+(0,n.toDisplayString)(i.selected_script_name),11,Ya)])),default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ka,[(0,n.createVNode)(r,{class:"mx-2",type:"danger",onClick:t[1]||(t[1]=()=>{i.selected_script_actions.push({no:i.selected_script_actions.length+1,action:"move",source_tag:void 0,destine_tag:void 0})})},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("新增動作")])),_:1}),(0,n.createVNode)(r,{class:"mx-2",onClick:s.HandleSaveBtnClickInDrawer,type:"primary"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("儲存設定")])),_:1},8,["onClick"]),(0,n.createVNode)(p,{"row-key":"no",style:{width:"1024px"},border:"",class:"m-2",data:i.selected_script_actions},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{width:"50"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",Wa,[(0,n.createVNode)(r,{class:"w-100",size:"small",onClick:t=>s.action_move_up(e.row)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("▲")])),_:2},1032,["onClick"]),(0,n.createVNode)(r,{class:"w-100",size:"small",onClick:t=>s.action_move_down(e.row)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("▼")])),_:2},1032,["onClick"])])])),_:1}),(0,n.createVNode)(l,{label:"NO.",prop:"no",width:"60",align:"center"}),(0,n.createVNode)(l,{label:"動作",prop:"action",width:"120"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(c,{class:"w-100",modelValue:e.row.action,"onUpdate:modelValue":t=>e.row.action=t,placeholder:"請選擇Action"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{label:"移動",value:"move"}),(0,n.createVNode)(d,{label:"停車",value:"park"}),(0,n.createVNode)(d,{label:"搬運",value:"carry"}),(0,n.createVNode)(d,{label:"放貨",value:"load"}),(0,n.createVNode)(d,{label:"取貨",value:"unload"}),(0,n.createVNode)(d,{label:"充電",value:"charge"}),(0,n.createVNode)(d,{label:"巡檢量測",value:"measure"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"起點",prop:"source_tag",width:"250"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(c,{disabled:"carry"!=e.row.action,class:"w-100",modelValue:e.row.source_tag,"onUpdate:modelValue":t=>e.row.source_tag=t,placeholder:"請選擇起點"},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.GetOption(e.row.action),(e=>((0,n.openBlock)(),(0,n.createBlock)(d,{key:e,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"卡匣ID",width:"150"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(h,{disabled:"carry"!=e.row.action&&"unload"!=e.row.action,modelValue:e.row.cst_id,"onUpdate:modelValue":t=>e.row.cst_id=t},null,8,["disabled","modelValue","onUpdate:modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"終點",prop:"destine_tag",width:"250"},{default:(0,n.withCtx)((e=>["measure"!=e.row.action?((0,n.openBlock)(),(0,n.createBlock)(c,{key:0,class:"w-100",modelValue:e.row.destine_tag,"onUpdate:modelValue":t=>e.row.destine_tag=t,placeholder:"請選擇終點"},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.GetOption(e.row.action),(e=>((0,n.openBlock)(),(0,n.createBlock)(d,{key:e,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):((0,n.openBlock)(),(0,n.createBlock)(c,{key:1,class:"w-100",modelValue:e.row.destine_name,"onUpdate:modelValue":t=>e.row.destine_name=t,placeholder:"請選擇終點"},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.GetOption(e.row.action),(e=>((0,n.openBlock)(),(0,n.createBlock)(d,{key:e,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]))])),_:1}),(0,n.createVNode)(l,null,{default:(0,n.withCtx)((e=>[(0,n.createVNode)(r,{onClick:t=>s.HandleDeleteHotRunAction(e.row),size:"small",type:"danger"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("Delete")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue"])])])}var Xa={data(){return{hotRunScripts:[{no:1,agv_name:"AGV_001",loop_num:10,finish_num:0,state:"IDLE",actions:[{no:1,action:"move",source_tag:0,destine_tag:2,cst_id:""},{no:2,action:"move",source_tag:0,destine_tag:2,cst_id:""}]}],action_drawer_visible:!1,selected_script_name:"123",selected_script_actions:[]}},methods:{GetOption(e){return"move"==e?this.moveable_tags:"park"==e?this.parkable_tags:"load"==e|"unload"==e|"carry"==e?this.stock_tags:"charge"==e?this.chargable_tags:"measure"==e?this.bay_tags:void 0},action_move_up(e){var t=this.selected_script_actions.indexOf(e);0!=t&&(this.selected_script_actions=this.move_element_up(this.selected_script_actions,t))},action_move_down(e){var t=this.selected_script_actions.indexOf(e);t!=this.selected_script_actions.length-1&&(this.selected_script_actions=this.move_element_down(this.selected_script_actions,t))},move_element_up(e,t){if(t>0&&t<e.length){const a=e[t];e.splice(t,1),e.splice(t-1,0,a);for(let t=0;t<e.length;t++)e[t].no=t+1;return e}},move_element_down(e,t){if(t>=0&&t<e.length-1){const a=e[t];e.splice(t,1),e.splice(t+1,0,a);for(let t=0;t<e.length;t++)e[t].no=t+1;return e}},async HandleStartBtnClick(e){"IDLE"==e.state?this.$swal.fire({text:"",title:"執行Hot Run ?",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async t=>{if(t.isConfirmed){var a=await(0,M.Qk)(e.no);a.confirm?this.$swal.fire({text:"",title:"HOT RUN Start!",icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):this.$swal.fire({text:a.message,title:"無法執行HOT RUN",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}})):this.$swal.fire({text:"",title:"確定要終止?",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((t=>{t.isConfirmed&&(0,M.AZ)(e.no)}))},async HandleSaveBtnClick(){var e=await(0,M.A5)(this.hotRunScripts);this.$swal.fire({text:e.result?"":e.message,title:e.result?"儲存成功":"儲存失敗",icon:e.result?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert",timer:e.result?1e3:void 0})},async HandleSaveBtnClickInDrawer(){this.action_drawer_visible=!1,setTimeout((async()=>{await this.HandleSaveBtnClick(),setTimeout((()=>{this.action_drawer_visible=!0}),1e3)}),100)},HandleDeleteHotRunAction(e){var t=this.selected_script_actions.indexOf(e);this.selected_script_actions.splice(t,1)},HandleDeleteScript(e){this.$swal.fire({text:"",title:"確定要刪除此腳本?",icon:"warning",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((t=>{if(t.isConfirmed){"Running"==e.state&&(0,M.AZ)(e.no),this.hotRunScripts.splice(this.hotRunScripts.indexOf(e),1);for(let e=0;e<this.hotRunScripts.length;e++)this.hotRunScripts[e].no=e+1}}))}},computed:{AgvNameList(){return O.sn.getters.AGVNameList},moveable_tags(){return _.p.getters.AllNormalStationOptions},stock_tags(){return _.p.getters.AllEqStation},chargable_tags(){return _.p.getters.AllChargeStation},parkable_tags(){return _.p.getters.AllParkingStationOptions},bay_tags(){var e=_.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},hot_run_states(){return O.sn.getters.HotRunStates}},mounted(){setTimeout((async()=>{this.hotRunScripts=await(0,M.gh)(),(0,n.watch)((()=>this.hot_run_states),((e,t)=>{for(let o=0;o<e.length;o++){const t=e[o];var a=this.hotRunScripts.find((e=>e.no==t.no));a&&(a.state=t.state,a.finish_num=t.finish_num)}}),{deep:!0,immediate:!0})}),100)}};const eo=(0,f.Z)(Xa,[["render",Ja],["__scopeId","data-v-dee378c6"]]);var to=eo,ao={components:{UserManager:aa,EQManager:fa,AGVBatterySetting:Na,ChargeStationView:qa,HotRUniew:to},data(){return{activeTab:0,tabID:{user_manager:"user_manager"}}},methods:{TabActiveHandle(e){2==e&&this.$refs["user_manager"].DownloadUsers()},updateTabContent(){this.$nextTick((()=>{}))}},mounted(){this.$nextTick((()=>{this.updateTabContent()}))},watch:{activeTab(e){null!==e&&this.updateTabContent()}}};const oo=(0,f.Z)(ao,[["render",Ut]]);var no=oo;const io={class:"data-view custom-tabs-head-large"},so={class:"w-100"},ro={class:"w-100"},lo={class:"w-100"},co={class:"w-100"};function mo(e,t,a,o,i,s){const r=(0,n.resolveComponent)("TaskQuery"),l=(0,n.resolveComponent)("b-tab"),d=(0,n.resolveComponent)("AlarmQuery"),c=(0,n.resolveComponent)("AGVLocusDisplay"),m=(0,n.resolveComponent)("InstrumentMeasureQuery"),u=(0,n.resolveComponent)("AvalibilityQuery"),h=(0,n.resolveComponent)("b-tabs");return(0,n.openBlock)(),(0,n.createElementBlock)("div",io,[(0,n.createVNode)(h,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{title:"歷史任務查詢"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",so,[(0,n.createVNode)(r)])])),_:1}),(0,n.createVNode)(l,{title:"歷史警報查詢"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",ro,[(0,n.createVNode)(d)])])),_:1}),(0,n.createVNode)(l,{title:"AGV軌跡查詢"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",lo,[(0,n.createVNode)(c)])])),_:1}),(0,n.createVNode)(l,{title:"儀器量測結果查詢"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",co,[(0,n.createVNode)(m)])])),_:1}),(0,n.createVNode)(l,{title:"機台稼動"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(h,{style:{height:"100vh"}},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{title:"查詢"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(u)])),_:1})])),_:1})])),_:1})])),_:1})])}const uo={class:"data-view text-start p-2"},ho=(0,n.createElementVNode)("h3",null,"今日稼動狀態",-1),po={class:"bg-light py-3 mx-1 border"};function go(e,t,a,o,i,s){const r=(0,n.resolveComponent)("AvailabilityTimelineChart");return(0,n.openBlock)(),(0,n.createElementBlock)("div",uo,[ho,(0,n.createElementVNode)("div",po,[(0,n.createVNode)(r,{ref:"rt-availbility-chart"},null,512)])])}var _o=a(56265),vo=a.n(_o),fo=vo().create({baseURL:Nt.Z.backend_host});async function wo(){console.log(Date.now());var e=await fo.get("api/Availabilitys/Today");return console.log(Date.now()),e.data}async function yo(e,t,a){var o=await fo.get(`api/Availabilitys/Query?AGVName=${e}&StartDate=${t}&EndDate=${a}`);return o.data}const Vo={class:"border rounded",style:{height:"600px",width:"95%",display:"flex","flex-direction":"column"}};function Co(e,t,a,o,i,s){const r=(0,n.resolveComponent)("vue3-chart-js");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Vo,[((0,n.openBlock)(),(0,n.createBlock)(r,{key:i.myChart.type,ref:"chartRef",id:i.myChart.id,type:i.myChart.type,data:i.myChart.data,options:i.myChart.options,onBeforeRender:s.beforeRenderLogic},null,8,["id","type","data","options","onBeforeRender"]))])}var No=a(78855),bo={components:{Vue3ChartJs:No.Z},props:{ava_datas:{type:Array,default(){return[1,1,1,1,1]}},colorSet:{type:Array,default(){return["rgb(2, 176, 8)","rgb(255, 226, 6)","rgb(255, 92, 92)","rgb(51, 207, 255)","rgb(186, 186, 186)"]}}},data(){return{myChart:{id:"pie",type:"pie",data:{labels:["RUN","IDLE","DOWN","CHARGE","UNKNOWN","UNKNOWN"],datasets:[{backgroundColor:this.colorSet,data:[0,0,0,0,0]}]},options:{responsive:!0,maintainAspectRatio:!1,animations:{tension:{duration:1e3,easing:"linear",from:1,to:0,loop:!0}},scales:{},plugins:{legend:{position:"top"},title:{display:!0,text:"稼動率"}}}}}},methods:{beforeRenderLogic(e){},updateChart(e){this.myChart.type="pie",this.myChart.options.scales=void 0,this.myChart.data.datasets[0].data=e,this.$refs.chartRef.update()},updateStackBarChart(e={dates:[],idle:[],run:[],down:[],charge:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"IDLE",data:e.idle,backgroundColor:this.colorSet[1],stack:"Stack 1"},{label:"RUN",data:e.run,backgroundColor:this.colorSet[0],stack:"Stack 1"},{label:"DOWN",data:e.down,backgroundColor:this.colorSet[2],stack:"Stack 1"},{label:"CHARGE",data:e.charge,backgroundColor:this.colorSet[3],stack:"Stack 1"}];try{this.$refs.chartRef.update()}catch(t){}}},mounted(){(0,n.watch)((()=>this.ava_datas),((e,t)=>{this.updateChart(e)}),{deep:!0})}};const ko=(0,f.Z)(bo,[["render",Co]]);var So=ko;const xo={class:"w-100 rounded",id:"my-timeline-chart"},Eo={class:"my-legend px-5 my-3 d-flex flex-row justify-content-between"},To={style:{"font-size":"9px"}};function Do(e,t,a,o,i,s){const r=(0,n.resolveComponent)("apexchart"),l=(0,n.resolveDirective)("loading");return(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createElementBlock)("div",xo,[(0,n.createElementVNode)("div",Eo,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.colors,((e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{class:"d-flex flex-row mx-1",key:t},[(0,n.createElementVNode)("div",{class:"mt-1 mx-1 rounded",style:(0,n.normalizeStyle)({backgroundColor:e,height:"10px",width:"40px"})},null,4),(0,n.createElementVNode)("span",To,(0,n.toDisplayString)(t.toUpperCase()),1)])))),128))]),(0,n.createVNode)(r,{ref:"apex-chart",width:"100%",height:"400",type:"rangeBar",options:i.chartOptions,series:i.series},null,8,["options","series"])])),[[l,i.loading]])}var Po={data(){return{loading:!1,colors:{run:"rgb(98, 243, 166)",idle:"rgb(255, 226, 6)",down:"rgb(219, 7, 0)",charge:"rgb(51, 207, 255)",unknown:"rgb(186, 186, 186)"},series:[],chartOptions:{chart:{height:550,type:"rangeBar",animations:{enabled:!1,dynamicAnimation:{enabled:!1,speed:350}}},dynamicUpdate:!1,plotOptions:{bar:{horizontal:!0,barHeight:"80%"}},xaxis:{type:"datetime"},stroke:{width:0},fill:{type:"solid",opacity:1},legend:{show:!1}},data:{},datetime:1}},computed:{chart(){return this.$refs["apex-chart"]}},methods:{async RenderChart(e){this.data=e;var t=[];this.chart.updateSeries(t),console.log("1",Date.now()),Object.keys(e).forEach((a=>{t.push(this.BuildDataSeries(a,e[a]))})),this.chart.updateSeries(t,!1),console.log("2",Date.now()),setTimeout((()=>{this.loading=!1}),600)},BuildDataSeries(e,t){var a={name:e,data:[]};return t.idle.forEach((t=>{a.data.push({x:e,y:[new Date(t.from).getTime(),new Date(t.to).getTime()],fillColor:this.colors.idle})})),t.run.forEach((t=>{a.data.push({x:e,y:[new Date(t.from).getTime(),new Date(t.to).getTime()],fillColor:this.colors.run})})),t.down.forEach((t=>{a.data.push({x:e,y:[new Date(t.from).getTime(),new Date(t.to).getTime()],fillColor:this.colors.down})})),t.charge.forEach((t=>{a.data.push({x:e,y:[new Date(t.from).getTime(),new Date(t.to).getTime()],fillColor:this.colors.charge})})),t.unknown.forEach((t=>{a.data.push({x:e,y:[new Date(t.from).getTime(),new Date(t.to).getTime()],fillColor:this.colors.unknown})})),a}},mounted(){}};const Ao=(0,f.Z)(Po,[["render",Do]]);var Io=Ao,Bo={components:{AvailabilityPieChart:So,AvailabilityTimelineChart:Io},data(){return{data:[2,33,1,2,3],todayData:{},pause:!0,timer:void 0}},mounted(){this.FetchTodayDataAndRender();const e=(0,o.yj)();(0,n.watch)((()=>e.path),((e,t)=>{this.pause="/data"!=e,this.pause?this.StopTimer():this.StartTimer()}))},computed:{todayTimelineChart(){return this.$refs["rt-availbility-chart"]}},methods:{async FetchTodayDataAndRender(){this.todayData=await wo(),this.todayTimelineChart&&this.todayTimelineChart.RenderChart(this.todayData)},StartTimer(){this.FetchTodayDataAndRender()},StopTimer(){this.timer&&clearInterval(this.timer)}}};const Lo=(0,f.Z)(Bo,[["render",go]]);var Mo=Lo;const Oo={class:"avalibity-query d-flex flex-row"},Go={class:"options text-start h-100 p-3 bg-light border"},Ro={class:"chart-display h-100 w-100 d-flex justify-content-center"},Ho={class:"w-100 m-1"},Fo={class:"m-2 p-1"};function Uo(e,t,a,o,i,s){const r=(0,n.resolveComponent)("AGVSelector"),l=(0,n.resolveComponent)("el-form-item"),d=(0,n.resolveComponent)("el-date-picker"),c=(0,n.resolveComponent)("b-button"),m=(0,n.resolveComponent)("el-form"),u=(0,n.resolveComponent)("el-radio-button"),h=(0,n.resolveComponent)("el-radio-group"),p=(0,n.resolveComponent)("AvailabilityPieChart");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Oo,[(0,n.createElementVNode)("div",Go,[(0,n.createVNode)(m,{model:i.options},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"AGV名稱"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{modelValue:i.options.AGVName,"onUpdate:modelValue":t[0]||(t[0]=e=>i.options.AGVName=e)},null,8,["modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"起始日期"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{"value-format":"YYYY-MM-DD",modelValue:i.options.StartDate,"onUpdate:modelValue":t[1]||(t[1]=e=>i.options.StartDate=e)},null,8,["modelValue"])])),_:1}),(0,n.createVNode)(l,{label:"結束日期"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{"value-format":"YYYY-MM-DD",modelValue:i.options.EndDate,"onUpdate:modelValue":t[2]||(t[2]=e=>i.options.EndDate=e)},null,8,["modelValue"])])),_:1}),(0,n.createVNode)(l,null,{default:(0,n.withCtx)((()=>[(0,n.createVNode)(c,{onClick:s.QueryData,class:"w-100",variant:"primary"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("查詢")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,n.createElementVNode)("div",Ro,[(0,n.createElementVNode)("div",Ho,[(0,n.createVNode)(h,{modelValue:i.chart_type,"onUpdate:modelValue":t[3]||(t[3]=e=>i.chart_type=e),onChange:s.HandleChartTypeChanged},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(u,{size:"large",label:"pie"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("圓餅圖")])),_:1}),(0,n.createVNode)(u,{size:"large",label:"bar"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("直條圖")])),_:1})])),_:1},8,["modelValue","onChange"]),(0,n.createElementVNode)("div",Fo,[(0,n.withDirectives)((0,n.createVNode)(p,{class:"",ref:"piechart"},null,512),[[n.vShow,"pie"==i.chart_type]]),(0,n.withDirectives)((0,n.createVNode)(p,{class:"",ref:"barchart"},null,512),[[n.vShow,"bar"==i.chart_type]])])])])])}var Zo=a(50462),$o={components:{AvailabilityPieChart:So,AGVSelector:Zo.Z},data(){return{loading:!1,chart_type:"pie",options:{AGVName:"AGV_001",StartDate:"",EndDate:""},query_data:{total:[],days:{dates:[],idle:[],run:[],down:[],charge:[]}}}},computed:{agvNameList(){return O.sn.getters.AGVNameList}},mounted(){this.options.StartDate=ga()(Date.now()).add(-7,"days").format("YYYY-MM-DD"),this.options.EndDate=ga()(Date.now()).format("YYYY-MM-DD")},methods:{async QueryData(){this.loading=!0,this.query_data=await yo(this.options.AGVName,this.options.StartDate,this.options.EndDate),this.$refs["barchart"].updateStackBarChart(this.query_data.days),this.$refs["piechart"].updateChart(this.query_data.total),setTimeout((()=>{this.loading=!1}),400)},HandleChartTypeChanged(){}}};const qo=(0,f.Z)($o,[["render",Uo],["__scopeId","data-v-0787ab0b"]]);var zo=qo;const Qo={class:"alarm-query"},jo={class:"query-options bg-light d-flex border-bottom w-100 py-2"},Yo=(0,n.createElementVNode)("label",null,"Start Time",-1),Ko=(0,n.createElementVNode)("label",null,"End Time",-1),Wo=(0,n.createElementVNode)("label",null,"警報類型",-1),Jo=(0,n.createElementVNode)("option",null,"ALL",-1),Xo=(0,n.createElementVNode)("option",{class:"bg-danger text-light"},"Alarm",-1),en=(0,n.createElementVNode)("option",{class:"bg-warning text-light"},"Warning",-1),tn=[Jo,Xo,en],an=(0,n.createElementVNode)("label",null,"EQ Name",-1),on=(0,n.createElementVNode)("option",null,"ALL",-1),nn=(0,n.createElementVNode)("label",null,"任務名稱",-1),sn=["onClick"],rn={class:"d-flex flex-row justify-content-center"},ln={class:"mx-3 py-2"},dn={style:{"font-weight":"bold","font-size":"large"}};function cn(e,t,a,o,i,s){const r=(0,n.resolveComponent)("b-button"),l=(0,n.resolveComponent)("el-table-column"),d=(0,n.resolveComponent)("el-tag"),c=(0,n.resolveComponent)("el-tooltip"),m=(0,n.resolveComponent)("el-table"),u=(0,n.resolveComponent)("b-pagination");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Qo,[(0,n.createElementVNode)("div",jo,[Yo,(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>i.start_time=e),prop:"Start Time"},null,512),[[n.vModelText,i.start_time]]),Ko,(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>i.end_time=e),prop:"End Time"},null,512),[[n.vModelText,i.end_time]]),Wo,(0,n.withDirectives)((0,n.createElementVNode)("select",{class:(0,n.normalizeClass)("ALL"==i.AlarmTypeSelected?"":"Alarm"==i.AlarmTypeSelected?"bg-danger text-light":"bg-warning text-light"),prop:"EQ Name","onUpdate:modelValue":t[2]||(t[2]=e=>i.AlarmTypeSelected=e)},tn,2),[[n.vModelSelect,i.AlarmTypeSelected]]),an,(0,n.withDirectives)((0,n.createElementVNode)("select",{prop:"EQ Name","onUpdate:modelValue":t[3]||(t[3]=e=>i.AGVSelected=e)},[on,((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.AgvNameList,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("option",{key:e},(0,n.toDisplayString)(e),1)))),128))],512),[[n.vModelSelect,i.AGVSelected]]),nn,(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>i.TaskName=e),placeholder:"ALL",size:"20"},null,512),[[n.vModelText,i.TaskName]]),(0,n.createVNode)(r,{onClick:t[5]||(t[5]=e=>s.QueryAlarm()),QueryAlarm:s.QueryAlarm,class:"Select-Query",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("搜尋")])),_:1},8,["QueryAlarm"]),(0,n.createVNode)(r,{onClick:t[6]||(t[6]=e=>s.SaveTocsv()),SaveTocsv:s.SaveTocsv,class:"SaveTocsv mx-2",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("輸出csv檔")])),_:1},8,["SaveTocsv"])]),(0,n.createElementVNode)("div",null,[(0,n.createVNode)(m,{border:"",data:i.alarms,"empty-text":"No Alarms","row-class-name":s.row_state_class_name,size:"small",style:{width:"100%","font-weight":"bold"},"aria-current":"currentpage",id:"alarmtable"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"發生時間",prop:"Time",width:"140"},{default:(0,n.withCtx)((e=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.formatTime(e.row.Time)),1)])),_:1}),(0,n.createVNode)(l,{label:"AGV名稱",prop:"Equipment_Name",width:"80",align:"center"}),(0,n.createVNode)(l,{label:"警報碼",prop:"AlarmCode",width:"60",align:"center"}),(0,n.createVNode)(l,{label:"警報描述",prop:"Description_En","min-width":"420"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,(0,n.toDisplayString)(e.row.Description_En)+"("+(0,n.toDisplayString)(e.row.Description_Zh)+")",1)])),_:1}),(0,n.createVNode)(l,{label:"警報類型",prop:"Level",width:"100",align:"center"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(d,{style:{width:"80px"},effect:"dark",type:1==e.row.Level?"danger":"warning"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(1==e.row.Level?"Alarm":"Warning"),1)])),_:2},1032,["type"])])),_:1}),(0,n.createVNode)(l,{label:"任務名稱",prop:"Task_Name",width:"210"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createTextVNode)((0,n.toDisplayString)(e.row.Task_Name)+" ",1),(0,n.createVNode)(c,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,n.withCtx)((()=>[""!=e.row.Task_Name?((0,n.openBlock)(),(0,n.createElementBlock)("i",{key:0,onClick:t=>s.CopyText(e.row.Task_Name),class:"copy-button copy-icon bi bi-clipboard"},null,8,sn)):(0,n.createCommentVNode)("",!0)])),_:2},1024)])])),_:1}),(0,n.createVNode)(l,{label:"發生地點",prop:"OccurLocation",width:"120",align:"center"}),(0,n.createVNode)(l,{label:"持續時間(s)",prop:"Duration",width:"90",align:"center"}),(0,n.createVNode)(l,{label:"清除警報人員",prop:"ResetAalrmMemberName","min-width":"120"})])),_:1},8,["data","row-class-name"]),(0,n.createElementVNode)("div",rn,[(0,n.createVNode)(u,{"per-page":i.per_page_num,"total-rows":i.rows,"aria-controls":"alarmtable",class:"pagination justify-content-center",modelValue:i.currentpage,"onUpdate:modelValue":t[7]||(t[7]=e=>i.currentpage=e),onClick:s.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,n.createElementVNode)("div",ln,[(0,n.createTextVNode)(" 共 "),(0,n.createElementVNode)("span",dn,(0,n.toDisplayString)(i.rows),1),(0,n.createTextVNode)("筆 ")])])])])}var mn=a(61623),un={data(){return{start_time:"2023-06-01 00:00:00",end_time:"2023-06-03 00:00:00",AGVSelected:"ALL",AlarmTypeSelected:"ALL",TaskName:"",alarms:[],per_page_num:19,rows:1,currentpage:1,loading:!1}},computed:{AgvNameList(){return O.sn.getters.AGVNameList}},mounted(){const e=new Date;this.end_time=e.toISOString().substring(0,10)+" 23:59:59",this.start_time=ga()(this.end_time,"YYYY-MM-DD HH:mm:ss").subtract(7,"days").format("YYYY-MM-DD HH:mm:ss"),setTimeout((()=>{(0,mn.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName).then((e=>{this.alarms=e.alarms,this.rows=e.count,this.currentpage=e.currentpage})).catch((e=>{B.Z.Danger("警報查詢失敗後端服務異常")}))}),500)},methods:{formatTime(e){return ga()(e).format("yyyy-MM-DD HH:mm:ss")},onmessage(e){this.alarms=JSON.parse(e.data)},row_state_class_name({row:e,rowIndex:t}){if(e.rowIndex<0)return"";var a=this.alarms[t].Level;return 1==a?"alarm-row":"warning-row"},async QueryAlarm(){this.loading=!0,this.alarms=[],this.rows=1,this.currentpage=1,this.payload=2,setTimeout((()=>{(0,mn.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.AlarmTypeSelected).then((e=>{this.alarms=e.alarms,this.rows=e.count,this.currentpage=e.currentpage})).then((e=>{})).catch((e=>{this.loading=!1,B.Z.Danger("警報查詢失敗後端服務異常")}))}),300)},async SaveTocsv(){await(0,mn.lF)(this.start_time,this.end_time,this.AGVSelected,this.TaskName),B.Z.Primary("檔案儲存成功")},PageChnageHandle(e){(0,mn.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.AlarmTypeSelected).then((e=>{this.alarms=e.alarms})).catch((e=>{B.Z.Danger("警報查詢失敗後端服務異常")}))},CopyText(e){xt(e)}}};const hn=(0,f.Z)(un,[["render",cn]]);var pn=hn;const gn=e=>((0,n.pushScopeId)("data-v-97a53476"),e=e(),(0,n.popScopeId)(),e),_n={class:"Task-query"},vn={class:"Task-options bg-light d-flex border-bottom w-100 py-2"},fn=gn((()=>(0,n.createElementVNode)("label",null,"Start Time",-1))),wn=gn((()=>(0,n.createElementVNode)("label",null,"End Time",-1))),yn=gn((()=>(0,n.createElementVNode)("label",null,"任務名稱",-1))),Vn=gn((()=>(0,n.createElementVNode)("label",null,"EQ Name",-1))),Cn=gn((()=>(0,n.createElementVNode)("option",null,"ALL",-1))),Nn=gn((()=>(0,n.createElementVNode)("label",null,"任務類型",-1))),bn=gn((()=>(0,n.createElementVNode)("option",null,"ALL",-1))),kn=gn((()=>(0,n.createElementVNode)("option",null,"移動",-1))),Sn=gn((()=>(0,n.createElementVNode)("option",null,"取貨",-1))),xn=gn((()=>(0,n.createElementVNode)("option",null,"放貨",-1))),En=gn((()=>(0,n.createElementVNode)("option",null,"搬運",-1))),Tn=gn((()=>(0,n.createElementVNode)("option",null,"充電",-1))),Dn=gn((()=>(0,n.createElementVNode)("option",null,"量測",-1))),Pn=gn((()=>(0,n.createElementVNode)("option",null,"交換電池",-1))),An=[bn,kn,Sn,xn,En,Tn,Dn,Pn],In=gn((()=>(0,n.createElementVNode)("label",null,"執行結果",-1))),Bn=gn((()=>(0,n.createElementVNode)("option",null,"ALL",-1))),Ln=gn((()=>(0,n.createElementVNode)("option",null,"完成",-1))),Mn=gn((()=>(0,n.createElementVNode)("option",null,"失敗",-1))),On=gn((()=>(0,n.createElementVNode)("option",null,"取消",-1))),Gn=[Bn,Ln,Mn,On],Rn=["onClick"],Hn=["onClick"],Fn={class:"text-danger"},Un={class:"d-flex flex-row justify-content-center"},Zn={class:"mx-3 py-2"},$n={style:{"font-weight":"bold","font-size":"large"}};function qn(e,t,a,o,i,s){const r=(0,n.resolveComponent)("b-button"),l=(0,n.resolveComponent)("el-tooltip"),d=(0,n.resolveComponent)("el-table-column"),c=(0,n.resolveComponent)("el-tag"),m=(0,n.resolveComponent)("el-table"),u=(0,n.resolveComponent)("b-pagination"),h=(0,n.resolveDirective)("loading");return(0,n.openBlock)(),(0,n.createElementBlock)("div",_n,[(0,n.createElementVNode)("div",vn,[fn,(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>i.start_time=e),prop:"Start Time"},null,512),[[n.vModelText,i.start_time]]),wn,(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>i.end_time=e),prop:"End Time"},null,512),[[n.vModelText,i.end_time]]),yn,(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>i.TaskName=e),placeholder:"ALL",size:"20"},null,512),[[n.vModelText,i.TaskName]]),Vn,(0,n.withDirectives)((0,n.createElementVNode)("select",{prop:"EQ Name","onUpdate:modelValue":t[3]||(t[3]=e=>i.AGVSelected=e)},[Cn,((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.AgvNameList,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("option",{key:e},(0,n.toDisplayString)(e),1)))),128))],512),[[n.vModelSelect,i.AGVSelected]]),Nn,(0,n.withDirectives)((0,n.createElementVNode)("select",{prop:"EQ Name","onUpdate:modelValue":t[4]||(t[4]=e=>i.ActionTypeSelected=e)},An,512),[[n.vModelSelect,i.ActionTypeSelected]]),In,(0,n.withDirectives)((0,n.createElementVNode)("select",{prop:"EQ Name","onUpdate:modelValue":t[5]||(t[5]=e=>i.ExecuteResultSelected=e)},Gn,512),[[n.vModelSelect,i.ExecuteResultSelected]]),(0,n.createVNode)(r,{onClick:t[6]||(t[6]=e=>s.TaskQuery()),TaskQuery:s.TaskQuery,class:"Select-Query",variant:"primary mx-1",size:"sm",style:{float:"right"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("搜尋")])),_:1},8,["TaskQuery"]),(0,n.createVNode)(r,{onClick:t[7]||(t[7]=e=>s.SaveTocsv()),SaveTocsv:s.SaveTocsv,class:"SaveTocsv mx-2",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("輸出csv檔")])),_:1},8,["SaveTocsv"])]),(0,n.createElementVNode)("div",null,[(0,n.withDirectives)(((0,n.openBlock)(),(0,n.createBlock)(m,{data:i.tasks,"empty-text":"No Tasks","row-class-name":"row_state_class_name",size:"small",style:{width:"100%","font-weight":"bold"},border:"","aria-current":"currentpage",id:"Tasktable"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{label:"任務名稱",prop:"TaskName",width:"230"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createTextVNode)((0,n.toDisplayString)(e.row.TaskName)+" ",1),(0,n.createVNode)(l,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("i",{onClick:t=>s.CopyText(e.row.TaskName),class:"copy-button copy-icon bi bi-clipboard"},null,8,Rn)])),_:2},1024)])])),_:1}),(0,n.createVNode)(d,{label:"接收時間",prop:"RecieveTime",width:"160"},{default:(0,n.withCtx)((e=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.formatTime(e.row.RecieveTime)),1)])),_:1}),(0,n.createVNode)(d,{label:"結束時間",prop:"FinishTime",width:"160"},{default:(0,n.withCtx)((e=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.formatTime(e.row.FinishTime)),1)])),_:1}),(0,n.createVNode)(d,{label:"執行結果",prop:"StateName",width:"100",align:"center"},{default:(0,n.withCtx)((e=>[(0,n.createVNode)(c,{effect:"dark",type:4==e.row.State?"success":6==e.row.State?"danger":"warning"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.row.StateName),1)])),_:2},1032,["type"])])),_:1}),(0,n.createVNode)(d,{label:"AGV名稱",prop:"DesignatedAGVName",width:"100",align:"center"}),(0,n.createVNode)(d,{label:"任務類型",prop:"ActionName","min-width":"30",align:"center"}),(0,n.createVNode)(d,{label:"起始站點",prop:"From_Station",width:"120",align:"center"}),(0,n.createVNode)(d,{label:"結束站點",prop:"To_Station",width:"120",align:"center"}),(0,n.createVNode)(d,{label:"載物ID",prop:"Carrier_ID","min-width":"30"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,[(0,n.createTextVNode)((0,n.toDisplayString)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID)+" ",1),(0,n.createVNode)(l,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,n.withCtx)((()=>["-1"!=e.row.Carrier_ID&&""!=e.row.Carrier_ID?((0,n.openBlock)(),(0,n.createElementBlock)("i",{key:0,onClick:t=>s.CopyText(e.row.Carrier_ID),class:"copy-button copy-icon bi bi-clipboard"},null,8,Hn)):(0,n.createCommentVNode)("",!0)])),_:2},1024)])])),_:1}),(0,n.createVNode)(d,{label:"派工人員",prop:"DispatcherName",width:"100"}),(0,n.createVNode)(d,{label:"失敗原因",prop:"FailureReason","min-width":"120"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",Fn,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.row.FailureReason.split(","),(e=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:e},(0,n.toDisplayString)(e),1)))),128))])])),_:1})])),_:1},8,["data"])),[[h,i.loading]]),(0,n.createElementVNode)("div",Un,[(0,n.createVNode)(u,{"per-page":i.per_page_num,"total-rows":i.rows,"aria-controls":"Tasktable",class:"pagination justify-content-center",modelValue:i.currentpage,"onUpdate:modelValue":t[8]||(t[8]=e=>i.currentpage=e),onClick:s.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,n.createElementVNode)("div",Zn,[(0,n.createTextVNode)(" 共 "),(0,n.createElementVNode)("span",$n,(0,n.toDisplayString)(i.rows),1),(0,n.createTextVNode)("筆 ")])])])])}var zn=a(20840),Qn={data(){return{start_time:"2023-06-01 00:00:00",end_time:"2023-06-30 00:00:00",AGVSelected:"ALL",ExecuteResultSelected:"ALL",ActionTypeSelected:"ALL",TaskName:"",tasks:[],per_page_num:19,rows:1,currentpage:1,loading:!1}},computed:{AgvNameList(){return O.sn.getters.AGVNameList}},mounted(){const e=new Date;this.end_time=e.toISOString().substring(0,10)+" 23:59:59",this.start_time=ga()(this.end_time,"YYYY-MM-DD HH:mm:ss").subtract(7,"days").format("YYYY-MM-DD HH:mm:ss"),setTimeout((()=>{(0,zn.MM)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName).then((e=>{this.tasks=e.tasks,this.rows=e.count,this.currentpage=e.currentpage})).catch((e=>{B.Z.Danger("警報查詢失敗後端服務異常")}))}),500)},methods:{formatTime(e){return ga()(e).format("yyyy-MM-DD HH:mm:ss")},onmessage(e){this.tasks=JSON.parse(e.data)},async TaskQuery(){this.loading=!0,this.tasks=[],this.rows=1,this.currentpage=1,this.payload=2,setTimeout((()=>{(0,zn.MM)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.ExecuteResultSelected,this.ActionTypeSelected).then((e=>{this.tasks=e.tasks,this.rows=e.count,this.currentpage=e.currentpage,this.loading=!1})).catch((e=>{this.loading=!1,B.Z.Danger("警報查詢失敗後端服務異常")}))}),300)},async SaveTocsv(){(0,zn.lF)(this.start_time,this.end_time,this.AGVSelected,this.TaskName),B.Z.Primary("檔案儲存成功")},PageChnageHandle(e){(0,zn.MM)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.ExecuteResultSelected,this.ActionTypeSelected).then((e=>{this.tasks=e.tasks})).catch((e=>{B.Z.Danger("警報查詢失敗後端服務異常")}))},CopyText(e){xt(e)}}};const jn=(0,f.Z)(Qn,[["render",qn],["__scopeId","data-v-97a53476"]]);var Yn=jn,Kn=a(50053);const Wn={class:""},Jn={class:"w-100 my-1 border rounded p-2"};function Xn(e,t,a,o,i,s){const r=(0,n.resolveComponent)("CommonOptions"),l=(0,n.resolveComponent)("b-pagination"),d=(0,n.resolveComponent)("el-table-column"),c=(0,n.resolveComponent)("el-table");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Wn,[(0,n.createVNode)(r,{onOnQueryBtnClick:s.HandleQueryBtnClick},null,8,["onOnQueryBtnClick"]),(0,n.createElementVNode)("div",Jn,[(0,n.createVNode)(l,{"per-page":i.QueryResult.DataNumPerPage,"total-rows":i.QueryResult.TotalDataNum,"aria-controls":"measure_result_table",class:"pagination justify-content-start",modelValue:i.QueryResult.Page,"onUpdate:modelValue":t[0]||(t[0]=e=>i.QueryResult.Page=e),onClick:s.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,n.createVNode)(c,{border:"",data:i.QueryResult.dataList,style:{width:"1800px"},id:"measure_result_table"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{prop:"TaskName",label:"任務名稱",fixed:"left",width:"210"}),(0,n.createVNode)(d,{prop:"AGVName",label:"AGV名稱",fixed:"left",width:"90"}),(0,n.createVNode)(d,{prop:"BayName",label:"Bay名稱",fixed:"left",width:"90"}),(0,n.createVNode)(d,{prop:"location",label:"量測點位",fixed:"left"}),(0,n.createVNode)(d,{formatter:s.TimeFormatter,prop:"StartTime",label:"開始量測時間",fixed:"left",width:"180"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ResultFormatter,prop:"result",label:"量測結果",fixed:"left"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"illuminance",label:"照度(lux)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"decibel",label:"分貝(dB)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"temperature",label:"溫度 (℃)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"humudity",label:"濕度 (%)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"IPA",label:"IPA (異丙醇)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"Acetone",label:"Acetone (丙酮)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"TVOC",label:"TVOC (Non-Target)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"PID",label:"PID"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"partical_03um",label:"微塵粒子(0.3μm)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"partical_05um",label:"微塵粒子(0.5μm)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"partical_10um",label:"微塵粒子(1.0μm)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"partical_30um",label:"微塵粒子(3.0μm)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"partical_50um",label:"微塵粒子(5.0μm)"},null,8,["formatter"]),(0,n.createVNode)(d,{formatter:s.ValFormatter,prop:"partical_100um",label:"微塵粒子(10.0μm)",fixed:"right"},null,8,["formatter"])])),_:1},8,["data"])])])}const ei=e=>((0,n.pushScopeId)("data-v-41579660"),e=e(),(0,n.popScopeId)(),e),ti={class:"common-options"},ai={class:"options d-flex"},oi={class:"block"},ni=ei((()=>(0,n.createElementVNode)("div",{class:"title"},"開始時間",-1))),ii={class:"control"},si={class:"block"},ri=ei((()=>(0,n.createElementVNode)("div",{class:"title"},"結束時間",-1))),li={class:"control"},di={class:"block"},ci=ei((()=>(0,n.createElementVNode)("div",{class:"title"},"AGV",-1))),mi={class:"control"},ui={class:"block"},hi=ei((()=>(0,n.createElementVNode)("div",{class:"title"},"量測結果",-1))),pi={class:"control"},gi={class:"block"},_i=ei((()=>(0,n.createElementVNode)("div",{class:"title"},null,-1))),vi={class:"my-4"};function fi(e,t,a,o,i,s){const r=(0,n.resolveComponent)("el-date-picker"),l=(0,n.resolveComponent)("el-option"),d=(0,n.resolveComponent)("el-select"),c=(0,n.resolveComponent)("b-button");return(0,n.openBlock)(),(0,n.createElementBlock)("div",ti,[(0,n.createElementVNode)("div",ai,[(0,n.createElementVNode)("div",oi,[ni,(0,n.createElementVNode)("div",ii,[(0,n.createVNode)(r,{modelValue:i.OPTIONS.StartTimeStr,"onUpdate:modelValue":t[0]||(t[0]=e=>i.OPTIONS.StartTimeStr=e),type:"date",placeholder:"選擇開始日期"},null,8,["modelValue"])])]),(0,n.createElementVNode)("div",si,[ri,(0,n.createElementVNode)("div",li,[(0,n.createVNode)(r,{modelValue:i.OPTIONS.EndTimeStr,"onUpdate:modelValue":t[1]||(t[1]=e=>i.OPTIONS.EndTimeStr=e),type:"date",placeholder:"選擇結束日期"},null,8,["modelValue"])])]),(0,n.createElementVNode)("div",di,[ci,(0,n.createElementVNode)("div",mi,[(0,n.createVNode)(d,{modelValue:i.OPTIONS.AGVName,"onUpdate:modelValue":t[2]||(t[2]=e=>i.OPTIONS.AGVName=e)},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(s.AGVNameList,(e=>((0,n.openBlock)(),(0,n.createBlock)(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,n.createElementVNode)("div",ui,[hi,(0,n.createElementVNode)("div",pi,[(0,n.createVNode)(d,{modelValue:i.OPTIONS.Result,"onUpdate:modelValue":t[3]||(t[3]=e=>i.OPTIONS.Result=e)},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(a.Results,(e=>((0,n.openBlock)(),(0,n.createBlock)(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,n.createElementVNode)("div",gi,[_i,(0,n.createElementVNode)("div",vi,[(0,n.createVNode)(c,{onClick:s.HandleQueryBtnClick,variant:"primary"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("查詢")])),_:1},8,["onClick"])])])])])}var wi=a(19578),yi={components:{},props:{Results:{type:Array,default(){return[{value:2,label:"ALL"},{value:0,label:"成功"},{value:1,label:"失敗"}]}}},data(){return{OPTIONS:new wi.Z}},computed:{AGVNameList(){var e=["ALL"];return O.sn.getters.AGVNameList.forEach((t=>{e.push(t)})),e}},watch:{},methods:{HandleQueryBtnClick(){this.OPTIONS.Page=1,this.$emit("OnQueryBtnClick",this.OPTIONS)}},mounted(){}};const Vi=(0,f.Z)(yi,[["render",fi],["__scopeId","data-v-41579660"]]);var Ci=Vi,Ni=a(3567),bi={components:{CommonOptions:Ci},data(){return{QueryResult:{},Options:{}}},computed:{},watch:{},methods:{async HandleQueryBtnClick(e){this.Options=e,this.QueryResult=await(0,Ni.AE)(e)},ResultFormatter(e,t,a,o){return"done"==a?"成功":"失敗"},TimeFormatter(e,t,a,o){return ga()(a).format("yyyy-MM-DD \r\n HH:mm:ss")},ValFormatter(e,t,a,o){return"-1"==a||"-1.0"==a?"NA":a},PageChnageHandle(){this.Options.Page=this.QueryResult.Page,this.HandleQueryBtnClick(this.Options)}},mounted(){}};const ki=(0,f.Z)(bi,[["render",Xn]]);var Si=ki,xi={components:{AvailbilitysData:Mo,AvalibilityQuery:zo,AlarmQuery:pn,AGVLocusDisplay:Kn["default"],TaskQuery:Yn,InstrumentMeasureQuery:Si}};const Ei=(0,f.Z)(xi,[["render",mo]]);var Ti=Ei;const Di={class:"alarm-view"},Pi={class:"d-flex flex-row mb-2"},Ai=(0,n.createElementVNode)("h3",{class:"flex-fill"},"系統警報",-1),Ii=(0,n.createElementVNode)("h3",null,"設備警報",-1);function Bi(e,t,a,o,i,s){const r=(0,n.resolveComponent)("b-button"),l=(0,n.resolveComponent)("el-table-column"),d=(0,n.resolveComponent)("el-table"),c=(0,n.resolveComponent)("el-divider");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Di,[(0,n.createElementVNode)("div",Pi,[Ai,s.is_user_login?((0,n.openBlock)(),(0,n.createBlock)(r,{key:0,variant:"danger",onClick:t[0]||(t[0]=e=>s.ResetSystemAlarm())},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("警報復歸")])),_:1})):(0,n.createCommentVNode)("",!0)]),(0,n.createVNode)(d,{data:s.sys_alarms,border:"","row-class-name":s.row_state_class_name},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"時間",prop:"Time",width:"160"},{default:(0,n.withCtx)((e=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.formatTime(e.row.Time)),1)])),_:1}),(0,n.createVNode)(l,{label:"設備名稱",prop:"Equipment_Name",width:"120"}),(0,n.createVNode)(l,{label:"警報碼",prop:"AlarmCode",width:"120"}),(0,n.createVNode)(l,{label:"警報描述",prop:"Description_En"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,(0,n.toDisplayString)(e.row.Description_En)+"("+(0,n.toDisplayString)(e.row.Description_Zh)+")",1)])),_:1}),(0,n.createVNode)(l,{label:"警報類型",prop:"Level",width:"120"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,(0,n.toDisplayString)(1==e.row.Level?"ALARM":"WARNING"),1)])),_:1}),(0,n.createVNode)(l,{label:"任務名稱",prop:"Task_Name",width:"160"}),(0,n.createVNode)(l,{label:"發生地點",prop:"OccurLocation",width:"120"}),(0,n.createVNode)(l,{label:"持續時間",prop:"Duration",width:"120"}),(0,n.createVNode)(l,{label:"清除警報人員",prop:"ResetAalrmMemberName",width:"120"})])),_:1},8,["data","row-class-name"]),(0,n.createVNode)(c),Ii,(0,n.createVNode)(d,{data:s.eq_alarms,border:"","row-class-name":s.row_state_class_name},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"時間",prop:"Time",width:"160"},{default:(0,n.withCtx)((e=>[(0,n.createTextVNode)((0,n.toDisplayString)(s.formatTime(e.row.Time)),1)])),_:1}),(0,n.createVNode)(l,{label:"設備名稱",prop:"Equipment_Name",width:"150"}),(0,n.createVNode)(l,{label:"警報碼",prop:"AlarmCode",width:"120"}),(0,n.createVNode)(l,{label:"警報描述",prop:"Description_En"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,(0,n.toDisplayString)(e.row.Description_En)+"("+(0,n.toDisplayString)(e.row.Description_Zh)+")",1)])),_:1}),(0,n.createVNode)(l,{label:"警報類型",prop:"Level",width:"120"},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",null,(0,n.toDisplayString)(1==e.row.Level?"ALARM":"WARNING"),1)])),_:1}),(0,n.createVNode)(l,{label:"任務名稱",prop:"Task_Name",width:"160"}),(0,n.createVNode)(l,{label:"發生地點",prop:"OccurLocation",width:"120"}),(0,n.createVNode)(l,{label:"持續時間",prop:"Duration",width:"120"}),(0,n.createVNode)(l,{label:"清除警報人員",prop:"ResetAalrmMemberName",width:"120"})])),_:1},8,["data","row-class-name"])])}var Li={data(){return{alarms:[{Time:"2021/04/17 13:13:44",Level:"ALARM",Source:"System",AlarmCode:2,Description_Zh:"車載管理系統斷線",Description_En:"VMS Disconnect",OccurLocation:32,Equipment_Name:"System",Task_Name:"",Duration:0,Checked:"",ResetAalrmMemberName:""},{Time:"2021/04/18 12:23:23",Level:"WARNING",Source:"System",AlarmCode:2,Description_Zh:"車載管理系統斷線",Description_En:"VMS Disconnect",OccurLocation:32,Equipment_Name:"System",Task_Name:"",Duration:0,Checked:"",ResetAalrmMemberName:""}]}},computed:{is_user_login(){return O.HP.getters.IsLogin},sys_alarms(){return this.alarms.filter((e=>0==e.Source))},eq_alarms(){return this.alarms.filter((e=>1==e.Source))}},mounted(){new mn.yy(this.onmessage)},methods:{ResetSystemAlarm(){(0,mn.gU)()},formatTime(e){return ga()(e).format("yyyy/MM/DD HH:mm:ss")},onmessage(e){this.alarms=JSON.parse(e.data)},row_state_class_name({row:e,rowIndex:t}){return 1==e.Level?"ALARM":"WARNING"}}};const Mi=(0,f.Z)(Li,[["render",Bi]]);var Oi=Mi;const Gi=[{path:"/",name:"home",component:Lt},{path:"/OP",name:"OP",component:()=>a.e(522).then(a.bind(a,40522))},{path:"/maptest",name:"maptest",component:()=>Promise.resolve().then(a.bind(a,76105)),meta:{isAdminUse:!0}},{path:"/map",name:"map",component:()=>a.e(188).then(a.bind(a,76188)),meta:{isAdminUse:!0}},{path:"/racks_status",name:"racks_status",component:()=>a.e(655).then(a.bind(a,32655))},{path:"/sys_settings",name:"sys_settings",component:no,meta:{isAdminUse:!0}},{path:"/data",name:"data",component:Ti},{path:"/alarm",name:"alarm",component:Oi}],Ri=[{path:"/",name:"home",component:()=>a.e(897).then(a.bind(a,9897)),children:[{path:"/",name:"/",component:()=>a.e(740).then(a.bind(a,99740)),meta:{Display:"車輛狀態與任務"}},{path:"BirdView",name:"BirdView",component:()=>a.e(155).then(a.bind(a,82155)),meta:{Display:"Bird View"}},{path:"AGVLocus",name:"AGVLocus",component:()=>Promise.resolve().then(a.bind(a,50053)),meta:{Display:"AGV軌跡"}}]},{path:"/map",name:"map",component:()=>a.e(188).then(a.bind(a,76188))},{path:"/alarm",name:"alarm",component:Oi},{path:"/data",name:"data",component:Ti}],Hi=(0,o.p7)({history:(0,o.PO)(),routes:Gi});var Fi=Hi},24239:function(e,t,a){"use strict";a.d(t,{HP:function(){return l},cy:function(){return r},jU:function(){return d},sn:function(){return s}});var o=a(20065),n=a(82106),i=(a(83592),a(56938));t.ZP=(0,o.MT)({state:{configs:{}},mutations:{setConfigs(e,t){e.configs=t}},actions:{SetConfig({commit:e},t){e("setConfigs",t)}}});const s=(0,o.MT)({state:{agv_states:[new i.Z],hotrun_states:[]},getters:{AGVStatesData:e=>e.agv_states,AGVNameList:e=>e.agv_states.map((e=>e.AGV_Name)),HotRunStates:e=>e.hotrun_states},mutations:{storeAgvStates(e,t){e.agv_states=t},setHotRunStates(e,t){e.hotrun_states=t}}}),r=(0,o.MT)({state:{sys_settings:{operations:{system_run_mode:!1,host_online_mode:!1,host_remote_mode:!1,transfer_mode:!1}}},mutations:{setOperations(e,t){e.sys_settings.operations=t},setRunMode(e,t){e.sys_settings.operations.system_run_mode=t},setHostOnline(e,t){e.sys_settings.operations.host_online_mode=t},setHostRemote(e,t){e.sys_settings.operations.host_remote_mode=t},setTransferRemote(e,t){e.sys_settings.operations.transfer_mode=t}},actions:{},getters:{IsRunMode:e=>e.sys_settings.operations.system_run_mode}}),l=(0,o.MT)({state:{user:null,current_route:"",web_user_id:""},mutations:{setUser(e,t){e.user=t,t?(0,n.FU)(t):localStorage.removeItem("user")},setUserID(e,t){e.web_user_id=t,console.log(t)},setRoute(e,t){e.current_route=t,console.log(t)}},actions:{async login({commit:e},t){var a=await(0,n.m3)(t);return a.Success?e("setUser",a):e("setUser",null),console.log(a),{confirm:a.Success,message:a.Message}},logout({commit:e}){e("setUser",null)},async user_route_change({commit:e,state:t},a){e("setRoute",a);var o=await(0,n.hB)(t.web_user_id,a);return o}},getters:{IsLogin:e=>null!=e.user,level:e=>e.user?e.user.Role:-1,UserName:e=>e.user?e.user.UserName:"",IsDeveloperLogining:e=>null!=e.user&&(2==e.user.Role||3==e.user.Role),WebUserID:e=>e.web_user_id}}),d=((0,o.MT)({state:{locus:{}}}),(0,o.MT)({state:{EQ:[],ChargeStation:{},EqOptions:[],WIPOptions:[],WIPsData:[]},getters:{EQData:e=>e.EQ,ChargeStationData:e=>e.ChargeStation,EqOptions:e=>e.EqOptions,WIPData:e=>e.WIPsData},mutations:{setData(e,t){e.EQ=t.EQPData,e.ChargeStation=t.ChargeStationData,e.WIPsData=t.WIPsData},EqOptions(e,t){e.EqOptions=t},WIPOptions(e,t){e.WIPOptions=t}},actions:{}}))},50462:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var o=a(79003);function n(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-option"),l=(0,o.resolveComponent)("el-select");return(0,o.openBlock)(),(0,o.createBlock)(l,{modelValue:i.selected,"onUpdate:modelValue":t[0]||(t[0]=e=>i.selected=e),onChange:s.HandleSelectChanged},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(s.agvNameList,(e=>((0,o.openBlock)(),(0,o.createBlock)(r,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])}var i=a(24239),s={props:{default:{type:String}},data(){return{selected:this.value}},methods:{HandleSelectChanged(){}},computed:{agvNameList(){return i.sn.getters.AGVNameList}},mounted(){this.selected=this.default}},r=a(40089);const l=(0,r.Z)(s,[["render",n]]);var d=l},50053:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var o=a(79003);const n=e=>((0,o.pushScopeId)("data-v-4893f878"),e=e(),(0,o.popScopeId)(),e),i={class:"agv-locus border rounded"},s={class:"w-100 d-flex"},r={class:"menu-container bg-light p-2 border"},l={class:"border-bottom my-1 py-2"},d={class:"time-pick text-start d-flex"},c=n((()=>(0,o.createElementVNode)("div",{class:"label"},"車輛選擇",-1))),m=n((()=>(0,o.createElementVNode)("div",{class:"label"},"開始時間",-1))),u=n((()=>(0,o.createElementVNode)("div",{class:"label"},"結束時間",-1))),h=["onClick"],p=n((()=>(0,o.createElementVNode)("i",{class:"view-icon bi bi-eye-fill"},null,-1))),g=[p],_={class:"bg-light border flex-fill"},v={class:"locus-settings bg-dark text-light d-flex py-1 px-3"},f=n((()=>(0,o.createElementVNode)("span",null,"軌跡顏色",-1))),w=n((()=>(0,o.createElementVNode)("span",null,"軌跡寬度",-1))),y={class:"flex-fill text-end"};function V(e,t,a,n,p,V){const C=(0,o.resolveComponent)("AGVSelector"),N=(0,o.resolveComponent)("el-date-picker"),b=(0,o.resolveComponent)("el-button"),k=(0,o.resolveComponent)("el-table-column"),S=(0,o.resolveComponent)("el-tag"),x=(0,o.resolveComponent)("el-table"),E=(0,o.resolveComponent)("el-color-picker"),T=(0,o.resolveComponent)("el-option"),D=(0,o.resolveComponent)("el-select"),P=(0,o.resolveComponent)("Map"),A=(0,o.resolveDirective)("loading");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[(0,o.createElementVNode)("div",s,[(0,o.createElementVNode)("div",r,[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("div",d,[(0,o.createElementVNode)("div",null,[c,(0,o.createVNode)(C,{modelValue:p.agvname,"onUpdate:modelValue":t[0]||(t[0]=e=>p.agvname=e)},null,8,["modelValue"])]),(0,o.createElementVNode)("div",null,[m,(0,o.createVNode)(N,{modelValue:p.timePick.start_time,"onUpdate:modelValue":t[1]||(t[1]=e=>p.timePick.start_time=e),type:"datetime",placeholder:"選擇開始時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,o.createElementVNode)("div",null,[u,(0,o.createVNode)(N,{modelValue:p.timePick.end_time,"onUpdate:modelValue":t[2]||(t[2]=e=>p.timePick.end_time=e),type:"datetime",placeholder:"選擇結束時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,o.createVNode)(b,{onClick:V.HandleSearchBtnClicked,style:{height:"30px","font-size":"large",width:"120px",position:"relative",top:"16px"},class:"my-2",type:"primary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("搜尋")])),_:1},8,["onClick"])])]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createBlock)(x,{data:p.tableData,style:{width:"720px"},height:"700","highlight-current-row":"",size:"small"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(k,{align:"center",label:"No",width:"50"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",null,(0,o.toDisplayString)(V.GetNo(e.row)),1)])),_:1}),(0,o.createVNode)(k,{label:"Task ID",prop:"task_id"}),(0,o.createVNode)(k,{label:"開始時間",prop:"start_time"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(V.FormatTime(e.row.start_time)),1)])),_:1}),(0,o.createVNode)(k,{label:"結束時間",prop:"end_time"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(V.FormatTime(e.row.end_time)),1)])),_:1}),(0,o.createVNode)(k,{align:"center",label:"花費時間(秒)",prop:"duration","min-width":"60"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",null,[(0,o.createVNode)(S,{effect:"dark",type:"info"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(V.CalculatTimeSpend(e.row)),1)])),_:2},1024)])])),_:1}),(0,o.createVNode)(k,{align:"center",label:"顯示軌跡","min-width":"50"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",{class:"w-100",onClick:t=>V.ShowLocusHandler(e.row)},g,8,h)])),_:1})])),_:1},8,["data"])),[[A,p.loading]])]),(0,o.createElementVNode)("div",_,[(0,o.createElementVNode)("div",v,[(0,o.createElementVNode)("div",null,[f,(0,o.createVNode)(E,{onChange:V.HandleLocusSettingChange,modelValue:p.locus_settings.color,"onUpdate:modelValue":t[3]||(t[3]=e=>p.locus_settings.color=e)},null,8,["onChange","modelValue"])]),(0,o.createElementVNode)("div",null,[w,(0,o.createVNode)(D,{modelValue:p.locus_settings.width,"onUpdate:modelValue":t[4]||(t[4]=e=>p.locus_settings.width=e),onChange:V.HandleLocusSettingChange},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(12,(e=>(0,o.createVNode)(T,{key:e,value:e},null,8,["value"]))),64))])),_:1},8,["modelValue","onChange"])]),(0,o.createElementVNode)("div",y,[(0,o.createVNode)(b,{type:"primary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("儲存軌跡圖")])),_:1})])]),(0,o.withDirectives)((0,o.createVNode)(P,{class:"bg-light border",ref:"map",id:"locus_map",editable:!1,agv_show:!1,station_show:!0},null,512),[[A,p.locus_painting]])])])])}var C=a(50462),N=a(76105),b=a(20840),k=a(24239),S=a(95320),x=a(36797),E=a.n(x),T={components:{Map:N["default"],AGVSelector:C.Z},computed:{agvNameList(){return k.sn.getters.AGVNameList},map_station_data(){return S.p.getters.MapStations}},data(){return{tableData:[{task_id:"",start_time:"2023-08-03 12:00:00",end_time:"2023-08-03 12:10:00",duration:600,corrdinations:[[0,0],[-1.2,2.2],[-1.3,2.3],[-1.4,3]]}],agvname:"AGV_001",timePick:{start_time:"2023-08-03 12:00:00",end_time:"2023-08-04 12:00:00"},locus_settings:{color:"red",width:1},showing_row_data:{},loading:!1,locus_painting:!1}},methods:{SetDefaultTimeInterval(){},GetNo(e){return this.tableData.indexOf(e)+1},async ShowLocusHandler(e){try{this.locus_painting=!0,setTimeout((async()=>{if(void 0==e.corrdinations){var t=await(0,b.c6)(e.task_id);t&&(e.corrdinations=t.coordinations.map((e=>[e.X,e.Y])),this.showing_row_data=e)}this.$refs.map.ShowLocus(e.corrdinations,this.locus_settings.color,this.locus_settings.width),this.locus_painting=!1}),300)}catch(t){this.$swal.fire({text:t.response.data,title:"後端服務異常",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},FormatTime(e){return E()(e).format("YYYY/MM/DD HH:mm:ss")},HandleLocusSettingChange(){this.$refs.map.ShowLocus(this.showing_row_data.corrdinations,this.locus_settings.color,this.locus_settings.width)},async HandleSearchBtnClicked(){if(this.SaveLocusSettingsToLocalStroage(),""!=this.agvname){var e=E()(this.timePick.start_time).format("YYYY/MM/DD HH:mm:ss"),t=E()(this.timePick.end_time).format("YYYY/MM/DD HH:mm:ss"),a=[];this.loading=!0,setTimeout((async()=>{a=await(0,b.tQ)(e,t,this.agvname),this.tableData=a.map((e=>({task_id:e.TaskName,start_time:e.RecieveTime,end_time:e.FinishTime,duration:0,corrdinations:void 0}))),this.loading=!1}),200)}else this.$swal.fire({text:"",title:"請選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},SaveLocusSettingsToLocalStroage(){localStorage.setItem("locus",JSON.stringify({locus_paint:this.locus_settings,time:this.timePick}))},ReloadLocusSettingsFromLocalStorage(){var e=localStorage.getItem("locus");if(e){var t=JSON.parse(e);t.locus_paint&&(this.locus_settings=t.locus_paint),t.time?this.timePick=t.time:this.timePick.start_time=this.timePick.end_time=E()(Date.now()).format("YYYY-MM-DD HH:mm:ss")}},CalculatTimeSpend(e){return E()(e.end_time).unix()-E()(e.start_time).unix()}},mounted(){this.SetDefaultTimeInterval(),this.ReloadLocusSettingsFromLocalStorage(),this.tableData=[]}},D=a(40089);const P=(0,D.Z)(T,[["render",V],["__scopeId","data-v-4893f878"]]);var A=P},46058:function(e,t,a){"use strict";a.d(t,{Z:function(){return ve}});var o=a(79003);const n={class:"agv-status card-like"},i=(0,o.createElementVNode)("div",{class:"title"},[(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"}),(0,o.createTextVNode)("車輛狀態 STATUS ")],-1),s={class:""},r=(0,o.createElementVNode)("i",{class:"bi bi-lightning-charge-fill"},null,-1),l={class:"w-100",style:{position:"absolute",top:"0",left:"0"}},d=(0,o.createElementVNode)("div",{class:"h-100 border px-1 py-2 text-center bg-light"},"狀態",-1),c={class:"h-100 border p-1"},m=(0,o.createElementVNode)("div",{class:"h-100 border py-2 text-center bg-light"},"載物ID ",-1),u={class:"h-100 w-100 border p-2"},h=(0,o.createElementVNode)("div",{class:"h-100 border px-1 py-2 text-center bg-light"},"派車",-1),p={class:"h-100 border p-1"},g=(0,o.createElementVNode)("div",{class:"h-100 border py-2 text-center bg-light"},"位置 ",-1),_={class:"w-100 h-100 border p-1"},v=["onClick"],f=(0,o.createElementVNode)("div",{class:"h-100 border px-1 py-2 text-center bg-light"},"電量",-1),w={class:"h-100 border px-2 py-1 d-flex"},y={class:"w-100",style:{position:"absolute",top:"0",left:"0"}},V=(0,o.createElementVNode)("div",{class:"h-100 border p-2 text-center bg-light"},"ID",-1),C={class:"h-100 border p-1"},N=(0,o.createElementVNode)("div",{class:"h-100 border px-1 py-2 text-center bg-light"},"起點",-1),b={class:"h-100 border p-1"},k=(0,o.createElementVNode)("div",{class:"h-100 border py-2 text-center bg-light"},"目的地 ",-1),S={class:"h-100 border p-1"},x=(0,o.createElementVNode)("div",{class:"h-100 border px-1 py-2 text-center bg-light"},"動作",-1),E={class:"h-100 border p-1 d-flex"},T=(0,o.createElementVNode)("div",{class:"h-100 border px-1 py-2 text-center bg-light"},"時間",-1),D={class:"h-100 border px-1 py-2 text-center bg-light"},P={key:1,class:"easy-mode"},A={class:"d-flex"},I={class:"mx-1 border-end px-1"},B={class:"border-bottom",style:{"font-weight":"bolder"}},L={class:"py-1"},M=["onClick"],O={style:{"padding-top":"5px"},class:"w-100"},G={class:"d-flex w-100"},R=(0,o.createElementVNode)("div",{class:"item-title"},"狀態",-1),H={class:"w-100 text-start"},F={class:"d-flex w-100 my-2"},U=(0,o.createElementVNode)("div",{class:"item-title"},"電量",-1),Z={class:"w-100 px-1 text-start"},$={style:{width:"110px"}},q={class:"d-flex w-100 my-1"},z=(0,o.createElementVNode)("div",{class:"item-title"},"位置",-1),Q={class:"w-100 text-start",style:{"font-size":"font-size: 14px"}},j=["onClick"],Y={class:"d-flex w-100 my-1"},K=(0,o.createElementVNode)("div",{class:"item-title"},"載物ID",-1),W={class:"w-100 text-start"},J={class:"modals"},X={ref:"online_status_change_noti_txt"};function ee(e,t,a,ee,te,ae){const oe=(0,o.resolveComponent)("b-button"),ne=(0,o.resolveComponent)("el-table-column"),ie=(0,o.resolveComponent)("el-col"),se=(0,o.resolveComponent)("el-tag"),re=(0,o.resolveComponent)("el-row"),le=(0,o.resolveComponent)("b-progress-bar"),de=(0,o.resolveComponent)("b-progress"),ce=(0,o.resolveComponent)("el-table"),me=(0,o.resolveComponent)("el-tab-pane"),ue=(0,o.resolveComponent)("el-tabs"),he=(0,o.resolveComponent)("b-modal");return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createElementVNode)("div",n,[i,(0,o.createVNode)(ue,{class:"px-1","tab-position":"top"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(ae.Groups,(e=>((0,o.openBlock)(),(0,o.createBlock)(me,{key:e.group,label:`${e.group_name}(${e.agv_states.length})`},{default:(0,o.withCtx)((()=>[a.IsEasyMode?((0,o.openBlock)(),(0,o.createElementBlock)("div",P,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.agv_states,(e=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:e.AGV_Name,class:"easy-mode-car-card border rounded my-2 p-2",style:(0,o.normalizeStyle)({backgroundColor:e.Connected?"rgb(229, 255, 240)":"rgb(255, 184, 182)"})},[(0,o.createElementVNode)("div",A,[(0,o.createElementVNode)("div",I,[(0,o.createElementVNode)("span",B,(0,o.toDisplayString)(e.AGV_Name),1),(0,o.createElementVNode)("div",L,[(0,o.createElementVNode)("img",{src:"agv.png",onClick:t=>ae.HandleShowAGVInMapCenter(e.AGV_Name)},null,8,M),(0,o.createVNode)(se,{effect:"dark",onClick:t=>ae.ShowOnlineStateChangeModal(e.AGV_Name,e.OnlineStatus,e.Model),type:0==e.OnlineStatus?"danger":"success"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(1==e.OnlineStatus?"ONLINE":"OFFLINE"),1)])),_:2},1032,["onClick","type"])])]),(0,o.createElementVNode)("div",O,[(0,o.createElementVNode)("div",G,[R,(0,o.createElementVNode)("div",H,[(0,o.createVNode)(se,{effect:"dark",type:ae.AGV_Status_TagType(e.MainStatus)},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(ae.AGVStatusFormatter(e)),1)])),_:2},1032,["type"])])]),(0,o.createElementVNode)("div",F,[U,(0,o.createElementVNode)("div",Z,[(0,o.createElementVNode)("div",$,[(0,o.createVNode)(de,{class:"flex-fill",max:100,min:0,animated:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(le,{animated:!0,class:(0,o.normalizeClass)(ae.BatteryClass(e.BatteryLevel_1)),value:e.BatteryLevel_1,label:`${(e.BatteryLevel_1/100*100).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024),-1!=e.BatteryLevel_2?((0,o.openBlock)(),(0,o.createBlock)(de,{key:0,class:"flex-fill my-1",max:100,min:0,animated:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(le,{animated:!0,class:(0,o.normalizeClass)(ae.BatteryClass(e.BatteryLevel_2)),value:e.BatteryLevel_2,label:`${(e.BatteryLevel_2/100*100).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024)):(0,o.createCommentVNode)("",!0)])])]),(0,o.createElementVNode)("div",q,[z,(0,o.createElementVNode)("div",Q,[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.StationName),1),(0,o.createElementVNode)("i",{class:"bi bi-geo-alt-fill",style:{"font-size":"20px",cursor:"pointer"},onClick:t=>ae.HandleShowAGVInMapCenter(e.AGV_Name)},null,8,j)])]),(0,o.createElementVNode)("div",Y,[K,(0,o.createElementVNode)("div",W,[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.Cst),1)])])])])],4)))),128))])):((0,o.openBlock)(),(0,o.createBlock)(ce,{key:0,"header-cell-style":{color:"white",border:"1px solid rgb(222, 226, 230)",backgroundColor:"rgb(13, 110, 253)"},data:e.agv_states,size:"small",height:"93%","empty-text":"沒有AGV","row-class-name":ae.connected_class,style:{width:"100%"},"row-key":"AGV_Name",border:"",onRowClick:ae.HandleRowClick},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(ne,{label:"車輛名稱",prop:"AGV_Name",align:"center","min-width":"100px",type:"index"},{default:(0,o.withCtx)((t=>[(0,o.createElementVNode)("div",s,[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(t.row.AGV_Name.toUpperCase()),1),ae.IsRunMode?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(oe,{key:0,class:"w-20 my-1 mx-2",onClick:e=>ae.ShowAGVChargeConfirmDialog(t.row),size:"sm",variant:"warning"},{default:(0,o.withCtx)((()=>[r,(0,o.createTextVNode)(" "+(0,o.toDisplayString)(3==e.group?"交換電池":"充電"),1)])),_:2},1032,["onClick"]))])])),_:2},1024),(0,o.createVNode)(ne,{label:"AGV 狀態",align:"left",width:"300"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",l,[(0,o.createVNode)(re,{class:"h-50"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[d])),_:1}),(0,o.createVNode)(ie,{span:6},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",c,[(0,o.createVNode)(se,{class:"h-100 w-100",effect:"dark",type:ae.AGV_Status_TagType(e.row.MainStatus)},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(ae.AGVStatusFormatter(e.row)),1)])),_:2},1032,["type"])])])),_:2},1024),(0,o.createVNode)(ie,{span:4},{default:(0,o.withCtx)((()=>[m])),_:1}),(0,o.createVNode)(ie,{span:11},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",u,[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.CurrentCarrierID),1)])])),_:2},1024)])),_:2},1024),(0,o.createVNode)(re,{class:"h-50"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[h])),_:1}),(0,o.createVNode)(ie,{span:6},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",p,[(0,o.createVNode)(se,{class:"h-100 w-100",effect:"dark",onClick:t=>ae.ShowOnlineStateChangeModal(e.row.AGV_Name,e.row.OnlineStatus,e.row.Model),type:0==e.row.OnlineStatus?"info":"success"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(1==e.row.OnlineStatus?"已上線":"離線中"),1)])),_:2},1032,["onClick","type"])])])),_:2},1024),(0,o.createVNode)(ie,{span:4},{default:(0,o.withCtx)((()=>[g])),_:1}),(0,o.createVNode)(ie,{span:11},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",_,[(0,o.createElementVNode)("i",{class:"bi bi-geo-alt-fill",style:{"font-size":"20px",cursor:"pointer"},onClick:t=>ae.HandleShowAGVInMapCenter(e.row.AGV_Name)},null,8,v),(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.StationName),1)])])),_:2},1024)])),_:2},1024),(0,o.createVNode)(re,{class:"h-50"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[f])),_:1}),(0,o.createVNode)(ie,{span:21},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",w,[(0,o.createVNode)(de,{class:"flex-fill",max:100,min:0,animated:""},{default:(0,o.withCtx)((()=>[e.row.IsCharging?((0,o.openBlock)(),(0,o.createElementBlock)("i",{key:0,class:(0,o.normalizeClass)([ae.BatteryClass(e.row.BatteryLevel_1,e.row.IsCharging),"bi bi-lightning-charge battery-icon"]),style:{color:"white"}},null,2)):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(le,{animated:!0,class:(0,o.normalizeClass)(ae.BatteryClass(e.row.BatteryLevel_1,e.row.IsCharging)),value:e.row.BatteryLevel_1,label:`${(e.row.BatteryLevel_1/100*100).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024),-1!=e.row.BatteryLevel_2?((0,o.openBlock)(),(0,o.createBlock)(de,{key:0,class:"flex-fill mx-1",max:100,min:0,animated:""},{default:(0,o.withCtx)((()=>[e.row.IsCharging?((0,o.openBlock)(),(0,o.createElementBlock)("i",{key:0,class:(0,o.normalizeClass)([ae.BatteryClass(e.row.BatteryLevel_2,e.row.IsCharging),"bi bi-lightning-charge battery-icon"]),style:{color:"white"}},null,2)):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(le,{animated:!0,class:(0,o.normalizeClass)(ae.BatteryClass(e.row.BatteryLevel_2,e.row.IsCharging)),value:e.row.BatteryLevel_2,label:`${(e.row.BatteryLevel_2/100*100).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024)):(0,o.createCommentVNode)("",!0)])])),_:2},1024)])),_:2},1024)])])),_:1}),(0,o.createVNode)(ne,{label:"任務狀態",align:"left","min-width":"420"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",y,[(0,o.createVNode)(re,{class:"h-50"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[V])),_:1}),(0,o.createVNode)(ie,{span:21},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",C,[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.TaskName),1)])])),_:2},1024)])),_:2},1024),(0,o.createVNode)(re,{class:"h-50"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[N])),_:1}),(0,o.createVNode)(ie,{span:9},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",b,[(0,o.createVNode)(se,{class:"h-100 w-100",effect:"light"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.TaskSourceStationName),1)])),_:2},1024)])])),_:2},1024),(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[k])),_:1}),(0,o.createVNode)(ie,{span:9},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",S,[(0,o.createVNode)(se,{class:"h-100 w-100",effect:"light"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.TaskDestineStationName),1)])),_:2},1024)])])),_:2},1024)])),_:2},1024),(0,o.createVNode)(re,{class:"h-50"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[x])),_:1}),(0,o.createVNode)(ie,{span:9},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",E,[(0,o.createVNode)(se,{class:"h-100 w-100",effect:"light"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(ae.GetTransferProcessDescription(e.row,e.row.TransferProcess)),1)])),_:2},1024)])])),_:2},1024),(0,o.createVNode)(ie,{span:3},{default:(0,o.withCtx)((()=>[T])),_:1}),(0,o.createVNode)(ie,{span:9},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",D,(0,o.toDisplayString)(""==e.row.TaskName?"":"預計抵達時間:"+ae.Timeformat(e.row.TaskETA,"HH:mm:ss")),1)])),_:2},1024)])),_:2},1024)])])),_:1}),(0,o.createVNode)(ne,{width:"1"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",{style:(0,o.normalizeStyle)({height:ae.IsRunMode?"110px":"125px"}),class:"d-flex flex-column"},null,4)])),_:1})])),_:2},1032,["header-cell-style","data","row-class-name","onRowClick"]))])),_:2},1032,["label"])))),128))])),_:1})]),(0,o.createElementVNode)("div",J,[(0,o.createVNode)(he,{modelValue:te.ShowOnlineStateChange,"onUpdate:modelValue":t[0]||(t[0]=e=>te.ShowOnlineStateChange=e),title:"ONLINE / OFFLINE REQUEST CONFIRM.",centered:!0,onOk:ae.SendOnlineStateChangeRequest,"no-close-on-esc":!0,"header-bg-variant":"warning","header-text-variant":"light"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("p",X,null,512)])),_:1},8,["modelValue","onOk"])])],64)}a(57658);var te=a(93867),ae=a(53259),oe=a(90131),ne=a(56265),ie=a.n(ne),se=a(663),re=(ie().create({baseURL:se.Z.backend_host}),ie().create({baseURL:se.Z.vms_host}));async function le(e,t=0){return await re.get(`/api/VmsManager/OnlineRequet?agv_name=${e}&model=${t}`)}async function de(e,t=0){return await re.get(`/api/VmsManager/OfflineRequet?agv_name=${e}&model=${t}`)}var ce=a(8764),me=a(24239),ue=a(36797),he=a.n(ue),pe={mounted(){},data(){return{ShowOnlineStateChange:!1,ShowChargeConfirmDialog:!1,OnlineStatusReq:{AGV_Name:"",Online_Status:"",Model:0}}},props:{IsEasyMode:{type:Boolean,default:!1}},methods:{Timeformat(e,t="YYYY/MM/DD HH:mm:ss"){return he()(e).format(t)},HandleRowClick(e,t){},HandleShowAGVInMapCenter(e){ae.Z.emit("/show_agv_at_center",e)},ShowTaskAllocationView(e){(0,oe.VM)().isLogin?ae.Z.emit("bus-show-task-allocation",{agv_name:e.AGV_Name,agv_type:e.Model,action:"",station_data:void 0}):this.$swal.fire({title:"權限不足",text:"您沒有指派任務的權限，請先進行登入。",icon:"warning",showCancelButton:!0}).then((e=>{e.isConfirmed&&ae.Z.emit("/show-login-view-invoke","")}))},ShowOnlineStateChangeModal(e,t,a){if(this.IsLogin){this.OnlineStatusReq.AGV_Name=e,this.OnlineStatusReq.Online_Status=0==t?"Online":"Offline",this.OnlineStatusReq.Model=a;var o="Online"==this.OnlineStatusReq.Online_Status?"上線":"下線";this.$swal.fire({text:`確定要將 ${this.OnlineStatusReq.AGV_Name} ${o}?`,title:`${this.OnlineStatusReq.AGV_Name} - ${o}`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed)await this.SendOnlineStateChangeRequest()}))}else this.$swal.fire({text:"",title:"沒有請求車子上下線的權限，請先進行登入",icon:"warning",showCancelButton:!0,confirmButtonText:"登入",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&ae.Z.emit("/show-login-view-invoke","")}))},async SendOnlineStateChangeRequest(){te.Z.Primary(`${this.OnlineStatusReq.AGV_Name} ${this.OnlineStatusReq.Online_Status} 請求已送出`,"top",2e3);var e=null;try{if("Online"==this.OnlineStatusReq.Online_Status){var t=await le(this.OnlineStatusReq.AGV_Name,this.OnlineStatusReq.Model);e=t.data}else{t=await de(this.OnlineStatusReq.AGV_Name,this.OnlineStatusReq.Model);e=t.data}0!=e.ReturnCode&&this.$swal.fire({text:`${this.OnlineStatusReq.AGV_Name} ${this.OnlineStatusReq.Online_Status} 失敗:${e.Message}`,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}catch(a){this.$swal.fire({title:"VMS系統通訊異常",text:`${a.message} , Please confirm that the VMS is currently in service.`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},ShowAGVChargeConfirmDialog(e){me.HP.getters.level<0?this.$swal.fire({title:"權限不足",text:"您沒有指派AGV充電的權限，請先進行登入。",icon:"warning",showCancelButton:!0}).then((e=>{e.isConfirmed&&ae.Z.emit("/show-login-view-invoke","")})):(this.Agv_Selected=e.AGV_Name,this.$swal.fire({title:`確定要將${e.AGV_Name}派送至充電站充電?`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.AGVChargeTask()})))},AGVChargeTask(){ce.J8.ChargeTask(new ce.fn(this.Agv_Selected,-1))},AGV_Status_TagType(e){return 1==e?"warning":2==e?"success":3==e?"danger":""},GetTaskRunStatusString(e){return 1==e?"等待":2==e?"執行中":3==e?"完成":4==e?"失敗":"Unknown"},GetAGVStatusString(e){return 1==e?"閒置中":2==e?"執行中":3==e?"當機":4==e?"充電中":"Unknown"},GetTransferProcessDescription(e,t){return 2!=e.MainStatus||0==t||9==t?"":1==t?"前往來源設備":2==t?"取貨中":3==t?"前往終點設備":4==t?"放貨中":5==t?"退出充電站/WIP":6==t?"移動中":7==t?"前往充電站":8==t?"停車-充電站":"Unknown"},AGVStatusFormatter(e,t){if(void 0==e)return this.GetAGVStatusString(999);var a=e.MainStatus;return this.GetAGVStatusString(a)},connected_class({row:e,rowIndex:t}){var a=this.IsRunMode?"agv-row-no-operation":"agv-row";return e.Connected?`${a} connect`:`${a} disconnect`},BatteryClass(e,t=!1){return t?"batter-charging":e>=30?"batter-full-level":e>10&&e<30?"batter-mid-level":"batter-low-level"}},computed:{AGVDatas(){return me.sn.getters.AGVStatesData},Groups(){function e(e){return 0==e?"Fork AGV":1==e?"潛盾 AGV":2==e?"YUNTECH AGV":3==e?"巡檢 AGV":"GROUP"}var t=this.AGVDatas.map((e=>e.Group));const a=[...new Set(t)];var o=[];for(let i=0;i<a.length;i++){const t=a[i];var n=this.AGVDatas.filter((e=>e.Group==t));o.push({group:t,group_name:e(t),agv_states:n})}return o},IsLogin(){return me.HP.getters.IsLogin},IsRunMode(){return me.cy.getters.IsRunMode},AGV_Names(){var e=[];return this.AGVDatas.forEach((t=>{e.push(t.AGV_Name)})),e}}},ge=a(40089);const _e=(0,ge.Z)(pe,[["render",ee]]);var ve=_e},96114:function(e,t,a){"use strict";a.d(t,{Z:function(){return S}});var o=a(79003);const n={class:"map card-like"};function i(e,t,a,i,s,r){const l=(0,o.resolveComponent)("Map"),d=(0,o.resolveComponent)("CargoTransferDialog");return(0,o.openBlock)(),(0,o.createElementBlock)("div",n,[(0,o.createVNode)(l,{canva_height:"800px",onOnTransferRequst:r.HandleTransferReq,id:a.id,class:"w-100",task_dispatch_menu_show:!0,eq_lduld_status_show:!0},null,8,["onOnTransferRequst","id"]),(0,o.createVNode)(d,{ref:"transfer_dialog"},null,512)])}var s=a(76105),r=a(95320);const l=e=>((0,o.pushScopeId)("data-v-feaad786"),e=e(),(0,o.popScopeId)(),e),d={class:"justify-content-center px-5 cargo-transfer"},c=l((()=>(0,o.createElementVNode)("div",{class:"w-100 border-bottom my-1"},[(0,o.createElementVNode)("h3",null,"車輛選擇")],-1))),m={class:"w-100 border-bottom my-1"},u={style:{color:"blue"}},h={style:{color:"seagreen"}},p={class:"text-danger"};function g(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-option"),l=(0,o.resolveComponent)("el-select"),g=(0,o.resolveComponent)("el-divider"),_=(0,o.resolveComponent)("el-table-column"),v=(0,o.resolveComponent)("b-button"),f=(0,o.resolveComponent)("el-popconfirm"),w=(0,o.resolveComponent)("el-table"),y=(0,o.resolveComponent)("el-dialog");return(0,o.openBlock)(),(0,o.createBlock)(y,{"destroy-on-close":"",modal:!1,style:{"z-index":"0"},modelValue:i.show_dialog,"onUpdate:modelValue":t[2]||(t[2]=e=>i.show_dialog=e),draggable:"",title:`${i.source_station.Name}-搬運任務`},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",d,[c,s.isRunMode?((0,o.openBlock)(),(0,o.createBlock)(l,{key:1,disabled:"",class:"w-100",modelValue:i.autoSelectAGVName,"onUpdate:modelValue":t[1]||(t[1]=e=>i.autoSelectAGVName=e)},null,8,["modelValue"])):((0,o.openBlock)(),(0,o.createBlock)(l,{key:0,class:"w-100",modelValue:i.selectedAGVName,"onUpdate:modelValue":t[0]||(t[0]=e=>i.selectedAGVName=e)},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(s.AgvNameList,(e=>((0,o.openBlock)(),(0,o.createBlock)(r,{key:e,label:"Assigning"==e?"自動選車":e,value:"Assigning"==e?"":e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])),(0,o.createVNode)(g),(0,o.createElementVNode)("div",m,[(0,o.createElementVNode)("h3",null,(0,o.toDisplayString)("unload"==i.action?"下游設備列表":"來源設備列表"),1)]),(0,o.createVNode)(w,{size:"small",border:"",data:i.CandicateEQOptions},{default:(0,o.withCtx)((()=>["unload"==i.action?((0,o.openBlock)(),(0,o.createBlock)(_,{key:0,label:"起點"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("b",u,(0,o.toDisplayString)(i.source_station.Graph.Display),1)])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(_,{label:"unload"==i.action?"下游設備":"上游設備",prop:"Name"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.Name),1)])),_:1},8,["label"]),"load"==i.action?((0,o.openBlock)(),(0,o.createBlock)(_,{key:1,label:"終點"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("b",h,(0,o.toDisplayString)(i.source_station.Graph.Display),1)])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(_,{align:"center",label:"TAG",prop:"TagID"}),(0,o.createVNode)(_,{align:"center",label:"動作"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(f,{width:"220","confirm-button-text":"確定","cancel-button-text":"取消","icon-color":"#626AEF",title:"確定要進行此搬運任務?",onConfirm:t=>s.HandleTransferBtnClick(e.row.TagID)},{reference:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{style:{width:"90px"},size:"sm",variant:"primary",disabled:!s.Transferable(e.row.TagID)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("搬運")])),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"])])),_:1}),(0,o.createVNode)(_,{width:"300",label:"說明"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",p,(0,o.toDisplayString)(s.GetNoTransferActionReason(e.row.TagID)),1)])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue","title"])}var _=a(64491),v=a(24239),f=a(8764),w=a(72748),y={components:{InfoFilled:w.cEj},data(){return{show_dialog:!1,confirm_dialog_show:!1,source_station:{},EQOptions:[],CandicateEQOptions:[],action:"",selectedAGVName:"",autoSelectAGVName:"自動指派"}},methods:{ShowDialog(e,t="load"){this.isRunMode?this.selectedAGVName="Assigning":""==this.selectedAGVName&&(this.selectedAGVName=this.AgvNameList[0]),this.source_station=e,this.action=t,this.CandicateEQOptions=[];var a=e.TagNumber;(0,_.H5)().then((o=>{var n=o.find((e=>e.TagID==a)),i=n.ValidDownStreamEndPointNames;this.EQOptions=o,this.CandicateEQOptions="unload"==t?o.filter((e=>i.includes(e.Name))):o.filter((t=>t.ValidDownStreamEndPointNames.includes(e.Name))),this.show_dialog=!0}))},Transferable(e){if(void 0==e)return!0;var t=this.eq_status_data.find((t=>t.Tag==e));if("load"==this.action){if(0==t.EqType)return t.Unload_Request&&t.Up_Pose&&t.IsConnected&&t.Eqp_Status_Down;if(1==t.EqType)return t.Unload_Request&&t.IsConnected&&t.Eqp_Status_Idle}else{if(0==t.EqType)return t.Load_Request&&t.Down_Pose&&t.IsConnected&&t.Eqp_Status_Down;if(1==t.EqType)return t.Load_Request&&t.IsConnected&&t.Eqp_Status_Idle}},GetNoTransferActionReason(e){if(void 0==e)return"";var t=this.eq_status_data.find((t=>t.Tag==e)),a="load"==this.action?"unload":"load";if(!t.IsConnected)return`${t.EQName} 機台尚未連線`;if(!t.Eqp_Status_Down&&0==t.EqType)return`${t.EQName} 機台狀態異常(Eqp_Status_Down)`;if(t.Eqp_Status_Down&&1==t.EqType)return`${t.EQName} 機台狀態異常(Eqp_Status_Down)`;if("load"==a){if(!t.Load_Request)return`${t.EQName} 機台未發起載入請求(Load_Request)`;if(!t.Down_Pose&&0==t.EqType)return`${t.EQName} 設備機構位置錯誤(Down_Pose)`}if("unload"==a){if(!t.Unload_Request)return`${t.EQName} 機台未發起移出請求(Unload_Request)`;if(!t.Up_Pose&&0==t.EqType)return`${t.EQName} 設備機構位置錯誤(Up_Pose)`}return""},HandleTransferBtnClick(e){if(""==this.selectedAGVName)return this.show_dialog=!1,void this.$swal.fire({text:"",title:"請選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{this.show_dialog=!0}));var t="-1",a="-1";"load"==this.action?(t=e,a=this.source_station.TagNumber):(t=this.source_station.TagNumber,a=e);var o="Assigning"==this.selectedAGVName?"":this.selectedAGVName;f.J8.CarryTask(new f.mc(o,t,1,a,1,"-1",5))}},computed:{eq_status_data(){return v.jU.getters.EQData},isRunMode(){return v.cy.getters.IsRunMode},AgvNameList(){return v.sn.getters.AGVNameList}}},V=a(40089);const C=(0,V.Z)(y,[["render",g],["__scopeId","data-v-feaad786"]]);var N=C,b=(a(79072),{props:{id:{type:String,default:"homemap"}},components:{Map:s["default"],CargoTransferDialog:N},data(){return{navPathDisplayData:{},agv_colors:["#42c2f5","limegreen","orange","pink","red","purple"]}},computed:{map_station_data(){return r.p.getters.MapStations},agvs_info(){return r.p.getters.AGVNavInfo}},mounted(){},methods:{HandleTransferReq(e={station_data:{},action:"load"}){this.$refs.transfer_dialog.ShowDialog(e.station_data,e.action)}}});const k=(0,V.Z)(b,[["render",i],["__scopeId","data-v-237c3ad1"]]);var S=k},14464:function(e,t,a){"use strict";a.d(t,{Z:function(){return de}});var o=a(79003);const n={class:"task-allocation"},i={class:"d-flex"},s={class:"flex-fill text-center"},r={class:"drawer-content border-top"},l={class:"d-flex flex-row py-1 w-100 h-100"},d={key:0,class:"img charge"},c={key:1,class:"img delivery"};function m(e,t,a,m,u,h){const p=(0,o.resolveComponent)("el-button"),g=(0,o.resolveComponent)("el-option"),_=(0,o.resolveComponent)("el-select"),v=(0,o.resolveComponent)("el-form-item"),f=(0,o.resolveComponent)("el-input"),w=(0,o.resolveComponent)("b-button"),y=(0,o.resolveComponent)("el-checkbox"),V=(0,o.resolveComponent)("el-form"),C=(0,o.resolveComponent)("Map"),N=(0,o.resolveComponent)("el-drawer"),b=(0,o.resolveDirective)("loading");return(0,o.openBlock)(),(0,o.createElementBlock)("div",n,[(0,o.createVNode)(N,{"show-close":!1,modelValue:u.show,"onUpdate:modelValue":t[8]||(t[8]=e=>u.show=e),header:!1,size:"95%",direction:"btt",modal:!1,"z-index":123,onClosed:h.HandleDrawerClosed},{header:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",i,[(0,o.createVNode)(p,{onClick:t[0]||(t[0]=()=>{u.show=!1}),size:"large",style:{"margin-left":"53px","font-size":"larger"},type:"primary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("←返回(ESC)")])),_:1}),(0,o.createElementVNode)("h3",s,"Local任務派送-車輛:"+(0,o.toDisplayString)(u.selectedAGVName),1)])])),default:(0,o.withCtx)((()=>[(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("div",r,[(0,o.createElementVNode)("div",l,[(0,o.createVNode)(V,{"label-width":"100px","label-position":"left",size:"large",style:{width:"500px"}},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{label:"AGV車輛選擇"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(_,{class:"w-100",modelValue:u.selectedAGVName,"onUpdate:modelValue":t[1]||(t[1]=e=>u.selectedAGVName=e)},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(h.AgvNameList,(e=>((0,o.openBlock)(),(0,o.createBlock)(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.createVNode)(v,{label:"AGV任務動作"},{default:(0,o.withCtx)((()=>[2!=u.agv_type?((0,o.openBlock)(),(0,o.createBlock)(_,{key:0,class:"w-100",modelValue:u.selectedAction,"onUpdate:modelValue":t[2]||(t[2]=e=>u.selectedAction=e),placeholder:"請選擇Action",onChange:h.ActionChangeHandler},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{label:"移動",value:"move"}),(0,o.createVNode)(g,{label:"停車",value:"park"}),(0,o.createVNode)(g,{label:"搬運",value:"carry"}),(0,o.createVNode)(g,{label:"放貨",value:"load"}),(0,o.createVNode)(g,{label:"取貨",value:"unload"}),(0,o.createVNode)(g,{label:"充電",value:"charge"}),h.IsDeveloper?((0,o.openBlock)(),(0,o.createBlock)(g,{key:0,label:"巡檢量測",value:"measure"})):(0,o.createCommentVNode)("",!0)])),_:1},8,["modelValue","onChange"])):((0,o.openBlock)(),(0,o.createBlock)(_,{key:1,class:"w-100",modelValue:u.selectedAction,"onUpdate:modelValue":t[3]||(t[3]=e=>u.selectedAction=e),placeholder:"請選擇Action",onChange:h.ActionChangeHandler},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{label:"移動",value:"move"}),(0,o.createVNode)(g,{label:"交換電池",value:"exchange_battery"}),(0,o.createVNode)(g,{label:"巡檢量測",value:"measure"}),(0,o.createVNode)(g,{label:"進Bay",value:"in-bay"}),(0,o.createVNode)(g,{label:"出Bay",value:"out-bay"})])),_:1},8,["modelValue","onChange"]))])),_:1}),"carry"==u.selectedAction?((0,o.openBlock)(),(0,o.createBlock)(v,{key:0,label:"起點"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(_,{class:"w-100",modelValue:u.sourceTag,"onUpdate:modelValue":t[4]||(t[4]=e=>u.sourceTag=e),onChange:h.HandleFromSelectChanged,placeholder:"選擇站點"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(h.tags,(e=>((0,o.openBlock)(),(0,o.createBlock)(g,{key:e.tag,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(v,{label:"目的地"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(_,{class:"w-100",modelValue:u.destinTag,"onUpdate:modelValue":t[5]||(t[5]=e=>u.destinTag=e),placeholder:"選擇站點"},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(h.DetermineDestinOptions(),(e=>((0,o.openBlock)(),(0,o.createBlock)(g,{key:e.tag,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"carry"===u.selectedAction|"unload"===u.selectedAction?((0,o.openBlock)(),(0,o.createBlock)(v,{key:1,label:"貨物ID"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(f,{class:"w-100",modelValue:u.Cst_ID_Input,"onUpdate:modelValue":t[6]||(t[6]=e=>u.Cst_ID_Input=e),autocomplete:""},null,8,["modelValue"])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(v,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(w,{class:"w-100 my-2",onClick:h.TaskDeliveryBtnClickHandle,variant:"primary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("派送任務")])),_:1},8,["onClick"])])),_:1}),h.IsDeveloper?((0,o.openBlock)(),(0,o.createBlock)(v,{key:2,label:"Bypass 設備狀態檢查"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(y,{class:"w-100",modelValue:u.bypass_eq_status_check,"onUpdate:modelValue":t[7]||(t[7]=e=>u.bypass_eq_status_check=e)},null,8,["modelValue"])])),_:1})):(0,o.createCommentVNode)("",!0)])),_:1}),(0,o.createVNode)(C,{canva_height:"750px",id:"task_allocation_map",class:"w-100 border rounded mx-2",ref:"_map"},null,512)]),"charge"==u.selectedAction?((0,o.openBlock)(),(0,o.createElementBlock)("div",d)):((0,o.openBlock)(),(0,o.createElementBlock)("div",c))])),[[b,u.wait_task_confirm]])])),_:1},8,["modelValue","onClosed"])])}a(57658),a(67635);var u=a(93867),h=a(53259),p=a(56938);const g=e=>((0,o.pushScopeId)("data-v-3613a1d6"),e=e(),(0,o.popScopeId)(),e),_={class:"mode-text"},v={class:"d-flex flex-row"},f=g((()=>(0,o.createElementVNode)("i",{class:"bi bi-info-square"},null,-1))),w={class:"map-show h-100 border py-2 px-2 d-flex flex-row bg-light"},y={class:"w-100"},V={class:"header-div w-100 d-flex flex-row justify-content-between"},C={class:"options text-start d-flex flex-row"},N={class:"d-flex flex-row option-container"},b=g((()=>(0,o.createElementVNode)("span",null,[(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"}),(0,o.createTextVNode)("顯示方式 ")],-1))),k={class:"d-flex flex-row option-container"},S=g((()=>(0,o.createElementVNode)("span",null,[(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"}),(0,o.createTextVNode)("AGV顯示 ")],-1))),x={class:"p-2 text-start"},E={class:"px-1",style:{position:"absolute",left:"6px"}},T={class:"p-2 text-start border-bottom"},D=g((()=>(0,o.createElementVNode)("span",null,"AGV :",-1))),P={class:"px-1",style:{position:"absolute",left:"6px"}};function A(e,t,a,n,i,s){const r=(0,o.resolveComponent)("b-alert"),l=(0,o.resolveComponent)("b-form-radio"),d=(0,o.resolveComponent)("b-form-group"),c=(0,o.resolveComponent)("b-form-input"),m=(0,o.resolveComponent)("b-button"),u=(0,o.resolveComponent)("el-color-picker"),h=(0,o.resolveComponent)("MapPointSettingDrawer"),p=(0,o.resolveComponent)("el-table-column"),g=(0,o.resolveComponent)("el-table"),A=(0,o.resolveComponent)("b-modal"),I=(0,o.resolveDirective)("loading");return(0,o.openBlock)(),(0,o.createElementBlock)("div",{onMousemove:t[13]||(t[13]=(...e)=>s.MapMouseMoveHandler&&s.MapMouseMoveHandler(...e))},[a.only_view?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createBlock)(r,{key:0,class:"map-notify py-1 px-2 text-start",show:"",variant:"info"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",_,(0,o.toDisplayString)(s.Mode_Text),1),(0,o.createElementVNode)("div",v,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(s.Tips,(e=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{class:"tips-text",key:e},[f,(0,o.createTextVNode)(" "+(0,o.toDisplayString)(e),1)])))),128))])])),_:1})),(0,o.createElementVNode)("div",w,[(0,o.createElementVNode)("div",y,[void 0!=i.hoverPointData?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:0,id:"point-tooltip",class:"rounded text-start p-2",style:(0,o.normalizeStyle)(i.TooltipStyle)},[(0,o.createElementVNode)("div",null,"名稱 :"+(0,o.toDisplayString)(i.hoverPointData.Name),1),(0,o.createElementVNode)("div",null,"Tag :"+(0,o.toDisplayString)(i.hoverPointData.TagNumber)+" ("+(0,o.toDisplayString)(i.hoverPointData.X)+","+(0,o.toDisplayString)(i.hoverPointData.Y)+","+(0,o.toDisplayString)(i.hoverPointData.Direction)+" )",1),(0,o.createElementVNode)("div",null,"站點類型 :"+(0,o.toDisplayString)(s.GetPointTypeNameByTypeNum(i.hoverPointData.StationType)),1)],4)):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",V,[(0,o.createElementVNode)("div",C,[(0,o.createElementVNode)("div",N,[b,(0,o.createVNode)(d,{onChange:s.NameDisplayChangeHandle},{default:(0,o.withCtx)((({ariaDescribedby:e})=>[(0,o.createVNode)(l,{modelValue:i.display_selected,"onUpdate:modelValue":t[0]||(t[0]=e=>i.display_selected=e),"aria-describedby":e,name:"some-radios",value:"Index"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Index")])),_:2},1032,["modelValue","aria-describedby"]),(0,o.createVNode)(l,{modelValue:i.display_selected,"onUpdate:modelValue":t[1]||(t[1]=e=>i.display_selected=e),"aria-describedby":e,name:"some-radios",value:"Tag"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Tag")])),_:2},1032,["modelValue","aria-describedby"]),(0,o.createVNode)(l,{modelValue:i.display_selected,"onUpdate:modelValue":t[2]||(t[2]=e=>i.display_selected=e),"aria-describedby":e,name:"some-radios",value:"Name"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("名稱")])),_:2},1032,["modelValue","aria-describedby"])])),_:1},8,["onChange"])]),(0,o.createElementVNode)("div",k,[S,(0,o.createVNode)(d,{onChange:s.AGVDisplayChangeHandle},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{modelValue:i.agv_display_mode_selected,"onUpdate:modelValue":t[3]||(t[3]=e=>i.agv_display_mode_selected=e),value:"hidden"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("隱藏")])),_:1},8,["modelValue"]),(0,o.createVNode)(l,{modelValue:i.agv_display_mode_selected,"onUpdate:modelValue":t[4]||(t[4]=e=>i.agv_display_mode_selected=e),value:"show"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("顯示")])),_:1},8,["modelValue"])])),_:1},8,["onChange"])])]),(0,o.createElementVNode)("div",null,[(0,o.createVNode)(c,{modelValue:s.map_name,"onUpdate:modelValue":t[5]||(t[5]=e=>s.map_name=e),disabled:"",size:"sm",state:void 0!=s.map_name},null,8,["modelValue","state"])])]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("div",{ref:"map",key:i.reload_key,class:"map border",onClick:t[10]||(t[10]=(...t)=>e.HideAllMenus&&e.HideAllMenus(...t))},[i.showTaskAllocationMenu?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:0,class:"edit-mode-menu bg-light border rounded",ref:"contextMenu",style:(0,o.normalizeStyle)(i.map_contextmenu_style)},[(0,o.createElementVNode)("div",x,[(0,o.withDirectives)((0,o.createElementVNode)("span",null,"Tag:",512),[[o.vShow,!s.is_agv_feature_selected]]),(0,o.withDirectives)((0,o.createElementVNode)("span",null,"AGV:",512),[[o.vShow,s.is_agv_feature_selected]]),(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(s.is_agv_feature_selected?s.current_select_agv_name:s.current_select_featureID),1)]),(0,o.createElementVNode)("div",E,[(0,o.createVNode)(m,{class:"w-100 my-1",size:"sm",variant:"primary",onClick:t[6]||(t[6]=e=>s.handleTaskAllocatModeMenuClick("move"))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("移動")])),_:1}),(0,o.createVNode)(m,{class:"w-100 my-1",size:"sm",variant:"primary",onClick:t[7]||(t[7]=e=>s.handleTaskAllocatModeMenuClick("load"))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("放貨")])),_:1}),(0,o.createVNode)(m,{class:"w-100 my-1",size:"sm",variant:"primary",onClick:t[8]||(t[8]=e=>s.handleTaskAllocatModeMenuClick("unload"))},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取貨")])),_:1})])],4)):(0,o.createCommentVNode)("",!0),i.showAGVMenu?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:1,class:"edit-mode-menu bg-light border rounded",ref:"contextMenu",style:(0,o.normalizeStyle)(i.map_contextmenu_style)},[(0,o.createElementVNode)("div",T,[D,(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(s.current_select_agv_name),1)]),(0,o.createElementVNode)("div",P,[(0,o.createVNode)(u,{modelValue:e.color,"onUpdate:modelValue":t[9]||(t[9]=t=>e.color=t),"show-alpha":""},null,8,["modelValue"])])],4)):(0,o.createCommentVNode)("",!0)])),[[I,i.loading]])]),(0,o.createVNode)(h,{ref:"point-setting-drawer",onOnPointSettingChanged:s.PointSettingChangedHandle},null,8,["onOnPointSettingChanged"])]),(0,o.createVNode)(A,{draggable:"",title:"移除路徑",modelValue:i.selectPathVisible,"onUpdate:modelValue":t[11]||(t[11]=e=>i.selectPathVisible=e),"hide-header-close":!0,"hide-footer":"","no-close-on-esc":"",onCancel:t[12]||(t[12]=()=>{i.selectPathVisible=!1}),"header-bg-variant":"primary","header-text-variant":"light"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{height:"150px","row-key":"startPoint.Name",data:i.PathesSelectedForDelete},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{label:"起點",prop:"startPoint.Name"}),(0,o.createVNode)(p,{label:"終點",prop:"endPoint.Name"}),(0,o.createVNode)(p,null,{default:(0,o.withCtx)((e=>[(0,o.createVNode)(m,{variant:"danger",onClick:t=>s.RemovePathByPointsIndex(e.row.startStation_Index,e.row.endStation_Index)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Remove")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])],32)}a(71827),a(22635);var I=a(19716),B=a(1508),L=a(50563),M=a(98843),O=a(93292),G=a(92949),R=a(22205),H=a(19966),F=a(88437),U=a(67339),Z=a(7712),$=a(96241),q=a(17983),z=(a(65176),a(321)),Q=a(66615),j=a(83592),Y=a(83361),K=(a(60487),a(663)),W=a(95320),J={name:"MapComponent",components:{MapPointSettingDrawer:Y.Z},props:{edit_mode:{type:Object,default(){return{enabled:!1,mode_selected:"none"}}},task_allocatable:{type:Boolean,default:!1},show_agv:{type:Boolean,default:!0},only_view:{type:Boolean,default:!0},zoom:{type:Number,default:6}},data(){return{reload_key:1,loading:!1,selected_feature:void 0,mouse_click_coordinate:void 0,display_selected:"Name",agv_display_mode_selected:"show",map:new I.Z,showTaskAllocationMenu:!1,showAGVMenu:!1,selectPathVisible:!1,PathesSelectedForDelete:[],dynamic_traffic_data:{AGVTrafficStates:{}},path_plan_tags:[],contextMenu:{},agv_color_set:["lime","rgb(51, 194, 255)","yellow","rgb(64, 158, 255)","pink","gold","red","grey"],TooltipStyle:{top:"0px",left:"0px"},hoverPointData:void 0,map_contextmenu_style:{position:"absolute",top:"112px",left:"400px",visibility:"visible",zIndex:200,width:"170px",height:"157px"},layer_index:{station:1,station_line:2,eq_station:3,agv:4,move_path:5,path_plan:6,mesh:7},stations:[],station_features:[],agvList:[],path_start_end:{start:void 0,end:void 0},PathPlanLineStyle:new R.ZP({stroke:new H.Z({color:"blue",width:8,lineDash:null})}),pointStyle:e=>{const t=function(e){var t=e.getId();if(t){var a=t.split(":"),o=a[1],n=a[2],i=a[3],s=a[4];return{index:o,tag:n,station_type:i,name:s}}};var a=e.get("data"),o=t(e),n="",i="gold";"Name"==this.display_selected?(n=o.name,i="gold"):"Tag"==this.display_selected?(n=o.tag,i="lime"):(n=o.index,i="rgb(90, 213, 255)");var s=new F.Z({src:"/images/eq-icon.png",scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"}),r=new F.Z({src:"/images/rack_station.png",scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"}),l=new F.Z({src:"/images/charging-station.png",scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"}),d=e=>new H.Z({color:e?"red":"black",width:e?2:1}),c=(e,t=0,a="rgb(37, 172, 95)",o=!1)=>new U.Z({radius:7,fill:new Z.Z({color:a}),stroke:d(o),angle:t,points:e}),m=(e,t=!1)=>new $.Z({radius:6,fill:new Z.Z({color:e}),stroke:d(t)}),u=[1,11,21,32],h=[2,6,12,22],p=[3,5,6],g=3,_=0,v="rgb(243, 123, 55)";u.includes(a.StationType)?(g=4,_=Math.PI/180*45):h.includes(a.StationType)?(g=4,_=Math.PI/180*90):p.includes(a.StationType)&&(g=3,_=Math.PI/180*0),a.Enable?(a.IsSegment|a.IsAvoid&&(v="rgb(0, 122, 255)"),a.IsParking&&(v="pink")):v="red";var f=e.get("highlight"),w=e.get("selected"),y=e.get("data").IsEquipment,V=e.get("data").IsCharge,C=e.get("data").IsSTK,N=e.get("IsRegisted"),b=()=>y?s:C?r:V?l:0==a.StationType?m(v,w):c(g,_,v,w);return new R.ZP({image:b(),text:new q.Z({text:n+(N?"(已註冊)":""),offsetX:12,offsetY:y|V?-25:-15,font:"bold 14px sans-serif",fill:new Z.Z({color:a.Enable?i:"rgb(255, 106, 138)"}),stroke:new H.Z({color:f|w?"red":"black",width:f?4:3})})})},point_icon_style:e=>new R.ZP({}),pathStyle:e=>{var t=e.get("data").IsEQLink,a=e.get("data").IsPathClose;const o=e.getGeometry(),n=[new R.ZP({stroke:new H.Z({color:a?"red":t?"rgb(115, 115, 115)":"rgb(176, 176, 178)",width:2.7,lineDash:t?[4,11]:null})})];return o.forEachSegment((function(e,t){const o=t[0]-e[0],i=t[1]-e[1],s=Math.atan2(i,o);if(n.push(new R.ZP({geometry:new G.Z(t),image:new F.Z({src:"arrow.png",anchor:[1.2,.5],rotateWithView:!0,rotation:-s,scale:.18,color:a?"red":"white"})})),a){e=[(t[0]+e[0])/2,(t[1]+e[1])/2];const a=t[0]-e[0],o=t[1]-e[1],i=Math.atan2(o,a);n.push(new R.ZP({geometry:new G.Z(e),image:new F.Z({src:"close.png",anchor:[1.2,.5],rotateWithView:!0,rotation:-i,scale:.5})}))}})),n},UnloadIconStyle:e=>{if(this.task_allocatable){var t=e.get("data");if(1==t.StationType&&e.get("unload")){var a=new F.Z({src:"/unloading.png",scale:1,anchor:[0,1.3],size:[44,44],opacity:1,offset:[0,1]});return new R.ZP({image:a})}}},path_store:{},IsSelectAGVMode:!1,IsSelectEQStationMode:!1}},async mounted(){this.loading=!0,this.show_agv||(this.agv_display_mode_selected="hidden"),setTimeout((()=>{this.FetchMap(),h.Z.on("unload_eq_tags",(e=>{this.SetFeatureHasUnloadReq(e)})),this.TrafficStateWsInit()}),300)},computed:{map_data(){return W.p.getters.MapData},map_name(){return W.p.getters.MapName},Mode_Text(){return this.edit_mode.enabled?"edit_point"==this.edit_mode.mode_selected?"編輯點位模式":"add_point"==this.edit_mode.mode_selected?"新增點位模式":"remove_point"==this.edit_mode.mode_selected?"移除點位模式":"add_path"==this.edit_mode.mode_selected?"新增路徑模式":"remove_path"==this.edit_mode.mode_selected?"移除路徑模式":void 0:"檢視模式"},Tips(){return this.edit_mode.enabled?"edit_point"==this.edit_mode.mode_selected?["使用滑鼠【左鍵】拖曳點位。","滑鼠【右鍵】點擊點位顯示編輯頁面。"]:"add_point"==this.edit_mode.mode_selected?["使用滑鼠【右鍵】點擊地圖新增點位。"]:"remove_point"==this.edit_mode.mode_selected?["使用滑鼠【左鍵】點擊欲移除的點位。"]:"add_path"==this.edit_mode.mode_selected?["使用滑鼠【左鍵】點擊路徑起點點位以及終點點位。"]:"remove_path"==this.edit_mode.mode_selected?["使用滑鼠【左鍵】點擊欲移除的路徑。"]:void 0:[]},current_select_featureID(){return this.selected_feature?this.selected_feature.getId():""},current_select_agv_name(){return(this.current_select_featureID+"").replace("AGV_","")},is_agv_feature_selected(){if(!this.selected_feature)return!1;var e=this.selected_feature.getId();return(e+"").includes("AGV")},Station_Layer(){return this.map.getLayers().item(this.layer_index.station)},Line_Layer(){return this.map.getLayers().item(this.layer_index.station_line)},AGV_Layer(){return this.map.getLayers().item(this.layer_index.agv)},Nav_Path_Layer(){return this.map.getLayers().item(this.layer_index.move_path)},PathPlan_Layer(){return this.map.getLayers().item(this.layer_index.path_plan)},Mesh_Layer(){return this.map.getLayers().item(this.layer_index.mesh)}},methods:{GetPointTypeNameByTypeNum(e){return(0,j.GR)(e)},UpdatePathPlanRender(e=[]){this.path_plan_tags=e;let t=this.PathPlan_Layer.getSource();if(t.clear(),0!=e.length){var a=this.CreateLineFeaturesOfPath(e);t.addFeatures(a),t.changed()}},CreateLineFeaturesOfEachStaion(){var e=[];return this.map_data.Pathes.forEach((t=>{var a=t.StartPoint.TagNumber,o=t.EndPoint.TagNumber,n=this.stations.find((e=>e.tag==a)),i=this.stations.find((e=>e.tag==o)),s=n.feature,r=i.feature;let l=new B.Z({geometry:new Q.Z([s.getGeometry().getCoordinates(),r.getGeometry().getCoordinates()])});l.setId(`path:${n.index}:${i.index}`),l.set("data",t),e.push(l)})),e},CreateLineFeaturesOfPath(e=[],t){var a=[];for(let i=0;i<e.length;i++){const s=e[i],r=e[i+1];if(void 0!=r){var o=this.stations.find((e=>e.tag==s)),n=this.stations.find((e=>e.tag==r));let e=new B.Z({geometry:new Q.Z([o.feature.getGeometry().getCoordinates(),n.feature.getGeometry().getCoordinates()])});e.setStyle(new R.ZP({stroke:new H.Z({color:t,width:6})})),a.push(e)}}return a},AGVDisplayControl(e){this.AGV_Layer.setVisible(e),this.Nav_Path_Layer.setVisible(e)},UpdatePointDisplay(){this.Station_Layer.getSource().changed()},PointSettingChangedHandle(e){var t=e.index,a=e.pointData;this.map_data.Points[t]=a;var o=this.stations.filter((e=>e.index==t))[0].feature;this.SetPointFeatureIDByPointData(o,t,a),this.stations.filter((e=>e.index==t))[0].feature=o},SetPointFeatureIDByPointData(e,t,a){var o=`Point:${t}:${a.TagNumber}:${a.StationType}:${a.Name}`;e.setId(o),e.set("data",a)},Highlight(e="normal|eq|charge|park"){this.AllUnHighlight();var t=[];"normal"==e&&(t=this.GetAllNormalPtFeature()),"eq"==e&&(t=this.GetAllEQPtFeature()),"charge"==e&&(t=this.GetAllChargePtFeature()),"park"==e&&(t=this.GetAllParkPtFeature()),this.HighlightControl(t,!0)},AllUnHighlight(){this.HighlightControl(this.station_features,!1)},HighlightControl(e=[],t){e.forEach((e=>{e.set("highlight",t)}))},TrafficStateWsInit(){const e=new Worker("websocket_worker.js");e.onmessage=e=>{this.dynamic_traffic_data=e.data,setTimeout((()=>{var e=e=>1==e?"IDLE":2==e?"RUN":3==e?"DOWN":4==e?"充電":"Unknown";this.UpdateRegistedPropery(this.dynamic_traffic_data.RegistedPoints);var t=[];Object.keys(this.dynamic_traffic_data.AGVTrafficStates).forEach((a=>{var o=this.dynamic_traffic_data.AGVTrafficStates[a],n=null==o.CurrentPosition?0:o.CurrentPosition.TagNumber;t.push({AGV_Name:o.AGVName,Current_Tag:n,State:e(o.AGVStatus),IsOnline:o.IsOnline})})),this.show_agv&&(this.UpdateAGVLayer(t),Object.keys(this.dynamic_traffic_data.AGVTrafficStates).forEach((e=>{var t=this.dynamic_traffic_data.AGVTrafficStates[e],a=t.RemainNavTrajectory.map((e=>e.TagNumber)),o=null==t.CurrentPosition?0:t.CurrentPosition.TagNumber;this.UpdateNavPathRender(e,o,a)})))}),100)},e.postMessage({command:"connect",ws_url:K.Z.vms_ws_host+"/ws/DynamicTrafficData"})},UpdateRegistedPropery(e){var t=Object.keys(e);this.station_features.forEach((e=>{var a=e.get("data").TagNumber,o=t.includes(a);e.set("IsRegisted",o)}))},MapMouseMoveHandler(e){this.TooltipStyle.left=`${e.x}px`,this.TooltipStyle.top=e.y-110+"px"},Reload(){this.FetchMap()},FetchMap(){setTimeout((()=>{this.map_data?(this.loading=!1,this.MapDataInit(),this.MapInitializeRender(),u.Z.Success("Success Fetch Map Data From Server.","bottom",2e3)):(u.Z.Warning("嘗試下載圖資...","bottom",3e3),this.FetchMap())}),1e3)},get_agv_position(e){var t=this.agvList.find((t=>t.name==e));return this.get_agv_position_byTag(t.current_tag)},get_agv_position_byTag(e){var t=this.station_features.find((t=>t.get("data").TagNumber==e));return void 0==t?[0,0]:t.getGeometry().getCoordinates()},GetNormalStations(){if(!this.map_data)return[];var e=Object.values(this.map_data.Points);return e.filter((e=>0==e.StationType))},GetLDULDableStations(){if(!this.map_data)return[];const e=[1,2,6,11,12,21,22];var t=Object.values(this.map_data.Points);return t.filter((t=>e.includes(t.StationType)))},GetChargeStations(){if(!this.map_data)return[];const e=[3,5,6];var t=Object.values(this.map_data.Points);return t.filter((t=>e.includes(t.StationType)))},GetParkStations(){if(!this.map_data)return[];var e=Object.values(this.map_data.Points);return e.filter((e=>e.IsParking))},MapDataInit(){this.map_name=this.map_data.Name,this.stations=[],Object.keys(this.map_data.Points).forEach((e=>{var t=this.map_data.Points[e],a=t.Graph,o=t.TagNumber,n=t.StationType,i=new B.Z({geometry:new G.Z([1e3*a.X,-1e3*a.Y]),name:e});this.SetPointFeatureIDByPointData(i,e,t),i.set("StationType",n),i.set("Tag",o),this.AddStation({index:e,tag:o,feature:i})}))},AddStation(e){e.feature.set("highlight",!1),this.stations.push(e),this.station_features.push(e.feature)},GetAllNormalPtFeature(){return this.station_features.filter((e=>0==e.get("StationType")))},GetAllParkPtFeature(){return this.station_features.filter((e=>e.get("data").IsParking))},GetAllEQPtFeature(){return this.station_features.filter((e=>e.get("data").IsEQLink))},GetAllChargePtFeature(){return this.station_features.filter((e=>e.get("data").IsCharge))},MapInitializeRender(){const e=this.CreateLineFeaturesOfEachStaion();this.map=new I.Z({target:this.$refs.map,layers:[new M.Z({source:new O.Z,name:"1"}),new M.Z({source:new O.Z({features:this.station_features}),style:this.pointStyle,zIndex:2}),new M.Z({source:new O.Z({features:e}),style:this.pathStyle,zIndex:1}),new M.Z({source:new O.Z}),new M.Z({source:new O.Z({features:[]}),zIndex:11111}),new M.Z({source:new O.Z({features:[]}),zIndex:122}),new M.Z({source:new O.Z({features:[]}),style:this.PathPlanLineStyle}),new M.Z({source:new O.Z({features:this.station_features}),style:this.UnloadIconStyle,zIndex:122}),new M.Z({source:new O.Z({features:[new B.Z({geometry:new G.Z([0,0]),name:"原點",id:"原點"})]}),style:e=>new R.ZP({text:new q.Z({text:e.getId(),offsetX:12,offsetY:-15,font:"bold 14px sans-serif",fill:new Z.Z({color:"black"}),stroke:new H.Z({color:"black",width:3})})}),zIndex:122})],view:new L.ZP({center:[0,0],zoom:this.zoom})}),this.show_agv||this.AGVDisplayControl(!1),this.CreateMapEvent(),this.CreateMeshLayer(),this.$emit("loaded","")},CreateMapEvent(){var e=this,t=()=>e.edit_mode.enabled,a=()=>"edit_point"==e.edit_mode.mode_selected,o=()=>"remove_point"==e.edit_mode.mode_selected,n=()=>"add_point"==e.edit_mode.mode_selected,i=()=>"remove_path"==e.edit_mode.mode_selected,s=()=>"add_path"==e.edit_mode.mode_selected;this.map.on("pointerup",(a=>{e.selected_feature&&(this.hoverPointData=void 0,t()&&n()&&2===a.originalEvent.button&&(document.addEventListener("contextmenu",(function(e){e.preventDefault()})),e.AddNewPoint()),e.$emit("onStationClick",e.selected_feature.get("data")))})),this.map.on("pointerdown",(n=>{e.mouse_click_coordinate=n.coordinate,this.selected_feature&&this.selected_feature.set("selected",!1),this.selected_feature=this.map.forEachFeatureAtPixel(n.pixel,(r=>{if(r){if(e.selected_feature=r,e.selected_feature.set("selected",!0),!t())return;var l=r.getId(),d=(l+"").includes("path:");if(2===n.originalEvent.button)document.addEventListener("contextmenu",(function(e){e.preventDefault()})),a()&&e.ShowPointSettingDrawer();else if(0===n.originalEvent.button)if(i()){if(!d)return;e.RemovePath()}else if(o()){if(d)return;e.RemovePoint()}else if(s()){if(d)return;void 0==e.path_start_end.start?e.path_start_end.start=r:(e.path_start_end.end=r,e.UpdatePathOfBetweenTags())}}return r}))}));var r=new z.Z({handleDownEvent:function(t){var a=t.map,o=a.forEachFeatureAtPixel(t.pixel,(function(e){return e}));if(!o)return!1;e.selected_feature=o;var n=o.getId();return!!n&&(this.feature_=o,this.coordinate_=t.coordinate,!0)},handleDragEvent:function(o){if((!t()||!n()||0!==o.originalEvent.button)&&t()&&(a()||n())){var i=o.coordinate[0]-this.coordinate_[0],s=o.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(i,s),this.coordinate_=o.coordinate,e.UpdateStationPathLayer();var l=e.selected_feature.getId(),d=parseInt(l.split(":")[1]),c=e.selected_feature.getGeometry().getCoordinates();e.map_data.Points[d].Graph.X=Math.round(c[0]/1e3,0),e.map_data.Points[d].Graph.Y=Math.round(c[1]/-1e3,0),e.UpdatePathPlanRender(e.path_plan_tags)}},handleUpEvent:function(){return this.feature_=null,this.coordinate_=null,!1},handleMoveEvent:function(e){var t=e.map,a=t.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));t.getTargetElement().style.cursor=a?"pointer":""}});this.map.addInteraction(r)},UpdateStationPathLayer(){var e=this.CreateLineFeaturesOfEachStaion(),t=this.Line_Layer.getSource();t.clear(),t.addFeatures(e),t.changed()},UpdatePathOfBetweenTags(){var e=this.GetPointDataByFeature(this.path_start_end.start),t=this.GetPointDataByFeature(this.path_start_end.end);if(!e|!t)this.path_start_end={start:void 0,end:void 0};else{if(e.index!=t.index){var a=this.map_data.Points[e.index],o=this.map_data.Points[t.index];void 0==a.Target[t.index]&&(a.Target[t.index]=1,this.map_data.Pathes.push({StartPoint:a,EndPoint:o})),this.UpdateStationPathLayer()}this.path_start_end={start:void 0,end:void 0}}},CreateMeshLayer(){for(var e=new O.Z,t=new M.Z({source:e,zIndex:-1}),a=new R.ZP({stroke:new H.Z({color:"rgba(0, 0, 0, 0.1)",width:1})}),o=this.map.getView().getProjection().getExtent(),n=8e4,i=o[0];i<o[2];i+=n){var s=new Q.Z([[i,o[1]],[i,o[3]]]),r=new B.Z({geometry:s});r.setStyle(a),e.addFeature(r)}for(var l=o[1];l<o[3];l+=n){s=new Q.Z([[o[0],l],[o[2],l]]),r=new B.Z({geometry:s});r.setStyle(a),e.addFeature(r)}this.map.addLayer(t)},UpdateAGVLayer(e){if(this.AGV_Layer){var t=this.CreateAGVFeatures(e),a=this.AGV_Layer.getSource();a.clear(),a.addFeatures(t.agv_features),a.changed();var o=this.Nav_Path_Layer.getSource();o.clear(),o.addFeatures(t.agv_nav_path_features),o.changed()}},GetAgvProp(e){return this.agvList.find((t=>t.name==e))},HightlightAGV(e){this.agvList.forEach((e=>{e.heighlight=!1,e.isOnline=!1}));var t=this.GetAgvProp(e);t&&(this.GetAgvProp(e).heighlight=!0)},CreateAGVFeatures(e=[]){var t=[],a=[],o=0;return e.forEach((e=>{var n=e.AGV_Name,i=e.Current_Tag,s=e.State,r=e.IsOnline,l=this.GetAgvProp(n);l?(l.current_tag=i,l.theta=e.Rotation,l.state=s):(l={name:n,current_tag:i,previous_tag:-1,color:this.agv_color_set[o],theta:e.Rotation,state:s,heighlight:!1},this.agvList.push(l));var d=this.get_agv_position(n),c=new B.Z({geometry:new G.Z(d),name:n});c.setId("AGV_"+n),t.push(c);var m=new F.Z({src:"/agv.png",scale:.8,anchor:[.5,.5],size:[60,60],opacity:1});c.setStyle(new R.ZP({image:m,text:new q.Z({text:n,offsetX:0,offsetY:20,font:"bold 14px Arial",fill:new Z.Z({color:r?l.color:"rgb(192, 192, 192)"}),stroke:new H.Z({color:"black",width:3})})}));var u=new B.Z({geometry:new G.Z(d),name:n});a.push(u),o+=1})),{agv_features:t,agv_nav_path_features:a}},ShowPointSettingDrawer(){var e=this.GetPointDataByFeature(this.selected_feature);e&&this.$refs["point-setting-drawer"].Show(e)},RemovePoint(){var e=this.GetPointDataByFeature(this.selected_feature);delete this.map_data.Points[e.index];var t=this.stations.findIndex((t=>t.index==e.index));this.stations.splice(t,1),this.Station_Layer.getSource().removeFeature(this.selected_feature),this.Station_Layer.getSource().changed(),this.UpdateStationPathLayer()},SetFeatureHasUnloadReq(e){this.station_features.forEach((t=>{var a=t.get("data"),o=e.includes(a.TagNumber);t.set("unload",o)}))},async AddNewPoint(){var e=this.GetNewPointIndex(),t=this.Station_Layer.getSource(),a=new B.Z({geometry:new G.Z(this.mouse_click_coordinate),name:e}),o=await this.CloneAPointData();o.Graph={X:parseInt(this.mouse_click_coordinate[0]/1e3),Y:parseInt(this.mouse_click_coordinate[1]/-1e3),Display:e+""},o.TagNumber=e,o.Target={},o.Name=e+"",this.map_data.Points[e]=o,this.SetPointFeatureIDByPointData(a,e,o),this.AddStation({index:e,tag:e,feature:a}),t.addFeature(a),this.UpdateStationPathLayer()},handleAGVMenuItemClick(e){this.showAGVMenu=!1},handleTaskAllocatModeMenuClick(e){this.showTaskAllocationMenu=!1},ChangeFillColorOfFeature(e,t){var a=new Z.Z({color:t}),o=new R.ZP({fill:a});e.setStyle(o),this.GetLayerOfFeature(e).getSource().refresh()},RemovePath(e=!0){var t=this.selected_feature.getId(),a=t.split(":"),o=parseInt(a[1]),n=parseInt(a[2]),i=this.map_data.Points[o],s=this.map_data.Points[n],r=this.GetPathIndex(s,i);if(-1!=r)return this.PathesSelectedForDelete=[{startPoint:i,endPoint:s,startStation_Index:o,endStation_Index:n},{startPoint:s,endPoint:i,startStation_Index:n,endStation_Index:o}],void(this.selectPathVisible=!0);this.RemovePathByPointsIndex(o,n)},RemovePathByPointsIndex(e,t){var a=this.map_data.Points[e],o=this.map_data.Points[t];delete a.Target[t];var n=this.GetPathIndex(a,o);this.map_data.Pathes.splice(n,1),this.UpdateStationPathLayer(),this.path_start_end={start:void 0,end:void 0},this.selectPathVisible=!1},GetPathIndex(e,t){return this.map_data.Pathes.findIndex((a=>a.StartPoint.TagNumber==e.TagNumber&&a.EndPoint.TagNumber==t.TagNumber))},GetNewPointIndex(){if(0==this.stations.length)return 1;const e=Object.keys(this.map_data.Points).map(Number).sort(((e,t)=>e-t)),t=e[e.length-1];return t+1},async CloneAPointData(){if(0==this.stations.length){var e=await j.ZP.GetMapStationTemplate();return JSON.parse(JSON.stringify(e))}var t=Object.values(this.map_data.Points),a=t[t.length-1];return JSON.parse(JSON.stringify(a))},GetPointDataByFeature(e){var t=e.getId(),a=parseInt(t.split(":")[1]),o=parseInt(t.split(":")[2]);if(o){var n=this.map_data.Points[a];return{index:a,point:n}}},NameDisplayChangeHandle(){this.UpdatePointDisplay()},AGVDisplayChangeHandle(){this.AGVDisplayControl("show"==this.agv_display_mode_selected)},UpdateNavPathRender(e,t,a=[]){var o=`agv_path_layer_${e}`,n=this.map.getLayers().getArray().find((e=>e.get("id")==o));let i;if(n){if(this.path_store[e].length==a.length)return;this.path_store[e]=a,i=n.getSource()}else{this.path_store[e]=a;var s=new O.Z,r=new M.Z({source:s,zIndex:666,id:o});this.map.addLayer(r),i=r.getSource()}i.clear();var l=e=>{var t=this.agvList.find((t=>t.name==e)),a="blue";return t&&(a=t.color),a},d=l(e);if(0!=a.length){var c=this.CreateLineFeaturesOfPath(a,d);i.addFeatures(c)}i.changed()}}},X=a(40089);const ee=(0,X.Z)(J,[["render",A],["__scopeId","data-v-3613a1d6"]]);var te=ee,ae=a(76105),oe=a(8764),ne=a(24239),ie=a(79072),se=a(64491),re={components:{MapShowVue:te,Map:ae["default"]},data(){return{show:!1,clsAgvStatus:new p.Z,confirm_dialog_show:!1,notify_dialog_show:!1,wait_task_confirm:!1,bypass_eq_status_check:!1,notify_text:"",selectedAGVName:"",selectedAction:"move",sourceTag:"",destinTag:"",Cst_ID_Input:"",moveable_tags:[{tag:1,name:"標籤1"}],parkable_tags:[],stock_tags:[{tag:1,name:"標籤1"},{tag:2,name:"標籤2"}],chargable_tags:[{tag:50,name:"充電站(TAG-50)"},{tag:70,name:"充電站(TAG-70)"}],downstream_tags:[{tag:1,name:"標籤1"},{tag:2,name:"標籤2"}],csts:[{tag:1,name:""}],agv_type:0,equipments_options:void 0}},computed:{Map(){return this.$refs["_map"]},AgvNameList(){var e=[];function t(e){ne.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return ne.cy.getters.IsRunMode?(e.push({value:"",label:"自動選車"}),this.IsDeveloper&&t(e)):t(e),e},tags(){return"move"==this.selectedAction?this.moveable_tags:"charge"==this.selectedAction?this.chargable_tags:"load"==this.selectedAction|"unload"==this.selectedAction|"carry"==this.selectedAction?this.stock_tags:this.parkable_tags},IsDeveloper(){return ne.HP.getters.IsDeveloperLogining},IsUserLogin(){return 0!=ne.HP.getters.level},bay_names(){var e=W.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},exchanger_options(){return W.p.getters.AllExangeBatteryStation}},methods:{ActionChangeHandler(e){this.sourceTag=void 0,this.destinTag=void 0;var t="blue";"move"==e&&this.Map.HighLightFeaturesByStationType(0,t),"carry"==e|"load"==e|"unload"==e&&this.Map.HighLightFeaturesByStationType(1,t),"charge"==e&&this.Map.HighLightFeaturesByStationType(3,t)},HandleNavPathPreviewBtnClick(){},DetermineDestinOptions(){return"measure"==this.selectedAction?this.bay_names:"carry"==this.selectedAction?this.downstream_tags:"exchange_battery"==this.selectedAction?this.exchanger_options:this.tags},TaskDeliveryBtnClickHandle(){if(this.selectedAGVName||ne.cy.getters.IsRunMode)if(this.selectedAction)if(""==this.destinTag|void 0==this.destinTag)this.$swal.fire({text:"",title:"尚未選擇目的地",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else if("carry"==this.selectedAction&&""==this.sourceTag|void 0==this.sourceTag)this.$swal.fire({text:"",title:"尚未選擇起點",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else{var e=this.destinTag;this.$swal.fire({title:"確定要派送此任務?",text:`${this.selectedAGVName} 執行 ${this.selectedAction.toUpperCase()} 任務,終點:${e}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.TaskDeliveryHandle()}))}else this.$swal.fire({text:"",title:"尚未選擇動作",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else this.$swal.fire({text:"",title:"尚未選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async TaskDeliveryHandle(){0==ne.HP.getters.level&&(this.bypass_eq_status_check=!1),this.wait_task_confirm=!0;var e={confirm:!0,message:""};if("move"==this.selectedAction&&(e=await oe.J8.MoveTask(new oe.ec(this.selectedAGVName,this.destinTag,50))),"measure"==this.selectedAction&&(e=await oe.J8.MeasureTask(new oe.FV(this.selectedAGVName,this.destinTag))),"load"==this.selectedAction&&(e=await oe.J8.LoadTask(new oe.Y4(this.selectedAGVName,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selectedAction&&(e=await oe.J8.UnloadTask(new oe.On(this.selectedAGVName,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selectedAction&&(e=await oe.J8.CarryTask(new oe.mc(this.selectedAGVName,this.sourceTag,1,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"exchange_battery"==this.selectedAction&&(e=await oe.J8.ExangeBatteryTask(new oe.Z$(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),"charge"==this.selectedAction&&(e=await oe.J8.ChargeTask(new oe.fn(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),"park"==this.selectedAction&&(e=await oe.J8.ParkTask(new oe.Nn(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),this.wait_task_confirm=!1,200!=e.status){const t=401==e.status;this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{t&&(this.show=!1,ne.HP.dispatch("logout",""),h.Z.emit("/show-login-view-invoke"))}))}else e.data.confirm?(u.Z.Success(`任務-[${this.selectedAction.toUpperCase()}] 已派送!`,"bottom",2e3),setTimeout((()=>{this.show=!1}),400)):this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},HandleDrawerClosed(){},MapStationClicked(e){if(e){var t=e.StationType;0==t&&(this.selectedAction="move"),1==t&&(this.selectedAction="unload"),3==t&&(this.selectedAction="charge");var a=this.tags.findLast((t=>t.tag==e.TagNumber));console.info(a),a&&(this.sourceTag=e.TagNumber)}},async HandleFromSelectChanged(e){this.destinTag=void 0,this.downstream_tags=[],this.equipments_options=await(0,se.H5)();var t=this.equipments_options.find((t=>t.TagID==e));if(t){var a=t.ValidDownStreamEndPointNames;console.info(a);var o=this.equipments_options.filter((e=>a.includes(e.Name)));console.info(o),Object.values(o).forEach((e=>{this.downstream_tags.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`})}))}}},mounted(){h.Z.on("bus-show-task-allocation",((e={agv_name:void 0,agv_type:0,action:"",station_data:new ie.ux})=>{this.IsUserLogin||ne.cy.getters.IsRunMode?(this.agv_type=e.agv_type,this.sourceTag=void 0,this.destinTag=void 0,this.selectedAGVName=ne.cy.getters.IsRunMode?"":void 0,this.moveable_tags=W.p.getters.AllNormalStationOptions,this.stock_tags=W.p.getters.AllEqStation,this.chargable_tags=W.p.getters.AllChargeStation,this.parkable_tags=W.p.getters.AllParkingStationOptions,this.selectedAction=e.action,e.agv_name&&(this.selectedAGVName=e.agv_name),e.station_data&&("carry"==this.selectedAction?(this.sourceTag=e.station_data.TagNumber,this.HandleFromSelectChanged(this.sourceTag)):this.destinTag=e.station_data.TagNumber),this.show=!0):setTimeout((()=>{this.$swal.fire({text:"",title:"請先進行登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{h.Z.emit("/show-login-view-invoke")}))}),200)}))}};const le=(0,X.Z)(re,[["render",m],["__scopeId","data-v-543e5f68"]]);var de=le},49857:function(e,t,a){"use strict";a.d(t,{Z:function(){return O}});var o=a(79003);const n=e=>((0,o.pushScopeId)("data-v-1ce47aed"),e=e(),(0,o.popScopeId)(),e),i={class:"task-status card-like"},s={class:"title d-flex flex-row justify-content-between"},r=n((()=>(0,o.createElementVNode)("div",null,[(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"}),(0,o.createTextVNode)("任務狀態 TASK STATUS")],-1))),l={key:0,class:"px-1"},d={key:1,class:"column-display-mode"},c=n((()=>(0,o.createElementVNode)("div",{class:"title-display"},"等待/執行中任務",-1))),m=n((()=>(0,o.createElementVNode)("div",{class:"title-display"},"已結束任務",-1))),u={class:"setting-container w-100 bg-light text-start"};function h(e,t,a,n,h,p){const g=(0,o.resolveComponent)("RunningTaskTable"),_=(0,o.resolveComponent)("el-tab-pane"),v=(0,o.resolveComponent)("CompletedTaskTable"),f=(0,o.resolveComponent)("el-tabs"),w=(0,o.resolveComponent)("el-checkbox"),y=(0,o.resolveComponent)("el-drawer");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[(0,o.withDirectives)((0,o.createElementVNode)("div",s,[r,(0,o.createElementVNode)("div",null,[(0,o.createElementVNode)("i",{class:"bi bi-sliders",onClick:t[0]||(t[0]=e=>h.ShowSettingsDrawer=!0)})])],512),[[o.vShow,a.show_card_title]]),"tabs"==a.display_mode?((0,o.openBlock)(),(0,o.createElementBlock)("div",l,[(0,o.createVNode)(f,{size:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(_,{label:"未完成任務"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(g,{height:a.height,IncompletedTaskList:p.IncompletedTaskListTbData},null,8,["height","IncompletedTaskList"])])),_:1}),(0,o.createVNode)(_,{label:"已結束任務"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(v,{height:a.height,CompletedTaskList:p.CompletedTaskListTbData},null,8,["height","CompletedTaskList"])])),_:1})])),_:1})])):((0,o.openBlock)(),(0,o.createElementBlock)("div",d,[c,(0,o.createVNode)(g,{height:a.height,IncompletedTaskList:p.IncompletedTaskListTbData},null,8,["height","IncompletedTaskList"]),m,(0,o.createVNode)(v,{height:a.height,CompletedTaskList:p.CompletedTaskListTbData},null,8,["height","CompletedTaskList"])])),(0,o.createVNode)(y,{modelValue:h.ShowSettingsDrawer,"onUpdate:modelValue":t[2]||(t[2]=e=>h.ShowSettingsDrawer=e),title:"任務狀態設定"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",u,[(0,o.createVNode)(w,{onChange:p.HandleShowTrafficCkbChg,modelValue:h.Settings.ShowTrafficTask,"onUpdate:modelValue":t[1]||(t[1]=e=>h.Settings.ShowTrafficTask=e),label:"顯示交管任務"},null,8,["onChange","modelValue"])])])),_:1},8,["modelValue"])])}var p=a(36797),g=a.n(p);class _{constructor(e){this.TaskName=e.TaskName,this.State=e.State,this.StateName=e.StateName,this.RecieveTime=e.RecieveTime,this.FinishTime=e.FinishTime,this.DispatcherName=e.DispatcherName,this.DesignatedAGVName=e.DesignatedAGVName,this.ACTIONS={MOVE:0,LOAD:1,UNLOAD:2,CHARGE:3,CARRY:4},this.Action=e.Action,this.From_Station=e.From_Station,this.From_Slot=e.From_Slot,this.To_Station=e.To_Station,this.To_Slot=e.To_Slot,this.Carrier_ID=e.Carrier_ID,this.Priority=e.Priority}get RecieveTime_Formated(){return g()(this.RecieveTime).format("HH:mm:ss")}get FinishTime_Formated(){return g()(this.FinishTime).format("HH:mm:ss")}get ActionName(){switch(this.Action){case 0:return"移動";case 1:return"取貨";case 2:return"取貨/停車";case 3:return"前進";case 4:return"後退";case 6:return"量測";case 7:return"放貨";case 8:return"充電";case 9:return"搬運";case 12:return"停車";case 14:return"交換電池";default:return"Unknown"}}}var v=_,f=a(663),w=a(24239);const y={class:"running-task-table"};function V(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-table-column"),l=(0,o.resolveComponent)("el-tag"),d=(0,o.resolveComponent)("b-button"),c=(0,o.resolveComponent)("el-table");return(0,o.openBlock)(),(0,o.createElementBlock)("div",y,[(0,o.createVNode)(c,{"header-cell-style":{color:"black",backgroundColor:"rgb(241, 241, 241)"},data:a.IncompletedTaskList,"row-key":"TaskName",size:"small","row-class-name":s.row_class_name,"empty-text":"沒有任務",border:"",height:a.height},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{label:"任務名稱",prop:"TaskName",width:"180"}),(0,o.createVNode)(r,{label:"執行AGV",prop:"DesignatedAGVName"}),(0,o.createVNode)(r,{label:"接收時間",prop:"RecieveTime_Formated",width:"80"}),(0,o.createVNode)(r,{label:"任務狀態",prop:"StateName",width:"80"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(l,{effect:"dark",type:s.GetTaskStateType(e.row.State)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.row.StateName),1)])),_:2},1032,["type"])])),_:1}),(0,o.createVNode)(r,{label:"動作",prop:"ActionName",width:"60"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.ActionName),1)])),_:1}),(0,o.createVNode)(r,{label:"卡匣ID",prop:"Carrier_ID",width:"100"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID),1)])),_:1}),(0,o.createVNode)(r,{label:"起點",prop:"From_Station"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(s.GetStationName(e.row.From_Station)),1)])),_:1}),(0,o.createVNode)(r,{label:"終點",prop:"To_Station"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(s.GetStationName(e.row.To_Station)),1)])),_:1}),(0,o.createVNode)(r,{label:"派工人員",prop:"DispatcherName"}),(0,o.withDirectives)((0,o.createVNode)(r,{fixed:"right",width:"100"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",null,[(0,o.createVNode)(d,{size:"sm",variant:"danger",onClick:t=>s.CancelTaskHandler(e.row.TaskName)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取消任務")])),_:2},1032,["onClick"])])])),_:1},512),[[o.vShow,s.taskCancelable]])])),_:1},8,["header-cell-style","data","row-class-name","height"])])}var C=a(8764);function N(e){return 1==e||2==e||3==e||4==e?"success":6==e?"danger":7==e?"warning":"info"}var b=a(95320),k=a(53259),S={props:{IncompletedTaskList:{type:Array,default(){return[]}},height:{type:String,default(){return"260px"}}},data(){return{showCancelTaskConfirm:!1,cancelTaskName:""}},computed:{taskCancelable(){return w.HP.getters.IsLogin},MapPoints(){return Object.values(b.p.getters.MapData.Points)}},methods:{CancelTaskHandler(e){this.cancelTaskName=e;e.includes("HR");this.$swal.fire({title:"確定要取消任務?",text:"任務ID "+e,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.SendCancelTaskRequest()}))},async SendCancelTaskRequest(){try{await C.J8.Cancel(this.cancelTaskName)}catch(e){401==e.response.status&&k.Z.emit("/show-login-view-invoke")}},GetTaskStateType(e){return N(e)},GetStationName(e){var t=this.MapPoints.find((t=>t.TagNumber+""==e));return t?t.Graph.Display:e},row_class_name({row:e,rowIndex:t}){return"TRAFFIC"==e.DispatcherName.toUpperCase()?"traffic-task-row":8==e.Action||14==e.Action?"charge-task-row":""}}},x=a(40089);const E=(0,x.Z)(S,[["render",V]]);var T=E;const D={class:"completed-task-table"};function P(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-table-column"),l=(0,o.resolveComponent)("el-tag"),d=(0,o.resolveComponent)("el-table");return(0,o.openBlock)(),(0,o.createElementBlock)("div",D,[(0,o.createVNode)(d,{"header-cell-style":{color:"black",backgroundColor:"rgb(241, 241, 241)"},data:a.CompletedTaskList,"row-key":"TaskName",size:"small",border:"",height:a.height,"row-class-name":s.row_class_name,"empty-text":"沒有任務"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{label:"任務名稱",prop:"TaskName",width:"180"}),(0,o.createVNode)(r,{label:"執行AGV",prop:"DesignatedAGVName"}),(0,o.createVNode)(r,{label:"接收時間",prop:"RecieveTime_Formated",width:"80"}),(0,o.createVNode)(r,{label:"結束時間",prop:"FinishTime_Formated",width:"80"}),(0,o.createVNode)(r,{label:"任務狀態",prop:"StateName",width:"80"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(l,{effect:"dark",type:s.GetTaskStateType(e.row.State)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.row.StateName),1)])),_:2},1032,["type"])])),_:1}),(0,o.createVNode)(r,{label:"動作",prop:"ActionName",width:"60"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(e.row.ActionName),1)])),_:1}),(0,o.createVNode)(r,{label:"卡匣ID",prop:"Carrier_ID"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID),1)])),_:1}),(0,o.createVNode)(r,{label:"起點"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(s.GetStationName(e.row.From_Station)),1)])),_:1}),(0,o.createVNode)(r,{label:"終點"},{default:(0,o.withCtx)((e=>[(0,o.createTextVNode)((0,o.toDisplayString)(s.GetStationName(e.row.To_Station)),1)])),_:1}),(0,o.createVNode)(r,{label:"派工人員",prop:"DispatcherName"})])),_:1},8,["header-cell-style","data","height","row-class-name"])])}var A={props:{CompletedTaskList:{type:Array,default(){return[]}},height:{type:String,default(){return"260px"}}},computed:{MapPoints(){return Object.values(b.p.getters.MapData.Points)}},methods:{GetTaskStateType(e){return N(e)},GetStationName(e){var t=this.MapPoints.find((t=>t.TagNumber+""==e));return t?t.Graph.Display:e},row_class_name({row:e,rowIndex:t}){return"TRAFFIC"==e.DispatcherName.toUpperCase()?"traffic-task-row":8==e.Action||14==e.Action?"charge-task-row":""}}};const I=(0,x.Z)(A,[["render",P]]);var B=I,L={components:{RunningTaskTable:T,CompletedTaskTable:B},props:{display_mode:{type:String,default:"tabs"},show_card_title:{type:Boolean,default:!0},height:{type:String,defualt:"310px"}},data(){return{IncompletedTaskList:[],CompletedTaskList:[],showCancelTaskConfirm:!1,cancelTaskName:"",ShowSettingsDrawer:!1,Settings:{ShowTrafficTask:!0}}},mounted(){this.WsInit()},computed:{taskCancelable(){return w.HP.getters.IsLogin},IncompletedTaskListTbData(){return this.Settings.ShowTrafficTask?this.IncompletedTaskList:this.IncompletedTaskList.filter((e=>!e.DispatcherName.toUpperCase().includes("TRAFFIC")))},CompletedTaskListTbData(){return this.Settings.ShowTrafficTask?this.CompletedTaskList:this.CompletedTaskList.filter((e=>!e.DispatcherName.toUpperCase().includes("TRAFFIC")))}},methods:{WsInit(){const e=new Worker("websocket_worker.js");e.onmessage=e=>{var t=e.data;this.IncompletedTaskList=t.incompleteds.map((e=>new v(e))),this.CompletedTaskList=t.completeds.map((e=>new v(e)))},e.postMessage({command:"connect",ws_url:f.Z.backend_ws_host+"/ws/TaskData"})},HandleShowTrafficCkbChg(){}}};const M=(0,x.Z)(L,[["render",h],["__scopeId","data-v-1ce47aed"]]);var O=M},83361:function(e,t,a){"use strict";a.d(t,{Z:function(){return E}});a(57658);var o=a(79003);const n=e=>((0,o.pushScopeId)("data-v-ac54b1ae"),e=e(),(0,o.popScopeId)(),e),i={class:"map-point-setting-drawer"},s={class:"header border-bottom"},r={class:"draw-content w-100 px-2"},l={class:"text-start py-2 d-flex"},d={class:"text-start d-flex"},c={class:"settings px-2"},m={class:"d-flex mx-1 bg-light",style:{"flex-wrap":"wrap"}},u=n((()=>(0,o.createElementVNode)("div",{class:"image-slot"}," 錯誤 ",-1))),h={class:"tag"},p=n((()=>(0,o.createElementVNode)("span",null,"ID",-1))),g=n((()=>(0,o.createElementVNode)("span",null,"X",-1))),_=n((()=>(0,o.createElementVNode)("span",null,"Y",-1))),v={class:"d-flex flex-column"},f={class:"text-start"};function w(e,t,a,n,w,y){const V=(0,o.resolveComponent)("b-button"),C=(0,o.resolveComponent)("el-input"),N=(0,o.resolveComponent)("el-form-item"),b=(0,o.resolveComponent)("el-button"),k=(0,o.resolveComponent)("el-image"),S=(0,o.resolveComponent)("el-upload"),x=(0,o.resolveComponent)("el-option"),E=(0,o.resolveComponent)("el-select"),T=(0,o.resolveComponent)("el-input-number"),D=(0,o.resolveComponent)("el-form"),P=(0,o.resolveComponent)("el-collapse-item"),A=(0,o.resolveComponent)("el-checkbox"),I=(0,o.resolveComponent)("el-table-column"),B=(0,o.resolveComponent)("el-table"),L=(0,o.resolveComponent)("RegionsSelector"),M=(0,o.resolveComponent)("el-collapse"),O=(0,o.resolveComponent)("el-drawer");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[(0,o.createVNode)(O,{modelValue:w.show,"onUpdate:modelValue":t[27]||(t[27]=e=>w.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,"show-close":!1,modal:!0,"modal-class":"modal-style","before-close":y.CancelBtnClickHandle},{header:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",s,[(0,o.createElementVNode)("h3",null,"點位設定-"+(0,o.toDisplayString)(w.index),1)])])),default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",r,[(0,o.createElementVNode)("div",l,[(0,o.createVNode)(V,{variant:"danger",onClick:y.CancelBtnClickHandle},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("離開")])),_:1},8,["onClick"]),(0,o.createVNode)(V,{variant:"primary",onClick:y.SaveBtnClickHandle},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("儲存")])),_:1},8,["onClick"]),(0,o.withDirectives)((0,o.createElementVNode)("div",d,[(0,o.createVNode)(V,{size:"sm",variant:"primary",onClick:y.Regist},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("註冊")])),_:1},8,["onClick"]),(0,o.createVNode)(V,{size:"sm",variant:"danger",onClick:y.Unregist},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("解註冊")])),_:1},8,["onClick"])],512),[[o.vShow,!0]])]),(0,o.createElementVNode)("div",c,[(0,o.createVNode)(M,{modelValue:w.activeNames,"onUpdate:modelValue":t[26]||(t[26]=e=>w.activeNames=e)},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(P,{title:"基本設定",name:"1"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(D,{"label-width":"120px","label-position":"left"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(N,{label:"Point Index"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(C,{modelValue:w.index,"onUpdate:modelValue":t[0]||(t[0]=e=>w.index=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(N,{label:"顯示名稱"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",null,[(0,o.createVNode)(C,{modelValue:w.pointData_editing.Graph.Display,"onUpdate:modelValue":t[1]||(t[1]=e=>w.pointData_editing.Graph.Display=e)},null,8,["modelValue"])]),(0,o.createElementVNode)("div",null,[(0,o.withDirectives)((0,o.createVNode)(b,{onClick:t[2]||(t[2]=e=>w.pointData_editing.Graph.Display=w.BindingEQInfo.Name)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("使用繫連的EQ名稱")])),_:1},512),[[o.vShow,y.IsEQPoint]])])])),_:1}),y.IsEQPoint?((0,o.openBlock)(),(0,o.createBlock)(N,{key:0,label:"顯示圖示"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",m,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(y.EqIcons,(e=>((0,o.openBlock)(),(0,o.createElementBlock)("div",{class:"icon-container",style:{width:"64px",height:"84px"},key:e},[(0,o.createVNode)(k,{style:(0,o.normalizeStyle)([{border:e==w.pointData_editing.Graph.ImageName?"3px solid rgb(49, 132, 253)":""},{width:"64px",height:"64px",padding:"3px","border-radius":"8px",cursor:"pointer"}]),src:e,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,fit:"cover",onClick:t=>y.HandleImageClick(e)},{error:(0,o.withCtx)((()=>[u])),_:2},1032,["style","src","onClick"]),(0,o.createVNode)(V,{squared:"",class:"delete-btn",style:{position:"relative",bottom:"26px",width:"100%"},variant:"danger",size:"sm",onClick:t=>y.HandleIconDelete(e)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("刪除")])),_:2},1032,["onClick"])])))),128)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(w.fileList,(e=>((0,o.openBlock)(),(0,o.createBlock)(k,{key:e,style:(0,o.normalizeStyle)([{border:e.url==w.pointData_editing.Graph.ImageName?"3px solid rgb(49, 132, 253)":""},{width:"64px",height:"64px",padding:"3px","border-radius":"8px",cursor:"pointer",border:"1px dashed red"}]),src:e.url,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,fit:"cover",onClick:t=>y.HandleImageClick(e)},null,8,["style","src","onClick"])))),128)),(0,o.createVNode)(S,{"file-list":w.fileList,"onUpdate:fileList":t[3]||(t[3]=e=>w.fileList=e),action:y.icon_upload_url,"list-type":"picture-card","auto-upload":!0,"on-success":y.OnIconUploadSuccess,"show-file-list":!1},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)(" 上傳圖示 ")])),_:1},8,["file-list","action","on-success"])])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(N,{label:"Tag"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",h,[(0,o.createElementVNode)("div",null,[p,(0,o.createVNode)(C,{modelValue:w.pointData_editing.TagNumber,"onUpdate:modelValue":t[4]||(t[4]=e=>w.pointData_editing.TagNumber=e),modelModifiers:{number:!0}},null,8,["modelValue"])]),(0,o.createElementVNode)("div",null,[g,(0,o.createVNode)(C,{modelValue:w.pointData_editing.X,"onUpdate:modelValue":t[5]||(t[5]=e=>w.pointData_editing.X=e)},null,8,["modelValue"])]),(0,o.createElementVNode)("div",null,[_,(0,o.createVNode)(C,{modelValue:w.pointData_editing.Y,"onUpdate:modelValue":t[6]||(t[6]=e=>w.pointData_editing.Y=e)},null,8,["modelValue"])])])])),_:1}),(0,o.createVNode)(N,{label:"站點類型"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(E,{modelValue:w.pointData_editing.StationType,"onUpdate:modelValue":t[7]||(t[7]=e=>w.pointData_editing.StationType=e),onChange:y.StationTypeOnChange},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(y.stationTypes,(e=>((0,o.openBlock)(),(0,o.createBlock)(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),(0,o.withDirectives)((0,o.createElementVNode)("div",null,[(0,o.createVNode)(C,{disabled:"",modelValue:w.BindingEQInfo.Name,"onUpdate:modelValue":t[8]||(t[8]=e=>w.BindingEQInfo.Name=e)},null,8,["modelValue"])],512),[[o.vShow,y.IsEQPoint]])])),_:1}),(0,o.createVNode)(N,{label:"角度"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(T,{modelValue:w.pointData_editing.Direction,"onUpdate:modelValue":t[9]||(t[9]=e=>w.pointData_editing.Direction=e)},null,8,["modelValue"])])),_:1}),0!=w.pointData_editing.StationType?((0,o.openBlock)(),(0,o.createBlock)(N,{key:1,label:"二次定位點角度"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(T,{modelValue:w.pointData_editing.Direction_Secondary_Point,"onUpdate:modelValue":t[10]||(t[10]=e=>w.pointData_editing.Direction_Secondary_Point=e)},null,8,["modelValue"])])),_:1})):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(N,{label:"雷射模式"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(T,{modelValue:w.pointData_editing.LsrMode,"onUpdate:modelValue":t[11]||(t[11]=e=>w.pointData_editing.LsrMode=e),step:1},null,8,["modelValue"]),(0,o.createElementVNode)("i",{class:"bi bi-question-circle information",onClick:t[12]||(t[12]=(...e)=>y.HandleLaserModeInfoIconClick&&y.HandleLaserModeInfoIconClick(...e))})])),_:1}),(0,o.createVNode)(N,{label:"速度"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(T,{modelValue:w.pointData_editing.Speed,"onUpdate:modelValue":t[13]||(t[13]=e=>w.pointData_editing.Speed=e),step:.1,precision:1},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(N,{label:"AGV閃避模式"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(T,{modelValue:w.pointData_editing.DodgeMode,"onUpdate:modelValue":t[14]||(t[14]=e=>w.pointData_editing.DodgeMode=e),step:1},null,8,["modelValue"]),(0,o.createElementVNode)("i",{class:"bi bi-question-circle information",onClick:t[15]||(t[15]=(...e)=>y.HandleDodgeModeInfoIconClick&&y.HandleDodgeModeInfoIconClick(...e))})])),_:1})])),_:1})])),_:1}),(0,o.createVNode)(P,{title:"功能設定",name:"2"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",v,[(0,o.createVNode)(A,{modelValue:w.pointData_editing.Enable,"onUpdate:modelValue":t[16]||(t[16]=e=>w.pointData_editing.Enable=e),label:"啟用"},null,8,["modelValue"]),(0,o.createVNode)(A,{modelValue:w.pointData_editing.IsStandbyPoint,"onUpdate:modelValue":t[17]||(t[17]=e=>w.pointData_editing.IsStandbyPoint=e),label:"停駐點"},null,8,["modelValue"]),(0,o.createVNode)(A,{modelValue:w.pointData_editing.IsSegment,"onUpdate:modelValue":t[18]||(t[18]=e=>w.pointData_editing.IsSegment=e),label:"二次定位點"},null,8,["modelValue"]),(0,o.createVNode)(A,{modelValue:w.pointData_editing.IsParking,"onUpdate:modelValue":t[19]||(t[19]=e=>w.pointData_editing.IsParking=e),label:"可停車點"},null,8,["modelValue"]),(0,o.createVNode)(A,{modelValue:w.pointData_editing.IsAvoid,"onUpdate:modelValue":t[20]||(t[20]=e=>w.pointData_editing.IsAvoid=e),label:"避車點"},null,8,["modelValue"]),(0,o.createVNode)(A,{modelValue:w.pointData_editing.IsVirtualPoint,"onUpdate:modelValue":t[21]||(t[21]=e=>w.pointData_editing.IsVirtualPoint=e),label:"虛擬點"},null,8,["modelValue"]),(0,o.createVNode)(A,{modelValue:w.pointData_editing.IsAutoDoor,"onUpdate:modelValue":t[22]||(t[22]=e=>w.pointData_editing.IsAutoDoor=e),label:"自動門"},null,8,["modelValue"]),(0,o.createVNode)(A,{modelValue:w.pointData_editing.IsExtinguishing,"onUpdate:modelValue":t[23]||(t[23]=e=>w.pointData_editing.IsExtinguishing=e),label:"消防設備"},null,8,["modelValue"])])])),_:1}),(0,o.createVNode)(P,{title:"註冊點",name:"3"},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",f,[(0,o.createVNode)(b,{onClick:t[24]||(t[24]=()=>{w.RegistersTable.push({index:void 0,tag:void 0,name:void 0})})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("新增")])),_:1})]),(0,o.createVNode)(B,{"row-key":"index",height:"320px",border:"",data:w.RegistersTable},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(I,{label:"Index",prop:"index"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",null,[(0,o.createVNode)(E,{onChange:t=>y.HandleIndexSelected(e.row),modelValue:e.row.index,"onUpdate:modelValue":t=>e.row.index=t},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(y.pointsOptions,(e=>((0,o.openBlock)(),(0,o.createBlock)(x,{key:e.index,label:e.index,value:e.index},null,8,["label","value"])))),128))])),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])])])),_:1}),(0,o.createVNode)(I,{label:"Tag",prop:"tag"}),(0,o.createVNode)(I,{label:"Name",prop:"name"}),(0,o.createVNode)(I,{label:"Name"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(b,{onClick:()=>{w.RegistersTable.splice(w.RegistersTable.indexOf(e.row),1)},type:"danger",size:"small"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("移除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),(0,o.createVNode)(P,{title:"分區設定",name:"4"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(D,null,{default:(0,o.withCtx)((()=>[(0,o.createVNode)(N,{label:"所屬區域"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(L,{modelValue:w.pointData_editing.Region,"onUpdate:modelValue":t[25]||(t[25]=e=>w.pointData_editing.Region=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])])])),_:1},8,["modelValue","before-close"])])}var y=a(64491),V=a(83592),C=a(95320),N=a(90633),b=a(26666),k={components:{RegionsSelector:N.Z},data(){return{show:!1,index:-1,pointData:{},pointData_editing:{},RegistersTable:[{index:0,tag:1,name:"1"}],activeNames:["1"],BindingEQInfo:{ConnOptions:{ConnMethod:0,IP:"127.0.0.1",Port:503,ComPort:"COM1"},Name:"LDULD#2",TagID:2},fileList:[]}},mounted(){},computed:{hasAnyChange(){var e=JSON.stringify(this.pointData),t=JSON.stringify(this.pointData_editing);return e!=t},IsEQPoint(){return 1==this.pointData_editing.StationType},stationTypes(){return V.Ml},potinFullName(){return`[${this.index}] ${this.pointData.Name}`},pointsOptions(){return C.p.getters.AllPointsOptions},icon_upload_url(){return"http://localhost:5216/api/map/IconUpload"},EqIcons(){return C.p.getters.EqIcons}},methods:{async Show(e){e.point&&(this.index=e.index,this.pointData=e.point,this.pointData_editing=JSON.parse(JSON.stringify(e.point)),this.InitRegisterTableData(),this.IsEQPoint&&(this.BindingEQInfo=await(0,y.CN)(this.pointData.TagNumber)),this.show=!0)},InitRegisterTableData(){this.RegistersTable=[];var e=this.pointData_editing.RegistsPointIndexs;e&&e.forEach((async e=>{var t=await C.p.dispatch("GetMapPointByIndex",e);t&&this.RegistersTable.push({index:e,tag:t.TagNumber,name:t.Name})}))},ResetRegistPointIndexData(){this.pointData_editing.RegistsPointIndexs=this.RegistersTable.map((e=>e.index))},async StationTypeOnChange(e){1==e&&(this.BindingEQInfo=await(0,y.CN)(this.pointData.TagNumber))},SaveBtnClickHandle(){this.ResetRegistPointIndexData(),this.$emit("OnPointSettingChanged",{index:this.index,pointData:this.pointData_editing}),(0,b.bM)({title:"Success",message:`${this.potinFullName} 站點設定已暫存，請記得儲存圖資`,duration:1e3}),this.pointData=this.pointData_editing},CheckTagRepeat(){if(this.pointData_editing.TagNumber==this.pointData.TagNumber)return!1;var e=this.pointsOptions.filter((e=>e.tag+""==this.pointData_editing.TagNumber+""));return alert(JSON.stringify(e)),1==e.length},CancelBtnClickHandle(){this.hasAnyChange?(this.show=!1,this.$swal.fire({title:"點位尚未儲存",text:`點位-${this.potinFullName} 設定值變更但尚未儲存，確定要離開?`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",customClass:"my-sweetalert"}).then((e=>{this.show=!e.isConfirmed,this.show||this.$emit("OnLeve")}))):(this.show=!1,this.$emit("OnLeve"))},async Regist(){var e=await V.ZP.Regist(this.pointData_editing.TagNumber),t=e.result;this.show=!1,this.$swal.fire({text:"",title:`${this.pointData_editing.TagNumber} ${t?"註冊成功":"註冊失敗"}`,icon:t?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.show=!0}))},async Unregist(){var e=await V.ZP.Unregist(this.pointData_editing.TagNumber),t=e.result;this.show=!1,this.$swal.fire({text:"",title:`${this.pointData_editing.TagNumber} ${t?"解除註冊成功":"解除註冊失敗"}`,icon:t?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.show=!0}))},HandleIndexSelected(e){var t=e.index;C.p.dispatch("GetMapPointByIndex",t).then((t=>{e.tag=t.TagNumber,e.name=t.Name}))},HandleDodgeModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">10:取消任務時Pass站點(用於避免與WIP內AGV旋轉干涉)<br>11:地標輔助修正(用於轉角或長走道起點，AGV會追Tag中心)<br>12:里程計輔助定位(用於窄道)<br>14:里程計輔助定位、偵測色帶(用於窄道、脫離色帶會上報異常)</div>',title:"Dodge Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleLaserModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">0:Bypass<br>1:Normal<br>2:二次定位<br>3:Normal_Short<br>5:Turning<br>7:Loading<br>10:Special<br>12:Narrow(窄道)<br>13:Norrow_Long</div>',title:"Laser Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleImageClick(e){this.pointData_editing.Graph.ImageName=e},HandleUploadIconBtnClick(){},OnIconUploadPreview(e){console.info(e)},OnIconUploadSuccess(e,t,a){console.info(e),this.fileList=[],C.p.dispatch("DownloadMapData")},HandleIconDelete(e){C.p.dispatch("DeleteIcon",e),C.p.dispatch("DownloadMapData")}}},S=a(40089);const x=(0,S.Z)(k,[["render",w],["__scopeId","data-v-ac54b1ae"]]);var E=x},76105:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Ke}});var o=a(79003);const n=e=>((0,o.pushScopeId)("data-v-36f2c068"),e=e(),(0,o.popScopeId)(),e),i={id:"map",class:"map-component"},s={class:"d-flex h-100"},r={class:"flex-fill d-flex flex-column"},l={key:0,class:"w-100 bg-primary text-light rounded p-2 select-mode"},d={key:2,class:"editor-option fixed-top bg-light",style:{"margin-top":"49px","margin-left":"70px"}},c={class:"edit-block action-buttons"},m={class:"d-flex"},u={class:"edit-block"},h=n((()=>(0,o.createElementVNode)("span",null,[(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"}),(0,o.createTextVNode)("模式 ")],-1))),p={class:"edit-block d-flex"},g=n((()=>(0,o.createElementVNode)("span",null,[(0,o.createElementVNode)("i",{class:"bi bi-three-dots-vertical"}),(0,o.createTextVNode)("編輯動作 ")],-1))),_={class:"d-flex flex-column"},v={class:"d-flex flex-column"},f={class:"d-flex flex-row",style:{"overflow-y":"hidden"}},w={key:0,class:"p-0 m-0 w-100"},y={key:1,class:"tab-open"},V=n((()=>(0,o.createElementVNode)("div",{class:"border"},"123",-1))),C={class:"border"},N={class:"d-flex flex-row"},b=["id"],k={key:10,class:"ol-control custom-buttons"},S=n((()=>(0,o.createElementVNode)("i",{class:"bi bi-sliders"},null,-1))),x=[S],E={class:"ol-control cursour-coordination-show"},T={style:{color:"rgb(24, 24, 24)"}},D={key:0,class:"rounded d-flex flex-column"},P=n((()=>(0,o.createElementVNode)("span",{class:"border-bottom"},"顯示名稱",-1))),A=n((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"地圖模式",-1))),I={key:1},B=n((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"AGV 顯示",-1))),L=n((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"地圖背景",-1))),M=n((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"路網顯示",-1))),O=n((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"管制區顯示",-1))),G={key:2,class:"rounded"},R=n((()=>(0,o.createElementVNode)("span",{class:"mx-1"},"AGV上報點位模式",-1))),H={class:"bg-light text-start d-flex py-2"};function F(e,t,a,n,S,F){const U=(0,o.resolveComponent)("el-alert"),Z=(0,o.resolveComponent)("b-button"),$=(0,o.resolveComponent)("el-radio-button"),q=(0,o.resolveComponent)("el-radio-group"),z=(0,o.resolveComponent)("b-tab"),Q=(0,o.resolveComponent)("el-table-column"),j=(0,o.resolveComponent)("el-table"),Y=(0,o.resolveComponent)("b-tabs"),K=(0,o.resolveComponent)("MapSettingsDialog"),W=(0,o.resolveComponent)("el-radio"),J=(0,o.resolveComponent)("el-switch"),X=(0,o.resolveComponent)("el-tooltip"),ee=(0,o.resolveComponent)("PointContextMenu"),te=(0,o.resolveComponent)("MapPointSettingDrawer"),ae=(0,o.resolveComponent)("MapPathSettingDrawer"),oe=(0,o.resolveComponent)("MapRegionEditDrawer"),ne=(0,o.resolveComponent)("el-tag"),ie=(0,o.resolveComponent)("el-dialog");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,["Unkown"==S.map_name?((0,o.openBlock)(),(0,o.createBlock)(U,{key:0,title:"載入中",type:"warning",effect:"dark"})):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",s,[(0,o.createElementVNode)("div",r,[S.IsSelectAGVMode?((0,o.openBlock)(),(0,o.createElementBlock)("div",l,"選擇 AGV")):(0,o.createCommentVNode)("",!0),S.IsSelectEQStationMode?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:1,class:(0,o.normalizeClass)(["w-100 text-light rounded p-2 select-mode","charge"==S.TaskDispatchOptions.action_type?"bg-warning":"bg-primary"])},(0,o.toDisplayString)("charge"==S.TaskDispatchOptions.action_type?"選擇[充電站]":""+("source"==S.TaskDispatchOptions.direction?"選擇[來源]設備":"選擇[終點]設備")),3)):(0,o.createCommentVNode)("",!0),a.editable?((0,o.openBlock)(),(0,o.createElementBlock)("div",d,[(0,o.createElementVNode)("div",c,[(0,o.createVNode)(Z,{variant:"primary",onClick:F.HandlerSaveBtnClick},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("儲存")])),_:1},8,["onClick"]),(0,o.createVNode)(Z,{variant:"danger",onClick:F.ReloadMap},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("重新載入")])),_:1},8,["onClick"]),(0,o.createVNode)(Z,{variant:"danger",onClick:F.ClearMap},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("清除資料")])),_:1},8,["onClick"])]),(0,o.createElementVNode)("div",m,[(0,o.createElementVNode)("div",u,[h,(0,o.createVNode)(q,{style:(0,o.normalizeStyle)(F.radio_group_style),modelValue:S.EditorOption.EditMode,"onUpdate:modelValue":t[0]||(t[0]=e=>S.EditorOption.EditMode=e),onChange:t[1]||(t[1]=e=>{F.RestoreOriginalPathStyle(this.selected_path_feature)}),size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{size:"small",label:"view"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("檢視[V]")])),_:1}),(0,o.createVNode)($,{size:"small",label:"edit"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("編輯[E]")])),_:1})])),_:1},8,["style","modelValue"])]),(0,o.createElementVNode)("div",p,[g,(0,o.createVNode)(q,{style:(0,o.normalizeStyle)(F.radio_group_style),disabled:"edit"!=S.EditorOption.EditMode,modelValue:S.EditorOption.EditAction,"onUpdate:modelValue":t[2]||(t[2]=e=>S.EditorOption.EditAction=e),onChange:t[3]||(t[3]=()=>{F.RemoveInteraction(S.draw_forbid_regions_interaction),F.AddEditMapInteraction()}),size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{size:"small",label:"none"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("無")])),_:1}),(0,o.createVNode)($,{size:"small",label:"add-station"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("新增點位[1]")])),_:1}),(0,o.createVNode)($,{size:"small",label:"edit-station"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("編輯點位[2]")])),_:1}),(0,o.createVNode)($,{size:"small",label:"remove-station"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("移除點位[3]")])),_:1})])),_:1},8,["style","disabled","modelValue"]),(0,o.createElementVNode)("div",_,[(0,o.createVNode)(q,{class:"mx-1",disabled:"edit"!=S.EditorOption.EditMode,modelValue:S.EditorOption.EditAction,"onUpdate:modelValue":t[4]||(t[4]=e=>S.EditorOption.EditAction=e),onChange:t[5]||(t[5]=()=>{S.PathEditTempStore=[],F.RemoveInteraction(S.draw_forbid_regions_interaction),F.AddEditMapInteraction()}),size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{size:"small",label:"add-path"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("新增路徑[4]")])),_:1}),(0,o.createVNode)($,{size:"small",label:"edit-path"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("編輯路徑[5]")])),_:1}),(0,o.createVNode)($,{size:"small",label:"remove-path"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("移除路徑[6]")])),_:1})])),_:1},8,["disabled","modelValue"]),(0,o.withDirectives)((0,o.createVNode)(q,{class:"mx-1 my-1",modelValue:S.EditorOption.AddPathMode.Direction,"onUpdate:modelValue":t[6]||(t[6]=e=>S.EditorOption.AddPathMode.Direction=e),onChange:t[7]||(t[7]=()=>{F.RemoveInteraction(S.draw_forbid_regions_interaction)}),size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{size:"small",label:"one-direction"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("單向")])),_:1}),(0,o.createVNode)($,{size:"small",label:"bi-direction"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("雙向")])),_:1})])),_:1},8,["modelValue"]),[[o.vShow,"add-path"==S.EditorOption.EditAction]])]),(0,o.createElementVNode)("div",v,[(0,o.createVNode)(q,{class:"mx-1",disabled:"edit"!=S.EditorOption.EditMode,modelValue:S.EditorOption.EditAction,"onUpdate:modelValue":t[9]||(t[9]=e=>S.EditorOption.EditAction=e),size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{onClick:t[8]||(t[8]=e=>F.HandleAddForbidRegionClicked(S.EditorOption.AddRegionMode.Mode)),size:"small",label:"add-forbid-region"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("新增管制區[7]")])),_:1}),(0,o.createVNode)($,{onClick:F.HandleEditForbidRegionClicked,size:"small",label:"edit-forbid-region"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("編輯管制區[8]")])),_:1},8,["onClick"]),(0,o.createVNode)($,{onClick:F.HandleDeleteForbidRegionClicked,size:"small",label:"remove-forbid-region"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("移除管制區[9]")])),_:1},8,["onClick"])])),_:1},8,["disabled","modelValue"]),(0,o.withDirectives)((0,o.createVNode)(q,{class:"mx-1 my-1",modelValue:S.EditorOption.AddRegionMode.Mode,"onUpdate:modelValue":t[12]||(t[12]=e=>S.EditorOption.AddRegionMode.Mode=e),size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)($,{onClick:t[10]||(t[10]=e=>F.HandleAddForbidRegionClicked("forbid")),size:"small",label:"forbid"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("禁制區")])),_:1}),(0,o.createVNode)($,{onClick:t[11]||(t[11]=e=>F.HandleAddForbidRegionClicked("passible")),size:"small",label:"passible"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("通行區")])),_:1})])),_:1},8,["modelValue"]),[[o.vShow,"add-forbid-region"==S.EditorOption.EditAction]])])])])])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",f,["edit"==S.EditorOption.EditMode&&a.editable?((0,o.openBlock)(),(0,o.createElementBlock)("div",{key:0,class:(0,o.normalizeClass)([S.left_tab_class_name,"border bg-light"]),style:(0,o.normalizeStyle)(F.path_view_style)},["tab-close"==S.left_tab_class_name?((0,o.openBlock)(),(0,o.createElementBlock)("div",w,[(0,o.createElementVNode)("i",{onClick:t[13]||(t[13]=()=>{S.left_tab_class_name="tab-open"==S.left_tab_class_name?"tab-close":"tab-open"}),class:"bi bi-chevron-double-right"})])):((0,o.openBlock)(),(0,o.createElementBlock)("div",y,[(0,o.createElementVNode)("i",{onClick:t[14]||(t[14]=()=>{S.left_tab_class_name="tab-open"==S.left_tab_class_name?"tab-close":"tab-open"}),class:"bi bi-chevron-double-left"}),(0,o.createVNode)(Y,{class:"p-1"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(z,{title:"點位"},{default:(0,o.withCtx)((()=>[V])),_:1}),(0,o.createVNode)(z,{title:"路徑",active:""},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",C,[(0,o.createVNode)(j,{data:S.PathesSegmentsForEdit,"highlight-current-row":"","row-key":"StartPtIndex",onRowClick:F.HandlePathTbRowClick,border:"",style:{height:"650px"},size:"small"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(Q,{label:"起點",prop:"StartPtIndex",width:"120"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(F.GetPointName(e.row.StartPtIndex)),1)])),_:1}),(0,o.createVNode)(Q,{label:"終點",prop:"EndPtIndex",width:"120"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("b",null,(0,o.toDisplayString)(F.GetPointName(e.row.EndPtIndex)),1)])),_:1}),(0,o.createVNode)(Q,{label:"操作"},{default:(0,o.withCtx)((e=>[(0,o.createElementVNode)("div",N,[(0,o.createVNode)(Z,{size:"sm",variant:"primary"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("編輯")])),_:1}),(0,o.createVNode)(Z,{class:"mx-1",size:"sm",variant:"danger",onClick:t=>F.HandlePathRemoveBtnClick(e.row)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("移除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data","onRowClick"])])])),_:1})])),_:1})]))],6)):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",{id:a.id,style:(0,o.normalizeStyle)({height:a.canva_height,marginTop:a.editable?F.marginTop:"0px"}),class:"agv_map flex-fll",onContextmenu:t[17]||(t[17]=e=>F.showContextMenu(e))},[a.editable&&"add-station"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:0,class:"notify-text",title:"使用滑鼠[右鍵]點擊地圖新增點位",type:"success"})):(0,o.createCommentVNode)("",!0),a.editable&&"edit-station"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:1,class:"notify-text",title:"使用滑鼠[右鍵]選擇欲編輯之點位",type:"success"})):(0,o.createCommentVNode)("",!0),a.editable&&"remove-station"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:2,class:"notify-text",title:"使用滑鼠[左鍵]選擇欲刪除之點位",type:"error"})):(0,o.createCommentVNode)("",!0),a.editable&&"add-path"==S.EditorOption.EditAction&&"one-direction"==S.EditorOption.AddPathMode.Direction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:3,class:"notify-text",title:"使用滑鼠[左鍵]點擊地圖上任意兩個點位以新增一條單行道",type:"success"})):(0,o.createCommentVNode)("",!0),a.editable&&"add-path"==S.EditorOption.EditAction&&"bi-direction"==S.EditorOption.AddPathMode.Direction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:4,class:"notify-text",title:"使用滑鼠[左鍵]點擊地圖上任意兩個點位以新增一條雙向道",type:"success"})):(0,o.createCommentVNode)("",!0),a.editable&&"edit-path"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:5,class:"notify-text",title:"使用滑鼠[右鍵]選擇欲編輯之路徑",type:"success"})):(0,o.createCommentVNode)("",!0),a.editable&&"remove-path"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:6,class:"notify-text",title:"使用滑鼠[左鍵]選擇欲刪除之路徑",type:"error"})):(0,o.createCommentVNode)("",!0),a.editable&&"add-forbid-region"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:7,class:"notify-text",title:`使用滑鼠[左鍵/右鍵]在地圖上繪製[${"forbid"==S.EditorOption.AddRegionMode.Mode?"禁制":"通行"}]區(按下[ESC]可取消繪製)`,type:"success"},null,8,["title"])):(0,o.createCommentVNode)("",!0),a.editable&&"edit-forbid-region"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:8,class:"notify-text",title:"使用滑鼠[左鍵]在地圖上選取欲編輯之管制區)",type:"success"})):(0,o.createCommentVNode)("",!0),a.editable&&"remove-forbid-region"==S.EditorOption.EditAction?((0,o.openBlock)(),(0,o.createBlock)(U,{key:9,class:"notify-text",title:"使用滑鼠[左鍵]在地圖上點擊欲刪除之管制區",type:"error"})):(0,o.createCommentVNode)("",!0),((0,o.openBlock)(),(0,o.createElementBlock)("div",k,[(0,o.createElementVNode)("button",{onClick:t[15]||(t[15]=(...e)=>F.HandleSettingBtnClick&&F.HandleSettingBtnClick(...e))},x),(0,o.createElementVNode)("button",{onClick:t[16]||(t[16]=(...e)=>F.HandleSettingBtnClick&&F.HandleSettingBtnClick(...e))},"?")])),(0,o.createElementVNode)("div",E,[(0,o.createElementVNode)("span",T,(0,o.toDisplayString)(F.MouseCoordinationDisplay),1)])],44,b)]),(0,o.createVNode)(K,{ref:"settings"},null,512)]),(0,o.createElementVNode)("div",{class:"options bg-light border-start text-start px-1 py-3",style:(0,o.normalizeStyle)({marginTop:a.editable?F.marginTop:"0px"})},[a.station_show?((0,o.openBlock)(),(0,o.createElementBlock)("div",D,[P,(0,o.createVNode)(q,{modelValue:S.station_name_display_mode,"onUpdate:modelValue":t[18]||(t[18]=e=>S.station_name_display_mode=e),onChange:F.StationNameDisplayOptHandler},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(W,{label:"index",size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Index")])),_:1}),(0,o.createVNode)(W,{label:"name",size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Name")])),_:1}),(0,o.createVNode)(W,{label:"tag",size:"large"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("Tag")])),_:1})])),_:1},8,["modelValue","onChange"])])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",null,[A,(0,o.createVNode)(J,{onChange:F.MapDisplayModeOptHandler,"inactive-value":"router","active-value":"coordination",width:"70",modelValue:S.map_display_mode,"onUpdate:modelValue":t[19]||(t[19]=e=>S.map_display_mode=e),"inline-prompt":"","inactive-text":"路網","active-text":"Slam","inactive-color":"seagreen"},null,8,["onChange","modelValue"])]),a.agv_show?((0,o.openBlock)(),(0,o.createElementBlock)("div",I,[B,(0,o.createVNode)(J,{onChange:F.AgvDisplayOptHandler,"inactive-value":"none","active-value":"visible",width:"70",modelValue:S.agv_display,"onUpdate:modelValue":t[20]||(t[20]=e=>S.agv_display=e),"inline-prompt":"","inactive-text":"隱藏","active-text":"顯示","inactive-color":"rgb(146, 148, 153)"},null,8,["onChange","modelValue"])])):(0,o.createCommentVNode)("",!0),(0,o.createElementVNode)("div",null,[L,(0,o.createVNode)(J,{modelValue:S.map_image_display,"onUpdate:modelValue":t[21]||(t[21]=e=>S.map_image_display=e),"inactive-value":"none","inactive-text":"隱藏","active-value":"visible","active-text":"顯示","inactive-color":"rgb(146, 148, 153)","inline-prompt":"",width:"70",onChange:F.SlamImageDisplayOptHandler},null,8,["modelValue","onChange"])]),(0,o.createElementVNode)("div",null,[M,(0,o.createVNode)(J,{modelValue:S.routePathsVisible,"onUpdate:modelValue":t[22]||(t[22]=e=>S.routePathsVisible=e),"inactive-text":"隱藏","active-text":"顯示","inline-prompt":"","inactive-color":"rgb(146, 148, 153)",width:"70",onChange:t[23]||(t[23]=e=>{e?"router"==S.map_display_mode?(S.PathLayerForCoordination.setVisible(!1),S.PathLayerForRouter.setVisible(!0)):(S.PathLayerForCoordination.setVisible(!0),S.PathLayerForRouter.setVisible(!1)):(S.PathLayerForCoordination.setVisible(!1),S.PathLayerForRouter.setVisible(!1)),F.HideNormalStations(!e)})},null,8,["modelValue"])]),(0,o.createElementVNode)("div",null,[O,(0,o.createVNode)(J,{disabled:"coordination"!=S.map_display_mode,modelValue:S.regionsVisible,"onUpdate:modelValue":t[24]||(t[24]=e=>S.regionsVisible=e),"inactive-text":"隱藏","active-text":"顯示","inline-prompt":"","inactive-color":"rgb(146, 148, 153)",width:"70",onChange:t[25]||(t[25]=e=>{S.RegionLayer.setVisible(e&&"coordination"==S.map_display_mode)})},null,8,["disabled","modelValue"])]),a.editable?((0,o.openBlock)(),(0,o.createElementBlock)("div",G,[(0,o.createVNode)(X,{content:"開啟後於車載畫面上傳座標資訊後將會自動新增點位至地圖上"},{default:(0,o.withCtx)((()=>[R])),_:1}),(0,o.createVNode)(J,{class:"my-2","inactive-text":"OFF","active-text":"ON","inline-prompt":"",width:"70",modelValue:S.agv_upload_coordination_mode,"onUpdate:modelValue":t[26]||(t[26]=e=>S.agv_upload_coordination_mode=e),onChange:F.HandleAGVUploadCorrdinationChanged},null,8,["modelValue","onChange"])])):(0,o.createCommentVNode)("",!0)],4)]),(0,o.withDirectives)((0,o.createVNode)(ee,{ref:"EditModeContextMenu",mouse_click_position:[S.contextMenuTop,S.contextMenuLeft],options:S.contextMenuOptions,onOnTaskBtnClick:F.HandleMenuTaskBtnClick,onOnPtSettingBtnClick:F.HandlePtSettingBtnClick},null,8,["mouse_click_position","options","onOnTaskBtnClick","onOnPtSettingBtnClick"]),[[o.vShow,S.editModeContextMenuVisible]]),(0,o.createVNode)(te,{ref:"ptsetting",onOnLeve:F.HandlePtSettingDrawerLeaved,onOnPointSettingChanged:F.PointSettingChangedHandle},null,8,["onOnLeve","onOnPointSettingChanged"]),(0,o.createVNode)(ae,{SettingsChangedHandler:()=>{F.UpdateStationPathLayer(),F.HandlePathTbRowClick(S.SelectedPathData)},onClosed:F.HandlePathSetingDrawerClosed,ref:"path_editor"},null,8,["SettingsChangedHandler","onClosed"]),(0,o.createVNode)(oe,{onClosed:F.HandleForbidRegionEditDrawerClosed,ref:"forbid_region_editor",SettingsChangedHandler:()=>{}},null,8,["onClosed"]),(0,o.createVNode)(ie,{onClosed:t[29]||(t[29]=()=>{S.selected_path_feature&&F.RestoreOriginalPathStyle(S.selected_path_feature)}),draggable:"",width:"600",title:"路徑選取",modelValue:S.ShowPathSelectDialog,"onUpdate:modelValue":t[30]||(t[30]=e=>S.ShowPathSelectDialog=e)},{default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",H,[(0,o.createVNode)(Z,{size:"sm",variant:"success",onClick:t[27]||(t[27]=()=>{S.PathesCandicats.forEach((e=>{e.IsPassable=!0})),F.UpdateStationPathLayer(),F.HandlePathTbRowClick(S.SelectedPathData)})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("開放所有道路")])),_:1}),(0,o.createVNode)(Z,{class:"mx-2",variant:"danger",size:"sm",onClick:t[28]||(t[28]=()=>{S.PathesCandicats.forEach((e=>{e.IsPassable=!1})),F.UpdateStationPathLayer(),F.HandlePathTbRowClick(S.SelectedPathData)})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("關閉所有道路")])),_:1})]),(0,o.createVNode)(j,{data:S.PathesCandicats,border:""},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(Q,{label:"ID",prop:"PathID"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(ne,{effect:"dark"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.row.PathID),1)])),_:2},1024)])),_:1}),(0,o.createVNode)(Q,{label:"起點Index",prop:"StartPtIndex"}),(0,o.createVNode)(Q,{label:"終點Index",prop:"EndPtIndex"}),(0,o.createVNode)(Q,{label:"狀態",prop:"IsPassable"},{default:(0,o.withCtx)((e=>[(0,o.createVNode)(ne,{effect:"dark",type:e.row.IsPassable?"success":"danger"},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.row.IsPassable?"開放":"封閉"),1)])),_:2},1032,["type"])])),_:1}),(0,o.createVNode)(Q,null,{default:(0,o.withCtx)((e=>[(0,o.createVNode)(Z,{variant:"primary",onClick:t=>F.HandlePathSelected(e.row)},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("選取")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])}a(57658);var U=a(1508),Z=a(19716),$=a(92949),q=a(93292),z=a(66615),Q=a(321),j=a(58329),Y=a(88818),K=a(39281),W=a(50563),J=a(5689),X=a(98843),ee=a(53259),te=a(79072),ae=a(95320),oe=a(24239),ne=a(22205),ie=a(19966),se=a(7712),re=a(17983),le=a(96241);const de=(0,o.createElementVNode)("div",null," ??? ",-1);function ce(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-dialog");return(0,o.openBlock)(),(0,o.createBlock)(r,{draggable:"",modal:!1,title:"地圖設置",modelValue:i.show,"onUpdate:modelValue":t[0]||(t[0]=e=>i.show=e)},{default:(0,o.withCtx)((()=>[de])),_:1},8,["modelValue"])}var me={data(){return{show:!1}}},ue=a(40089);const he=(0,ue.Z)(me,[["render",ce]]);var pe=he;const ge={key:0,class:"menu task"},_e={key:0},ve={key:1,class:"d-flex flex-column"},fe={key:2},we={key:3},ye={key:1,class:"menu edit"};function Ve(e,t,a,n,i,s){const r=(0,o.resolveComponent)("b-button");return(0,o.openBlock)(),(0,o.createElementBlock)("div",{class:"map-menu border",style:(0,o.normalizeStyle)(s.menu_style)},[(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["title border-bottom",s.station_data.Enable?"text-primary":"text-danger"])},(0,o.toDisplayString)(a.options.title+(s.station_data.Enable?"":"(已禁用)")),3),a.options.show_task_dispatch?((0,o.openBlock)(),(0,o.createElementBlock)("div",ge,[(0,o.createElementVNode)("span",null,"站點類型 : "+(0,o.toDisplayString)(s.station_data.IsVirtualPoint?"虛擬點":a.options.task_options.StationType),1),0!=s.station_type||s.station_data.IsVirtualPoint?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)("div",_e,[(0,o.createVNode)(r,{variant:"primary",onClick:t[0]||(t[0]=()=>{e.$emit("OnTaskBtnClick",{action:"move",station_data:s.station_data})})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("移動")])),_:1})])),1==s.station_type|2==s.station_type?((0,o.openBlock)(),(0,o.createElementBlock)("div",ve,[(0,o.createVNode)(r,{variant:"primary",onClick:t[1]||(t[1]=()=>{e.$emit("OnTaskBtnClick",{action:"unload",station_data:s.station_data})})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("取貨")])),_:1}),(0,o.createVNode)(r,{variant:"primary",onClick:t[2]||(t[2]=()=>{e.$emit("OnTaskBtnClick",{action:"load",station_data:s.station_data})})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("放貨")])),_:1}),(0,o.createVNode)(r,{variant:"primary",onClick:t[3]||(t[3]=()=>{e.$emit("OnTaskBtnClick",{action:"carry",station_data:s.station_data})})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("搬運")])),_:1})])):(0,o.createCommentVNode)("",!0),3==s.station_type?((0,o.openBlock)(),(0,o.createElementBlock)("div",fe,[(0,o.createVNode)(r,{variant:"primary",onClick:t[4]||(t[4]=()=>{e.$emit("OnTaskBtnClick",{action:"charge",station_data:s.station_data})})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("充電")])),_:1})])):(0,o.createCommentVNode)("",!0),s.station_data.IsParking&&!s.station_data.IsVirtualPoint?((0,o.openBlock)(),(0,o.createElementBlock)("div",we,[(0,o.createVNode)(r,{variant:"primary",onClick:t[5]||(t[5]=()=>{e.$emit("OnTaskBtnClick",{action:"park",station_data:s.station_data})})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("停車")])),_:1})])):(0,o.createCommentVNode)("",!0)])):((0,o.openBlock)(),(0,o.createElementBlock)("div",ye,[(0,o.createVNode)(r,{variant:"primary",onClick:t[6]||(t[6]=()=>{e.$emit("OnPtSettingBtnClick","")})},{default:(0,o.withCtx)((()=>[(0,o.createTextVNode)("設定點位")])),_:1})]))],4)}var Ce={components:{},props:{mouse_click_position:{type:Array,default(){return[0,0]}},options:{type:te.xK,default(){return new te.xK}}},computed:{menu_style(){return{top:this.mouse_click_position[0]+"px",left:this.mouse_click_position[1]+"px",backgroundColor:this.options.backgroundColor}},station_type(){return this.options.task_options.StationType},station_data(){return this.options.point_data}},data(){return{}}};const Ne=(0,ue.Z)(Ce,[["render",Ve],["__scopeId","data-v-16c3ee72"]]);var be=Ne,ke=a(83361);const Se={class:"map-path-editor"},xe={class:"header border-bottom"},Ee={class:"draw-content"};function Te(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-input"),l=(0,o.resolveComponent)("el-form-item"),d=(0,o.resolveComponent)("el-checkbox"),c=(0,o.resolveComponent)("el-input-number"),m=(0,o.resolveComponent)("el-form"),u=(0,o.resolveComponent)("el-drawer");return(0,o.openBlock)(),(0,o.createElementBlock)("div",Se,[(0,o.createVNode)(u,{modelValue:i.show,"onUpdate:modelValue":t[11]||(t[11]=e=>i.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,onClosed:t[12]||(t[12]=t=>e.$emit("closed",i.PathDataEdit)),"show-close":!1,modal:!0,"modal-class":"modal-style"},{header:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",xe,[(0,o.createElementVNode)("h3",null,"路徑設定:"+(0,o.toDisplayString)(i.PathDataEdit.StartPtIndex)+"->"+(0,o.toDisplayString)(i.PathDataEdit.EndPtIndex),1)])])),default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",Ee,[(0,o.createVNode)(m,{"label-width":"140","label-position":"left"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{label:"Path ID"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{disabled:"",modelValue:i.PathDataEdit.PathID,"onUpdate:modelValue":t[0]||(t[0]=e=>i.PathDataEdit.PathID=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"起點(Index)"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{disabled:"",modelValue:i.PathDataEdit.StartPtIndex,"onUpdate:modelValue":t[1]||(t[1]=e=>i.PathDataEdit.StartPtIndex=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"終點(Index)"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{disabled:"",modelValue:i.PathDataEdit.EndPtIndex,"onUpdate:modelValue":t[2]||(t[2]=e=>i.PathDataEdit.EndPtIndex=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"工位路徑"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{disabled:"",modelValue:i.PathDataEdit.IsEQLink,"onUpdate:modelValue":t[3]||(t[3]=e=>i.PathDataEdit.IsEQLink=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"道路開放"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{onChange:a.SettingsChangedHandler,modelValue:i.PathDataEdit.IsPassable,"onUpdate:modelValue":t[4]||(t[4]=e=>i.PathDataEdit.IsPassable=e)},null,8,["onChange","modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"僅允許一台車通行"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{modelValue:i.PathDataEdit.IsSingleCar,"onUpdate:modelValue":t[5]||(t[5]=e=>i.PathDataEdit.IsSingleCar=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"是否可旋轉"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{modelValue:i.PathDataEdit.IsRotationable,"onUpdate:modelValue":t[6]||(t[6]=e=>i.PathDataEdit.IsRotationable=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"消防通道"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{modelValue:i.PathDataEdit.IsExtinguishingPath,"onUpdate:modelValue":t[7]||(t[7]=e=>i.PathDataEdit.IsExtinguishingPath=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"雷射模式"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{modelValue:i.PathDataEdit.LsrMode,"onUpdate:modelValue":t[8]||(t[8]=e=>i.PathDataEdit.LsrMode=e),step:1},null,8,["modelValue"]),(0,o.createElementVNode)("i",{class:"bi bi-question-circle information",onClick:t[9]||(t[9]=(...t)=>e.HandleLaserModeInfoIconClick&&e.HandleLaserModeInfoIconClick(...t))})])),_:1}),(0,o.createVNode)(l,{label:"限速"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{modelValue:i.PathDataEdit.Speed,"onUpdate:modelValue":t[10]||(t[10]=e=>i.PathDataEdit.Speed=e),step:.1,precision:1},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}var De={data(){return{show:!1,PathDataEdit:{StartPtIndex:5,EndPtIndex:0,StartCoordination:[2.653,6.213],EndCoordination:[.531,6.217],PathID:"5_0",IsEQLink:!1,IsSingleCar:!1,IsRotationable:!1,IsPassable:!1,IsExtinguishingPath:!1,Speed:1,LsrMode:0,DodgeMode:0,SpinMode:0}}},props:{SettingsChangedHandler:{type:Function,default(){return()=>{}}}},methods:{Show(e){e&&(this.PathDataEdit=e,this.show=!0)}}};const Pe=(0,ue.Z)(De,[["render",Te]]);var Ae=Pe;const Ie={class:"forbid-region-edit-drawer"},Be={class:"header border-bottom"},Le={class:"draw-content"};function Me(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-input"),l=(0,o.resolveComponent)("el-form-item"),d=(0,o.resolveComponent)("el-option"),c=(0,o.resolveComponent)("el-select"),m=(0,o.resolveComponent)("el-form"),u=(0,o.resolveComponent)("el-drawer");return(0,o.openBlock)(),(0,o.createElementBlock)("div",Ie,[(0,o.createVNode)(u,{modelValue:i.show,"onUpdate:modelValue":t[2]||(t[2]=e=>i.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,onClosed:t[3]||(t[3]=t=>e.$emit("closed",e.PathDataEdit)),"show-close":!1,modal:!0,"modal-class":"modal-style"},{header:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",Be,[(0,o.createElementVNode)("h3",null,"區域設置:"+(0,o.toDisplayString)(i.region_name),1)])])),default:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",Le,[(0,o.createVNode)(m,{"label-width":"140","label-position":"left"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{label:"名稱"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{modelValue:i.RegionData.Name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.RegionData.Name=e)},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(l,{label:"類型"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(c,{modelValue:i.RegionData.RegionType,"onUpdate:modelValue":t[1]||(t[1]=e=>i.RegionData.RegionType=e)},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(d,{value:0,label:"禁制區"}),(0,o.createVNode)(d,{value:1,label:"通行區"})])),_:1},8,["modelValue"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}var Oe={data(){return{show:!1,region_name:"",RegionData:new te.S9("",[])}},props:{SettingsChangedHandler:{type:Function,default(){return()=>{}}}},methods:{Show(e){this.region_name=e,setTimeout((async()=>{this.RegionData=JSON.parse(JSON.stringify(await ae.p.dispatch("GetRegionByName",e))),this.show=!0}),10)}}};const Ge=(0,ue.Z)(Oe,[["render",Me]]);var Re=Ge;const He={class:"map-quickly-action"},Fe=["textContent"];function Ue(e,t,a,n,i,s){return(0,o.openBlock)(),(0,o.createElementBlock)("div",He,[(0,o.createElementVNode)("span",{textContent:(0,o.toDisplayString)(s.mapname)},null,8,Fe)])}var Ze={computed:{mapname(){return ae.p.getters.MapName}}};const $e=(0,ue.Z)(Ze,[["render",Ue],["__scopeId","data-v-3192d018"]]);var qe=$e,ze=a(43770),Qe=a(26666),je={components:{QuicklyAction:qe,MapSettingsDialog:pe,PointContextMenu:be,MapPointSettingDrawer:ke.Z,MapPathSettingDrawer:Ae,MapRegionEditDrawer:Re},props:{editable:{type:Boolean,default:!1},agv_show:{type:Boolean,default:!0},station_show:{type:Boolean,default:!0},eq_lduld_status_show:{type:Boolean,default:!1},agv_upload_coordi_data:{type:Object,default(){return{}}},task_dispatch_menu_show:{type:Boolean,default:!1},id:{type:String,default(){return"map"}},canva_height:{type:String,default:"670px"}},data(){return{map:new Z.Z,map_name:"Unkown",zoom:2,zoom_route:2,center:[0,0],center_route:[0,0],loading:!1,ShowPathSelectDialog:!1,IsPathEditing:!1,SelectedPathData:{},PathesCandicats:[],_map_stations:[],ImageLayer:new J.Z,PointLayer:new X.Z({source:new q.Z({features:[]}),zIndex:2}),PointRouteLayer:new X.Z({source:new q.Z({features:[]}),zIndex:2}),EQLDULDStatusLayer:new X.Z({source:new q.Z({features:[]}),zIndex:2}),PathLayerForCoordination:new X.Z({source:new q.Z({features:[]}),zIndex:0}),PathLayerForRouter:new X.Z({source:new q.Z({features:[]}),zIndex:0}),AGVLocLayer:new X.Z({source:new q.Z({features:[]}),zIndex:4}),AGVLocusLayer:new X.Z({source:new q.Z({features:[]}),zIndex:3}),CustomLayer:new X.Z({source:new q.Z({features:[]})}),TransferTaskIconLayer:new X.Z({source:new q.Z({features:[]}),zIndex:22}),RegionLayer:new X.Z({source:new q.Z({features:[]}),zIndex:22}),AGVFeatures:{},MouseCoordination:void 0,FeatureKeys:{Station:"station",path:"path",nav_path:"nav_path",agv:"agv"},IsDragging:!1,IsAddPathMode:!0,PathEditTempStore:[],EditorOption:{EditMode:"edit",EditAction:"none",AddPathMode:{Direction:"one-direction"},AddRegionMode:{Mode:"forbid"}},map_display_mode:"router",station_name_display_mode:"name",agv_display:"visible",map_image_display:"visible",left_tab_class_name:"tab-close",previousSelectedFeatures:[],agv_upload_coordination_mode:!1,editModeContextMenuVisible:!1,taskDispatchContextMenuVisible:!1,routePathsVisible:!0,regionsVisible:!0,contextMenuTop:0,contextMenuLeft:0,contextMenuOptions:new te.xK,firstUseFlag:!0,selected_path_feature:void 0,path_highlight_style:new ne.ZP({stroke:new ie.Z({color:"blue",width:8})}),PathesSegmentsForEdit:[],IsSelectAGVMode:!1,IsSelectEQStationMode:!1,TaskDispatchOptions:{action_type:"",direction:"",stations_to_show:[]},draw_forbid_regions_interaction:void 0,delete_forbid_regions_interaction:void 0,edit_forbid_regions_interaction:void 0,mapEditsInteraction:void 0}},computed:{MapServerUrl(){return ae.p.getters.MapServerUrl},map_img_extent(){return ae.p.getters.Map_Image_Boundary},map_img_size(){return ae.p.getters.Map_Image_Size},PathesSegments(){return ae.p.getters.Pathes},previousSelectedFeature(){return this.previousSelectedFeatures[0]},MouseCoordinationDisplay(){return this.MouseCoordination?`(${this.MouseCoordination[0].toFixed(2)},${this.MouseCoordination[1].toFixed(2)})`:"(-1,-1)"},StationPointsFeatures(){return"coordination"==this.map_display_mode?this.PointLayer.getSource().getFeatures():this.PointRouteLayer.getSource().getFeatures()},AGVMapFeatures(){return this.AGVLocLayer.getSource().getFeatures()},ShowWarningNotify(){return"view"!=this.EditorOption.EditMode&&"coordination"==this.map_display_mode},map_station_data(){return ae.p.getters.MapStations},BezierCurves(){return ae.p.getters.BezierCurves},agvs_info(){return ae.p.getters.AGVNavInfo},eq_data(){return oe.jU.getters.EQData},ControledPathesBySystem(){return ae.p.getters.ControledPathesBySystem},radio_group_style(){return"add-path"==this.EditorOption.EditAction||"add-forbid-region"==this.EditorOption.EditAction?{position:"relative",top:"-15px"}:{}},marginTop(){return"add-path"==this.EditorOption.EditAction||"add-forbid-region"==this.EditorOption.EditAction?"106px":"86px"},path_view_style(){return"add-path"==this.EditorOption.EditAction||"add-forbid-region"==this.EditorOption.EditAction?{paddingTop:"116px"}:{paddingTop:"86px"}}},methods:{GetPointName(e){var t=(0,te.G)(e);if(t)return t.Name},ClearMap(){this.PathesSegmentsForEdit=[],this.PathLayerForCoordination.getSource().clear(),this.PathLayerForRouter.getSource().clear(),this.PointRouteLayer.getSource().clear(),this.PointLayer.getSource().clear(),this.TransferTaskIconLayer.getSource().clear()},HandlePathRemoveBtnClick(e){var t=this.PathesSegmentsForEdit.indexOf(e);this.PathesSegmentsForEdit.splice(t,1),this.UpdateStationPathLayer()},HandlePathTbRowClick(e,t,a){this.selected_path_feature&&this.RestoreOriginalPathStyle(this.selected_path_feature);var o=this.PathLayerForCoordination.getSource(),n=o.getFeatures().find((t=>t.get("path_id")==e.PathID));if(n){var i=n.getStyle();if(i[0]=this.path_highlight_style,n.setStyle(i),this.selected_path_feature=n,!this.IsPathEditing){var s=n.getGeometry().getCoordinates()[0];this.map.getView().setCenter(s)}}},RestoreOriginalPathStyle(e){if(e){var t=e.get("ori_stroke_style"),a=e.getStyle();a[0]=t,e.setStyle(a)}},UpdateStationPointLayer(){var e=[],t=[];for(let r=0;r<this._map_stations.length;r++){var a=this._map_stations[r],o=(0,te.HB)(a);e.push(o);var n=o.get("routeModeFeature");n&&t.push(n)}var i=this.PointLayer.getSource();i.clear(),i.addFeatures(e);var s=this.PointRouteLayer.getSource();s.clear(),s.addFeatures(t),this.UpdateEQLDULDFeature()},UpdateStationPathLayer(){var e=this.PathLayerForCoordination.getSource(),t=this.PathLayerForRouter.getSource();e.clear(),t.clear();var a=[],o=[],n=this.PathesSegmentsForEdit,i=function(e,t){e.set("start_pt_index",t.StartPtIndex),e.set("end_pt_index",t.EndPtIndex),e.set("path_id",t.PathID),e.set("isEqLink",t.IsEQLink),e.set("feature_type","path"),e.set("isClose",!t.IsPassable);var a=(0,te.bE)(e);e.setStyle(a),e.set("ori_stroke_style",a[0])};n.forEach((e=>{let t=new U.Z({geometry:new z.Z([e.StartCoordination,e.EndCoordination])});var n=this._map_stations.find((t=>t.index==e.StartPtIndex)),s=this._map_stations.find((t=>t.index==e.EndPtIndex));let r=new U.Z({geometry:new z.Z([[n.data.Graph.X,n.data.Graph.Y],[s.data.Graph.X,s.data.Graph.Y]])});i(t,e),i(r,e),a.push(t),o.push(r)})),e.addFeatures(a),t.addFeatures(o)},UpdateEQLDULDFeature(){if(!this.editable){var e=[];for(let o=0;o<this._map_stations.length;o++){var t=this._map_stations[o],a=(0,te.Xl)(t,this.map_display_mode);e.push(a)}var o=this.EQLDULDStatusLayer.getSource();o.clear(),o.addFeatures(e)}},UpdateForbidPointLayer(){this.RegionLayer.getSource().clear();var e=ae.p.getters.Regions;e.forEach((e=>{var t=(0,te.H6)(e.Name,e.PolygonCoordinations,e.RegionType);this.RegionLayer.getSource().addFeatures([t.region_feature,t.text_feature])}))},UpdateAGVLayer(){"visible"==this.agv_display&&this.agvs_info.AGVDisplays.forEach((e=>{var t=this.AGVFeatures[e.AgvName];if(t){var a=e.Coordination,o=e.NavPathCoordinationList;if("router"==this.map_display_mode){o=[];var n=this.StationPointsFeatures.find((t=>t.get("data").TagNumber==e.Tag));n&&(a=n.getGeometry().getCoordinates());var i=this.PointLayer.getSource().getFeatures();for(let t=0;t<e.NavPathCoordinationList.length;t++){const a=e.NavPathCoordinationList[t];n=i.find((e=>e.getGeometry().getCoordinates()[0]==a[0]&&e.getGeometry().getCoordinates()[1]==a[1]));var s=this.StationPointsFeatures.find((e=>e.get("index")==n.get("index")));o.push(s.getGeometry().getCoordinates())}}t.agv_feature.setGeometry(new $.Z(a)),t.cargo_icon_feature.setGeometry(new $.Z(a));var r=t.agv_feature.getStyle(),l=r.getImage();"router"!=this.map_display_mode&&(l.setRotation(-1*(e.Theta-90)*Math.PI/180),r.setImage(l));var d=e.CurrentAction,c=r.getText(),m=e.AgvName+(""==d?"":`(${d})`);m+=e.WaitingInfo.IsWaiting?"\r\n"+e.WaitingInfo.Descrption:"",c.setText(m);var u=c.getBackgroundFill();u.setColor(e.AgvStates.is_online?e.WaitingInfo.IsWaiting?"orange":e.TextColor:"rgb(147, 147, 147)"),c.setBackgroundFill(u),t.agv_feature.setStyle(r),t.path_feature.setGeometry(new z.Z(o)),(0,te.oy)(t.cargo_icon_feature,e.CargoStatus)}else{var h=new U.Z({geometry:new $.Z(e.Coordination)});h.setStyle((0,te.K$)(e.AgvName,e.TextColor)),h.set("agvname",e.AgvName),h.set("feature_type",this.FeatureKeys.agv);var p=new U.Z({geometry:new z.Z([])});p.setStyle((0,te.DS)(e.TextColor,5));var g=h.clone();g.setStyle((0,te.Qw)()),this.AGVFeatures[e.AgvName]={agv_feature:h,path_feature:p,cargo_icon_feature:g};var _=this.AGVLocLayer.getSource();_.addFeature(g),_.addFeature(h),_.addFeature(p)}}))},UpdateAGVLocByMapMode(e="router",t=new te.Ew){var a=this.AGVFeatures[t.AgvName];if(a){var o=this.StationPointsFeatures.find((e=>e.get("data").TagNumber==t.Tag)),n=o.getGeometry().getCoordinates();a.agv_feature.setGeometry(new $.Z(n))}},InitMapEventHandler(){this.map.on("pointermove",(e=>{this.MouseCoordination=e.coordinate;var t=this.map.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));this.map.getTargetElement().style.cursor=t?"pointer":""})),this.map.on("pointerup",(e=>{"add-station"==this.EditorOption.EditAction?this.map.getTargetElement().style.cursor="crosshair":this.map.getTargetElement().style.cursor="default"})),this.map.on("pointerdown",(e=>{this.map.getTargetElement().style.cursor="grabbing"})),this.map.on("moveend",(e=>{this.SaveSettingsToLocalStorage()}))},HandleDeleteForbidRegionClicked(){var e=()=>{this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.mapEditsInteraction),this.RemoveInteraction(this.edit_forbid_regions_interaction)};e();var t="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(t),this.AddRemoveForbidRegionInteraction()},HandleEditForbidRegionClicked(){var e=()=>{this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.mapEditsInteraction)};e();var t="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(t),this.AddEditForbidRegionInteraction()},HandleAddForbidRegionClicked(e){var t=()=>{this.RemoveInteraction(this.mapEditsInteraction),this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.edit_forbid_regions_interaction)};t();var a="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(a),this.AddDrawForbidActionInteraction(e)},AddEditMapInteraction(){this.RemoveForbidRegionOperationInteractions();var e=this;this.mapEditsInteraction=new Q.Z({handleDownEvent:function(t){const a=2==t.originalEvent.button;e.editModeContextMenuVisible=!1,e.ClearSelectedFeature();var o=t.map,n=o.forEachFeatureAtPixel(t.pixel,(function(e){return e}));this.coordinate_=t.coordinate;var i=e.EditorOption.EditAction;if(!a||!n||"path"!=n.get("feature_type")||"add-station"!=i){if(n){if("polygon"==n.get("type")||"text"==n.get("type"))return!1;var s=n.get("feature_type"),r=()=>e.IsSelectAGVMode&&"agv"==s,l=()=>e.IsSelectEQStationMode&&"station"==s;if(r()){var d=n.get("agvname");ee.Z.emit("/map/agv_selected",d)}if(l()){var c=n.get("data");ee.Z.emit("/map/station_selected",c)}}else{if(e.IsDragging=!1,"add-station"!=i||!a)return!1;n=(0,te.s6)(t.coordinate,e.GenNewIndexOfStation())}if("lduld"==n.get("feature_type")){var m=n.get("action");return e.HandleLDULDLabelClick(n.get("data"),m),!1}if(e.HighLightFeatureSelected([n]),"view"==e.EditorOption.EditMode)return!1;var u=n.get("feature_type");return this.feature_=n,e.IsDragging=!0,"none"==i&&u!=e.FeatureKeys.Station?!1:(0==t.originalEvent.button?u==e.FeatureKeys.Station&&"remove-station"==i?e.RemoveStation(n):u==e.FeatureKeys.path&&"remove-path"==i?e.RemovePath(n):"add-path"==i&&e.PushPathEndPointData(n):2==t.originalEvent.button&&u==e.FeatureKeys.path&&"edit-path"==i&&e.OpenPath_editor(n),!0)}e.InsertPointAtPathes(n,t.coordinate)},handleDragEvent:function(t){var a=e.editable,o=e.EditorOption.EditMode,n=e.EditorOption.EditAction;if(a&&"edit"==o&&"add-path"!=n&&"edit-path"!=n&&"remove-path"!=n){var i=t.coordinate[0]-this.coordinate_[0],s=t.coordinate[1]-this.coordinate_[1],r=this.feature_.getGeometry();r.translate(i,s),e.MouseCoordination=this.coordinate_=t.coordinate,r=this.feature_.getGeometry();var l=this.feature_.get("data");if(l){var d=r.getCoordinates();"coordination"==e.map_display_mode?(l.X=d[0],l.Y=d[1]):(l.Graph.X=d[0],l.Graph.Y=d[1]),this.feature_.set("data",l)}}},handleUpEvent:function(t){if("view"!=e.EditorOption.EditMode){var a=e.EditorOption.EditAction;if("add-path"!=a&&"remove-path"!=a){if(2==t.originalEvent.button)if("edit-station"==a)e.HandlePtSettingBtnClick();else if("add-station"==a)try{e.AddFeatureToMapLayers(this.feature_)}catch(n){console.error(n),e.HandlePtSettingBtnClick()}e.IsDragging=!1;try{var o=this.feature_.get("index");e.ResetPathLinkOfRouteMode(o),e.ResetPathLinkOfCoordinationMode(o)}catch(n){}}this.feature_=null,this.coordinate_=null}},handleMoveEvent:function(t){var a=e.EditorOption.EditAction;if("view"!=e.EditorOption.EditMode){e.MouseCoordination=t.coordinate;var o=t.map,n=o.forEachFeatureAtPixel(t.pixel,(function(e,t){return e})),i="";if(n){var s=n.get("feature_type");i="add-path"==a&&s!=e.FeatureKeys.Station||"remove-station"==a&&s!=e.FeatureKeys.Station||"remove-path"==a&&s!=e.FeatureKeys.path?"not-allowed":"pointer"}else"add-station"==a&&(i="crosshair"),this.feature_=void 0;o.getTargetElement().style.cursor=i}}}),this.map.addInteraction(this.mapEditsInteraction)},AddDrawForbidActionInteraction(e="forbid|passible"){this.RemoveInteraction(this.draw_forbid_regions_interaction);const t="Polygon";var a=this,o="forbid"==e,n=o?"rgba(255, 0, 0,0.5)":"rgba(116, 249, 42,0.5)",i=o?"red":"seagreen";"None"!==t&&(this.draw_forbid_regions_interaction=new j.ZP({source:this.RegionLayer.getSource(),type:t,condition:ze.rM,style:new ne.ZP({fill:new se.Z({color:n}),stroke:new ie.Z({color:"blue",width:1})})}),this.draw_forbid_regions_interaction.on("drawend",(t=>{var s=o?a.GetForbidRegionCount():a.GetPassibleRegionCount(),r=o?`禁制區-${s+1}`:`通行區-${s+1}`;const l=t.feature;l.set("type","polygon"),l.set("name",r),l.set("region_type",e);const d=l.getGeometry().getInteriorPoint().getCoordinates();console.info(d),l.setStyle(new ne.ZP({fill:new se.Z({color:n}),stroke:new ie.Z({color:i,width:1})}));const c=new U.Z({geometry:new $.Z(d)});c.set("type","text"),c.set("name",r),c.set("region_type",e),c.setStyle(new ne.ZP({text:new re.Z({text:r,scale:1.2,fill:new se.Z({color:"black"})})})),a.RegionLayer.getSource().addFeature(c)})),this.map.addInteraction(this.draw_forbid_regions_interaction))},AddRemoveForbidRegionInteraction(){this.RemoveInteraction(this.delete_forbid_regions_interaction);var e=this.RegionLayer.getSource();this.delete_forbid_regions_interaction=new Q.Z({handleDownEvent:function(t){var a=t.map,o=a.forEachFeatureAtPixel(t.pixel,(function(e){return e}));if(o){var n=o.get("name");e.removeFeature(o);var i=e.getFeatures().find((e=>e.get("name")==n));e.removeFeature(i),(0,Qe.bM)({title:"管制區修改",message:`管制區-${n} 已刪除`,position:"bottom-right",duration:1e3})}}}),this.map.addInteraction(this.delete_forbid_regions_interaction)},AddEditForbidRegionInteraction(){this.RemoveInteraction(this.edit_forbid_regions_interaction);var e=this.$refs["forbid_region_editor"],t=this.RemoveKeyboardPressEventListener;this.edit_forbid_regions_interaction=new Q.Z({handleDownEvent:function(a){var o=a.map,n=o.forEachFeatureAtPixel(a.pixel,(function(e){return e}));if(n&&"polygon"==n.get("type")){var i=n.get("name");t(),e.Show(i)}}}),this.map.addInteraction(this.edit_forbid_regions_interaction)},RemoveInteraction(e){e&&this.map.removeInteraction(e)},RemoveKeyboardPressEventListener(){document.removeEventListener("keydown",this.EditModeKeybordEvents)},HideNormalStations(e){var t=this.StationPointsFeatures.filter((e=>0==e.get("station_type")));t.forEach((t=>{if(e){var a=new ne.ZP({fill:new se.Z({color:"rgba(0, 0, 0, 0)"}),stroke:new ie.Z({color:"rgba(0, 0, 0, 0)"}),image:new le.Z({radius:0})}),o=t.getStyle().clone();t.set("visible-style",o),t.setStyle(a)}else{var n=t.get("visible-style");t.setStyle(n)}}))},SaveSettingsToLocalStorage(){var e=this.map.getView().getZoom(),t=this.map.getView().getCenter();"coordination"==this.map_display_mode?(this.zoom=e,this.center=t):(this.zoom_route=e,this.center_route=t),localStorage.setItem(`map-${this.$route.name}`,JSON.stringify({zoom:this.zoom,zoom_route:this.zoom_route,mode:this.map_display_mode,center:this.center,center_route:this.center_route,station_name_display_mode:this.station_name_display_mode}))},RestoreSettingsFromLocalStorage(){var e=localStorage.getItem(`map-${this.$route.name}`);if(e){var t=JSON.parse(e);this.station_name_display_mode=t.station_name_display_mode,this.map_display_mode=this.editable?"router":t.mode,this.zoom=t.zoom}},RemoveStation(e=new U.Z){var t=function(e,t){var a=e.getFeatures().find((e=>e.get("index")==t));e.removeFeature(a)},a=function(e,t,a){var o=a.get("index"),n=t.filter((e=>e.StartPtIndex==o||e.EndPtIndex==o));n.forEach((a=>{var o=a.PathID,n=e.getFeatures().find((e=>e.get("path_id")==o));e.removeFeature(n);var i=t.indexOf(a);-1!=i&&t.splice(i,1)}))},o=e.get("index");t(this.PointLayer.getSource(),o),t(this.PointRouteLayer.getSource(),o),a(this.PointLayer.getSource(),this.PathesSegmentsForEdit,e),this.UpdateStationPathLayer()},AddFeatureToMapLayers(e){this.PointLayer.getSource().addFeature(e),this.PointRouteLayer.getSource().addFeature(e);var t=new te.eX;t.index=t.name=e.get("index"),t.tag=e.get("tag"),t.station_type=e.get("station_type"),t.targets=e.get("targets"),t.coordination=e.get("coordination"),t.graph=e.get("graph"),t.data=e.get("data"),this._map_stations.push(t)},RemovePath(e,t=!1){var a=[],o=e.get("path_id"),n=o.split("_"),i=parseInt(n[0]),s=parseInt(n[1]),r=this.PointLayer.getSource().getFeatures().find((e=>e.get("index")==i)),l=r.get("data");delete l.Target[s];l=r.set("data",l);this.PathLayerForCoordination.getSource().removeFeature(e);var d=this.PathesSegmentsForEdit.find((e=>e.PathID==o));if(d){var c=this.PathesSegmentsForEdit.indexOf(d);if(-1!=c&&(this.PathesSegmentsForEdit.splice(c,1),this.UpdateStationPathLayer(),a.push(d)),t){var m=`${s}_${i}`,u=this.PathLayerForCoordination.getSource().getFeatures().find((e=>e.get("path_id")==m));if(u){var h=this.RemovePath(u,!1);h.forEach((e=>{a.push(e)}))}}}return a},InsertPointAtPathes(e,t){var a=(0,te.s6)(t,this.GenNewIndexOfStation()),o=this.RemovePath(e,!0);this.AddFeatureToMapLayers(a);var n="router"==this.map_display_mode?this.PointRouteLayer.getSource().getFeatures():this.PointLayer.getSource().getFeatures();o.forEach((e=>{var t=n.find((t=>t.get("index")==e.StartPtIndex)),o=a,i=a,s=n.find((t=>t.get("index")==e.EndPtIndex));this.GenPath([t,o]),this.GenPath([i,s])}));this.CalculateNewPointRatioOfPathStart(o[0],a)},CalculateNewPointRatioOfPathStart(e,t){var a="router"==this.map_display_mode?this.PointRouteLayer.getSource().getFeatures():this.PointLayer.getSource().getFeatures(),o=a.find((t=>t.get("index")==e.StartPtIndex)),n=a.find((t=>t.get("index")==e.EndPtIndex)),i=o.getGeometry().getCoordinates(),s=n.getGeometry().getCoordinates(),r=t.getGeometry().getCoordinates(),l=Math.sqrt(Math.pow(i[0]-s[0],2)+Math.pow(i[1]-s[1],2)),d=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2)),c=d/l;return c},ResetNewPointCoordination(e,t){this.PointRouteLayer.getSource().getFeatures();var a=this.PointLayer.getSource().getFeatures(),o=t.get("index"),n=a.find((e=>e.get("targets").includes(o))),i=a.find((e=>e.get("index")==t.get("targets")[0])),s=n.getGeometry().getCoordinates(),r=i.getGeometry().getCoordinates(),l=s[0]+(r[0]-s[0])*e,d=s[1]+(r[1]-s[1])*e,c=a.find((e=>e.get("index")==o)),m=c.get("data"),u=[l,d];m.X=u[0],m.Y=u[1],c.set("data",m),this.ResetPathLinkOfRouteMode(o),this.ResetPathLinkOfCoordinationMode(o)},ResetPathLinkOfCoordinationMode(e,t=!1){var a=this.PointLayer.getSource().getFeatures().find((t=>t.get("index")==e)),o=this.PathLayerForCoordination.getSource().getFeatures();try{for(var n=o.filter((t=>t.get("start_pt_index")==e)),i=0;i<n.length;i++){var s=n[i],r=s.get("path_id"),l=this.PathesSegmentsForEdit.find((e=>e.PathID==r));if(s)if(t)source.removeFeature(s),this.PathesSegmentsForEdit.remove(l);else{var d=s.getGeometry(),c=d.getCoordinates()[1],m=a.getGeometry().getCoordinates(),u=new z.Z([m,c]);s.setGeometry(u),s.setStyle((0,te.bE)(s)),l.StartCoordination=m}}}catch(v){}try{for(n=o.filter((t=>t.get("end_pt_index")==e)),i=0;i<n.length;i++){var h=n[i],p=this.PathesSegmentsForEdit.find((e=>e.PathID==h.get("path_id")));if(t)source.removeFeature(h),this.PathesSegmentsForEdit.remove(p);else{d=h.getGeometry();var g=d.getCoordinates()[0],_=a.getGeometry().getCoordinates();u=new z.Z([g,_]);h.setGeometry(u),h.setStyle((0,te.bE)(h)),p.EndCoordination=_}}}catch(v){}},ResetPathLinkOfRouteMode(e,t=!1){var a=this.PointRouteLayer.getSource().getFeatures().find((t=>t.get("index")==e)),o=this.PathLayerForRouter.getSource().getFeatures();try{for(var n=o.filter((t=>t.get("start_pt_index")==e)),i=0;i<n.length;i++){var s=n[i],r=s.get("path_id"),l=this.PathesSegmentsForEdit.find((e=>e.PathID==r));if(s)if(t)source.removeFeature(s),this.PathesSegmentsForEdit.remove(l);else{var d=s.getGeometry(),c=d.getCoordinates()[1],m=a.getGeometry().getCoordinates(),u=new z.Z([m,c]);s.setGeometry(u),s.setStyle((0,te.bE)(s))}}}catch(v){}try{for(n=o.filter((t=>t.get("end_pt_index")==e)),i=0;i<n.length;i++){var h=n[i],p=this.PathesSegmentsForEdit.find((e=>e.PathID==h.get("path_id")));if(t)source.removeFeature(h),this.PathesSegmentsForEdit.remove(p);else{d=h.getGeometry();var g=d.getCoordinates()[0],_=a.getGeometry().getCoordinates();u=new z.Z([g,_]);h.setGeometry(u),h.setStyle((0,te.bE)(h))}}}catch(v){}},ResetPathLink(e,t,a=!1){var o=e.getSource(),n=o.getFeatures(),i=n.find((e=>e.get("index")==t));try{var s=n.filter((e=>e.get("start_pt_index")==t));s.forEach((e=>{var t=e.get("path_id"),n=this.PathesSegmentsForEdit.find((e=>e.PathID==t));if(e)if(a)o.removeFeature(e),this.PathesSegmentsForEdit.remove(n);else{var s=e.getGeometry(),r=s.getCoordinates()[1],l=i.getGeometry().getCoordinates(),d=new z.Z([l,r]);e.setGeometry(d),e.setStyle((0,te.bE)(e)),n.StartCoordination=l}}))}catch(l){}try{var r=n.filter((e=>e.get("end_pt_index")==t));r.forEach((e=>{var t=this.PathesSegmentsForEdit.find((t=>t.PathID==e.get("path_id")));if(a)o.removeFeature(e),this.PathesSegmentsForEdit.remove(t);else{var n=e.getGeometry(),s=n.getCoordinates()[0],r=i.getGeometry().getCoordinates(),l=new z.Z([s,r]);e.setGeometry(l),e.setStyle((0,te.bE)(e)),t.EndCoordination=r}}))}catch(l){}},PushPathEndPointData(e=new U.Z){if(e.get("feature_type")==this.FeatureKeys.Station){if(2==this.PathEditTempStore.length)this.PathEditTempStore=[];else if(1==this.PathEditTempStore.length&&this.PathEditTempStore[0].get("index")==e.get("index"))return;if(this.PathEditTempStore.push(e),2==this.PathEditTempStore.length&&(this.GenPath(this.PathEditTempStore),"bi-direction"==this.EditorOption.AddPathMode.Direction)){var t=[this.PathEditTempStore[1],this.PathEditTempStore[0]];this.GenPath(t)}}},GenPath(e=[]){var t=e[0],a=e[1],o=t.get("index"),n=a.get("index"),i=t.get("data").X,s=t.get("data").Y,r=a.get("data").X,l=a.get("data").Y,d=t.getGeometry().getCoordinates(),c=a.getGeometry().getCoordinates(),m=[(d[0]+c[0])/2,(d[1]+c[1])/2],u=((0,te.s6)(m,this.GenNewIndexOfStation()),0!=a.get("station_type")||0!=t.get("station_type")),h=`${o}_${n}`;if(!this.PathLayerForCoordination.getSource().getFeatures().find((e=>e.get("path_id")==h))){var p={PathID:h,StartPtIndex:o,EndPtIndex:n,StartCoordination:[i,s],EndCoordination:[r,l],IsEQLink:u,IsSingleCar:!1,IsPassable:!0,IsExtinguishingPath:!1,Speed:1,LsrMode:0,DodgeMode:0,SpinMode:0};this.PathesSegmentsForEdit.push(p);var g=t.get("targets");g||(g=[]);var _=t.get("data");_.Target[n]=1,t.set("data",_),g.push(n),t.set("targets",g),this.UpdateStationPathLayer()}},GenNewIndexOfStation(){var e=this.PointLayer.getSource().getFeatures().map((e=>e.get("index"))),t=e.filter((e=>void 0!=e)).sort(((e,t)=>e-t)),a=0==t.length?0:t[t.length-1]+1;return a},AgvDisplayOptHandler(){this.AGVLocLayer.setVisible("visible"==this.agv_display)},SlamImageDisplayOptHandler(){"coordination"!=this.map_display_mode&&this.UpdateStationPathLayer(),this.ImageLayer.setVisible("visible"==this.map_image_display)},MapDisplayModeOptHandler(e=!0){var t="coordination"==this.map_display_mode;this.UpdateStationPathLayer(),this.StationNameDisplayOptHandler(),this.PointLayer.setVisible(t),this.PointRouteLayer.setVisible(!t),this.PathLayerForCoordination.setVisible(t),this.PathLayerForRouter.setVisible(!t),this.RegionLayer.setVisible(t),this.UpdateEQLDULDFeature(),this.UpdateAGVLocLocation(),e&&this.map.getView().setCenter(t?this.GetMidPointOfCoordinationMode():this.GetMidPointOfRouterMode())},UpdateAGVLocLocation(){this.agvs_info.AGVDisplays.forEach((e=>{this.UpdateAGVLocByMapMode(this.map_display_mode,e)}))},GetMidPointOfRouterMode(){var e=[...this._map_stations];e.sort(((e,t)=>e.graph[0]-t.graph[0]));var t=e[0],a=e[e.length-1],o=(a.graph[0]+t.graph[0])/2;e.sort(((e,t)=>e.graph[1]-t.graph[1])),t=e[0],a=e[e.length-1];var n=(a.graph[1]+t.graph[1])/2;return[o,n]},GetMidPointOfCoordinationMode(){var e=[...this._map_stations];e.sort(((e,t)=>e.coordination[0]-t.coordination[0]));var t=e[0],a=e[e.length-1],o=(a.coordination[0]+t.coordination[0])/2;e.sort(((e,t)=>e.coordination[1]-t.coordination[1])),t=e[0],a=e[e.length-1];var n=(a.coordination[1]+t.coordination[1])/2;return console.log(o,n),[o,n]},StationNameDisplayOptHandler(){this.StationPointsFeatures.forEach((e=>{var t=e.get("index"),a=e.get("data"),o="";"index"==this.station_name_display_mode&&(o=t+""),"name"==this.station_name_display_mode&&(o=a.Graph.Display),"tag"==this.station_name_display_mode&&(o=a.TagNumber+"");var n=a.StationType;e.setStyle((0,te.rL)(o,n,a))})),this.SaveSettingsToLocalStorage()},ShowLocus(e=[],t="red",a=1){var o=this.AGVLocusLayer.getSource();if(o){var n=[];o.clear();let i=(0,te.tW)(e[e.length-1],!1),s=new U.Z({geometry:new z.Z(e)});s.setStyle((0,te.DS)(t,a)),n.push(s),n.push(i),o.addFeatures(n)}},HandlerSaveBtnClick(){var e={};this.PointLayer.getSource().getFeatures().forEach((t=>{var a=t.get("index"),o=t.get("data");e[a]=o}));var t={Points:e,Pathes:this.PathesSegmentsForEdit,Regions:this.GetRegionsDataFromLayer()};this.$emit("save",t)},HandlePtSettingBtnClick(){this.RemoveKeyboardPressEventListener(),this.editModeContextMenuVisible=!1,this.$refs.ptsetting.Show({index:this.previousSelectedFeature.get("index"),point:this.previousSelectedFeature.get("data")})},ReloadMap(e=!0){this.$swal.fire({text:"確定要重新載入圖資?",title:"",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((async e=>{e.isConfirmed&&(this.loading=!0,await ae.p.dispatch("DownloadMapData",""),console.log("re-done"),this.RefreshMap(),this.loading=!1)}))},DeepClonePathSegmentData(){this.PathesSegmentsForEdit=JSON.parse(JSON.stringify(this.PathesSegments))},InitMap(){const e=this.map_img_extent,t=new Y.Z({code:"xkcd-image",units:"pixels",extent:e});this.map_name=ae.p.getters.MapName,this.ImageLayer=new J.Z({source:new K.Z({url:`${this.MapServerUrl}/MapFiles/${this.map_name}.png`,projection:t,imageExtent:e,imageSize:this.map_img_size}),visible:"visible"==this.map_image_display});const a=new q.Z({features:[]});this.AGVLocusLayer=new X.Z({source:a}),this.map=new Z.Z({layers:[this.ImageLayer,this.TransferTaskIconLayer,this.EQLDULDStatusLayer,this.PathLayerForCoordination,this.PathLayerForRouter,this.PointLayer,this.PointRouteLayer,this.AGVLocLayer,this.AGVLocusLayer,this.RegionLayer],target:this.id,view:new W.ZP({projection:t,center:[0,0],zoom:1,maxZoom:20})}),this.AGVLocLayer.setVisible(this.agv_show),this.editable&&(this.PointLayer.setVisible(!1),this.PathLayerForCoordination.setVisible(!1),this.PointRouteLayer.setVisible(!0),this.PathLayerForRouter.setVisible(!0)),this.EQLDULDStatusLayer.setVisible(!this.editable),this.InitMapEventHandler()},GetForbidRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"forbid"==e.get("region_type")));return t.length},GetPassibleRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"passible"==e.get("region_type")));return t.length},GetRegionsDataFromLayer(){let e=[];var t=this.RegionLayer.getSource().getFeatures(),a=t.filter((e=>"polygon"==e.get("type")));return a.forEach((t=>{var a=t.get("name"),o=t.get("region_type"),n=t.getGeometry().flatCoordinates;function i(e){const t=[];let a=[];for(let o=0;o<e.length;o++)a.push(e[o]),o%2===1&&(t.push(a),a=[]);return t}let s=i(n);e.push(new te.S9(a||`禁制區-${GetForbidRegionCount()+1}`,s,"forbid"==o?0:1))})),console.log(e),e},ResetMapCenterViaAGVLoc(e){var t=this.AGVFeatures[e];if(t){var a=t.agv_feature.getGeometry().getCoordinates();this.map.getView().setCenter(a)}},HandleSettingBtnClick(){this.$refs.settings.show=!0},ClearSelectedFeature(){if(!this.editable){try{this.previousSelectedFeatures.forEach((e=>{var t=e.get("oristyle");e.setStyle(t)}));var e=this.previousSelectedFeature.get("oristyle");this.previousSelectedFeature.setStyle(e)}catch{}this.previousSelectedFeatures=[]}},HighLightFeatureSelected(e=[new U.Z],t="red"){if(this.editable)return this.previousSelectedFeatures=[],void this.previousSelectedFeatures.push(e[0]);try{this.ClearSelectedFeature(),e.forEach((e=>{var a=e.getStyle();if(a){e.set("oristyle",a.clone());var o=a.clone(),n=o.getText();if(n){var i=n.getStroke();if(i){var s=i.clone();s.setColor(t),n.setStroke(s),e.setStyle(o)}}}this.previousSelectedFeatures.push(e)}))}catch(a){}},HighLightFeaturesByStationType(e=0,t="red"){var a=this.StationPointsFeatures.filter((t=>t.get("station_type")==e));this.HighLightFeatureSelected(a,t)},HandleAGVUploadData(e=[{TagNumber:0,X:0,Y:0,Theta:0}]){var t=this.PointLayer.getSource().getFeatures();Object.values(e).forEach((e=>{var a=t.find((t=>t.get("data").TagNumber==e.TagNumber));if(a){a.setGeometry(new $.Z([e.X,e.Y]));var o=a.get("data");o.Direction=parseInt(Math.round(e.Theta)),a.set("data",o)}else{var n=new te.eX;n.coordination=[e.X,e.Y],n.index=this.GenNewIndexOfStation(),n.station_type=0,n.name=e.TagNumber+"",n.tag=e.TagNumber;var i=new te.ux;i.StationType=0,i.X=e.X,i.Y=e.Y,i.Graph.X=parseInt(Math.round(e.X)),i.Graph.Y=parseInt(Math.round(e.Y)),i.Name=e.TagNumber+"",i.TagNumber=e.TagNumber,i.Direction=parseInt(Math.round(e.Theta)),n.data=i;var s=(0,te.HB)(n);this.PointLayer.getSource().addFeature(s)}}))},showContextMenu(e){if(e.preventDefault(),!this.editable&&"add-station"!=this.EditorOption.EditAction&&this.previousSelectedFeature){this.contextMenuTop=e.clientY,this.contextMenuLeft=e.clientX;var t=this.previousSelectedFeature.get("feature_type");this.contextMenuOptions.feature_type=t;var a=this.previousSelectedFeature.get("data");a&&(this.contextMenuOptions.title=a.Name,this.contextMenuOptions.point_data=a,this.contextMenuOptions.task_options=new te.UY(a.StationType),this.contextMenuOptions.show_task_dispatch=this.task_dispatch_menu_show),this.editModeContextMenuVisible=!0}},HandlePtSettingDrawerLeaved(){this.RemoveKeyboardPressEventListener(),document.addEventListener("keydown",this.EditModeKeybordEvents)},PointSettingChangedHandle(e){var t=e.index,a=e.pointData,o=function(e,t,a){var o=e.getFeatures().find((e=>e.get("index")==t));o.set("data",a),o.set("station_type",a.StationType),o.setStyle((0,te.rL)(a.Name,a.StationType,a));var n=o.getStyle(),i=n.clone(),s=i.getText();s.setText(a.Graph.Display);var r=s.getStroke();if(r){var l=r.clone();l.setColor("blue"),s.setStroke(l)}o.setStyle(i)};o(this.PointLayer.getSource(),t,a),o(this.PointRouteLayer.getSource(),t,a);for(var n=0!=a.StationType,i=this.PathesSegmentsForEdit.filter((e=>e.StartPtIndex==t)),s=this.PathesSegmentsForEdit.filter((e=>e.EndPtIndex==t)),r=0;r<i.length;r++)i[r].IsEQLink=n,i[r].StartCoordination=[a.X,a.Y];for(r=0;r<s.length;r++)s[r].IsEQLink=n,s[r].EndCoordination=[a.X,a.Y]},HandleMenuTaskBtnClick(e={action:"",station_data:{}}){this.editModeContextMenuVisible=!1;var t=0;"move"==e.action?t=0:"load"==e.action|"unload"==e.action|"carry"==e.action?t=1:"charge"==e.action&&(t=3),this.HighLightFeaturesByStationType(t,"blue"),ee.Z.emit("bus-show-task-allocation",e)},HandleAGVUploadCorrdinationChanged(e){ae.p.dispatch("UploadCoorFunctionSwitch",e)},HandleLDULDLabelClick(e,t){this.$emit("onTransferRequst",{station_data:e,action:t})},ChangeLDULDStatus(e,t){try{var a=1==t?"load":"unload",o=this.EQLDULDStatusLayer.getSource().getFeatures(),n=o.find((t=>t.get("data").TagNumber==e));if(!n)return;var i=n.getStyle();if(!i)return;var s=i.getText();if(!s)return;var r="";if(1!=t&&2!=t||(r=1==t?" 入料請求":"出料請求"),s.setText(r),s.setBackgroundFill(new se.Z({color:1==t?"orange":"blue"})),n.get("action")==a)return;n.set("action",a),n.setStyle(i)}catch(l){console.error(l)}},RenderEQLDULDStatus(){this.eq_data.forEach((e=>{setTimeout((()=>{this.ChangeLDULDStatus(e.Tag,e.TransferStatus)}),100)}))},watch_eq_data_changed(){setInterval((()=>{this.RenderEQLDULDStatus()}),100)},RefreshMap(){this._map_stations=JSON.parse(JSON.stringify(this.map_station_data)),this.DeepClonePathSegmentData(),this.UpdateStationPointLayer(),this.UpdateStationPathLayer(),this.MapDisplayModeOptHandler(!1),this.UpdateForbidPointLayer()},RemoveForbidRegionOperationInteractions(){this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.edit_forbid_regions_interaction),this.RemoveInteraction(this.delete_forbid_regions_interaction)},EditModeKeybordEvents(e){var t=e.key.toLowerCase();console.info(t),"e"==t&&(this.EditorOption.EditMode="edit"),"v"==t&&(this.EditorOption.EditMode="view"),"edit"==this.EditorOption.EditMode&&("escape"==t&&this.draw_forbid_regions_interaction&&this.draw_forbid_regions_interaction.abortDrawing(),"1"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="add-station",this.AddEditMapInteraction()),"2"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="edit-station",this.AddEditMapInteraction()),"3"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="remove-station",this.AddEditMapInteraction()),"4"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="add-path",this.AddEditMapInteraction()),"5"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="edit-path",this.AddEditMapInteraction()),"6"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="remove-path",this.AddEditMapInteraction()),"7"==t&&(this.EditorOption.EditAction="add-forbid-region",this.RemoveInteraction(this.mapEditsInteraction),this.AddDrawForbidActionInteraction(this.EditorOption.AddRegionMode.Mode)))},OpenPath_editor(e=new U.Z){var t=e.get("path_id");if(t){var a=this.PathesSegmentsForEdit.find((e=>e.PathID==t)),o=a.EndPtIndex+"_"+a.StartPtIndex,n=this.PathesSegmentsForEdit.find((e=>e.PathID==o));this.IsPathEditing=!0,this.SelectedPathData=a,this.HandlePathTbRowClick(a),n?(this.ShowPathSelectDialog=!0,this.PathesCandicats=[a,n]):(this.HandlePathTbRowClick(a),this.$refs["path_editor"].Show(a))}},HandlePathSelected(e){this.IsPathEditing=!0,this.ShowPathSelectDialog=!1,this.SelectedPathData=e,setTimeout((()=>{this.HandlePathTbRowClick(e)}),1e3),this.$refs["path_editor"].Show(e)},HandlePathSetingDrawerClosed(e){this.IsPathEditing=!1,this.selected_path_feature&&this.RestoreOriginalPathStyle(this.selected_path_feature)},HandleForbidRegionEditDrawerClosed(){document.addEventListener("keydown",this.EditModeKeybordEvents)},SetPathesAsBeControledStyle(){var e=Object.keys(this.ControledPathesBySystem);if(0!=e.length){var t=this.PathLayerForCoordination.getSource();e.forEach((e=>{var a=t.getFeatures().find((t=>t.get("path_id")==e));if(a){var o=a.getStyle(),n=o[0].getStroke();n&&(n.setColor("orange"),o[0].setStroke(n),a.setStyle(o))}})),this.map.render()}},ChangeToSelectAGVMode(){this.RestoredFillColorOfChangedFeature(),this.ChangeFeaturesAsIgnoreStyle(this.StationPointsFeatures,"rgb(222, 222, 222)"),this.IsSelectAGVMode=!0,this.IsSelectEQStationMode=!1,this.AGVLocLayer.setVisible(!0)},ChangeToSelectEQStationMode(){"source"==this.TaskDispatchOptions.direction&&(this.RestoredFillColorOfChangedFeature(),this.TransferTaskIconLayer.getSource().clear());var e=this.StationPointsFeatures.filter((e=>e.get("data").IsCharge)),t=this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge)),a=this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge&&0!=e.get("data").StationType)),o=this.StationPointsFeatures.filter((e=>0==e.get("data").StationType));if(this.AGVLocLayer.setVisible(!1),this.RestoredFillColorOfChangedFeature(),this.ChangeFeaturesAsIgnoreStyle(this.AGVMapFeatures),"charge"==this.TaskDispatchOptions.action_type)this.ChangeFeaturesAsIgnoreStyle(t),console.info(e),this.ChangeFeaturesAsCandicatingStyle(e);else{this.ChangeFeaturesAsIgnoreStyle(e);var n="move"==this.TaskDispatchOptions.action_type,i="load"==this.TaskDispatchOptions.action_type,s="unload"==this.TaskDispatchOptions.action_type,r="charge"==this.TaskDispatchOptions.action_type,l=(this.TaskDispatchOptions.action_type,"destine"==this.TaskDispatchOptions.direction);if(this.TaskDispatchOptions.stations_to_show&&0!=this.TaskDispatchOptions.stations_to_show.length){var d=this.TaskDispatchOptions.stations_to_show.map((e=>e.tag)),c=this.StationPointsFeatures.filter((e=>!d.includes(e.get("data").TagNumber))),m=this.StationPointsFeatures.filter((e=>d.includes(e.get("data").TagNumber)));this.ChangeFeaturesAsIgnoreStyle(c),this.ChangeFeaturesAsCandicatingStyle(m)}else l&&(n?this.ChangeFeaturesAsIgnoreStyle(a):s||i?(this.ChangeFeaturesAsIgnoreStyle(e),this.ChangeFeaturesAsIgnoreStyle(o)):r?(this.ChangeFeaturesAsIgnoreStyle(a),this.ChangeFeaturesAsIgnoreStyle(o)):this.ChangeFeaturesAsIgnoreStyle(this.StationPointsFeatures))}this.IsSelectAGVMode=!1,this.IsSelectEQStationMode=!0},ChangeToNormalViewMode(){this.AGVLocLayer.setVisible(!0),this.RestoredFillColorOfChangedFeature(),this.IsSelectAGVMode=this.IsSelectEQStationMode=!1,this.TransferTaskIconLayer.getSource().clear()},RestoredFillColorOfChangedFeature(){this.StationPointsFeatures.forEach((e=>{e.get("oriStyle")&&e.setStyle(e.get("oriStyle"))})),this.AGVLocLayer.getSource().getFeatures().forEach((e=>{e.get("oriStyle")&&e.setStyle(e.get("oriStyle"))}))},ChangeFeaturesAsIgnoreStyle(e,t="rgb(222, 222, 222)"){e.forEach((e=>{e.set("isSelectable",!1);var a=e.getStyle();if(a){e.set("oriStyle",a);try{var o=a.clone(),n=o.getImage();if(n){var i=n.clone();i.setOpacity(.5),o.setImage(i)}var s=o.getText();if(s){var r=s.getFill();if(r){var l=r.clone();l.setColor(t),s.setFill(l),e.setStyle(o)}}}catch{}}}))},ChangeFeaturesAsCandicatingStyle(e,t="rgb(222,180,9)"){e.forEach((e=>{var a=e.getStyle();if(a){e.set("oriStyle",a);try{var o=a.clone(),n=o.getImage();if(n){var i=n.clone();i.setScale(.7),o.setImage(i)}var s=o.getText();if(s){s.setFont("bold 18px Calibri,sans-serif");var r=s.getFill();if(r){var l=r.clone();l.setColor(t),s.setFill(l),e.setStyle(o)}}}catch(d){console.info(d)}}}))},CreateDestineMarkIcon(e){if(!this.editable){var t=()=>{var e={move:"目的地",carry:"搬運終點",load:"目標放貨設備",unload:"目標取貨設備",charge:"目標充電站"};return e[this.TaskDispatchOptions.action_type]};if("carry"!=this.TaskDispatchOptions.action_type)this.TransferTaskIconLayer.getSource().clear();else{var a=this.TransferTaskIconLayer.getSource().getFeatures();this.TransferTaskIconLayer.getSource().removeFeature(a[1])}this.AddMarkIconWithText(e,t())}},AddMarkIconWithText(e,t){var a=this.StationPointsFeatures.find((t=>t.get("data").TagNumber==e));if(a){var o=a.getGeometry().getCoordinates(),n=this.TransferTaskIconLayer.getSource(),i=(0,te.Be)(o,t);n.addFeature(i)}}},mounted(){this.editable&&(this.RemoveKeyboardPressEventListener(),document.addEventListener("keydown",this.EditModeKeybordEvents)),this.loading=!0,setTimeout((()=>{var e=document.getElementById("map");e&&e.addEventListener("contextmenu",(function(e){e.preventDefault()})),ae.p.dispatch("DownloadMapData").then((()=>{this.RestoreSettingsFromLocalStorage(),this.DeepClonePathSegmentData(),this.InitMap(),this.AddEditMapInteraction(),(0,o.watch)((()=>this.map_station_data),((e,t)=>{e&&this.RefreshMap()}),{deep:!0,immediate:!0}),this.eq_lduld_status_show&&this.watch_eq_data_changed(),(0,o.watch)((()=>this.agvs_info),((e,t)=>{e&&this.UpdateAGVLayer()}),{deep:!0,immediate:!0}),ee.Z.on("/show_agv_at_center",(e=>{this.ResetMapCenterViaAGVLoc(e)})),(0,o.watch)((()=>this.agv_upload_coordi_data),((e={},t)=>{this.agv_upload_coordination_mode&&this.HandleAGVUploadData(e)}),{deep:!0,immediate:!0}),ee.Z.on("change_to_select_agv_mode",(()=>{this.editable||this.ChangeToSelectAGVMode()})),ee.Z.on("change_to_select_eq_station_mode",(e=>{this.editable||(this.TaskDispatchOptions=JSON.parse(JSON.stringify(e)),console.info("TaskDispatchOptions:",this.TaskDispatchOptions),this.ChangeToSelectEQStationMode())})),ee.Z.on("change_to_normal_view_mode",(()=>{this.editable||this.ChangeToNormalViewMode()})),ee.Z.on("mark_as_start_station",(e=>{this.editable||(this.TransferTaskIconLayer.getSource().clear(),this.AddMarkIconWithText(e,"搬運起點"))})),ee.Z.on("mark_as_destine_station",(e=>{this.CreateDestineMarkIcon(e)})),document.getElementById(this.id).addEventListener("contextmenu",(e=>{e.preventDefault()})),setTimeout((()=>{this.UpdateAGVLocLocation()}),500),this.loading=!1}))}),1e3)}};const Ye=(0,ue.Z)(je,[["render",F],["__scopeId","data-v-36f2c068"]]);var Ke=Ye},90633:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var o=a(79003);function n(e,t,a,n,i,s){const r=(0,o.resolveComponent)("el-option"),l=(0,o.resolveComponent)("el-select");return(0,o.openBlock)(),(0,o.createBlock)(l,{style:{width:"120px"},modelValue:i.selectedRegion,"onUpdate:modelValue":t[0]||(t[0]=e=>i.selectedRegion=e),onChange:s.handleChange},{default:(0,o.withCtx)((()=>[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(i.valid_map_regions_options,(e=>((0,o.openBlock)(),(0,o.createBlock)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])}var i=a(95320),s=a(83592),r={props:{default:{type:String}},data(){return{selectedRegion:this.default,valid_map_regions_options:[]}},methods:{handleChange(e){this.selectedRegion=e,this.$emit("input",e)}},mounted(){setTimeout((async()=>{this.valid_map_regions_options=i.p.getters.RegionOptions,this.valid_map_regions_options||(this.valid_map_regions_options=await(0,s.j2)()),this.valid_map_regions_options.unshift({label:"不分區",value:"all"})}),10)}},l=a(40089);const d=(0,l.Z)(r,[["render",n]]);var c=d},19594:function(e){"use strict";e.exports=JSON.parse('{"test":"TEST","initialize":"Initialize","reset_alarm":"Reset Alarm","buzzer_off":"Buzzer Off","cst-remove":"Remove CST","connection-states":"Connect Status","battery-level":"Battery Level","mileage":"Mileage","status":"Status","abnormal-record":"Abnormal Record","operation":"Operation","3d_model":"3D Model","Status_info":"Status Info","current_position":"Current Position","target_position":"Target Position","action_name":"Action Name","abormal":"Abnormal","carrier_id":"Carrier ID","agv_control":"AGV Control","zaxis_up_down":"Z-Axis Control","agv_control_notify_text":"Please log in and switch to Offline & Manual mode before operating the vehicle manually.","zaxis_control_notify_text":"Please log in and switch to Offline & Manual mode before operating the Z-axis and bypassing the Hardware Limited setting.","up_limit_pose":"UP Limit Position","down_limit_pose":"DOWN Limit Position","up":"UP","down":"DOWN","original":"ORIGINAL","stop":"Stop","cancel_init_action_notify":"Are you sure you want to cancel the initialization process?","start_init_action_notify":"Do you confirm to proceed with the initialization process? Once the initialization process starts, the Fork will descend. Please ensure that there are no goods on the Fork and check for any obstacles around the AGV.","charging_current":"Charging Current","wait_online_text":"AGV Online Process is running, Please wait...","refresh":"Refresh","clear_alarm_records":"Clear"}')},46687:function(e){"use strict";e.exports=JSON.parse('{"test":"測試","initialize":"初始化","reset_alarm":"異常排除","buzzer_off":"蜂鳴器關閉","cst-remove":"移除卡匣","login":"登入","connection-states":"連線狀態","battery-level":"電量","mileage":"里程數","status":"狀態","abnormal-record":"異常紀錄","operation":"操作","3d_model":"3D 模型","Status_info":"狀態資訊","current_position":"目前位置","target_position":"目標位置","action_name":"動作名稱","abormal":"異常","carrier_id":"載物ID","agv_control":"車控","zaxis_up_down":"升降","agv_control_notify_text":"請先登入權限並Offline&Manual才可操作手動控車","zaxis_control_notify_text":"請先登入權限並Offline&Manual才可操作Z軸與by pass Hardware Limited設定","up_limit_pose":"上點位","down_limit_pose":"下點位","up":"上升","down":"下降","original":"原點","stop":"停止","cancel_init_action_notify":"確定要取消初始化動作?","start_init_action_notify":"確定要進行初始化動作? 初始化動作開始後 Fork 將會下降,請確認 Fork上有無貨物，並確認 AGV 周圍無障礙物","charging_current":"充電電流","wait_online_text":"AGV正在執行上線請求，請稍後...","refresh":"重新整理","clear_alarm_records":"清除異常紀錄"}')}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=e,function(){var e=[];a.O=function(t,o,n,i){if(!o){var s=1/0;for(c=0;c<e.length;c++){o=e[c][0],n=e[c][1],i=e[c][2];for(var r=!0,l=0;l<o.length;l++)(!1&i||s>=i)&&Object.keys(a.O).every((function(e){return a.O[e](o[l])}))?o.splice(l--,1):(r=!1,i<s&&(s=i));if(r){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[o,n,i]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};a.t=function(o,n){if(1&n&&(o=this(o)),8&n)return o;if("object"===typeof o&&o){if(4&n&&o.__esModule)return o;if(16&n&&"function"===typeof o.then)return o}var i=Object.create(null);a.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var r=2&n&&o;"object"==typeof r&&!~e.indexOf(r);r=t(r))Object.getOwnPropertyNames(r).forEach((function(e){s[e]=function(){return o[e]}}));return s["default"]=function(){return o},a.d(i,s),i}}(),function(){a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,o){return a.f[o](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+e+"."+{93:"fa0eb4da",142:"ecaee98a",155:"aa0468e0",166:"cc038866",181:"543992b0",188:"84a7d618",306:"be10f586",431:"b4d99585",522:"42121ef6",655:"3289af03",740:"9ac80e21",757:"69d74930",858:"76268a6e",891:"01690a7d",895:"7a461dc1",897:"1983a264"}[e]+".js"}}(),function(){a.miniCssF=function(e){return"css/"+e+"."+{188:"18befd40",655:"b8f27f64",740:"6d966e71"}[e]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="gpm_agvs:";a.l=function(o,n,i,s){if(e[o])e[o].push(n);else{var r,l;if(void 0!==i)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var m=d[c];if(m.getAttribute("src")==o||m.getAttribute("data-webpack")==t+i){r=m;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,a.nc&&r.setAttribute("nonce",a.nc),r.setAttribute("data-webpack",t+i),r.src=o),e[o]=[n];var u=function(t,a){r.onerror=r.onload=null,clearTimeout(h);var n=e[o];if(delete e[o],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach((function(e){return e(a)})),t)return t(a)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=u.bind(null,r.onerror),r.onload=u.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){a.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,o,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var s=function(a){if(i.onerror=i.onload=null,"load"===a.type)o();else{var s=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=s,l.request=r,i.parentNode&&i.parentNode.removeChild(i),n(l)}};return i.onerror=i.onload=s,i.href=t,a?a.parentNode.insertBefore(i,a.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var a=document.getElementsByTagName("link"),o=0;o<a.length;o++){var n=a[o],i=n.getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(i===e||i===t))return n}var s=document.getElementsByTagName("style");for(o=0;o<s.length;o++){n=s[o],i=n.getAttribute("data-href");if(i===e||i===t)return n}},o=function(o){return new Promise((function(n,i){var s=a.miniCssF(o),r=a.p+s;if(t(s,r))return n();e(o,r,null,n,i)}))},n={143:0};a.f.miniCss=function(e,t){var a={188:1,655:1,740:1};n[e]?t.push(n[e]):0!==n[e]&&a[e]&&t.push(n[e]=o(e).then((function(){n[e]=0}),(function(t){throw delete n[e],t})))}}}(),function(){var e={143:0};a.f.j=function(t,o){var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var i=new Promise((function(a,o){n=e[t]=[a,o]}));o.push(n[2]=i);var s=a.p+a.u(t),r=new Error,l=function(o){if(a.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var i=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;r.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",r.name="ChunkLoadError",r.type=i,r.request=s,n[1](r)}};a.l(s,l,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,i,s=o[0],r=o[1],l=o[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(l)var c=l(a)}for(t&&t(o);d<s.length;d++)i=s[d],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(c)},o=self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=a.O(void 0,[998],(function(){return a(4239)}));o=a.O(o)})();
//# sourceMappingURL=app.15ea4952.js.map