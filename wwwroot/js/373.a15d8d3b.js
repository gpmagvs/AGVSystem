"use strict";(self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[]).push([[373],{59373:function(e,t,a){a.r(t),a.d(t,{default:function(){return H}});var l=a(66252);const i={class:"agv_show_on_map_design h-100"};function o(e,t,a,o,s,r){const n=(0,l.up)("AGVDrawSetting"),p=(0,l.up)("el-main"),u=(0,l.up)("el-container");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(u,{class:"h-100"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{class:"bg-light p-2"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.agvNameList,(e=>((0,l.wg)(),(0,l.j4)(n,{key:e,agv_name:e},null,8,["agv_name"])))),128))])),_:1})])),_:1})])}var s=a(3577);const r=e=>((0,l.dD)("data-v-2bebb7c1"),e=e(),(0,l.Cn)(),e),n={class:"agv_draw_setting"},p={class:"agv-id w-100 border-bottom mb-1 text-start text-primary"},u={class:"w-100 d-flex flex-row"},g={class:""},m=r((()=>(0,l._)("div",{class:"text-start text-primary mb-3"},"Preview",-1))),d=["id"];function c(e,t,a,i,o,r){const c=(0,l.up)("el-input"),h=(0,l.up)("el-form-item"),w=(0,l.up)("el-color-picker"),v=(0,l.up)("ImageUploadButtonVue"),f=(0,l.up)("el-form"),_=(0,l.up)("el-checkbox"),y=(0,l.up)("el-aside"),C=(0,l.up)("el-main"),F=(0,l.up)("el-container");return(0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(F,{class:"h-100"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{class:"properties-setting-container border bg-light",width:"50%"},{default:(0,l.w5)((()=>[(0,l._)("div",p,(0,s.zw)(a.agv_name),1),(0,l._)("div",u,[(0,l.Wm)(f,{"label-width":"80","label-position":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{label:"顯示名稱"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{type:"text",size:"small",modelValue:o.props.DisplayText,"onUpdate:modelValue":t[0]||(t[0]=e=>o.props.DisplayText=e),onInput:t[1]||(t[1]=e=>{r.ChangeTextOfAGV(e)})},null,8,["modelValue"])])),_:1}),(0,l.Wm)(h,{label:"顏色"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{modelValue:o.props.DisplayColor,"onUpdate:modelValue":t[2]||(t[2]=e=>o.props.DisplayColor=e),onActiveChange:r.HandleAGVColorClicked},null,8,["modelValue","onActiveChange"])])),_:1}),(0,l.Wm)(h,{label:"ICON"},{default:(0,l.w5)((()=>[(0,l._)("div",g,[(0,l.Wm)(v,{backendUrl:r.iconUploadAPIEndPoint,onOnFileUploaded:r.HandleImageUploaded},null,8,["backendUrl","onOnFileUploaded"])])])),_:1})])),_:1}),(0,l.Wm)(f,{class:"mx-3","label-width":"120","label-position":"left"},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{label:"顯示貨物狀態"},{default:(0,l.w5)((()=>[(0,l.Wm)(_)])),_:1}),(0,l.Wm)(h,{label:"貨物-[框]圖示"}),(0,l.Wm)(h,{label:"貨物-[Tray]圖示"})])),_:1})])])),_:1}),(0,l.Wm)(C,{class:"border p-1",style:{"overflow-y":"hidden"}},{default:(0,l.w5)((()=>[m,(0,l._)("div",{id:r.map_id,class:"agv-preview-map border w-100",style:{height:"200px"}},null,8,d)])),_:1})])),_:1})])}var h=a(6729),w=a(29619),v=a(12327),f=a(74818),_=a(33376),y=a(81090),C=a(60188),F=a(79072),b=a(69242),x=a(57276),S=a(47539),k=a(51345),U=a(58958),V=a(95320),Z=a(24239),T=a(53259);const D={class:"image-upload-button"},A={key:1,class:"image-preview"},I=["src"];function B(e,t,a,i,o,r){const n=(0,l.up)("el-button");return(0,l.wg)(),(0,l.iD)("div",D,[(0,l.Wm)(n,{size:"small",type:"button",onClick:r.triggerFileInput},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(a.buttonText),1)])),_:1},8,["onClick"]),null!=o.imageFile?((0,l.wg)(),(0,l.j4)(n,{key:0,size:"small",type:"button",onClick:r.uploadToServer},{default:(0,l.w5)((()=>[(0,l.Uk)("確認上傳")])),_:1},8,["onClick"])):(0,l.kq)("",!0),(0,l._)("input",{type:"file",ref:"fileInput",onChange:t[0]||(t[0]=(...e)=>r.handleFileChange&&r.handleFileChange(...e)),accept:"image/*",style:{display:"none"}},null,544),o.imageUrl&&a.showPreview?((0,l.wg)(),(0,l.iD)("div",A,[(0,l._)("img",{src:o.imageUrl,alt:"Image preview"},null,8,I),(0,l._)("p",null,"图片路径: "+(0,s.zw)(o.imageUrl),1)])):(0,l.kq)("",!0)])}a(62062);var G={props:{showPreview:{type:Boolean,default:!1},buttonText:{type:String,default:"選擇圖片"},backendUrl:{type:String,default:"BACKEND_URL"}},data(){return{imageFile:null,imageUrl:null}},methods:{triggerFileInput(){this.imageFile=null,this.imageUrl=null,this.$refs.fileInput.click()},handleFileChange(e){this.imageFile=e.target.files[0],this.imageFile&&(this.imageUrl=URL.createObjectURL(this.imageFile),this.$emit("OnFileUploaded",{imageFile:this.imageFile,imageUrl:this.imageUrl}))},async uploadToServer(){if(!this.imageFile)return void this.$swal.fire({text:"",title:"請先選擇圖檔",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});const e=new FormData;e.append("image",this.imageFile);try{const t=await fetch(this.backendUrl,{method:"POST",body:e});t.ok?this.$swal.fire({text:"",title:"上傳成功",icon:"info",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):(console.log(t),this.$swal.fire({text:`${t.url} : ${t.status}-${t.statusText}`,title:"上傳失敗",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}))}catch(t){console.error("上传错误:",t),this.$swal.fire({text:"",title:"上傳過程中發生錯誤",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}}}},O=a(83744);const W=(0,O.Z)(G,[["render",B]]);var $=W,P=a(663),L={components:{ImageUploadButtonVue:$},data(){return{map:void 0,agv_feature:void 0,_agvBodyFeature:void 0,_agvSaftyRegionFeature:void 0,props:new F.MV,imageFile:null,imageUrl:null}},props:{agv_name:{type:String,default:"AGV_001"},raw_props:{type:F.MV,default(){var e=new F.MV;return e}}},computed:{map_id(){return"map-agv-preview-"+this.agv_name},featureStyle(){return this.agv_feature.getStyle()},iconUploadAPIEndPoint(){return`${P.Z.backend_host}/api/Map/AGVIconUpload?AGVName=${this.agv_name}`}},methods:{MapInit(){const e=new w.Z({code:"xkcd-image",units:"pixels",extent:[-20,-20,20,20]});this.agv_feature=new y.Z({geometry:new C.Z([0,0])}),this.agv_feature.setStyle((0,F.K$)(this.raw_props.DisplayText,this.raw_props.DisplayColor,"/AGVImages/"+this.agv_name+"-Icon.png"));const t=new b.ZP([[[-3,4],[3,4],[3,-4],[-3,-4]]]);this._agvBodyFeature=new y.Z(t),this._agvBodyFeature.setStyle(new S.ZP({fill:new k.Z({color:(0,F.xZ)(this.raw_props.DisplayColor,.6)}),stroke:new U.Z({color:"black",width:1})}));const a=new x.Z([0,0],5);this._agvSaftyRegionFeature=new y.Z(a);const l=(0,F.xZ)(this.raw_props.DisplayColor,.2);this._agvSaftyRegionFeature.setStyle(new S.ZP({fill:new k.Z({color:l}),stroke:new U.Z({color:l,width:1,lineDash:[5,2]})}));const i=new f.Z({source:new _.Z({features:[this.agv_feature,this._agvBodyFeature,this._agvSaftyRegionFeature]}),zIndex:2});this.map=new h.Z({layers:[i],target:this.map_id,view:new v.ZP({projection:e,center:[0,0],zoom:1,maxZoom:20})})},HandleAGVColorClicked(e){this.props.DisplayColor=e,this.ChangeColorOfAGV(e)},HandleAGVColorSelected(e){alert(e)},ChangeColorOfAGV(e){this.SetFeatureFillColor(this.agv_feature,e,!0),this.SetFeatureFillColor(this._agvBodyFeature,(0,F.xZ)(e,.4)),this.SetFeatureFillColor(this._agvSaftyRegionFeature,(0,F.xZ)(e,.2)),this.SaveToLocalStorage(!0)},ChangeTextOfAGV(e){var t=this.agv_feature.getStyle(),a=t.getText();a.setText(e),this.agv_feature.setStyle(t),this.SaveToLocalStorage()},SetFeatureFillColor(e,t,a=!1){var l=e.getStyle();if(a){var i=l.getText(),o=i.getBackgroundFill();o.setColor(t),i.setBackgroundFill(o)}else{o=l.getFill();o.setColor(t),l.setFill(o)}e.setStyle(l)},SaveToLocalStorage(e=!1){V.p.commit("SaveAGVStyle",{agvname:this.agv_name,style:this.props}),e&&setTimeout((()=>{T.Z.emit("/rerender_agv_layer")}),500)},HandleImageUploaded(e){console.info(e),this.imageFile=e.imageFile;var t=new Image;t.onload=()=>{var a=[t.width,t.height];this.agv_feature.setStyle((0,F.K$)(this.raw_props.DisplayText,this.raw_props.DisplayColor,e.imageUrl,a))},t.src=e.imageUrl}},mounted(){this.MapInit();var e=V.p.getters.CustomAGVStyles;e[this.agv_name]?this.props=e[this.agv_name]:this.props=JSON.parse(JSON.stringify(this.raw_props)),this.ChangeTextOfAGV(this.props.DisplayText),this.ChangeColorOfAGV(this.props.DisplayColor)}};const z=(0,O.Z)(L,[["render",c],["__scopeId","data-v-2bebb7c1"]]);var K=z,N={components:{AGVDrawSetting:K},methods:{SaveSetting(){}},computed:{agvNameList(){return Z.sn.getters.AGVNameList}}};const R=(0,O.Z)(N,[["render",o]]);var H=R}}]);
//# sourceMappingURL=373.a15d8d3b.js.map