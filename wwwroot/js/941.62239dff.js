"use strict";(self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[]).push([[941],{47941:function(e,t,s){s.r(t),s.d(t,{default:function(){return Ce}});var r=s(66252),o=s(3577);const a={class:"rack-status-view custom-tabs-head p-1"},i={class:"display-mode-container text-start border-bottom my-1 py-1"},n=(0,r._)("span",{class:"px-2 text-primary"},[(0,r._)("b",null,"顯示方式")],-1),l={class:"d-flex flex-row"},c={class:"flex-fill p-2"},p={class:"d-flex flex-row flex-no-wrap w-100 overflow-auto"},u={key:1},d={class:"bg-dark text-light"},_={class:"d-flex flex-row"},m={class:"flex-fill"},f={class:"d-flex flex-row flex-no-wrap overflow-auto"};function y(e,t,s,y,k,w){const v=(0,r.up)("el-option"),g=(0,r.up)("el-select"),C=(0,r.up)("el-badge"),x=(0,r.up)("el-progress"),h=(0,r.up)("RackStatus"),S=(0,r.up)("b-tab"),D=(0,r.up)("b-tabs");return(0,r.wg)(),(0,r.iD)("div",a,[(0,r._)("div",i,[n,(0,r.Wm)(g,{class:"mx-2",modelValue:k.display,"onUpdate:modelValue":t[0]||(t[0]=e=>k.display=e),style:{width:"120px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(v,{label:"分頁顯示",value:"tabs"}),(0,r.Wm)(v,{label:"單頁顯示",value:"div"})])),_:1},8,["modelValue"])]),"tabs"==k.display?((0,r.wg)(),(0,r.j4)(D,{key:0},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(w.GroupedWipData,(t=>((0,r.wg)(),(0,r.j4)(S,{key:t.zoneName},{title:(0,r.w5)((()=>[(0,r._)("span",null,(0,o.zw)(t.zoneName),1),(0,r.Wm)(C,{class:"mx-2",type:"warning",value:w.IsHasDataButNoCargo(t.zoneName)?"!":""},null,8,["value"])])),default:(0,r.w5)((()=>[(0,r._)("div",l,[(0,r._)("b",null,(0,o.zw)(e.$t("Rack.Cargo_Spaces")),1),(0,r._)("div",c,[(0,r.Wm)(x,{"stroke-width":18,percentage:t.level,"text-inside":"",striped:"","striped-flow":"",duration:500},{default:(0,r.w5)((()=>[(0,r._)("span",null,(0,o.zw)(t.hasCstPortNum)+"/"+(0,o.zw)(t.totalPorts),1)])),_:2},1032,["percentage"])])]),(0,r._)("div",p,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.zones,(e=>((0,r.wg)(),(0,r.iD)("div",{key:e.WIPName},[(0,r.Wm)(h,{rack_info:e,showLevel:!1},null,8,["rack_info"])])))),128))])])),_:2},1024)))),128))])),_:1})):((0,r.wg)(),(0,r.iD)("div",u,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(w.GroupedWipData,(t=>((0,r.wg)(),(0,r.iD)("div",{key:t.zoneName,class:"my-2 border"},[(0,r._)("h3",d,(0,o.zw)(t.zoneName),1),(0,r._)("div",_,[(0,r._)("b",null,(0,o.zw)(e.$t("Rack.Cargo_Spaces")),1),(0,r._)("div",m,[(0,r.Wm)(x,{"stroke-width":18,percentage:t.level,"text-inside":"",striped:"","striped-flow":"",duration:500},{default:(0,r.w5)((()=>[(0,r._)("span",null,(0,o.zw)(t.hasCstPortNum)+"/"+(0,o.zw)(t.totalPorts),1)])),_:2},1032,["percentage"])])]),(0,r._)("div",f,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.zones,(e=>((0,r.wg)(),(0,r.iD)("div",{key:e.WIPName},[(0,r.Wm)(h,{rack_info:e,showLevel:!1},null,8,["rack_info"])])))),128))])])))),128))]))])}const k={class:"rack-status m-0 p-1"},w={class:"my-1 d-flex flex-row bg-light"},v={class:"w-50 text-start px-2"},g={key:0,class:"p-1"},C={key:1,class:"flex-fill p-2"},x={class:"ports-container"};function h(e,t,s,a,i,n){const l=(0,r.up)("el-progress"),c=(0,r.up)("RackPort");return(0,r.wg)(),(0,r.iD)("div",k,[(0,r._)("div",w,[(0,r._)("h3",v,(0,o.zw)(s.rack_info.WIPName),1),s.showLevel?((0,r.wg)(),(0,r.iD)("div",g,[(0,r._)("b",null,(0,o.zw)(e.$t("Rack.Cargo_Spaces")),1)])):(0,r.kq)("",!0),s.showLevel?((0,r.wg)(),(0,r.iD)("div",C,[(0,r.Wm)(l,{"stroke-width":18,percentage:n.Level,"text-inside":"",striped:"","striped-flow":"",duration:40},{default:(0,r.w5)((()=>[(0,r._)("span",null,(0,o.zw)(this.HasCstPortNum)+"/"+(0,o.zw)(this.TotalPorts),1)])),_:1},8,["percentage"])])):(0,r.kq)("",!0)]),(0,r._)("div",x,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(n.RowsArray(s.rack_info.Rows),(e=>((0,r.wg)(),(0,r.iD)("div",{class:"d-flex flex-row",key:"row-"+e},[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.rack_info.Columns,(t=>((0,r.wg)(),(0,r.iD)("div",{class:"d-flex flex-column",key:"col-"+t},[(0,r.Wm)(c,{rack_name:s.rack_info.WIPName,port_info:n.GetPortByColRow(t-1,e-1),IsOvenAsRacks:s.rack_info.IsOvenAsRacks},null,8,["rack_name","port_info","IsOvenAsRacks"])])))),128))])))),128))])])}s(57658);var S=s(49963);const D=e=>((0,r.dD)("data-v-73b67b69"),e=e(),(0,r.Cn)(),e),b={class:"bg-light border-bottom d-flex py-1"},P={class:"flex-fill text-start px-1"},I={class:"port-no-display"},R={class:"text-danger bg-light w-100 text-start",style:{"max-height":"0",position:"relative",left:"3px",top:"0px"}},T=D((()=>(0,r._)("i",{class:"bi bi-exclamation"},null,-1))),E={key:0,class:"px-2"},O={key:1},z={key:0,class:"text-danger"},N={class:"item"},A=D((()=>(0,r._)("div",{class:"title"},"Carrier ID",-1))),W={class:"values d-flex"},H={key:0,class:"item"},$=D((()=>(0,r._)("div",{class:"title"},"Exist Sensor(Tray)",-1))),B={class:"values d-flex"},U={key:1,class:"item"},K=D((()=>(0,r._)("div",{class:"title"},"Exist Sensor(Rack)",-1))),F={class:"values d-flex"},j={key:2,class:"item"},L=D((()=>(0,r._)("div",{class:"title"},"Tray Direction",-1))),Y={class:"values d-flex"},q={key:3,class:"item"},M=D((()=>(0,r._)("div",{class:"title"},"貨物在席",-1))),G={class:"values"},V={key:4,class:"item"},Z=D((()=>(0,r._)("div",{class:"title"},"空/實框",-1))),Q={class:"values"},J={class:"item"},X=D((()=>(0,r._)("div",{class:"title"},"Install Time",-1))),ee={class:"values"},te={class:"item justify-content-center"},se={key:0,class:"w-100 d-flex justify-content-center"};function re(e,t,s,a,i,n){const l=(0,r.up)("el-switch"),c=(0,r.up)("el-tag"),p=(0,r.up)("el-tooltip"),u=(0,r.up)("el-radio-button"),d=(0,r.up)("el-radio-group"),_=((0,r.up)("el-input"),(0,r.up)("el-button"));return(0,r.wg)(),(0,r.iD)("div",{class:(0,o.C_)(["rack-port",[n.ProductQualityClassName,n.UsableStateClass]])},[(0,r._)("div",b,[(0,r._)("span",P,[(0,r._)("label",I,(0,o.zw)(n.PortNameDisplay),1)]),(0,r.wy)((0,r._)("div",R,[T,(0,r.Uk)(" "+(0,o.zw)(e.$t("Rack.Sensor_Flash")),1)],512),[[S.F8,n.AnySensorFlash]]),n.IsUserLoginAndPermissionAboveOP?((0,r.wg)(),(0,r.iD)("div",E,[(0,r.Wm)(l,{"active-text":"啟用","inactive-text":"禁用","active-value":1,"inactive-value":0,"inactive-color":"rgb(146, 148, 153)",modelValue:s.port_info.Properties.PortUsable,"onUpdate:modelValue":t[0]||(t[0]=e=>s.port_info.Properties.PortUsable=e),"before-change":n.HandlePortUsableSwitchClicked},null,8,["modelValue","before-change"])])):((0,r.wg)(),(0,r.iD)("div",O,[0==s.port_info.Properties.PortUsable?((0,r.wg)(),(0,r.iD)("span",z,"已禁用")):(0,r.kq)("",!0)]))]),(0,r._)("div",N,[A,(0,r._)("div",W,[(0,r.Wm)(c,{size:"large",effect:"dark",type:""==s.port_info.CarrierID?"info":"primary",style:{width:"135px","font-weight":"bold","letter-spacing":"3px"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(s.port_info.CarrierID),1)])),_:1},8,["type"]),(0,r.Wm)(p,{placement:"top-start",content:e.$t("Rack.copy")},{default:(0,r.w5)((()=>[""!=s.port_info.CarrierID?((0,r.wg)(),(0,r.iD)("i",{key:0,onClick:t[1]||(t[1]=e=>n.CopyText(s.port_info.CarrierID)),class:"copy-button copy-icon bi bi-clipboard"})):(0,r.kq)("",!0)])),_:1},8,["content"])])]),s.IsOvenAsRacks||!s.port_info.Properties.HasTraySensor||2!=s.port_info.Properties.CargoTypeStore&&0!=s.port_info.Properties.CargoTypeStore?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",H,[$,(0,r._)("div",B,[(0,r._)("div",{class:"exist-sensor round my-1",style:(0,o.j5)(n.ExistSensorTray_1?i.ExistSensorOnStyle:i.ExistSensorOFFStyle),onClick:t[2]||(t[2]=e=>n.HandleExistSensorStateClick("tray",0))},null,4),(0,r._)("div",{class:"exist-sensor round my-1 mx-3",style:(0,o.j5)(n.ExistSensorTray_2?i.ExistSensorOnStyle:i.ExistSensorOFFStyle),onClick:t[3]||(t[3]=e=>n.HandleExistSensorStateClick("tray",1))},null,4)])])),s.IsOvenAsRacks||!s.port_info.Properties.HasRackSensor||2!=s.port_info.Properties.CargoTypeStore&&1!=s.port_info.Properties.CargoTypeStore?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",U,[K,(0,r._)("div",F,[(0,r._)("div",{class:"exist-sensor round my-1",style:(0,o.j5)(n.ExistSensorRack_1?i.ExistSensorOnStyle:i.ExistSensorOFFStyle),onClick:t[4]||(t[4]=e=>n.HandleExistSensorStateClick("rack",0))},null,4),(0,r._)("div",{class:"exist-sensor round my-1 mx-3",style:(0,o.j5)(n.ExistSensorRack_2?i.ExistSensorOnStyle:i.ExistSensorOFFStyle),onClick:t[5]||(t[5]=e=>n.HandleExistSensorStateClick("rack",1))},null,4)])])),s.IsOvenAsRacks||!s.port_info.Properties.HasTrayDirectionSensor||2!=s.port_info.Properties.CargoTypeStore&&1!=s.port_info.Properties.CargoTypeStore?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",j,[L,(0,r._)("div",Y,[(0,r._)("div",{class:"exist-sensor round my-1",style:(0,o.j5)(n.TrayDirectionSensor?i.ExistSensorOnStyle:i.ExistSensorOFFStyle)},null,4)])])),s.IsOvenAsRacks?((0,r.wg)(),(0,r.iD)("div",q,[M,(0,r._)("div",G,[(0,r.Wm)(c,{size:"large",effect:"dark",type:s.port_info.CarrierExist?"success":"danger"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(s.port_info.CarrierExist?"有貨":"無貨"),1)])),_:1},8,["type"])])])):(0,r.kq)("",!0),s.IsOvenAsRacks?((0,r.wg)(),(0,r.iD)("div",V,[Z,(0,r._)("div",Q,[(0,r.Wm)(d,{disabled:i.radioGroupDisable,size:"large",modelValue:s.port_info.RackContentState,"onUpdate:modelValue":t[6]||(t[6]=e=>s.port_info.RackContentState=e),fill:"rgb(8, 87, 60)"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{onClick:n.EmptyContentClick,value:0,label:"空框"},null,8,["onClick"]),(0,r.Wm)(u,{onClick:n.FullContentClick,value:1,label:"實框"},null,8,["onClick"])])),_:1},8,["disabled","modelValue"])])])):(0,r.kq)("",!0),(0,r.kq)("",!0),(0,r._)("div",J,[X,(0,r._)("div",ee,(0,o.zw)(s.port_info.InstallTime),1)]),(0,r._)("div",te,[n.IsCarrierIDExist?((0,r.wg)(),(0,r.iD)("div",se,[(0,r.Wm)(_,{ref:"modify_btn",onClick:n.CstIDEditHandle,type:"success"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.$t("Rack.Edit_ID")),1)])),_:1},8,["onClick"]),(0,r.Wm)(_,{onClick:n.RemoveCSTID,type:"danger"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.$t("Rack.Remove_ID")),1)])),_:1},8,["onClick"])])):((0,r.wg)(),(0,r.j4)(_,{key:1,onClick:n.CstIDEditHandle,class:"m-1",type:"info"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.$t("Rack.Creat_ID")),1)])),_:1},8,["onClick"]))])],2)}var oe=s(42152),ae=s.n(oe),ie=s(10844),ne=s(49996),le=s(69215),ce=s(25044),pe=s(64491),ue=s(53259),de={props:{rack_name:{type:String,default:""},port_info:{type:Object,default(){return{CargoExist:!1,CarrierID:null,SensorStates:{TRAY_1:!1,TRAY_2:!0,RACK_1:!1,RACK_2:!1,TRAY_DIRECTION:!1},InstallTime:"0001-01-01T00:00:00",Properties:{ID:"0-0",Row:0,Column:0,PortNo:"",PortUsable:0,ProductionQualityStore:0,CargoTypeStore:2,IOLocation:{Tray_Sensor1:0,Tray_Sensor2:1,Box_Sensor1:2,Box_Sensor2:3},StoragePriority:0,HasTrayDirectionSensor:!1,HasTraySensor:!0,HasRackSensor:!0},RackPlacementState:0,TrayPlacementState:0}}},IsOvenAsRacks:{type:Boolean,default:!1}},data(){return{ExistSensorOnStyle:{backgroundColor:"lime"},ExistSensorOFFStyle:{backgroundColor:"rgb(180, 183, 191)"},selectedRackContentType:"",radioGroupDisable:!1}},computed:{IsUserLoginAndPermissionAboveOP(){return ce.HP.state.user.Role>0},ProductQualityClassName(){return this.IsOvenAsRacks?"oven-port":this.port_info.CargoExist&&this.port_info.CarrierID?"has-cst-port":!this.port_info.CargoExist&&this.port_info.CarrierID?"has-data-but-no-cargo-port":this.port_info.CargoExist&&!this.port_info.CarrierID?"has-cargo-but-no-cst-port":"empty-port"},UsableStateClass(){return 1==this.port_info.Properties.PortUsable?"port-usable":"port-not-usable"},PortNameDisplay(){return`${this.port_info.PortNo}`},IsCarrierIDExist(){return this.port_info.CarrierID&&""!=this.port_info.CarrierID},ModifyButtonText(){return this.IsCarrierIDExist?"修改帳籍":"新增帳籍"},ExistSensorTray_1(){return 0!=this.port_info.MaterialExistSensorStates["TRAY_1"]},ExistSensorTray_2(){return 0!=this.port_info.MaterialExistSensorStates["TRAY_2"]},ExistSensorRack_1(){return 0!=this.port_info.MaterialExistSensorStates["RACK_1"]},ExistSensorRack_2(){return 0!=this.port_info.MaterialExistSensorStates["RACK_2"]},TrayDirectionSensor(){return 0!=this.port_info.SensorStates["TRAY_DIRECTION"]},AnySensorFlash(){var e=Object.values(this.port_info.MaterialExistSensorStates),t=e.filter((e=>2==e));return 0!=t.length},IsDeveloperLogining(){return ce.HP.getters.IsDeveloperLogining}},methods:{async HandleExistSensorStateClick(e="tray|rack",t=1){if(this.IsDeveloperLogining){var s=await pe.k3.SetSensorState(this.rack_name,this.port_info.Properties.ID,e,t,!1);s.confirm||this.$swal.fire({text:"",title:`${s.message}`,icon:"info",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},CstIDEditHandle(){ie.T.prompt("Carrier ID",{title:`${this.ModifyButtonText} : ${this.PortNameDisplay}`,draggable:!0,inputValue:this.port_info.CarrierID,type:"warning",confirmButtonText:"修改",inputErrorMessage:"帳籍ID不得為空",inputPlaceholder:"請輸入ID",inputValidator:e=>""!=e}).then((async e=>{console.info(e);var t=e.value?e.value:"";let s=await(0,le.m7)(this.rack_name,this.port_info.Properties.ID,t);s.confirm?this.$message({message:"帳籍已修改。",type:"success"}):this.$swal.fire({text:s.message,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})})).catch((()=>{}))},RemoveCSTID(){this.$swal.fire({text:`確定要移除帳籍-[${this.port_info.CarrierID}] ?`,title:"移除帳籍確認",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){let e=await(0,le.pz)(this.rack_name,this.port_info.Properties.ID);e.confirm?this.$message({message:"帳籍已移除。"}):this.$swal.fire({text:e.message,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}}))},CopyText(e){const t=new(ae())(".copy-button",{text:()=>e});t.on("success",(()=>{(0,ne.bM)({title:e,message:"已複製到剪貼簿",duration:1500}),t.destroy()})),t.on("error",(()=>{t.destroy()}))},async EmptyContentClick(){this.radioGroupDisable=!0,await(0,pe.Kz)(this.port_info.TagNumbers[0],!0),await(0,pe.hE)(this.port_info.TagNumbers[0],!1),this.radioGroupDisable=!1},async FullContentClick(){this.radioGroupDisable=!0,await(0,pe.hE)(this.port_info.TagNumbers[0],!0),await(0,pe.Kz)(this.port_info.TagNumbers[0],!1),this.radioGroupDisable=!1},async HandlePortUsableSwitchClicked(){return setTimeout((async()=>{const e=`${this.rack_name}-${this.port_info.PortNo}`,t=1!=this.port_info.Properties.PortUsable,s=await(0,le.Bh)(this.rack_name,this.port_info.Properties.ID,t);s.confirm?(ue.Z.emit("home-reload-request","rack-port-usable-changed"),(0,ne.bM)({title:"成功",message:t?`${e}已啟用`:`${e}已停用`,type:"success",duration:1500})):this.$swal.fire({text:s.message,title:`切換${e} ${t?"啟用":"禁用"}失敗`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}),300),!1}}},_e=s(83744);const me=(0,_e.Z)(de,[["render",re],["__scopeId","data-v-73b67b69"]]);var fe=me,ye={components:{RackPort:fe},methods:{GetPortByColRow(e,t){var s=this.rack_info.Ports;return s.find((s=>s.Properties.Row==t&&s.Properties.Column==e))},RowsArray(e){let t=[];for(var s=e;s>=1;s--)t.push(s);return t}},props:{rack_info:{type:Object,default(){return{WIPName:"Rack-1",Rows:3,Columns:3,ColumnsTagMap:{0:[0],1:[1],2:[2]},Ports:[{CargoExist:!1,CarrierID:null,MaterialExistSensorStates:{TRAY_1:!1,TRAY_2:!0,RACK_1:!1,RACK_2:!1},InstallTime:"0001-01-01T00:00:00",Properties:{ID:"0-0",Row:0,Column:0,IOLocation:{Tray_Sensor1:0,Tray_Sensor2:1,Box_Sensor1:2,Box_Sensor2:3}},RackPlacementState:0,TrayPlacementState:0}]}}},showLevel:{type:Boolean,default:!0}},computed:{TotalPorts(){return this.rack_info.Rows*this.rack_info.Columns},HasCstPortNum(){let e=0;for(let t=0;t<this.rack_info.Ports.length;t++)!0===this.rack_info.Ports[t].CargoExist&&e++;return e},Level(){return this.HasCstPortNum/this.TotalPorts*100}}};const ke=(0,_e.Z)(ye,[["render",h],["__scopeId","data-v-56a68298"]]);var we=ke,ve={components:{RackStatus:we},data(){return{display:"div"}},computed:{WIPData(){return ce.jU.state.WIPsData},GroupedWipData(){const e=ce.jU.state.WIPsData;let t=t=>{let o=e.filter((e=>e.DeviceID==t));const a=o.reduce(((e,t)=>e+r(t)),0),i=o.reduce(((e,t)=>e+s(t)),0);return{zoneName:t,zones:o,totalPorts:a,hasCstPortNum:i,level:i/a*100}},s=e=>{let t=0;for(let s=0;s<e.Ports.length;s++)!0===e.Ports[s].CargoExist&&t++;return t},r=e=>e.Rows*e.Columns;const o=[...new Set(e.map((e=>e.DeviceID)))];return o.map((e=>t(e)))}},watch:{display(e){localStorage.setItem("wips-display-mode",e)}},mounted(){var e=localStorage.getItem("wips-display-mode");e&&(this.display=e)},methods:{IsHasDataButNoCargo(e){const t=ce.jU.state.HasDataButNoCargoWIPs.find((t=>t.DeviceID==e));return void 0!=t}}};const ge=(0,_e.Z)(ve,[["render",y]]);var Ce=ge}}]);
//# sourceMappingURL=941.62239dff.js.map