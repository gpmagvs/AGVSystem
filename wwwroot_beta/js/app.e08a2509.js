(function(){var e={46700:function(e,t,a){var i={"./af":42786,"./af.js":42786,"./ar":30867,"./ar-dz":14130,"./ar-dz.js":14130,"./ar-kw":96135,"./ar-kw.js":96135,"./ar-ly":56440,"./ar-ly.js":56440,"./ar-ma":47702,"./ar-ma.js":47702,"./ar-sa":16040,"./ar-sa.js":16040,"./ar-tn":37100,"./ar-tn.js":37100,"./ar.js":30867,"./az":31083,"./az.js":31083,"./be":9808,"./be.js":9808,"./bg":68338,"./bg.js":68338,"./bm":67438,"./bm.js":67438,"./bn":8905,"./bn-bd":76225,"./bn-bd.js":76225,"./bn.js":8905,"./bo":11560,"./bo.js":11560,"./br":1278,"./br.js":1278,"./bs":80622,"./bs.js":80622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":50877,"./cv.js":50877,"./cy":47373,"./cy.js":47373,"./da":24780,"./da.js":24780,"./de":59740,"./de-at":60217,"./de-at.js":60217,"./de-ch":60894,"./de-ch.js":60894,"./de.js":59740,"./dv":5300,"./dv.js":5300,"./el":50837,"./el.js":50837,"./en-au":78348,"./en-au.js":78348,"./en-ca":77925,"./en-ca.js":77925,"./en-gb":22243,"./en-gb.js":22243,"./en-ie":46436,"./en-ie.js":46436,"./en-il":47207,"./en-il.js":47207,"./en-in":44175,"./en-in.js":44175,"./en-nz":76319,"./en-nz.js":76319,"./en-sg":31662,"./en-sg.js":31662,"./eo":92915,"./eo.js":92915,"./es":55655,"./es-do":55251,"./es-do.js":55251,"./es-mx":96112,"./es-mx.js":96112,"./es-us":71146,"./es-us.js":71146,"./es.js":55655,"./et":5603,"./et.js":5603,"./eu":77763,"./eu.js":77763,"./fa":76959,"./fa.js":76959,"./fi":11897,"./fi.js":11897,"./fil":42549,"./fil.js":42549,"./fo":94694,"./fo.js":94694,"./fr":94470,"./fr-ca":63049,"./fr-ca.js":63049,"./fr-ch":52330,"./fr-ch.js":52330,"./fr.js":94470,"./fy":5044,"./fy.js":5044,"./ga":29295,"./ga.js":29295,"./gd":2101,"./gd.js":2101,"./gl":38794,"./gl.js":38794,"./gom-deva":27884,"./gom-deva.js":27884,"./gom-latn":23168,"./gom-latn.js":23168,"./gu":95349,"./gu.js":95349,"./he":24206,"./he.js":24206,"./hi":30094,"./hi.js":30094,"./hr":30316,"./hr.js":30316,"./hu":22138,"./hu.js":22138,"./hy-am":11423,"./hy-am.js":11423,"./id":29218,"./id.js":29218,"./is":90135,"./is.js":90135,"./it":90626,"./it-ch":10150,"./it-ch.js":10150,"./it.js":90626,"./ja":39183,"./ja.js":39183,"./jv":24286,"./jv.js":24286,"./ka":12105,"./ka.js":12105,"./kk":47772,"./kk.js":47772,"./km":18758,"./km.js":18758,"./kn":79282,"./kn.js":79282,"./ko":33730,"./ko.js":33730,"./ku":1408,"./ku.js":1408,"./ky":33291,"./ky.js":33291,"./lb":36841,"./lb.js":36841,"./lo":55466,"./lo.js":55466,"./lt":57010,"./lt.js":57010,"./lv":37595,"./lv.js":37595,"./me":39861,"./me.js":39861,"./mi":35493,"./mi.js":35493,"./mk":95966,"./mk.js":95966,"./ml":87341,"./ml.js":87341,"./mn":5115,"./mn.js":5115,"./mr":10370,"./mr.js":10370,"./ms":9847,"./ms-my":41237,"./ms-my.js":41237,"./ms.js":9847,"./mt":72126,"./mt.js":72126,"./my":56165,"./my.js":56165,"./nb":64924,"./nb.js":64924,"./ne":16744,"./ne.js":16744,"./nl":93901,"./nl-be":59814,"./nl-be.js":59814,"./nl.js":93901,"./nn":83877,"./nn.js":83877,"./oc-lnc":92135,"./oc-lnc.js":92135,"./pa-in":15858,"./pa-in.js":15858,"./pl":64495,"./pl.js":64495,"./pt":89520,"./pt-br":57971,"./pt-br.js":57971,"./pt.js":89520,"./ro":96459,"./ro.js":96459,"./ru":21793,"./ru.js":21793,"./sd":40950,"./sd.js":40950,"./se":10490,"./se.js":10490,"./si":90124,"./si.js":90124,"./sk":64249,"./sk.js":64249,"./sl":14985,"./sl.js":14985,"./sq":51104,"./sq.js":51104,"./sr":49131,"./sr-cyrl":79915,"./sr-cyrl.js":79915,"./sr.js":49131,"./ss":85893,"./ss.js":85893,"./sv":98760,"./sv.js":98760,"./sw":91172,"./sw.js":91172,"./ta":27333,"./ta.js":27333,"./te":23110,"./te.js":23110,"./tet":52095,"./tet.js":52095,"./tg":27321,"./tg.js":27321,"./th":9041,"./th.js":9041,"./tk":19005,"./tk.js":19005,"./tl-ph":75768,"./tl-ph.js":75768,"./tlh":89444,"./tlh.js":89444,"./tr":72397,"./tr.js":72397,"./tzl":28254,"./tzl.js":28254,"./tzm":51106,"./tzm-latn":30699,"./tzm-latn.js":30699,"./tzm.js":51106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":67691,"./uk.js":67691,"./ur":13795,"./ur.js":13795,"./uz":6791,"./uz-latn":60588,"./uz-latn.js":60588,"./uz.js":6791,"./vi":65666,"./vi.js":65666,"./x-pseudo":14378,"./x-pseudo.js":14378,"./yo":75805,"./yo.js":75805,"./zh-cn":83839,"./zh-cn.js":83839,"./zh-hk":55726,"./zh-hk.js":55726,"./zh-mo":99807,"./zh-mo.js":99807,"./zh-tw":74152,"./zh-tw.js":74152};function s(e){var t=n(e);return a(t)}function n(e){if(!a.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}s.keys=function(){return Object.keys(i)},s.resolve=n,e.exports=s,s.id=46700},45520:function(e,t,a){"use strict";var i=a(49963),s=a(66252),n=a(3577);const o={class:"d-flex flex-row","element-loading-text":"GPM AGVS","element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(31, 31, 31, 0.9)"},l={class:"d-flex"};function r(e,t,a,r,d,c){const u=(0,s.up)("RegularULDHotRunStateView"),m=(0,s.up)("Menu"),h=(0,s.up)("el-aside"),p=(0,s.up)("Header"),g=(0,s.up)("el-header"),_=(0,s.up)("router-view"),w=(0,s.up)("el-main"),f=(0,s.up)("el-container"),y=(0,s.up)("b-modal"),v=(0,s.up)("b-alert"),S=(0,s.up)("el-transition"),b=(0,s.up)("FixFooter"),C=(0,s.Q2)("loading");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",o,[(0,s.Wm)(u),(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[(0,s.Wm)(h,{class:"border",style:{width:"auto"}},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{isCollapse:d.menu_collapse},null,8,["isCollapse"])])),_:1}),(0,s.Wm)(f,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{style:{padding:"0"}},{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(p,{ref:"header",MenuExpanded:d.menu_collapse,"onUpdate:HasSystemAlarm":t[0]||(t[0]=e=>{d.HeaderShowSysAlarm=!0}),"onUpdate:HasEqpAlarm":t[1]||(t[1]=e=>{d.HeaderShowEqpAlarm=!0}),onOnMenuToggleClicked:c.ToggleMenu},null,8,["MenuExpanded","onOnMenuToggleClicked"]),[[i.F8,!d.loading]])])),_:1}),(0,s.Wm)(w,{style:(0,n.j5)([{padding:"0","overflow-y":"hidden"},c.router_view_style])},{default:(0,s.w5)((()=>[(0,s.wy)((0,s.Wm)(_,null,{default:(0,s.w5)((({Component:e})=>[((0,s.wg)(),(0,s.j4)(s.Ob,null,[((0,s.wg)(),(0,s.j4)((0,s.LL)(e)))],1024))])),_:1},512),[[i.F8,!d.loading]])])),_:1},8,["style"])])),_:1})])),_:1}),(0,s.Wm)(y,{modelValue:d.ShowOKOnlyModal,"onUpdate:modelValue":t[2]||(t[2]=e=>d.ShowOKOnlyModal=e),title:`${d.okOnlyModalProps.title}`,centered:!0,okOnly:!0,headerBgVariant:d.okOnlyModalProps.title_variant,headerTextVariant:"light"},{default:(0,s.w5)((()=>[(0,s._)("p",null,(0,n.zw)(d.okOnlyModalProps.content),1)])),_:1},8,["modelValue","title","headerBgVariant"]),(0,s.Wm)(v,{class:"fixed-bottom mb-3 mcs-message",modelValue:d.showMCSMessage,"onUpdate:modelValue":t[3]||(t[3]=e=>d.showMCSMessage=e),variant:d.mcsMessgeType,dismissible:""},{default:(0,s.w5)((()=>[(0,s._)("div",l,[(0,s._)("div",null,(0,n.zw)(d.mcsMessageDto.time),1),(0,s._)("div",{class:(0,n.C_)(["flex-fill","msg-text-"+d.mcsMessgeType])},(0,n.zw)(d.mcsMessageDto.message),3)])])),_:1},8,["modelValue","variant"]),(0,s.Wm)(S,{name:"el-fade-in-linear"},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{class:"fixed-bottom mb-3",modelValue:d.showAGVSDissconnectDismissibleAlert,"onUpdate:modelValue":t[4]||(t[4]=e=>d.showAGVSDissconnectDismissibleAlert=e),variant:"danger",dismissible:""},{default:(0,s.w5)((()=>[(0,s.Uk)("派車系統斷線-AGVS Disconnect")])),_:1},8,["modelValue"])])),_:1}),c.IsOpUsing?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(b,{key:0,IsMenuExpanded:!d.menu_collapse},null,8,["IsMenuExpanded"]))])),[[i.F8,!d.isNoPermission],[C,d.loading]])}var d=a(25044);const c={class:"menu"},u={class:"menu-top border-bottom p-2",style:{cursor:"pointer"}};function m(e,t,a,i,o,l){const r=(0,s.up)("home_icon"),d=(0,s.up)("el-icon"),m=(0,s.up)("el-menu-item"),h=(0,s.up)("el-badge"),p=(0,s.up)("Message"),g=(0,s.up)("cargo_icon"),_=(0,s.up)("Van"),w=(0,s.up)("map_icon"),f=(0,s.up)("el-sub-menu"),y=(0,s.up)("DataAnalysis"),v=(0,s.up)("PieChart"),S=(0,s.up)("Management"),b=(0,s.up)("setting"),C=(0,s.up)("User"),k=(0,s.up)("el-menu");return(0,s.wg)(),(0,s.iD)("div",c,[(0,s._)("div",u,[a.isCollapse?((0,s.wg)(),(0,s.iD)("div",{key:1,class:"gpm-text",onClick:t[1]||(t[1]=(...e)=>l.GoToHomePage&&l.GoToHomePage(...e))},"GPM")):((0,s.wg)(),(0,s.iD)("img",{key:0,onClick:t[0]||(t[0]=(...e)=>l.GoToHomePage&&l.GoToHomePage(...e)),src:"/GPM_Logo.png",alt:"",width:"160"}))]),(0,s.Wm)(k,{class:"el-menu-vertical-demo","default-active":"/",style:{height:"100vh"},"active-text-color":"rgb(13, 110, 253)",collapse:a.isCollapse,"collapse-transition":!1,router:!0,onOpen:l.handleOpen,onClose:l.handleClose,onClick:l.handleClicked},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{index:"/"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Home")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r)])),_:1})])),_:1}),1==l.UserPermission.menu.SystemAlarm?((0,s.wg)(),(0,s.j4)(m,{key:0,index:"/alarm"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.System Alarm")),1)])),default:(0,s.w5)((()=>[l.AnyAlarmsExist?((0,s.wg)(),(0,s.j4)(h,{key:0,value:"!",class:"menu-badge",style:(0,n.j5)(l.badgeStyle)},null,8,["style"])):(0,s.kq)("",!0),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(p)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.menu.WIPInfo?((0,s.wg)(),(0,s.j4)(m,{key:1,index:"/racks_status"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.wip_manager")),1)])),default:(0,s.w5)((()=>[l.AnyRackPortHasDataButNotExist?((0,s.wg)(),(0,s.j4)(h,{key:0,value:"!",type:"warning",class:"menu-badge",style:(0,n.j5)(l.badgeStyle)},null,8,["style"])):(0,s.kq)("",!0),(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.menu.VehicleManagnment?((0,s.wg)(),(0,s.j4)(m,{key:2,index:"/vehicle"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.vehicle manager")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(_,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.menu.Map?((0,s.wg)(),(0,s.j4)(f,{key:3},{title:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(w,{color:o.IconColor},null,8,["color"])])),_:1}),(0,s._)("span",null,(0,n.zw)(e.$t("Menu.map and display")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(m,{index:"/map/map_editor"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.map edit")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(w,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1}),(0,s.Wm)(m,{index:"/map/agv_display"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.agv display")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(w,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.menu.DataQuery?((0,s.wg)(),(0,s.j4)(f,{key:4,index:"/data"},{title:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,{color:o.IconColor},null,8,["color"])])),_:1}),(0,s._)("span",null,(0,n.zw)(e.$t("Menu.Querys")),1)])),default:(0,s.w5)((()=>[1==l.UserPermission.dataQuerySubMenu.TaskHistory?((0,s.wg)(),(0,s.j4)(m,{key:0,index:"/data/task_history"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Task History")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.dataQuerySubMenu.AlarmHistory?((0,s.wg)(),(0,s.j4)(m,{key:1,index:"/data/alarm_history"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Alarm History")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.dataQuerySubMenu.VehicleTrajectory?((0,s.wg)(),(0,s.j4)(m,{key:2,index:"/data/agv_locus"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Trajectory")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.dataQuerySubMenu.InstrumentsMeasure?((0,s.wg)(),(0,s.j4)(m,{key:3,index:"/data/InstrumentMeasureQuery"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Instruments Measure Result")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.dataQuerySubMenu.Utilization?((0,s.wg)(),(0,s.j4)(m,{key:4,index:"/data/Avalibility"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.utilization rate")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(v)])),_:1})])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(m,{index:"/data/TrafficState"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.Traffic State")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(v)])),_:1})])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.menu.HotRun?((0,s.wg)(),(0,s.j4)(m,{key:5,index:"/hotrun"},{title:(0,s.w5)((()=>[(0,s.Uk)("Hot Run")])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(S,{color:"red"})])),_:1})])),_:1})):(0,s.kq)("",!0),l.IsAdmin?((0,s.wg)(),(0,s.j4)(m,{key:6,index:"/secsgem"},{title:(0,s.w5)((()=>[(0,s.Uk)("SECS/GEM")])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,{color:o.IconColor},null,8,["color"])])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.menu.SystemConfiguration?((0,s.wg)(),(0,s.j4)(f,{key:7,index:"/sys_settings"},{title:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{color:o.IconColor},null,8,["color"])])),_:1}),(0,s._)("span",null,(0,n.zw)(e.$t("Menu.system settings")),1)])),default:(0,s.w5)((()=>[1==l.UserPermission.systemConfigurationSubMenu.BatteryLevelManagnment?((0,s.wg)(),(0,s.j4)(m,{key:0,index:"/sys_settings/AGV_Battery_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.vehicle battery managnment")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.systemConfigurationSubMenu.EquipmentlManagnment?((0,s.wg)(),(0,s.j4)(m,{key:1,index:"/sys_settings/Equipment_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.equipment management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.systemConfigurationSubMenu.RackManagnment?((0,s.wg)(),(0,s.j4)(m,{key:2,index:"/sys_settings/RacksManagement"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.racks management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.systemConfigurationSubMenu.UserManagnment?((0,s.wg)(),(0,s.j4)(m,{key:3,index:"/sys_settings/User_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.user management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(C)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.systemConfigurationSubMenu.ChargerManagnment?((0,s.wg)(),(0,s.j4)(m,{key:4,index:"/sys_settings/Charge_Station_Setting"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.charge station management")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1})):(0,s.kq)("",!0),1==l.UserPermission.systemConfigurationSubMenu.ChargerManagnment?((0,s.wg)(),(0,s.j4)(m,{key:5,index:"/sys_settings/secs_gem_settings"},{title:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Menu.secs_gem_settings")),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1})])),_:1})):(0,s.kq)("",!0)])),_:1})):(0,s.kq)("",!0)])),_:1},8,["collapse","onOpen","onClose","onClick"])])}var h=a(65781),p=a(53259),g={components:{DataAnalysis:h.RbR,Document:h.BBB,Message:h.v0C,Location:h.YeX,Setting:h.pEs,User:h.n5m,home_icon:h.Ozs,alarm_icon:h.etl,cargo_icon:h._hA,map_icon:h.Yaq,Management:h.O_g,Van:h.mWD,PieChart:h.ucW},props:{isCollapse:{type:Boolean,default:!0}},data(){return{IconColor:"rgb(6, 53, 125)",ActiveSubItem:"4"}},computed:{IsAdmin(){return d.HP.getters.IsEngineerLogining||d.HP.getters.IsDeveloperLogining},UserPermission(){return d.HP.state.user.Permission},badgeStyle(){return{top:this.isCollapse?"-26px":"-13px"}},AnyAlarmsExist(){return d.qz.state.alarmsCollection.length>0},AnyRackPortHasDataButNotExist(){return d.jU.state.IsAnyPortHasDataButNoCargo}},methods:{handleOpen(){},handleClose(){},handleClicked(){},GoToHomePage(){location.href="/"}}},_=a(83744);const w=(0,_.Z)(g,[["render",m],["__scopeId","data-v-2dd33d36"]]);var f=w,y=a(44056);const v=e=>((0,s.dD)("data-v-12520d6c"),e=e(),(0,s.Cn)(),e),S={class:"show-mode border"},b={class:"d-flex flex-row"},C=v((()=>(0,s._)("i",{class:"bi bi-chevron-double-down"},null,-1))),k=v((()=>(0,s._)("div",{class:"alarm-display-container d-flex flex-row w-100"},[(0,s._)("div",{class:"h-50 w-100 border d-flex flex-row"},[(0,s._)("div",{class:"alarm-type"},"設備異常"),(0,s._)("div",null,"a")]),(0,s._)("div",{class:"h-50 w-100 border d-flex flex-row"},[(0,s._)("div",{class:"alarm-type"},"AGV警報"),(0,s._)("div",null,"b")])],-1))),T={class:"hidden-mode"},D=v((()=>(0,s._)("i",{class:"bi bi-chevron-double-up"},null,-1)));function V(e,t,a,o,l,r){const d=(0,s.up)("b-button");return(0,s.wg)(),(0,s.iD)("div",{class:"alarm-display w-100 fixed-bottom",style:(0,n.j5)(l.dynamic_style_setting)},[(0,s.Wm)(i.uT,{name:"el-zoom-in-bottom"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("div",S,[(0,s._)("div",b,[(0,s.Wm)(d,{squared:"",variant:"secondary",onClick:t[0]||(t[0]=e=>l.mode="hidden")},{default:(0,s.w5)((()=>[C])),_:1}),k])],512),[[i.F8,"show"==l.mode]])])),_:1}),(0,s.wy)((0,s._)("div",T,[(0,s.Wm)(d,{squared:"",variant:"danger",onClick:t[1]||(t[1]=e=>l.mode="show")},{default:(0,s.w5)((()=>[(0,s.Uk)(" Alarms "),D])),_:1})],512),[[i.F8,"hidden"==l.mode]])],4)}var A=a(2262),I=a(22201),x={setup(){},data(){return{mode:"show",dynamic_style_setting:{zIndex:2e4}}},mounted(){(0,A.iH)("");const e=(0,I.yj)();(0,s.YP)((()=>e.path),((e,t)=>{this.mode="/"!=e?"hidden":"show"})),p.Z.on("/alarm_footer_send_to_back",(e=>{this.dynamic_style_setting.zIndex=e?2:2e4}))}};const E=(0,_.Z)(x,[["render",V],["__scopeId","data-v-12520d6c"]]);var M=E;const P=e=>((0,s.dD)("data-v-15c6c8d4"),e=e(),(0,s.Cn)(),e),O={class:"d-flex flex-row"},N=P((()=>(0,s._)("br",null,null,-1))),L=P((()=>(0,s._)("i",{class:"bi bi-database-fill-check border-end border-start px-1",style:{"font-size":"1.3rem"}},null,-1))),G={class:"conn-block px-3 border-end"};function R(e,t,a,i,o,l){const r=(0,s.up)("el-badge"),d=(0,s.up)("el-tooltip"),c=(0,s.up)("el-tag");return(0,s.wg)(),(0,s.iD)("div",{class:"connection-state d-flex flex-row justify-content-between fixed-bottom bg-light border-top text-start",style:(0,n.j5)({marginLeft:l.marginLeft})},[(0,s._)("div",O,[(0,s.Wm)(d,{placement:"top-end","popper-class":l.DatabaseState.state?"":"bg-danger text-light"},{content:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(l.databaseInfo)+" ",1),N,(0,s.Uk)(" "+(0,n.zw)(l.DatabaseState.message),1)])),default:(0,s.w5)((()=>[(0,s.Wm)(r,{type:"warning",value:l.DatabaseState.state?void 0:"!"},{default:(0,s.w5)((()=>[L])),_:1},8,["value"])])),_:1},8,["popper-class"]),(0,s._)("div",G,[(0,s.Wm)(d,{content:l.vmsAppInfo.AppVersion,placement:"top-end"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{effect:"dark",type:l.VMSAlive?"success":"danger",onClick:l.HandleVMSTagClick},{default:(0,s.w5)((()=>[(0,s.Uk)("VMS")])),_:1},8,["type","onClick"])])),_:1},8,["content"])])]),o.showVersionInfo?((0,s.wg)(),(0,s.iD)("div",{key:0,onClick:t[0]||(t[0]=(...e)=>l.HandleVersionClick&&l.HandleVersionClick(...e))},"V"+(0,n.zw)(l.APPVersion),1)):(0,s.kq)("",!0),(0,s._)("div",{onDblclick:t[1]||(t[1]=(...e)=>l.handleTimeDoubleClick&&l.handleTimeDoubleClick(...e)),class:"sys-time"},(0,n.zw)(o.sys_time),33)],4)}var W=a(30381),U=a.n(W),H={data(){return{Connections:[{name:"SERVER",connected:!0},{name:"VMS",connected:()=>d.g4.getters.VMSAlive}],sys_time:"",showVersionInfo:!0}},mounted(){setInterval((()=>{this.sys_time=U()(Date.now()).format("yyyy-MM-DD HH:mm:ss")}),1e3),(0,s.YP)((()=>this.$route.path),(e=>{this.showVersionInfo="/data/task_history"!==e&&"/data/alarm_history"!==e}))},methods:{async handleTimeDoubleClick(){var e=await d.HP.dispatch("login",{UserName:"dev",Password:"12345678"});e.confirm&&location.reload()},HandleVMSTagClick(){this.$swal.fire({text:this.vmsAppInfo.AppVersion,title:"VMS",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},HandleVersionClick(){this.$swal.fire({title:"VERSION INFO",html:`<div class="border rounded p-3"> \n                  <div class="my-3"> <label class="text-start" style="width:160px;">VMS</label>       <span class="border-bottom">${this.vmsAppInfo.AppVersion}</span>  </div>\n                  <div> <label class="text-start" style="width:160px;">AGVSystem</label> <span class="border-bottom">${this.APPVersion}</span> </div>\n                </div>`,showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},props:{IsMenuExpanded:{type:Boolean,default:!1}},computed:{marginLeft(e=200){return this.IsMenuExpanded?"233px":"69px"},VMSAlive(){return d.g4.getters.VMSAlive},APPVersion(){return this.$store.getters.APPVersion},databaseInfo(){function e(e){const t={},a=e.split(";");return a.forEach((e=>{const[a,i]=e.split("=").map((e=>e.trim()));a&&(t[a]=i)})),t}var t=e(d.ZP.state.systemConfigs.DBConnection);let a=`${t.Database}(${t.Server})`;return a},vmsAppInfo(){return d.ZP.state.vmsAppInfo},DatabaseState(){return d.ZP.state.databaseState}}};const $=(0,_.Z)(H,[["render",R],["__scopeId","data-v-15c6c8d4"]]);var F=$,q=a(90131);const B=e=>((0,s.dD)("data-v-216847de"),e=e(),(0,s.Cn)(),e),z={key:0,class:"move_agv_notify"},j=B((()=>(0,s._)("span",{class:"mx-1"},"移車提示",-1)));function Z(e,t,a,i,o,l){const r=(0,s.up)("Warning"),d=(0,s.up)("el-icon"),c=(0,s.up)("el-button"),u=(0,s.up)("el-badge"),m=(0,s.up)("el-table-column"),h=(0,s.up)("el-table"),p=(0,s.up)("el-dialog");return l.IsAnyAGVNeedToMOVE?((0,s.wg)(),(0,s.iD)("div",z,[(0,s.Wm)(u,{value:l.NeedToMoveAGVNum,class:"item"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{onClick:l.HandleBtnClick,style:{"font-size":"large"},plain:"",type:"warning",size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r)])),_:1}),j])),_:1},8,["onClick"])])),_:1},8,["value"]),(0,s._)("div",null,[(0,s.Wm)(p,{draggable:"",width:"400",modal:!1,title:"移車",modelValue:o.DialogVisible,"onUpdate:modelValue":t[0]||(t[0]=e=>o.DialogVisible=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{"row-key":"AgvName",data:l.WattingAGVInfo},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{label:"被阻車輛",prop:"AgvName"}),(0,s.Wm)(m,{label:"當前地點",prop:"AgvName"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(l.GetCurrentLocInfoByTag(e.row.Tag)),1)])),_:1}),(0,s.Wm)(m,{label:"被阻地點",prop:"AgvName"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(e.row.WaitingInfo.WaitingPoint.Name),1)])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"])])])):(0,s.kq)("",!0)}var Q=a(95320),Y={components:{Warning:h.v3j},data(){return{DialogVisible:!1}},computed:{IsAnyAGVNeedToMOVE(){return this.NeedToMoveAGVNum>0},WattingAGVInfo(){var e=Q.p.getters.AGVNavInfo.AGVDisplays,t=e.filter((e=>e.WaitingInfo.IsWaiting));return t},NeedToMoveAGVNum(){return this.WattingAGVInfo.length}},methods:{HandleBtnClick(){this.DialogVisible=!0},GetCurrentLocInfoByTag(e){var t=Q.p.getters.MapData.Points,a=Object.values(t).find((t=>t.TagNumber==e));return`${a.TagNumber}:${a.Name}`}}};const K=(0,_.Z)(Y,[["render",Z],["__scopeId","data-v-216847de"]]);var X=K;const J={class:"agv-alarm-messages"};function ee(e,t,a,i,n,o){return(0,s.wg)(),(0,s.iD)("div",J)}const te={key:0,class:"bi bi-thermometer-high"},ae={key:1,class:"bi bi-battery"},ie={key:2,class:"bi bi-reception-1"},se={key:3,class:"bi bi-exclamation-diamond"},ne={class:"agv-name"},oe={class:"text"};function le(e,t,a,i,o,l){return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["agv-alarm-item my-2 d-flex rounded",a.alarm_type])},[(0,s._)("div",{class:(0,n.C_)(["icon px-2 text-light","alarm"==a.alarm_type?"bg-danger":"bg-warning"])},[a.isBatteryTemperatureHigh?((0,s.wg)(),(0,s.iD)("i",te)):a.isBatteryLowLevel?((0,s.wg)(),(0,s.iD)("i",ae)):a.isDisconnection?((0,s.wg)(),(0,s.iD)("i",ie)):((0,s.wg)(),(0,s.iD)("i",se))],2),(0,s._)("div",ne,(0,n.zw)(a.agv_name)+"|",1),(0,s._)("div",oe,(0,n.zw)(a.text),1)],2)}var re={props:{alarm_type:{type:String,default:"warning"},agv_name:{type:String,default:"AGV_001"},text:{type:String,default:""},isBatteryTemperatureHigh:{type:Boolean,default:!1},isBatteryLowLevel:{type:Boolean,default:!1},isDisconnection:{type:Boolean,default:!1}}};const de=(0,_.Z)(re,[["render",le],["__scopeId","data-v-7922e32c"]]);var ce=de,ue={components:{AGVAlarmItem:ce}};const me=(0,_.Z)(ue,[["render",ee],["__scopeId","data-v-25571013"]]);var he=me,pe=a(97318),ge=a(663),_e=a(49996);const we=e=>((0,s.dD)("data-v-090b286d"),e=e(),(0,s.Cn)(),e),fe={class:"d-flex flex-row cursor-pointer"},ye=we((()=>(0,s._)("i",{class:"bi bi-three-dots-vertical"},null,-1))),ve={key:0,class:"detail-info"};function Se(e,t,a,o,l,r){const d=(0,s.up)("b-button"),c=(0,s.up)("el-table-column"),u=(0,s.up)("el-button"),m=(0,s.up)("el-table");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"regular-uld-hot-run-state border",style:(0,n.j5)({width:l.showDetail?"450px":"400px"})},[(0,s._)("div",fe,[ye,(0,s._)("label",{onClick:t[0]||(t[0]=()=>{l.showDetail=!l.showDetail}),class:"mx-2 flex-fill cursor-pointer text-start"},"定時出料模擬 HOT RUN 運行中"),(0,s.Wm)(d,{size:"sm",variant:"danger",onClick:r.EndScript},{default:(0,s.w5)((()=>[(0,s.Uk)("結束")])),_:1},8,["onClick"]),l.showDetail?((0,s.wg)(),(0,s.iD)("i",{key:0,onClick:t[1]||(t[1]=()=>{l.showDetail=!l.showDetail}),class:"bi bi-caret-down-fill"})):((0,s.wg)(),(0,s.iD)("i",{key:1,onClick:t[2]||(t[2]=()=>{l.showDetail=!l.showDetail}),class:"bi bi-caret-up-fill"}))]),l.showDetail?((0,s.wg)(),(0,s.iD)("div",ve,[(0,s.Wm)(m,{data:r.runState,border:"",height:"400"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:"設備",prop:"EqName"}),(0,s.Wm)(c,{label:"下次取貨時間",prop:"nextUnloadTime"}),(0,s.Wm)(c,{label:"下次取貨時間",prop:"timeRemain"}),(0,s.Wm)(c,{label:""},{default:(0,s.w5)((e=>[e.row.timeRemain.includes("-")?((0,s.wg)(),(0,s.j4)(u,{key:0,type:"warning"},{default:(0,s.w5)((()=>[(0,s.Uk)("取消出料")])),_:1})):((0,s.wg)(),(0,s.j4)(u,{key:1,type:"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)("強制出料")])),_:1}))])),_:1})])),_:1},8,["data"])])):(0,s.kq)("",!0)],4)),[[i.F8,r.isRunning]])}var be=a(8764),Ce={data(){return{showDetail:!1}},computed:{isRunning(){return"running"==d.ZP.state.regularHotRunStates.state},runState(){var e=Object.keys(d.ZP.state.regularHotRunStates.unloaderStates);return e.map((e=>{var t=d.ZP.state.regularHotRunStates.unloaderStates[e];return t.EqName=e,t.nextUnloadTime=U()(t.nextUnloadTime).format("HH:mm:ss"),t}))}},methods:{async EndScript(){this.$swal.fire({text:"",title:"確定要結束HOT RUN?",icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=d.ZP.state.regularHotRunStates.scriptID;await(0,be.AZ)(t)}}))}}};const ke=(0,_.Z)(Ce,[["render",Se],["__scopeId","data-v-090b286d"]]);var Te=ke,De=a(64491),Ve=a(81348),Ae=a(56512),Ie=null,xe=null,Ee=null;let Me=Date.now(),Pe=Date.now(),Oe=!0,Ne=!0;var Le=Ge(10);function Ge(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=a.length,s=0;s<e;s++)t+=a.charAt(Math.floor(Math.random()*i));return t}function Re(e){p.Z.emit("on-data-fetch-delay-detected",e)}function We(e){if(!e)return;const t=e.TimeStamp;e,Me=t,d.sn.commit("setHotRunStates",e.HotRun),d.jU.commit("setData",e.EQStatus),d.Ys.commit("StoreTaskData",e.TaskData),Q.p.commit("setControledPathesBySystem",e.ControledPathesByTraffic),d.g4.commit("SetVMSAlive",e.VMSAliveCheck)}function Ue(e){if(!e)return;const t=e.TimeStamp;e,Pe=t,e.VMSStatus&&d.sn.commit("storeAgvStates",e.VMSStatus),e.VehicleBatteryStatus&&d.sn.commit("setVehiclesBatteryStatus",e.VehicleBatteryStatus),Q.p.commit("setAGVDynamicPathInfo",e.AGVNaviPathsInfoVM),Q.p.commit("setOtherAGVLocateInfo",e.OtherAGVLocations)}async function He(){const e=await(0,De.H5)();d.jU.commit("EqOptions",e);const t=await(0,De.Qu)();d.jU.commit("WIPOptions",t)}async function $e(){return await fetch(ge.Z.backend_host+"/api/system/alivecheck").then((e=>!0)).catch((e=>(console.error("AGVS alive check error",e),!1)))}async function Fe(){return await fetch(ge.Z.vms_host+"/api/system/alivecheck").then((e=>!0)).catch((e=>(console.error("VMS alive check error",e),!1)))}async function qe(){let e=ge.Z.hubs;Ie=(new Ae.s).withUrl(e.agvs).withAutomaticReconnect([0,1e3,2e3,3e3]).build(),xe=(new Ae.s).withUrl(e.vms).withAutomaticReconnect([0,1e3,2e3,3e3]).build(),Ee=(new Ae.s).withUrl(e.secs_platform).withAutomaticReconnect([0,1e3,2e3,3e3]).build(),Ie.on("ReceiveData",((e,t)=>{We(t)})),Ie.on("UnCheckedAlarms",(e=>{d.qz.commit("StoreAlarmData",e)})),Ie.on("RackDataChanged",(e=>{d.jU.commit("rackStatusData",e)})),Ie.on("EQDataChanged",(e=>{d.jU.commit("setEQData",e)})),Ie.on("RegularHotRunInfo",(e=>{d.ZP.commit("setRegularHotRunState",e)})),Ie.on("Notify",(e=>{Ve.z8.info({message:e})})),Ie.on("MCSMessage",(e=>{console.info(e),p.Z.emit("MCSMessage",e)})),Ie.on("DatabaseState",(e=>{d.ZP.commit("updateDatabaseState",e)})),xe.on("ReceiveData",((e,t)=>{Ue(t)})),xe.onreconnected((e=>{console.log(`VMS Hub Connection reestablished. Connected with connectionId "${e}".`)})),Ee.on("ControlState",(e=>{console.info(e),-1==e&&p.Z.emit("secs-offline-by-agvs-disoneect")})),Ee.on("HostMessage",(e=>{p.Z.emit("MCSMessage",{message:e,type:"info",time:U()(Date.now()).format("yyyy/MM/DD HH:mm:ss")})})),Ee.on("MessageTransmited",(e=>{d.ZP.commit("storeSecsMessage",e)})),Ee.on("ConnectionStates",(e=>{d.ZP.commit("storeConnectionStates",e)})),Ee.onreconnected((()=>{console.log(`SECS Platform Hub Connection reestablished. Connected with connectionId "${connectionId}".`)})),Ee.onclose((()=>{console.log("SECS Platform Hub Connection closed."),d.ZP.commit("storeConnectionStates",{cim:4,mcs:4}),d.ZP.commit("setSecsPlatformRunning",!1)}));try{await Ie.start()}catch(t){console.error("AGVS SignalR connection error: ",t)}try{await xe.start()}catch(t){console.error("VMS SignalR connection error: ",t)}try{await Ee.start(),d.ZP.commit("setSecsPlatformRunning",!0)}catch(t){console.error("SECS Platform SignalR connection error: ",t)}}function Be(){setInterval((async()=>{const e=await $e(),t=e&&!Ne;Ne=e;const a=await Fe(),i=a&&!Oe;Oe=a,(t||i)&&setTimeout((()=>{window.location.reload()}),3e3),e&&a||(e||p.Z.emit("agvs-disconnected"),a||Re("VMS系統斷線_VMS Disconnected"))}),5e3)}function ze(){Ie&&Ie.stop(),xe&&xe.stop()}function je(){d.HP.commit("setUserID",Le),He(),qe(),setTimeout((()=>{Be()}),5e3)}d.jU.dispatch("downloadRackStatusData"),d.jU.dispatch("downloadEQData"),d.qz.dispatch("downloadUncheckedAlarms");var Ze=a(2781),Qe={components:{Header:y.Z,Menu:f,AlarmDisplayVue:M,FixFooter:F,MoveAGVNotifty:X,AGVAlarmMessageDisplay:he,RegularULDHotRunStateView:Te},provide(){return{tableHeaderStyle:pe.R}},data(){return{showAGVSDissconnectDismissibleAlert:!1,secsInfoMsgAutoDispearTimeout:null,showMCSMessage:!1,mcsMessageDto:{time:"",message:"",type:"info"},mcsMessgeType:"",loading:!1,isNoPermission:!1,showMenuToggleIcon:!0,ShowOKOnlyModal:!1,menu_collapse:!0,okOnlyModalProps:{title:"",content:"",title_variant:"primary"},HeaderShowSysAlarm:!0,HeaderShowEqpAlarm:!0,reloadAfterBackToHome:!1}},computed:{router_view_style(){var e="18px";return this.IsOpUsing?"10px":(e=this.HeaderShowEqpAlarm&&this.HeaderShowSysAlarm?"65px":this.HeaderShowEqpAlarm||this.HeaderShowSysAlarm?"30px":"1px",{position:"relative",paddingTop:e})},IsOpUsing(){return d.HP.getters.IsOPLogining}},methods:{OpenLoading(){this.$vs.loading(),setTimeout((()=>{this.$vs.loading.close()}),200)},ToggleMenu(){this.menu_collapse=!this.menu_collapse},SideMenuCloseHandler(){this.showMenuToggleIcon=!0},RegistNotifies(){const e=new EventSource(ge.Z.agvsystem_notify_url);e.addEventListener("Equipment_Maintain",(e=>{var t=e.data;_e.bM.warning({message:`設備 ${t} 維修中!`})}))},changeLangFromLocalStorage(){var e=localStorage.getItem("lang");e&&(this.$i18n.locale=e)},async CheckEqPointsNoSetup(){if(!(d.HP.state.user.Role<1)){var e=localStorage.getItem("GPMAGVS-NO-NOTIFY-STATE");if(e){const t=JSON.parse(e),a=Date.now()>t.nextNofityTime;if(!a)return}(0,De.c8)().then((e=>{if(!e.isNormal){let t="<div>";e.noBuildPointInfo.forEach((e=>{t+=`<div class="text-start" style="padding-left:30px"> <label style="margin-right:30px">Tag ${e.tag} : </label> <b>[${e.name}]</b> </div>`})),t+="<div>";e=this.$swal.fire({html:t,title:"注意!有站點未設置設備",icon:"warning",showCancelButton:!0,confirmButtonText:"OK",cancelButtonText:"稍後再提醒我",customClass:"my-sweetalert"}).then((e=>{if("cancel"==e.dismiss){const e=new Date(Date.now()+36e5).getTime();localStorage.setItem("GPMAGVS-NO-NOTIFY-STATE",JSON.stringify({nextNofityTime:e}))}}))}}))}}},mounted(){je(),p.Z.on("/map_save",(()=>{this.mapSaved=!0})),p.Z.on("agvs-disconnected",(()=>this.showAGVSDissconnectDismissibleAlert=!0)),p.Z.on("MCSMessage",(e=>{console.info(e);const t="error"!=e.type;this.mcsMessageDto=e,this.mcsMessgeType=t?"info":"danger",this.showMCSMessage=!0,t&&(clearTimeout(this.secsInfoMsgAutoDispearTimeout),this.secsInfoMsgAutoDispearTimeout=setTimeout((()=>this.showMCSMessage=!1),5e3))})),p.Z.on("on-data-fetch-delay-detected",(e=>{const t=localStorage.getItem("AGVS-DISCONNECTED-NO-NOTIFY-STATE");if(t){const e=JSON.parse(t),a=Date.now()>e.nextNofityTime;if(!a)return}this.$swal.fire({text:e,title:"",icon:"error",showCancelButton:!0,confirmButtonText:"Reload",cancelButtonText:this.$t("App.LaterRemindMe"),customClass:"my-sweetalert"}).then((e=>{if(e.isConfirmed&&window.location.reload(),"cancel"==e.dismiss){const e=new Date(Date.now()+3e5).getTime();localStorage.setItem("AGVS-DISCONNECTED-NO-NOTIFY-STATE",JSON.stringify({nextNofityTime:e}))}}))})),document.addEventListener("click",(e=>{(0,Ze.d)(e.target.innerText,e.target.parentElement+"")})),document.addEventListener("keydown",(e=>{e.key&&"control"==e.key.toLowerCase()&&d.ZP.commit("setCtrlKeyPressing",!0)})),document.addEventListener("keyup",(e=>{d.ZP.commit("setCtrlKeyPressing",!1)}));const e=!1;this.$store.dispatch("GetDynamicWebsiteData").then((t=>{var a=t.FieldName;document.title=e?`[DEBUG]-[${a}]-GPM AGVS`:`[${a}]-GPM AGVS`})),this.$store.dispatch("DownloadSystemConfigs"),this.$store.dispatch("DownloadVMSAppInfo"),d.jU.dispatch("FetchWIPSlotOptions");let t=(0,q.VM)();t.isLogin&&d.HP.commit("setUser",t.login_info),p.Z.on("menuToggle",(()=>{this.ToggleMenu()})),p.Z.on("swal-notify-invoke",(e=>{this.$swal.fire(e)})),p.Z.on("/ShowOKOnlyModal",(e=>{this.okOnlyModalProps=e,this.ShowOKOnlyModal=!0})),p.Z.on("auto_logout_notify_invoke",(()=>{ze();const e=d.HP.getters.IsLogin;e&&d.HP.dispatch("logout"),p.Z.emit("stop_render",""),document.title="[Idle For Long Time...]",document.close(),this.$swal.fire({text:"",title:e?this.$t("App.AutoLogoutNotify"):this.$t("App.PushOkToRefreshPage"),icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{window.location.href=e?"/login":"/"}))})),p.Z.on("secs-host-message",(e=>{this.$swal.fire({text:e,title:"HOST MESSAGE",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})})),p.Z.on("home-reload-request",(e=>{this.reloadAfterBackToHome=!0}));const a=(0,I.yj)();(0,s.YP)((()=>a.path),((e,t)=>{if("/"==e&&this.reloadAfterBackToHome&&location.reload(),("/sys_settings"==e||"/map"==e)&&d.HP.getters.level<=0)return this.$vs.loading.close(),this.loading=!1,this.isNoPermission=!0,void this.$swal.fire({text:"",title:"您沒有足夠的權限訪問此頁面!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"full-sweetalert"}).then((()=>{window.location.href="/"}));const a="/racks_status"==e,i="/"==e;(a||i)&&t!=e&&(a&&d.jU.dispatch("downloadRackStatusData"),i&&d.jU.dispatch("downloadEQData"))})),"/"!=location.pathname||this.IsOpUsing||(this.loading=!0),setTimeout((()=>{this.loading=!1}),800),setTimeout((()=>{this.CheckEqPointsNoSetup()}),3e3),this.RegistNotifies(),this.changeLangFromLocalStorage()},created(){}};const Ye=(e,t)=>{let a=null;return function(){let i=this,s=arguments;clearTimeout(a),a=setTimeout((function(){try{e.apply(i,s)}catch(t){}}),t)}},Ke=window.ResizeObserver;window.ResizeObserver=class extends Ke{constructor(e){e=Ye(e,16),super(e)}};const Xe=(0,_.Z)(Qe,[["render",r]]);var Je=Xe,et=a(1982),tt=a(30421),at=(a(54415),a(55612)),it=a(79150),st=a(54489),nt=a.n(st),ot=a(53982),lt=a.n(ot),rt=a(43556),dt=0,ct=void 0;function ut(){dt=0}setTimeout((()=>{(0,rt.pw)().then((e=>{const t=e.WebUserLogoutExipreTime;ct=setInterval((()=>{dt+=1,dt>=t&&(p.Z.emit("auto_logout_notify_invoke",""),ut(),clearInterval(ct))}),1e3)}))}),5e3),document.addEventListener("touchstart",ut),document.addEventListener("touchmove",ut),document.addEventListener("touchend",ut),document.addEventListener("mousemove",ut),document.addEventListener("mousedown",ut),document.addEventListener("keydown",ut);var mt=!0;class ht{constructor(){this.type=0,this.evt="",this.message="",this.show=!0}get typeStr(){switch(this.type){case 0:return"info";case 1:return"warning";case 2:return"error";case 3:return"success";default:return"info"}}}function pt(e=!0,t=!0){if(e){let e=new WebSocket(ge.Z.backend_ws_host+"/api/event");e.onopen=e=>{},e.onmessage=e=>{if(!mt)return;var t=e.data;let a=new ht;Object.assign(a,JSON.parse(t)),console.info(a.message),"Map-Point-Enabled-Property-Changed"===a.message&&p.Z.emit("Map-Point-Enabled-Property-Changed"),a.message.includes("system_mode-")&&p.Z.emit("reload-system-modes-from-server"),a.show&&(0,Ve.z8)({title:"AGVSystem "+a.evt,type:a.typeStr,message:a.message,duration:2e3})},e.onclose=e=>{setTimeout((()=>{pt(!0,!1)}),1e3)}}if(t){let e=new WebSocket(ge.Z.vms_ws_host+"/api/event");e.onopen=e=>{},e.onmessage=e=>{if(!mt)return;var t=e.data;let a=new ht;Object.assign(a,JSON.parse(t));const i=a.message.includes("carry-order-failure");if(i&&d.HP.getters.IsOPLogining){const e=JSON.parse(a.message);p.Z.emit("swal-notify-invoke",{title:"搬運任務失敗",icon:"error",html:`<div class="text-danger font-weight-bold">${e.message_Zh}<p>${e.message_En}</p></div>`,showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}else"Map-Point-Enabled-Property-Changed"===a.message&&p.Z.emit("Map-Point-Enabled-Property-Changed"),"Update-Maintain-State"===a.message&&p.Z.emit("Update-Maintain-State"),a.show&&(0,Ve.z8)({type:a.typeStr,message:a.message,duration:2e3})},e.onclose=e=>{setTimeout((()=>{pt(!1,!0)}),1e3)}}}pt();const gt=(0,it.o)({legacy:!1,locale:"zh-TW",fallbackLocale:"en-US",messages:{"zh-TW":a(46687),"en-US":a(19594)}}),_t={confirmButtonColor:"rgb(13, 110, 253)",cancelButtonColor:"#ff7674"},wt=(0,i.ri)(Je);wt.use(nt()),wt.use(d.ZP),wt.use(et.Z),wt.use(at.ZP),wt.use(tt.Z),wt.use(gt),wt.use(lt(),_t),wt.mount("#app")},78538:function(e,t,a){"use strict";a.d(t,{W1:function(){return i},r0:function(){return n}});class i{constructor(){this.Notes={Accept_AGV_Type:"允許進行任務之車輛種類(0:所有車種,1:叉車AGV, 2:潛盾AGV)",EQAcceeptCargoType:"設備可移載的貨物種類(0:不限, 200:子母框, 201:Tray)",CheckRackContentStateIOSignal:"空框/實框IO訊號檢查(目前僅 UMTC S1/5F專案須將此設為true, false:不檢查,true:檢查)"},this.Enable=!0,this.ConnOptions=new s,this.Name="EQP",this.DeviceID="SYS2341G23",this.TagID=0,this.EqType=0,this.LdULdType=2,this.LoadUnloadCargoMode=0,this.EQAcceeptCargoType=200,this.Accept_AGV_Type=0,this.Region="",this.ValidDownStreamEndPointNames=[],this.IOLocation={STATUS_IO_SPEC_VERSION:1,Load_Request:0,Unload_Request:1,Port_Exist:2,Eqp_Status_Down:5,Eqp_Status_Run:8,Eqp_Status_Idle:9,HS_EQ_L_REQ:10,HS_EQ_U_REQ:11,HS_EQ_READY:12,HS_EQ_UP_READY:13,HS_EQ_LOW_READY:14,Up_Pose:3,Down_Pose:4,HS_EQ_BUSY:15,Empty_CST:16,Full_CST:17,Eqp_Maintaining:7,Eqp_PartsReplacing:8,To_EQ_Up:0,To_EQ_Low:1,HS_AGV_VALID:8,HS_AGV_TR_REQ:9,HS_AGV_BUSY:11,HS_AGV_COMPT:12,CMD_Reserve_Up:2,CMD_Reserve_Low:3,HS_AGV_READY:10,To_EQ_Empty_CST:9,To_EQ_Full_CST:10},this.PLCOptionJsonFile=null,this.InstalledCargoID="",this.Height=0,this.CheckRackContentStateIOSignal=!1,this.IsEmulation=!0,this.EmulationMode=0,this.AcceptTransferTag=[],this.IsNeedStorageMonitor=!1,this.StorageMonitorPriority=0,this.index=0,this.HasCstSteeringMechanism=!1,this.IsOneOfDualPorts=!1,this.AllowUnloadPortTypeNumber=0,this.AnotherPortTagNumber=0}}class s{constructor(){this.Notes={ConnMethod:"0:MODBUS_TCP | 1:MODBUS_RTU | 2:TCPIP | 3:SERIAL_PORT | 4:MX | 5:MC",IO_VALUE_TYPE:"0:INPUT | 1:INPUT_REGISTER"},this.ConnMethod=0,this.IP="127.0.0.1",this.Port=502,this.AGVModbusGatewayPort=502,this.ComPort="COM1",this.IsPLCAddress_Base_1=!1,this.Input_StartRegister=0,this.Input_RegisterNum=16,this.Output_Start_Address=0,this.IO_Value_Type=0}}class n{constructor(e,t=[],a=[]){this.EqGroupName=e,this.LoadPortEqTags=t,this.UnloadPortEqTags=a}}},97318:function(e,t,a){"use strict";a.d(t,{R:function(){return i}});var i={color:"white",border:"1px solid rgb(222, 226, 230)",backgroundColor:"rgb(13, 110, 253)"}},84063:function(e,t,a){"use strict";a.d(t,{i:function(){return s}});class i{constructor(){this.CurrentPage=1,this.DataNumberPerPage=20,this.StartTime=new Date(0),this.EndTime=new Date(0),this.AgvName="",this.TaskName="",this.Description=""}}class s extends i{constructor(){super(),this.TaskResult=s.TASK_RUN_STATUS.UNKNOWN,this.ActionType=s.ACTION_TYPE.Unknown}}s.TASK_RUN_STATUS={NO_MISSION:0,NAVIGATING:1,REACH_POINT_OF_TRAJECTORY:2,ACTION_START:3,ACTION_FINISH:4,WAIT:5,FAILURE:6,CANCEL:7,UNKNOWN:500},s.ACTION_TYPE={None:0,Unload:1,LoadAndPark:2,Forward:3,Backward:4,FaB:5,Measure:6,Load:7,Charge:8,Carry:9,Discharge:10,Escape:11,Park:12,Unpark:13,ExchangeBattery:14,Hold:15,Break:16,Unknown:500,NoAction:999};class n extends i{constructor(){super(),this.AlarmType=n.ALARM_TYPE_QUERY.ALL}}n.ALARM_TYPE_QUERY={ALL:"ALL",ALARM:"ALARM",WARNING:"WARNING"}},89302:function(e,t,a){"use strict";var i=a(30381),s=a.n(i);class n{constructor(e){this.TaskName=e.TaskName,this.State=e.State,this.StateName=e.StateName,this.RecieveTime=e.RecieveTime,this.FinishTime=e.FinishTime,this.DispatcherName=e.DispatcherName,this.DesignatedAGVName=e.DesignatedAGVName,this.ACTIONS={MOVE:0,LOAD:1,UNLOAD:2,CHARGE:3,CARRY:4},this.Action=e.Action,this.From_Station=e.From_Station,this.From_Slot=e.From_Slot,this.To_Station=e.To_Station,this.To_Slot=e.To_Slot,this.Carrier_ID=e.Carrier_ID,this.Priority=e.Priority,this.IsHighestPriorityTask=!1}get RecieveTime_Formated(){return s()(this.RecieveTime).format("HH:mm:ss")}get FinishTime_Formated(){return s()(this.FinishTime).format("HH:mm:ss")}get ActionName(){switch(this.Action){case 0:return"移動";case 1:return"取貨";case 2:return"取貨/停車";case 3:return"前進";case 4:return"後退";case 6:return"量測";case 7:return"放貨";case 8:return"充電";case 9:return"搬運";case 12:return"停車";case 14:return"交換電池";default:return"Unknown"}}}t.Z=n},56938:function(e,t){"use strict";class a{constructor(e){void 0==e?(this.AGV_Name="AGV",this.AGV_ID="",this.AGV_Description="",this.Model="0",this.Simulation=!1,this.MainStatus=0,this.OnlineStatus=0,this.CurrentLocation="",this.CurrentCarrierID="",this.BatteryLevel_1=0,this.BatteryLevel_2=0,this.TaskName="",this.TaskRunStatus=0,this.TaskRunAction=0,this.Theta=0,this.Connected=!1,this.StationName="",this.Group=0,this.IsCharging=!1,this.Protocol=0,this.IP="127.0.0.1",this.Port=7025,this.TaskSourceStationName="",this.TaskDestineStationName="",this.TransferProcess=0,this.CurrentAction=0,this.TaskRunAction=0,this.TaskETA="9999-12-31T23:59:59.9999999",this.IsExecutingOrder=!1,this.VehicleLength=145,this.VehicleWidth=70,this.LowBatLvThreshold=70,this.MiddleBatLvThreshold=70,this.HighBatLvThreshold=70,this.UIOptions={},this.AppVersion="1.0.0"):(this.AGV_Name=e.AGV_Name,this.AGV_ID=e.AGV_ID,this.AGV_Description=e.AGV_Description,this.Model=e.Model,this.MainStatus=e.MainStatus,this.OnlineStatus=e.OnlineStatus,this.CurrentLocation=e.CurrentLocation,this.CurrentCarrierID=e.CurrentCarrierID,this.BatteryLevel_1=e.BatteryLevel_1,this.BatteryLevel_2=e.BatteryLevel_2,this.TaskName=e.TaskName,this.TaskRunStatus=e.TaskRunStatus,this.TaskRunAction=e.TaskRunAction,this.Theta=e.Theta,this.Connected=e.Connected,this.Simulation=e.Simulation,this.StationName=e.StationName,this.Group=e.Group,this.IsCharging=e.IsCharging,this.Protocol=e.Protocol,this.IP=e.IP,this.Port=e.Port,this.TaskSourceStationName=e.TaskSourceStationName,this.TaskDestineStationName=e.TaskDestineStationName,this.TransferProcess=e.TransferProcess,this.CurrentAction=e.CurrentAction,this.TaskRunAction=e.TaskRunAction,this.TaskETA=e.TaskETA,this.IsExecutingOrder=e.IsExecutingOrder,this.VehicleLength=e.VehicleLength,this.VehicleWidth=e.VehicleWidth,this.UIOptions=e.UIOptions,this.LowBatLvThreshold=e.LowBatLvThreshold,this.MiddleBatLvThreshold=e.MiddleBatLvThreshold,this.HighBatLvThreshold=e.HighBatLvThreshold,this.AppVersion=e.AppVersion)}}t.Z=a},72924:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});class i{constructor(e){this.EqType=e,this.IsConnected=!1,this.EQName="",this.MainStatus=0,this.TransferStatus=0,this.Load_Request=!1,this.Unload_Request=!1,this.Port_Exist=!1,this.Up_Pose=!1,this.Down_Pose=!1,this.Eqp_Status_Down=!1,this.Eqp_Status_Run=!1,this.Eqp_Status_Idle=!1,this.Cmd_Reserve_Up=!1,this.Cmd_Reserve_Low=!1,this.To_EQ_Up=!1,this.To_EQ_Low=!1,this.HS_EQ_L_REQ=!1,this.HS_EQ_U_REQ=!1,this.HS_EQ_READY=!1,this.HS_EQ_UP_READY=!1,this.HS_EQ_LOW_READY=!1,this.HS_EQ_BUSY=!1,this.HS_AGV_VALID=!1,this.HS_AGV_TR_REQ=!1,this.HS_AGV_BUSY=!1,this.HS_AGV_READY=!1,this.HS_AGV_COMPT=!1,this.Region="",this.Tag=0,this.Full_CST=!1,this.Empty_CST=!1,this.To_EQ_Full_CST=!1,this.To_EQ_Empty_CST=!1,this.IsMaintaining=!1,this.IsPartsReplacing=!1}get IsReserved(){return this.Cmd_Reserve_Up||this.Cmd_Reserve_Low}}},91648:function(e,t,a){"use strict";a.d(t,{ce:function(){return c},$x:function(){return h},__:function(){return d},F6:function(){return r},gU:function(){return l},lF:function(){return u},JV:function(){return m}});a(62062);var i=a(9669),s=a.n(i),n=a(663);a(53259),n.Z.backend_host.replace("http","ws");var o=s().create({baseURL:n.Z.backend_host});async function l(){return await o.get("/api/Alarm/SystemAlarmReset")}async function r(){return await o.get("/api/Alarm/EquipmentAlarmReset")}async function d(e,t,a,i="ALL",s="ALL",n="ALL",l="ALL"){var r=await o.get(`/api/Alarmquery/QueryAlarm?currentpage=${e}&StartTime=${t}&EndTime=${a}&AGV_Name=${i}&TaskName=${s}&AlarmType=${n}&Alarm_description=${l}`);return r.data}async function c(e){var t=await o.delete(`/api/Alarm/Delete?time=${e}`);return t.data}async function u(e,t,a="ALL",i="ALL",s="ALL"){const n=await o.get(`/api/Alarmquery/SaveTocsv?StartTime=${e}&EndTime=${t}&AGV_Name=${a}&TaskName=${i}&Result=${s}`,{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([n.data])),r=document.createElement("a");r.href=l;let d=`AGVS_Alarms_From_${e}_To_${t}.csv`;r.setAttribute("download",d),document.body.appendChild(r),r.click()}async function m(){return await o.post("/api/Alarm/StopBuzzer")}async function h(){return(await o.get("/api/Alarm")).data}},90131:function(e,t,a){"use strict";a.d(t,{Kt:function(){return o},VM:function(){return r},fj:function(){return u},g0:function(){return n},kg:function(){return m}});var i=a(30381),s=a.n(i);const n=()=>{var e=localStorage.getItem("user");if(e+""=="null")return{};const t=JSON.parse(e);return{Authorization:`Bearer ${t.token}`}},o=()=>{const e=c();return e?`Bearer ${e.token}`:""};class l{constructor(e,t=u){this.isLogin=e,this.login_info=t}}function r(){var e=c();if(!e)return new l(!1,new u);const t=-1!=e.Role&&0==d();return t&&(e.LoginTime=Date.now()),new l(t,e)}function d(){var e=c();if(e){var t=s()(e.LoginTime).add(1,"day"),a=Date.now()>t;return a}return!0}function c(){var e=new u;const t=localStorage.getItem("user");if(t){var a=JSON.parse(t);Object.assign(e,a)}return e}class u{constructor(){this.Role=-1,this.UserName="",this.token="",this.Success=!1,this.Message="",this.LoginTime=Date.now(),this.Permission=new m}}class m{constructor(){this.menu={SystemAlarm:1,WIPInfo:0,VehicleManagnment:0,Map:0,DataQuery:1,HotRun:0,SystemConfiguration:0},this.dataQuerySubMenu={TaskHistory:1,AlarmHistory:1,VehicleTrajectory:0,InstrumentsMeasure:0,Utilization:1},this.systemConfigurationSubMenu={BatteryLevelManagnment:0,EquipmentlManagnment:0,RackManagnment:0,UserManagnment:0,ChargerManagnment:0},this.systemModesOperations={RunModeSwitch:1,AutoTransferModeSwitch:1,HostOnlineSwitch:1,HostRemoteSwitch:1}}}},43125:function(e,t,a){"use strict";a.d(t,{A:function(){return r},y:function(){return l}});var i=a(9669),s=a.n(i),n=a(663),o=s().create({baseURL:n.Z.backend_host});async function l(){console.log(Date.now());var e=await o.get("api/Availabilitys/Today");return console.log(Date.now()),e.data}async function r(e,t,a){var i=await o.get(`api/Availabilitys/Query?AGVName=${e}&StartDate=${t}&EndDate=${a}`);return i.data}},29776:function(e,t,a){"use strict";a.d(t,{O:function(){return o}});var i=a(42152),s=a.n(i),n=a(49996);function o(e){const t=new(s())(".copy-button",{text:()=>e});t.on("success",(()=>{(0,n.bM)({title:e,message:"已複製到剪貼簿",duration:1500}),t.destroy()})),t.on("error",(()=>{t.destroy()}))}},19578:function(e,t){"use strict";class a{constructor(){this.AGVName="ALL",this.Result=0,this.StartTimeStr="",this.EndTimeStr="",this.DataNumPerPage=15,this.Page=1}}t.Z=a},64491:function(e,t,a){"use strict";a.d(t,{Aj:function(){return h},CN:function(){return m},FJ:function(){return y},Fi:function(){return p},GV:function(){return l},H5:function(){return r},IS:function(){return f},Kz:function(){return w},PQ:function(){return S},Qu:function(){return d},c8:function(){return v},hE:function(){return _},k3:function(){return b},kr:function(){return g},qN:function(){return u},wW:function(){return c},yS:function(){return C}});var i=a(9669),s=a.n(i),n=a(663),o=s().create({baseURL:n.Z.backend_host});async function l(){var e=await o.get("/api/Equipment/GetEQData");return e.data}async function r(){var e=await o.get("/api/Equipment/GetEQOptions");return e.data}async function d(){var e=await o.get("/api/Equipment/GetWIPOptions");return e.data}async function c(e){var t=await o.post("/api/Equipment/SaveEQOptions",e,{headers:{"Content-Type":"application/json"}});return t.data}async function u(e){var t=await o.post("/api/Equipment/ConnectTest",e);return t.data}async function m(e){var t=await o.get(`/api/Equipment/GetEQInfoByTag?Tag=${e}`);return t.data}async function h(e,t,a){var i=`/api/Equipment/AgvHsSignal?EqName=${encodeURIComponent(e)}&SignalName=${encodeURIComponent(t)}&State=${a}`,s=await o.post(i);return s.data}async function p(e,t){var a=`/api/Equipment/SetToFullRackStatus?EqName=${encodeURIComponent(e)}&&State=${t}`,i=await o.post(a);return i.data}async function g(e,t){var a=`/api/Equipment/SetToEmptyRackStatus?EqName=${encodeURIComponent(e)}&&State=${t}`,i=await o.post(a);return i.data}async function _(e,t){var a=`/api/Equipment/SetToFullRackStatusByEqTag?eqTag=${e}&&State=${t}`,i=await o.post(a);return i.data}async function w(e,t){var a=`/api/Equipment/SetToEmptyRackStatusByEqTag?eqTag=${e}&&State=${t}`,i=await o.post(a);return i.data}async function f(){var e="/api/Equipment/EqGroups",t=await o.get(e);return t.data}async function y(e){var t="/api/Equipment/SaveEqGroupsConfigs",a=await o.post(t,e);return a.data}async function v(){var e="/api/Equipment/CheckMapPointsIsEqTypeButNoEqSetup",t=await o.get(e);return t.data}const S={async SetState(e,t){var a=`/api/Equipment/Emu/State?EqName=${encodeURIComponent(e)}&State=${t}`,i=await o.get(a);return i.data},async EQDownStatusSimulation(e,t){var a=`/api/Equipment/Emu/EQDownStatusSimulation?TagNumber=${e}&isDown=${t}`,i=await o.get(a);return i.data},async SwitchMaintainstate(e,t){var a=`/api/Equipment/Emu/MaintainStatusSimulation?TagNumber=${e}&isMaintain=${t}`,i=await o.get(a);return i.data},async SwitchPartsReplacing(e,t){var a=`/api/Equipment/Emu/PartsReplcingSimulation?TagNumber=${e}&isPartsReplcing=${t}`,i=await o.get(a);return i.data},async EQAllLoad(){var e="/api/Equipment/Emu/AllLoad",t=await o.get(e);return t.data},async EQAllBusy(){var e="/api/Equipment/Emu/AllBusy",t=await o.get(e);return t.data},async SetEQHsSignal(e,t,a){var i=`/api/Equipment/Emu/HsSignal?EqName=${encodeURIComponent(e)}&SignalName=${encodeURIComponent(t)}&State=${a}`,s=await o.get(i);return s.data},async SetUpPose(e){var t=`/api/Equipment/Emu/SetUpPose?EqName=${encodeURIComponent(e)}`,a=await o.get(t);return a.data},async SetDownPose(e){var t=`/api/Equipment/Emu/SetDownPose?EqName=${encodeURIComponent(e)}`,a=await o.get(t);return a.data},async SetUnknownPose(e){var t=`/api/Equipment/Emu/SetUnknownPose?EqName=${encodeURIComponent(e)}`,a=await o.get(t);return a.data}},b={async SetSensorState(e,t,a,i,s){var n=`/api/WIPEmu/SetSensorState?rack_id=${e}&port_id=${t}&cargo_type=${a}&sensor_number=${i}&state=${s}`,l=await o.get(n);return l.data}},C={async SetCurveSetting(e,t,a){var i=`/api/Equipment/ChargeStation/Settings?EqName=${encodeURIComponent(e)}&Item=${encodeURIComponent(t)}&Value=${a}`,s=await o.get(i);return s.data},async SaveUsableAGVSetting(e,t){var a=`/api/Equipment/ChargeStation/SaveUsableAGVSetting?ChargeStationName=${encodeURIComponent(e)}`,i=await o.post(a,t);return i.data},async ModifyTagNumber(e,t){var a=`/api/Equipment/ChargeStation/ModifyTagNumber?ChargeStationName=${encodeURIComponent(e)}`,i=await o.post(a,[t]);return i.data}}},83592:function(e,t,a){"use strict";a.d(t,{Ml:function(){return u},j2:function(){return d}});a(67635);var i=a(9669),s=a.n(i),n=a(663),o=a(95320),l=s().create({baseURL:o.p.getters.MapServerUrl}),r=s().create({baseURL:n.Z.vms_host});async function d(){return await l.get("api/Map/RegionOptions").then((e=>{var t=e.data;return o.p.commit("RegionOptions",t),t})).catch((e=>{}))}const c={GetMapFromLocal(){return l.get("api/Map").then((e=>e.data)).catch((e=>{}))},GetGeoMap(){return l.get("api/Map/GeoMapJson").then((e=>e.data)).catch((e=>{}))},GetMapTags(){return l.get("api/Map/Tags").then((e=>e.data)).catch((e=>{}))},ReloadMap(){return l.get("api/Map/ReloadMap").then((e=>(o.p.dispatch("DownloadMapData"),e.data))).catch((e=>{}))},GetAGVList(){return l.get("api/Map/AGVList").then((e=>e.data)).catch((e=>{}))},PathPlanByTag(e,t){return l.get(`api/Map/PathPlan?fromTag=${e}&toTag=${t}`).then((e=>e.data)).catch((e=>{}))},GetMapStationTemplate(){return l.get("api/Map/MapPointTemplate").then((e=>e.data)).catch((e=>{}))},Regist(e){return r.get(`api/Map/Regist?Tag_Number=${e}`).then((e=>e.data)).catch((e=>{}))},Unregist(e){return r.get(`api/Map/Unregist?Tag_Number=${e}`).then((e=>e.data)).catch((e=>{}))}},u=[{label:"Normal",value:0},{label:"EQ",value:1},{label:"STK",value:2},{label:"Charge",value:3},{label:"Buffer",value:4},{label:"Buffer_EQ",value:41},{label:"Charge & Buffer",value:5},{label:"Charge & STK",value:6},{label:"Battery_Exchanger",value:7},{label:"Escape",value:8},{label:"EQ_LD",value:11},{label:"STK_LD",value:12},{label:"EQ_ULD",value:21},{label:"STK_ULD",value:22},{label:"Fire Door",value:31},{label:"Fire EQ",value:32},{label:"Auto Door",value:33},{label:"Elevator",value:100},{label:"Elevator",value:201},{label:"Elevator_LD",value:201},{label:"Elevator_ULD",value:221},{label:"Repair",value:110}];t.ZP=c},3567:function(e,t,a){"use strict";a.d(t,{AE:function(){return r},Bj:function(){return d},CX:function(){return u},Fy:function(){return h},GZ:function(){return c},IG:function(){return p},O1:function(){return m},Wp:function(){return g},x0:function(){return _}});var i=a(9669),s=a.n(i),n=a(663),o=a(19578),l=s().create({baseURL:n.Z.backend_host});async function r(e=o.Z){var t=await l.post("/api/InstrumentMeasure",e);return t.data}async function d(){var e=await l.get("/api/InstrumentMeasure/GetBayNamesMeasured");return e.data}async function c(e){var t=await l.get(`/api/InstrumentMeasure/GetTagsOfBay?bayName=${e}`);return t.data}async function u(){var e=await l.get("/api/InstrumentMeasure/GetMeasureItems");return e.data}async function m(e){var t=await l.post("/api/InstrumentMeasure/QueryItemTrendData",e);return t.data}async function h(){var e=await l.get("/api/InstrumentMeasure/GetMeasureSchedules");return e.data}async function p(e,t){var a=await l.delete(`/api/InstrumentMeasure/DeleteSchedule?time=${e}&agv_name=${t}`);return a.data}async function g(e){var t=await l.post("/api/InstrumentMeasure/AddNewMeasureSchedule",e);return t.data}async function _(e,t,a){var i=await l.post(`/api/InstrumentMeasure/ModifyMeasureSchedule?time=${e}&agv_name=${t}`,a);return i.data}},93867:function(e,t,a){"use strict";var i=a(96425);a(45418),a(79517);let s={Success(e,t="bottom",a=3e3){(0,i.NU)({message:e,position:t,type:"success",duration:a,background:"rgba(7, 193, 96, 0.9)",onclick:()=>{(0,i.rz)()}})},Primary(e,t="top",a=3e3){(0,i.NU)({message:e,position:t,type:"primary",duration:a,onclick:()=>{(0,i.rz)()}})},Danger(e,t="top",a=3e3){(0,i.NU)({message:e,position:t,type:"danger",duration:a,onclick:()=>{(0,i.rz)()}})},Warning(e,t="top",a=3e3){(0,i.NU)({message:e,position:t,type:"warning",duration:a,onclick:()=>{(0,i.rz)()}})}};t.Z=s},23794:function(e,t,a){"use strict";var i=a(9669),s=a.n(i),n=a(663),o=(a(25044),s().create({baseURL:n.Z.secs_platform_host}));let l={async getSecsNewestMessages(){let e=await o.get("/api/LogHistory/newest");return e.data},async getConnectionState(){let e=await o.get("/api/HostMode/ConnectToHostStatus");return e.data}};t.Z=l},43556:function(e,t,a){"use strict";a.d(t,{H1:function(){return u},Hk:function(){return c},fw:function(){return m},jw:function(){return d},m0:function(){return r},pw:function(){return l}});var i=a(9669),s=a.n(i),n=a(663),o=s().create({baseURL:n.Z.backend_host});async function l(){var e=await o.get("api/System/WebSite");return e.data}async function r(e=1){var t=await o.get("api/system/OperationStates");return t.data}async function d(e=1,t=!1){var a=await o.post(`api/system/runmode?mode=${e}&forecing_change=${t}`);return a.data}async function c(e=1){var t=await o.post(`api/system/hostconn?mode=${e}`);return t.data}async function u(e=1){var t=await o.post(`api/system/hostoperation?mode=${e}`);return t.data}async function m(e=1){var t=await o.post(`api/system/TransferMode?mode=${e}`);return t.data}},20840:function(e,t,a){"use strict";a.d(t,{AE:function(){return r},c6:function(){return u},e$:function(){return p},i1:function(){return m},lF:function(){return d},mA:function(){return h},tQ:function(){return c}});a(62062);var i=a(9669),s=a.n(i),n=a(663),o=a(84063),l=s().create({baseURL:n.Z.backend_host});async function r(e=new o.i){var t=await l.post("/api/TaskQuery",e);return t.data}async function d(e,t,a="ALL",i="ALL",s="ALL"){const n=await l.get(`/api/TaskQuery/SaveTocsv?StartTime=${e}&EndTime=${t}&AGV_Name=${a}&TaskName=${i}&Result=${s}`,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([n.data],{type:"text/csv;charset=utf-8;"})),r=document.createElement("a");r.href=o;let d=`AGVS_Task_From_${e}_To_${t}.csv`;r.setAttribute("download",d),document.body.appendChild(r),r.click()}async function c(e,t,a,i=""){var s=await l.get(`/api/TaskQuery/GetTasks?agv_name=${a}&start=${e}&end=${t}&taskID=${i}`);return s.data}async function u(e){var t=await l.get(`/api/TaskQuery/GetTrajectory?taskID=${e}`);return t.data}async function m(e,t){var a=await l.get(`/api/TaskQuery/GetTrajectorysWithTimeRange?from=${e}&to=${t}`);return a.data}async function h(e){var t=await l.get(`/api/TaskQuery/DeleteTask?taskID=${e}`);return t.data}async function p(e,t){var a=await l.post(`/api/TaskQuery/ExportTaskHistoryDataOfDays?from_date=${e}&to_date=${t}`);return a.data}},8764:function(e,t,a){"use strict";a.d(t,{A5:function(){return S},AZ:function(){return k},FV:function(){return m},J8:function(){return v},Nn:function(){return f},On:function(){return p},Qk:function(){return C},Y4:function(){return h},Z$:function(){return w},ec:function(){return u},fn:function(){return g},gh:function(){return b},mc:function(){return y}});var i=a(9669),s=a.n(i),n=a(663),o=a(30381),l=a.n(o),r=a(90131),d=a(25044),c=(a(89302),s().create({baseURL:n.Z.backend_host,headers:(0,r.g0)()}));class u{constructor(e,t,a=50,i=!1){this.TaskName=`Move_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=0,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class m{constructor(e,t,a=50,i=!1){this.TaskName=`Measure_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=6,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class h{constructor(e,t,a,i,s=50,n=!1){this.TaskName=`Load_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=7,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot=a+"",this.Carrier_ID=i,this.Priority=s,this.bypass_eq_status_check=n,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class p{constructor(e,t,a,i,s=50,n=!1){this.TaskName=`Unload_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=1,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot=a+"",this.Carrier_ID=i,this.Priority=s,this.bypass_eq_status_check=n,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class g{constructor(e,t,a=50,i=!1){this.TaskName=`Charge_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=8,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class _ extends g{constructor(e,t=50,a=!1){super(e,-1,100,a),this.Action=17}}class w{constructor(e,t,a=50,i=!1){this.TaskName=`BatEx_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=14,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class f{constructor(e,t,a=50,i=!1){this.TaskName=`Park_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=12,this.DesignatedAGVName=e,this.From_Station="-1",this.From_Slot="-1",this.To_Station=t+"",this.To_Slot="-1",this.Carrier_ID="-1",this.Priority=a,this.bypass_eq_status_check=i,this.need_change_agv=!1,this.ChangeAGVMiddleStationTag=0,this.TransferToDestineAGVName=""}}class y{constructor(e,t,a,i,s,n,o=50,r=!1,d=!1,c=-1,u=""){this.TaskName=`Local_${l()(Date.now()).format("yyMMDD_HHmmssSSS")}`,this.Action=9,this.DesignatedAGVName=e,this.From_Station=t+"",this.From_Slot=a+"",this.To_Station=i+"",this.To_Slot=s+"",this.Carrier_ID=n,this.Priority=o,this.bypass_eq_status_check=r,this.need_change_agv=d,this.ChangeAGVMiddleStationTag=c,this.TransferToDestineAGVName=u}}var v={async Task(){c.get("/api/Task/Allocation").then((e=>{console.log("Response:",e.data)})).catch((e=>{console.error("Error:",e)}))},async RedoTask(e=new e({}),t=!1){return await T("/api/Task/ReAssignTask",e,`autoSelectVehicle=${t}`)},async Cancel(e){try{var t=await c.get(`/api/Task/Cancel?task_name=${e}`);return t.data}catch(a){throw a}},async MoveTask(e=new e("agv",1)){return await T("/api/Task/Move",e)},async MeasureTask(e=new e("agv",1)){return await T("/api/Task/Measure",e)},async LoadTask(e=new e("agv",1,1,"CST_ID")){return await T("/api/Task/Load",e)},async UnloadTask(e=new e("agv",1,1,"CST_ID")){return await T("/api/Task/Unload",e)},async CarryTask(e){return await T("/api/Task/Carry",e)},async ChargeTask(e){return await T("/api/Task/Charge",e)},async CancelChargeTask(e){var t=await c.get(`/api/Task/CancelChargeTask?agv_name=${e}`);return t.data},async ExangeBatteryTask(e){return await T("/api/Task/ExangeBattery",e)},async ParkTask(e){return await T("/api/Task/Park",e)},async DeepCharge(e){return await T("/api/Task/DeepCharge",new _(e,100,!1))}};async function S(e){console.log("post:"+JSON.stringify(e));var t=await c.post("/api/HotRun",e);return t.data}async function b(){var e=await c.get("/api/HotRun");return e.data}async function C(e){var t=await c.get(`/api/HotRun/Start?scriptID=${e}`);return t.data}async function k(e){await c.get(`/api/HotRun/Stop?scriptID=${e}`)}async function T(e,t,a=""){var i=`?user=${d.HP.getters.UserName}&${a}`;return e+=i,c.post(e,t).then((e=>(console.log("Response:",e.data),{status:e.status,data:e.data}))).catch((e=>(console.error("Error:",e),{status:e.response.status,data:e.response.data,message:e.message})))}},82106:function(e,t,a){"use strict";a.d(t,{E4:function(){return g},FU:function(){return p},HG:function(){return m},Yo:function(){return _},Zu:function(){return d},hB:function(){return w},jf:function(){return r},l2:function(){return u},m3:function(){return c},mm:function(){return h}});var i=a(9669),s=a.n(i),n=a(663),o=a(90131),l=s().create({baseURL:n.Z.backend_host,headers:{Authorization:(0,o.Kt)()}});async function r(){var e=await l.get("api/Auth/Users");return e.data}async function d(){var e=await l.post("api/Auth/Verify");return e.data.Success}async function c(e){try{var t=await l.post("api/Auth/login",e);return console.info(t),p(t.data),t.data}catch(a){return a.response.data}}async function u(e){var t=await l.post("api/Auth/modify",e);return t.data}async function m(e){var t=await l.delete(`api/Auth/Delete?user_name=${e}`);return t.data}async function h(e){var t=await l.post("api/Auth/Add",e);return t.data}function p(e){localStorage.setItem("user",JSON.stringify(e))}async function g(e){var t=await l.get(`api/Auth/GetPermissionSettings?userName=${e}`);return t.data}async function _(e,t){await l.post(`api/Auth/SavePermissionSettings?userName=${e}`,t)}async function w(e,t){var a=await l.get(`api/Auth/UserRouteChange?userID=${e}&current_route=${t}`);return a.data}},38418:function(e,t,a){"use strict";a.d(t,{PQ:function(){return g},PX:function(){return c},UT:function(){return d},ZM:function(){return u},bh:function(){return p},fO:function(){return h},vR:function(){return m}});var i=a(9669),s=a.n(i),n=a(663),o=a(25044),l=a(81348),r=(s().create({baseURL:n.Z.backend_host}),s().create({baseURL:n.Z.vms_host}));async function d(e,t=0){return await r.get(`/api/VmsManager/OnlineRequet?agv_name=${e}&model=${t}`)}async function c(e,t=0){return await r.get(`/api/VmsManager/OfflineRequet?agv_name=${e}&model=${t}`)}async function u(e,t){var a=await r.post(`/api/VmsManager/AGVLocating?agv_name=${e}`,t);return a.data}async function m(e){var t=await r.post(`/api/VmsManager/UnregisterFromNetwork?agv_name=${e}`);return t.data}var h={AddVehicle:async e=>{try{var t=await r.post("/api/VmsManager/AddVehicle",e);return t.data}catch(a){return{confirm:!1,message:`與VMS系統通訊失敗(${a})`}}},EditVehicle:async(e,t)=>{var a=await r.post(`/api/VmsManager/EditVehicle?oriAGVID=${t}`,e);return a.data},DeleteVehicle:async e=>{var t=await r.delete(`/api/VmsManager/DeleteVehicle?AGV_Name=${e}`);return t.data},ShutDownAllVehicles:async()=>{var e=o.sn.getters.AGVIPCollection;e.forEach((e=>{setTimeout((()=>{var t=s().create({baseURL:`http://${e}:7025`,timeout:1e3});t.post("/api/System/ShutDownPC").then((t=>{(0,l.z8)({type:"success",message:`${e} ${t.data}`})})).catch((t=>{(0,l.z8)({type:"error",message:`${e} 關機失敗:${t.message}`,duration:3e3})}))}),100)}))}};const p={GetSettings:async()=>{var e=await r.get("api/vehiclebattery");return e.data},ModifySetting:async(e,t)=>{var a=await r.post(`api/vehiclebattery?agvName=${e}`,t);return a.data},StopDeepCharge:async e=>{var t=await r.post(`api/VmsManager/StopDeepCharge?agvName=${e}`);return t.data}},g={Initialize:async e=>{var t=await r.get(`api/AGVSimulation/Initialize?AGVName=${e}`);return t.data},RemoveCargo:async e=>{var t=await r.get(`api/AGVSimulation/CargoRemove?AGVName=${e}`);return t.data},EMO:async e=>{var t=await r.get(`api/AGVSimulation/EMO?AGVName=${e}`);return t.data}}},69215:function(e,t,a){"use strict";a.d(t,{Bh:function(){return d},m7:function(){return l},p_:function(){return c},pz:function(){return r},ts:function(){return u}});var i=a(9669),s=a.n(i),n=a(663),o=s().create({baseURL:n.Z.backend_host});async function l(e,t,a){let i={confirm:!1,message:"no-response"};try{var s=await o.post(`/api/WIP/ModifyCargoID?WIPID=${e}&PortID=${t}&NewCargoID=${a}`);_.merge(i,s.data)}catch(n){i.message=n.message}return i}async function r(e,t){let a={confirm:!1,message:"no-response"};try{var i=await o.post(`/api/WIP/RemoveCargoID?WIPID=${e}&PortID=${t}`);_.merge(a,i.data)}catch(s){a.message=s.message}return a}async function d(e,t,a){var i=await o.post(`/api/WIP/PortUsableSwitch?WIPID=${e}&PortID=${t}&Usable=${a}`);return i.data}async function c(){var e=await o.get("/api/WIP/GetAllSlotsOptions");return e.data}async function u(){var e=await o.get("/api/WIP/GetRackStatusData");return e.data}},2781:function(e,t,a){"use strict";a.d(t,{O:function(){return u},d:function(){return m}});var i=a(9669),s=a.n(i),n=(a(663),a(95320)),o=a(79072),l=a(81090),r=s().create({baseURL:n.p.getters.MapServerUrl});class d{constructor(e=999,t=0,a=""){this.FeatureType=e,this.TagNumber=t,this.Display=a}}class c{constructor(e="",t=""){this.Name=e,this.Source=t}}async function u(e=new l.Z){const t=e.get("data"),a=e.get("feature_type");let i=new d;if(t){let e=new o.ux;_.merge(e,t),i=new d(0,e.TagNumber,e.Graph.Display),console.trace(`user clicked point- Tag:${e.TagNumber}, Display:${e.Graph.Display}`)}else"agv"==a&&(i.FeatureType=2,i.Display=e.get("agvname")),"path"==a&&(i.FeatureType=1,i.Display=e.get("path_id"));try{console.log("post ",i),await r.post("/api/WebUIOperate/MapOperate",i)}catch(s){console.error(s)}}async function m(e="unknown",t="unknown"){if(""===e)return;let a=new c(e,t);try{await r.post("/api/WebUIOperate/ElementClicked",a)}catch(i){console.error(i)}}},81365:function(e,t,a){"use strict";a.d(t,{P:function(){return i}});class i{constructor(e="",t=""){this.source=e,this.selectedComponentName=t}isAddPoint(){return"add-point"==this.source}getStationTypeWithComponentSelected(){return"normal-point"==this.selectedComponentName?0:"eq-point"==this.selectedComponentName?1:"stocker-point"==this.selectedComponentName?2:"charge-station-point"==this.selectedComponentName?3:"rack-point"==this.selectedComponentName?4:"auto-door-point"==this.selectedComponentName?33:0}getGeneralNameByStationType(){return"normal-point"==this.selectedComponentName?"一般點位":"eq-point"==this.selectedComponentName?"設備":"stocker-point"==this.selectedComponentName?"Stocker":"charge-station-point"==this.selectedComponentName?"充電站":"rack-point"==this.selectedComponentName?"Rack":"auto-door-point"==this.selectedComponentName?"自動門":"一般點位"}}},79072:function(e,t,a){"use strict";a.d(t,{Be:function(){return T},DS:function(){return A},Di:function(){return ee},Ew:function(){return F},G:function(){return _},H6:function(){return P},HB:function(){return E},IN:function(){return R},K$:function(){return W},MV:function(){return te},P0:function(){return Z},Qw:function(){return N},S9:function(){return K},UY:function(){return J},Xl:function(){return M},a_:function(){return ie},bE:function(){return I},eX:function(){return z},h0:function(){return k},l3:function(){return se},oy:function(){return L},q4:function(){return $},rL:function(){return V},s6:function(){return x},tW:function(){return D},ux:function(){return Y},xK:function(){return X},xZ:function(){return U}});a(57658);var i=a(81332),s=a(58958),n=a(35393),o=a(51345),l=a(30283),r=a(47539),d=a(21280),c=a(60188),u=a(69242),m=a(81090),h=(a(45243),a(95320)),p=a(663);function g(){return!1}g()&&p.Z.backend_host;function _(e){var t=h.p.getters.MapData.Points,a=t[e];return a||{}}function w(e,t=[64,64],a=.45){return new i.Z({src:""==e?"/images/eq-icon.png":e,scale:a,anchor:[.5,.2],size:t,opacity:1,color:"transparent"})}function f(e){return new i.Z({src:""==e?"/images/charging-station.png":e,scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,color:"transparent"})}function y(e){return new i.Z({src:""==e?"/images/rack.png":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"})}function v(e){return new i.Z({src:""==e?"/images/rack_charge_station.png":e,scale:.5,anchor:[.5,.5],size:[64,64],opacity:1,color:"yellow"})}function S(e){return new i.Z({src:""==e?"/images/stk_.jpg":e,scale:.45,anchor:[.5,.5],size:[64,64],opacity:1,color:"white"})}function b(e){return new i.Z({src:""==e?"/images/lifter_icon.png":e,scale:.35,anchor:[.5,.5],size:[128,128],opacity:1,color:"white"})}new i.Z({src:"/images/location.png",offset:[-25,-5],scale:.5,size:[180,180]});const C=new i.Z({src:"/images/location.png",offset:[-120,-40],scale:.6,size:[300,300]});function k(e=new Y){var t="orange";const a=new s.Z({color:"black",width:2});if(e){if(!e.Enable)return new n.Z({fill:new o.Z({color:"red"}),stroke:new s.Z({color:"red",width:2}),points:4,radius:10,radius2:0,angle:Math.PI/4});if(t=e.IsVirtualPoint?"grey":e.IsTrafficCheckPoint?"rgb(13, 110, 253)":"orange",e.IsAvoid)return new n.Z({fill:new o.Z({color:"orange"}),stroke:a,points:3,radius:6,angle:0})}return new l.Z({radius:6,fill:new o.Z({color:t}),stroke:a})}function T(e,t="",a="rgb(13, 110, 253)"){let i=new m.Z({geometry:new c.Z(e)});return i.setStyle(new r.ZP({image:C,text:new d.Z({text:t,font:"bold 26px Calibri,sans-serif",offsetX:-7,offsetY:-89,fill:new o.Z({color:"white"}),stroke:new s.Z({color:"black",width:2}),backgroundFill:new o.Z({color:a}),padding:[5,9,5,9]})})),i}function D(e,t=!0,a="",n="red"){let l=new m.Z({geometry:new c.Z(e)});return l.setStyle(new r.ZP({image:new i.Z({src:"/images/location.png",offset:[-25,-5],scale:.5,size:[180,180]}),text:new d.Z({text:a,font:"bold 16px Calibri,sans-serif",offsetX:14,offsetY:-22,fill:new o.Z({color:"gold"}),stroke:new s.Z({color:"black",width:2})})})),l}function V(e="",t=0,a=new Y,i=[64,64],s=.45){var n=k(a);if(0==t)n=k(a);else if(1==t){const e=a.Graph.ImageScale,t=a.Graph.ImageSize;n=w(a.Graph.ImageName,t,e)}else 2==t||12==t||22==t?n=S(a.Graph.ImageName):4==t||41==t?n=y(a.Graph.ImageName):5==t||6==t?n=v(a.Graph.ImageName):3==t?n=f(a.Graph.ImageName):100!=t&&201!=t||(n=b(a.Graph.ImageName));var l=h.p.getters.Settings.normalStationTextColor,c=h.p.getters.Settings.workStationTextColor,u=h.p.getters.Settings.normalStationTextFontSize,m=h.p.getters.Settings.workStationTextFontSize,p=a.Enable?0==t?l:c:"rgb(255, 102, 92)",g=0==t?u:m,_=new r.ZP({image:n,text:new d.Z({text:e+""+(a.Enable?"":"(已禁用)"),font:`bold ${g}px Calibri,sans-serif`,offsetX:a.Graph.textOffsetX,offsetY:a.Graph.textOffsetY,fill:new o.Z({color:p}),backgroundFill:0==t?void 0:new o.Z({color:"rgba(152, 209, 224,.2)"}),padding:[1,6,20,6]})});return _}function A(e,t=7,a=void 0){return a?[new r.ZP({stroke:new s.Z({color:a,width:t+10})}),new r.ZP({stroke:new s.Z({color:e,width:t})})]:new r.ZP({stroke:new s.Z({color:e,width:t})})}function I(e,t=void 0){var a=h.p.getters.Settings.pathColor,n=(e.get("data"),e.get("isEqLink")),o=e.get("isClose");const l=e.getGeometry(),d=[new r.ZP({stroke:new s.Z({color:o?"red":a,width:2.7,lineDash:n?[4,11]:null})})],u=l.getCoordinates();var m=0;return l.forEachSegment((function(e,t){if(m==u.length-2){const s=t[0]-e[0],l=t[1]-e[1],u=Math.atan2(l,s);if(d.push(new r.ZP({geometry:new c.Z(t),image:new i.Z({src:"/arrow.png",anchor:n?[1.8,.5]:[1.2,.5],rotateWithView:!0,rotation:-u,scale:.2,color:o?"red":a})})),o){e=[(t[0]+e[0])/2,(t[1]+e[1])/2];const a=t[0]-e[0],s=t[1]-e[1],n=Math.atan2(s,a);d.push(new r.ZP({geometry:new c.Z(e),image:new i.Z({src:"/close.png",anchor:[1.2,.5],rotateWithView:!0,rotation:-n,scale:.6})}))}}m+=1})),d}function x(e,t,a){var i=new z;i.coordination=e,i.index=t,i.station_type=0,i.tag=i.index,i.graph=e;var s=new Y;let n=0;const o=h.p.state.toolState;var l="新站點";o.isAddPoint()&&(n=o.getStationTypeWithComponentSelected(),l=o.getGeneralNameByStationType()),i.name=`${l}`,i.data=s,i.station_type=n,s.Enable=!0,s.StationType=n,s.X=e[0],s.Y=e[1],s.Graph.X=e[0],s.Graph.Y=e[1],s.TagNumber=i.index,s.Name=s.Graph.Display=i.name;var r=E(i);return r}function E(e=new z){const t=new m.Z({geometry:new c.Z(e.coordination)});t.set("index",e.index),t.set("name",e.name),t.set("station_type",e.station_type),t.set("targets",e.targets),t.set("feature_type","station"),t.set("data",e.data),t.set("coordination",e.coordination),t.set("graph",e.graph);var a=e.name;t.setStyle(V(a,e.station_type,e.data));var i=t.clone();return e.data.Graph&&i.setGeometry(new c.Z([e.data.Graph.X,e.data.Graph.Y])),t.set("routeModeFeature",i),t}function M(e=new z,t=0){var a="coordination"==t?e.coordination:e.graph;const i=new m.Z({geometry:new c.Z(a)});i.set("feature_type","lduld"),i.set("data",e.data),i.set("action",0);var n=new r.ZP({image:void 0,text:new d.Z({font:"bold 14px Calibri,sans-serif",offsetX:14,offsetY:-52,stroke:new s.Z({width:1}),fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:"seagreen"}),backgroundStroke:new s.Z({color:"grey",width:2}),rotation:.15,padding:[5,5,5,5]})});return i.setStyle(n),i}function P(e="禁制區",t=[],a=1){var i=0==a,n=i?"rgba(255, 0, 0,0.5)":"rgba(116, 249, 42,0.2)",l=i?"orange":"rgba(139, 171, 206,0.5)",h=i?"red":"seagreen",p=i?"forbid":"passible",g=new m.Z(new u.ZP([t]));g.setStyle(new r.ZP({fill:new o.Z({color:n}),stroke:new s.Z({width:1,color:h,lineDash:[6,6]})})),g.set("type","polygon"),g.set("name",e),g.set("region_type",p);const _=g.getGeometry().getInteriorPoint().getCoordinates();var w=new m.Z({geometry:new c.Z(_),name:e});return w.set("type","text"),w.set("name",e),w.set("region_type",p),w.setStyle(new r.ZP({text:new d.Z({text:w.get("name"),scale:.8,font:"bold 22px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:l}),padding:[5,5,5,5]})})),{region_feature:g,text_feature:w}}function O(e,t=!1){if(!t)return null;let a="images/tray.png",s=.8,n=[1.3,.95],o=[60,60];return 200!=e&&201!=e?(a="images/unknown_cargo_orange.png",s=.6,n=[1.4,1.35],o=[64,64]):(a=201==e?"images/rack2.png":"images/tray.png",s=201==e?.8:.12,n=201==e?[1.3,.95]:[1,.85],o=201==e?[60,60]:[1052,781]),new i.Z({src:a,scale:s,anchor:n,size:o,opacity:1})}function N(e=0,t="",a=!1){return new r.ZP({image:O(e,a),text:new d.Z({text:t,offsetX:-5,offsetY:-45,textAlign:"left",font:"bold 16px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:"rgba(0, 0, 176,0.7)"}),backgroundStroke:new s.Z({color:"#333",width:2,lineDash:[3,3],lineCap:"round",lineJoin:"round"}),padding:[8,8,8,8]})})}function L(e=new m.Z,t=new B){var a=N(t.cargo_type,t.cst_id,t.exist);e.setStyle(a)}var G=(e="submarine")=>"submarine"==e?new i.Z({src:"/agv_submarine.png",scale:.5,anchor:[.5,.5],size:[87,134],opacity:1,rotation:0*Math.PI/180}):"forklift"==e?new i.Z({src:"/agv_forklift.png",scale:.5,anchor:[.5,.5],size:[87,134],opacity:1,rotation:0*Math.PI/180}):new i.Z({src:"/agv2.png",scale:.6,anchor:[.5,.5],size:[64,64],opacity:.9,rotation:0*Math.PI/180});function R(e,t){return new r.ZP({image:new i.Z({src:"/agv.png",scale:.6,anchor:[.5,.5],size:[64,64],opacity:1,rotation:0*Math.PI/180}),text:new d.Z({text:e,offsetX:0,offsetY:32,font:"bold 16px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:t}),backgroundStroke:new s.Z({color:"black"}),textAlign:"center",padding:[4,4,4,4]})})}function W(e,t,a="submarine"){return new r.ZP({image:G(a),text:new d.Z({text:e,offsetX:0,offsetY:32,font:"bold 12px Arial",fill:new o.Z({color:"white"}),backgroundFill:new o.Z({color:t}),backgroundStroke:new s.Z({color:"black"}),textAlign:"center",padding:[6,8,6,8]})})}function U(e,t=1){var a=document.createElement("div");a.style.color=e,document.body.appendChild(a);var i=window.getComputedStyle(a).color;document.body.removeChild(a);var s=i.replace("rgb","rgba").replace(")",`, ${t})`);return s}function H(e,t=new B){return 0==e?t.exist?"跑貨":"移動":1==e?"取貨":2==e?"放貨停車":3==e?"前進":4==e?"後退":5==e?"Fab?":6==e?"量測":7==e?"放貨":8==e?"充電":9==e?"搬運":10==e?"移出充電站":11==e?"快逃":12==e?"停車":13==e?"離開停車":14==e?"電池交換":15==e?"Hold":16==e?"Break":17==e?"":void 0}class ${constructor(e=1,t=[new F]){this.AGVNum=e,this.AGVDisplays=t}}class F{constructor(e="AGV",t=0,a="pink",i=[0,0],s=[],n=new B,o=0,l=0,r=new q,d=0,c=new j,u="",m=145,h=80){this.AgvName=e,this.AgvModel=t,this.TextColor=a,this.Coordination=i,this.NavPathCoordinationList=s,this.CargoStatus=n,this.Tag=o,this.Theta=l,this.WaitingInfo=r,this.CurrentAction=c.is_executing_task?H(d,n):"",this.AgvStates=c,this.DisplayText=""==u?e:u,this.vehicleWidth=h,this.vehicleLength=m}}class q{constructor(){this.IsWaiting=!1,this.Descrption="",this.WaitingPoint={}}}class B{constructor(e=!1,t=0,a=""){this.exist=e,this.cargo_type=t,this.cst_id=a}}class z{constructor(){this.index=0,this.name="name",this.tag=0,this.station_type=1,this.targets=[],this.coordination=[0,0],this.graph=[0,0],this.data={}}}class j{constructor(){this.is_online=!1,this.is_executing_task=!1,this.main_status="IDLE"}}class Z{constructor(){this.Version=1,this.Name=void 0,this.Options=new Q,this.Note="",this.PointIndex=0,this.Map_Image_Size=[400,400],this.Map_Image_Boundary=[-20,-20,20,20],this.Points=[new Y],this.BezierCurves={},this.Pathes=[],this.Segments=[],this.Bays={},this.Regions=[new K]}}class Q{constructor(){this.pathColor="rgb(45,42,46)",this.normalStationTextColor="orange",this.workStationTextColor="lime",this.normalStationTextFontSize=12,this.workStationTextFontSize=18,this.fontSizeOfDisplayName=12,this.fontSizeOfAsCandicates=16,this.Rotation=0,this.EQIcons=[],this.gridSize=1,this.gridOffsetX=0,this.gridOffsetY=0,this.defaultShowBackgroudImage=!0}}class Y{constructor(){this.X=0,this.Y=0,this.Name="",this.TagNumber=0,this.Direction=0,this.Direction_Avoid=0,this.Direction_Secondary_Point=0,this.UseAvoidThetaWhenStopAtWaitingPointOfEntryRegion=!1,this.AlwayTurnToAvoidThetaWhenWaitingTrafficControl=!1,this.AGV_Alarm=!1,this.Enable=!0,this.IsStandbyPoint=!1,this.IsSegment=!1,this.IsOverlap=!1,this.IsParking=!1,this.IsAvoid=!1,this.IsVirtualPoint=!1,this.IsAutoDoor=!1,this.IsExtinguishing=!1,this.InvolvePoint="",this.StationType=0,this.LsrMode=1,this.Speed=1,this.Bay="",this.Graph={Display:"",X:0,Y:0,ImageName:"",ImageScale:.45,ImageSize:[64,64],IsBezierCurvePoint:!1,BezierCurveID:"",textOffsetX:0,textOffsetY:-22,rackDisplay:new ae},this.Target={},this.DodgeMode=0,this.SpinMode=0,this.SubMap="",this.AutoDoor={KeyName:"",KeyPassword:""},this.MotionInfo={ControlBypass:{GroundHoleCCD:"",GroundHoleSensor:"",UltrasonicSensor:""}},this.Region="",this.IsCharge=!1,this.IsEquipment=!1,this.IsSTK=!1,this.IsEQLink=!1,this.IsCross=!1,this.IsRegisted=!1,this.IsTrafficCheckPoint=!1,this.IsTransferStation=!1,this.RegistInfo=null,this.PriorityOfTask=1,this.IsHighestPriorityStation=!1}}class K{constructor(e="",t=[],a=1){this.Name=e,this.PolygonCoordinations=t,this.RegionType=a,this.IsOpend=!0,this.IsNarrowPath=!0,this.MaxVehicleCapacity=2,this.SpeedLimit=1,this.EnteryTags=[],this.LeavingTags=[],this.ThetaLimitWhenAGVIdling=0,this.PathOnlyUseForTagsWhenVehicleFromOutsideRegion=[]}}class X{constructor(){this.title="title",this.backgroundColor="white",this.feature_type="Station",this.point_data=new Y,this.show_task_dispatch=!1,this.task_options=new J}}class J{constructor(e){this.StationType=e}}class ee{constructor(e=0,t="",a=""){this.tag=e,this.name=t,this.name_display=a}}class te{constructor(e="pink",t="RRRR",a=0){this.DisplayText=t,this.DisplayColor=e,this.Index=a}}class ae{constructor(){this.Rotation=0,this.OffsetX=20,this.OffsetY=0}}const ie={move:{zh:"目的地",en:"Destination"},carry_destien:{zh:"搬運終點",en:"Destination"},carry_source:{zh:"搬運起點",en:"Source"},load:{zh:"目標放貨設備",en:"Load Destination"},unload:{zh:"目標取貨設備",en:"Unload Destination"},charge:{zh:"目標充電站",en:"Charge Destination"}};class se{constructor(){this.zoom=1,this.zoom_route=1,this.mode="coordination",this.center=[0,0],this.center_route=[0,0],this.station_name_display_mode="name",this.map_image_display="visible",this.legendShow=!0,this.dragActionLock=!1,this.vehicleBatStatus=!1,this.rackStatusDisplay=!0}}},95320:function(e,t,a){"use strict";a.d(t,{p:function(){return c}});a(57658);var i=a(33907),s=a(9669),n=a.n(s),o=a(79072),l=a(25044),r=(a(663),a(81365));function d(e=new o.P0){if(!e)return[];var t=e.Points;if(!t)return[];var a=Object.keys(t),i=[];return a.forEach((e=>{var a=t[e],s=new o.eX;s.index=parseInt(e),s.name=a.Name,s.station_type=a.StationType,s.tag=a.TagNumber,s.coordination=[a.X,a.Y],s.targets=[],s.graph=[a.Graph.X,a.Graph.Y],s.data=a,Object.keys(a.Target).forEach((e=>{s.targets.push(parseInt(e))})),i.push(s)})),i}const c=(0,i.MT)({state:{MapData:new o.P0,TempMapDataStack:[],MapGeoJson:null,AGVDynamicPathInfo:void 0,OthersAGVLocateInfo:[],ControledPathesBySystem:{},AGVLocUpload:{},agv_colors:["rgb(13, 110, 253)","limegreen","orange","pink","red","purple"],RegionOptions:null,Settings:{path_color:"red"},worker:new Worker(""),mapBackendServer:`${window.location.protocol}//${window.location.host}`,toolState:new r.P("add-point","")},getters:{MapBackednAxios:e=>{var t=n().create({baseURL:e.mapBackendServer});return t},CustomAGVStyles:e=>{var t={AGV_001:new o.MV("rgb(13, 110, 253)","AGV_001",0),AGV_002:new o.MV("limegreen","AGV_002",1),AGV_003:new o.MV("orange","AGV_003",2),AGV_004:new o.MV("pink","AGV_004",3)};const a=l.sn.getters.AGVNameList;var i=localStorage.getItem("custom-agv-styles");if(i){var s=JSON.parse(i),n=0;Object.keys(s).forEach((e=>{t[e]=s[e],t[e].Index=n,n+=1}))}var r=Object.keys(t).filter((e=>a.includes(e))),d={};return r.forEach((e=>{d[e]=t[e]})),d},MapData:e=>{var t=localStorage.getItem("mapData");return null==e.MapData&&t?JSON.parse(t):e.MapData},Map_Image_Size:e=>e.MapData.Map_Image_Size,Map_Image_Boundary:e=>e.MapData.Map_Image_Boundary,Pathes:e=>e.MapData.Segments,MapName:e=>null==e.MapData?"Unkown":e.MapData.Name,MapImageName:e=>null==e.MapData?"Unkown":e.MapData.ImageName,Settings:e=>e.MapData.Options,BezierCurves:e=>null==e.MapData?{}:e.MapData.BezierCurves,GeoMapData:e=>e.MapGeoJson,MapServerUrl:e=>e.mapBackendServer,MapStations:(e,t)=>{var a=e.MapData;return d(a)},BaysData:e=>e.MapData?e.MapData.Bays:{},Regions:e=>e.MapData.Regions?e.MapData.Regions:[],AGVDynamicPathInfo:e=>e.AGVDynamicPathInfo,AGVLocUpload:e=>e.AGVLocUpload,AGVNavInfo:(e,t)=>{var a=e.AGVDynamicPathInfo;if(void 0==a)return new o.q4(0,[]);var i=Object.keys(a).length,s=[new o.Ew];s=[];var n=0;Object.keys(a).forEach((i=>{if(i.toLocaleLowerCase().includes("agv")){var r=a[i],d=r.vehicleLength,c=r.vehicleWidth,u=r.nav_path,m=[],h=[0,0];if(r.currentCoordication&&(h=[r.currentCoordication.X,r.currentCoordication.Y]),u){var p=u.length;m.push(h);for(let e=1;e<p;e++){const a=u[e];var g=t.MapStations.find((e=>e.tag==a));g&&m.push(g.coordination)}}const v=l.sn.state.agv_states.find((e=>e.AGV_Name==i)),S=v.Model;var _=t.CustomAGVStyles[i],w="black",f=i;_?(w=_.DisplayColor,f=_.DisplayText):w=e.agv_colors[n];var y=new o.Ew(i,S,w,h,m,r.cargo_status,r.currentLocation,r.theta,r.waiting_info,r.currentAction,r.states,f,d,c);s.push(y),n+=1}}));var r=new o.q4(i,s);return r},OthersAGVLocateInfo:e=>e.OthersAGVLocateInfo,AllNormalStationOptions:e=>{var t=Object.values(e.MapData.Points);t=t.filter((e=>!e.IsVirtualPoint&&0==e.StationType)).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return t},AllNonVirtualStationOptions:e=>{var t=Object.values(e.MapData.Points);t=t.filter((e=>!e.IsVirtualPoint)).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return t},AllParkableStationOptions:e=>{var t=Object.values(e.MapData.Points);t=t.filter((e=>e.IsParking)).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return t},AllEqStation:(e,t)=>{var a=Object.values(e.MapData.Points),i=a.filter((e=>0!=e.StationType&&3!=e.StationType)).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return i.sort(((e,t)=>e.name_display.localeCompare(t.name_display))),i},AllChargeStation:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(3==e.StationType||5==e.StationType||6==e.StationType))).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllExangeBatteryStation:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(16==e.StationType||3==e.StationType))).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllParkingStationOptions:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&1==e.IsParking||4==e.StationType||5==e.StationType)).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllBufferStationOptions:e=>{var t=Object.values(e.MapData.Points),a=t.filter((e=>!e.IsVirtualPoint&&(4==e.StationType||41==e.StationType||5==e.StationType))).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>new o.Di(e.TagNumber,`${e.Graph.Display}(Tag=${e.TagNumber})`,e.Graph.Display)));return a},AllPointsOptions:e=>{var t=[],a=e.MapData.Points,i=Object.keys(a);return i.forEach((e=>{var i=a[e];t.push({index:e,tag:i.TagNumber,name:i.Graph.Display})})),t},ControledPathesBySystem:e=>e.ControledPathesBySystem,RegionOptions:e=>e.RegionOptions,EqIcons:e=>e.MapData.Options.EQIcons,GridSize:e=>e.MapData.Options.gridSize,Rotation:e=>e.MapData.Options.Rotation?e.MapData.Options.Rotation:0,DefaultShowBackgroundImage:e=>e.MapData.Options.defaultShowBackgroudImage},mutations:{setToolState(e,t){e.toolState=t,console.info(e.toolState)},setMapData(e,t){e.MapData=t,localStorage.setItem("mapData",JSON.stringify(t))},setGeoMapData(e,t){e.MapGeoJson=t},setAGVDynamicPathInfo(e,t){e.AGVDynamicPathInfo=t},setOtherAGVLocateInfo(e,t){e.OthersAGVLocateInfo=t},setAGVLocUpload(e,t){e.AGVLocUpload=t},setWorker(e,t){e.worker=t},setControledPathesBySystem(e,t){e.ControledPathesBySystem=t},RegionOptions(e,t){e.RegionOptions=t},setMapGridSize(e,t){e.MapData.Options.gridSize=t,console.log(e.MapData.Options.gridSize)},setMapGridOffsetX(e,t){e.MapData.Options.gridOffsetX=t},setMapGridOffsetY(e,t){e.MapData.Options.gridOffsetY=t},SaveAGVStyle(e,t){var a=localStorage.getItem("custom-agv-styles"),i={};a&&(i=JSON.parse(a)),i[t.agvname]=t.style,localStorage.setItem("custom-agv-styles",JSON.stringify(i))},SetRotation(e,t){e.MapData.Options.Rotation=t},setPathColor(e,t){e.MapData.Options.pathColor=t},setNormalPointTextColor(e,t){e.MapData.Options.normalStationTextColor=t},setWorkStationPointTextColor(e,t){e.MapData.Options.workStationTextColor=t},setNormalPointTextFontSize(e,t){e.MapData.Options.normalStationTextFontSize=t},setWorkStationPointTextFontSize(e,t){e.MapData.Options.workStationTextFontSize=t}},actions:{async DownloadMapData({commit:e,getters:t}){await t.MapBackednAxios.get("api/Map").then((t=>{e("setMapData",t.data)}))},async GetPointEnableMap({getters:e}){var t=await e.MapBackednAxios.get("api/Map/GetPointEnableMap");return t.data},Save({commit:e}){},GetMapPointByIndex({commit:e,state:t},a){var i=t.MapData.Points;return i[a]},GetMapPointByTag({commit:e,state:t},a){var i=t.MapData.Points;return Object.values(i).find((e=>e.TagNumber+""==a+""))},async SaveMap({commit:e,state:t,actions:a,getters:i},s){var n=s.data,o=s.file;console.log(o);var l=async e=>{const t=new FormData;t.append("image",e),console.log(t),await i.MapBackednAxios.post("api/Map/MapImageUpload",t)};return o&&(n.ImageName=o.name,await l(o)),i.MapBackednAxios.post("api/Map/SaveMap",n).then((t=>(n.Note=t.data,e("setMapData",n),!0))).catch((e=>!1))},UploadCoorFunctionSwitch({commit:e,state:t,getters:a},i){if(a.MapBackednAxios.get(`api/Map/SwitchAGVUploadLocFun?enabled=${i}`),i){const t=new Worker("websocket_worker.js");t.onmessage=t=>{"error"!=t.data&&"closed"!=t.data&&e("setAGVLocUpload",t.data)},t.postMessage({command:"connect",ws_url:a.MapServerUrl.replace("http","ws")+"/ws/AGVLocationUpload"}),e("setWorker",t)}else t.worker.postMessage({command:"disconnect"})},DeleteIcon({commit:e,state:t,getters:a,actions:i},s){a.MapBackednAxios.delete(`api/Map/DeleteIcon?filePath=${s}`)},GetRegionByName({state:e,getters:t},a){var i=t.Regions;return i.find((e=>e.Name==a))},ResetMapXYGraphAsCoordinations({state:e,getters:t,actions:a}){return t.MapBackednAxios.post("api/Map/ResetGraphXYAsCoordinations").then((e=>e.data))},AddMapDataCache({commit:e,state:t},a){t.TempMapDataStack.push(a)},GetLastMapData({commit:e,state:t,getters:a,actions:i}){let s=t.TempMapDataStack.pop();return console.info(s.Segments.length),{stations:d(s),pathes:s.Segments}}}});c.dispatch("DownloadMapData")},53259:function(e,t,a){"use strict";var i=a(59391);const s=(0,i.Z)();t.Z=s},663:function(e,t,a){"use strict";var i={type:"jw",get backend_host(){return`${window.location.protocol}//${window.location.host}`},get backend_ws_host(){return this.backend_host.replace("http","ws")},get vms_host(){return this.backend_host.replace(/:\d+/,":5036")},get secs_platform_host(){return this.backend_host.replace(/:\d+/,":7107")},get vms_ws_host(){return this.vms_host.replace("http","ws")},get agvsystem_notify_url(){return this.backend_host+"/api/event"},get hubs(){return{agvs:`${this.backend_host}/FrontEndDataHub`,vms:`${this.vms_host}/FrontEndDataHub`,secs_platform:`${this.secs_platform_host}/SecsPlatform`}}};t.Z=i},1982:function(e,t,a){"use strict";a.d(t,{Z:function(){return Vn},Q:function(){return Tn}});var i=a(22201),s=a(66252),n=a(3577),o=a(49963);const l={class:"home-view h-100"},r={class:"left-col border-right left-panel"},d={class:"menu-icon"},c=(0,s._)("div",{class:"flex-fill d-flex flex-column justify-content-center"},[(0,s._)("i",{class:"bi bi-three-dots-vertical"})],-1),u={class:"right-panel flex-fill"},m={style:{width:"100%"},class:"border"};function h(e,t,a,i,h,p){const g=(0,s.up)("AGVStatusVue"),_=(0,s.up)("b-tab"),w=(0,s.up)("TaskStatusVue"),f=(0,s.up)("EQStatus"),y=(0,s.up)("b-tabs"),v=(0,s.up)("b-card"),S=(0,s.up)("MenuExpandIcon"),b=(0,s.up)("el-icon"),C=(0,s.up)("MenuFoldIcon"),k=(0,s.up)("HomeMap"),T=(0,s.up)("TaskAllocationVue"),D=(0,s.up)("TaskDispatchNewUI"),V=(0,s.up)("TaskDispathActionButton"),A=(0,s.Q2)("loading");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",l,[(0,s._)("div",{style:(0,n.j5)({visibility:h.isEasyMode?"hidden":"visible"}),class:"d-flex flex-row"},[(0,s.wy)((0,s._)("div",r,[(0,s.Wm)(v,{"no-body":"",class:"p-1 bg-light h-100"},{default:(0,s.w5)((()=>[(0,s.Wm)(y,{pills:"",modelValue:h.selectTab,"onUpdate:modelValue":t[0]||(t[0]=e=>h.selectTab=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{title:"Vehicles"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{DisplayMode:"cards",onOnTaskIDClicked:p.handleTaskIDClicked},null,8,["onOnTaskIDClicked"])])),_:1}),(0,s.Wm)(_,{title:"Missions"},{default:(0,s.w5)((()=>[(0,s.Wm)(w,{height:"80vh",show_card_title:!1,taskIDSelected:h.selectTaskID},null,8,["taskIDSelected"])])),_:1}),(0,s.Wm)(_,{title:e.$t("HomeView.EQ_Status")},{default:(0,s.w5)((()=>[(0,s.Wm)(f)])),_:1},8,["title"])])),_:1},8,["modelValue"])])),_:1})],512),[[o.F8,h.MenuExpanded]]),(0,s._)("div",{style:(0,n.j5)(p.IsOpUsing?{width:"0px",visibility:"hidden"}:{width:"25px"}),class:"resizer text-primary d-flex flex-column"},[(0,s._)("div",d,[h.MenuExpanded?((0,s.wg)(),(0,s.j4)(b,{key:1},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{onClick:t[2]||(t[2]=()=>{h.MenuExpanded=!1,p.AdjustSizeOfRightSideFullPage()})})])),_:1})):((0,s.wg)(),(0,s.j4)(b,{key:0},{default:(0,s.w5)((()=>[(0,s.Wm)(S,{onClick:t[1]||(t[1]=()=>{h.MenuExpanded=!0,p.RestoreSizeOfRightSide()})})])),_:1}))]),c],4),(0,s._)("div",u,[(0,s.Wm)(k,{style:{width:"100%",height:"100%"}})]),(0,s.Wm)(T)],4),(0,s._)("div",{style:(0,n.j5)({visibility:h.isEasyMode?"visible":"hidden",position:"absolute",top:"70px",width:"100%",height:"82vh"}),class:"easy_mode d-flex"},[(0,s._)("div",null,[(0,s.Wm)(g,{IsEasyMode:!0})]),(0,s._)("div",m,[(0,s.Wm)(k,{id:"homemap-easymode"})])],4),(0,s.wy)((0,s.Wm)(D,{class:(0,n.C_)(["new-dispatch-pnl",h.show_new_dispatch_panel?"dispatch-show":"hide"]),onClose:t[3]||(t[3]=()=>{h.show_new_dispatch_panel=!1})},null,8,["class"]),[[o.F8,h.show_new_dispatch_panel]]),p.IsLogin?((0,s.wg)(),(0,s.j4)(V,{key:0,ref:"task-dispatch-action-btn",class:"fixed-bottom",onOnTaskDispatch:t[4]||(t[4]=()=>{h.right_side_tabSelected="map"}),onOnClick:t[5]||(t[5]=()=>{h.show_new_dispatch_panel=!0})},null,512)):(0,s.kq)("",!0)])),[[A,h.loading]])}var p=a(3802),g=a(61796);const _=e=>((0,s.dD)("data-v-3b1e6901"),e=e(),(0,s.Cn)(),e),w=_((()=>(0,s._)("span",null,null,-1))),f={class:"w-100 h-100 order-info-container"},y={class:"grabable-region w-100 text-end border-bottom",style:{height:"15px"}},v=_((()=>(0,s._)("i",{class:"bi bi-three-dots cursor-pointer"},null,-1))),S={class:"d-flex"},b=_((()=>(0,s._)("div",{class:"mx-1",style:{width:"80px"}},"固定位置",-1))),C={class:"item-name"},k={class:"item-name"},T={class:"item-name"},D={key:0},V={key:1},A={class:"w-100 d-flex"},I={class:"flex-fill",style:{"font-size":"15px",width:"120px"}},x={class:"item-name"},E={key:0},M={key:1},P={class:"w-100 d-flex"},O={class:"flex-fill",style:{"font-size":"15px",width:"120px"}},N={class:"item-name"},L={class:"item-name"},G={class:"item-name"},R=_((()=>(0,s._)("div",{class:"item-name"},"Bypass EQ Check",-1))),W={class:"action-buttons actions-btn-conatiner w-100 py-1 d-flex border-top",style:{height:"auto"}},U={class:"actions-btn-conatiner"};function H(e,t,a,i,o,l){const r=(0,s.up)("el-popover"),d=(0,s.up)("el-col"),c=(0,s.up)("b-button"),u=(0,s.up)("el-row"),m=(0,s.up)("el-option"),h=(0,s.up)("el-select"),p=(0,s.up)("el-button"),g=(0,s.up)("el-tag"),_=(0,s.up)("el-checkbox"),H=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.j4)(r,{placement:"right",visible:o.action_menu_visible&&!o.order_info_visible,width:200,content:""},{reference:(0,s.w5)((()=>[((0,s.wg)(),(0,s.iD)("div",{key:o.grabStates.updateKey,class:"task-dispatch-btn-container",style:(0,n.j5)(o.DynamicStyle)},[(0,s.Wm)(r,{onHide:l.HandleDispathDialogHidden,"show-arrow":!1,"popper-style":o.order_info_style,visible:o.order_info_visible,placement:"right-start",width:"555px"},{reference:(0,s.w5)((()=>[w])),default:(0,s.w5)((()=>[(0,s._)("div",f,[(0,s._)("div",y,[(0,s.Wm)(r,{trigger:"click",width:153},{reference:(0,s.w5)((()=>[v])),default:(0,s.w5)((()=>[(0,s._)("div",S,[b,(0,s._)("i",{class:(0,n.C_)(["bi bi-layout-sidebar-inset p-1 cursor-pointer","left"==o.fixLoc?"bg-primary text-light":""]),onClick:t[0]||(t[0]=()=>{o.fixLoc="left"})},null,2),(0,s._)("i",{class:(0,n.C_)(["bi bi-layout-sidebar-inset-reverse p-1 mx-2 cursor-pointer","right"==o.fixLoc?"bg-primary text-light":""]),onClick:t[1]||(t[1]=()=>{o.fixLoc="right"})},null,2)])])),_:1})]),(0,s.Wm)(u,{class:"order-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",C,(0,n.zw)(e.$t("Action")),1)])),_:1}),(0,s.Wm)(d,{class:"item-value",span:11},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(l.selected_action_display),1)])),_:1}),(0,s.Wm)(d,{class:"item-actions",span:7},{default:(0,s.w5)((()=>[l.IsDeveloper?((0,s.wg)(),(0,s.j4)(c,{key:0,size:"sm",variant:"link",onClick:t[2]||(t[2]=()=>{l.HandleCancelBtnClick(),o.action_menu_visible=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Remove")),1)])),_:1})):(0,s.kq)("",!0)])),_:1})])),_:1}),(0,s.Wm)(u,{class:"order-row",style:(0,n.j5)(o.agv_select_row_class)},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",k,(0,n.zw)(e.$t("Vehicle")),1)])),_:1}),(0,s.Wm)(d,{class:"item-value",span:18},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{disabled:!l.IsDeveloper,size:"large",class:"w-100 px-1",placeholder:e.$t("select-vehicle"),modelValue:o.selected_agv,"onUpdate:modelValue":t[3]||(t[3]=e=>o.selected_agv=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.AgvNameList,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["disabled","placeholder","modelValue"])])),_:1})])),_:1},8,["style"]),"carry"==o.selected_action?((0,s.wg)(),(0,s.j4)(u,{key:0,class:"order-row",style:(0,n.j5)(o.source_select_row_class),onClick:l.HandleSelectSoureStationFromMapBtnClick},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",T,(0,n.zw)(e.$t("source")),1)])),_:1}),(0,s.Wm)(d,{class:"item-value",span:11},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{class:"w-100 px-1",size:"large",placeholder:e.$t("Choose_Sourse_from_Map"),onChange:l.HandleFromSelectChanged,onClick:l.HandleSelectSoureStationFromMapBtnClick,modelValue:o.selected_source.TagNumber,"onUpdate:modelValue":t[4]||(t[4]=e=>o.selected_source.TagNumber=e),filterable:""},{header:(0,s.w5)((()=>[(0,s.Wm)(p,{onClick:l.HandleSelectSoureStationFromMapBtnClick,size:"large"},{default:(0,s.w5)((()=>[(0,s.Uk)("Refresh")])),_:1},8,["onClick"])])),default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.FromStationOptions,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e.tag+e.name_display,label:e.name_display,value:e.tag},{default:(0,s.w5)((()=>[(0,s._)("div",{class:(0,n.C_)(["custom-options",e.name_display&&e.name_display.includes("AGV")?"agv-option":""])},(0,n.zw)(e.name_display),3)])),_:2},1032,["label","value"])))),128))])),_:1},8,["placeholder","onChange","onClick","modelValue"])])),_:1}),(0,s.Wm)(d,{class:"item-actions",span:7},{default:(0,s.w5)((()=>[o.selected_source.Graph&&(l.IsSourceStationBuffer||l.IsSourceStationMultiLayers)?((0,s.wg)(),(0,s.j4)(h,{key:0,class:"w-100",size:"large",placeholder:e.$t("Choose_Port"),modelValue:o.selected_source_slot,"onUpdate:modelValue":t[5]||(t[5]=e=>o.selected_source_slot=e)},{default:(0,s.w5)((()=>[l.IsSourceStationMultiLayers?((0,s.wg)(),(0,s.iD)("div",D,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.GetLayersOfEquipment(o.selected_source.TagNumber),(e=>((0,s.wg)(),(0,s.j4)(m,{key:o.selected_source.Graph.Display+"-"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])):(0,s.kq)("",!0),l.IsSourceStationBuffer?((0,s.wg)(),(0,s.iD)("div",V,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.GetLayersOfBuffer(o.selected_source.TagNumber),(e=>((0,s.wg)(),(0,s.j4)(m,{key:o.selected_source.Graph.Display+"-"+e.value+o.selected_source.TagNumber,label:e.label,value:e.value},{default:(0,s.w5)((()=>[(0,s._)("div",A,[(0,s.Wm)(g,{class:"mx-2",effect:"plain"},{default:(0,s.w5)((()=>[(0,s.Uk)("第"+(0,n.zw)(e.value+1)+"層",1)])),_:2},1024),(0,s._)("div",I,(0,n.zw)(e.label),1),e.portState.isCaroExist?((0,s.wg)(),(0,s.j4)(g,{key:0,effect:"dark",type:"success"},{default:(0,s.w5)((()=>[(0,s.Uk)("Exist")])),_:1})):((0,s.wg)(),(0,s.j4)(g,{key:1,effect:"plain",type:"info"},{default:(0,s.w5)((()=>[(0,s.Uk)("Empty")])),_:1}))])])),_:2},1032,["label","value"])))),128))])):(0,s.kq)("",!0)])),_:1},8,["placeholder","modelValue"])):(0,s.kq)("",!0)])),_:1})])),_:1},8,["style","onClick"])):(0,s.kq)("",!0),(0,s.Wm)(u,{class:"order-row",style:(0,n.j5)(o.destine_select_row_class),onClick:l.HandleSelectDestineStationFromMapBtnClick},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",x,(0,n.zw)(e.$t("TaskDispathActionButton.Destine")),1)])),_:1}),(0,s.Wm)(d,{class:"item-value",span:11},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{class:"w-100 px-1",size:"large",filterable:"",placeholder:e.$t("Choose_Dest_from_Map"),onChange:l.HandleDestineSelectChanged,onClick:l.HandleSelectDestineStationFromMapBtnClick,modelValue:o.selected_destine.TagNumber,"onUpdate:modelValue":t[6]||(t[6]=e=>o.selected_destine.TagNumber=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(o.downstream_options,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e.tag+l.GetGrpahDisplayByTag(e.tag),label:e.name_display,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["placeholder","onChange","onClick","modelValue"])])),_:1}),(0,s.Wm)(d,{class:"item-actions",span:7},{default:(0,s.w5)((()=>[o.selected_destine.Graph&&(l.IsDestineStationBuffer||l.IsDestineStationMultiLayers)?((0,s.wg)(),(0,s.j4)(h,{key:0,class:"w-100 px-1",size:"large",placeholder:e.$t("Choose_Port"),modelValue:o.selected_destine_slot,"onUpdate:modelValue":t[7]||(t[7]=e=>o.selected_destine_slot=e)},{default:(0,s.w5)((()=>[l.IsDestineStationMultiLayers?((0,s.wg)(),(0,s.iD)("div",E,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.GetLayersOfEquipment(o.selected_destine.TagNumber),(e=>((0,s.wg)(),(0,s.j4)(m,{key:e.label,label:e.label,value:e.value},null,8,["label","value"])))),128))])):(0,s.kq)("",!0),l.IsDestineStationBuffer?((0,s.wg)(),(0,s.iD)("div",M,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.GetLayersOfBuffer(o.selected_destine.TagNumber),(e=>((0,s.wg)(),(0,s.j4)(m,{key:e.label+o.selected_destine.TagNumber,label:e.label,value:e.value},{default:(0,s.w5)((()=>[(0,s._)("div",P,[(0,s.Wm)(g,{class:"mx-2",effect:"plain"},{default:(0,s.w5)((()=>[(0,s.Uk)("第"+(0,n.zw)(e.value+1)+"層",1)])),_:2},1024),(0,s._)("div",O,(0,n.zw)(e.label),1),e.portState.isCaroExist?((0,s.wg)(),(0,s.j4)(g,{key:0,effect:"dark",type:"success"},{default:(0,s.w5)((()=>[(0,s.Uk)("Exist")])),_:1})):((0,s.wg)(),(0,s.j4)(g,{key:1,effect:"plain",type:"info"},{default:(0,s.w5)((()=>[(0,s.Uk)("Empty")])),_:1}))])])),_:2},1032,["label","value"])))),128))])):(0,s.kq)("",!0)])),_:1},8,["placeholder","modelValue"])):(0,s.kq)("",!0)])),_:1})])),_:1},8,["style","onClick"]),l.IsDeveloper&&"carry"==o.selected_action?((0,s.wg)(),(0,s.j4)(u,{key:1,class:"order-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",N,(0,n.zw)(e.$t("Transport")),1)])),_:1}),(0,s.Wm)(d,{class:"item-value",span:18},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{modelValue:o.IsTransferTaskNeedChangeAGV,"onUpdate:modelValue":t[8]||(t[8]=e=>o.IsTransferTaskNeedChangeAGV=e)},null,8,["modelValue"])])),_:1})])),_:1})):(0,s.kq)("",!0),l.IsDeveloper&&o.IsTransferTaskNeedChangeAGV?((0,s.wg)(),(0,s.j4)(u,{key:2,class:"order-row",style:(0,n.j5)(o.transfer_station_select_row_class),onClick:l.HandleSelectTransferStationFromMapBtnClick},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:6},{default:(0,s.w5)((()=>[(0,s._)("div",L,(0,n.zw)(e.$t("Transport_Port")),1)])),_:1}),(0,s.Wm)(d,{class:"item-value",span:18},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{placeholder:e.$t("Choose_Transport_Port_from_Map"),onChange:l.HandleTransferStationSelectChanged,onClick:l.HandleSelectTransferStationFromMapBtnClick,modelValue:o.selected_transfer_station.TagNumber,"onUpdate:modelValue":t[9]||(t[9]=e=>o.selected_transfer_station.TagNumber=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.BufferStations,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e.tag,label:e.name_display,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["placeholder","onChange","onClick","modelValue"])])),_:1}),(0,s.Wm)(d,{class:"item-actions",span:7})])),_:1},8,["style","onClick"])):(0,s.kq)("",!0),o.IsTransferTaskNeedChangeAGV?((0,s.wg)(),(0,s.j4)(u,{key:3,class:"order-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:5},{default:(0,s.w5)((()=>[(0,s._)("div",G,(0,n.zw)(e.$t("Vehicle")),1)])),_:1}),(0,s.Wm)(d,{class:"item-value",span:18},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{placeholder:e.$t("select-vehicle"),modelValue:o.selected_transfer_to_destine_agv,"onUpdate:modelValue":t[10]||(t[10]=e=>o.selected_transfer_to_destine_agv=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.AgvNameList,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["placeholder","modelValue"])])),_:1}),(0,s.Wm)(d,{class:"item-actions",span:7})])),_:1})):(0,s.kq)("",!0),l.IsDeveloper?((0,s.wg)(),(0,s.j4)(u,{key:4,class:"order-row"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{span:6},{default:(0,s.w5)((()=>[R])),_:1}),(0,s.Wm)(d,{class:"item-value",span:18},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{size:"large",modelValue:o.bypass_eq_status_check,"onUpdate:modelValue":t[11]||(t[11]=e=>o.bypass_eq_status_check=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(d,{class:"item-actions",span:7})])),_:1})):(0,s.kq)("",!0),(0,s._)("div",W,[(0,s.Wm)(c,{onClick:l.HandleConfirmBtnClicked,class:(0,n.C_)(["mx-1",l.IsOpLogining?"w-100":"w-50"]),variant:"primary"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("TaskDispathActionButton.dispatch-confirm")),1)])),_:1},8,["onClick","class"]),(0,s.Wm)(c,{onClick:l.HandleSelectSoureStationFromMapBtnClick,class:(0,n.C_)(["mx-1",l.IsOpLogining?"w-100":"w-50"])},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("TaskDispathActionButton.clear-selected")),1)])),_:1},8,["onClick","class"]),l.IsDeveloper?((0,s.wg)(),(0,s.j4)(c,{key:0,class:"w-50 mx-1",variant:"light",onClick:t[12]||(t[12]=()=>{o.order_info_visible=!1,o.action_menu_visible=!0,l.HandleCancelBtnClick()})},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("TaskDispathActionButton.Back To Select Action")),1)])),_:1})):(0,s.kq)("",!0),l.IsOpLogining?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(c,{key:1,class:"w-50 mx-1",variant:"danger",onClick:l.HandleCancelBtnClick},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Cancel")),1)])),_:1},8,["onClick"]))])])])),_:1},8,["onHide","popper-style","visible"]),l.IsOpLogining?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(c,{key:0,class:"rounded-2",id:"dispatch-btn",squared:"",variant:"primary",onClick:l.HandleDispatchButtonClick},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Dispatch")),1)])),_:1},8,["onClick"]))],4))])),default:(0,s.w5)((()=>[(0,s._)("div",U,[!l.IsRunMode||l.IsDeveloper?((0,s.wg)(),(0,s.j4)(c,{key:0,class:"w-100 my-1",variant:"light",onClick:t[13]||(t[13]=e=>l.SelectActionHandle("move"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Move")),1)])),_:1})):(0,s.kq)("",!0),!l.IsRunMode||l.IsDeveloper?((0,s.wg)(),(0,s.j4)(c,{key:1,class:"w-100 my-1",variant:"light",onClick:t[14]||(t[14]=e=>l.SelectActionHandle("park"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Park")),1)])),_:1})):(0,s.kq)("",!0),!l.IsRunMode||l.IsDeveloper?((0,s.wg)(),(0,s.j4)(c,{key:2,class:"w-100 my-1",variant:"light",onClick:t[15]||(t[15]=e=>l.SelectActionHandle("unload"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Unload")),1)])),_:1})):(0,s.kq)("",!0),!l.IsRunMode||l.IsDeveloper?((0,s.wg)(),(0,s.j4)(c,{key:3,class:"w-100 my-1",variant:"light",onClick:t[16]||(t[16]=e=>l.SelectActionHandle("load"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Load")),1)])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(c,{class:"w-100 my-1",variant:"primary",onClick:t[17]||(t[17]=e=>l.SelectActionHandle("carry"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Transfer")),1)])),_:1}),(0,s.Wm)(c,{class:"w-100 my-1",variant:"warning",onClick:t[18]||(t[18]=e=>l.SelectActionHandle("charge"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Charge")),1)])),_:1}),(0,s.Wm)(c,{class:"w-100 my-1",variant:"warning",onClick:t[19]||(t[19]=e=>l.SelectActionHandle("exchange_battery"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Exchange Battery")),1)])),_:1}),(0,s.Wm)(c,{class:"w-100 my-1",variant:"warning",onClick:t[20]||(t[20]=e=>l.SelectActionHandle("measure"))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Measure")),1)])),_:1}),(0,s.Wm)(c,{class:"w-100 my-1",variant:"danger",onClick:t[21]||(t[21]=()=>{l.HandleCancelBtnClick(),o.action_menu_visible=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("Cancel")),1)])),_:1})]),(0,s.Wm)(H,{modelValue:o.showFullEmptyContentSetting,"onUpdate:modelValue":t[22]||(t[22]=e=>o.showFullEmptyContentSetting=e)},null,8,["modelValue"])])),_:1},8,["visible"])}a(57658);var $=a(53259),F=a(93867),q=a(49996),B=a(79072),z=a(8764),j=a(25044),Z=a(64491),Q=a(95320),Y=a(72924),K={data(){return{action_menu_visible:!1,order_info_visible:!1,isSelectTransferToDestinAGV:!1,isDispatchConfirming:!1,selected_action:"",selected_agv:"",selected_transfer_to_destine_agv:"",selected_source:{Graph:{Display:""},StationType:0},selected_destine:{Graph:{Display:""},StationType:0},selected_transfer_station:{Graph:{Display:""},StationType:0},selected_source_slot:0,selected_destine_slot:0,Cst_ID_Input:"",order_info_style:{backgroundColor:"rgba(255, 255, 255,.8)"},source_select_row_class:"",destine_select_row_class:"",transfer_station_select_row_class:"",agv_select_row_class:"",map_events_bus:{agv_selected:"/map/agv_selected",station_selected:"/map/station_selected"},bypass_eq_status_check:!1,equipments_options:[new B.Di],downstream_options:[new B.Di],IsTransferTaskNeedChangeAGV:!1,tagOfMiddleStationTagOfTransferTask:-1,routePath:"",showFullEmptyContentSetting:!1,DynamicStyle:{right:"132px"},fixLoc:"right",grabStates:{grabing:!1,oriX:0,oriY:0,oriRightOffset:28,newRightOffset:28,updateKey:0}}},computed:{IsRunMode(){return j.cy.getters.IsRunMode},IsDeveloper(){return j.HP.getters.IsDeveloperLogining},IsOpLogining(){return j.HP.getters.IsOPLogining},AgvNameList(){var e=[];function t(e){j.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return this.IsRunMode?(e.push({value:"",label:this.$t("auto-choise-vehicle")}),this.IsDeveloper&&t(e)):t(e),e.filter((e=>void 0!=e.label&&void 0!=e.value))},IsShowBackTo(){return"select-action"!=this.current_progress},selected_action_display(){var e=this.selected_action;return"move"==e?this.$t("Move"):"unload"==e?this.$t("Unload"):"load"==e?this.$t("Load"):"carry"==e?this.$t("Transfer"):"charge"==e?this.$t("Charge"):"park"==e?this.$t("Park"):void 0},IsAutoSelectAGV(){return("carry"==this.selected_action||"unload"==this.selected_action)&&""==this.selected_agv},task_dispatch_btn_pushable(){var e=!!this.IsAutoSelectAGV||""!=this.selected_agv,t=void 0!=this.selected_source&&void 0!=this.selected_source.TagNumber,a=void 0!=this.selected_destine&&void 0!=this.selected_destine.TagNumber;return"carry"==this.selected_action?e&&t&&a:e&&a},EQStations(){return Q.p.getters.AllEqStation},BufferStations(){return Q.p.getters.AllBufferStationOptions},bay_names(){var e=Q.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},FromStationOptions(){var e=j.sn.getters.AGVNameList,t=0==e.length?[]:e.map((e=>({tag:e,name_display:e}))),a=[new B.Di];if(Object.assign(a,this.EQStations),this.IsDeveloper)return[...t,...a];var i=[new Y.Z];Object.assign(i,j.jU.getters.EQData);var s=i.filter((e=>e.Unload_Request)),n=s.map((e=>e.Tag)),o=a.filter((e=>n.includes(e.tag))),l=[...t,...this.BufferStations,...o];return l},IsSourceStationBuffer(){return 4==this.selected_source.StationType||41==this.selected_source.StationType||5==this.selected_source.StationType},IsDestineStationBuffer(){return 4==this.selected_destine.StationType||41==this.selected_destine.StationType||5==this.selected_destine.StationType},IsSourceStationMultiLayers(){try{if(!this.selected_source.TagNumber)return!1;var e=this.TryGetMultiLayersOfEqTag(this.selected_source.TagNumber);return e.length>1}catch(t){return!1}},IsDestineStationMultiLayers(){try{if(!this.selected_destine.TagNumber)return!1;var e=this.TryGetMultiLayersOfEqTag(this.selected_destine.TagNumber);return e.length>1}catch(t){return!1}},TaskDispatchFailString(){return this.$t("TaskDispatchFailString")}},methods:{HandleDispatchButtonClick(){this.IsDeveloper?this.action_menu_visible?this.action_menu_visible=!1:this.order_info_visible||(this.action_menu_visible=!0):this.SelectActionHandle("carry")},SelectActionHandle(e){this.$emit("onTaskDispatch"),$.Z.emit("/cancel_tracking_agv",""),this.selected_action=e,this.HandleActionSelected(e),this.action_menu_visible=this.IsTransferTaskNeedChangeAGV=!1,this.order_info_visible=!0,this.selected_source=this.selected_destine={TagNumber:void 0},"carry"==e||"unload"==e?(this.selected_agv="","carry"==e?this.HandleSelectSoureStationFromMapBtnClick():this.HandleSelectDestineStationFromMapBtnClick()):(this.selected_agv=this.AgvNameList[0].label,this.HandleSelectAGVFromMapBtnClick(),console.log(this.selected_agv))},HandleDispathDialogHidden(e){this.isDispatchConfirming||setTimeout((()=>{this.HandleCancelBtnClick()}),300)},HandleActionSelected(e){this.source_select_row_class=this.destine_select_row_class=this.transfer_station_select_row_class=this.agv_select_row_class="";var t={backgroundColor:"rgb(13, 110, 253)",color:"white",borderRadius:"1px solid black"};"select-agv"==e&&(this.agv_select_row_class=t),"select-source"==e&&(this.source_select_row_class=t),"select-destine"==e&&(this.destine_select_row_class=t),"select-transfer-station"==e&&(this.transfer_station_select_row_class=t)},HandleAGVSelected(e){console.log(e),this.isSelectTransferToDestinAGV?this.selected_transfer_to_destine_agv=e:this.selected_agv=e},HandleSelectAGVFromMapBtnClick(e=!1){this.isSelectTransferToDestinAGV=e,e||this.HandleActionSelected("select-agv"),$.Z.off(this.map_events_bus.agv_selected),$.Z.off(this.map_events_bus.station_selected),$.Z.off("map-rack-port-clicked"),$.Z.emit("change_to_select_agv_mode"),this.current_progress="select-agv",$.Z.on(this.map_events_bus.agv_selected,(t=>{console.log(t),e?this.selected_transfer_to_destine_agv=t:(this.selected_agv=t,"carry"!=this.selected_action||this.selected_source.Graph&&""!=this.selected_source.Graph.Display?this.selected_destine.Graph&&""!=this.selected_destine.Graph.Display||(this.HandleSelectDestineStationFromMapBtnClick(),this.HandleActionSelected("select-destine")):(this.HandleSelectSoureStationFromMapBtnClick(),this.HandleActionSelected("select-source")))}))},HandleSelectTransferStationFromMapBtnClick(){this.HandleActionSelected("select-transfer-station"),$.Z.off(this.map_events_bus.agv_selected),$.Z.off(this.map_events_bus.station_selected),$.Z.off("map-rack-port-clicked");var e=this.GetDownStreamEQOptions(this.selected_source.TagNumber);console.info("_destine_options:",e);let t={action_type:this.selected_action,direction:"buffer",stations_to_show:this.BufferStations};$.Z.emit("change_to_select_eq_station_mode",t),this.current_progress="select-transfer-station",$.Z.on(this.map_events_bus.station_selected,(e=>{console.info(e),4==e.StationType&&($.Z.emit("mark_as_transfer_station",e.TagNumber),this.selected_transfer_station=e,this.tagOfMiddleStationTagOfTransferTask=e.TagNumber)}))},HandleSelectSoureStationFromMapBtnClick(){this.selected_agv="",this.selected_source={Graph:{Display:""}},this.HandleActionSelected("select-source"),$.Z.off(this.map_events_bus.agv_selected),$.Z.off(this.map_events_bus.station_selected),$.Z.off("map-rack-port-clicked"),$.Z.emit("change_to_select_eq_station_mode",{action_type:this.selected_action,direction:"source",stations_to_show:this.FromStationOptions}),this.current_progress="select-source",this.selected_destine={Graph:{Display:""}},$.Z.on("map-rack-port-clicked",(async(e={tag:-1,ptData:new B.ux,slot:0})=>{var t=-1==this.FromStationOptions.findIndex((t=>t.tag==e.tag));t||(this.selected_source=e.ptData,this.selected_source_slot=e.slot,await this.HandleFromSelectChanged(this.selected_source.TagNumber,!1),$.Z.emit("mark_as_start_station",this.selected_source.TagNumber),this.HandleSelectDestineStationFromMapBtnClick(),this.HandleActionSelected("select-destine"))})),$.Z.on(this.map_events_bus.station_selected,(e=>{const t=e.isAGV,a=4==e.StationType||5==e.StationType||41==e.StationType;if(e.IsEquipment||a||t){if(t)return this.HandleFromSelectChanged(e.agvName),$.Z.emit("mark_as_start_station",this.selected_source),this.HandleSelectDestineStationFromMapBtnClick(),void this.HandleActionSelected("select-destine");if(e==this.selected_destine)return;console.log(e);var i=-1==this.FromStationOptions.findIndex((t=>t.tag==e.TagNumber));if(i)return;this.selected_source=e,this.HandleFromSelectChanged(this.selected_source.TagNumber),$.Z.emit("mark_as_start_station",this.selected_source.TagNumber),this.HandleSelectDestineStationFromMapBtnClick(),this.HandleActionSelected("select-destine")}}))},HandleSelectDestineStationFromMapBtnClick(){this.HandleActionSelected("select-destine"),$.Z.off(this.map_events_bus.agv_selected),$.Z.off(this.map_events_bus.station_selected),$.Z.off("map-rack-port-clicked"),"load"!=this.selected_action&&"unload"!=this.selected_action||(this.downstream_options=this.EQStations),"move"==this.selected_action&&(this.downstream_options=Q.p.getters.AllNormalStationOptions),"park"==this.selected_action&&(this.downstream_options=Q.p.getters.AllParkableStationOptions),"charge"==this.selected_action&&(this.downstream_options=Q.p.getters.AllChargeStation);var e=this.downstream_options;this.IsSourceStationBuffer&&(e=[...e,this.BufferStations]),console.info("_destine_options:",e);let t={action_type:this.selected_action,direction:"destine",stations_to_show:e};$.Z.emit("change_to_select_eq_station_mode",t),this.current_progress="select-destine",$.Z.on("map-rack-port-clicked",(async(e={tag:-1,ptData:new B.ux,slot:0})=>{var t=-1==this.downstream_options.findIndex((t=>t.tag==e.tag));t||(this.selected_destine=e.ptData,this.selected_destine_slot=e.slot,$.Z.emit("mark_as_destine_station",e.tag))})),$.Z.on(this.map_events_bus.station_selected,(e=>{if(console.info(e),("move"!=this.selected_action||0==e.StationType&&!e.IsVirtualPoint)&&("charge"!=this.selected_action||e.IsCharge)&&("load"!=this.selected_action&&"unload"!=this.selected_action&&"carry"!=this.selected_action||e.IsEquipment||4==e.StationType)){if("carry"==this.selected_action){if(e==this.selected_source)return;if(!this.downstream_options.some((t=>t.tag==e.TagNumber)))return}var t=-1==this.downstream_options.findIndex((t=>t.tag==e.TagNumber));t||($.Z.emit("mark_as_destine_station",e.TagNumber),this.selected_destine=e)}}))},async HandleDestineSelectChanged(e){this.selected_destine=await Q.p.dispatch("GetMapPointByTag",e),this.selected_destine_slot=0},HandleCancelBtnClick(){this.IsOpLogining||($.Z.off(this.map_events_bus.agv_selected),$.Z.off(this.map_events_bus.station_selected),$.Z.off("map-rack-port-clicked"),$.Z.emit("change_to_select_agv_mode"),this.order_info_visible=!1,this.selected_source=this.selected_destine={Graph:{Display:""}},this.source_select_row_class=this.destine_select_row_class=this.agv_select_row_class=this.transfer_station_select_row_class="",$.Z.emit("change_to_normal_view_mode"),console.info("HandleCancelBtnClick-change_to_normal_view_mode end"))},HandleConfirmBtnClicked(){if(this.isDispatchConfirming=!0,this.order_info_visible=!1,"carry"==this.selected_action&&(!this.selected_source||!this.selected_source.Graph||""==this.selected_source.Graph.Display)&&!this.selected_source.isAGV)return this.$swal.fire({icon:"error",html:"<div><div>請選擇來源</div><div>Please Select Source Equipment</div></div>",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),void(this.order_info_visible=!0);if(!this.selected_destine||!this.selected_destine.Graph||""==this.selected_destine.Graph.Display)return this.$swal.fire({html:"<div><div>請選擇目的地</div><div>Please Select Destine</div></div>",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),void(this.order_info_visible=!0);var e=()=>{var e='<div class="swal-transfer-info border-top py-2">';if(e+=`<div> <label>${this.$t("Action")}</label> <span>${this.selected_action_display}</span> </div>`,"carry"==this.selected_action){var t="";t=this.selected_source.isAGV?this.selected_source.agvName:this.selected_source.Graph.Display,e+=`\n              <div> <label>${this.$t("source")} </label> <span>${t}</span> </div>\n              <div> <label>${this.$t("TaskDispathActionButton.Destine")}</label> <span>${this.selected_destine.Graph.Display}</span></div>`}else e+=` <div> <label>${this.$t("TaskDispathActionButton.Destine")}</label> <span>${this.selected_destine.Graph.Display}</span></div>`;return e+="</div>",e};this.$swal.fire({title:this.$t("TaskDispatchNewUI.ConfirmDispatchText"),icon:"question",html:e(),showCancelButton:!0,confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel")}).then((e=>{e.isConfirmed?(this.TaskDeliveryHandle(),this.IsOpLogining&&(this.order_info_visible=!0)):this.order_info_visible=!0,this.isDispatchConfirming=!1}))},HandleTransferStationSelectChanged(e){this.tagOfMiddleStationTagOfTransferTask=e,console.warn(e)},async TaskDeliveryHandle(){var e={confirm:!0,message:""};console.info("Final",this.selected_destine);var t=this.selected_source?this.selected_source.TagNumber:-1,a=this.selected_destine?this.selected_destine.TagNumber:-1,i=this.selected_agv;if(this.selected_source_slot=this.IsSourceStationBuffer||this.IsSourceStationMultiLayers?this.selected_source_slot:0,this.selected_destine_slot=this.IsDestineStationBuffer||this.IsDestineStationMultiLayers?this.selected_destine_slot:0,"move"==this.selected_action&&(e=await z.J8.MoveTask(new z.ec(i,a,50))),"measure"==this.selected_action&&(e=await z.J8.MeasureTask(new z.FV(i,a))),"load"==this.selected_action&&(e=await z.J8.LoadTask(new z.Y4(i,a,this.selected_destine_slot,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selected_action&&(e=await z.J8.UnloadTask(new z.On(i,a,this.selected_destine_slot,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selected_action&&(e=await z.J8.CarryTask(new z.mc(i,t,this.selected_source_slot,a,this.selected_destine_slot,this.Cst_ID_Input,50,this.bypass_eq_status_check,this.IsTransferTaskNeedChangeAGV,this.tagOfMiddleStationTagOfTransferTask,this.selected_transfer_to_destine_agv))),"exchange_battery"==this.selected_action&&(e=await z.J8.ExangeBatteryTask(new z.Z$(i,a,50,this.bypass_eq_status_check))),"charge"==this.selected_action&&(e=await z.J8.ChargeTask(new z.fn(i,a,50,this.bypass_eq_status_check))),"park"==this.selected_action&&(e=await z.J8.ParkTask(new z.Nn(i,a,50,this.bypass_eq_status_check))),200!=e.status){this.IsOpLogining||this.HandleCancelBtnClick();const t=401==e.status;setTimeout((()=>{this.$swal.fire({title:t?"須重新進行登入":this.TaskDispatchFailString,text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.HandleCancelBtnClick(),t&&(j.HP.dispatch("logout",""),$.Z.emit("/show-login-view-invoke"))})),this.IsOpLogining&&this.HandleSelectSoureStationFromMapBtnClick()}),200)}else{const i=e.data.showEmptyOrFullContentCheck;e.data.confirm?(this.HandleCancelBtnClick(),q.bM.success({message:`任務-[${this.selected_action_display}] 已派送!`,position:"top-right",duration:3e3})):(i||this.HandleCancelBtnClick(),setTimeout((()=>{i?this.$swal.fire({text:e.data.message,title:this.TaskDispatchFailString,icon:"error",showCancelButton:!0,confirmButtonText:"設定空/實框",cancelButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var i="carry"==this.selected_action?t:a,s=Object.values(Q.p.state.MapData.Points).find((e=>e.TagNumber==i));const e=new Promise((e=>{setTimeout((()=>{e({empty:"空框",full:"實框"})}),100)}));const{value:n}=await this.$swal.fire({text:"",title:`${s.Graph.Display}(Tag=${i}) - 空框/實框設定`,icon:"question",input:"radio",inputOptions:e,inputValidator:e=>{if(!e)return"請選擇空框或實框"},confirmButtonText:"重新派送任務",customClass:"my-sweetalert"});n&&("full"==n?(await(0,Z.hE)(i,!0),await(0,Z.Kz)(i,!1)):(await(0,Z.hE)(i,!1),await(0,Z.Kz)(i,!0)),setTimeout((()=>{this.TaskDeliveryHandle()}),500))}})):this.$swal.fire({title:this.TaskDispatchFailString,html:`<div class="text-danger"> <div>${e.data.message}</div><div class="my-2">${e.data.message_en}</div></div>`,icon:"error",showCancelButton:!1,focusConfirmButton:!1,confirmButtonText:"OK",customClass:"dispatch-fail-swal"})}),200)),this.IsOpLogining&&!i&&this.HandleSelectSoureStationFromMapBtnClick()}},async HandleFromSelectChanged(e,t=!0){console.log("HandleFromSelectChanged selected tag:",e),this.selected_destine={TagNumber:void 0};var a=!1;try{a=e.includes("AGV")}catch(s){}if(a){var i=e;this.selected_source={isAGV:!0,agvName:i,TagNumber:i},this.selected_agv=i,this.downstream_options=this.GetDownStreamEQOptions(this.selected_source)}else this.selected_source=await Q.p.dispatch("GetMapPointByTag",e),this.downstream_options=this.GetDownStreamEQOptions(e),console.log("validable downstream of ",e,this.downstream_options);t&&(this.selected_source_slot=0)},GetDownStreamEQOptions(e){var t=[],a=e.isAGV,i=this.BufferStations.find((t=>t.tag==e)),s=j.jU.getters.EqOptions,n=s.find((t=>t.TagID==e));if(n||i||a){if(i||a){var o=[new Y.Z];Object.assign(o,j.jU.getters.EQData);var l=o.filter((e=>e.Load_Request)),r=l.map((e=>e.Tag));console.log(r),Object.values(s).filter((e=>r.includes(e.TagID))).forEach((e=>{t.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}else{var d=n.ValidDownStreamEndPointNames,c=d.includes("ALL"),u=c?s:s.filter((e=>d.includes(e.Name)));Object.values(u).forEach((e=>{t.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}t=[...t,...this.BufferStations]}return t},GetLayersOfBuffer(e){const t=j.jU.getters.GetWIPSlotsOptionsByStationTag(e);if(!t)return[];const a=[];var i=t=>{var a=e=>e.ColumnsTagMap?Object.values(e.ColumnsTagMap).flat():[],i=j.jU.state.WIPsData.find((e=>a(e).includes(t)));if(i){let t=i.Ports.filter((t=>t.TagNumbers.includes(e)));return t.map((e=>({value:e.Layer,isCaroExist:e.CargoExist,cargoID:e.CarrierID})))}return[{value:0,isCaroExist:!1,cargoID:null}]};let s=i(e);for(let n=0;n<t.length;n++){const e=t[n];a.push({label:e,value:n,portState:s[n]})}return a},GetLayersOfEquipment(e){var t=this.TryGetMultiLayersOfEqTag(e);console.warn(t);var a=[];return t.forEach((e=>{var t=e.Height;a.push({label:`第${t+1}層(${e.Name})`,value:t})})),a},DetermineDestinOptions(){if("measure"==this.selected_action)return this.bay_names;if("move"==this.selected_action)return Q.p.getters.AllNormalStationOptions;if("park"==this.selected_action)return Q.p.getters.AllParkingStationOptions;if(this.IsSourceStationBuffer||"load"==this.selected_action||"unload"==this.selected_action)return[...this.BufferStations,...this.EQStations];if("charge"==this.selected_action)return Q.p.getters.AllChargeStation;if("carry"==this.selected_action){if(this.IsDeveloper)return this.downstream_options;var e=[new Y.Z];Object.assign(e,j.jU.getters.EQData);var t=e.filter((e=>e.Load_Request)),a=t.map((e=>e.Tag)),i=this.BufferStations.map((e=>e.tag));a=[...a,...i];var s=this.downstream_options.filter((e=>a.includes(e.tag)));return s}return"exchange_battery"==this.selected_action?Q.p.getters.AllExangeBatteryStation:[]},TryGetMultiLayersOfEqTag(e){try{let i=j.jU.state.EqOptions;var t=i.filter((t=>t.TagID==e)),a=t.find((e=>1==e.Height));return console.log(t),a?t:t[0]}catch(i){return[]}},GetGrpahDisplayByTag(e){try{var t=Object.values(Q.p.state.MapData.Points).find((t=>t.TagNumber==e));return t?t.Graph.Display:e+""}catch(a){return""}},ShowAtRight(){this.fixLoc="right"},ShowAtLeft(){this.fixLoc="left"},HandleMouseMoveWhenGrabing(e=MouseEvent){if(console.log(e),this.grabStates.grabing){var t=e.screenX-this.grabStates.oriX;e.screenY,this.grabStates.oriY;console.log(t),this.grabStates.newRightOffset=this.grabStates.oriRightOffset-t,this.DynamicStyle={right:this.grabStates.newRightOffset+"px"}}}},mounted(){this.routePath=this.$route.path;const e=(0,i.yj)();(0,s.YP)((()=>e.path),((e,t)=>{e!=this.routePath?(this.HandleCancelBtnClick(),this.order_info_visible=!1):(this.grabStates.updateKey=Date.now(),this.IsOpLogining&&(this.order_info_visible=!0))})),setTimeout((()=>{this.IsOpLogining&&(this.HandleDispatchButtonClick(),setTimeout((()=>{this.HandleSelectSoureStationFromMapBtnClick()}),1e3))}),3e3)},watch:{fixLoc(e){"left"==e?(this.DynamicStyle={},this.grabStates.updateKey++):"right"==e&&(this.DynamicStyle={right:"132px"},this.grabStates.oriRightOffset=this.grabStates.newRightOffset=28,this.grabStates.updateKey++)}}},X=a(83744);const J=(0,X.Z)(K,[["render",H],["__scopeId","data-v-3b1e6901"]]);var ee=J;const te=e=>((0,s.dD)("data-v-3ed2461c"),e=e(),(0,s.Cn)(),e),ae={class:"task-dispatch-new-ui"},ie={class:"bg-primary text-light d-flex flex-row"},se=te((()=>(0,s._)("div",{class:"w-100 title-text"}," 任務派送",-1))),ne={class:"page-pnl"},oe=te((()=>(0,s._)("div",{class:"head-text"},"請選擇任務動作",-1))),le={class:"actions-btn-conatiner"},re=te((()=>(0,s._)("label",null,"移動",-1))),de=[re],ce=te((()=>(0,s._)("label",null,"取貨",-1))),ue=[ce],me=te((()=>(0,s._)("label",null,"放貨",-1))),he=[me],pe=te((()=>(0,s._)("label",null,"搬運",-1))),ge=[pe],_e=te((()=>(0,s._)("label",null,"充電",-1))),we=[_e],fe={class:"page-pnl"},ye=te((()=>(0,s._)("div",{class:"head-text"},"請選擇車輛",-1))),ve={class:"actions-btn-conatiner"},Se=["onClick"],be={class:"page-pnl"},Ce=te((()=>(0,s._)("div",{class:"head-text"},"請選擇來源設備",-1))),ke={class:"station-btn-conatiner"},Te=["onClick"],De={class:"page-pnl"},Ve=te((()=>(0,s._)("div",{class:"head-text"},"請選擇目的地",-1))),Ae={class:"station-btn-conatiner"},Ie=["onClick"],xe={class:"page-pnl"},Ee=te((()=>(0,s._)("div",{class:"head-text"},"確認派送任務",-1))),Me={class:"actions-btn-conatiner"},Pe={class:"order-content"},Oe={class:"order-row"},Ne=te((()=>(0,s._)("label",{class:"title"},"動作",-1))),Le={class:"value"},Ge={class:"order-row"},Re=te((()=>(0,s._)("label",{class:"title"},"車輛",-1))),We={class:"value"},Ue={key:0,class:"order-row"},He=te((()=>(0,s._)("label",{class:"title"},"來源",-1))),$e={class:"value"},Fe={class:"order-row"},qe=te((()=>(0,s._)("label",{class:"title"},"目的地",-1))),Be={class:"value"},ze={class:"d-flex justify-content-center"},je=te((()=>(0,s._)("label",null,"確認派送",-1))),Ze=[je],Qe=te((()=>(0,s._)("label",null,"取消",-1))),Ye=[Qe];function Ke(e,t,a,i,l,r){const d=(0,s.up)("b-button");return(0,s.wg)(),(0,s.iD)("div",ae,[(0,s._)("div",ie,[se,(0,s._)("i",{onClick:t[0]||(t[0]=(...e)=>r.Leave&&r.Leave(...e)),class:"close-btn mx-2 bi bi-x-circle"})]),r.IsShowBackTo?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"back-to-last-step px-2",onClick:t[1]||(t[1]=(...e)=>r.HandleBackToPush&&r.HandleBackToPush(...e))},"返回 ["+(0,n.zw)(r.lastProgressDisplay)+"]",1)):(0,s.kq)("",!0),(0,s.wy)((0,s._)("div",ne,[oe,(0,s._)("div",le,[!r.IsRunMode||r.IsDeveloper?((0,s.wg)(),(0,s.iD)("div",{key:0,onClick:t[2]||(t[2]=e=>r.SelectActionHandle("move")),class:"action"},de)):(0,s.kq)("",!0),!r.IsRunMode||r.IsDeveloper?((0,s.wg)(),(0,s.iD)("div",{key:1,onClick:t[3]||(t[3]=e=>r.SelectActionHandle("unload")),class:"action"},ue)):(0,s.kq)("",!0),!r.IsRunMode||r.IsDeveloper?((0,s.wg)(),(0,s.iD)("div",{key:2,onClick:t[4]||(t[4]=e=>r.SelectActionHandle("load")),class:"action"},he)):(0,s.kq)("",!0),(0,s._)("div",{onClick:t[5]||(t[5]=e=>r.SelectActionHandle("carry")),class:"action"},ge),(0,s._)("div",{onClick:t[6]||(t[6]=e=>r.SelectActionHandle("charge")),class:"action"},we)])],512),[[o.F8,"select-action"==l.current_progress]]),(0,s.wy)((0,s._)("div",fe,[ye,(0,s._)("div",ve,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.AgvNameList,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.value,onClick:t=>r.SelectAgvHandle(e.value),class:"action"},[(0,s._)("label",null,(0,n.zw)(e.label),1)],8,Se)))),128))])],512),[[o.F8,"select-agv"==l.current_progress]]),(0,s.wy)((0,s._)("div",be,[Ce,(0,s._)("div",ke,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.eq_stations,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.tag,class:"action",onClick:t=>r.SelectSourceHandle(e)},[(0,s._)("label",null,(0,n.zw)(e.name_display),1)],8,Te)))),128))])],512),[[o.F8,"select-source"==l.current_progress]]),(0,s.wy)((0,s._)("div",De,[Ve,(0,s._)("div",Ae,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.destine_stations,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e.tag,class:"action",onClick:t=>r.SelectDestineHandle(e)},[(0,s._)("label",null,(0,n.zw)(e.name_display),1)],8,Ie)))),128))])],512),[[o.F8,"select-destine"==l.current_progress]]),(0,s.wy)((0,s._)("div",xe,[Ee,(0,s._)("div",Me,[(0,s._)("div",Pe,[(0,s._)("div",Oe,[Ne,(0,s._)("label",Le,(0,n.zw)(r.selected_action_display),1),(0,s.Wm)(d,{onClick:t[7]||(t[7]=()=>{l.current_progress="select-action",l.is_reselecting_flag=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})]),(0,s._)("div",Ge,[Re,(0,s._)("label",We,(0,n.zw)(""==l.selected_agv?e.$t("auto-choise-vehicle"):l.selected_agv),1),(0,s.Wm)(d,{onClick:t[8]||(t[8]=()=>{l.current_progress="select-agv",l.is_reselecting_flag=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})]),"carry"==l.selected_action?((0,s.wg)(),(0,s.iD)("div",Ue,[He,(0,s._)("label",$e,(0,n.zw)(l.selected_source.name_display),1),(0,s.Wm)(d,{onClick:t[9]||(t[9]=()=>{l.current_progress="select-source",l.is_reselecting_flag=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})])):(0,s.kq)("",!0),(0,s._)("div",Fe,[qe,(0,s._)("label",Be,(0,n.zw)(l.selected_destine.name_display),1),(0,s.Wm)(d,{onClick:t[10]||(t[10]=()=>{l.current_progress="select-destine",l.is_reselecting_flag=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)("重新選取")])),_:1})])]),(0,s._)("div",ze,[(0,s._)("div",{onClick:t[11]||(t[11]=(...e)=>r.HandleConfirmBtnClicked&&r.HandleConfirmBtnClicked(...e)),class:"action bg-primary text-light"},Ze),(0,s._)("div",{onClick:t[12]||(t[12]=e=>r.SelectDestineHandle("EQ_B")),class:"action bg-danger text-light"},Ye)])])],512),[[o.F8,"confirm-task"==l.current_progress]])])}var Xe={data(){return{current_progress:"select-action",selected_action:"",selected_agv:"",selected_source:"",selected_destine:"",Cst_ID_Input:"",downstream_stations:[],bypass_eq_status_check:!1,is_reselecting_flag:!1}},methods:{SelectActionHandle(e){this.selected_action=e,this.current_progress="select-agv"},SelectAgvHandle(e){this.selected_agv=e,this.is_reselecting_flag?this.current_progress="confirm-task":"carry"==this.selected_action?this.current_progress="select-source":this.current_progress="select-destine"},SelectSourceHandle(e){this.HandleFromSelectChanged(e.tag).then((t=>{this.selected_source=e,this.current_progress="select-destine"}))},SelectDestineHandle(e){this.selected_destine=e,this.is_reselecting_flag&&this.selected_action,this.current_progress="confirm-task"},HandleBackToPush(){this.is_reselecting_flag=!1,"select-agv"==this.current_progress&&(this.current_progress="select-action"),"select-source"==this.current_progress&&(this.current_progress="select-agv"),"select-destine"==this.current_progress&&("carry"==this.selected_action?this.current_progress="select-source":this.current_progress="select-agv"),"confirm-task"==this.current_progress&&(this.current_progress="select-destine")},async HandleFromSelectChanged(e){this.downstream_stations=[];var t=await(0,Z.H5)(),a=t.find((t=>t.TagID==e));if(a){var i=a.ValidDownStreamEndPointNames,s=t.filter((e=>i.includes(e.Name)));console.info(s),Object.values(s).forEach((e=>{this.downstream_stations.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`,name_display:e.Name})}))}return this.downstream_stations},HandleConfirmBtnClicked(){this.$swal.fire({title:this.$t("TaskDispatchNewUI.ConfirmDispatchText"),text:`${this.selected_agv} 執行 ${this.selected_action_display} 任務,終點:${this.selected_destine.name_display}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.TaskDeliveryHandle()}))},async TaskDeliveryHandle(){this.IsDeveloper?this.bypass_eq_status_check=!0:0==j.HP.getters.level&&(this.bypass_eq_status_check=!1);var e={confirm:!0,message:""},t=this.selected_destine.tag,a=this.selected_source.tag,i=this.selected_agv;if("move"==this.selected_action&&(e=await z.J8.MoveTask(new z.ec(i,t,50))),"measure"==this.selected_action&&(e=await z.J8.MeasureTask(new z.FV(i,t))),"load"==this.selected_action&&(e=await z.J8.LoadTask(new z.Y4(i,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selected_action&&(e=await z.J8.UnloadTask(new z.On(i,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selected_action&&(e=await z.J8.CarryTask(new z.mc(i,a,1,t,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"exchange_battery"==this.selected_action&&(e=await z.J8.ExangeBatteryTask(new z.Z$(i,t,50,this.bypass_eq_status_check))),"charge"==this.selected_action&&(e=await z.J8.ChargeTask(new z.fn(i,t,50,this.bypass_eq_status_check))),"park"==this.selected_action&&(e=await z.J8.ParkTask(new z.Nn(i,t,50,this.bypass_eq_status_check))),200!=e.status){const t=401==e.status;this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{t&&(j.HP.dispatch("logout",""),$.Z.emit("/show-login-view-invoke"),this.Leave())}))}else e.data.confirm?(F.Z.Success(`任務-[${this.selected_action_display}] 已派送!`,"bottom",2e3),this.Leave()):this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},Leave(){this.$emit("close"),this.is_reselecting_flag=!1,this.current_progress="select-action"}},computed:{IsRunMode(){return j.cy.getters.IsRunMode},IsShowBackTo(){return"select-action"!=this.current_progress},lastProgressDisplay(){var e=this.current_progress;return"select-agv"==e?"選擇動作":"select-source"==e?"選擇AGV":"select-destine"==e?"carry"==this.selected_action?"選擇起點":"選擇AGV":"confirm-task"==e?"選擇目的地":void 0},selected_action_display(){var e=this.selected_action;return"move"==e?"移動":"unload"==e?"取貨":"load"==e?"放貨":"carry"==e?"搬運":"charge"==e?"充電":void 0},IsDeveloper(){return j.HP.getters.IsDeveloperLogining},AgvNameList(){var e=[];function t(e){j.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return this.IsRunMode?(e.push({value:"",label:this.$t("auto-choise-vehicle")}),this.IsDeveloper&&t(e)):t(e),e},moveable_stations(){return Q.p.getters.AllNormalStationOptions},chargable_tags(){return Q.p.getters.AllChargeStation},eq_stations(){return Q.p.getters.AllEqStation},destine_stations(){return"move"==this.selected_action?this.moveable_stations:"charge"==this.selected_action?this.chargable_tags:"unload"==this.selected_action||"load"==this.selected_action?this.eq_stations:"carry"==this.selected_action?this.downstream_stations:[]}}};const Je=(0,X.Z)(Xe,[["render",Ke],["__scopeId","data-v-3ed2461c"]]);var et=Je;const tt={class:"eq-status",ref:"eq-status-container"},at={class:"text-start border-bottom p-2 my-2 d-flex flex-row justify-content-space"},it={class:"d-flex"},st={class:"p-1",style:{width:"120px"}},nt=(0,s._)("i",{class:"bi bi-three-dots-vertical pt-2"},null,-1),ot={key:0,class:"legend d-flex flex-row flex-nowrap px-2 w-100"},lt=(0,s._)("div",{class:"disconnect"},null,-1),rt=(0,s._)("div",{class:"signal-on"},null,-1),dt=(0,s._)("div",{class:"signal-off"},null,-1),ct=(0,s._)("div",{class:"flex-fill"},null,-1),ut={class:"hs-signals d-flex"},mt={class:"mx-3"},ht=["onClick"],pt=["onClick"],gt=["onClick"],_t=["onClick"],wt=["onClick"],ft={class:"hs-signals d-flex"},yt={class:"mx-3"},vt=["onClick"],St=["onClick"],bt=["onClick"],Ct=["onClick"],kt=["onClick"],Tt=["onClick"],Dt=["onClick"],Vt=["onClick"],At={key:0,class:"d-flex"},It={class:"mx-3"},xt=["onClick"],Et={style:{color:"grey"}},Mt=(0,s._)("i",{class:"bi bi-geo-alt-fill px-2",style:{"font-size":"14px",cursor:"pointer"}},null,-1),Pt={class:"d-flex w-100 justify-content-center"},Ot=["onClick"],Nt=["onClick"],Lt={class:"io-column-display-settings-container"},Gt={class:"column-name"};function Rt(e,t,a,i,o,l){const r=(0,s.up)("el-option"),d=(0,s.up)("el-select"),c=(0,s.up)("el-button"),u=(0,s.up)("el-table-column"),m=(0,s.up)("el-tooltip"),h=(0,s.up)("el-tag"),p=(0,s.up)("el-table"),g=(0,s.up)("el-switch"),_=(0,s.up)("el-drawer");return(0,s.wg)(),(0,s.iD)("div",tt,[(0,s._)("div",at,[(0,s._)("div",it,[(0,s._)("div",st,[nt,(0,s.Uk)(" "+(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.ViewMode")),1)]),(0,s.Wm)(d,{style:{width:"120px"},modelValue:o.display_mode,"onUpdate:modelValue":t[0]||(t[0]=e=>o.display_mode=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{label:e.$t("HomeView.EQ_Status"),value:"lduld_state"},null,8,["label"]),(0,s.Wm)(r,{label:e.$t("HomeView.EQStatus.EQStatus.IO"),value:"io_siganl"},null,8,["label"])])),_:1},8,["modelValue"])]),l.show_lduld_state?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",ot,[lt,(0,s._)("span",null,(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.DisConnect")),1),rt,(0,s._)("span",null,(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.ON")),1),dt,(0,s._)("span",null,(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.OFF")),1),ct,l.ShowIOColumnSettingButton?((0,s.wg)(),(0,s.j4)(c,{key:0,onClick:l.showColumnSettings},{default:(0,s.w5)((()=>[(0,s.Uk)("IO欄位顯示設定")])),_:1},8,["onClick"])):(0,s.kq)("",!0)]))]),(0,s.Wm)(p,{class:"eq-status-table px-1",border:"","scrollbar-always-on":"",siz:"small",style:(0,n.j5)(l.tableStyle),"header-cell-style":{color:"black",backgroundColor:"white"},data:l.display_data,"row-style":{fontWeight:"bold"},"row-class-name":l.eq_connection_status,"row-key":"EQName"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{type:"expand","max-width":"40"},{default:(0,s.w5)((t=>[(0,s._)("div",ut,[(0,s._)("div",mt,(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.Handshake_EQ")),1),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleHSsignaleChange(t.row.EQName,"L_REQ",!t.row.HS_EQ_L_REQ),style:(0,n.j5)(l.signalOn(t.row.HS_EQ_L_REQ))},"L_REQ",12,ht),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleHSsignaleChange(t.row.EQName,"U_REQ",!t.row.HS_EQ_U_REQ),style:(0,n.j5)(l.signalOn(t.row.HS_EQ_U_REQ))},"U_REQ",12,pt),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleHSsignaleChange(t.row.EQName,"READY",!t.row.HS_EQ_READY),style:(0,n.j5)(l.signalOn(t.row.HS_EQ_READY))},"READY",12,gt),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleHSsignaleChange(t.row.EQName,"UP_READY",!t.row.HS_EQ_UP_READY),style:(0,n.j5)(l.signalOn(t.row.HS_EQ_UP_READY))},"UP_READY",12,_t),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleHSsignaleChange(t.row.EQName,"LOW_READY",!t.row.HS_EQ_LOW_READY),style:(0,n.j5)(l.signalOn(t.row.HS_EQ_LOW_READY))},"LOW_READY",12,wt),(0,s.kq)("",!0)]),(0,s._)("div",ft,[(0,s._)("div",yt,(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.Handshake_AGV")),1),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"To_EQ_Up",!t.row.To_EQ_Up),style:(0,n.j5)(l.signalOn(t.row.To_EQ_Up))},"To_EQ_Up",12,vt),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"To_EQ_Low",!t.row.To_EQ_Low),style:(0,n.j5)(l.signalOn(t.row.To_EQ_Low))},"To_EQ_Low",12,St),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"Cmd_Reserve_Up",!t.row.Cmd_Reserve_Up),style:(0,n.j5)(l.signalOn(t.row.Cmd_Reserve_Up))},"Cmd_Reserve_Up",12,bt),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"Cmd_Reserve_Low",!t.row.Cmd_Reserve_Low),style:(0,n.j5)(l.signalOn(t.row.Cmd_Reserve_Low))},"Cmd_Reserve_Low",12,Ct),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"VALID",!t.row.HS_AGV_VALID),style:(0,n.j5)(l.signalOn(t.row.HS_AGV_VALID))},"VALID",12,kt),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"TR_REQ",!t.row.HS_AGV_TR_REQ),style:(0,n.j5)(l.signalOn(t.row.HS_AGV_TR_REQ))},"TR_REQ",12,Tt),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"BUSY",!t.row.HS_AGV_BUSY),style:(0,n.j5)(l.signalOn(t.row.HS_AGV_BUSY))},"BUSY",12,Dt),(0,s.kq)("",!0),(0,s._)("div",{class:"di-status",onClick:e=>l.HandleAGVHSSignaleChange(t.row.EQName,"COMPT",!t.row.HS_AGV_COMPT),style:(0,n.j5)(l.signalOn(t.row.HS_AGV_COMPT))},"COMPT",12,Vt)]),l.IsDeveloperLogining?((0,s.wg)(),(0,s.iD)("div",At,[(0,s._)("div",It,(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.emulator")),1),(0,s.Wm)(c,{type:"danger",onClick:e=>l.EQPDownSimulation(t.row)},{default:(0,s.w5)((()=>[(0,s.Uk)("當機")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.LDULD_Emu_State_Switch(t.row.EQName,"busy")},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.changetoBusy")),1)])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.LDULD_Emu_State_Switch(t.row.EQName,"load")},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.changetoLoad")),1)])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.LDULD_Emu_State_Switch(t.row.EQName,"unload")},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.changetoUnload")),1)])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.UpPoseSimulation(t.row.EQName)},{default:(0,s.w5)((()=>[(0,s.Uk)("撈爪上點位")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.DownPoseSimulation(t.row.EQName)},{default:(0,s.w5)((()=>[(0,s.Uk)("撈爪下點位")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.UnknownPoseSimulation(t.row.EQName)},{default:(0,s.w5)((()=>[(0,s.Uk)("撈爪未知位置")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.UpPoseSimulation(t.row.EQName)},{default:(0,s.w5)((()=>[(0,s.Uk)("轉向機構上點位")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{onClick:e=>l.DownPoseSimulation(t.row.EQName)},{default:(0,s.w5)((()=>[(0,s.Uk)("轉向機構下點位")])),_:2},1032,["onClick"]),(0,s.Wm)(c,{type:t.row.IsMaintaining?"success":"danger",onClick:e=>l.MaintainEmulation(t.row,"maintain")},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(t.row.IsMaintaining?e.$t("HomeView.EQStatus.EQStatus.Cancel_maintenance"):e.$t("HomeView.EQStatus.EQStatus.Maintenance_Simulation")),1)])),_:2},1032,["type","onClick"]),(0,s.Wm)(c,{type:t.row.IsPartsReplacing?"success":"danger",onClick:e=>l.PartsReplacingEmulation(t.row)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(t.row.IsPartsReplacing?e.$t("HomeView.EQStatus.EQStatus.Cancel_replacement_parts"):e.$t("HomeView.EQStatus.EQStatus.Part_replacement_simulation")),1)])),_:2},1032,["type","onClick"])])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(u,{sortable:"",label:e.$t("HomeView.EQStatus.EQStatus.EQ_Name"),prop:"EQName",width:"190","show-overflow-tooltip":""},{default:(0,s.w5)((e=>[(0,s._)("div",null,[(0,s.Uk)((0,n.zw)(e.row.EQName)+" ",1),(0,s.Wm)(m,{placement:"top-start",content:"複製到剪貼簿"},{default:(0,s.w5)((()=>[(0,s._)("i",{onClick:t=>l.CopyText(e.row.EQName),class:"copy-button copy-icon bi bi-clipboard"},null,8,xt)])),_:2},1024)])])),_:1},8,["label"]),(0,s.Wm)(u,{sortable:"",label:"Tag",prop:"Tag",width:"80",align:"center"},{default:(0,s.w5)((e=>[(0,s._)("div",Et,[(0,s.Uk)((0,n.zw)(e.row.Tag)+" ",1),Mt])])),_:1}),l.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:0,align:"center",width:"130",label:e.$t("HomeView.EQStatus.EQStatus.Main_Status"),prop:"MainStatus"},{default:(0,s.w5)((e=>[(0,s.Wm)(h,{style:{width:"80px"},type:l.GetMainStatusTagtype(e.row),effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(l.GetMainStatusStr(e.row)),1)])),_:2},1032,["type"])])),_:1},8,["label"])):(0,s.kq)("",!0),l.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:1,align:"center",width:"130",label:e.$t("HomeView.EQStatus.EQStatus.TransferStatus"),prop:"TransferStatus"},{default:(0,s.w5)((e=>[(0,s.Wm)(h,{style:{width:"80px"},type:l.GetTransferStatusTagtype(e.row.TransferStatus,e.row.IsConnected),effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(l.GetTransferStatusStr(e.row.TransferStatus,e.row.IsConnected)),1)])),_:2},1032,["type"])])),_:1},8,["label"])):(0,s.kq)("",!0),l.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:2,align:"center",width:"130",label:e.$t("HomeView.EQStatus.EQStatus.Exist")},{default:(0,s.w5)((t=>[(0,s._)("div",Pt,[t.row.Port_Exist?((0,s.wg)(),(0,s.j4)(h,{key:0,class:"mx-1",type:"success",effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.Instock")),1)])),_:1})):(0,s.kq)("",!0),t.row.Port_Exist?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(h,{key:1,class:"mx-1",type:"warning",effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.SoldOut")),1)])),_:1}))])])),_:1},8,["label"])):(0,s.kq)("",!0),l.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:3,align:"center",prop:"CarrierID",width:"200",label:e.$t("HomeView.EQStatus.EQStatus.CarrierID"),"show-overflow-tooltip":""},{default:(0,s.w5)((a=>[(0,s._)("div",null,[(0,s.Uk)((0,n.zw)(a.row.CarrierID)+" ",1),(0,s._)("i",{class:"bi bi-pencil-square",style:{cursor:"pointer"},onClick:t[1]||(t[1]=()=>{e.$router.push("/racks_status")})})])])),_:1},8,["label"])):(0,s.kq)("",!0),l.show_lduld_state?((0,s.wg)(),(0,s.j4)(u,{key:4,align:"center"})):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.load_request?((0,s.wg)(),(0,s.j4)(u,{key:5,label:e.$t("HomeView.EQStatus.EQStatus.Load"),prop:"Load_Request","min-width":o.column_width},{default:(0,s.w5)((t=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(t.row.Load_Request))},(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.Load")),5)])),_:1},8,["label","min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.unload_request?((0,s.wg)(),(0,s.j4)(u,{key:6,label:e.$t("HomeView.EQStatus.EQStatus.UnLoad"),prop:"Unload_Request","min-width":o.column_width},{default:(0,s.w5)((t=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(t.row.Unload_Request))},(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.UnLoad")),5)])),_:1},8,["label","min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.cargo_exist?((0,s.wg)(),(0,s.j4)(u,{key:7,label:e.$t("HomeView.EQStatus.EQStatus.Exist"),prop:"Port_Exist","min-width":o.column_width},{default:(0,s.w5)((t=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(t.row.Port_Exist))},(0,n.zw)(t.row.Port_Exist?e.$t("HomeView.EQStatus.EQStatus.Instock"):e.$t("HomeView.EQStatus.EQStatus.SoldOut")),5)])),_:1},8,["label","min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.port_status_down?((0,s.wg)(),(0,s.j4)(u,{key:8,label:"Down",prop:"Eqp_Status_Down","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.Eqp_Status_Down))},(0,n.zw)(0==e.row.EqType?"Normal":"Down"),5)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.running?((0,s.wg)(),(0,s.j4)(u,{key:9,label:"Run",prop:"Eqp_Status_Run","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.Eqp_Status_Run))},"Run",4)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.idle?((0,s.wg)(),(0,s.j4)(u,{key:10,label:"Idle",prop:"Eqp_Status_Idle","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.Eqp_Status_Idle))},"Idle",4)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.empty_rack_state_input?((0,s.wg)(),(0,s.j4)(u,{key:11,label:"空框移出/入",prop:"Empty_CST","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.Empty_CST,!1,"rgb(13, 110, 253)"))},"空框移出/入",4)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.full_rack_state_input?((0,s.wg)(),(0,s.j4)(u,{key:12,label:"實框移出/入",prop:"Full_CST","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.Full_CST,!1,"rgb(13, 110, 253)"))},"實框移出/入",4)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.empty_rack_state_output?((0,s.wg)(),(0,s.j4)(u,{key:13,label:"空框移入",prop:"To_EQ_Empty_CST","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",onClick:t=>l.EmptyRackMoveInControl(e.row.EQName,!e.row.To_EQ_Empty_CST),style:(0,n.j5)(l.signalOn(e.row.To_EQ_Empty_CST,!1,"rgb(16, 152, 104)"))},"空框移入",12,Ot)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.full_rack_state_output?((0,s.wg)(),(0,s.j4)(u,{key:14,label:"實框移入",prop:"To_EQ_Full_CST","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",onClick:t=>l.FullRackMoveInControl(e.row.EQName,!e.row.To_EQ_Full_CST),style:(0,n.j5)(l.signalOn(e.row.To_EQ_Full_CST,!1,"rgb(16, 152, 104)"))},"實框移入",12,Nt)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.maintaining?((0,s.wg)(),(0,s.j4)(u,{key:15,label:e.$t("HomeView.EQStatus.EQStatus.IsMaintaining"),prop:"IsMaintaining","min-width":o.column_width},{default:(0,s.w5)((t=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(t.row.IsMaintaining,!1,"red"))},(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.IsMaintaining")),5)])),_:1},8,["label","min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.parts_replacing?((0,s.wg)(),(0,s.j4)(u,{key:16,label:e.$t("HomeView.EQStatus.EQStatus.IsPartsReplacing"),prop:"IsPartsReplacing","min-width":o.column_width},{default:(0,s.w5)((t=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(t.row.IsPartsReplacing,!1,"red"))},(0,n.zw)(e.$t("HomeView.EQStatus.EQStatus.IsPartsReplacing")),5)])),_:1},8,["label","min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.down_pose?((0,s.wg)(),(0,s.j4)(u,{key:17,label:"Down_Pose",prop:"Down_Pose","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.Down_Pose,!1,"rgb(199, 167, 91)"))},"Down_Pose",4)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.up_pose?((0,s.wg)(),(0,s.j4)(u,{key:18,label:"Up_Pose",prop:"Up_Pose","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.Up_Pose,!1,"rgb(199, 167, 91)"))},"Up_Pose",4)])),_:1},8,["min-width"])):(0,s.kq)("",!0),!l.show_lduld_state&&o.ioColumnDisplaySetting.tB_down_pose?((0,s.wg)(),(0,s.j4)(u,{key:19,label:"TB_Down_Pose",prop:"TB_Down_Pose","min-width":o.column_width},{default:(0,s.w5)((e=>[(0,s._)("div",{class:"di-status",style:(0,n.j5)(l.signalOn(e.row.TB_Down_Pose,!1,"rgb(199, 167, 91)"))},"TB_Down",4)])),_:1},8,["min-width"])):(0,s.kq)("",!0)])),_:1},8,["style","data","row-class-name"]),(0,s.Wm)(_,{title:"IO訊號欄位顯示設定",modelValue:o.showIOColumnDisplaySetting,"onUpdate:modelValue":t[2]||(t[2]=e=>o.showIOColumnDisplaySetting=e),direction:"rtl",size:"300"},{default:(0,s.w5)((()=>[(0,s._)("div",Lt,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(o.ioColumnDisplaySetting,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t,class:"setting-item"},[(0,s._)("div",Gt,(0,n.zw)(l.formatSettingName(t)),1),(0,s.Wm)(g,{modelValue:o.ioColumnDisplaySetting[t],"onUpdate:modelValue":e=>o.ioColumnDisplaySetting[t]=e},null,8,["modelValue","onUpdate:modelValue"])])))),128))])])),_:1},8,["modelValue"])],512)}var Wt=a(91747),Ut=a(29776);class Ht{constructor(){this.unload_request=!0,this.load_request=!0,this.cargo_exist=!0,this.port_status_down=!0,this.running=!0,this.idle=!0,this.empty_rack_state_input=!1,this.full_rack_state_input=!1,this.empty_rack_state_output=!1,this.full_rack_state_output=!1,this.maintaining=!0,this.parts_replacing=!0,this.down_pose=!0,this.up_pose=!0,this.tB_down_pose=!1}}var $t={components:{RegionsSelector:Wt.Z},data(){return{column_width:103,selected_region:"all",display_mode:"lduld_state",previous_eq_data:[],zoomRatio:1,showIOColumnDisplaySetting:!1,ioColumnDisplaySetting:new Ht}},computed:{IsDeveloperLogining(){return j.HP.getters.IsDeveloperLogining},ShowIOColumnSettingButton(){return j.HP.state.user.Role>0},display_data(){return"all"==this.selected_region?this.eq_data:this.eq_data.filter((e=>e.Region==this.selected_region))},eq_data(){return j.jU.getters.EQData},show_lduld_state(){return"lduld_state"==this.display_mode},tableStyle(){return this.zoomRatio>.9?{height:.75*window.innerHeight+"px"}:{}}},mounted(){document.getElementsByClassName("di-status");$.Z.on("/map_init_done",(()=>{this.eq_data.forEach((e=>{$.Z.emit("/eq_lduld_status_changed",{tagNumber:e.Tag,status:e.TransferStatus})}))})),document.addEventListener("wheel",(e=>{e.ctrlKey&&(this.zoomRatio=window.devicePixelRatio)}),{passive:!1});const e=localStorage.getItem("ioColumnDisplay");if(e){var t=JSON.parse(e);Object.assign(this.ioColumnDisplaySetting,t)}(0,s.YP)((()=>this.ioColumnDisplaySetting),(e=>{localStorage.setItem("ioColumnDisplay",JSON.stringify(e))}),{deep:!0})},methods:{showColumnSettings(){this.showIOColumnDisplaySetting=!0},userStoreTest(){alert(j.HP.getters.IsDeveloperLogining)},formatSettingName(e){return e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")},eq_connection_status(e,t){var a=e.row.IsConnected;return a?"success-row":"error-row"},signalOn(e,t=!1,a="#00e300"){return e?t?{backgroundColor:"blue"}:{backgroundColor:a}:{backgroundColor:"rgb(204, 204, 204)"}},RegionSelectChanged(e){this.selected_region=e},filterRegionData(e,t,a){console.log(t)},CopyText(e){(0,Ut.O)(e)},LDULD_Emu_State_Switch(e="",t="busy|load|unlod"){Z.PQ.SetState(e,t)},UpPoseSimulation(e){Z.PQ.SetUpPose(e)},DownPoseSimulation(e){Z.PQ.SetDownPose(e)},UnknownPoseSimulation(e){Z.PQ.SetUnknownPose(e)},async EQPDownSimulation(e){await Z.PQ.EQDownStatusSimulation(e.Tag,!0)},async MaintainEmulation(e){var t=e.IsMaintaining,a=!t;await Z.PQ.SwitchMaintainstate(e.Tag,a)},async PartsReplacingEmulation(e){var t=e.IsPartsReplacing,a=!t;await Z.PQ.SwitchPartsReplacing(e.Tag,a)},EmuAllLoad(){Z.PQ.EQAllLoad()},EmuAllBusy(){Z.PQ.EQAllBusy()},HandleHSsignaleChange(e,t,a){this.IsDeveloperLogining&&Z.PQ.SetEQHsSignal(e,t,a)},HandleAGVHSSignaleChange(e,t,a){this.IsDeveloperLogining&&(0,Z.Aj)(e,t,a)},GetMainStatusStr(e=new Y.Z){const t=e.IsConnected,a=e.MainStatus,i=j.jU.state.EqOptions.find((t=>t.TagID==e.Tag));if(!t)return"斷線";switch(a){case 0:return"DOWN";case 1:return"RUN";case 2:return i&&2==i.IOLocation.STATUS_IO_SPEC_VERSION?"NORMAL":"IDLE";case 3:return"-";default:return a+""}},GetMainStatusTagtype(e=new Y.Z){const t=e.IsConnected,a=e.MainStatus,i=j.jU.state.EqOptions.find((t=>t.TagID==e.Tag));if(!t)return"danger";switch(a){case 0:return"danger";case 1:return"success";case 2:return i&&2==i.IOLocation.STATUS_IO_SPEC_VERSION?"success":"warning";case 3:return"success";default:break}},GetTransferStatusStr(e,t){if(!t)return"斷線";switch(e){case 0:return"斷線";case 1:return"可收料";case 2:return"可出料";case 3:return"No-Request";default:return e+""}},GetTransferStatusTagtype(e,t){if(!t)return"danger";switch(e){case 0:return"info";case 1:return"warning";case 2:return"success";case 3:return"info";case 4:return"success";default:break}},EmptyRackMoveInControl(e,t){(0,Z.kr)(e,t)},FullRackMoveInControl(e,t){(0,Z.Fi)(e,t)}}};const Ft=(0,X.Z)($t,[["render",Rt]]);var qt=Ft,Bt=a(61130),zt=a(44883),jt=a(65781),Zt=a(44056),Qt=a(91648),Yt={components:{AGVStatusVue:p.Z,TaskStatusVue:Bt.Z,HomeMap:g.Z,TaskAllocationVue:zt.Z,EQStatus:qt,TaskDispathActionButton:ee,TaskDispatchNewUI:et,MenuExpandIcon:jt.tsQ,MenuFoldIcon:jt.BAP,Header:Zt.Z},methods:{AdjustSizeOfRightSideFullPage(){const e=this.$el.querySelector(".right-panel");var t=e.parentElement.offsetWidth;this.previousLeftSideWidth=t-e.offsetWidth,e.style.width=`${t}px`},RestoreSizeOfRightSide(){this.$el.querySelector(".right-panel");const e=this.$el.querySelector(".left-panel");e.style.width=`${this.previousLeftSideWidth}px`},SavePanlWitdthToLocalStorage(e,t){localStorage.setItem("home-resizer",JSON.stringify({right:e,left:t}))},GetPanlWidthFromLocalStorage(){let e=localStorage.getItem("home-resizer");return e?JSON.parse(e):null},async HandleStopBuzzerClicked(){await(0,Qt.JV)()},handleTaskIDClicked(e){this.selectTaskID=e,this.selectTab=1,setTimeout((()=>{this.selectTaskID=""}),1e3)}},computed:{IsRunMode(){return j.cy.getters.IsRunMode},IsLogin(){return j.HP.getters.IsLogin},IsOpUsing(){return j.HP.getters.IsOPLogining}},data(){return{isEasyMode:!1,loading:!1,show_new_dispatch_panel:!1,right_side_tabSelected:"map",MenuExpanded:!0,previousLeftSideWidthStyle:"",selectTab:0,selectTaskID:""}},watch:{right_side_tabSelected(e){const t=this.$refs["task-dispatch-action-btn"];t&&("map"==e?t.ShowAtRight():t.ShowAtLeft())}},mounted(){$.Z.on("view_mode_changed",(e=>{this.loading=!0,this.isEasyMode=e,setTimeout((()=>{this.loading=!1}),300)})),$.Z.on("viewEqStatus",(()=>{this.right_side_tabSelected="eqStatus"}));const e=this.$el.querySelector(".resizer"),t=this.$el.querySelector(".left-panel"),a=this.$el.querySelector(".right-panel");let i=!1;var s=t.parentElement.offsetWidth;t.style.width="50vw",a.style.width="50vw";var n=this;setTimeout((()=>{if(this.IsOpUsing)return t.style.width="800px",void(a.style.width="854px");var e=this.GetPanlWidthFromLocalStorage();e&&(t.style.width=e.left,a.style.width=e.right)}),200),e.addEventListener("mousedown",(e=>{i=!0;let o=e.pageX;const l=e=>{if(!i||!n.MenuExpanded)return;const l=e.pageX-o,r=t.offsetWidth+l;var d=s-r;let c=`${r}px`,u=`${d}px`;t.style.width=c,a.style.width=u,n.previousLeftSideWidth=r,o=e.pageX},r=()=>{i&&setTimeout((()=>{this.SavePanlWitdthToLocalStorage(t.style.width,a.style.width)}),299),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",r),i=!1};window.addEventListener("mousemove",l),window.addEventListener("mouseup",r)}))}};const Kt=(0,X.Z)(Yt,[["render",h]]);var Xt=Kt;const Jt={class:"data-view custom-tabs-head-large"},ea={class:"w-100"},ta={class:"w-100"},aa={class:"w-100"},ia={class:"w-100"};function sa(e,t,a,i,n,o){const l=(0,s.up)("TaskQuery"),r=(0,s.up)("b-tab"),d=(0,s.up)("AlarmQuery"),c=(0,s.up)("AGVLocusDisplay"),u=(0,s.up)("InstrumentMeasureQuery"),m=(0,s.up)("AvalibilityQuery"),h=(0,s.up)("b-tabs");return(0,s.wg)(),(0,s.iD)("div",Jt,[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,{title:"歷史任務查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",ea,[(0,s.Wm)(l)])])),_:1}),(0,s.Wm)(r,{title:"歷史警報查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",ta,[(0,s.Wm)(d)])])),_:1}),(0,s.Wm)(r,{title:"AGV軌跡查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",aa,[(0,s.Wm)(c)])])),_:1}),(0,s.Wm)(r,{title:"儀器量測結果查詢"},{default:(0,s.w5)((()=>[(0,s._)("div",ia,[(0,s.Wm)(u)])])),_:1}),(0,s.Wm)(r,{title:"機台稼動"},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{style:{height:"100vh"}},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{title:"查詢"},{default:(0,s.w5)((()=>[(0,s.Wm)(m)])),_:1})])),_:1})])),_:1})])),_:1})])}const na={class:"data-view text-start p-2"},oa=(0,s._)("h3",null,"今日稼動狀態",-1),la={class:"bg-light py-3 mx-1 border"};function ra(e,t,a,i,n,o){const l=(0,s.up)("AvailabilityTimelineChart");return(0,s.wg)(),(0,s.iD)("div",na,[oa,(0,s._)("div",la,[(0,s.Wm)(l,{ref:"rt-availbility-chart"},null,512)])])}var da=a(43125),ca=a(51455),ua=a(53658),ma=a(30381),ha=a.n(ma),pa={components:{AvailabilityPieChart:ca.Z,AvailabilityTimelineChart:ua.Z},data(){return{data:[2,33,1,2,3],todayData:{},pause:!0,timer:void 0}},mounted(){this.FetchTodayDataAndRender();const e=(0,i.yj)();(0,s.YP)((()=>e.path),((e,t)=>{this.pause="/data"!=e,this.pause?this.StopTimer():this.StartTimer()}))},computed:{todayTimelineChart(){return this.$refs["rt-availbility-chart"]}},methods:{async FetchTodayDataAndRender(){this.todayData=await(0,da.y)(),this.todayTimelineChart&&this.todayTimelineChart.RenderChart(this.todayData)},StartTimer(){this.FetchTodayDataAndRender()},StopTimer(){this.timer&&clearInterval(this.timer)}}};const ga=(0,X.Z)(pa,[["render",ra]]);var _a=ga,wa=a(53806),fa=a(79888),ya=a(78075),va=a(51826),Sa=a(90259),ba={components:{AvailbilitysData:_a,AvalibilityQuery:wa["default"],AlarmQuery:fa["default"],AGVLocusDisplay:va["default"],TaskQuery:ya["default"],InstrumentMeasureQuery:Sa["default"]}};const Ca=(0,X.Z)(ba,[["render",sa]]);var ka=Ca;const Ta={class:"alarm-view"},Da={class:"d-flex flex-row mb-2"},Va={class:"flex-fill"};function Aa(e,t,a,i,o,l){const r=(0,s.up)("b-button"),d=(0,s.up)("el-table-column"),c=(0,s.up)("el-table"),u=(0,s.up)("el-divider");return(0,s.wg)(),(0,s.iD)("div",Ta,[(0,s._)("div",Da,[(0,s._)("h3",Va,(0,n.zw)(e.$t("App.Header.systemalarm")),1),l.is_user_login?((0,s.wg)(),(0,s.j4)(r,{key:0,variant:"danger",onClick:t[0]||(t[0]=e=>l.ResetSystemAlarm())},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.$t("App.Header.alarmreset")),1)])),_:1})):(0,s.kq)("",!0)]),(0,s.Wm)(c,{data:l.sys_alarms,border:"","row-class-name":l.row_state_class_name},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:e.$t("AlarmTable.Time"),prop:"Time",width:"160"},{default:(0,s.w5)((e=>[(0,s.Uk)((0,n.zw)(l.formatTime(e.row.Time)),1)])),_:1},8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.EQ_Name"),prop:"Equipment_Name",width:"120","show-overflow-tooltip":""},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Alarm_code"),prop:"AlarmCode",width:"120"},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Alarm_description"),prop:"Description_En","show-overflow-tooltip":""},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(e.row.Description_En)+"("+(0,n.zw)(e.row.Description_Zh)+")",1)])),_:1},8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Alarm_Type"),prop:"Level",width:"120"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(1==e.row.Level?"ALARM":"WARNING"),1)])),_:1},8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.TaskName"),prop:"Task_Name",width:"160","show-overflow-tooltip":""},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Occur_Tag"),prop:"OccurLocation",width:"120","show-overflow-tooltip":""},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Duration"),prop:"Duration",width:"120"},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Clear_OP"),prop:"ResetAalrmMemberName",width:"120"},null,8,["label"])])),_:1},8,["data","row-class-name"]),(0,s.Wm)(u),(0,s._)("h3",null,(0,n.zw)(e.$t("App.Header.eqalarm")),1),(0,s.Wm)(c,{data:l.eq_alarms,border:"","row-class-name":l.row_state_class_name},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:e.$t("AlarmTable.Time"),prop:"Time",width:"160"},{default:(0,s.w5)((e=>[(0,s.Uk)((0,n.zw)(l.formatTime(e.row.Time)),1)])),_:1},8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.EQ_Name"),prop:"Equipment_Name",width:"150","show-overflow-tooltip":""},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Alarm_code"),prop:"AlarmCode",width:"120"},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Alarm_description"),prop:"Description_En","show-overflow-tooltip":""},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(e.row.Description_En)+"("+(0,n.zw)(e.row.Description_Zh)+")",1)])),_:1},8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Alarm_Type"),prop:"Level",width:"120"},{default:(0,s.w5)((e=>[(0,s._)("div",null,(0,n.zw)(1==e.row.Level?"ALARM":"WARNING"),1)])),_:1},8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.TaskName"),prop:"Task_Name",width:"160","show-overflow-tooltip":""},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Occur_Tag"),prop:"OccurLocation",width:"120","show-overflow-tooltip":""},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Duration"),prop:"Duration",width:"120"},null,8,["label"]),(0,s.Wm)(d,{label:e.$t("AlarmTable.Clear_OP"),prop:"ResetAalrmMemberName",width:"120"},null,8,["label"])])),_:1},8,["data","row-class-name"])])}var Ia={data(){return{}},computed:{is_user_login(){return j.HP.getters.IsLogin},sys_alarms(){return this.alarms.filter((e=>0==e.Source))},eq_alarms(){return this.alarms.filter((e=>1==e.Source))},alarms(){return j.qz.getters.alarms}},mounted(){},methods:{ResetSystemAlarm(){(0,Qt.gU)()},formatTime(e){return ha()(e).format("yyyy/MM/DD HH:mm:ss")},row_state_class_name({row:e,rowIndex:t}){return 1==e.Level?"ALARM":"WARNING"}}};const xa=(0,X.Z)(Ia,[["render",Aa]]);var Ea=xa;const Ma={class:"charge-station-setup",style:{height:"100%"}},Pa={key:0,class:"my-5 mx-3"},Oa={class:"charger-states rounded text-start py-3"},Na={class:"px-3"},La={class:"state p-3"},Ga=(0,s._)("h5",{class:"title"},"使用中車輛",-1),Ra={class:"d-flex w-100"},Wa={class:"state p-3"},Ua=(0,s._)("h5",{class:"title"},"狀態",-1),Ha={class:"d-flex flex-column w-100"},$a={class:"w-100 d-flex px-3"},Fa={class:"digital-font-charger-station"},qa=(0,s._)("span",{class:"digital-font-unit-charger-station"},"V",-1),Ba={class:"w-100 d-flex px-3"},za={class:"digital-font-charger-station"},ja=(0,s._)("span",{class:"digital-font-unit-charger-station"},"V",-1),Za={class:"w-100 d-flex px-3"},Qa={class:"digital-font-charger-station"},Ya=(0,s._)("span",{class:"digital-font-unit-charger-station"},"A",-1),Ka={class:"w-100 d-flex px-3"},Xa={class:"digital-font-charger-station"},Ja=(0,s._)("span",{class:"digital-font-unit-charger-station"},"°C",-1),ei={class:"w-100 d-flex px-3"},ti=(0,s._)("span",{class:"digital-font-unit-charger-station"},"°C",-1),ai={class:"state mx-2 p-3"},ii=(0,s._)("h5",{class:"title"},"充電曲線參數",-1),si={class:"d-flex"},ni={class:"d-flex"},oi={class:"d-flex"},li={class:"d-flex"},ri=(0,s._)("h6",null,"充電曲線參考圖示",-1),di=(0,s._)("img",{class:"border rounded p-3",src:"/images/charger_curve.png",alt:""},null,-1),ci={class:"state p-3"},ui=(0,s._)("h5",{class:"title"},"充電樁配置",-1),mi={class:"d-flex w-100"},hi=(0,s._)("div",{class:"w-100 d-flex"},null,-1),pi={class:"text-start",style:{"font-size":"14px"}},gi=(0,s._)("span",null,"前次更新時間 :",-1),_i={class:"d-flex justify-content-end w-100 border-top py-2"};function wi(e,t,a,i,o,l){const r=(0,s.up)("el-skeleton"),d=(0,s.up)("el-tag"),c=(0,s.up)("el-form-item"),u=(0,s.up)("el-form"),m=(0,s.up)("el-input"),h=(0,s.up)("el-button"),p=(0,s.up)("el-option"),g=(0,s.up)("el-select"),_=(0,s.up)("el-input-number"),w=(0,s.up)("el-tab-pane"),f=(0,s.up)("el-tabs"),y=(0,s.up)("el-dialog"),v=(0,s.Q2)("loading");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",Ma,[l.IsChargeStationDataReceived?((0,s.wg)(),(0,s.j4)(f,{key:1,lazy:"",type:"border-card","tab-position":"top",onTabChange:l.HandleTabChange,modelValue:o.selectedTabName,"onUpdate:modelValue":t[4]||(t[4]=e=>o.selectedTabName=e),style:{height:"90%"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.charge_station_data,((e,a)=>((0,s.wg)(),(0,s.j4)(w,{class:"h-100",key:a,label:a,name:a},{default:(0,s.w5)((()=>[(0,s._)("div",Oa,[(0,s._)("h3",Na,(0,n.zw)(a),1),(0,s._)("div",La,[Ga,e.UseVehicleName&&""!=e.UseVehicleName?((0,s.wg)(),(0,s.j4)(d,{key:1},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.UseVehicleName),1)])),_:2},1024)):((0,s.wg)(),(0,s.j4)(d,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)("無")])),_:1}))]),(0,s._)("div",Ra,[(0,s._)("div",Wa,[Ua,(0,s.Wm)(u,{"label-width":"150","label-position":"left"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:"通訊狀態"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{effect:"dark",type:e.Connected?"success":"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Connected?"正常":"斷線"),1)])),_:2},1032,["type"])])),_:2},1024),e.IsUsing?((0,s.wg)(),(0,s.j4)(c,{key:0,label:"運轉狀態"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{effect:"dark",type:l.GetTagType(e)},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e.Connected?0==e.ErrorCodes.length?"Normal":"Warning":"Disconnect"),1)])),_:2},1032,["type"])])),_:2},1024)):((0,s.wg)(),(0,s.j4)(c,{key:1,label:"運轉狀態"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{effect:"dark",type:"warning"},{default:(0,s.w5)((()=>[(0,s.Uk)("閒置中")])),_:1})])),_:1})),e.IsUsing?((0,s.wg)(),(0,s.j4)(c,{key:2,label:"當前充電模式",class:"d-flex"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(l.GetChargeMode(e.CurrentChargeMode)),1)])),_:2},1024),e.IsBatteryFull?((0,s.wg)(),(0,s.j4)(d,{key:0,type:"success",effect:"dark"},{default:(0,s.w5)((()=>[(0,s.Uk)("已充飽電")])),_:1})):(0,s.kq)("",!0)])),_:2},1024)):(0,s.kq)("",!0),(0,s.Wm)(c,{label:"異常"},{default:(0,s.w5)((()=>[(0,s._)("div",Ha,[e.ErrorCodesDescrptions&&0==e.ErrorCodesDescrptions.length?((0,s.wg)(),(0,s.j4)(d,{key:0,type:"success"},{default:(0,s.w5)((()=>[(0,s.Uk)("尚無異常")])),_:1})):((0,s.wg)(!0),(0,s.iD)(s.HY,{key:1},(0,s.Ko)(e.ErrorCodesDescrptions,(e=>((0,s.wg)(),(0,s.j4)(d,{class:"w-100",key:e,type:"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(e),1)])),_:2},1024)))),128))])])),_:2},1024),(0,s.Wm)(c,{label:"輸入電壓(AC)"},{default:(0,s.w5)((()=>[(0,s._)("div",$a,[(0,s._)("span",Fa,(0,n.zw)(e.Vin),1),qa])])),_:2},1024),(0,s.Wm)(c,{label:"輸出電壓(DC)"},{default:(0,s.w5)((()=>[(0,s._)("div",Ba,[(0,s._)("span",za,(0,n.zw)(e.Vout),1),ja])])),_:2},1024),(0,s.Wm)(c,{label:"輸出電流"},{default:(0,s.w5)((()=>[(0,s._)("div",Za,[(0,s._)("span",Qa,(0,n.zw)(e.Iout),1),Ya])])),_:2},1024),(0,s.Wm)(c,{label:"充電器溫度"},{default:(0,s.w5)((()=>[(0,s._)("div",Ka,[(0,s._)("span",Xa,(0,n.zw)(e.Temperature),1),Ja])])),_:2},1024),(0,s.Wm)(c,{label:"充電站溫度"},{default:(0,s.w5)((()=>[(0,s._)("div",ei,[(0,s._)("span",{class:(0,n.C_)(["digital-font-charger-station",e.IsStationTemperatureOverThresHold?"text-danger":""])},(0,n.zw)(e.StationTemperature),3),ti])])),_:2},1024)])),_:2},1024)]),(0,s._)("div",ai,[ii,(0,s.Wm)(u,{"label-width":"70","label-position":"left"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:"CC"},{default:(0,s.w5)((()=>[(0,s._)("div",si,[(0,s.Wm)(m,{precision:2,disabled:"",modelValue:e.CC,"onUpdate:modelValue":t=>e.CC=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(h,{disabled:!l.IsLogin,onClick:t=>l.HandleSettingBtnClick(a,"cc",e.CC)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,s.Wm)(c,{label:"CV"},{default:(0,s.w5)((()=>[(0,s._)("div",ni,[(0,s.Wm)(m,{precision:2,disabled:"",modelValue:e.CV,"onUpdate:modelValue":t=>e.CV=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(h,{disabled:!l.IsLogin,onClick:t=>l.HandleSettingBtnClick(a,"cv",e.CV)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,s.Wm)(c,{label:"FV"},{default:(0,s.w5)((()=>[(0,s._)("div",oi,[(0,s.Wm)(m,{precision:2,disabled:"",modelValue:e.FV,"onUpdate:modelValue":t=>e.FV=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(h,{disabled:!l.IsLogin,onClick:t=>l.HandleSettingBtnClick(a,"fv",e.FV)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024),(0,s.Wm)(c,{label:"TC"},{default:(0,s.w5)((()=>[(0,s._)("div",li,[(0,s.Wm)(m,{precision:2,disabled:"",modelValue:e.TC,"onUpdate:modelValue":t=>e.TC=t},null,8,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(h,{disabled:!l.IsLogin,onClick:t=>l.HandleSettingBtnClick(a,"tc",e.TC)},{default:(0,s.w5)((()=>[(0,s.Uk)("設定")])),_:2},1032,["disabled","onClick"])])])),_:2},1024)])),_:2},1024),ri,di]),(0,s._)("div",ci,[ui,(0,s.Wm)(u,{"label-width":"120","label-position":"left"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:"可使用AGV"},{default:(0,s.w5)((()=>[(0,s._)("div",mi,[o.IsModify?((0,s.wg)(),(0,s.j4)(g,{key:1,size:"small",modelValue:o.UsableAGVNamesEdit,"onUpdate:modelValue":t[0]||(t[0]=e=>o.UsableAGVNamesEdit=e),multiple:"",placeholder:"Select",style:{width:"1000px"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.GetAGVName,(e=>((0,s.wg)(),(0,s.j4)(p,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):((0,s.wg)(),(0,s.j4)(g,{key:0,disabled:!0,size:"small",modelValue:e.UsableAGVNames,"onUpdate:modelValue":t=>e.UsableAGVNames=t,multiple:"",placeholder:"Select",style:{width:"1000px"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.GetAGVName,(e=>((0,s.wg)(),(0,s.j4)(p,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])),(0,s.Wm)(h,{class:"mx-2",type:o.IsModify?"success":"",size:"large",onClick:()=>{o.IsModify=!o.IsModify,o.IsModify?o.UsableAGVNamesEdit=e.UsableAGVNames:l.SaveUsableAGVSetting(a,o.UsableAGVNamesEdit)}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(o.IsModify?"儲存":"修改"),1)])),_:2},1032,["type","onClick"]),o.IsModify?((0,s.wg)(),(0,s.j4)(h,{key:2,class:"mx-2",type:"danger",size:"large",onClick:t[1]||(t[1]=()=>{o.IsModify=!1})},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1})):(0,s.kq)("",!0)])])),_:2},1024),(0,s.Wm)(c,{label:"Tag"},{default:(0,s.w5)((()=>[hi,o.IsTagNumberModify?((0,s.wg)(),(0,s.j4)(_,{key:1,size:"large",class:"flex-fill",modelValue:o.TagNumberForEdit,"onUpdate:modelValue":t[2]||(t[2]=e=>o.TagNumberForEdit=e)},null,8,["modelValue"])):((0,s.wg)(),(0,s.j4)(_,{key:0,size:"large",class:"flex-fill",modelValue:e.TagNumber,"onUpdate:modelValue":t=>e.TagNumber=t,disabled:!0},null,8,["modelValue","onUpdate:modelValue"])),o.IsTagNumberModify?((0,s.wg)(),(0,s.j4)(h,{key:2,size:"large",class:"mx-2",type:"success",onClick:()=>{o.IsTagNumberModify=!o.IsTagNumberModify,l.ChangeTagNumerOfStation(a,o.TagNumberForEdit)}},{default:(0,s.w5)((()=>[(0,s.Uk)("儲存")])),_:2},1032,["onClick"])):((0,s.wg)(),(0,s.j4)(h,{key:3,size:"large",class:"mx-2",onClick:()=>{o.IsTagNumberModify=!o.IsTagNumberModify,o.TagNumberForEdit=e.TagNumber}},{default:(0,s.w5)((()=>[(0,s.Uk)("修改")])),_:2},1032,["onClick"])),o.IsTagNumberModify?((0,s.wg)(),(0,s.j4)(h,{key:4,size:"large",class:"mx-2",type:"danger",onClick:t[3]||(t[3]=()=>{o.IsTagNumberModify=!o.IsTagNumberModify})},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1})):(0,s.kq)("",!0)])),_:2},1024)])),_:2},1024)])])]),(0,s._)("div",pi,[gi,(0,s.Uk)(" "+(0,n.zw)(l.FormatTime(e.Time)),1)])])),_:2},1032,["label","name"])))),128))])),_:1},8,["onTabChange","modelValue"])):((0,s.wg)(),(0,s.iD)("div",Pa,[(0,s.Wm)(r,{rows:10,animated:""})])),(0,s.Wm)(y,{draggable:"",title:`${o.DialogData.EqName}-${o.DialogData.Item.toUpperCase()} 設定`,width:"300px",modelValue:o.SettingDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>o.SettingDialogVisible=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{class:"border-top py-2","label-width":"60px"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:o.DialogData.Item.toUpperCase()},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{step:.1,precision:2,modelValue:o.DialogData.Value,"onUpdate:modelValue":t[5]||(t[5]=e=>o.DialogData.Value=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),(0,s._)("div",_i,[(0,s.Wm)(h,{type:"success",onClick:l.HandleConfirmClick},{default:(0,s.w5)((()=>[(0,s.Uk)("確定")])),_:1},8,["onClick"]),(0,s.Wm)(h,{type:"danger",onClick:t[6]||(t[6]=e=>o.SettingDialogVisible=!1)},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1})])])),_:1},8,["title","modelValue"])])),[[v,!l.IsChargeStationDataReceived]])}var fi=a(663),yi={computed:{charge_station_data(){return j.jU.state.ChargeStation},IsLogin(){return j.HP.getters.IsLogin},IsChargeStationDataReceived(){return j.jU.state.ChargeStationDataReceived},GetAGVName(){return j.sn.getters.AGVNameList}},data(){return{select:1,selectedTabName:"",previousSelectedTabName:"",SettingDialogVisible:!1,DialogData:{EqName:"",Item:"CC",Value:33,UsableAGVNames:[]},UsableAGVNamesEdit:[],IsModify:!1,IsTagNumberModify:!1,TagNumberForEdit:0}},watch:{IsChargeStationDataReceived(e){e&&this.SetDefaultTab()}},mounted(){this.SetDefaultTab()},methods:{SetDefaultTab(){this.selectedTabName=this.previousSelectedTabName=Object.keys(this.charge_station_data)[0]},HandleTabChange(e){if(this.previousSelectedTabName!=e&&this.IsModify){var t=this.charge_station_data[this.previousSelectedTabName].UsableAGVNames,a=JSON.stringify(this.UsableAGVNamesEdit)!=JSON.stringify(t);a?this.$swal.fire({text:"",title:`${this.previousSelectedTabName} 可用車輛設定尚未儲存，確定要離開嗎?`,icon:"warning",showCancelButton:!1,confirmButtonText:"OK",cancelButtonText:"返回",showCancelButton:!0,customClass:"my-sweetalert"}).then((t=>{if(!t.isConfirmed)return this.selectedTabName=this.previousSelectedTabName,void(this.IsModify=!0);this.IsModify=!1,this.previousSelectedTabName=e})):(this.IsModify=!1,this.previousSelectedTabName=e)}else this.previousSelectedTabName!=e&&(this.IsModify=!1,this.previousSelectedTabName=e);this.IsTagNumberModify=!1},GetTagType(e){return e.Connected?0==e.ErrorCodes.length?"success":"warning":"danger"},GetChargeMode(e){if(0!=e&&1!=e&&2!=e)return"未知";var t={0:"定電壓模式",1:"浮充模式",2:"定電流模式"};return t[e]},FormatTime(e){return ha()(e).format("yyyy/MM/DD HH:mm:ss")},HandleSettingBtnClick(e,t,a){this.DialogData.EqName=e,this.DialogData.Item=t,this.DialogData.Value=a,this.SettingDialogVisible=!0},HandleConfirmClick(){this.SettingDialogVisible=!1,this.$swal.fire({text:"",title:`確定要將${this.DialogData.EqName} ${this.DialogData.Item.toUpperCase()} 更改為 ${this.DialogData.Value} ?`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=await Z.yS.SetCurveSetting(this.DialogData.EqName,this.DialogData.Item,this.DialogData.Value),a=t.confirm?"success":"error";this.$swal.fire({text:t.confirm?"":t.message,title:t.confirm?"修改成功":"修改失敗",icon:a,showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert",timer:t.confirm?3e3:-1}).then((e=>{t.confirm||(this.SettingDialogVisible=!0)}))}else this.SettingDialogVisible=!0}))},async SaveUsableAGVSetting(e,t){var a=await Z.yS.SaveUsableAGVSetting(e,t);a.confirm?this.$swal.fire({title:`${e} 可用車輛設定已儲存!`,icon:"info",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):this.$swal.fire({text:a.message,title:`${e} 可用車輛設定失敗!`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async ChangeTagNumerOfStation(e="",t=-1){var a=await Z.yS.ModifyTagNumber(e,t);a.confirm?this.$swal.fire({title:`${e} Tag 設定成功!`,icon:"info",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):(this.IsTagNumberModify=!0,this.$swal.fire({text:a.message,title:`${e} Tag 設定失敗!`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}))}}};const vi=(0,X.Z)(yi,[["render",wi]]);var Si=vi;const bi=e=>((0,s.dD)("data-v-077e8500"),e=e(),(0,s.Cn)(),e),Ci={class:"login-view"},ki=bi((()=>(0,s._)("img",{class:"border-bottom py-2",src:"/GPM_Logo.png",alt:""},null,-1))),Ti=bi((()=>(0,s._)("p",{class:"login-title-text"},"USER LOGIN",-1))),Di={class:"login-message"};function Vi(e,t,a,i,l,r){const d=(0,s.up)("b-form-input"),c=(0,s.up)("el-form-item"),u=(0,s.up)("b-button"),m=(0,s.up)("el-form");return(0,s.wg)(),(0,s.iD)("div",Ci,[(0,s.Wm)(m,{class:"login-form border p-5 rounded","label-position":"top"},{default:(0,s.w5)((()=>[ki,Ti,(0,s.Wm)(c,{label:"User Name",required:!0},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{autofocus:"",autocomplete:"new-password",disabled:r.IsLogin,ref:"account",onKeyup:[(0,o.D2)(r.FocusPasswordInput,["enter"]),(0,o.D2)(r.FocusPasswordInput,["down"]),t[0]||(t[0]=(0,o.D2)((e=>l.UserName=""),["esc"]))],modelValue:l.UserName,"onUpdate:modelValue":t[1]||(t[1]=e=>l.UserName=e),state:""!=l.UserName,placeholder:"Please Enter Your User Name",required:""},null,8,["disabled","onKeyup","modelValue","state"])])),_:1}),(0,s.Wm)(c,{label:"Password",required:!0},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{autocomplete:"new-password",type:"password",disabled:r.IsLogin,ref:"pw_input",onKeyup:[(0,o.D2)(r.PasswordEnterClickHandler,["enter"]),(0,o.D2)(r.FocusAccountInput,["up"]),t[2]||(t[2]=(0,o.D2)((e=>l.Password=""),["esc"]))],modelValue:l.Password,"onUpdate:modelValue":t[3]||(t[3]=e=>l.Password=e),state:""!=l.Password,placeholder:"Please Enter Your Password",required:""},null,8,["disabled","onKeyup","modelValue","state"])])),_:1}),r.IsLogin?((0,s.wg)(),(0,s.j4)(c,{key:0},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{onClick:t[4]||(t[4]=e=>r.LogoutHandle()),loading:l.logouting,class:"w-100",variant:"danger"},{default:(0,s.w5)((()=>[(0,s.Uk)("Logout")])),_:1},8,["loading"])])),_:1})):(0,s.kq)("",!0),r.IsLogin?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(c,{key:1},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{onClick:t[5]||(t[5]=e=>r.LoginHandle()),disabled:l.logining,loading:l.logining,class:"w-100",variant:"primary"},{default:(0,s.w5)((()=>[(0,s.Uk)("Login")])),_:1},8,["disabled","loading"])])),_:1})),(0,s._)("div",Di,(0,n.zw)(l.message),1)])),_:1})])}var Ai={components:{},data(){return{UserName:"",Password:"",focus_input:"account",keyboard_input:"",message:"",logining:!1,logouting:!1,ShowLogoutDialog:!1}},computed:{IsLogin(){return j.HP.getters.IsLogin}},methods:{FocusPasswordInput(){this.$refs["pw_input"].focus()},FocusAccountInput(){this.$refs["account"].focus()},PasswordEnterClickHandler(){this.LoginHandle()},Show(e="/"){this.current_route=e,this.IsLogin?(this.UserName=j.HP.getters.UserName,this.Password="********************"):this.message=this.UserName=this.Password=""},async LoginHandle(){return""==this.UserName?(this.message="Please Enter User Name",void this.FocusAccountInput()):""==this.Password?(this.message="Please Enter Passowrd",void this.FocusPasswordInput()):(this.message="",this.logining=!0,void setTimeout((async()=>{const e={Username:this.UserName,Password:this.Password};var t=await j.HP.dispatch("login",e);void 0!=t&&(t.confirm?this.$swal.fire({title:"登入成功",icon:"success",showCancelButton:!1,showConfirmButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert",timer:1e3}).then((()=>{const e=this.$route.query.action&&"switch"==this.$route.query.action;!e&&this.$route.query.pre?location.href=this.$route.query.pre:location.href="/"})):this.message=t.message),this.logining=!1}),300))},LogoutHandle(){this.logouting=!0,setTimeout((()=>{j.HP.dispatch("logout"),this.UserName=this.Password="",this.$swal.fire({title:"登出成功!",icon:"success",timer:300}).then((()=>{location.reload()})),this.logouting=!1}),100)},OnInputFocus(e){this.focus_input=e,"account"==this.focus_input?this.keyboard_input=this.UserName+"":this.keyboard_input=this.Password+""},onChange(e){this.message="",console.log(e),this.keyboard_input=e,"account"==this.focus_input?this.UserName=e:(this.$refs.pw_input.focus(),this.Password=e,this.$refs.pw_input.focus())}},mounted(){this.IsLogin&&(this.UserName=j.HP.state.user.UserName,this.Password="*************************")}};const Ii=(0,X.Z)(Ai,[["render",Vi],["__scopeId","data-v-077e8500"]]);var xi=Ii;const Ei={class:"agv-battery-setting d-flex h-100"},Mi=["textContent"],Pi={class:"descript mx-2 py-5 border flex-fill bg-light text-start",style:{"font-weight":"bold"}};function Oi(e,t,a,i,o,l){const r=(0,s.up)("el-input-number"),d=(0,s.up)("el-table-column"),c=(0,s.up)("el-table"),u=(0,s.up)("el-card"),m=(0,s.up)("el-timeline-item"),h=(0,s.up)("el-timeline");return(0,s.wg)(),(0,s.iD)("div",Ei,[(0,s.Wm)(c,{class:"w-50 mx-1","header-cell-style":e.tableHeaderStyle,size:"large",border:"",data:e.datas},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.columnMap,(t=>((0,s.wg)(),(0,s.j4)(d,{key:t.prop,label:t.label,prop:t.prop},{default:(0,s.w5)((a=>["string"==t.type?((0,s.wg)(),(0,s.iD)("div",{key:0,textContent:(0,n.zw)(a.row[t.prop]),class:""},null,8,Mi)):(0,s.kq)("",!0),"number"==t.type?((0,s.wg)(),(0,s.j4)(r,{key:1,modelValue:a.row[t.prop],"onUpdate:modelValue":e=>a.row[t.prop]=e,onChange:t=>e.modify(a.row,a.row.agvName)},null,8,["modelValue","onUpdate:modelValue","onChange"])):(0,s.kq)("",!0)])),_:2},1032,["label","prop"])))),128))])),_:1},8,["header-cell-style","data"]),(0,s._)("div",Pi,[(0,s.Wm)(h,{class:"bat-timeline",style:{"max-width":"600px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{timestamp:"100%",placement:"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{class:"bg-success text-light"},{default:(0,s.w5)((()=>[(0,s._)("h5",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.HighBatteryLevel")),1),(0,s._)("div",null,"- "+(0,n.zw)(e.$t("AGVBatterySetting.CanExecuteAllTask")),1)])),_:1})])),_:1}),(0,s.Wm)(m,{timestamp:"高電量",placement:"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{class:"bg-success text-light"},{default:(0,s.w5)((()=>[(0,s._)("h5",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.MediumBatteryLevel")),1),(0,s._)("div",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.CanExecuteAllTask")),1)])),_:1})])),_:1}),(0,s.Wm)(m,{timestamp:"中電量",placement:"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{class:"text-light",style:{"background-color":"orange"}},{default:(0,s.w5)((()=>[(0,s._)("h5",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.MediumLowBatteryLevel")),1),(0,s._)("div",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.When AGV is not Charging,all task orders can be executed")),1),(0,s._)("div",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.AGVcharging onlyAGVdocharging tasks")),1)])),_:1})])),_:1}),(0,s.Wm)(m,{timestamp:"低電量-強制充電",placement:"top"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{class:"bg-danger text-light"},{default:(0,s.w5)((()=>[(0,s._)("h5",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.LowBatteryLevel")),1),(0,s._)("div",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.AGVlowbattery onlyAGVdocharging")),1),(0,s._)("div",null,"-"+(0,n.zw)(e.$t("AGVBatterySetting.In operation mode, the system will force the AGV to charge")),1)])),_:1})])),_:1}),(0,s.Wm)(m,{timestamp:"0%",placement:"top"})])),_:1})])])}var Ni=a(47327),Li=a(38418);class Gi{constructor(e,t,a){(0,Ni.Z)(this,"label",void 0),(0,Ni.Z)(this,"prop",void 0),(0,Ni.Z)(this,"type",void 0),this.label=e,this.prop=t,this.type=a}}var Ri=(0,s.aZ)({inject:["tableHeaderStyle"],data(){return{datas:[],columnMap:[new Gi("車輛名稱","agvName","string"),new Gi("低電量-強制充電(%)","lowLevel","number"),new Gi("中電量(%)","middleLevel","number"),new Gi("高電量(%)","highLevel","number")],throttleState:{isOperating:!1,tout:setTimeout((()=>{}),1),postModifiedValToBackend(e){clearTimeout(this.tout),this.tout=setTimeout((async()=>{console.log(e);try{var t=await Li.bh.ModifySetting(e.agvName,e);console.info(t),q.bM.success({message:`已完成 ${e.agvName} 電量管理參數修改`,position:"top-right",duration:2e3})}catch(a){q.bM.error({message:`${e.agvName} 電量管理參數修改失敗-${a}`,position:"top-right",duration:2e3})}}),500)},cancelLastOperate(){}}}},methods:{fetchSettings(){setTimeout((async()=>{try{var e=await Li.bh.GetSettings();Object.assign(this.datas,e)}catch(t){q.bM.error({message:`電量管理參數下載失敗-${t}`,position:"top-right",duration:-1})}}),100)},modify(e,t){this.throttleState.postModifiedValToBackend(e)}},mounted(){this.fetchSettings()}});const Wi=(0,X.Z)(Ri,[["render",Oi],["__scopeId","data-v-76c062f0"]]);var Ui=Wi;const Hi={class:"equipment-manager border-start border-end"},$i={class:"w-100 d-flex"},Fi={key:0,class:"text-start d-flex flex-fill"},qi={class:"d-flex",style:{width:"200px"}},Bi=(0,s._)("label",{style:{width:"112px","font-size":"20px",padding:"4px","margin-left":"14px"}},[(0,s._)("i",{class:"bi bi-three-dots-vertical"}),(0,s.Uk)("排序 ")],-1),zi={key:1,class:"text-start px-1 flex-fill"},ji={class:""},Zi={class:"w-100 d-flex flex-row"},Qi={class:"w-100"},Yi={class:"d-flex w-100"},Ki={class:"d-flex w-100 mx-1"},Xi={class:"w-50 border p-2"},Ji=(0,s._)("h5",{class:"w-100 border rounded bg-primary text-light"},"INPUT",-1),es={class:"w-50 border p-2 mx-1"},ts=(0,s._)("h5",{class:"w-100 border rounded bg-info text-light"},"OUTPUT",-1),as={class:"hs-signals d-flex"},is=(0,s._)("div",{class:"mx-3"},"交握訊號-EQ",-1),ss={class:"hs-signals d-flex"},ns=(0,s._)("div",{class:"mx-3"},"交握訊號-AGV",-1),os={style:{position:"absolute",height:"100vh",width:"100vw",overflow:"hidden"}},ls=["src"],rs=["src"];function ds(e,t,a,i,l,r){const d=(0,s.up)("b-button"),c=(0,s.up)("el-option"),u=(0,s.up)("el-select"),m=(0,s.up)("el-radio-button"),h=(0,s.up)("el-radio-group"),p=(0,s.up)("EqGroupEditor"),g=(0,s.up)("el-table-column"),_=(0,s.up)("b-form-input"),w=(0,s.up)("el-button"),f=(0,s.up)("el-input"),y=(0,s.up)("el-checkbox"),v=(0,s.up)("el-table"),S=(0,s.up)("el-divider"),b=(0,s.up)("el-form-item"),C=(0,s.up)("el-form"),k=(0,s.up)("el-drawer"),T=(0,s.up)("b-tab"),D=(0,s.up)("b-tabs"),V=(0,s.up)("el-dialog"),A=(0,s.up)("EqSelectForm"),I=(0,s.Q2)("loading");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",Hi,[(0,s._)("div",$i,["eq-list"==l.displayMode?((0,s.wg)(),(0,s.iD)("div",Fi,[(0,s.Wm)(d,{variant:"primary",squared:"",onClick:r.SaveSettingHandler},{default:(0,s.w5)((()=>[(0,s.Uk)("儲存設定")])),_:1},8,["onClick"]),(0,s.Wm)(d,{variant:"info",squared:"",class:"mx-1",onClick:r.AddNewEqHandler},{default:(0,s.w5)((()=>[(0,s.Uk)("新增設備")])),_:1},8,["onClick"]),(0,s.Wm)(d,{squared:"",onClick:r.ReloadSettingsHandler},{default:(0,s.w5)((()=>[(0,s.Uk)("重新載入")])),_:1},8,["onClick"]),(0,s._)("div",qi,[Bi,(0,s.Wm)(u,{modelValue:l.sortBy,"onUpdate:modelValue":t[0]||(t[0]=e=>l.sortBy=e),size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:"設備名稱",value:"eqName"}),(0,s.Wm)(c,{label:"Tag ID",value:"tag"}),(0,s.Wm)(c,{label:"允入車款",value:"vehicleType"}),(0,s.Wm)(c,{label:"貨物類型",value:"cargoType"})])),_:1},8,["modelValue"])])])):(0,s.kq)("",!0),"eq-group"==l.displayMode?((0,s.wg)(),(0,s.iD)("p",zi,[(0,s.Wm)(d,{variant:"primary",squared:"",onClick:r.SaveGroupsClicked},{default:(0,s.w5)((()=>[(0,s.Uk)("儲存設定")])),_:1},8,["onClick"]),(0,s.Wm)(d,{squared:"",onClick:r.ReloadSettingsHandler},{default:(0,s.w5)((()=>[(0,s.Uk)("重新載入")])),_:1},8,["onClick"])])):(0,s.kq)("",!0),(0,s.Wm)(h,{modelValue:l.displayMode,"onUpdate:modelValue":t[1]||(t[1]=e=>l.displayMode=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{size:"large",label:"設備列表",value:"eq-list"}),(0,s.Wm)(m,{size:"large",label:"設備群組",value:"eq-group"})])),_:1},8,["modelValue"])]),(0,s.wy)((0,s.Wm)(p,{ref:"group-editor"},null,512),[[o.F8,"eq-group"==l.displayMode]]),(0,s.wy)((0,s.Wm)(v,{"header-cell-style":{color:"white",backgroundColor:"rgb(13, 110, 253)",fontSize:"12px"},data:"eqName"==l.sortBy?l.EqDatas:r.SortedEQDataBySortBy,"row-key":l.rowKey,"row-class-name":r.GetRowClassName,size:"small",border:"","scrollbar-always-on":"",height:"77vh","table-layout":"fixed",ref:"eqTable",style:{width:"100vw"}},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{label:"Index",prop:"index",width:"80",align:"center",fixed:"left"}),(0,s.Wm)(g,{label:"設備名稱",prop:"Name",width:"210",fixed:"left"},{default:(0,s.w5)((e=>[(0,s._)("div",ji,[(0,s.Wm)(_,{state:l.ValidName(e.row),modelValue:e.row.Name,"onUpdate:modelValue":t=>e.row.Name=t,placeholder:"設備名稱",style:{width:"160px"},"no-wheel":!0,size:"sm",min:1,onInput:t=>r.HandleEqNameChange(e.row,e.row.Name)},null,8,["state","modelValue","onUpdate:modelValue","onInput"]),(0,s.Wm)(w,{class:"my-1",size:"small",onClick:t=>r.HandleUseMapDataDisplayName(e.row.TagID)},{default:(0,s.w5)((()=>[(0,s.Uk)("使用圖資設定")])),_:2},1032,["onClick"])])])),_:1}),(0,s.Wm)(g,{label:"SECS ID",prop:"DeviceID",width:"210",fixed:"left"},{default:(0,s.w5)((e=>[(0,s.Wm)(f,{modelValue:e.row.DeviceID,"onUpdate:modelValue":t=>e.row.DeviceID=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"Tag ID",prop:"TagID",width:"120",align:"center",fixed:"left"},{default:(0,s.w5)((e=>[(0,s.Wm)(_,{type:"number",state:l.ValidTag(e.row),modelValue:e.row.TagID,"onUpdate:modelValue":t=>e.row.TagID=t,modelModifiers:{number:!0},placeholder:"tag id",size:"sm",min:1},null,8,["state","modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"層",prop:"Height",width:"80",align:"center",fixed:"left"},{default:(0,s.w5)((e=>[(0,s.Wm)(u,{modelValue:e.row.Height,"onUpdate:modelValue":t=>e.row.Height=t},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:"1",value:0}),(0,s.Wm)(c,{label:"2",value:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"下游設備",width:"850"},{default:(0,s.w5)((e=>[(0,s._)("div",Zi,[(0,s.Wm)(u,{size:"small",modelValue:e.row.ValidDownStreamEndPointNames,"onUpdate:modelValue":t=>e.row.ValidDownStreamEndPointNames=t,multiple:"",placeholder:"Select",style:{width:"1000px"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.GetAvaluableEqNameList(e.row.Name),(e=>((0,s.wg)(),(0,s.j4)(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,s.Wm)(w,{class:"mx-1",size:"small",type:"default",onClick:()=>{e.row.ValidDownStreamEndPointNames=r.GetAvaluableEqNameList(e.row.Name)}},{default:(0,s.w5)((()=>[(0,s.Uk)("使用所有設備")])),_:2},1032,["onClick"]),(0,s.Wm)(w,{size:"small",type:"danger",onClick:()=>{e.row.ValidDownStreamEndPointNames=[]}},{default:(0,s.w5)((()=>[(0,s.Uk)("清除")])),_:2},1032,["onClick"])])])),_:1}),(0,s.Wm)(g,{label:"允入車款",width:"120"},{default:(0,s.w5)((e=>[(0,s.Wm)(u,{size:"small",modelValue:e.row.Accept_AGV_Type,"onUpdate:modelValue":t=>e.row.Accept_AGV_Type=t},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{value:0,label:"0-不限"}),(0,s.Wm)(c,{value:1,label:"1-叉車AGV"}),(0,s.Wm)(c,{value:2,label:"2-潛盾AGV"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"可移載貨物類型",width:"130"},{default:(0,s.w5)((e=>[(0,s.Wm)(u,{size:"small",modelValue:e.row.EQAcceeptCargoType,"onUpdate:modelValue":t=>e.row.EQAcceeptCargoType=t},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{value:0,label:"0-不限"}),(0,s.Wm)(c,{value:200,label:"200-Tray"}),(0,s.Wm)(c,{value:201,label:"201-子母框"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"具貨物升降機構",width:"100",align:"center"},{default:(0,s.w5)((e=>[(0,s.Wm)(y,{modelValue:e.row.HasCstSteeringMechanism,"onUpdate:modelValue":t=>e.row.HasCstSteeringMechanism=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"雙Port設備",width:"100",align:"center"},{default:(0,s.w5)((e=>[(0,s.Wm)(y,{modelValue:e.row.IsOneOfDualPorts,"onUpdate:modelValue":t=>e.row.IsOneOfDualPorts=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"AnotherPortTagNumber",width:"80",align:"center"},{default:(0,s.w5)((e=>[(0,s.Wm)(f,{type:"number",modelValue:e.row.AnotherPortTagNumber,"onUpdate:modelValue":t=>e.row.AnotherPortTagNumber=t,disabled:!e.row.IsOneOfDualPorts},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),(0,s.Wm)(g,{label:"可取貨狀態識別碼",width:"80",align:"center"},{default:(0,s.w5)((e=>[(0,s.Wm)(f,{type:"number",modelValue:e.row.AllowUnloadPortTypeNumber,"onUpdate:modelValue":t=>e.row.AllowUnloadPortTypeNumber=t,disabled:!e.row.IsOneOfDualPorts},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),(0,s.Wm)(g,{label:"空框/實框 訊號檢查",width:"100",align:"center"},{default:(0,s.w5)((e=>[(0,s.Wm)(y,{modelValue:e.row.RackCapcityCheck,"onUpdate:modelValue":t=>e.row.RackCapcityCheck=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,s.Wm)(g,{label:"操作","min-width":"100",fixed:"right"},{default:(0,s.w5)((e=>[(0,s._)("div",null,[(0,s.Wm)(w,{size:"small",type:"default",onClick:t=>r.ConnectionSettingBtnHandle(e.row)},{default:(0,s.w5)((()=>[(0,s.Uk)("連線設定")])),_:2},1032,["onClick"]),(0,s.Wm)(w,{size:"small",type:"danger",onClick:t=>r.RemoveHandle(e.row)},{default:(0,s.w5)((()=>[(0,s.Uk)("移除")])),_:2},1032,["onClick"]),(0,s.Wm)(w,{size:"small",type:"text",onClick:t=>r.CopySettingHandle(e.row)},{default:(0,s.w5)((()=>[(0,s.Uk)("複製")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["header-cell-style","data","row-key","row-class-name"]),[[o.F8,"eq-list"==l.displayMode]]),(0,s.Wm)(k,{size:"50%","z-index":1,modelValue:l.connection_setting_drawer,"onUpdate:modelValue":t[47]||(t[47]=e=>l.connection_setting_drawer=e),title:`${l.selected_eq_option.Name}-連線設定`},{default:(0,s.w5)((()=>[(0,s._)("div",Qi,[(0,s.Wm)(C,{"label-position":"left","label-width":"120"},{default:(0,s.w5)((()=>[(0,s.Wm)(S,null,{default:(0,s.w5)((()=>[(0,s.Uk)("通訊 Protocol")])),_:1}),(0,s.Wm)(b,{label:"通訊方式"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{modelValue:l.selected_eq_option.ConnOptions.ConnMethod,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selected_eq_option.ConnOptions.ConnMethod=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{label:"Modbus TCP",value:0}),(0,s.Wm)(c,{label:"Modbus RTU",value:1}),(0,s.Wm)(c,{label:"TCP/IP",value:2}),(0,s.Wm)(c,{label:"Serial Port",value:3}),(0,s.Wm)(c,{label:"MC Protocol",value:5})])),_:1},8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"IP"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{disabled:1==l.selected_eq_option.ConnOptions.ConnMethod,modelValue:l.selected_eq_option.ConnOptions.IP,"onUpdate:modelValue":t[3]||(t[3]=e=>l.selected_eq_option.ConnOptions.IP=e)},null,8,["disabled","modelValue"])])),_:1}),(0,s.Wm)(b,{label:"PORT"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{disabled:1==l.selected_eq_option.ConnOptions.ConnMethod,modelValue:l.selected_eq_option.ConnOptions.Port,"onUpdate:modelValue":t[4]||(t[4]=e=>l.selected_eq_option.ConnOptions.Port=e),modelModifiers:{number:!0}},null,8,["disabled","modelValue"])])),_:1}),(0,s.Wm)(b,{label:"COMPORT"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{disabled:0==l.selected_eq_option.ConnOptions.ConnMethod,modelValue:l.selected_eq_option.ConnOptions.ComPort,"onUpdate:modelValue":t[5]||(t[5]=e=>l.selected_eq_option.ConnOptions.ComPort=e)},null,8,["disabled","modelValue"])])),_:1}),(0,s.Wm)(S,null,{default:(0,s.w5)((()=>[(0,s.Uk)("IO位置")])),_:1}),(0,s.Wm)(b,{label:"STATUS_IO_SPEC"},{default:(0,s.w5)((()=>[(0,s._)("div",Yi,[(0,s._)("i",{class:"bi bi-question-circle cursor-pointer",onClick:t[6]||(t[6]=(...e)=>r.HandleInfoIconOfStatusSpecClecked&&r.HandleInfoIconOfStatusSpecClecked(...e))}),(0,s.Wm)(u,{class:"mx-2",modelValue:l.selected_eq_option.IOLocation.STATUS_IO_SPEC_VERSION,"onUpdate:modelValue":t[7]||(t[7]=e=>l.selected_eq_option.IOLocation.STATUS_IO_SPEC_VERSION=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{value:1,label:"V1"}),(0,s.Wm)(c,{value:2,label:"V2"})])),_:1},8,["modelValue"]),(0,s.Wm)(w,{onClick:t[8]||(t[8]=()=>{l.applyTo="status_io_spec",l.showEqSelectForm=!0})},{default:(0,s.w5)((()=>[(0,s.Uk)("套用至..")])),_:1})])])),_:1}),(0,s.Wm)(b,{label:"IO數量"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.ConnOptions.Input_RegisterNum,"onUpdate:modelValue":t[9]||(t[9]=e=>l.selected_eq_option.ConnOptions.Input_RegisterNum=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"PLC Base"},{default:(0,s.w5)((()=>[(0,s.Wm)(y,{modelValue:l.selected_eq_option.ConnOptions.IsPLCAddress_Base_1,"onUpdate:modelValue":t[10]||(t[10]=e=>l.selected_eq_option.ConnOptions.IsPLCAddress_Base_1=e)},null,8,["modelValue"])])),_:1}),(0,s._)("div",Ki,[(0,s._)("div",Xi,[Ji,1==l.selected_eq_option.IOLocation.STATUS_IO_SPEC_VERSION?((0,s.wg)(),(0,s.j4)(C,{key:0,"label-position":"left","label-width":"120"},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{label:"Start Index"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.ConnOptions.Input_StartRegister,"onUpdate:modelValue":t[11]||(t[11]=e=>l.selected_eq_option.ConnOptions.Input_StartRegister=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(S),(0,s.Wm)(b,{label:"Load_Request"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Load_Request,"onUpdate:modelValue":t[12]||(t[12]=e=>l.selected_eq_option.IOLocation.Load_Request=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Unload_Request"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Unload_Request,"onUpdate:modelValue":t[13]||(t[13]=e=>l.selected_eq_option.IOLocation.Unload_Request=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Port_Exist"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Port_Exist,"onUpdate:modelValue":t[14]||(t[14]=e=>l.selected_eq_option.IOLocation.Port_Exist=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Eqp_Status_Down"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Eqp_Status_Down,"onUpdate:modelValue":t[15]||(t[15]=e=>l.selected_eq_option.IOLocation.Eqp_Status_Down=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Eqp_Status_Run"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Eqp_Status_Run,"onUpdate:modelValue":t[16]||(t[16]=e=>l.selected_eq_option.IOLocation.Eqp_Status_Run=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Eqp_Status_Idle"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Eqp_Status_Idle,"onUpdate:modelValue":t[17]||(t[17]=e=>l.selected_eq_option.IOLocation.Eqp_Status_Idle=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"L_REQ"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_EQ_L_REQ,"onUpdate:modelValue":t[18]||(t[18]=e=>l.selected_eq_option.IOLocation.HS_EQ_L_REQ=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"U_REQ"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_EQ_U_REQ,"onUpdate:modelValue":t[19]||(t[19]=e=>l.selected_eq_option.IOLocation.HS_EQ_U_REQ=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"READY"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_EQ_READY,"onUpdate:modelValue":t[20]||(t[20]=e=>l.selected_eq_option.IOLocation.HS_EQ_READY=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"LOW_READY"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_EQ_LOW_READY,"onUpdate:modelValue":t[21]||(t[21]=e=>l.selected_eq_option.IOLocation.HS_EQ_LOW_READY=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Empty CST OUT"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Empty_CST,"onUpdate:modelValue":t[22]||(t[22]=e=>l.selected_eq_option.IOLocation.Empty_CST=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Full CST OUT"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Full_CST,"onUpdate:modelValue":t[23]||(t[23]=e=>l.selected_eq_option.IOLocation.Full_CST=e)},null,8,["modelValue"])])),_:1})])),_:1})):(0,s.kq)("",!0),2==l.selected_eq_option.IOLocation.STATUS_IO_SPEC_VERSION?((0,s.wg)(),(0,s.j4)(C,{key:1,"label-position":"left","label-width":"120"},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{label:"Start Index"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.ConnOptions.Input_StartRegister,"onUpdate:modelValue":t[24]||(t[24]=e=>l.selected_eq_option.ConnOptions.Input_StartRegister=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(S),(0,s.Wm)(b,{label:"Load_Request"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Load_Request,"onUpdate:modelValue":t[25]||(t[25]=e=>l.selected_eq_option.IOLocation.Load_Request=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Unload_Request"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Unload_Request,"onUpdate:modelValue":t[26]||(t[26]=e=>l.selected_eq_option.IOLocation.Unload_Request=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Port_Exist"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Port_Exist,"onUpdate:modelValue":t[27]||(t[27]=e=>l.selected_eq_option.IOLocation.Port_Exist=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Up_Pose"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Up_Pose,"onUpdate:modelValue":t[28]||(t[28]=e=>l.selected_eq_option.IOLocation.Up_Pose=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Down_Pose"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Down_Pose,"onUpdate:modelValue":t[29]||(t[29]=e=>l.selected_eq_option.IOLocation.Down_Pose=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Eqp_Status_Down"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Eqp_Status_Down,"onUpdate:modelValue":t[30]||(t[30]=e=>l.selected_eq_option.IOLocation.Eqp_Status_Down=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Eqp_Maintaining"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Eqp_Maintaining,"onUpdate:modelValue":t[31]||(t[31]=e=>l.selected_eq_option.IOLocation.Eqp_Maintaining=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"Eqp_PartsReplacing"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.Eqp_PartsReplacing,"onUpdate:modelValue":t[32]||(t[32]=e=>l.selected_eq_option.IOLocation.Eqp_PartsReplacing=e)},null,8,["modelValue"])])),_:1})])),_:1})):(0,s.kq)("",!0)]),(0,s._)("div",es,[ts,1==l.selected_eq_option.IOLocation.STATUS_IO_SPEC_VERSION?((0,s.wg)(),(0,s.j4)(C,{key:0,"label-position":"left","label-width":"120"},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{label:"Start Index"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.ConnOptions.Output_Start_Address,"onUpdate:modelValue":t[33]||(t[33]=e=>l.selected_eq_option.ConnOptions.Output_Start_Address=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(S),(0,s.Wm)(b,{label:"To_EQ_Up"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.To_EQ_Up,"onUpdate:modelValue":t[34]||(t[34]=e=>l.selected_eq_option.IOLocation.To_EQ_Up=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"To_EQ_Low"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.To_EQ_Low,"onUpdate:modelValue":t[35]||(t[35]=e=>l.selected_eq_option.IOLocation.To_EQ_Low=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"VALID"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_AGV_VALID,"onUpdate:modelValue":t[36]||(t[36]=e=>l.selected_eq_option.IOLocation.HS_AGV_VALID=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"TR-REQ"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_AGV_TR_REQ,"onUpdate:modelValue":t[37]||(t[37]=e=>l.selected_eq_option.IOLocation.HS_AGV_TR_REQ=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"BUSY"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_AGV_BUSY,"onUpdate:modelValue":t[38]||(t[38]=e=>l.selected_eq_option.IOLocation.HS_AGV_BUSY=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"COMPT"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.HS_AGV_COMPT,"onUpdate:modelValue":t[39]||(t[39]=e=>l.selected_eq_option.IOLocation.HS_AGV_COMPT=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"To EQ Empty CST"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.To_EQ_Empty_CST,"onUpdate:modelValue":t[40]||(t[40]=e=>l.selected_eq_option.IOLocation.To_EQ_Empty_CST=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"To EQ Full CST"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.To_EQ_Full_CST,"onUpdate:modelValue":t[41]||(t[41]=e=>l.selected_eq_option.IOLocation.To_EQ_Full_CST=e)},null,8,["modelValue"])])),_:1})])),_:1})):(0,s.kq)("",!0),2==l.selected_eq_option.IOLocation.STATUS_IO_SPEC_VERSION?((0,s.wg)(),(0,s.j4)(C,{key:1,"label-position":"left","label-width":"120"},{default:(0,s.w5)((()=>[(0,s.Wm)(b,{label:"Start Index"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.ConnOptions.Output_Start_Address,"onUpdate:modelValue":t[42]||(t[42]=e=>l.selected_eq_option.ConnOptions.Output_Start_Address=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(S),(0,s.Wm)(b,{label:"To_EQ_Up"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.To_EQ_Up,"onUpdate:modelValue":t[43]||(t[43]=e=>l.selected_eq_option.IOLocation.To_EQ_Up=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"To_EQ_Low"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.To_EQ_Low,"onUpdate:modelValue":t[44]||(t[44]=e=>l.selected_eq_option.IOLocation.To_EQ_Low=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"CMD_Reserve_Up"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.CMD_Reserve_Up,"onUpdate:modelValue":t[45]||(t[45]=e=>l.selected_eq_option.IOLocation.CMD_Reserve_Up=e)},null,8,["modelValue"])])),_:1}),(0,s.Wm)(b,{label:"CMD_Reserve_Low"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{type:"number",modelValue:l.selected_eq_option.IOLocation.CMD_Reserve_Low,"onUpdate:modelValue":t[46]||(t[46]=e=>l.selected_eq_option.IOLocation.CMD_Reserve_Low=e)},null,8,["modelValue"])])),_:1})])),_:1})):(0,s.kq)("",!0)])])])),_:1})])])),_:1},8,["modelValue","title"]),(0,s.Wm)(k,{modelValue:l.io_check_drawer,"onUpdate:modelValue":t[61]||(t[61]=e=>l.io_check_drawer=e),direction:"btt"},{default:(0,s.w5)((()=>[(0,s._)("div",as,[is,(0,s._)("div",{class:"di-status",onClick:t[48]||(t[48]=t=>e.HandleHSsignaleChange(r.selected_eq_io_data.EQName,"L_REQ",!e.scope.row.HS_EQ_L_REQ)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_EQ_L_REQ))},"L_REQ",4),(0,s._)("div",{class:"di-status",onClick:t[49]||(t[49]=t=>e.HandleHSsignaleChange(r.selected_eq_io_data.EQName,"U_REQ",!e.scope.row.HS_EQ_U_REQ)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_EQ_U_REQ))},"U_REQ",4),(0,s._)("div",{class:"di-status",onClick:t[50]||(t[50]=t=>e.HandleHSsignaleChange(r.selected_eq_io_data.EQName,"READY",!e.scope.row.HS_EQ_READY)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_EQ_READY))},"READY",4),(0,s._)("div",{class:"di-status",onClick:t[51]||(t[51]=t=>e.HandleHSsignaleChange(r.selected_eq_io_data.EQName,"UP_READY",!e.scope.row.HS_EQ_UP_READY)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_EQ_UP_READY))},"UP_READY",4),(0,s._)("div",{class:"di-status",onClick:t[52]||(t[52]=t=>e.HandleHSsignaleChange(r.selected_eq_io_data.EQName,"LOW_READY",!e.scope.row.HS_EQ_LOW_READY)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_EQ_LOW_READY))},"LOW_READY",4),(0,s.kq)("",!0)]),(0,s._)("div",ss,[ns,(0,s._)("div",{class:"di-status",onClick:t[54]||(t[54]=t=>e.HandleAGVHSSignaleChange(r.selected_eq_io_data.EQName,"To_EQ_Up",!e.scope.row.To_EQ_Up)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.To_EQ_Up))},"To_EQ_Up",4),(0,s._)("div",{class:"di-status",onClick:t[55]||(t[55]=t=>e.HandleAGVHSSignaleChange(r.selected_eq_io_data.EQName,"To_EQ_Low",!e.scope.row.To_EQ_Low)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.To_EQ_Low))},"To_EQ_Low",4),(0,s._)("div",{class:"di-status",onClick:t[56]||(t[56]=t=>e.HandleAGVHSSignaleChange(r.selected_eq_io_data.EQName,"VALID",!e.scope.row.HS_AGV_VALID)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_AGV_VALID))},"VALID",4),(0,s._)("div",{class:"di-status",onClick:t[57]||(t[57]=t=>e.HandleAGVHSSignaleChange(r.selected_eq_io_data.EQName,"TR_REQ",!e.scope.row.HS_AGV_TR_REQ)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_AGV_TR_REQ))},"TR_REQ",4),(0,s._)("div",{class:"di-status",onClick:t[58]||(t[58]=t=>e.HandleAGVHSSignaleChange(r.selected_eq_io_data.EQName,"BUSY",!e.scope.row.HS_AGV_BUSY)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_AGV_BUSY))},"BUSY",4),(0,s.kq)("",!0),(0,s._)("div",{class:"di-status",onClick:t[60]||(t[60]=t=>e.HandleAGVHSSignaleChange(r.selected_eq_io_data.EQName,"COMPT",!e.scope.row.HS_AGV_COMPT)),style:(0,n.j5)(e.signalOn(r.selected_eq_io_data.HS_AGV_COMPT))},"COMPT",4)])])),_:1},8,["modelValue"]),(0,s.Wm)(V,{fullscreen:"",overflow:!1,modelValue:l.showStatusIOSpec,"onUpdate:modelValue":t[62]||(t[62]=e=>l.showStatusIOSpec=e),draggable:"",title:"狀態IO SPEC說明"},{default:(0,s.w5)((()=>[(0,s._)("div",os,[(0,s.Wm)(D,{style:{height:"100vh",width:"100vw"}},{default:(0,s.w5)((()=>[(0,s.Wm)(T,{title:"舊版",style:{height:"100vh",width:"100vw"}},{default:(0,s.w5)((()=>[(0,s._)("iframe",{src:r.ioSpecUrl_OldVersion,width:"100%",height:"100%",style:{border:"none"},allow:"autoplay"},null,8,ls)])),_:1}),(0,s.Wm)(T,{title:"新版",style:{height:"100vh",width:"100vw"}},{default:(0,s.w5)((()=>[(0,s._)("iframe",{src:r.ioSpecUrl_NewVersion,width:"100%",height:"100%",style:{border:"none"},allow:"autoplay"},null,8,rs)])),_:1})])),_:1})])])),_:1},8,["modelValue"]),(0,s.Wm)(A,{modelValue:l.showEqSelectForm,"onUpdate:modelValue":t[63]||(t[63]=e=>l.showEqSelectForm=e),onConfirm:r.HandleEqSelectFormConfirm},null,8,["modelValue","onConfirm"])])),[[I,l.loading]])}const cs={class:"eq-group-editor"},us={class:"groups-container"};function ms(e,t,a,i,n,o){const l=(0,s.up)("GroupComponent");return(0,s.wg)(),(0,s.iD)("div",cs,[(0,s.Uk)(" EQ Group "),(0,s._)("div",us,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.GroupsConfigures,(e=>((0,s.wg)(),(0,s.j4)(l,{class:"group",key:e.EqGroupName,Configuration:e},null,8,["Configuration"])))),128)),(0,s.Wm)(l,{class:"group",onOnAddClick:o.HandleAddRequest,isUseForAdd:!0},null,8,["onOnAddClick"])])])}const hs=e=>((0,s.dD)("data-v-97b1088e"),e=e(),(0,s.Cn)(),e),ps=hs((()=>(0,s._)("i",{class:"bi bi-plus-circle"},null,-1))),gs={key:1,class:"content-info"},_s={class:"eq-name py-2 border-bottom d-flex px-2"},ws={class:"flex-fill text-start"},fs={class:"ports bg-info d-flex flex-row"},ys=hs((()=>(0,s._)("label",null,[(0,s._)("i",{class:"bi bi-box-arrow-in-right"}),(0,s.Uk)(" 入料 PORT ")],-1))),vs={class:"ports bg-warning d-flex flex-row"},Ss=hs((()=>(0,s._)("label",null,[(0,s._)("i",{class:"bi bi-box-arrow-right"}),(0,s.Uk)("出料 PORT ")],-1)));function bs(e,t,a,i,o,l){const r=(0,s.up)("el-tooltip"),d=(0,s.up)("el-option"),c=(0,s.up)("el-select");return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["eq-group-component",a.isUseForAdd?"addable-layout":""])},[a.isUseForAdd?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"add-mode",onClick:t[0]||(t[0]=(...e)=>l.HandleAddRegionClicked&&l.HandleAddRegionClicked(...e))},[(0,s.Wm)(r,{content:"新增一個設備群組",placement:"top"},{default:(0,s.w5)((()=>[ps])),_:1})])):((0,s.wg)(),(0,s.iD)("div",gs,[(0,s._)("div",_s,[(0,s._)("span",ws,(0,n.zw)(o.GroupConfigure.EqGroupName),1),(0,s._)("i",{class:"bi bi-pencil-square",onClick:t[1]||(t[1]=(...e)=>l.EditEqNameClick&&l.EditEqNameClick(...e))})]),(0,s._)("div",fs,[ys,(0,s.Wm)(c,{multiple:"",modelValue:o.GroupConfigure.LoadPortEqTags,"onUpdate:modelValue":t[2]||(t[2]=e=>o.GroupConfigure.LoadPortEqTags=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.EQPortOptions,(e=>((0,s.wg)(),(0,s.j4)(d,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,s._)("div",vs,[Ss,(0,s.Wm)(c,{multiple:"",modelValue:o.GroupConfigure.UnloadPortEqTags,"onUpdate:modelValue":t[3]||(t[3]=e=>o.GroupConfigure.UnloadPortEqTags=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.EQPortOptions,(e=>((0,s.wg)(),(0,s.j4)(d,{key:e.value,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]))],2)}var Cs=a(78538),ks={props:{isUseForAdd:{type:Boolean,default:!1},Configuration:{type:Object,default(){var e=new Cs.r0;return e.EqGroupName="EQQQQQ",e}}},data(){return{GroupConfigure:new Cs.r0("TEST",[46,48],[2,4])}},methods:{HandleAddRegionClicked(){this.$emit("onAddClick","")},EditEqNameClick(){}},computed:{EQPortOptions(){return j.jU.state.EqOptions.map((e=>({name:e.Name+`(Tag:${e.TagID})`,value:e.TagID})))}},mounted(){this.GroupConfigure=this.Configuration}};const Ts=(0,X.Z)(ks,[["render",bs],["__scopeId","data-v-97b1088e"]]);var Ds=Ts,Vs={components:{GroupComponent:Ds},data(){return{GroupsConfigures:[new Cs.r0("ahah",[1,2],[3,4])]}},methods:{HandleAddRequest(){var e=`EQ Group-${this.GroupsConfigures.length+1}`;this.GroupsConfigures.push(new Cs.r0(e))}},mounted(){(0,Z.IS)().then((e=>this.GroupsConfigures=e))}};const As=(0,X.Z)(Vs,[["render",ms],["__scopeId","data-v-23f52387"]]);var Is=As;const xs={class:"d-flex py-3"},Es=(0,s._)("h3",{class:"flex-fill text-start"},[(0,s._)("b",null,"選擇設備")],-1);function Ms(e,t,a,i,n,o){const l=(0,s.up)("el-button"),r=(0,s.up)("el-table-column"),d=(0,s.up)("el-table"),c=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.j4)(c,{draggable:"",modelValue:n.visible,"onUpdate:modelValue":t[0]||(t[0]=e=>n.visible=e),modal:!1,onClose:t[1]||(t[1]=e=>o.updateVisible(!1))},{default:(0,s.w5)((()=>[(0,s._)("div",xs,[Es,(0,s.Wm)(l,{size:"large",type:"primary",onClick:o.confirm},{default:(0,s.w5)((()=>[(0,s.Uk)("確認選取")])),_:1},8,["onClick"])]),(0,s.Wm)(d,{ref:"table",data:o.eq_store,border:"",height:800},{default:(0,s.w5)((()=>[(0,s.Wm)(r,{type:"selection",width:"55"}),(0,s.Wm)(r,{prop:"Name",label:"Name"}),(0,s.Wm)(r,{prop:"TagID",label:"Tag"})])),_:1},8,["data"])])),_:1},8,["modelValue"])}var Ps={props:{value:{type:Boolean,default:!1}},data(){return{visible:this.value}},computed:{eq_store(){return j.jU.state.EqOptions}},watch:{value(e){this.visible=e},visible(e){this.$emit("input",e)}},methods:{updateVisible(e){this.visible=e,e||this.cancelSelectAll()},selectAll(){this.$refs.table.clearSelection(),this.eq_store.forEach((e=>{this.$refs.table.toggleRowSelection(e,!0)}))},cancelSelectAll(){this.$refs.table.clearSelection()},confirm(){this.$emit("confirm",this.$refs.table.getSelectionRows())}}};const Os=(0,X.Z)(Ps,[["render",Ms]]);var Ns=Os,Ls={components:{RegionsSelector:Wt.Z,EqGroupEditor:Is,EqSelectForm:Ns},data(){return{displayMode:"eq-list",cell_item_size:"",io_check_drawer:!1,connection_setting_drawer:!1,EqDatas:[],EqDatas_Orignal:[],ValidTag:e=>!0,ValidName:e=>{var t=e.Name,a=this.EqDatas.filter((t=>t.Name==e.Name));return 1==a.length&&""!=t},selected_eq_option:new Cs.W1,connection_testing:!1,loading:!0,rowKey:"index",sortBy:"eqName",showStatusIOSpec:!1,showEqSelectForm:!1,applyTo:void 0,applyToSuccessMsg:{status_io_spec:"IO SPEC 版本",conn_setting:"成功修改"}}},watch:{displayMode(e){}},methods:{GetAvaluableEqNameList(e){var t=this.EqNames.filter((t=>t!=e));return["ALL",...t]},async SaveGroupsClicked(){var e=this.$refs["group-editor"].GroupsConfigures;(0,Z.FJ)(e),this.ClearAllHighlightByDuplicate()},async SaveSettingHandler(){var e=this.ValidateSetting();if(e.confirm){var t=await(0,Z.wW)(this.EqDatas);t.confirm?(this.ReloadSettingsHandler(!1),this.$swal.fire({title:"儲存成功",icon:"success",timer:2e3})):this.$swal.fire({title:"參數設定有誤",text:t.message,icon:"error"})}else this.$swal.fire({text:"",title:e.message,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},ValidateSetting(){const e=this.EqDatas.length;var t=[...new Set(this.EqDatas.map((e=>e.TagID+"-"+e.Height)))];const a=t.length==e;return{confirm:a,message:"同一個TAG不可有相同的層設置"}},async DownloadEQOptions(){this.EqDatas=[];var e=j.jU.state.EqOptions;for(let a=0;a<e.length;a++){var t=new Cs.W1;Object.assign(t,e[a]),t.index=a,this.EqDatas.push(t)}this.CloneEQDatas()},CloneEQDatas(){this.EqDatas_Orignal=JSON.parse(JSON.stringify(this.EqDatas))},ReloadSettingsHandler(e=!0){this.loading=e,this.ClearAllHighlightByDuplicate(),setTimeout((()=>{(0,Z.H5)().then((e=>{j.jU.commit("EqOptions",e),this.DownloadEQOptions(),this.$refs.eqTable.setScrollTop(0),this.loading=!1}))}),300)},AddNewEqHandler(e=void 0){this.sortBy="eqName";let t=new Cs.W1;void 0==e?(t.TagID=1,t.index=this.EqDatas.length):t=e,e.highlight_duplicate=!0,this.EqDatas=[t,...this.EqDatas],setTimeout((()=>{this.$refs.eqTable.setScrollTop(0)}),300)},RemoveHandle(e){var t=this.EqDatas.filter((t=>t.Name!=e.Name));this.EqDatas=t},ClearAllHighlightByDuplicate(){this.EqDatas.forEach((e=>{e.highlight_duplicate=void 0,e.highlight=void 0}))},CopySettingHandle(e){var t=new Cs.W1;Object.assign(t,e),t.Name=t.Name+"_Copy",this.AddNewEqHandler(t)},async IOCheckBtnHandle(e){this.selected_eq_option=e,this.io_check_drawer=!0},async ConnectionSettingBtnHandle(e){this.selected_eq_option=e,this.connection_setting_drawer=!0},async ConnectTestHandle(e){this.connection_testing=!0;var t=await(0,Z.qN)(e.ConnOptions);this.connection_testing=!1;var a="";a=0==e.ConnOptions.ConnMethod?`Modbus TCP - ${e.ConnOptions.IP}:${e.ConnOptions.Port}`:`Modbus RTU - ${e.ConnOptions.ComPort}`,t.Connected?this.$swal.fire({title:"OK",text:a,icon:"success"}):this.$swal.fire({title:"Fail",text:a,icon:"error"})},beforeRouteLeave(e,t,a){alert("leave!")},async HandleUseMapDataDisplayName(e){var t=await Q.p.dispatch("GetMapPointByTag",e);if(t){var a=this.EqDatas.find((t=>t.TagID==e)),i=t.Graph.Display;a.Name=i,this.HandleEqNameChange(a,i),(0,q.bM)({message:`Get Display Name From Map Success(Tag ${e} = ${i})`,duration:1e3,type:"success",title:"設備同步名稱"})}else(0,q.bM)({message:"Get Display Name From Map Fail",duration:1e3,type:"error",title:"設備同步名稱失敗"})},HandleEqNameChange(e,t){var a=e.TagID,i=this.EqDatas_Orignal.find((e=>e.TagID==a));if(i){var s=i.Name,n=this.EqDatas.filter((e=>e.ValidDownStreamEndPointNames.includes(s)));n.forEach((e=>{var a=e.ValidDownStreamEndPointNames.indexOf(s);e.ValidDownStreamEndPointNames[a]=t})),this.CloneEQDatas()}},DetermineHighligtRowWithCurrentRouteQueryItem(){var e=this.$route.query["eqTag"];if(e){let t=this.EqDatas.find((t=>t.TagID==e));t&&(t.highlight=!0,this.ScrollToRowWithSpficTagAssigned(e))}else this.EqDatas.forEach((e=>e.highlight=void 0))},ScrollToRowWithSpficTagAssigned(e){setTimeout((()=>{const t=this.EqDatas.findIndex((t=>t.TagID==e));this.$refs.eqTable.setScrollTop(70*t)}),200)},GetRowClassName({row:e,rowIndex:t}){return void 0!=e.highlight?"row-highlight":void 0!=e.highlight_duplicate?"row-highlight-duplicate":""},HandleInfoIconOfStatusSpecClecked(){this.showStatusIOSpec=!0},HandleEqSelectFormConfirm(e){this.showEqSelectForm=!1;let t=[new Cs.W1];Object.assign(t,e);const a=t.map((e=>e.Name));let i=this.EqDatas.filter((e=>a.includes(e.Name)));i.forEach((e=>{"status_io_spec"==this.applyTo&&(e.IOLocation.STATUS_IO_SPEC_VERSION=this.selected_eq_option.IOLocation.STATUS_IO_SPEC_VERSION)}));const s=i.length-1;s>0&&this.$notify({title:"成功",message:`暫存修改了[${s}]個設備的${this.applyToSuccessMsg[this.applyTo]}`,type:"success"})}},mounted(){setTimeout((()=>{this.DownloadEQOptions(),this.loading=!1}),400);const e=(0,i.yj)();(0,s.YP)((()=>e.path),((e,t)=>{this.DetermineHighligtRowWithCurrentRouteQueryItem()}))},computed:{EqNames(){return this.EqDatas.map((e=>e.Name))},eq_data(){return j.jU.getters.EQData},selected_eq_io_data(){return this.eq_data.find((e=>e.EQName==this.selected_eq_option.EQName))},SortedEQDataBySortBy(){var e=[];return Object.assign(e,this.EqDatas),"tag"==this.sortBy?e.sort(((e,t)=>e.TagID-t.TagID)):"vehicleType"==this.sortBy?e.sort(((e,t)=>t.Accept_AGV_Type-e.Accept_AGV_Type)):"cargoType"==this.sortBy?e.sort(((e,t)=>t.EQAcceeptCargoType-e.EQAcceeptCargoType)):this.EqDatas},ioSpecUrl_NewVersion(){return fi.Z.backend_host+"/Resources/Reference Documents/[GPM SPEC] [新版] IO交握流程規範_V1.2.pdf"},ioSpecUrl_OldVersion(){return fi.Z.backend_host+"/Resources/Reference Documents/[GPM SPEC] [舊版] IO交握流程規範_V1.06.pdf"}}};const Gs=(0,X.Z)(Ls,[["render",ds]]);var Rs=Gs;const Ws=e=>((0,s.dD)("data-v-2050062a"),e=e(),(0,s.Cn)(),e),Us={class:"w-100 p-3"},Hs=Ws((()=>(0,s._)("h1",null,"SECS/GEM",-1))),$s={class:"w-100 d-flex"},Fs={class:"main-content w-100 h-100 bg-light border rounded-3 mx-2"},qs={class:"card platform-running-state d-flex"},Bs=Ws((()=>(0,s._)("h4",null,"平台運行狀態",-1))),zs={style:{"font-size":"1.2em","font-weight":"bold"}},js={class:"d-flex gap-2"},Zs={class:"card gem-connection-status"},Qs=Ws((()=>(0,s._)("h4",null,"HSMS 連線狀態",-1))),Ys={class:"d-flex flex-column"},Ks={class:"text-start"},Xs=Ws((()=>(0,s._)("label",null,"MCS",-1))),Js={class:"text-start"},en=Ws((()=>(0,s._)("label",null,"CIM",-1))),tn={class:"card gem-connection-status"},an=Ws((()=>(0,s._)("h4",null,"上位模擬",-1))),sn={class:"d-flex flex-column align-items-center"},nn={key:0,class:"w-100 border bg-dark"};function on(e,t,a,i,o,l){const r=(0,s.up)("el-tag"),d=(0,s.up)("el-button"),c=(0,s.up)("secsMessageDisplay");return(0,s.wg)(),(0,s.iD)("div",Us,[Hs,(0,s._)("div",$s,[(0,s._)("div",Fs,[(0,s._)("div",qs,[Bs,(0,s.Wm)(r,{size:"large",effect:"dark",type:l.isSecsPlatformRunning?"success":"danger",style:{height:"40px"}},{default:(0,s.w5)((()=>[(0,s._)("span",zs,(0,n.zw)(l.isSecsPlatformRunning?"系統運行正常":"系統運行異常"),1)])),_:1},8,["type"])]),(0,s._)("div",js,[(0,s._)("div",Zs,[Qs,(0,s._)("div",Ys,[(0,s._)("div",Ks,[Xs,(0,s.Wm)(r,{effect:"dark",type:o.connectionStatusMap[l.connectionState.mcs].type,style:{width:"120px",height:"30px","text-align":"center"}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(o.connectionStatusMap[l.connectionState.mcs].text),1)])),_:1},8,["type"])]),(0,s._)("div",Js,[en,(0,s.Wm)(r,{effect:"dark",type:o.connectionStatusMap[l.connectionState.cim].type,style:{width:"120px",height:"30px","text-align":"center"}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(o.connectionStatusMap[l.connectionState.cim].text),1)])),_:1},8,["type"])])])]),(0,s._)("div",tn,[an,(0,s._)("div",sn,[(0,s.Wm)(d,{type:o.isSimulation?"primary":"danger",size:"large",style:{width:"120px",height:"50px","font-size":"1.2em","font-weight":"bold"},onClick:t[0]||(t[0]=()=>{e.$swal.fire({title:o.isSimulation?"確定要關閉模擬模式?":"確定要開啟模擬模式?",text:o.isSimulation?"關閉後將停止模擬運作":"開啟後將進入上位模擬模式",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then((e=>{e.isConfirmed&&(o.isSimulation=!o.isSimulation)}))}),title:o.isSimulation?"關閉模擬":"按一下已開啟模擬模式"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,n.zw)(o.isSimulation?"模擬運行中":"已關閉"),1)])),_:1},8,["type","title"])])])])]),o.showSecsMessageDisplay?((0,s.wg)(),(0,s.iD)("div",nn,[(0,s.Wm)(c,{style:{width:"100%",height:"100%"}})])):(0,s.kq)("",!0)])])}const ln=e=>((0,s.dD)("data-v-4db50018"),e=e(),(0,s.Cn)(),e),rn={class:"border rounded p-1"},dn={class:"d-flex justify-content-end p-2",style:{background:"#1d1e1f",color:"#ffffff"}},cn={class:"mb-2"},un=ln((()=>(0,s._)("i",{class:"el-icon-search",style:{color:"#909399"}},null,-1))),mn={class:"timestamp"},hn={class:"message-text"},pn={key:1,class:"message-text"},gn=ln((()=>(0,s._)("div",{style:{background:"#2b2b2b",height:"100%",width:"100%"}},null,-1)));function _n(e,t,a,i,o,l){const r=(0,s.up)("el-input"),d=(0,s.up)("el-button"),c=(0,s.up)("el-table-column"),u=(0,s.up)("el-table");return(0,s.wg)(),(0,s.iD)("div",rn,[(0,s._)("div",dn,[(0,s._)("span",null,"Messages: "+(0,n.zw)(l.secsmessages.length),1)]),(0,s._)("div",cn,[(0,s.Wm)(r,{modelValue:o.searchText,"onUpdate:modelValue":t[0]||(t[0]=e=>o.searchText=e),clearable:"",placeholder:"Input keyword to search messages",style:{background:"#2b2b2b",color:"#ffffff",border:"1px solid #4a4a4a"},class:"dark-theme-input"},{prefix:(0,s.w5)((()=>[un])),_:1},8,["modelValue"])]),(0,s._)("div",null,[(0,s.Wm)(d,{size:"small",onClick:l.scrollToTop,style:{position:"fixed",bottom:"50px",right:"40px","z-index":"1000"}},{default:(0,s.w5)((()=>[(0,s.Uk)("Scroll to Top")])),_:1},8,["onClick"]),(0,s.Wm)(u,{ref:"secsTable",data:l.filterMessages,height:"980px",style:{width:"100%"},"header-cell-style":{background:"#1d1e1f",color:"#ffffff"},"cell-style":{background:"#2b2b2b",color:"#ffffff"},"empty-text":""},{empty:(0,s.w5)((()=>[gn])),default:(0,s.w5)((()=>[(0,s.Wm)(c,{prop:"message",label:"Message"},{default:(0,s.w5)((e=>[e.row.message.match(/\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2}:\d{2}\.\d{4}/)?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s._)("span",mn,(0,n.zw)(e.row.message.match(/\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2}:\d{2}\.\d{4}/)[0]),1),(0,s._)("pre",hn,(0,n.zw)(e.row.message.substring(e.row.message.match(/\d{4}\/\d{2}\/\d{2}\s\d{2}:\d{2}:\d{2}\.\d{4}/)[0].length)),1)],64)):((0,s.wg)(),(0,s.iD)("pre",pn," "+(0,n.zw)(e.row.message)+" ",1))])),_:1})])),_:1},8,["data"])])])}var wn={data(){return{searchText:""}},computed:{secsmessages(){return j.ZP.state.secsmessages.reverse().map((e=>({message:e})))},filterMessages(){if(0===this.secsmessages.length)return[];if(!this.searchText)return this.secsmessages;try{const e=this.searchText.trim().toLowerCase().split(/\s+/);return this.secsmessages.filter((t=>{const a=t.message.toLowerCase();return e.every((e=>a.includes(e)))}))}catch(e){return console.error("Error filtering messages:",e),[]}}},mounted(){j.ZP.dispatch("DownLoadSecsNewestMessages")},methods:{scrollToTop(){this.$refs.secsTable.scrollTo(0,0)}}};const fn=(0,X.Z)(wn,[["render",_n],["__scopeId","data-v-4db50018"]]);var yn=fn,vn=(a(23794),{components:{secsMessageDisplay:yn},data(){return{showSecsMessageDisplay:!0,isSimulation:!1,connectionStatusMap:{0:{text:"Connecting",type:"warning"},1:{text:"Connected",type:"success"},2:{text:"Selected",type:"success"},3:{text:"Retry",type:"warning"},4:{text:"Disconnected",type:"danger"}}}},computed:{connectionState(){return this.$store.state.connectionStates},isSecsPlatformRunning(){return this.$store.state.secsPlatformRunning}},mounted(){setTimeout((async()=>{try{const e=await j.ZP.dispatch("updageConnectionStates");console.log(e),void 0===e&&this.$swal.fire("錯誤","無法取得SECS/GEM連線狀態","error")}catch(e){alert("無法取得SECS/GEM連線狀態")}}),1e3)}});const Sn=(0,X.Z)(vn,[["render",on],["__scopeId","data-v-2050062a"]]);var bn=Sn,Cn=a(82106);const kn=[{path:"/",name:"home",component:Xt,meta:{Display:"首頁",Display_Eng:"Home"}},{path:"/Login",name:"Login",component:xi,meta:{Display:"登入",Display_Eng:"Login"}},{path:"/OP",name:"OP",component:()=>a.e(955).then(a.bind(a,93955)),meta:{Display:"操作模式",Display_Eng:"Operation Mode"}},{path:"/maptest",name:"maptest",component:()=>Promise.resolve().then(a.bind(a,60351)),meta:{isAdminUse:!0,Display:"地圖測試",Display_Eng:"Map Test"}},{path:"/map",name:"map",children:[{path:"map_editor",name:"map_editor",component:()=>a.e(63).then(a.bind(a,63)),meta:{Display:"地圖編輯",Display_Eng:"Map Editor"}},{path:"agv_display",name:"agv_display",component:()=>a.e(373).then(a.bind(a,59373)),meta:{Display:"AGV顯示",Display_Eng:"AGV Display"}}],meta:{isAdminUse:!0}},{path:"/racks_status",name:"racks_status",component:()=>a.e(941).then(a.bind(a,47941)),meta:{Display:"帳籍管理",Display_Eng:"Material Management"}},{path:"/vehicle",name:"vehicle",component:()=>a.e(433).then(a.bind(a,51433)),meta:{Display:"車輛管理",Display_Eng:"Vehicle Manager"}},{path:"/sys_settings",name:"sys_settings",meta:{requiresAuth:!0,Display:"系統設定",Display_Eng:"System Settings"},children:[{path:"AGV_Battery_Setting",name:"AGV_Battery_Setting",meta:{requiresAuth:!0,Display:"AGV電量管理",Display_Eng:"AGV Battery Management"},component:Ui},{path:"Equipment_Setting",name:"Equipment_Setting",meta:{requiresAuth:!0,Display:"設備管理",Display_Eng:"Equipment Manager"},component:Rs},{path:"RacksManagement",name:"RacksManagement",meta:{requiresAuth:!0,Display:"Rack 設定",Display_Eng:"Racks Setting"},component:()=>Promise.all([a.e(769),a.e(493)]).then(a.bind(a,34907))},{path:"User_Setting",name:"User_Setting",meta:{requiresAuth:!0,Display:"使用者管理",Display_Eng:"User Manager"},component:()=>a.e(554).then(a.bind(a,33554))},{path:"Charge_Station_Setting",name:"Charge_Station_Setting",meta:{requiresAuth:!0,Display:"充電站管理",Display_Eng:"Charge Station Manager"},component:Si},{path:"secs_gem_settings",name:"secs_gem_settings",meta:{requiresAuth:!0,Display:"SECS/GEM 設定",Display_Eng:"SECS/GEM Settings"},component:()=>a.e(82).then(a.bind(a,40082))}],meta:{isAdminUse:!0}},{path:"/data",name:"data",children:[{path:"task_history",name:"task_history",component:()=>Promise.resolve().then(a.bind(a,78075)),meta:{Display:"歷史任務查詢",Display_Eng:"Task History"}},{path:"alarm_history",name:"alarm_history",component:()=>Promise.resolve().then(a.bind(a,79888)),meta:{Display:"歷史警報查詢",Display_Eng:"Alarm History"}},{path:"agv_locus",name:"agv_locus",component:()=>Promise.resolve().then(a.bind(a,51826)),meta:{Display:"AGV軌跡",Display_Eng:"AGV Locus"}},{path:"InstrumentMeasureQuery",name:"InstrumentMeasureQuery",component:()=>Promise.resolve().then(a.bind(a,90259)),meta:{Display:"儀器量測查詢",Display_Eng:"Instrument Measure Query"}},{path:"Avalibility",name:"Avalibility",component:()=>Promise.resolve().then(a.bind(a,53806)),meta:{Display:"稼動率",Display_Eng:"Avalibility"}},{path:"TrafficState",name:"TrafficState",component:()=>a.e(811).then(a.bind(a,17811)),meta:{Display:"交通狀態",Display_Eng:"Traffic State"}}]},{path:"/alarm",name:"alarm",component:Ea,meta:{Display:"系統警報",Display_Eng:"System Alarm"}},{path:"/playground",name:"dev_ui",meta:{requiresAuth:!0},component:()=>Promise.all([a.e(769),a.e(536)]).then(a.bind(a,15646))},{path:"/hotrun",name:"hotrun",meta:{requiresAuth:!0,Display:"HOT RUN",Display_Eng:"HOT RUN"},component:()=>a.e(155).then(a.bind(a,92155))},{path:"/secsgem",name:"secsgem",meta:{requiresAuth:!1,Display:"SECS/GEM",Display_Eng:"SECS/GEM"},component:bn}],Tn=[{path:"/",name:"home",component:()=>a.e(726).then(a.bind(a,41726)),children:[{path:"/",name:"/",component:()=>a.e(943).then(a.bind(a,27943)),meta:{Display:"車輛狀態與任務"}},{path:"BirdView",name:"BirdView",component:()=>a.e(705).then(a.bind(a,55705)),meta:{Display:"Bird View"}},{path:"AGVLocus",name:"AGVLocus",component:()=>Promise.resolve().then(a.bind(a,51826)),meta:{Display:"AGV軌跡"}}]},{path:"/map",name:"map",component:()=>a.e(63).then(a.bind(a,63))},{path:"/alarm",name:"alarm",component:Ea},{path:"/data",name:"data",component:ka}],Dn=(0,i.p7)({history:(0,i.PO)(),routes:kn});Dn.beforeEach((async(e,t,a)=>{if(e.matched.some((e=>e.meta.requiresAuth)))try{await(0,Cn.Zu)()?a():a("/login")}catch(i){a("/login")}else a()}));var Vn=Dn},25044:function(e,t,a){"use strict";a.d(t,{qz:function(){return A},jU:function(){return D},Ys:function(){return V},g4:function(){return T},sn:function(){return b},cy:function(){return C},ZP:function(){return S},HP:function(){return k}});a(57658);var i=a(33907),s=a(82106),n=a(69215),o=a(90131),l=(a(83592),a(56938)),r=a(78538),d=a(47327);class c{constructor(){(0,d.Z)(this,"BaseOnKGSWebAGVSystem",!1),(0,d.Z)(this,"FieldName","UMTC-S15F"),(0,d.Z)(this,"DBConnection","Server=127.0.0.1;Database=GPMAGVs_V3;User Id=sa;Password=12345678;Encrypt=False"),(0,d.Z)(this,"PartsAGVSDBConnection","Server=127.0.0.1;Database=AGVS_Info;User Id=sa;Password=Tsmc12345678;Encrypt=False;MultipleActiveResultSets=True;Connection Lifetime=1;Min Pool Size=5;Max Pool Size=50;MultipleActiveResultSets=True;"),(0,d.Z)(this,"KGSWebAGVSystemDBConnection","Server=127.0.0.1;Database=WebAGVSystem;User Id=sa;Password=12345678;Encrypt=False;MultipleActiveResultSets=True;Connection Lifetime=1;Min Pool Size=5;Max Pool Size=50;MultipleActiveResultSets=True;"),(0,d.Z)(this,"VMSHost","http://localhost:5036"),(0,d.Z)(this,"AGVSHost","http://localhost:5216"),(0,d.Z)(this,"VMSTcpServerIP","192.168.0.1"),(0,d.Z)(this,"VMSTcpServerPort",5500),(0,d.Z)(this,"WebUserLogoutExipreTime",3600),(0,d.Z)(this,"MapConfigs",{MapFolder:"C://AGVS//Map",CurrentMapFileName:"Map_UMTC_5F_SMK_OVEN.json",MapRegionConfigFile:"C://AGVS//Map//MapRegions.json",MapFileFullName:"C://AGVS//Map\\Map_UMTC_5F_SMK_OVEN.json"}),(0,d.Z)(this,"EQManagementConfigs",{UseEQEmu:!1,EquipmentManagementConfigFolder:"C://AGVS//EquipmentManagement",DisableEntryPointWhenEQMaintaining:!1,DisableEntryPointWhenEQPartsReplacing:!1,TransferToNGPortWhenCarrierIDMissmatch:!1}),(0,d.Z)(this,"AutoModeConfigs",{AGVIdleTimeUplimitToExecuteChargeTask:3}),(0,d.Z)(this,"AutoSendDailyData",{SavePath:"C:\\DailyData\\",SaveTime:1}),(0,d.Z)(this,"clsAGVS_Print_Data",{SavePath:"C:\\AGVS_Print_Data\\"}),(0,d.Z)(this,"AGVUpdateFileFolder","C:\\AGVS\\AGV_Update"),(0,d.Z)(this,"LogFolder","C:\\AGVSLog"),(0,d.Z)(this,"TrobleShootingFolder","D:\\Program\\AGVSystem\\bin\\Debug\\net6.0\\Resources\\"),(0,d.Z)(this,"MaterialBufferLevelMonitor",{MonitorSwitch:!1,LevelThreshold:0}),(0,d.Z)(this,"LinkPartsAGVSystem",!1),(0,d.Z)(this,"OrderState",{TaskNoExecutedTimeout:20})}}var u=a(663),m=a(9669),h=a.n(m),p=a(89302),g=a(23794),_=a(64491),w=a(91648),f=a(22201),y=a(53259),v={agvStates:"agv_states"};(0,f.yj)();var S=(0,i.MT)({state:{websiteSetting:{FieldName:"UMTC"},systemConfigs:new c,vmsAppInfo:{AppVersion:"1.0.0"},regularHotRunStates:{state:"stopped",scriptID:"",unloaderStates:{}},isCtrlPressing:!1,secsPlatformRunning:!1,secsmessages:[],connectionStates:{cim:4,mcs:4},databaseState:{state:!0,message:""}},getters:{GetWebsiteSetting:e=>e.websiteSetting,FieldName:e=>e.websiteSetting.FieldName,APPVersion:e=>e.websiteSetting.APPVersion},mutations:{setAgvsystemConfigs(e,t){e.websiteSetting=t},setSystemConfigs(e,t){e.systemConfigs=t},setVmsAppInfo(e,t){e.vmsAppInfo=t},setRegularHotRunState(e,t){e.regularHotRunStates=t,console.log(e.regularHotRunStates)},setCtrlKeyPressing(e,t){e.isCtrlPressing=t},setSecsPlatformRunning(e,t){e.secsPlatformRunning=t},storeSecsMessage(e,t){e.secsmessages.push(t),e.secsmessages.length>50&&e.secsmessages.shift(),console.info(e.secsmessages)},setSecsMessages(e,t){e.secsmessages=t},storeConnectionStates(e,t){e.connectionStates=t},updateDatabaseState(e,t){e.databaseState=t}},actions:{async GetDynamicWebsiteData({commit:e},t){var a=await h().get(`${u.Z.backend_host}/api/system/website`);return e("setAgvsystemConfigs",a.data),a.data},async DownloadSystemConfigs({commit:e}){var t=await h().get(`${u.Z.backend_host}/api/system/systemconfigs`);return e("setSystemConfigs",t.data),t.data},async DownloadVMSAppInfo({commit:e}){var t=await h().get(`${u.Z.vms_host}/api/system/GetVMSAppInfo`);return e("setVmsAppInfo",t.data),t.data},async StoreSecsMessage({commit:e},t){e("storeSecsMessage",t)},async DownLoadSecsNewestMessages({commit:e}){g.Z.getSecsNewestMessages().then((t=>{e("setSecsMessages",t)}))},async updageConnectionStates({commit:e}){try{const t=await g.Z.getConnectionState();return console.error(t),e("storeConnectionStates",t),t}catch(t){return void console.error(t)}}}});const b=(0,i.MT)({state:{agv_states:[new l.Z],hotrun_states:[],vehiclesBatteryStatus:{AGV_001:0,AGV_002:0,AGV_003:0,AGV_004:0}},getters:{AGVStatesData:e=>{if(e.agv_states)return e.agv_states;var t=localStorage.getItem(v.agvStates);if(null!=t){var a=JSON.parse(t);return a}return[new l.Z]},AGVNameList:e=>e.agv_states?e.agv_states.map((e=>e.AGV_Name)):[],AGVIPCollection:e=>e.agv_states?e.agv_states.map((e=>e.IP)):[],HotRunStates:e=>e.hotrun_states,VehicleSize:e=>t=>{if(!e.agv_states)return[0,0];var a=e.agv_states.find((e=>e.AGV_Name==t));return a?[a.VehicleLength,a.VehicleWidth]:[0,0]},VehicleBatteryStatus:e=>t=>e.vehiclesBatteryStatus[t],VehicleBattery:e=>t=>{if(!e.agv_states)return;const a=e.agv_states.find((e=>e.AGV_Name==t));let i={batLv:0,isCharging:!1};return i.batLv=a?a.BatteryLevel_1:-1,i.isCharging=!!a&&a.IsCharging,i}},mutations:{storeAgvStates(e,t){e.agv_states=t},setHotRunStates(e,t){e.hotrun_states=t},setVehiclesBatteryStatus(e,t){e.vehiclesBatteryStatus=t}}}),C=(0,i.MT)({state:{sys_settings:{operations:{system_run_mode:!1,host_online_mode:!1,host_remote_mode:!1,transfer_mode:!1}}},mutations:{setOperations(e,t){e.sys_settings.operations=t},setRunMode(e,t){e.sys_settings.operations.system_run_mode=t},setHostOnline(e,t){e.sys_settings.operations.host_online_mode=t},setHostRemote(e,t){e.sys_settings.operations.host_remote_mode=t},setTransferRemote(e,t){e.sys_settings.operations.transfer_mode=t}},actions:{},getters:{IsRunMode:e=>e.sys_settings.operations.system_run_mode}}),k=(0,i.MT)({state:{user:new o.fj,current_route:"",web_user_id:""},mutations:{setUser(e,t){e.user=t,(0,s.FU)(t)},setUserID(e,t){e.web_user_id=t,console.log(t)},setRoute(e,t){e.current_route=t,console.log(t)},updateCurrentUserPermission(e,t){e.user.Permission=t}},actions:{async login({commit:e},t){var a=await(0,s.m3)(t),i=new o.fj;return Object.assign(i,a),i.Success&&(i.LoginTime=Date.now()),e("setUser",i),console.log(i),{confirm:i.Success,message:i.Message}},logout({commit:e}){e("setUser",new o.fj)},async user_route_change({commit:e,state:t},a){e("setRoute",a);var i=await(0,s.hB)(t.web_user_id,a);return i}},getters:{IsLogin:e=>null!=e.user&&e.user.Success,IsOPLogining:(e,t)=>!!t.IsLogin&&0==e.user.Role,IsEngineerLogining:(e,t)=>!!t.IsLogin&&1==e.user.Role,IsDeveloperLogining:(e,t)=>!!t.IsLogin&&(2==e.user.Role||3==e.user.Role),level:e=>e.user?e.user.Role:-1,UserName:e=>e.user?e.user.UserName:"",WebUserID:e=>e.web_user_id}}),T=(0,i.MT)({state:{locus:{},EqpAlarmShowState:!1,SystemAlarmShowState:!1,VMSAliveState:!1},mutations:{IsSystemAlarmShowing(e,t){e.SystemAlarmShowState=t},IsEqpAlarmShowing(e,t){e.EqpAlarmShowState=t},SetVMSAlive(e,t){e.VMSAliveState=t}},getters:{SystemAlarmShowState:e=>e.SystemAlarmShowState,EqpAlarmShowState:e=>e.EqpAlarmShowState,VMSAlive:e=>e.VMSAliveState}}),D=(0,i.MT)({state:{EQ:[],ChargeStation:{charge1:{}},EqOptions:[r.W1],WIPOptions:[],WIPsData:[],ChargeStationDataReceived:!1,WIPSlotOptions:{2:["1","2","3"]},HasDataButNoCargoWIPs:[],IsAnyPortHasDataButNoCargo:!1},getters:{EQData:e=>e.EQ,ChargeStationData:e=>e.ChargeStation,EqOptions:e=>e.EqOptions,WIPData:e=>e.WIPsData,WIPOptions:e=>e.WIPOptions,GetRowsByStationTag:e=>e=>3,GetWIPSlotsOptionsByStationTag:e=>t=>e.WIPSlotOptions[t],QueryCargoExist:(e,t)=>(e,a)=>{const i=t.GetRackPort(e,a);return i?.CargoExist||!1},QueryPortDisabled:(e,t)=>(e,a)=>{const i=t.GetRackPortOption(e,a);return!i||0==i.PortUsable},GetRackPort:e=>(t,a)=>{var i=e=>e.ColumnsTagMap?Object.values(e.ColumnsTagMap).flat():[],s=e.WIPsData.find((e=>i(e).includes(t)));if(s){let e=s.Ports.filter((e=>e.TagNumbers.includes(t))),i=e.find((e=>e.Layer==a));return i}return{}},GetRackPortOption:e=>(t,a)=>{var i=e=>e.ColumnTagMap?Object.values(e.ColumnTagMap).flat():[];const s=e.WIPOptions.find((e=>i(e).includes(t)));if(s){const e=Object.keys(s.ColumnTagMap).find((e=>s.ColumnTagMap[e].includes(t)));return s.PortsOptions.find((t=>t.Column==e&&t.Row==a))}},AnyTwoLayerEqExist:e=>{try{var t=[...new Set(e.EqOptions.map((e=>e.TagID)))],a=[...new Set(e.EqOptions.map((e=>e.TagID+"-"+e.Height)))];return t.length!=a.length}catch(i){return!1}}},mutations:{setData(e,t){e.ChargeStation=t.ChargeStationData,e.ChargeStationDataReceived=!0},EqOptions(e,t){e.EqOptions=t},WIPOptions(e,t){e.WIPOptions=t},wipSlotOptions(e,t){e.WIPSlotOptions=t,console.info(e.WIPSlotOptions)},rackStatusData(e,t){e.WIPsData=t,e.HasDataButNoCargoWIPs=t.filter((e=>e.IsAnyPortHasDataButNoCargo)),e.IsAnyPortHasDataButNoCargo=e.HasDataButNoCargoWIPs.length>0,y.Z.emit("rack_data_changed",t)},setEQData(e,t){e.EQ=t,y.Z.emit("eq_data_changed",t)}},actions:{async FetchWIPSlotOptions({commit:e}){var t=await(0,n.p_)();e("wipSlotOptions",t)},async QueryCargoID({getters:e},{tag:t,slot:a}){const i=e.GetRackPort(t,a);return i?.CarrierID||""},async downloadRackStatusData({commit:e}){var t=await(0,n.ts)();e("rackStatusData",t)},async downloadEQData({commit:e}){var t=await(0,_.GV)();console.info(t),e("setEQData",t)}}}),V=(0,i.MT)({state:{IncompletedTaskListData:[new p.Z({})],CompletedTaskListData:[new p.Z({})]},getters:{IncompletedTaskList:e=>e.IncompletedTaskListData,CompletedTaskList:e=>e.CompletedTaskListData,AnyOrderAssignTagAndSlot:e=>(t,a)=>{let i=e.IncompletedTaskListData.find((e=>e.From_Station==t+""&&e.From_Slot==a+""||e.To_Station==t+""&&e.To_Slot==a+""));return void 0!=i},IsRunningHighestPriorityTask:e=>(t="")=>{const a=e.IncompletedTaskListData.find((e=>e.DesignatedAGVName==t));return a?.IsHighestPriorityTask||!1}},mutations:{StoreTaskData(e,t){e.CompletedTaskListData=t.completeds,e.IncompletedTaskListData=t.incompleteds}}}),A=(0,i.MT)({state:{alarmsCollection:[]},getters:{alarms:e=>e.alarmsCollection},mutations:{StoreAlarmData(e,t){e.alarmsCollection=t}},actions:{async downloadUncheckedAlarms({commit:e}){var t=await(0,w.$x)();e("StoreAlarmData",t)}}})},764:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var i=a(66252);function s(e,t,a,s,n,o){const l=(0,i.up)("el-option"),r=(0,i.up)("el-select");return(0,i.wg)(),(0,i.j4)(r,{modelValue:n.selected,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selected=e),onChange:o.HandleSelectChanged},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.agvNameList,(e=>((0,i.wg)(),(0,i.j4)(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])}var n=a(25044),o={props:{default:{type:String}},data(){return{selected:this.value}},methods:{HandleSelectChanged(){}},computed:{agvNameList(){return n.sn.getters.AGVNameList}},mounted(){this.selected=this.default}},l=a(83744);const r=(0,l.Z)(o,[["render",s]]);var d=r},44056:function(e,t,a){"use strict";a.d(t,{Z:function(){return H}});var i=a(66252),s=a(3577),n=a(49963);const o=e=>((0,i.dD)("data-v-64f87918"),e=e(),(0,i.Cn)(),e),l={class:"app-header bg-primary text-light border-bottom border-left"},r={class:"d-flex flex-row py-1",style:{"z-index":"5001"}},d={class:"flex-fill text-start d-flex"},c={class:"field-name"},u={key:0,class:"field-name mx-3"},m={class:"options d-flex justify-content-between"},h=o((()=>(0,i._)("i",{class:"bi bi-three-dots-vertical pt-2"},null,-1))),p={class:"mx-1"},g=o((()=>(0,i._)("i",{class:"bi bi-translate"},null,-1))),_=o((()=>(0,i._)("i",{class:"bi bi-person-circle"},null,-1))),w={key:0,class:"bi bi-caret-down-fill"},f={class:"d-flex flex-column"},y={class:"alarm text-dark"},v={class:"flex-fill"},S={class:"type-text"},b={class:"alarm-text"},C={key:0,class:"opt d-flex"},k={class:"flex-fill"},T={class:"type-text"},D={class:"alarm-text"},V={class:"opt"};function A(e,t,a,o,A,I){const x=(0,i.up)("MenuExpandIcon"),E=(0,i.up)("MenuFoldIcon"),M=(0,i.up)("el-icon"),P=(0,i.up)("el-switch"),O=(0,i.up)("b-button"),N=(0,i.up)("el-popover");return(0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",r,[(0,i._)("i",{onClick:t[0]||(t[0]=(...e)=>I.ToggleMenu&&I.ToggleMenu(...e)),class:"menu-toggle-icon text-light px-2"},[(0,i.Wm)(M,null,{default:(0,i.w5)((()=>[a.MenuExpanded?((0,i.wg)(),(0,i.j4)(x,{key:0,class:"menu-icon"})):((0,i.wg)(),(0,i.j4)(E,{key:1,class:"menu-icon"}))])),_:1})]),(0,i._)("div",d,[(0,i._)("div",c,(0,s.zw)(I.fieldName),1),I.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",u,"- "+(0,s.zw)(A.current_route_info.route_display_name),1))]),(0,i._)("div",m,[h,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(A.modes,((t,a)=>(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",{class:"op-mode-switch-container",key:t.name},[(0,i._)("span",p,(0,s.zw)("zh-TW"==e.$i18n.locale?t.name:t.name_eng),1),(0,i.Wm)(P,{modelValue:t.actived,"onUpdate:modelValue":e=>t.actived=e,disabled:!I.IsLogin,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":t.active_text,"inactive-text":t.inactive_text,"border-color":"grey","inline-prompt":"","before-change":t.beforeChangeHandler,loading:t.loading,size:"large",width:"75px"},null,8,["modelValue","onUpdate:modelValue","disabled","active-text","inactive-text","before-change","loading"])])),[[n.F8,I.GetModeVisible(a)]]))),128)),(0,i.kq)("",!0),(0,i._)("div",null,[(0,i.Wm)(O,{class:"mx-1",style:{border:"none","background-color":"transparent",color:"white"},onClick:t[2]||(t[2]=t=>I.LangSwitch("zh-TW"==e.$i18n.locale?"en-US":"zh-TW"))},{default:(0,i.w5)((()=>[(0,i.Wm)(M,null,{default:(0,i.w5)((()=>[g])),_:1}),(0,i.Uk)(" "+(0,s.zw)("zh-TW"==e.$i18n.locale?"ENGLISH":"中文"),1)])),_:1})]),(0,i._)("div",{class:"user-login-container",onClick:t[3]||(t[3]=(...e)=>I.LoginClickHandler&&I.LoginClickHandler(...e))},[(0,i.Wm)(N,{placement:"bottom",title:"",width:"",trigger:"hover",content:"","popper-class":"bg-light"},{reference:(0,i.w5)((()=>[(0,i.Wm)(O,{style:{border:"none","background-color":"transparent",color:"white"}},{default:(0,i.w5)((()=>[(0,i.Wm)(M,null,{default:(0,i.w5)((()=>[_])),_:1}),(0,i.Uk)(" "+(0,s.zw)(I.UserName)+" ",1),I.IsLogin?((0,i.wg)(),(0,i.iD)("i",w)):(0,i.kq)("",!0)])),_:1})])),default:(0,i.w5)((()=>[(0,i._)("div",f,[I.IsLogin?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(O,{key:0,onClick:I.LoginClickHandler,variant:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("App.Header.LOGIN")),1)])),_:1},8,["onClick"])),I.IsLogin?((0,i.wg)(),(0,i.j4)(O,{key:1,onClick:I.LogoutQickly,variant:"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("App.Header.LOGOUT")),1)])),_:1},8,["onClick"])):(0,i.kq)("",!0),I.IsLogin?((0,i.wg)(),(0,i.j4)(O,{key:2,class:"my-1 bg-light text-dark",onClick:I.SwitchUserBtnClick},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("App.Header.Switch user")),1)])),_:1},8,["onClick"])):(0,i.kq)("",!0)])])),_:1})])])]),(0,i.wy)((0,i._)("div",y,[(0,i._)("div",{class:(0,s.C_)(["alarm-container",A.system_alarms_classes])},[(0,i._)("div",v,[(0,i._)("span",S,(0,s.zw)(e.$t("App.Header.systemalarm")),1),(0,i._)("span",b,(0,s.zw)(A.system_alrm_text),1)]),I.IsLogin?((0,i.wg)(),(0,i.iD)("div",C,[(0,i.Wm)(O,{onClick:I.StopBuzzerHandler,class:"mb-0 mx-1",variant:"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("App.Header.Turnoffbuzzer")),1)])),_:1},8,["onClick"]),(0,i.Wm)(O,{onClick:I.ResetSysAlarmsHandler,class:"mb-0 mx-1",variant:"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("App.Header.alarmreset")),1)])),_:1},8,["onClick"]),(0,i._)("i",{class:"bi bi-clock-history",onClick:t[4]||(t[4]=(...e)=>I.NavigateToAlarmView&&I.NavigateToAlarmView(...e))})])):(0,i.kq)("",!0)],2),(0,i._)("div",{class:(0,s.C_)(["alarm-container",A.equipment_alarms_classes])},[(0,i._)("div",k,[(0,i._)("span",T,(0,s.zw)(e.$t("App.Header.eqalarm")),1),(0,i._)("span",D,(0,s.zw)(A.eq_alrm_text),1)]),(0,i._)("div",V,[(0,i._)("div",null,[(0,i.kq)("",!0)]),(0,i._)("i",{class:"bi bi-clock-history",onClick:t[5]||(t[5]=(...e)=>I.NavigateToAlarmView&&I.NavigateToAlarmView(...e))})])],2)],512),[[n.F8,A.showAlarm&&!I.IsOpUsing]])])}a(57658);var I=a(53259),x=a(43556),E=(a(90131),a(91648)),M=a(30381),P=a.n(M),O=a(22201),N=a(25044),L=a(65781),G=a(49996),R={components:{MenuExpandIcon:L.M0b,MenuFoldIcon:L.qFw,UserFilled:L.wvC},data(){return{current_route_info:{route_display_name:"派車系統",route_name:"/"},maintain_mode:!0,modes:{system_operation_mode:{name:"操作模式",name_eng:"Operation Mode",actived:!1,active_text:"zh-TW"==this.$i18n.locale?"運轉":"RUN",inactive_text:"zh-TW"==this.$i18n.locale?"維護":"MAINTAIN",loading:!1,visible:!0,beforeChangeHandler:()=>this.SysOptModeChangeRequest()},transfer_mode:{name:"派工模式",name_eng:"Dispatch Mode",enabled:!1,active_text:"zh-TW"==this.$i18n.locale?"自動":"AUTO",inactive_text:"zh-TW"==this.$i18n.locale?"手動":"MANUAL",loading:!1,visible:!0,beforeChangeHandler:()=>this.TransferModeChangeRequest()},host_conn_mode:{name:"HOST連線",name_eng:"Host Connect",enabled:!1,active_text:(this.$i18n.locale,"Online"),inactive_text:(this.$i18n.locale,"Offline"),loading:!1,visible:!0,beforeChangeHandler:()=>this.HostConnModeChangeRequest()},host_operation_mode:{name:"HOST模式",name_eng:"Host Mode",enabled:!1,active_text:(this.$i18n.locale,"Remote"),inactive_text:(this.$i18n.locale,"Local"),loading:!1,visible:!0,beforeChangeHandler:()=>this.HostOptModeChangeRequest()}},modeRenderKey:0,modeVisible:!0,system_alarms_classes:["no-alarm"],equipment_alarms_classes:["no-alarm"],system_alrm_text:"",eq_alrm_text:"",showAlarm:!0,isEasyMode:!1,systemAlarmInterval:void 0}},props:{MenuExpanded:{type:Boolean,default:!1}},computed:{IsLogin(){return-1!=N.HP.state.user.Role},IsOpUsing(){return N.HP.getters.IsOPLogining},current_user_role(){return N.HP.getters.level},UserName(){var e=N.HP.getters.level,t=N.HP.getters.UserName.toUpperCase();return-1==e?this.$t("visitor"):0==e?`${t}(OP)`:1==e?`${t}(ENG)`:2==e?`${t}(DEV)`:3==e?`${t}(GOD)`:"VISITOR"},unchecked_alarms(){return N.qz.getters.alarms},SystemAlarms(){return this.unchecked_alarms?this.unchecked_alarms.filter((e=>0==e.Source)):[]},EquipmentAlarms(){return this.unchecked_alarms?this.unchecked_alarms.filter((e=>1==e.Source)):[]},HasSystemAlarm(){return""!=this.system_alrm_text},HasEqpAlarm(){return""!=this.eq_alrm_text},fieldName(){return this.$store.getters.FieldName}},watch:{HasSystemAlarm(e){this.$emit("update:HasSystemAlarm",e),N.g4.commit("IsSystemAlarmShowing",e)},HasEqpAlarm(e){this.$emit("update:HasEqpAlarm",e),N.g4.commit("IsEqpAlarmShowing",e)},$route(e,t){this.current_route_info.route_display_name="zh-TW"==this.$i18n.locale?e.meta?.Display||e.name:e.meta?.Display_Eng||e.name}},mounted(){this.DownloadSystemOperationsSettings(),I.Z.on("/show-login-view-invoke",(()=>{this.LoginClickHandler()})),I.Z.on("reload-system-modes-from-server",(()=>{this.DownloadSystemOperationsSettings(100)})),I.Z.on("secs-offline-by-agvs-disoneect",(()=>{this.modes.host_conn_mode.actived&&(this.modes.host_conn_mode.actived=!1,this.modes.host_operation_mode.actived=!1,this.$swal.fire({text:"因派車系統已斷線，SECS/GEM現在為OFFLINE",title:"",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}))}));const e=(0,O.yj)();(0,i.YP)((()=>e.path),((e,t)=>{})),this.AlarmDisplayHandler()},methods:{HandleAutoDispatchBtnClick(){N.HP.getters.IsLogin?I.Z.emit("bus-show-task-allocation",{agv_name:"",agv_type:"",action:"",station_data:void 0}):this.$swal.fire({text:"",title:"權限不足 請先登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},GetModeVisible(e){var t=N.HP.state.user.Permission;switch(e){case"system_operation_mode":return 1==t.systemModesOperations.RunModeSwitch;case"transfer_mode":return 1==t.systemModesOperations.AutoTransferModeSwitch;case"host_conn_mode":return 1==t.systemModesOperations.HostOnlineSwitch;case"host_operation_mode":return 1==t.systemModesOperations.HostRemoteSwitch}return!1},async DownloadSystemOperationsSettings(e=1e3){setTimeout((async()=>{var e=await(0,x.m0)();N.cy.commit("setOperations",e),this.modes.system_operation_mode.actived=1==e.system_run_mode,this.modes.host_conn_mode.actived=1==e.host_online_mode,this.modes.host_operation_mode.actived=1==e.host_remote_mode,this.modes.transfer_mode.actived=1==e.transfer_mode}),e)},ToggleMenu(){I.Z.emit("menuToggle")},LogoClickHandler(){this.$router.push("/")},LoginClickHandler(){var e=this.$route.path;e.toLocaleLowerCase().includes("/login")||this.$router.push({path:"/Login",query:{pre:e}})},SwitchUserBtnClick(){var e=this.$route.path;e.toLocaleLowerCase().includes("/login")||this.$router.push({path:"/Login",query:{pre:e,action:"switch"}})},LogoutQickly(){this.$swal.fire({title:"Logout!",text:"確定要登出?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes"}).then((e=>{e.isConfirmed&&(N.HP.dispatch("logout"),this.$swal.fire({title:"登出成功!",icon:"success",timer:1e3}).then((()=>{location.href="/"})))}))},async TransferModeChangeRequest(){if(0!=this.modes.system_operation_mode.actived){if(!this.CheckUserLoginState())return!1;var e=await(0,x.fw)(this.modes.transfer_mode.actived?0:1),t=e.confirm,a="搬運模式切換";return t?(this.ModeRequestSuccessHandler(a),N.cy.commit("setTransferRemote",!this.modes.transfer_mode.actived)):this.ModeRequestFailHandler("搬運模式","搬運模式切換"),t}},HandleViewModeChanged(e){I.Z.emit("view_mode_changed",e)},async SysOptModeChangeRequest(e=!1){if(!this.CheckUserLoginState())return!1;this.modes.system_operation_mode.loading=!0;var t=this.modes.system_operation_mode.actived?"操作模式-MAINTAIN":"操作模式-RUN",a=await(0,x.jw)(this.modes.system_operation_mode.actived?0:1,e),i=a.confirm,s=a.message;if(i)N.cy.commit("setRunMode",!this.modes.system_operation_mode.actived),this.ModeRequestSuccessHandler(t);else{var n=2==N.HP.getters.level||3==N.HP.getters.level;this.ModeRequestFailHandler("操作模式",s,"尚有任務在執行中"==s&&n?"強制切換":"",(async()=>{setTimeout((()=>{this.SysOptModeChangeRequest(!0)}),200),setTimeout((()=>{this.DownloadSystemOperationsSettings(100)}),500)}))}return this.modes.system_operation_mode.loading=!1,this.modes.system_operation_mode.actived&&(this.modes.transfer_mode.actived=!1),i},async HostConnModeChangeRequest(){if(!this.CheckUserLoginState())return!1;this.modes.host_conn_mode.loading=!0;var e=this.modes.host_conn_mode.actived?"HOST-OFFLINE":"HOST-ONLINE",t=await(0,x.Hk)(this.modes.host_conn_mode.actived?0:1),a=t.confirm,i=t.message;return a?(this.ModeRequestSuccessHandler(e),N.cy.commit("setHostOnline",!this.modes.host_conn_mode.actived)):this.ModeRequestFailHandler(`HOST ${e}`,i),this.modes.host_conn_mode.loading=!1,a},async HostOptModeChangeRequest(){if(!this.CheckUserLoginState())return!1;this.modes.host_operation_mode.loading=!0;var e=this.modes.host_operation_mode.actived?"HOST-LOCAL":"HOST-REMOTE",t=await(0,x.H1)(this.modes.host_operation_mode.actived?0:1),a=t.confirm,i=t.message;return a?(this.ModeRequestSuccessHandler(e),N.cy.commit("setHostRemote",!this.modes.host_operation_mode.actived)):this.ModeRequestFailHandler(`HOST ${e}`,i),this.modes.host_operation_mode.loading=!1,a},CheckUserLoginState(){return this.IsLogin||this.$swal.fire({text:"",title:"權限不足 請先登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),this.IsLogin},ModeRequestFailHandler(e,t,a="",i=(()=>{})){var s=""!=a;this.$swal.fire({title:`${e} 切換失敗`,text:t+"，請稍後再嘗試切換。",icon:"error",showCancelButton:s,cancelButtonText:a,allowOutsideClick:!s}).then((e=>{!e.isConfirmed&&s&&i()}))},ModeRequestSuccessHandler(e){G.bM.success({message:`${e}-請求成功`,position:"top-right",duration:2e3})},LangSwitch(e){this.$i18n.locale=e,localStorage.setItem("lang",e)},async StopBuzzerHandler(){await(0,E.JV)()},async ResetSysAlarmsHandler(){await(0,E.gU)(),G.bM.success({message:"系統警報清除完成",position:"top-right",duration:2e3}),this.ResetSystemAlarmTimer(),this.system_alarms_classes=["no-alarm"],this.system_alrm_text=""},async ResetEqpAlarmsHandler(){await(0,E.F6)(),this.$vs.notify({color:"primary",title:"警報復歸請求",text:"設備警報復歸請求完成",position:"bottom-right",time:1400})},CreateAlarmDisplayText(e){return`${P()(e.Time).format("yyyy/MM/DD HH:mm:ss")} |Code:${e.AlarmCode}|Source:${e.Equipment_Name}|-${e.Description_Zh}(${e.Description_En})`},AlarmDisplayHandler(){var e=0;this.ResetSystemAlarmTimer(),setInterval((()=>{if(!this.EquipmentAlarms||0==this.EquipmentAlarms.length)return this.equipment_alarms_classes=["no-alarm"],void(this.eq_alrm_text="");var t=this.EquipmentAlarms[e];t?(this.equipment_alarms_classes=[1==t.Level?"alarm":"warning"],this.eq_alrm_text=this.CreateAlarmDisplayText(t)):(this.equipment_alarms_classes=[""],this.eq_alrm_text=""),e+=1,e>=this.EquipmentAlarms.length&&(e=0)}),2e3)},ResetSystemAlarmTimer(){clearInterval(this.systemAlarmInterval);var e=0;this.systemAlarmInterval=setInterval((()=>{if(!this.SystemAlarms||0==this.SystemAlarms.length)return this.system_alarms_classes=["no-alarm"],void(this.system_alrm_text="");var t=this.SystemAlarms[e];t?(this.system_alarms_classes=[1==t.Level?"alarm":"warning"],this.system_alrm_text=this.CreateAlarmDisplayText(t)):(this.system_alarms_classes=[""],this.system_alrm_text=""),e+=1,e>=this.SystemAlarms.length&&(e=0)}),2e3)},NavigateToAlarmView(){this.$router.push("/alarm")}}},W=a(83744);const U=(0,W.Z)(R,[["render",A],["__scopeId","data-v-64f87918"]]);var H=U},51455:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var i=a(66252);const s={class:"border rounded",style:{height:"600px",width:"95%",display:"flex","flex-direction":"column"}};function n(e,t,a,n,o,l){const r=(0,i.up)("vue3-chart-js");return(0,i.wg)(),(0,i.iD)("div",s,[((0,i.wg)(),(0,i.j4)(r,{key:o.myChart.type,ref:"chartRef",id:o.myChart.id,type:o.myChart.type,data:o.myChart.data,options:o.myChart.options,onBeforeRender:l.beforeRenderLogic},null,8,["id","type","data","options","onBeforeRender"]))])}var o=a(67361),l={components:{Vue3ChartJs:o.Z},props:{ava_datas:{type:Array,default(){return[1,1,1,1,1]}},colorSet:{type:Array,default(){return["rgb(2, 176, 8)","rgb(255, 226, 6)","rgb(255, 92, 92)","rgb(51, 207, 255)","rgb(186, 186, 186)"]}}},data(){return{myChart:{id:"pie",type:"pie",data:{labels:["RUN","IDLE","DOWN","CHARGE","UNKNOWN","UNKNOWN"],datasets:[{backgroundColor:this.colorSet,data:[0,0,0,0,0]}]},options:{responsive:!0,maintainAspectRatio:!1,animations:{tension:{duration:1e3,easing:"linear",from:1,to:0,loop:!0}},scales:{},plugins:{legend:{position:"top"},title:{display:!0,text:"統計資料"}}}}}},methods:{beforeRenderLogic(e){},updateChart(e){this.myChart.type="pie",this.myChart.options.scales=void 0,this.myChart.data.datasets[0].data=e,this.$refs.chartRef.update()},updateStackBarChart(e={dates:[],idle:[],run:[],down:[],charge:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"IDLE",data:e.idle,backgroundColor:this.colorSet[1],stack:"Stack 1"},{label:"RUN",data:e.run,backgroundColor:this.colorSet[0],stack:"Stack 1"},{label:"DOWN",data:e.down,backgroundColor:this.colorSet[2],stack:"Stack 1"},{label:"CHARGE",data:e.charge,backgroundColor:this.colorSet[3],stack:"Stack 1"}];try{this.$refs.chartRef.update()}catch(t){}},updateStackBarChartmttr(e={dates:[],time:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"MTTR",data:e.time,backgroundColor:this.colorSet[1]}];try{this.$refs.chartRef.update()}catch(t){}},updateStackBarChartmtbf(e={dates:[],time:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"MTBF",data:e.time,backgroundColor:this.colorSet[1]}];try{this.$refs.chartRef.update()}catch(t){}},updateStackBarChartMissTags(e={dates:[],count:[]}){this.myChart.type="bar",this.myChart.data.labels=e.dates,this.myChart.data.datasets=[{label:"MissTagsCount",data:e.count,backgroundColor:this.colorSet[1]}];try{this.$refs.chartRef.update()}catch(t){}}},mounted(){(0,i.YP)((()=>this.ava_datas),((e,t)=>{this.updateChart(e)}),{deep:!0})}},r=a(83744);const d=(0,r.Z)(l,[["render",n]]);var c=d},53658:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var i=a(66252);const s={class:"w-100 rounded"};function n(e,t,a,n,o,l){const r=(0,i.up)("apexchart"),d=(0,i.Q2)("loading");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(r,{ref:"bat_chart",height:l.chartHeight,options:o.chart_datas.chartOptions,series:o.chart_datas.series},null,8,["height","options","series"])])),[[d,o.loading]])}var o=a(96486),l=a.n(o),r={components:{},props:{id:{type:String,default:"a"},title:{type:String,default:"title"}},computed:{chartHeight(){return.8*window.innerHeight+"px"}},data(){return{loading:!1,myChart:void 0,chart_datas:{series:[{name:"Desktops",data:[10,41]}],chartOptions:{chart:{type:"line",zoom:{enabled:!0},animations:{enabled:!0}},dataLabels:{enabled:!1},legend:{show:!0,position:"top"},title:{text:"電量",align:"center"},xaxis:{type:"datetime",tickAmount:3,labels:{format:"yy-MM-dd",style:{fontSize:"16px"}},title:{text:"時間",style:{fontSize:"16px"}},axisBorder:{show:!0}},yaxis:[{labels:{formatter:function(e){return(e/60/60).toFixed(2)},style:{fontSize:"16px"}},title:{text:"MTTR(小時)",style:{fontSize:"16px"}},axisBorder:{show:!0}},{opposite:!0,labels:{formatter:function(e){return(e/60/60).toFixed(2)},style:{fontSize:"16px"}},title:{text:"MTBF(小時)",style:{fontSize:"16px"}},axisBorder:{show:!0}}],tooltip:{enabled:!0}}}}},methods:{RenderChartWithTimeSeriesData(e){let t=JSON.parse(JSON.stringify(e));this.debounceChartUpdate(t)},debounceChartUpdate:l().debounce((function(e){this.$refs["bat_chart"].updateSeries(e)}),300)},mounted(){this.chart_datas.chartOptions.title.text=this.title}},d=a(83744);const c=(0,d.Z)(r,[["render",n]]);var u=c},51826:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ie}});var i=a(66252),s=a(3577);const n=e=>((0,i.dD)("data-v-6a321bfe"),e=e(),(0,i.Cn)(),e),o={class:"agv-locus border rounded"},l={class:"w-100 d-flex"},r={class:"menu-container bg-light p-2 border",ref:"menuContainer"},d={class:"border-bottom my-1 py-2"},c={class:"time-pick text-start d-flex"},u={class:"label"},m={class:"label"},h={class:"label"},p={class:"time-pick text-start d-flex my-3"},g={class:"label"},_=["onClick"],w=n((()=>(0,i._)("i",{class:"view-icon bi bi-eye-fill"},null,-1))),f=[w],y={class:"p-3"},v={class:"time-pick text-start d-flex"},S={class:"label"},b={class:"label"},C={class:""},k=n((()=>(0,i._)("div",{class:"text-start"},"範圍選取",-1))),T={class:"d-flex justify-content-between"},D={class:"d-flex align-items-center mb-2"},V={class:"bg-light border flex-fill"},A={class:"locus-settings bg-dark text-light d-flex py-1 px-3"},I={class:"d-flex"},x={style:{"white-space":"nowrap"}},E={class:"d-flex"},M={style:{"white-space":"nowrap"}},P={class:"ms-auto"};function O(e,t,a,n,w,O){const N=(0,i.up)("AGVSelector"),L=(0,i.up)("el-date-picker"),G=(0,i.up)("el-button"),R=(0,i.up)("el-input"),W=(0,i.up)("el-table-column"),U=(0,i.up)("el-tag"),H=(0,i.up)("el-table"),$=(0,i.up)("b-tab"),F=(0,i.up)("el-divider"),q=(0,i.up)("el-slider"),B=(0,i.up)("el-checkbox"),z=(0,i.up)("View"),j=(0,i.up)("el-icon"),Z=(0,i.up)("Hide"),Q=(0,i.up)("b-tabs"),Y=(0,i.up)("el-col"),K=(0,i.up)("player"),X=(0,i.up)("el-color-picker"),J=(0,i.up)("el-option"),ee=(0,i.up)("el-select"),te=(0,i.up)("Map"),ae=(0,i.up)("el-row"),ie=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",l,[(0,i.Wm)(ae,{class:"w-100"},{default:(0,i.w5)((()=>[(0,i.Wm)(Y,{lg:10},{default:(0,i.w5)((()=>[(0,i._)("div",r,[(0,i._)("div",{class:"resize-handle",onMousedown:t[0]||(t[0]=(...e)=>O.startResize&&O.startResize(...e))},null,32),(0,i.Wm)(Q,{modelValue:w.activeTab,"onUpdate:modelValue":t[9]||(t[9]=e=>w.activeTab=e),onActivateTab:O.handleTabChange},{default:(0,i.w5)((()=>[(0,i.Wm)($,{title:"單次任務軌跡查詢",name:"single-task-traj-query"},{default:(0,i.w5)((()=>[(0,i._)("div",d,[(0,i._)("div",c,[(0,i._)("div",null,[(0,i._)("div",u,(0,s.zw)(e.$t("AGVLocus.SelectAGV")),1),(0,i.Wm)(N,{style:{width:"120px"},modelValue:w.agvname,"onUpdate:modelValue":t[1]||(t[1]=e=>w.agvname=e)},null,8,["modelValue"])]),(0,i._)("div",null,[(0,i._)("div",m,(0,s.zw)(e.$t("AGVLocus.StartTime")),1),(0,i.Wm)(L,{modelValue:w.timePick.start_time,"onUpdate:modelValue":t[2]||(t[2]=e=>w.timePick.start_time=e),type:"datetime",placeholder:"選擇開始時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,i._)("div",null,[(0,i._)("div",h,(0,s.zw)(e.$t("AGVLocus.EndTime")),1),(0,i.Wm)(L,{modelValue:w.timePick.end_time,"onUpdate:modelValue":t[3]||(t[3]=e=>w.timePick.end_time=e),type:"datetime",placeholder:"選擇結束時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,i.Wm)(G,{onClick:O.HandleSearchBtnClicked,style:{height:"30px","font-size":"large",width:"120px",position:"relative",top:"30px"},type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("AGVLocus.Search")),1)])),_:1},8,["onClick"])]),(0,i._)("div",p,[(0,i._)("div",null,[(0,i._)("div",g,(0,s.zw)(e.$t("AGVLocus.taskID")),1),(0,i.Wm)(R,{modelValue:w.conditions.taskID,"onUpdate:modelValue":t[4]||(t[4]=e=>w.conditions.taskID=e),clearable:""},null,8,["modelValue"])])])]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(H,{data:w.tableData,style:{width:"100%"},height:"720","highlight-current-row":"",size:"small",border:""},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{align:"center",label:"No",width:"50"},{default:(0,i.w5)((e=>[(0,i._)("div",null,(0,s.zw)(O.GetNo(e.row)),1)])),_:1}),(0,i.Wm)(W,{label:e.$t("AGVLocus.TaskID"),prop:"task_id","show-overflow-tooltip":""},null,8,["label"]),(0,i.Wm)(W,{label:e.$t("AGVLocus.State"),prop:"state",align:"center",width:"80"},{default:(0,i.w5)((e=>[(0,i._)("span",{style:(0,s.j5)({color:"完成"===e.row.state?"#67C23A":"失敗"===e.row.state?"#F56C6C":"#909399"})},(0,s.zw)(e.row.state),5)])),_:1},8,["label"]),(0,i.Wm)(W,{label:e.$t("AGVLocus.FromStation"),prop:"from_station"},null,8,["label"]),(0,i.Wm)(W,{label:e.$t("AGVLocus.ToStation"),prop:"to_station"},null,8,["label"]),(0,i.Wm)(W,{label:e.$t("AGVLocus.AGV"),prop:"agv_name"},null,8,["label"]),(0,i.Wm)(W,{label:e.$t("AGVLocus.StartTime"),prop:"start_time"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(O.FormatTime(e.row.start_time)),1)])),_:1},8,["label"]),(0,i.Wm)(W,{label:e.$t("AGVLocus.EndTime"),prop:"end_time"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(O.FormatTime(e.row.end_time)),1)])),_:1},8,["label"]),(0,i.Wm)(W,{align:"center",label:e.$t("AGVLocus.CostTime"),prop:"duration","min-width":"80"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Wm)(U,{effect:"dark",type:"info"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(O.CalculatTimeSpend(e.row)),1)])),_:2},1024)])])),_:1},8,["label"]),(0,i.Wm)(W,{fixed:"right",align:"center",label:e.$t("AGVLocus.ShowTrack"),"min-width":"70"},{default:(0,i.w5)((e=>[(0,i._)("div",{class:"w-100",onClick:t=>O.ShowLocusHandler(e.row)},f,8,_)])),_:1},8,["label"])])),_:1},8,["data"])),[[ie,w.loading]])])),_:1}),(0,i.Wm)($,{active:"",title:"軌跡回顧",name:"trajecort-review"},{default:(0,i.w5)((()=>[(0,i._)("div",y,[(0,i._)("div",v,[(0,i._)("div",null,[(0,i._)("div",S,(0,s.zw)(e.$t("AGVLocus.StartTime")),1),(0,i.Wm)(L,{modelValue:w.timePick_TrajPlayer.start_time,"onUpdate:modelValue":t[5]||(t[5]=e=>w.timePick_TrajPlayer.start_time=e),type:"datetime",placeholder:"選擇開始時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,i._)("div",null,[(0,i._)("div",b,(0,s.zw)(e.$t("AGVLocus.EndTime")),1),(0,i.Wm)(L,{modelValue:w.timePick_TrajPlayer.end_time,"onUpdate:modelValue":t[6]||(t[6]=e=>w.timePick_TrajPlayer.end_time=e),type:"datetime",placeholder:"選擇結束時間",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])]),(0,i.Wm)(G,{onClick:O.HandleSearchTrajOnlyWithTimeRangeBtnClicked,style:{height:"30px","font-size":"large",width:"120px",position:"relative",top:"30px"},type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("AGVLocus.Search")),1)])),_:1},8,["onClick"])]),(0,i.Wm)(F),(0,i._)("div",C,[k,(0,i.Wm)(q,{class:"w-100 px-3",range:"","format-tooltip":O.FormatSliderToolTip,modelValue:w.trajPlayTimeOffset,"onUpdate:modelValue":t[7]||(t[7]=e=>w.trajPlayTimeOffset=e),max:w.totalSecOfTrajRePlay,onChange:O.HandleRecordPlaySliderChanged},null,8,["format-tooltip","modelValue","max","onChange"]),(0,i._)("div",T,[(0,i._)("label",null,(0,s.zw)(w.recordPlayStartTimeMoment.format("YYYY/MM/DD HH:mm:ss")),1),(0,i._)("label",null,(0,s.zw)(w.recordPlayEndTimeMoment.format("YYYY/MM/DD HH:mm:ss")),1)]),(0,i.Wm)(F),(0,i._)("div",D,[(0,i.Wm)(B,{class:"ms-auto",modelValue:w.showAllTracks,"onUpdate:modelValue":t[8]||(t[8]=e=>w.showAllTracks=e),indeterminate:w.isIndeterminate,onChange:O.handleShowAllChange},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(w.showAllTracks?"全部隱藏":"全部顯示"),1)])),_:1},8,["modelValue","indeterminate","onChange"])]),(0,i.Wm)(H,{data:w.trajPlayWindowDatas,border:"",height:"700",style:{width:"100%"}},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{label:"時間",prop:"Time"},{default:(0,i.w5)((e=>[(0,i._)("div",null,(0,s.zw)(O.FormatTime(e.row.Time)),1)])),_:1}),(0,i.Wm)(W,{prop:"TaskName",label:"任務名稱","show-overflow-tooltip":""}),(0,i.Wm)(W,{prop:"AGVName",label:"車輛名稱"}),(0,i.Wm)(W,{label:"Action"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[e.row.isShowing?((0,i.wg)(),(0,i.j4)(j,{key:0,size:20,onClick:t=>O.ToggleLocus(e.row)},{default:(0,i.w5)((()=>[(0,i.Wm)(z)])),_:2},1032,["onClick"])):((0,i.wg)(),(0,i.j4)(j,{key:1,size:20,onClick:t=>O.ToggleLocus(e.row)},{default:(0,i.w5)((()=>[(0,i.Wm)(Z)])),_:2},1032,["onClick"])),(0,i.Wm)(G,{type:"text",onClick:t=>O.HandlePlayFromThisTime(e.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("從此時間開始播放")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"])])])])),_:1})])),_:1},8,["modelValue","onActivateTab"])],512)])),_:1}),(0,i.Wm)(Y,{lg:14,class:"d-flex flex-column"},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{ref:"player",disabled:1!=w.activeTab,onOnplay:O.HandlePlayerPlay,onOnstop:O.HandlePlayerStop,onOnpause:O.HandlePlayerPause,onOnskipstart:O.HandlePlayerSkipStart,onOnskipend:O.HandlePlayerSkipEnd},null,8,["disabled","onOnplay","onOnstop","onOnpause","onOnskipstart","onOnskipend"]),(0,i._)("div",V,[(0,i._)("div",A,[(0,i._)("div",I,[(0,i._)("span",x,(0,s.zw)(e.$t("AGVLocus.TrackColor")),1),(0,i.Wm)(X,{onChange:O.HandleLocusSettingChange,modelValue:w.locus_settings.color,"onUpdate:modelValue":t[10]||(t[10]=e=>w.locus_settings.color=e)},null,8,["onChange","modelValue"])]),(0,i._)("div",E,[(0,i._)("span",M,(0,s.zw)(e.$t("AGVLocus.TrackWidth")),1),(0,i.Wm)(ee,{modelValue:w.locus_settings.width,"onUpdate:modelValue":t[11]||(t[11]=e=>w.locus_settings.width=e),onChange:O.HandleLocusSettingChange,style:{width:"80px"}},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)(32,(e=>(0,i.Wm)(J,{key:e,value:e},null,8,["value"]))),64))])),_:1},8,["modelValue","onChange"])]),(0,i._)("div",P,[(0,i.Wm)(G,{type:"primary",onClick:O.saveMapImage},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("AGVLocus.SaveTrackMap")),1)])),_:1},8,["onClick"])])]),(0,i.wy)((0,i.Wm)(te,{class:"bg-light border",ref:"map",id:"locus_map",editable:!1,agv_show:!1,station_show:!0,rackInfoShow:!1,eq_lduld_status_show:!1},null,512),[[ie,w.locus_painting]])])])),_:1})])),_:1})])])}var N=a(764),L=a(60351),G=a(20840),R=a(25044),W=a(95320),U=a(30381),H=a.n(U),$=a(65781);const F={class:"p-2 border rounded-2"},q={class:"d-flex justify-content-center"},B=(0,i._)("i",{class:"bi bi-skip-start-fill"},null,-1),z=(0,i._)("i",{class:"bi bi-play-fill"},null,-1),j=(0,i._)("i",{class:"bi bi-stop-fill"},null,-1),Z=(0,i._)("i",{class:"bi bi-pause-fill"},null,-1),Q=(0,i._)("i",{class:"bi bi-skip-end-fill"},null,-1);function Y(e,t,a,s,n,o){const l=(0,i.up)("el-button");return(0,i.wg)(),(0,i.iD)("div",F,[(0,i._)("div",q,[(0,i.Wm)(l,{disabled:a.disabled,onClick:o.skipStart},{default:(0,i.w5)((()=>[B])),_:1},8,["disabled","onClick"]),n.isPlaying?((0,i.wg)(),(0,i.j4)(l,{key:1,disabled:a.disabled,onClick:o.stop},{default:(0,i.w5)((()=>[j])),_:1},8,["disabled","onClick"])):((0,i.wg)(),(0,i.j4)(l,{key:0,disabled:a.disabled,onClick:o.play},{default:(0,i.w5)((()=>[z])),_:1},8,["disabled","onClick"])),(0,i.Wm)(l,{disabled:a.disabled,onClick:o.pause},{default:(0,i.w5)((()=>[Z])),_:1},8,["disabled","onClick"]),(0,i.Wm)(l,{disabled:a.disabled,onClick:o.skipEnd},{default:(0,i.w5)((()=>[Q])),_:1},8,["disabled","onClick"])])])}var K={data(){return{isPlaying:!1,isPause:!1}},props:{disabled:{type:Boolean,default:!1}},methods:{play(){this.isPlaying=!0,this.isPause=!1,this.$emit("onplay")},stop(){this.isPlaying=!1,this.isPause=!1,this.$emit("onstop")},pause(){this.isPlaying=!1,this.isPause=!0,this.$emit("onpause")},skipStart(){this.$emit("onskipstart")},skipEnd(){this.$emit("onskipend")},demo(){setInterval((()=>{this.time+=1}),1e3)}},watch:{time(e){this.$emit("ontimechange",e)},disabled(e){this.isDisabled=e}}},X=a(83744);const J=(0,X.Z)(K,[["render",Y]]);var ee=J,te={components:{Map:L["default"],AGVSelector:N.Z,View:$.G7x,Hide:$.caK,player:ee},computed:{agvNameList(){return R.sn.getters.AGVNameList},map_station_data(){return W.p.getters.MapStations}},data(){return{activeTab:0,tableData:[{task_id:"",start_time:"2023-08-03 12:00:00",end_time:"2023-08-03 12:10:00",duration:600,corrdinations:[[0,0],[-1.2,2.2],[-1.3,2.3],[-1.4,3]]}],agvname:"AGV_001",timePick:{start_time:"2023-08-03 12:00:00",end_time:"2023-08-04 12:00:00"},timePick_TrajPlayer:{start_time:"2023-08-03 12:00:00",end_time:"2023-08-04 12:00:00"},conditions:{taskID:""},locus_settings:{color:"red",width:7},showing_row_data:{},loading:!1,locus_painting:!1,trajPlayDataStore:[{TaskName:"",AGVName:"",Coordinations:[{Time:"",X:0,Y:0}]}],trajPlayWindowDatas:[{TaskName:"",AGVName:"",Time:"",Coordinations:[{Time:"",X:0,Y:0}]}],trajPlayTimeOffset:[0,0],totalSecOfTrajRePlay:0,debunceTimeout:null,recordPlayStartTimeMoment:H()(),recordPlayEndTimeMoment:H()(),taskColors:{},menuContainerWidth:820,menuContainerResize:!1,menuContainerResizeStartX:0,menuContainerResizeStartY:0,menuContainerResizeStartWidth:0,menuContainerResizeStartHeight:0,showAllTracks:!0,isIndeterminate:!1,playInterval:void 0,isPlayPause:!1}},methods:{handleTabChange(e,t){1!=e&&this.$refs.player&&(this.$refs.player.stop(),clearInterval(this.playInterval))},handleShowAllChange(e){this.isIndeterminate=!1,this.trajPlayWindowDatas.forEach((t=>{t.isShowing=e,t.isShowing?this.$refs.map.ShowLocusByID(t.TaskName):this.$refs.map.HideLocusByID(t.TaskName)}))},startResize(e){this.menuContainerResize=!0,this.menuContainerResizeStartX=e.clientX,this.menuContainerResizeStartY=e.clientY,this.menuContainerResizeStartWidth=this.$refs.menuContainer.clientWidth,this.menuContainerResizeStartHeight=this.$refs.menuContainer.clientHeight},async handleTaskNameQuery(e,t){this.loading=!0,this.$refs.map?.ClearLocus(),setTimeout((async()=>{this.timePick.end_time=Date.now()+864e5,this.tableData=[],this.conditions.taskID=e,this.agvname=t,await this.HandleSearchBtnClicked();const a=()=>{!this.loading&&this.tableData.length>0?this.ShowLocusHandler(this.tableData[0]):this.loading&&setTimeout(a,100)};a()}),400)},saveMapImage(){this.$refs.map.saveMapImage(`AGV_Locus_Map_${this.agvname}_${this.showing_row_data.task_id}_${Date.now()}.png`)},SetDefaultTimeInterval(){this.timePick_TrajPlayer.end_time=H()(Date.now()).format("YYYY/MM/DD HH:mm:ss"),this.timePick_TrajPlayer.start_time=H()(Date.now()).add(-1,"days").format("YYYY/MM/DD HH:mm:ss")},GetNo(e){return this.tableData.indexOf(e)+1},async ShowLocusHandler(e){try{this.locus_painting=!0,setTimeout((async()=>{if(void 0==e.corrdinations||0==e.corrdinations.length){var t=await(0,G.c6)(e.task_id);t&&(e.corrdinations=t.coordinations.map((e=>[e.X,e.Y])),this.showing_row_data=e)}try{this.$refs.map.ClearLocus(),e.corrdinations.length>0&&this.$refs.map.ShowLocus(e.corrdinations,this.locus_settings.color,this.locus_settings.width)}catch(a){this.$swal.fire({text:a.message,title:"Something Wrong...",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}this.locus_painting=!1}),300)}catch(t){this.$swal.fire({text:t.response.data,title:"後端服務異常",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},FormatTime(e){return H()(e).format("YYYY/MM/DD HH:mm:ss")},FormatSliderToolTip(e){try{return H()(this.timePick_TrajPlayer.start_time).add(e,"second").format("YYYY/MM/DD HH:mm:ss")}catch(t){return"error"}},HandleLocusSettingChange(){this.SaveLocusSettingsToLocalStroage();try{this.$refs.map.ShowLocus(this.showing_row_data.corrdinations,this.locus_settings.color,this.locus_settings.width)}catch(e){console.log(e)}},async HandleSearchTrajOnlyWithTimeRangeBtnClicked(){this.$refs.player.stop(),clearInterval(this.playInterval),this.trajPlayWindowDatas=[];var e=H()(this.timePick_TrajPlayer.start_time),t=e.format("YYYY/MM/DD HH:mm:ss"),a=H()(this.timePick_TrajPlayer.end_time),i=a.format("YYYY/MM/DD HH:mm:ss");if(this.trajPlayTimeOffset=[0,0],this.totalSecOfTrajRePlay=a.diff(e)/1e3,this.trajPlayDataStore=await(0,G.i1)(t,i),this.trajPlayDataStore&&this.trajPlayDataStore.length>0){const t=this.trajPlayDataStore[0];if(t.Coordinations&&t.Coordinations.length>0){const a=H()(t.Coordinations[0].Time);this.trajPlayTimeOffset[0]=a.diff(e)/1e3,this.trajPlayTimeOffset[1]=this.totalSecOfTrajRePlay,console.log("First timestamp:",a.format("YYYY/MM/DD HH:mm:ss")),setTimeout((()=>{this.HandleRecordPlaySliderChanged()}),500)}}},ToggleLocus(e){e.isShowing=!e.isShowing,e.isShowing?this.$refs.map.ShowLocusByID(e.TaskName):this.$refs.map.HideLocusByID(e.TaskName)},HandleRecordPlaySliderChanged(){this.debunceTimeout&&clearTimeout(this.debunceTimeout),this.debunceTimeout=setTimeout((()=>{this.ShowLocusByTimeOffset()}),100)},ShowLocusByTimeOffset(){var e=H()(this.timePick_TrajPlayer.start_time);this.recordPlayStartTimeMoment=e.clone(),this.recordPlayStartTimeMoment.add(this.trajPlayTimeOffset[0],"second"),this.recordPlayEndTimeMoment=e.clone(),this.recordPlayEndTimeMoment.add(this.trajPlayTimeOffset[1],"second"),this.trajPlayWindowDatas=this.trajPlayDataStore.filter((e=>e.Coordinations.some((e=>H()(e.Time)>=this.recordPlayStartTimeMoment&&H()(e.Time)<=this.recordPlayEndTimeMoment)))).map((e=>({TaskName:e.TaskName,AGVName:e.AGVName,Time:e.Coordinations.filter((e=>H()(e.Time)>=this.recordPlayStartTimeMoment&&H()(e.Time)<=this.recordPlayEndTimeMoment))[0].Time,Coordinations:e.Coordinations.filter((e=>H()(e.Time)>=this.recordPlayStartTimeMoment&&H()(e.Time)<=this.recordPlayEndTimeMoment)).map((e=>[e.X,e.Y])),isShowing:!0}))),this.trajPlayWindowDatas.sort(((e,t)=>H()(e.Time).valueOf()-H()(t.Time).valueOf())),this.$refs.map.ClearLocus(),this.taskColors||(this.taskColors={}),this.trajPlayWindowDatas.forEach((e=>{if(e.Coordinations.length>0){let t=this.taskColors[e.TaskName];t||(t="#"+Math.floor(16777215*Math.random()).toString(16),this.taskColors[e.TaskName]=t),this.$refs.map.ShowLocus(e.Coordinations,t,this.locus_settings.width,t,e.TaskName)}}))},async HandleSearchBtnClicked(){if(this.SaveLocusSettingsToLocalStroage(),""!=this.agvname){var e=H()(this.timePick.start_time).format("YYYY/MM/DD HH:mm:ss"),t=H()(this.timePick.end_time).format("YYYY/MM/DD HH:mm:ss"),a=[];this.$refs.map.ClearLocus(),this.loading=!0,setTimeout((async()=>{a=await(0,G.tQ)(e,t,this.agvname,this.conditions.taskID),this.tableData=a.sort(((e,t)=>new Date(t.RecieveTime)-new Date(e.RecieveTime))).map((e=>({task_id:e.TaskName,agv_name:e.DesignatedAGVName,start_time:e.RecieveTime,end_time:e.FinishTime,duration:0,state:e.StateName,from_station:this.GetStationName(e.From_Station_Tag),to_station:this.GetStationName(e.To_Station_Tag),corrdinations:void 0}))),this.loading=!1}),200)}else this.$swal.fire({text:"",title:"請選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},GetStationName(e){const t=Object.values(W.p.state.MapData.Points),a=t.find((t=>t.TagNumber==e));return a&&a.Graph?a.Graph.Display:""},SaveLocusSettingsToLocalStroage(){localStorage.setItem("locus",JSON.stringify({locus_paint:this.locus_settings,time:this.timePick}))},ReloadLocusSettingsFromLocalStorage(){var e=localStorage.getItem("locus");if(e){var t=JSON.parse(e);t.locus_paint&&(this.locus_settings=t.locus_paint),t.time?this.timePick=t.time:this.timePick.start_time=this.timePick.end_time=H()(Date.now()).format("YYYY-MM-DD HH:mm:ss")}},CalculatTimeSpend(e){return H()(e.end_time).unix()-H()(e.start_time).unix()},HandlePlayerPlay(){this.playInterval=setInterval((()=>{this.trajPlayTimeOffset[1]=this.trajPlayTimeOffset[1]+1,console.log("play",this.trajPlayTimeOffset),this.ShowLocusByTimeOffset(),this.trajPlayTimeOffset[1]>=this.totalSecOfTrajRePlay&&(clearInterval(this.playInterval),this.$refs.player.stop())}),100),this.isPlayPause=!1},HandlePlayerStop(){clearInterval(this.playInterval),this.trajPlayTimeOffset[1]=this.trajPlayTimeOffset[0]+1,this.isPlayPause=!1},HandlePlayerPause(){this.isPlayPause=!0,clearInterval(this.playInterval)},HandlePlayerSkipStart(){this.isPlayPause=!1},HandlePlayerSkipEnd(){this.isPlayPause=!1},HandlePlayFromThisTime(e){this.trajPlayTimeOffset[0]=H()(e.Time).diff(H()(this.timePick_TrajPlayer.start_time))/1e3,this.trajPlayTimeOffset[1]=this.trajPlayTimeOffset[0]+1,this.$refs.player.stop(),this.$refs.player.play()}},mounted(){this.SetDefaultTimeInterval(),this.ReloadLocusSettingsFromLocalStorage(),this.$route.query.taskName&&this.handleTaskNameQuery(this.$route.query.taskName,this.$route.query.agvName)},watch:{"$route.query":{handler(e){e.taskName&&this.handleTaskNameQuery(e.taskName,e.agvName)},deep:!0},$route(e,t){e.path!==t.path&&this.$refs.map.HiddenAgvLayer()}}};const ae=(0,X.Z)(te,[["render",O],["__scopeId","data-v-6a321bfe"]]);var ie=ae},79888:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return P}});var i=a(66252),s=a(3577),n=a(49963);const o={class:"alarm-query"},l={class:"query-options bg-light d-flex border-bottom w-100 py-2"},r=(0,i._)("option",null,"ALL",-1),d=(0,i._)("option",{class:"bg-danger text-light"},"Alarm",-1),c=(0,i._)("option",{class:"bg-warning text-light"},"Warning",-1),u=[r,d,c],m=(0,i._)("option",null,"ALL",-1),h=["onClick"],p={key:0},g=["onClick"],_={class:"w-100"},w={class:"d-flex flex-row justify-content-center fixed-bottom py-4"},f={class:"mx-3 py-2"},y={style:{"font-weight":"bold","font-size":"large"}},v={style:{position:"absolute",height:"100vh",width:"100vw",overflow:"hidden"}},S=["src"];function b(e,t,a,r,d,c){const b=(0,i.up)("b-button"),C=(0,i.up)("el-table-column"),k=(0,i.up)("el-tag"),T=(0,i.up)("el-tooltip"),D=(0,i.up)("el-table"),V=(0,i.up)("b-pagination"),A=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",l,[(0,i._)("label",null,(0,s.zw)(e.$t("Search.Start_Time")),1),(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>d.start_time=e),prop:"Start Time"},null,512),[[n.nr,d.start_time]]),(0,i._)("label",null,(0,s.zw)(e.$t("Search.End_Time")),1),(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>d.end_time=e),prop:"End Time"},null,512),[[n.nr,d.end_time]]),(0,i._)("label",null,(0,s.zw)(e.$t("AlarmTable.Alarm_Type")),1),(0,i.wy)((0,i._)("select",{class:(0,s.C_)("ALL"==d.AlarmTypeSelected?"":"Alarm"==d.AlarmTypeSelected?"bg-danger text-light":"bg-warning text-light"),prop:"EQ Name","onUpdate:modelValue":t[2]||(t[2]=e=>d.AlarmTypeSelected=e)},u,2),[[n.bM,d.AlarmTypeSelected]]),(0,i._)("label",null,(0,s.zw)(e.$t("AlarmTable.EQ_Name")),1),(0,i.wy)((0,i._)("select",{prop:"EQ Name","onUpdate:modelValue":t[3]||(t[3]=e=>d.AGVSelected=e)},[m,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(c.AgvNameList,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e},(0,s.zw)(e),1)))),128))],512),[[n.bM,d.AGVSelected]]),(0,i._)("label",null,(0,s.zw)(e.$t("AlarmTable.TaskName")),1),(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>d.TaskName=e),placeholder:"ALL",size:"20"},null,512),[[n.nr,d.TaskName]]),(0,i._)("label",null,(0,s.zw)(e.$t("AlarmTable.FailureReason")),1),(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>d.Alarm_description=e),placeholder:"ALL",size:"20"},null,512),[[n.nr,d.Alarm_description]]),(0,i.Wm)(b,{onClick:t[6]||(t[6]=e=>c.QueryAlarm()),QueryAlarm:c.QueryAlarm,class:"Select-Query",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("Search.Search")),1)])),_:1},8,["QueryAlarm"]),(0,i.Wm)(b,{onClick:t[7]||(t[7]=e=>c.SaveTocsv()),SaveTocsv:c.SaveTocsv,class:"SaveTocsv mx-2",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("Search.Output_csv_file")),1)])),_:1},8,["SaveTocsv"])]),(0,i._)("div",null,[(0,i.Wm)(D,{border:"",data:d.alarms,"empty-text":"No Alarms","row-class-name":c.row_state_class_name,size:"small",style:{width:"100%",height:"770px","font-weight":"bold"},"aria-current":"currentpage",id:"alarmtable"},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{label:e.$t("AlarmTable.Occur_Time"),prop:"Time",width:"140"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(c.formatTime(e.row.Time)),1)])),_:1},8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.EQ_Name"),prop:"Equipment_Name",width:"180",align:"center"},null,8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.Alarm_code"),prop:"AlarmCode",width:"60",align:"center"},null,8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.Alarm_description"),prop:"Description_En","min-width":"320"},{default:(0,i.w5)((e=>[(0,i._)("div",null,(0,s.zw)(e.row.Description_En)+"("+(0,s.zw)(e.row.Description_Zh)+")",1)])),_:1},8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.Alarm_Type"),prop:"Level",width:"100",align:"center"},{default:(0,i.w5)((e=>[(0,i.Wm)(k,{style:{width:"80px"},effect:"dark",type:1==e.row.Level?"danger":"warning"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(1==e.row.Level?"Alarm":"Warning"),1)])),_:2},1032,["type"])])),_:1},8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.TaskName"),prop:"Task_Name",width:"280"},{default:(0,i.w5)((t=>[(0,i._)("div",null,[(0,i.Uk)((0,s.zw)(t.row.Task_Name)+" ",1),(0,i.Wm)(T,{placement:"top-start",content:e.$t("Rack.copy")},{default:(0,i.w5)((()=>[""!=t.row.Task_Name?((0,i.wg)(),(0,i.iD)("i",{key:0,onClick:e=>c.CopyText(t.row.Task_Name),class:"copy-button copy-icon bi bi-clipboard"},null,8,h)):(0,i.kq)("",!0)])),_:2},1032,["content"])])])),_:1},8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.Occur_Tag"),prop:"OccurLocation",width:"120",align:"center"},null,8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.Solution"),prop:"TrobleShootingMethod",width:"320",align:"center"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[""==e.row.TrobleShootingReference?((0,i.wg)(),(0,i.iD)("span",p,(0,s.zw)(e.row.TrobleShootingMethod),1)):((0,i.wg)(),(0,i.iD)("a",{key:1,class:"cursor-pointer",onClick:()=>{d.selectedTroubleShootingDocument=e.row.TrobleShootingReference,d.showTroubleShootingDocument=!0}}," 📕 "+(0,s.zw)(e.row.TrobleShootingMethod),9,g))])])),_:1},8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.Duration"),prop:"Duration",width:"90",align:"center"},null,8,["label"]),(0,i.Wm)(C,{label:e.$t("AlarmTable.Clear_OP"),prop:"ResetAalrmMemberName","min-width":"120"},null,8,["label"]),c.isDevLogin?((0,i.wg)(),(0,i.j4)(C,{key:0,"min-width":"120",label:"Action"},{default:(0,i.w5)((e=>[(0,i._)("div",_,[(0,i.Wm)(b,{variant:"danger",onClick:t=>c.DeleteAlarmHandle(e.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("Delete")])),_:2},1032,["onClick"])])])),_:1})):(0,i.kq)("",!0)])),_:1},8,["data","row-class-name"]),(0,i._)("div",w,[(0,i.Wm)(V,{"per-page":d.per_page_num,"total-rows":d.rows,"aria-controls":"alarmtable",class:"pagination justify-content-center",modelValue:d.currentpage,"onUpdate:modelValue":t[8]||(t[8]=e=>d.currentpage=e),onClick:c.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,i._)("div",f,[(0,i.Uk)((0,s.zw)(e.$t("Search.Total_First"))+" ",1),(0,i._)("span",y,(0,s.zw)(d.rows),1),(0,i.Uk)(" "+(0,s.zw)(e.$t("Search.Total_Last")),1)])])]),(0,i.Wm)(A,{fullscreen:"",overflow:!1,modelValue:d.showTroubleShootingDocument,"onUpdate:modelValue":t[9]||(t[9]=e=>d.showTroubleShootingDocument=e),draggable:"",title:d.selectedTroubleShootingDocument},{default:(0,i.w5)((()=>[(0,i._)("div",v,[(0,i._)("iframe",{src:c.CurrentSelectedTroubleShootingFileUrl,width:"100%",height:"100%",style:{border:"none"},allow:"autoplay"},null,8,S)])])),_:1},8,["modelValue","title"])])}var C=a(91648),k=a(30381),T=a.n(k),D=a(93867),V=a(29776),A=a(663),I=a(25044),x={data(){return{start_time:"2023-06-01 00:00:00",end_time:"2023-06-03 00:00:00",AGVSelected:"ALL",AlarmTypeSelected:"ALL",TaskName:"",alarms:[],per_page_num:19,rows:1,currentpage:1,loading:!1,Alarm_description:"",showTroubleShootingDocument:!1,selectedTroubleShootingDocument:""}},computed:{AgvNameList(){return I.sn.getters.AGVNameList},isDevLogin(){return I.HP.getters.IsDeveloperLogining},CurrentSelectedTroubleShootingFileUrl(){return A.Z.backend_host+"/Resources"+this.selectedTroubleShootingDocument}},mounted(){const e=new Date;this.end_time=e.toISOString().substring(0,10)+" 23:59:59",this.start_time=T()(this.end_time,"YYYY-MM-DD HH:mm:ss").subtract(7,"days").format("YYYY-MM-DD HH:mm:ss"),setTimeout((()=>{this.QueryAlarm()}),500)},methods:{formatTime(e){return T()(e).format("yyyy-MM-DD HH:mm:ss")},onmessage(e){this.alarms=JSON.parse(e.data)},row_state_class_name({row:e,rowIndex:t}){if(e.rowIndex<0)return"";var a=this.alarms[t].Level;return 1==a?"alarm-row":"warning-row"},async QueryAlarm(){this.loading=!0,this.alarms=[],this.rows=1,this.currentpage=1,this.payload=2,setTimeout((()=>{(0,C.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.AlarmTypeSelected,this.Alarm_description).then((e=>{this.alarms=e.alarms,this.rows=e.count,this.currentpage=e.currentpage})).then((e=>{})).catch((e=>{this.loading=!1,D.Z.Danger("警報查詢失敗後端服務異常")}))}),300)},async SaveTocsv(){await(0,C.lF)(this.start_time,this.end_time,this.AGVSelected,this.TaskName),D.Z.Primary("檔案儲存成功")},PageChnageHandle(e){(0,C.__)(this.currentpage,this.start_time,this.end_time,this.AGVSelected,this.TaskName,this.AlarmTypeSelected,this.Alarm_description).then((e=>{this.alarms=e.alarms})).catch((e=>{D.Z.Danger("警報查詢失敗後端服務異常")}))},CopyText(e){(0,V.O)(e)},getFullFilePath(e){const t=A.Z.backend_host;return t+"/TrobleShootingFiles/"+e},async DeleteAlarmHandle(e){await(0,C.ce)(e.Time),this.QueryAlarm()}}},E=a(83744);const M=(0,E.Z)(x,[["render",b]]);var P=M},53806:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var i=a(66252),s=a(3577);const n={class:"avalibity-query d-flex flex-row"},o={class:"options text-start h-100 p-3 bg-light border"},l={class:"chart-display h-100 w-100 d-flex justify-content-center"},r={class:"w-100 m-1"};function d(e,t,a,d,c,u){const m=(0,i.up)("AGVSelector"),h=(0,i.up)("el-form-item"),p=(0,i.up)("el-date-picker"),g=(0,i.up)("b-button"),_=(0,i.up)("el-form"),w=(0,i.up)("AvailabilityPieChart"),f=(0,i.up)("el-tab-pane"),y=(0,i.up)("MeanTimeChart"),v=(0,i.up)("el-tabs"),S=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("div",o,[(0,i.Wm)(_,{model:c.options},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{label:e.$t("AvalibilityQuery.AGVName")},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{modelValue:c.options.AGVName,"onUpdate:modelValue":t[0]||(t[0]=e=>c.options.AGVName=e)},null,8,["modelValue"])])),_:1},8,["label"]),(0,i.Wm)(h,{label:e.$t("AvalibilityQuery.StartDate")},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{"value-format":"YYYY-MM-DD",modelValue:c.options.StartDate,"onUpdate:modelValue":t[1]||(t[1]=e=>c.options.StartDate=e)},null,8,["modelValue"])])),_:1},8,["label"]),(0,i.Wm)(h,{label:e.$t("AvalibilityQuery.EndDate")},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{"value-format":"YYYY-MM-DD",modelValue:c.options.EndDate,"onUpdate:modelValue":t[2]||(t[2]=e=>c.options.EndDate=e)},null,8,["modelValue"])])),_:1},8,["label"]),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{onClick:u.QueryData,class:"w-100",variant:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("AvalibilityQuery.Query")),1)])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",r,[(0,i.Wm)(v,{type:"border-card","tab-position":"top",lazy:"",class:"demo-tabs"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{label:e.$t("AvalibilityQuery.PieChart")},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"",ref:"piechart"},null,512)])),_:1},8,["label"]),(0,i.Wm)(f,{label:e.$t("AvalibilityQuery.StraightChart")},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{ref:"barchart"},null,512)])),_:1},8,["label"]),(0,i.Wm)(f,{label:e.$t("AvalibilityQuery.MTBF/MTTR")},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{ref:"MTChart",id:"mtbf-chart",title:""},null,512)])),_:1},8,["label"])])),_:1})])])),[[S,c.loading]])])}var c=a(43125),u=a(764),m=a(51455),h=a(53658),p=a(25044),g=a(30381),_=a.n(g),w={components:{AvailabilityPieChart:m.Z,MeanTimeChart:h.Z,AGVSelector:u.Z},data(){return{loading:!1,chart_type:"pie",options:{AGVName:"AGV_001",StartDate:"",EndDate:""},query_data:{total:[],days:{dates:[],idle:[],run:[],down:[],charge:[]},BarchartMTTR:{dates:[],time:[]},BarchartMTBF:{dates:[],time:[]},BarchartMissTag:{dates:[],count:[]}}}},computed:{agvNameList(){return p.sn.getters.AGVNameList}},mounted(){this.options.StartDate=_()(Date.now()).add(-7,"days").format("YYYY-MM-DD"),this.options.EndDate=_()(Date.now()).format("YYYY-MM-DD")},methods:{async QueryData(){this.loading=!0,this.query_data=await(0,c.A)(this.options.AGVName,this.options.StartDate,this.options.EndDate),this.$refs["barchart"].updateStackBarChart(this.query_data.days),this.$refs["piechart"].updateChart(this.query_data.total),this.$refs.MTChart.RenderChartWithTimeSeriesData(this.CreateMTData(this.query_data)),setTimeout((()=>{this.loading=!1}),400)},CreateMTData(e){var t=e.BarchartMTTR,a=Object.keys(t).map((e=>({x:e,y:t[e]}))),i=e.BarchartMTBF,s=Object.keys(i).map((e=>({x:e,y:i[e]})));return[{name:"MTTR",data:a},{name:"MTBF",data:s}]},HandleChartTypeChanged(){}}},f=a(83744);const y=(0,f.Z)(w,[["render",d],["__scopeId","data-v-8eb7f8a2"]]);var v=y},90259:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return te}});var i=a(66252);const s={class:"d-flex flex-column"},n={class:"w-100 m-1 border rounded p-2"};function o(e,t,a,o,l,r){const d=(0,i.up)("CommonOptions"),c=(0,i.up)("b-pagination"),u=(0,i.up)("el-table-column"),m=(0,i.up)("el-table"),h=(0,i.up)("trendChart");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(d,{onOnQueryBtnClick:r.HandleQueryBtnClick},null,8,["onOnQueryBtnClick"]),(0,i._)("div",n,[(0,i.Wm)(c,{"per-page":l.QueryResult.DataNumPerPage,"total-rows":l.QueryResult.TotalDataNum,"aria-controls":"measure_result_table",class:"pagination justify-content-start",modelValue:l.QueryResult.Page,"onUpdate:modelValue":t[0]||(t[0]=e=>l.QueryResult.Page=e),onClick:r.PageChnageHandle},null,8,["per-page","total-rows","modelValue","onClick"]),(0,i.Wm)(m,{border:"",data:l.QueryResult.dataList,style:{width:"100%",height:"500px"},id:"measure_result_table","empty-text":"尚無數據資料"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{prop:"TaskName",label:e.$t("InstrumentMeasureQuery.TaskID"),fixed:"left",width:"210"},null,8,["label"]),(0,i.Wm)(u,{prop:"AGVName",label:e.$t("InstrumentMeasureQuery.AGVName"),fixed:"left",width:"90"},null,8,["label"]),(0,i.Wm)(u,{prop:"BayName",label:e.$t("InstrumentMeasureQuery.BayName"),fixed:"left",width:"90"},null,8,["label"]),(0,i.Wm)(u,{prop:"location",label:e.$t("InstrumentMeasureQuery.MeasurePoint"),fixed:"left"},null,8,["label"]),(0,i.Wm)(u,{formatter:r.TimeFormatter,prop:"StartTime",label:e.$t("InstrumentMeasureQuery.MeasureStartTime"),fixed:"left",width:"180"},null,8,["formatter","label"]),(0,i.Wm)(u,{formatter:r.ResultFormatter,prop:"result",label:e.$t("InstrumentMeasureQuery.MeasureResult"),fixed:"left"},null,8,["formatter","label"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"illuminance",label:e.$t("InstrumentMeasureQuery.Lux")},null,8,["formatter","label"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"decibel",label:e.$t("InstrumentMeasureQuery.dB")},null,8,["formatter","label"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"temperature",label:e.$t("InstrumentMeasureQuery.Temperature")},null,8,["formatter","label"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"humudity",label:e.$t("InstrumentMeasureQuery.Moisture")},null,8,["formatter","label"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"IPA",label:"IPA (異丙醇)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"Acetone",label:"Acetone (丙酮)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"TVOC",label:"TVOC (Non-Target)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"PID",label:"PID"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"partical_03um",label:"微塵粒子(0.3μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"partical_05um",label:"微塵粒子(0.5μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"partical_10um",label:"微塵粒子(1.0μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"partical_30um",label:"微塵粒子(3.0μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"partical_50um",label:"微塵粒子(5.0μm)"},null,8,["formatter"]),(0,i.Wm)(u,{formatter:r.ValFormatter,prop:"partical_100um",label:"微塵粒子(10.0μm)",fixed:"right"},null,8,["formatter"])])),_:1},8,["data"])]),(0,i.Wm)(h,{class:"flex-fill"})])}var l=a(3577);const r=e=>((0,i.dD)("data-v-db438aa8"),e=e(),(0,i.Cn)(),e),d={class:"common-options"},c={class:"options d-flex"},u={class:"block"},m={class:"title"},h={class:"control"},p={class:"block"},g={class:"title"},_={class:"control"},w={class:"block"},f=r((()=>(0,i._)("div",{class:"title"},"AGV",-1))),y={class:"control"},v={class:"block"},S={class:"title"},b={class:"control"},C={class:"block"},k=r((()=>(0,i._)("div",{class:"title"},null,-1))),T={class:"my-4"};function D(e,t,a,s,n,o){const r=(0,i.up)("el-date-picker"),D=(0,i.up)("el-option"),V=(0,i.up)("el-select"),A=(0,i.up)("b-button");return(0,i.wg)(),(0,i.iD)("div",d,[(0,i._)("div",c,[(0,i._)("div",u,[(0,i._)("div",m,(0,l.zw)(e.$t("AGVLocus.StartTime")),1),(0,i._)("div",h,[(0,i.Wm)(r,{modelValue:n.OPTIONS.StartTimeStr,"onUpdate:modelValue":t[0]||(t[0]=e=>n.OPTIONS.StartTimeStr=e),type:"date",placeholder:e.$t("AGVLocus.SelectStartDate")},null,8,["modelValue","placeholder"])])]),(0,i._)("div",p,[(0,i._)("div",g,(0,l.zw)(e.$t("AGVLocus.EndTime")),1),(0,i._)("div",_,[(0,i.Wm)(r,{modelValue:n.OPTIONS.EndTimeStr,"onUpdate:modelValue":t[1]||(t[1]=e=>n.OPTIONS.EndTimeStr=e),type:"date",placeholder:e.$t("AGVLocus.SelectEndDate")},null,8,["modelValue","placeholder"])])]),(0,i._)("div",w,[f,(0,i._)("div",y,[(0,i.Wm)(V,{modelValue:n.OPTIONS.AGVName,"onUpdate:modelValue":t[2]||(t[2]=e=>n.OPTIONS.AGVName=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.AGVNameList,(e=>((0,i.wg)(),(0,i.j4)(D,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,i._)("div",v,[(0,i._)("div",S,(0,l.zw)(e.$t("InstrumentMeasureQuery.MeasureResult")),1),(0,i._)("div",b,[(0,i.Wm)(V,{modelValue:n.OPTIONS.Result,"onUpdate:modelValue":t[3]||(t[3]=e=>n.OPTIONS.Result=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.Results,(e=>((0,i.wg)(),(0,i.j4)(D,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,i._)("div",C,[k,(0,i._)("div",T,[(0,i.Wm)(A,{onClick:o.HandleQueryBtnClick,variant:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.$t("AGVLocus.Search")),1)])),_:1},8,["onClick"])])])])])}a(57658);var V=a(19578),A=a(25044),I={components:{},props:{Results:{type:Array,default(){return[{value:2,label:"ALL"},{value:0,label:"成功"},{value:1,label:"失敗"}]}}},data(){return{OPTIONS:new V.Z}},computed:{AGVNameList(){var e=["ALL"];return A.sn.getters.AGVNameList.forEach((t=>{e.push(t)})),e}},watch:{},methods:{HandleQueryBtnClick(){this.OPTIONS.Page=1,this.$emit("OnQueryBtnClick",this.OPTIONS)}},mounted(){}},x=a(83744);const E=(0,x.Z)(I,[["render",D],["__scopeId","data-v-db438aa8"]]);var M=E,P=a(3567),O=a(30381),N=a.n(O);const L=e=>((0,i.dD)("data-v-46f5cd8a"),e=e(),(0,i.Cn)(),e),G={class:"ins-mes-trend-chart border rounded mx-1 p-2"},R=L((()=>(0,i._)("h5",null,"Trend Chart",-1))),W={class:"content border d-flex"},U={class:"qu-options border"},H={class:"flex-fill chart-container"};function $(e,t,a,s,n,o){const r=(0,i.up)("el-option"),d=(0,i.up)("el-select"),c=(0,i.up)("el-form-item"),u=(0,i.up)("el-date-picker"),m=(0,i.up)("el-form"),h=(0,i.up)("b-button"),p=(0,i.up)("InsMesDisplayChart");return(0,i.wg)(),(0,i.iD)("div",G,[R,(0,i._)("div",W,[(0,i._)("div",U,[(0,i.Wm)(m,{"label-position":"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{label:"Bay"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{onChange:o.HandleBayNameSelected,modelValue:n.selected_bayname,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selected_bayname=e),size:"large"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.baynames,(e=>((0,i.wg)(),(0,i.j4)(r,{value:e,key:e,label:e},null,8,["value","label"])))),128))])),_:1},8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(c,{label:"點位(Tag)"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:n.selected_tag,"onUpdate:modelValue":t[1]||(t[1]=e=>n.selected_tag=e),size:"large"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.tagsOfBay,(e=>((0,i.wg)(),(0,i.j4)(r,{value:e,key:e,label:e},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(c,{label:e.$t("InsMesTrendChart.MeasureItem")},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:n.selected_mes_item,"onUpdate:modelValue":t[2]||(t[2]=e=>n.selected_mes_item=e),size:"large"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.measureItems,((e,t)=>((0,i.wg)(),(0,i.j4)(r,{value:t,key:t,label:e},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),(0,i.Wm)(c,{label:e.$t("AGVLocus.SelectStartDate")},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:n.StartTimeStr,"onUpdate:modelValue":t[3]||(t[3]=e=>n.StartTimeStr=e),type:"date",placeholder:e.$t("InsMesTrendChart.SelectStartDate")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,i.Wm)(c,{label:e.$t("AGVLocus.SelectEndDate")},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:n.EndTimeStr,"onUpdate:modelValue":t[4]||(t[4]=e=>n.EndTimeStr=e),type:"date",placeholder:e.$t("InsMesTrendChart.SelectEndDate")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),(0,i.Wm)(h,{class:"w-100",variant:"primary",onClick:o.HandleQueryButtonClick},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.$t("InsMesTrendChart.Search")),1)])),_:1},8,["onClick"])]),(0,i._)("div",H,[(0,i.Wm)(p,{ref:"chart"},null,512)])])])}const F={class:"w-100 rounded"};function q(e,t,a,s,n,o){const l=(0,i.up)("apexchart"),r=(0,i.Q2)("loading");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",F,[(0,i.Wm)(l,{ref:"ins_chart",height:o.chartHeight,options:n.chart_datas.chartOptions,series:n.chart_datas.series},null,8,["height","options","series"])])),[[r,n.loading]])}var B=a(96486),z=a.n(B),j={components:{},props:{id:{type:String,default:"a"},title:{type:String,default:"title"}},computed:{chartHeight(){return.3*window.innerHeight+"px"}},data(){return{loading:!1,myChart:void 0,chart_datas:{series:[{name:"Desktops",data:[10,41]}],chartOptions:{chart:{type:"line",zoom:{enabled:!0},animations:{enabled:!0}},dataLabels:{enabled:!1},legend:{show:!0,position:"top"},title:{text:"電量",align:"center"},xaxis:{type:"datetime",tickAmount:3,labels:{format:"yy-MM-dd HH:mm:ss",style:{fontSize:"16px"}},title:{text:"時間",style:{fontSize:"16px"}},axisBorder:{show:!0}},yaxis:[{labels:{style:{fontSize:"16px"}},title:{text:"MTTR(小時)",style:{fontSize:"16px"}},axisBorder:{show:!0}}],tooltip:{enabled:!0}}}}},methods:{RenderChartWithTimeSeriesData(e){let t=JSON.parse(JSON.stringify(e));this.chart_datas.chartOptions.yaxis[0].title.text=e[0].name,this.$refs["ins_chart"].updateOptions(this.chart_datas.chartOptions),this.debounceChartUpdate(t)},debounceChartUpdate:z().debounce((function(e){this.$refs["ins_chart"].updateSeries(e)}),300)},mounted(){this.chart_datas.chartOptions.title.text=this.title,setTimeout((()=>{this.RenderChartWithTimeSeriesData([{name:"demo",data:[{x:"1111/11/11",y:23},{x:"1111/11/12",y:3},{x:"1111/11/13",y:213}]}])}),1e3)}};const Z=(0,x.Z)(j,[["render",q]]);var Q=Z,Y={components:{InsMesDisplayChart:Q},data(){return{measureItems:{},baynames:[],tagsOfBay:[],selected_mes_item:"",selected_bayname:"",selected_tag:-1,StartTimeStr:"",EndTimeStr:""}},methods:{async GetMeasureItemsFromServer(){this.measureItems=await(0,P.CX)()},async GetBayNamesFromServer(){this.baynames=await(0,P.Bj)()},async HandleBayNameSelected(){this.tagsOfBay=await(0,P.GZ)(this.selected_bayname)},async HandleQueryButtonClick(){var e=await(0,P.O1)({bayName:this.selected_bayname,tag:this.selected_tag,item:this.selected_mes_item,from:this.StartTimeStr,to:this.EndTimeStr}),t=[{name:this.measureItems[this.selected_mes_item],data:e.map((e=>({x:e.Time,y:e.Value})))}];console.log(t),this.$refs["chart"].RenderChartWithTimeSeriesData(t)}},mounted(){this.GetMeasureItemsFromServer(),this.GetBayNamesFromServer()}};const K=(0,x.Z)(Y,[["render",$],["__scopeId","data-v-46f5cd8a"]]);var X=K,J={components:{CommonOptions:M,trendChart:X},data(){return{QueryResult:{},Options:{}}},computed:{},watch:{},methods:{async HandleQueryBtnClick(e){this.Options=e,this.QueryResult=await(0,P.AE)(e)},ResultFormatter(e,t,a,i){return"done"==a?"成功":"失敗"},TimeFormatter(e,t,a,i){return N()(a).format("yyyy-MM-DD \r\n HH:mm:ss")},ValFormatter(e,t,a,i){return"-1"==a||"-1.0"==a?"NA":a},PageChnageHandle(){this.Options.Page=this.QueryResult.Page,this.HandleQueryBtnClick(this.Options)}},mounted(){}};const ee=(0,x.Z)(J,[["render",o]]);var te=ee},78075:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return V}});var i=a(66252),s=a(3577),n=a(49963);const o={class:"Task-query d-flex flex-column"},l={class:"Task-options bg-light d-flex border-bottom w-100 py-2"},r={class:"flex-grow-1 overflow-y-auto",style:{"padding-bottom":"80px"}},d=["onClick"],c=["onClick"],u={class:"text-danger"},m={class:"w-100"},h={class:"d-flex flex-row justify-content-center fixed-bottom",style:{"margin-bottom":"3px"}},p={class:"mx-3"},g={style:{"font-weight":"bold","font-size":"large"}};function _(e,t,a,_,w,f){const y=(0,i.up)("el-input"),v=(0,i.up)("el-option"),S=(0,i.up)("el-select"),b=(0,i.up)("b-button"),C=(0,i.up)("el-tooltip"),k=(0,i.up)("el-table-column"),T=(0,i.up)("el-tag"),D=(0,i.up)("el-table"),V=(0,i.up)("b-pagination"),A=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",l,[(0,i._)("label",null,(0,s.zw)(e.$t("Search.Start_Time")),1),(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>w.queryCondition.StartTime=e),prop:"Start Time"},null,512),[[n.nr,w.queryCondition.StartTime]]),(0,i._)("label",null,(0,s.zw)(e.$t("Search.End_Time")),1),(0,i.wy)((0,i._)("input",{type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>w.queryCondition.EndTime=e),prop:"End Time"},null,512),[[n.nr,w.queryCondition.EndTime]]),(0,i._)("label",null,(0,s.zw)(e.$t("TaskTable.TaskName")),1),(0,i.Wm)(y,{modelValue:w.queryCondition.TaskName,"onUpdate:modelValue":t[2]||(t[2]=e=>w.queryCondition.TaskName=e),placeholder:"ALL",style:{width:"220px"},clearable:"",onClear:t[3]||(t[3]=e=>f.TaskQuery())},null,8,["modelValue"]),(0,i._)("label",null,(0,s.zw)(e.$t("TaskTable.EQ_Name")),1),(0,i.Wm)(S,{prop:"EQ Name",modelValue:w.queryCondition.AgvName,"onUpdate:modelValue":t[4]||(t[4]=e=>w.queryCondition.AgvName=e),clearable:"",onClear:t[5]||(t[5]=e=>f.TaskQuery()),style:{width:"120px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{label:"ALL",value:""},{default:(0,i.w5)((()=>[(0,i.Uk)("ALL")])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.AgvNameList,(e=>((0,i.wg)(),(0,i.j4)(v,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,i._)("label",null,(0,s.zw)(e.$t("TaskTable.Action")),1),(0,i.Wm)(S,{prop:"EQ Name",modelValue:w.queryCondition.ActionType,"onUpdate:modelValue":t[6]||(t[6]=e=>w.queryCondition.ActionType=e),clearable:"",onClear:t[7]||(t[7]=e=>f.TaskQuery()),style:{width:"120px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{value:f.actionTypeList.Unknown,label:"ALL"},null,8,["value"]),(0,i.Wm)(v,{value:f.actionTypeList.None,label:e.$t("Search.Move")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.actionTypeList.Unload,label:e.$t("Search.Load")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.actionTypeList.Load,label:e.$t("Search.UnLoad")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.actionTypeList.Carry,label:e.$t("Search.Transfer")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.actionTypeList.Charge,label:e.$t("Search.Charge")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.actionTypeList.Measure,label:e.$t("Search.Measure")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.actionTypeList.ExchangeBattery,label:e.$t("Search.ExchangeBattrey")},null,8,["value","label"])])),_:1},8,["modelValue"]),(0,i._)("label",null,(0,s.zw)(e.$t("TaskTable.Final")),1),(0,i.Wm)(S,{modelValue:w.queryCondition.TaskResult,"onUpdate:modelValue":t[8]||(t[8]=e=>w.queryCondition.TaskResult=e),clearable:"",onClear:t[9]||(t[9]=e=>f.TaskQuery()),style:{width:"120px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{value:f.taskResultList.UNKNOWN,label:"ALL"},null,8,["value"]),(0,i.Wm)(v,{value:f.taskResultList.ACTION_FINISH,label:e.$t("Search.Completed")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.taskResultList.FAILURE,label:e.$t("Search.Fail")},null,8,["value","label"]),(0,i.Wm)(v,{value:f.taskResultList.CANCEL,label:e.$t("Search.Cancel")},null,8,["value","label"])])),_:1},8,["modelValue"]),(0,i._)("label",null,(0,s.zw)(e.$t("TaskTable.FailureReason")),1),(0,i.Wm)(y,{modelValue:w.queryCondition.Description,"onUpdate:modelValue":t[10]||(t[10]=e=>w.queryCondition.Description=e),placeholder:"",clearable:"",style:{width:"120px"},onClear:t[11]||(t[11]=e=>f.TaskQuery())},null,8,["modelValue"]),(0,i.Wm)(b,{onClick:t[12]||(t[12]=e=>f.TaskQuery()),TaskQuery:f.TaskQuery,class:"Select-Query",variant:"primary mx-1",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("Search.Search")),1)])),_:1},8,["TaskQuery"]),(0,i.Wm)(b,{onClick:t[13]||(t[13]=e=>f.SaveTocsv()),SaveTocsv:f.SaveTocsv,class:"SaveTocsv mx-2",variant:"primary",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("Search.Output_csv_file")),1)])),_:1},8,["SaveTocsv"]),(0,i.wy)((0,i.Wm)(b,{onClick:t[14]||(t[14]=e=>f.HandleExportToAutoRptFolder()),SaveTocsv:f.SaveTocsv,class:"SaveTocsv mx-2",variant:"danger",size:"sm",style:{float:"right"}},{default:(0,i.w5)((()=>[(0,i.Uk)("輸出至自動匯出目錄")])),_:1},8,["SaveTocsv"]),[[n.F8,f.isDevLogin]])]),(0,i._)("div",r,[(0,i.wy)(((0,i.wg)(),(0,i.j4)(D,{data:w.tasks,"empty-text":"No Tasks","row-class-name":"row_state_class_name",size:"small",style:{width:"100%","font-weight":"bold"},border:"",id:"Tasktable"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{label:e.$t("TaskTable.TaskName"),prop:"TaskName",width:"280","show-overflow-tooltip":""},{default:(0,i.w5)((t=>[(0,i._)("div",null,[(0,i.Uk)((0,s.zw)(t.row.TaskName)+" ",1),(0,i.Wm)(C,{placement:"top-start",content:e.$t("Rack.copy")},{default:(0,i.w5)((()=>[(0,i._)("i",{onClick:e=>f.CopyText(t.row.TaskName),class:"copy-button copy-icon bi bi-clipboard"},null,8,d)])),_:2},1032,["content"])])])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.RecievedTime"),prop:"RecieveTime",width:"160","show-overflow-tooltip":""},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(f.formatTime(e.row.RecieveTime)),1)])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.FinishTime"),prop:"FinishTime",width:"160","show-overflow-tooltip":""},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(f.formatTime(e.row.FinishTime)),1)])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Final"),prop:"StateName",width:"100",align:"center"},{default:(0,i.w5)((e=>[(0,i.Wm)(T,{effect:"dark",type:4==e.row.State?"success":6==e.row.State?"danger":"warning"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.StateName),1)])),_:2},1032,["type"])])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.AGV_Name"),prop:"DesignatedAGVName",width:"100",align:"center",filters:f.getAGVListFilter,"filter-method":f.filterAGVName},null,8,["label","filters","filter-method"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Action"),prop:"ActionName",width:"60",align:"center"},null,8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Source"),prop:"From_Station_Display",width:"120",align:"center","show-overflow-tooltip":""},null,8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Source_Slot"),prop:"From_Slot",width:"120",align:"center"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(-1==e.row.From_Slot?"-":e.row.From_Slot),1)])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Destine"),prop:"To_Station_Display",width:"120",align:"center","show-overflow-tooltip":""},null,8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Destine_Slot"),prop:"To_Slot",width:"120",align:"center"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(-1==e.row.To_Slot?"-":e.row.To_Slot),1)])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.CstID"),prop:"Carrier_ID",width:"140"},{default:(0,i.w5)((t=>[(0,i._)("div",null,[(0,i.Uk)((0,s.zw)("-1"==t.row.Carrier_ID?"":t.row.Carrier_ID)+" ",1),(0,i.Wm)(C,{placement:"top-start",content:e.$t("Rack.copy")},{default:(0,i.w5)((()=>["-1"!=t.row.Carrier_ID&&""!=t.row.Carrier_ID?((0,i.wg)(),(0,i.iD)("i",{key:0,onClick:e=>f.CopyText(t.row.Carrier_ID),class:"copy-button copy-icon bi bi-clipboard"},null,8,c)):(0,i.kq)("",!0)])),_:2},1032,["content"])])])),_:1},8,["label"]),(0,i.kq)("",!0),(0,i.Wm)(k,{label:e.$t("TaskTable.UnloadTime"),prop:"RecieveTime",width:"160"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(f.formatTime(e.row.UnloadTime)),1)])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.LoadTime"),prop:"RecieveTime",width:"160"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)(f.formatTime(e.row.LoadTime)),1)])),_:1},8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.StartLocation"),prop:"StartLocationDisplay",width:"160"},null,8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Dispatcher"),prop:"DispatcherName",width:"100"},null,8,["label"]),(0,i.Wm)(k,{label:e.$t("TaskTable.Fail_reason"),prop:"FailureReason","min-width":"220","show-overflow-tooltip":"",fixed:"right"},{default:(0,i.w5)((e=>[(0,i._)("div",u,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.row.FailureReason.split(","),(e=>((0,i.wg)(),(0,i.iD)("div",{key:e},(0,s.zw)(e),1)))),128))])])),_:1},8,["label"]),f.isDevLogin||f.isEngUserLogin?((0,i.wg)(),(0,i.j4)(k,{key:1,"min-width":f.isDevLogin?220:120,label:"Action",fixed:"right"},{default:(0,i.w5)((e=>[(0,i._)("div",m,[(0,i.Wm)(b,{class:"mx-1",variant:"primary",squared:"",onClick:t=>f.ShowLocus(e.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("軌跡")])),_:2},1032,["onClick"]),f.isDevLogin?((0,i.wg)(),(0,i.j4)(b,{key:0,variant:"danger",squared:"",onClick:t=>f.DeleteTaskHandle(e.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("Delete")])),_:2},1032,["onClick"])):(0,i.kq)("",!0)])])),_:1},8,["min-width"])):(0,i.kq)("",!0)])),_:1},8,["data"])),[[A,w.loading]]),(0,i._)("div",h,[(0,i.Wm)(V,{"per-page":w.per_page_num,"total-rows":w.rows,"aria-controls":"Tasktable",class:"pagination justify-content-center",modelValue:w.queryCondition.CurrentPage,"onUpdate:modelValue":t[15]||(t[15]=e=>w.queryCondition.CurrentPage=e),onClick:f.handlePageChange},null,8,["per-page","total-rows","modelValue","onClick"]),(0,i._)("div",p,[(0,i.Uk)((0,s.zw)(e.$t("Search.Total_First"))+" ",1),(0,i._)("span",g,(0,s.zw)(w.rows),1),(0,i._)("span",null,",成功:"+(0,s.zw)(w.completeNum)+",失敗:"+(0,s.zw)(w.failNum)+",取消:"+(0,s.zw)(w.cancelNum),1)])])])])}a(57658);var w=a(20840),f=a(25044),y=a(29776),v=a(30381),S=a.n(v),b=a(93867),C=a(84063),k={data(){return{start_time:"2023-06-01 00:00:00",end_time:"2023-06-30 00:00:00",AGVSelected:"ALL",ExecuteResultSelected:"ALL",ActionTypeSelected:"ALL",TaskName:"",Fail_reason:"",tasks:[],per_page_num:25,rows:0,currentpage:1,loading:!1,queryCondition:new C.i,completeNum:0,failNum:0,cancelNum:0}},computed:{AgvNameList(){return f.sn.getters.AGVNameList},isDevLogin(){return f.HP.getters.IsDeveloperLogining},isEngUserLogin(){return 1==f.HP.state.user.Role},taskResultList(){return C.i.TASK_RUN_STATUS},actionTypeList(){return C.i.ACTION_TYPE},getAGVListFilter(){const e=this.tasks.map((e=>e.DesignatedAGVName)),t=[...new Set(e)];return t.sort(),[...t.map((e=>({text:e,value:e})))]}},mounted(){const e=new Date;this.queryCondition.EndTime=e.toISOString().substring(0,10)+"T23:59:59",this.queryCondition.StartTime=S()(this.queryCondition.EndTime,"YYYY-MM-DD HH:mm:ss").subtract(7,"days").format("YYYY-MM-DDTHH:mm:ss"),setTimeout((()=>{this.TaskQuery()}),500)},methods:{formatTime(e){const t=S()(e).format("yyyy-MM-DD HH:mm:ss");return"0001-01-01 00:00:00"==t||"1900-01-01 00:00:00"==t?"":t},onmessage(e){this.tasks=JSON.parse(e.data)},async TaskQuery(e=!1){e||(this.loading=!0,this.tasks=[],this.rows=0,this.completeNum=0,this.failNum=0,this.cancelNum=0,this.queryCondition.CurrentPage=1),setTimeout((()=>{(0,w.AE)(this.queryCondition).then((t=>{this.tasks=t.tasks,this.rows=t.count,this.loading=!1,this.completeNum=t.CompleteNum,this.failNum=t.FailNum,this.cancelNum=t.CancelNum,e||(this.queryCondition.CurrentPage=1)})).catch((e=>{this.loading=!1,b.Z.Danger("警報查詢失敗後端服務異常")}))}),e?0:100)},async SaveTocsv(){(0,w.lF)(this.queryCondition.StartTime,this.queryCondition.EndTime,this.queryCondition.AgvName,this.queryCondition.TaskName,this.queryCondition.TaskResult),b.Z.Primary("檔案儲存成功")},async HandleExportToAutoRptFolder(){var e=await(0,w.e$)(this.queryCondition.StartTime,this.queryCondition.EndTime);e.confirm?this.$swal.fire({title:"匯出成功",html:e.message,icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):this.$swal.fire({text:e.message,title:"匯出失敗",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},handlePageChange(e){this.TaskQuery(!0)},CopyText(e){(0,y.O)(e)},async DeleteTaskHandle(e){await(0,w.mA)(e.TaskName),this.TaskQuery(!0)},filterAGVName(e,t){return t.DesignatedAGVName===e},ShowLocus(e){console.log(e);const t=e.TaskName,a=e.DesignatedAGVName;this.$router.push({path:"/data/agv_locus",query:{taskName:t,agvName:a}})}}},T=a(83744);const D=(0,T.Z)(k,[["render",_],["__scopeId","data-v-522b023b"]]);var V=D},3802:function(e,t,a){"use strict";a.d(t,{Z:function(){return de}});var i=a(66252),s=a(3577),n=a(49963);const o={class:"agv-status card-like"},l={class:"title d-flex flex-row"},r={key:0,class:"text-danger"},d={class:"d-flex"},c={class:"d-flex"},u={class:"d-flex flex-column flex-fill"},m=["onClick"],h=(0,i._)("i",{class:"bi bi-lightning-charge-fill"},null,-1),p={class:"charge-button-container d-flex flex-column"},g={class:"w-100",style:{position:"absolute",top:"0",left:"0"}},_={class:"tb-label h-100 border px-1 py-2 text-center bg-light"},w={class:"h-100 border p-1"},f={class:"h-100 border py-2 text-center bg-light"},y={class:"h-100 w-100 border p-2"},v={class:"tb-label h-100 border px-1 py-2 text-center bg-light"},S={class:"h-100 border p-1",style:{cursor:"pointer"}},b={class:"h-100 border py-2 text-center bg-light"},C={class:"w-100 h-100 border p-1 d-flex flex-row"},k={class:"flex-fill"},T=["onClick"],D=["onClick"],V={class:"tb-label h-100 border px-1 py-2 text-center bg-light"},A={class:"h-100 border px-2 py-1 d-flex"},I={class:"w-100",style:{position:"absolute",top:"0",left:"0"}},x=(0,i._)("div",{class:"tb-label h-100 border p-2 text-center bg-light"},"ID",-1),E={class:"h-100 border p-1"},M={class:"tb-label h-100 border px-1 py-2 text-center bg-light"},P={class:"h-100 border p-1"},O={class:"val-label"},N={class:"tb-label h-100 border px-1 py-2 text-center bg-light"},L={class:"h-100 border p-1 d-flex"},G={class:"val-label"},R={class:"tb-label h-100 border py-2 text-center bg-light"},W={class:"h-100 border p-1"},U={class:"val-label"},H={class:"tb-label h-100 border px-1 py-2 text-center bg-light"},$=(0,i._)("div",{class:"h-100 border px-1 py-2 text-center bg-light"},null,-1),F={key:1,style:{height:"90vh","overflow-y":"auto"},class:"py-1"},q={class:"modals"},B={ref:"online_status_change_noti_txt"},z={key:0},j={class:"dialog-footer"};function Z(e,t,a,Z,Q,Y){const K=(0,i.up)("b-button"),X=(0,i.up)("b-card"),J=(0,i.up)("el-table-column"),ee=(0,i.up)("el-tooltip"),te=(0,i.up)("el-popover"),ae=(0,i.up)("el-col"),ie=(0,i.up)("el-tag"),se=(0,i.up)("el-row"),ne=(0,i.up)("el-button"),oe=(0,i.up)("b-progress-bar"),le=(0,i.up)("b-progress"),re=(0,i.up)("el-table"),de=(0,i.up)("vehicle-info-card"),ce=(0,i.up)("b-modal"),ue=(0,i.up)("el-input"),me=(0,i.up)("el-form-item"),he=(0,i.up)("el-form"),pe=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",o,[(0,i._)("div",l,[Y.IsVMSConnect?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",r,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.vms_disconnect")),1))]),"table"==a.DisplayMode?((0,i.wg)(),(0,i.j4)(re,{key:0,"header-cell-style":{fontSize:"20px",color:"white",border:"1px solid rgb(222, 226, 230)",backgroundColor:Y.IsVMSConnect?"rgb(13, 110, 253)":"red"},data:Y.AGVDatas,size:"large",height:"93%","empty-text":"尚無AGV","row-class-name":Y.connected_class,style:{width:"100%"},"row-key":"AGV_Name",border:"",onRowClick:Y.HandleRowClick},{default:(0,i.w5)((()=>[(0,i.Wm)(J,{type:"expand","min-width":Y.AnyAGVIsSimulation?40:1},{default:(0,i.w5)((e=>[(0,i.Wm)(X,{title:"模擬器操作"},{default:(0,i.w5)((()=>[(0,i._)("div",d,[(0,i.Wm)(K,{variant:"primary",onClick:t=>Y.EmulatorInitialize(e.row.AGV_Name)},{default:(0,i.w5)((()=>[(0,i.Uk)("初始化")])),_:2},1032,["onClick"]),(0,i.Wm)(K,{class:"mx-1",onClick:t=>Y.EmulatorRemoveCargo(e.row.AGV_Name)},{default:(0,i.w5)((()=>[(0,i.Uk)("移除卡匣")])),_:2},1032,["onClick"]),(0,i.Wm)(K,{class:"mx-1",variant:"danger",onClick:t=>Y.EmulatorEMO(e.row.AGV_Name)},{default:(0,i.w5)((()=>[(0,i.Uk)("EMO")])),_:2},1032,["onClick"])])])),_:2},1024)])),_:1},8,["min-width"]),(0,i.Wm)(J,{label:e.$t("HomeView.AGVStatus.AGVStatus.vehicle-name"),prop:"AGV_Name",align:"center","min-width":"185px",type:"index"},{default:(0,i.w5)((t=>[(0,i._)("div",c,[(0,i._)("div",{class:"agv-color-display",style:(0,s.j5)(Y.StyleOfAGVDisplayColor(t.row.AGV_Name))},null,4),(0,i._)("div",u,[(0,i.Wm)(ee,{content:"點擊顯示車載頁面",placement:"top"},{default:(0,i.w5)((()=>[(0,i._)("div",{class:"agv-name-container",onClick:e=>Y.HandleAGVNameClicked(t.row)},[(0,i._)("b",null,(0,s.zw)(Y.GetDisplayName(t.row.AGV_Name)),1)],8,m)])),_:2},1024),Y.IsRunMode?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(K,{key:0,class:"w-20 my-1 mx-2",onClick:e=>Y.ShowOnlineStateChangeModal(t.row.AGV_Name,t.row.OnlineStatus,t.row.Model),style:(0,s.j5)({backgroundColor:1==t.row.OnlineStatus?"red":"#0d6efd"})},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(1==t.row.OnlineStatus?e.$t("HomeView.AGVStatus.AGVStatus.OfflineRequest"):e.$t("HomeView.AGVStatus.AGVStatus.OnlineRequest")),1)])),_:2},1032,["onClick","style"])),(0,i.Wm)(te,{width:"150",placement:"right"},{reference:(0,i.w5)((()=>[Y.IsRunMode?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(K,{key:0,class:(0,s.C_)(["w-20 my-1 mx-2",Y.getChargeButtnClass(t.row)]),onClick:e=>Y.ShowAGVChargeConfirmDialog(t.row)},{default:(0,i.w5)((()=>[h,(0,i.Uk)(" "+(0,s.zw)(2==t.row.Model?e.$t("Exchange Battery"):e.$t("Charge")),1)])),_:2},1032,["onClick","class"]))])),default:(0,i.w5)((()=>[(0,i._)("div",p,[(0,i.Wm)(K,{variant:"warning",style:{width:"100%","margin-bottom":"8px"},onClick:e=>Y.ShowAGVChargeConfirmDialog(t.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("一般充電")])),_:2},1032,["onClick"]),(0,i.Wm)(K,{variant:"success",style:{width:"100%","margin-bottom":"8px"},onClick:e=>Y.ShowAGVChargeConfirmDialog(t.row,!0)},{default:(0,i.w5)((()=>[(0,i.Uk)("深度充電")])),_:2},1032,["onClick"]),(0,i.Wm)(K,{variant:"light",style:{width:"100%","margin-bottom":"8px"},onClick:e=>Y.StopDeepCharge(t.row.AGV_Name)},{default:(0,i.w5)((()=>[(0,i.Uk)("解除深度充電")])),_:2},1032,["onClick"])])])),_:2},1024)])])])),_:1},8,["label"]),(0,i.Wm)(J,{label:e.$t("HomeView.AGVStatus.AGVStatus.vehicle-statuslist"),prop:"AGV_Status",align:"left","min-width":"480"},{default:(0,i.w5)((t=>[(0,i._)("div",g,[(0,i.Wm)(se,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",_,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.status")),1)])),_:1}),(0,i.Wm)(ae,{span:6},{default:(0,i.w5)((()=>[(0,i._)("div",w,[(0,i.Wm)(ie,{class:"h-100 w-100",effect:"dark",type:Y.AGV_Status_TagType(t.row.MainStatus)},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(Y.AGVStatusFormatter(t.row)),1)])),_:2},1032,["type"])])])),_:2},1024),(0,i.Wm)(ae,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",f,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.carrierid")),1)])),_:1}),(0,i.Wm)(ae,{span:11},{default:(0,i.w5)((()=>[(0,i._)("div",y,[(0,i._)("b",null,(0,s.zw)(t.row.CurrentCarrierID),1)])])),_:2},1024)])),_:2},1024),(0,i.Wm)(se,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",v,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.vehicleconn")),1)])),_:1}),(0,i.Wm)(ae,{span:6},{default:(0,i.w5)((()=>[(0,i._)("div",S,[(0,i.Wm)(ie,{class:"h-100 w-100",onClick:e=>Y.ShowOnlineStateChangeModal(t.row.AGV_Name,t.row.OnlineStatus,t.row.Model),type:0==t.row.OnlineStatus?"danger":"success"},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(1==t.row.OnlineStatus?e.$t("HomeView.AGVStatus.AGVStatus.Online"):e.$t("HomeView.AGVStatus.AGVStatus.Offline")),1)])),_:2},1032,["onClick","type"])])])),_:2},1024),(0,i.Wm)(ae,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",b,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.position")),1)])),_:1}),(0,i.Wm)(ae,{span:11,class:""},{default:(0,i.w5)((()=>[(0,i._)("div",C,[(0,i._)("div",k,[(0,i.Wm)(ee,{content:"點一下跳至AGV當前位置",placement:"top"},{default:(0,i.w5)((()=>[(0,i._)("i",{class:"bi bi-geo-alt-fill",style:{"font-size":"20px",cursor:"pointer"},onClick:e=>Y.HandleShowAGVInMapCenter(t.row.AGV_Name)},null,8,T)])),_:2},1024),(0,i._)("b",null,(0,s.zw)(t.row.StationName),1)]),(0,i.Wm)(ee,{content:"追隨AGV，AGV將保持顯示於地圖中央",placement:"top"},{default:(0,i.w5)((()=>[Y.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("i",{key:0,onClick:e=>Y.TrackingVehicle(t.row.AGV_Name),style:(0,s.j5)([{cursor:"pointer",height:"22px",position:"relative",top:"2px","border-radius":"30px",width:"22px","padding-left":"4px","font-size":"18px"},Q.TrackingAGV==t.row.AGV_Name?{backgroundColor:"rgb(13, 110, 253)",color:"white"}:{}]),class:"bi bi-eyeglasses"},null,12,D))])),_:2},1024),(0,i.wy)((0,i.Wm)(ne,{class:"",onClick:e=>Y.HandleAGVLocatingClick(t.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("定位")])),_:2},1032,["onClick"]),[[n.F8,2==t.row.Model||t.row.Simulation]])])])),_:2},1024)])),_:2},1024),(0,i.Wm)(se,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae,{span:3},{default:(0,i.w5)((()=>[(0,i._)("div",V,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.power")),1)])),_:1}),(0,i.Wm)(ae,{span:21},{default:(0,i.w5)((()=>[(0,i._)("div",A,[(0,i.Wm)(le,{class:"flex-fill",max:100,min:0,animated:""},{default:(0,i.w5)((()=>[t.row.IsCharging&&Y.IsVMSConnect?((0,i.wg)(),(0,i.iD)("i",{key:0,class:(0,s.C_)([Y.BatteryClass(t.row.BatteryLevel_1,!!Y.IsVMSConnect&&t.row.IsCharging),"bi bi-lightning-charge battery-icon"]),style:{color:"white"}},null,2)):(0,i.kq)("",!0),(0,i.Wm)(oe,{animated:!0,class:(0,s.C_)(Y.BatteryClass(t.row.BatteryLevel_1,!!Y.IsVMSConnect&&t.row.IsCharging)),value:Y.IsVMSConnect?t.row.BatteryLevel_1:0,label:`${(100*(Y.IsVMSConnect?t.row.BatteryLevel_1/100:0)).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024),-1!=t.row.BatteryLevel_2?((0,i.wg)(),(0,i.j4)(le,{key:0,class:"flex-fill mx-1",max:100,min:0,animated:""},{default:(0,i.w5)((()=>[t.row.IsCharging&&Y.IsVMSConnect?((0,i.wg)(),(0,i.iD)("i",{key:0,class:(0,s.C_)([Y.BatteryClass(t.row.BatteryLevel_2,!!Y.IsVMSConnect&&t.row.IsCharging),"bi bi-lightning-charge battery-icon"]),style:{color:"white"}},null,2)):(0,i.kq)("",!0),(0,i.Wm)(oe,{animated:!0,class:(0,s.C_)(Y.BatteryClass(t.row.BatteryLevel_2,!!Y.IsVMSConnect&&t.row.IsCharging)),value:Y.IsVMSConnect?t.row.BatteryLevel_2:0,label:`${(100*(Y.IsVMSConnect?t.row.BatteryLevel_2/100:0)).toFixed(2)}%`},null,8,["class","value","label"])])),_:2},1024)):(0,i.kq)("",!0)])])),_:2},1024)])),_:2},1024)])])),_:1},8,["label"]),Y.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(J,{key:0,label:e.$t("HomeView.AGVStatus.AGVStatus.task-status"),prop:"Task_Status",align:"left","min-width":"380"},{default:(0,i.w5)((t=>[(0,i._)("div",I,[(0,i.Wm)(se,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae,{span:4},{default:(0,i.w5)((()=>[x])),_:1}),(0,i.Wm)(ae,{span:20},{default:(0,i.w5)((()=>[(0,i._)("div",E,[(0,i._)("b",null,(0,s.zw)(t.row.TaskName),1)])])),_:2},1024)])),_:2},1024),(0,i.Wm)(se,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",M,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.From")),1)])),_:1}),(0,i.Wm)(ae,{span:8},{default:(0,i.w5)((()=>[(0,i._)("div",P,[(0,i.Wm)(ie,{size:"large",class:"h-100 w-100",effect:"light"},{default:(0,i.w5)((()=>[(0,i._)("b",O,(0,s.zw)(t.row.TaskSourceStationName),1)])),_:2},1024)])])),_:2},1024),(0,i.Wm)(ae,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",N,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.action")),1)])),_:1}),(0,i.Wm)(ae,{span:8},{default:(0,i.w5)((()=>[(0,i._)("div",L,[(0,i.Wm)(ie,{class:"h-100 w-100",effect:"light"},{default:(0,i.w5)((()=>[(0,i._)("b",G,(0,s.zw)(Y.GetTransferProcessDescription(t.row,t.row.TransferProcess,t.row.CurrentAction,t.row.TaskRunAction)),1)])),_:2},1024)])])),_:2},1024)])),_:2},1024),(0,i.Wm)(se,{class:"h-50"},{default:(0,i.w5)((()=>[(0,i.Wm)(ae,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",R,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.To")),1)])),_:1}),(0,i.Wm)(ae,{span:8},{default:(0,i.w5)((()=>[(0,i._)("div",W,[(0,i.Wm)(ie,{class:"h-100 w-100",effect:"light"},{default:(0,i.w5)((()=>[(0,i._)("b",U,(0,s.zw)(t.row.TaskDestineStationName),1)])),_:2},1024)])])),_:2},1024),(0,i.Wm)(ae,{span:4},{default:(0,i.w5)((()=>[(0,i._)("div",H,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.Time")),1)])),_:1}),(0,i.Wm)(ae,{span:8},{default:(0,i.w5)((()=>[$])),_:1})])),_:2},1024)])])),_:1},8,["label"])),(0,i.Wm)(J,{width:"1"},{default:(0,i.w5)((e=>[(0,i._)("div",{style:(0,s.j5)({height:Y.IsRunMode?"110px":"125px"}),class:"d-flex flex-column"},null,4)])),_:1})])),_:1},8,["header-cell-style","data","row-class-name","onRowClick"])):(0,i.kq)("",!0),"cards"==a.DisplayMode?((0,i.wg)(),(0,i.iD)("div",F,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Y.AGVDatas,(a=>((0,i.wg)(),(0,i.j4)(de,{key:a.AGV_Name,vehicleStateData:a,isMapViewTracking:Q.TrackingAGV==a.AGV_Name,onOnOnlineBtnClicked:t[0]||(t[0]=e=>{Y.ShowOnlineStateChangeModal(e.AGV_Name,e.OnlineStatus,e.Model)}),onOnLocateClicked:t[1]||(t[1]=e=>{Y.HandleShowAGVInMapCenter(e)}),onOnTrackingVehicleClick:t[2]||(t[2]=e=>{Y.TrackingVehicle(e)}),onOnWebSiteIconClicked:t[3]||(t[3]=e=>{Y.HandleAGVNameClicked(e)}),onShowAGVChargeConfirmDialog:t[4]||(t[4]=e=>Y.ShowAGVChargeConfirmDialog(e)),onShowAGVDeepChargeConfirmDialog:t[5]||(t[5]=e=>Y.ShowAGVChargeConfirmDialog(e,!0)),onStopDeepCharge:t[6]||(t[6]=e=>Y.StopDeepCharge(e)),onOnTaskIdClick:t[7]||(t[7]=t=>{e.$emit("onTaskIDClicked",t)})},null,8,["vehicleStateData","isMapViewTracking"])))),128))])):(0,i.kq)("",!0)]),(0,i._)("div",q,[(0,i.Wm)(ce,{modelValue:Q.ShowOnlineStateChange,"onUpdate:modelValue":t[8]||(t[8]=e=>Q.ShowOnlineStateChange=e),title:"ONLINE / OFFLINE REQUEST CONFIRM.",centered:!0,onOk:Y.SendOnlineStateChangeRequest,"no-close-on-esc":!0,"header-bg-variant":"warning","header-text-variant":"light"},{default:(0,i.w5)((()=>[(0,i._)("p",B,null,512)])),_:1},8,["modelValue","onOk"])]),(0,i.Wm)(pe,{modelValue:Q.ShowAGVLocatingDialog,"onUpdate:modelValue":t[11]||(t[11]=e=>Q.ShowAGVLocatingDialog=e),width:"400",draggable:"",modal:!1,"close-on-click-modal":!1,title:Q.AGVLocatingPayload.Name+"-定位"},{footer:(0,i.w5)((()=>[(0,i._)("div",j,[(0,i.Wm)(ne,{onClick:t[10]||(t[10]=e=>Q.ShowAGVLocatingDialog=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)("Cancel")])),_:1}),(0,i.Wm)(ne,{type:"primary",onClick:Y.HandleAGVLocatingCinfirm},{default:(0,i.w5)((()=>[(0,i.Uk)("定位")])),_:1},8,["onClick"])])])),default:(0,i.w5)((()=>[Q.AGVLocatingPayload.isAMCAGV?((0,i.wg)(),(0,i.iD)("div",z,"AMC")):(0,i.kq)("",!0),(0,i.Wm)(he,null,{default:(0,i.w5)((()=>[(0,i.Wm)(me,{label:"Point ID"},{default:(0,i.w5)((()=>[(0,i.Wm)(ue,{type:"number",min:0,clearable:"",placeholder:"0",ref:"locating-tag-input",modelValue:Q.AGVLocatingPayload.currentID,"onUpdate:modelValue":t[9]||(t[9]=e=>Q.AGVLocatingPayload.currentID=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"])],64)}a(57658);var Q=a(93867),Y=a(53259),K=a(90131),X=a(38418),J=a(8764),ee=a(25044),te=a(30381),ae=a.n(te),ie=a(95320),se=a(56938),ne=a(86952),oe={components:{VehicleInfoCard:ne.Z},mounted(){Y.Z.on("/cancel_tracking_agv",(()=>{this.TrackingAGV="",Y.Z.emit("tracking_agv",this.TrackingAGV)})),Y.Z.on("invoke-agv-lock",(e=>{this.TrackingVehicle(e)}))},data(){return{ShowOnlineStateChange:!1,ShowChargeConfirmDialog:!1,ShowAGVLocatingDialog:!1,TrackingAGV:"",OnlineStatusReq:{AGV_Name:"",Online_Status:"",Model:0},AGVLocatingPayload:{Name:"",currentID:100,x:0,y:0,theata:0,isAMCAGV:!1}}},props:{IsEasyMode:{type:Boolean,default:!1},DisplayMode:{type:String,default:"table"}},methods:{HandleAGVNameClicked(e){const t=`http://${e.IP}:${e.Port}`;window.open(t)},async EmulatorInitialize(e){X.PQ.Initialize(e)},async EmulatorRemoveCargo(e){X.PQ.RemoveCargo(e)},async EmulatorEMO(e){X.PQ.EMO(e)},StyleOfAGVDisplayColor(e){var t="blue";return ie.p.getters.CustomAGVStyles[e]&&(t=ie.p.getters.CustomAGVStyles[e].DisplayColor),{backgroundColor:t}},GetDisplayName(e){return ie.p.getters.CustomAGVStyles[e]?ie.p.getters.CustomAGVStyles[e].DisplayText:e},Timeformat(e,t="YYYY/MM/DD HH:mm:ss"){return ae()(e).format(t)},HandleRowClick(e,t){},HandleShowAGVInMapCenter(e){Y.Z.emit("/show_agv_at_center",e)},ShowTaskAllocationView(e){(0,K.VM)().isLogin?Y.Z.emit("bus-show-task-allocation",{agv_name:e.AGV_Name,agv_type:e.Model,action:"",station_data:void 0}):this.$swal.fire({title:"權限不足",text:"您沒有指派任務的權限，請先進行登入。",icon:"warning",showCancelButton:!0}).then((e=>{e.isConfirmed&&Y.Z.emit("/show-login-view-invoke","")}))},ShowOnlineStateChangeModal(e,t,a){if(this.IsLogin){this.OnlineStatusReq.AGV_Name=e,this.OnlineStatusReq.Online_Status=0==t?"Online":"Offline",this.OnlineStatusReq.Model=a;var i="Online"==this.OnlineStatusReq.Online_Status?"上線":"下線";this.$swal.fire({text:`確定要將 ${this.OnlineStatusReq.AGV_Name} ${i}?`,title:`${this.OnlineStatusReq.AGV_Name} - ${i}`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed)await this.SendOnlineStateChangeRequest()}))}else this.$swal.fire({text:"",title:"沒有請求車子上下線的權限，請先進行登入",icon:"warning",showCancelButton:!0,confirmButtonText:"登入",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&Y.Z.emit("/show-login-view-invoke","")}))},async SendOnlineStateChangeRequest(){Q.Z.Primary(`${this.OnlineStatusReq.AGV_Name} ${this.OnlineStatusReq.Online_Status} 請求已送出`,"top",2e3);var e=null;try{if("Online"==this.OnlineStatusReq.Online_Status){var t=await(0,X.UT)(this.OnlineStatusReq.AGV_Name,this.OnlineStatusReq.Model);e=t.data}else{t=await(0,X.PX)(this.OnlineStatusReq.AGV_Name,this.OnlineStatusReq.Model);e=t.data}0!=e.ReturnCode&&this.$swal.fire({text:`${this.OnlineStatusReq.AGV_Name} ${this.OnlineStatusReq.Online_Status} 失敗:${e.Message}`,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}catch(a){this.$swal.fire({title:"VMS系統通訊異常",text:`${a.message} , Please confirm that the VMS is currently in service.`,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}},TrackingVehicle(e){this.TrackingAGV==e?this.TrackingAGV="":(this.HandleShowAGVInMapCenter(e),this.TrackingAGV=e),Y.Z.emit("/tracking_agv",this.TrackingAGV)},HandleAGVLocatingClick(e){console.log(e),this.AGVLocatingPayload.currentID=Number.parseInt(e.CurrentLocation),this.AGVLocatingPayload.Name=e.AGV_Name,this.AGVLocatingPayload.isAMCAGV=2==e.Model,this.ShowAGVLocatingDialog=!0,setTimeout((()=>{this.$refs["locating-tag-input"].focus(),this.$refs["locating-tag-input"].select()}),500)},async HandleAGVLocatingCinfirm(){this.ShowAGVLocatingDialog=!1;var e=this.AGVLocatingPayload.Name,t=await(0,X.ZM)(e,this.AGVLocatingPayload);console.log(t),t&&t.confirm?this.$swal.fire({text:`${e}-定位完成!`,title:"",icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}):(this.$swal.fire({text:`${e}-定位失敗`,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),this.ShowAGVLocatingDialog=!0)},getChargeButtnClass(e=new se.Z){var t=ee.sn.getters.VehicleBatteryStatus(e.AGV_Name);return 1==t?"charge-deep-charging":"charge-normal"},ShowAGVChargeConfirmDialog(e,t=!1){if(ee.HP.getters.level<0)return void this.$swal.fire({title:"權限不足",text:"您沒有指派AGV充電的權限，請先進行登入。",icon:"warning",showCancelButton:!0}).then((e=>{e.isConfirmed&&Y.Z.emit("/show-login-view-invoke","")}));this.Agv_Selected=e.AGV_Name;var a=2==e.Model;const i=t=>a?`確定要將 ${e.AGV_Name} 派送至交換站交換電池?`:t?`確定要將 ${e.AGV_Name} 派送至充電站進行深度充電?`:`確定要將 ${e.AGV_Name} 派送至充電站充電?`;this.$swal.fire({title:i(t),icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.AGVChargeTask(a,t)}))},async StopDeepCharge(e){var t=await X.bh.StopDeepCharge(e);console.log(t),this.$swal.fire({title:`已解除 [${e}] 電池深度充電`,text:"",icon:"success",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async AGVChargeTask(e=!1,t=!1){var a={};a=e?await J.J8.ExangeBatteryTask(new J.Z$(this.Agv_Selected,-1)):t?await J.J8.DeepCharge(this.Agv_Selected):await J.J8.ChargeTask(new J.fn(this.Agv_Selected,-1)),console.log(a),this.HandleChargeTaskDispatchResult(a)},HandleChargeTaskDispatchResult(e){e.data.confirm||(82==e.data.alarm_code?this.$swal.fire({text:"是否要改為指派新的充電任務",title:e.data.message,icon:"warning",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=await J.J8.CancelChargeTask(this.Agv_Selected);t.confirm?this.AGVChargeTask():this.$swal.fire({text:"",title:t.message,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}})):this.$swal.fire({text:"Error Code: "+e.data.alarm_code,title:e.data.message,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}))},AGV_Status_TagType(e){return 1==e?"warning":2==e?"success":3==e?"danger":4==e?"success":"info"},GetTaskRunStatusString(e){return 1==e?"等待":2==e?"執行中":3==e?"完成":4==e?"失敗":"Unknown"},GetAGVStatusString(e){return 1==e?this.$t("AGVStatus.IDLE"):2==e?this.$t("AGVStatus.RUN"):3==e?this.$t("AGVStatus.DOWN"):4==e?this.$t("AGVStatus.CHARGING"):"Unknown"},GetTransferProcessDescription(e,t,a=0,i=0){if(!e.IsExecutingOrder||0==t||500==t)return"";if(1==t)return"移動中";if(2==t)return this.$t("TaskAction.GoToSource");if(3==t){if(8==i)return this.$t("TaskAction.GoToChargeStation");if(7==i||9==i)return this.$t("TaskAction.GoToDestineload");if(1==i)return this.$t("TaskAction.GoToDestineUnload")}else{if(4==t)return this.$t("TaskAction.Unloading");if(5!=t)return 6==t?"停車-充電站":7==t?"退出設備中":8==t?"退出停車點/充電站":13==t?"避車":"Unknown";if(7==a)return this.$t("TaskAction.Loading");if(1==a)return"取貨中"}},AGVStatusFormatter(e,t){if(void 0==e)return this.GetAGVStatusString(999);var a=e.MainStatus;return this.GetAGVStatusString(a)},connected_class({row:e,rowIndex:t}){var a=this.IsRunMode?"agv-row-no-operation":"agv-row";return e.Connected&&this.IsVMSConnect?`${a} connect`:`${a} disconnect`},BatteryClass(e,t=!1){return t?"batter-charging":e>=30?"batter-full-level":e>10&&e<30?"batter-mid-level":"batter-low-level"}},computed:{AGVDatas(){return ee.sn.getters.AGVStatesData},AnyAGVIsSimulation(){var e=this.AGVDatas.filter((e=>e.Simulation));return 0!=e.length},Groups(){function e(e){return 0==e?"Fork AGV":1==e?"潛盾 AGV":2==e?"YUNTECH AGV":3==e?"巡檢 AGV":"GROUP"}var t=this.AGVDatas.map((e=>e.Group));const a=[...new Set(t)];var i=[];for(let n=0;n<a.length;n++){const t=a[n];var s=this.AGVDatas.filter((e=>e.Group==t));i.push({group:t,group_name:e(t),agv_states:s})}return i},IsLogin(){return ee.HP.getters.IsLogin},IsOpUsing(){return ee.HP.getters.IsOPLogining},IsRunMode(){return ee.cy.getters.IsRunMode},AGV_Names(){var e=[];return this.AGVDatas.forEach((t=>{e.push(t.AGV_Name)})),e},IsVMSConnect(){return ee.g4.getters.VMSAlive}}},le=a(83744);const re=(0,le.Z)(oe,[["render",Z]]);var de=re},61796:function(e,t,a){"use strict";a.d(t,{Z:function(){return V}});var i=a(66252);const s={class:"map card-like"};function n(e,t,a,n,o,l){const r=(0,i.up)("Map"),d=(0,i.up)("CargoTransferDialog");return(0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(r,{canva_height:"100%",onOnTransferRequst:l.HandleTransferReq,id:a.id,class:"w-100",task_dispatch_menu_show:!0,eq_lduld_status_show:!0},null,8,["onOnTransferRequst","id"]),(0,i.Wm)(d,{ref:"transfer_dialog"},null,512)])}var o=a(60351),l=a(95320),r=a(3577);const d=e=>((0,i.dD)("data-v-41d75abc"),e=e(),(0,i.Cn)(),e),c={class:"justify-content-center px-5 cargo-transfer"},u=d((()=>(0,i._)("div",{class:"w-100 border-bottom my-1"},[(0,i._)("h3",null,"車輛選擇")],-1))),m={class:"w-100 border-bottom my-1"},h={style:{color:"blue"}},p={style:{color:"seagreen"}},g={class:"text-danger"};function _(e,t,a,s,n,o){const l=(0,i.up)("el-option"),d=(0,i.up)("el-select"),_=(0,i.up)("el-divider"),w=(0,i.up)("el-table-column"),f=(0,i.up)("b-button"),y=(0,i.up)("el-popconfirm"),v=(0,i.up)("el-table"),S=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.j4)(S,{"destroy-on-close":"",modal:!1,style:{"z-index":"0"},modelValue:n.show_dialog,"onUpdate:modelValue":t[2]||(t[2]=e=>n.show_dialog=e),draggable:"",title:`${n.source_station.Name}-搬運任務`},{default:(0,i.w5)((()=>[(0,i._)("div",c,[u,o.isRunMode?((0,i.wg)(),(0,i.j4)(d,{key:1,disabled:"",class:"w-100",modelValue:n.autoSelectAGVName,"onUpdate:modelValue":t[1]||(t[1]=e=>n.autoSelectAGVName=e)},null,8,["modelValue"])):((0,i.wg)(),(0,i.j4)(d,{key:0,class:"w-100",modelValue:n.selectedAGVName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedAGVName=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.AgvNameList,(t=>((0,i.wg)(),(0,i.j4)(l,{key:t,label:"Assigning"==t?e.$t("auto-choise-vehicle"):t,value:"Assigning"==t?"":t},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])),(0,i.Wm)(_),(0,i._)("div",m,[(0,i._)("h3",null,(0,r.zw)("unload"==n.action?"下游設備列表":"來源設備列表"),1)]),(0,i.Wm)(v,{size:"small",border:"",data:n.CandicateEQOptions},{default:(0,i.w5)((()=>["unload"==n.action?((0,i.wg)(),(0,i.j4)(w,{key:0,label:"起點"},{default:(0,i.w5)((e=>[(0,i._)("b",h,(0,r.zw)(n.source_station.Graph.Display),1)])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(w,{label:"unload"==n.action?"下游設備":"上游設備",prop:"Name"},{default:(0,i.w5)((e=>[(0,i._)("b",null,(0,r.zw)(e.row.Name),1)])),_:1},8,["label"]),"load"==n.action?((0,i.wg)(),(0,i.j4)(w,{key:1,label:"終點"},{default:(0,i.w5)((e=>[(0,i._)("b",p,(0,r.zw)(n.source_station.Graph.Display),1)])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(w,{align:"center",label:"TAG",prop:"TagID"}),(0,i.Wm)(w,{align:"center",label:"動作"},{default:(0,i.w5)((e=>[(0,i.Wm)(y,{width:"220","confirm-button-text":"確定","cancel-button-text":"取消","icon-color":"#626AEF",title:"確定要進行此搬運任務?",onConfirm:t=>o.HandleTransferBtnClick(e.row.TagID)},{reference:(0,i.w5)((()=>[(0,i.Wm)(f,{style:{width:"90px"},size:"sm",variant:"primary",disabled:!o.Transferable(e.row.TagID)},{default:(0,i.w5)((()=>[(0,i.Uk)("搬運")])),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"])])),_:1}),(0,i.Wm)(w,{width:"300",label:"說明"},{default:(0,i.w5)((e=>[(0,i._)("div",g,(0,r.zw)(o.GetNoTransferActionReason(e.row.TagID)),1)])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue","title"])}var w=a(64491),f=a(25044),y=a(8764),v=a(65781),S={components:{InfoFilled:v.cEj},data(){return{show_dialog:!1,confirm_dialog_show:!1,source_station:{},EQOptions:[],CandicateEQOptions:[],action:"",selectedAGVName:"",autoSelectAGVName:"自動指派"}},methods:{ShowDialog(e,t="load"){this.isRunMode?this.selectedAGVName="Assigning":""==this.selectedAGVName&&(this.selectedAGVName=this.AgvNameList[0]),this.source_station=e,this.action=t,this.CandicateEQOptions=[];var a=e.TagNumber;(0,w.H5)().then((i=>{var s=i.find((e=>e.TagID==a));if(s){var n=s.ValidDownStreamEndPointNames;this.EQOptions=i,this.CandicateEQOptions="unload"==t?i.filter((e=>n.includes(e.Name))):i.filter((t=>t.ValidDownStreamEndPointNames.includes(e.Name))),this.show_dialog=!0}}))},Transferable(e){if(void 0==e)return!0;var t=this.eq_status_data.find((t=>t.Tag==e));if("load"==this.action){if(0==t.EqType)return t.Unload_Request&&t.Up_Pose&&t.IsConnected&&t.Eqp_Status_Down;if(1==t.EqType)return t.Unload_Request&&t.IsConnected&&t.Eqp_Status_Idle}else{if(0==t.EqType)return t.Load_Request&&t.Down_Pose&&t.IsConnected&&t.Eqp_Status_Down;if(1==t.EqType)return t.Load_Request&&t.IsConnected&&t.Eqp_Status_Idle}},GetNoTransferActionReason(e){if(void 0==e)return"";var t=this.eq_status_data.find((t=>t.Tag==e)),a="load"==this.action?"unload":"load";if(!t.IsConnected)return`${t.EQName} 機台尚未連線`;if(!t.Eqp_Status_Down&&0==t.EqType)return`${t.EQName} 機台狀態異常(Eqp_Status_Down)`;if(t.Eqp_Status_Down&&1==t.EqType)return`${t.EQName} 機台狀態異常(Eqp_Status_Down)`;if("load"==a){if(!t.Load_Request)return`${t.EQName} 機台未發起載入請求(Load_Request)`;if(!t.Down_Pose&&0==t.EqType)return`${t.EQName} 設備機構位置錯誤(Down_Pose)`}if("unload"==a){if(!t.Unload_Request)return`${t.EQName} 機台未發起移出請求(Unload_Request)`;if(!t.Up_Pose&&0==t.EqType)return`${t.EQName} 設備機構位置錯誤(Up_Pose)`}return""},HandleTransferBtnClick(e){if(""==this.selectedAGVName)return this.show_dialog=!1,void this.$swal.fire({text:"",title:"請選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{this.show_dialog=!0}));var t="-1",a="-1";"load"==this.action?(t=e,a=this.source_station.TagNumber):(t=this.source_station.TagNumber,a=e);var i="Assigning"==this.selectedAGVName?"":this.selectedAGVName;y.J8.CarryTask(new y.mc(i,t,1,a,1,"-1",5))}},computed:{eq_status_data(){return f.jU.getters.EQData},isRunMode(){return f.cy.getters.IsRunMode},AgvNameList(){return f.sn.getters.AGVNameList}}},b=a(83744);const C=(0,b.Z)(S,[["render",_],["__scopeId","data-v-41d75abc"]]);var k=C,T=(a(79072),{props:{id:{type:String,default:"homemap"}},components:{Map:o["default"],CargoTransferDialog:k},data(){return{navPathDisplayData:{},agv_colors:["#42c2f5","limegreen","orange","pink","red","purple"]}},computed:{map_station_data(){return l.p.getters.MapStations},agvs_info(){return l.p.getters.AGVNavInfo}},mounted(){},methods:{HandleTransferReq(e={station_data:{},action:"load"}){this.$refs.transfer_dialog.ShowDialog(e.station_data,e.action)}}});const D=(0,b.Z)(T,[["render",n],["__scopeId","data-v-18e3110a"]]);var V=D},44883:function(e,t,a){"use strict";a.d(t,{Z:function(){return T}});var i=a(66252),s=a(3577);const n={class:"task-allocation"},o={class:"d-flex"},l={class:"flex-fill text-center"},r={class:"drawer-content border-top"},d={class:"d-flex flex-row py-1 w-100 h-100"},c={key:0,class:"img charge"},u={key:1,class:"img delivery"};function m(e,t,a,m,h,p){const g=(0,i.up)("el-button"),_=(0,i.up)("el-option"),w=(0,i.up)("el-select"),f=(0,i.up)("el-form-item"),y=(0,i.up)("el-input"),v=(0,i.up)("b-button"),S=(0,i.up)("el-checkbox"),b=(0,i.up)("el-form"),C=(0,i.up)("Map"),k=(0,i.up)("el-drawer"),T=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(k,{"show-close":!1,modelValue:h.show,"onUpdate:modelValue":t[8]||(t[8]=e=>h.show=e),header:!1,size:"95%",direction:"btt",modal:!1,"z-index":123,onClosed:p.HandleDrawerClosed},{header:(0,i.w5)((()=>[(0,i._)("div",o,[(0,i.Wm)(g,{onClick:t[0]||(t[0]=()=>{h.show=!1}),size:"large",style:{"margin-left":"53px","font-size":"larger"},type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("←返回(ESC)")])),_:1}),(0,i._)("h3",l,"Local任務派送-車輛:"+(0,s.zw)(h.selectedAGVName),1)])])),default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",d,[(0,i.Wm)(b,{"label-width":"100px","label-position":"left",size:"large",style:{width:"500px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{label:"AGV車輛選擇"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"w-100",modelValue:h.selectedAGVName,"onUpdate:modelValue":t[1]||(t[1]=e=>h.selectedAGVName=e)},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(p.AgvNameList,(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(f,{label:"AGV任務動作"},{default:(0,i.w5)((()=>[2!=h.agv_type?((0,i.wg)(),(0,i.j4)(w,{key:0,class:"w-100",modelValue:h.selectedAction,"onUpdate:modelValue":t[2]||(t[2]=e=>h.selectedAction=e),placeholder:"請選擇Action",onChange:p.ActionChangeHandler},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{label:"移動",value:"move"}),(0,i.Wm)(_,{label:"停車",value:"park"}),(0,i.Wm)(_,{label:"搬運",value:"carry"}),(0,i.Wm)(_,{label:"放貨",value:"load"}),(0,i.Wm)(_,{label:"取貨",value:"unload"}),(0,i.Wm)(_,{label:"充電",value:"charge"}),p.IsDeveloper?((0,i.wg)(),(0,i.j4)(_,{key:0,label:"巡檢量測",value:"measure"})):(0,i.kq)("",!0)])),_:1},8,["modelValue","onChange"])):((0,i.wg)(),(0,i.j4)(w,{key:1,class:"w-100",modelValue:h.selectedAction,"onUpdate:modelValue":t[3]||(t[3]=e=>h.selectedAction=e),placeholder:"請選擇Action",onChange:p.ActionChangeHandler},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{label:"移動",value:"move"}),(0,i.Wm)(_,{label:"交換電池",value:"exchange_battery"}),(0,i.Wm)(_,{label:"巡檢量測",value:"measure"}),(0,i.Wm)(_,{label:"進Bay",value:"in-bay"}),(0,i.Wm)(_,{label:"出Bay",value:"out-bay"})])),_:1},8,["modelValue","onChange"]))])),_:1}),"carry"==h.selectedAction?((0,i.wg)(),(0,i.j4)(f,{key:0,label:"起點"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"w-100",modelValue:h.sourceTag,"onUpdate:modelValue":t[4]||(t[4]=e=>h.sourceTag=e),onChange:p.HandleFromSelectChanged,placeholder:"選擇站點"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(p.tags,(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.tag,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,{label:"目的地"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"w-100",modelValue:h.destinTag,"onUpdate:modelValue":t[5]||(t[5]=e=>h.destinTag=e),placeholder:"選擇站點"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(p.DetermineDestinOptions(),(e=>((0,i.wg)(),(0,i.j4)(_,{key:e.tag,label:e.name,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"carry"===h.selectedAction|"unload"===h.selectedAction?((0,i.wg)(),(0,i.j4)(f,{key:1,label:"貨物ID"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{class:"w-100",modelValue:h.Cst_ID_Input,"onUpdate:modelValue":t[6]||(t[6]=e=>h.Cst_ID_Input=e),autocomplete:""},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,{class:"w-100 my-2",onClick:p.TaskDeliveryBtnClickHandle,variant:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("派送任務")])),_:1},8,["onClick"])])),_:1}),p.IsDeveloper?((0,i.wg)(),(0,i.j4)(f,{key:2,label:"Bypass 設備狀態檢查"},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{class:"w-100",modelValue:h.bypass_eq_status_check,"onUpdate:modelValue":t[7]||(t[7]=e=>h.bypass_eq_status_check=e)},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(C,{canva_height:"750px",id:"task_allocation_map",class:"w-100 border rounded mx-2",ref:"_map"},null,512)]),"charge"==h.selectedAction?((0,i.wg)(),(0,i.iD)("div",c)):((0,i.wg)(),(0,i.iD)("div",u))])),[[T,h.wait_task_confirm]])])),_:1},8,["modelValue","onClosed"])])}a(57658),a(67635);var h=a(93867),p=a(53259),g=a(56938),_=a(60351),w=a(95320),f=a(8764),y=a(25044),v=a(79072),S=a(64491),b={components:{Map:_["default"]},data(){return{show:!1,clsAgvStatus:new g.Z,confirm_dialog_show:!1,notify_dialog_show:!1,wait_task_confirm:!1,bypass_eq_status_check:!1,notify_text:"",selectedAGVName:"",selectedAction:"move",sourceTag:"",destinTag:"",Cst_ID_Input:"",moveable_tags:[{tag:1,name:"標籤1"}],parkable_tags:[],stock_tags:[{tag:1,name:"標籤1"},{tag:2,name:"標籤2"}],chargable_tags:[{tag:50,name:"充電站(TAG-50)"},{tag:70,name:"充電站(TAG-70)"}],downstream_tags:[{tag:1,name:"標籤1"},{tag:2,name:"標籤2"}],csts:[{tag:1,name:""}],agv_type:0,equipments_options:void 0}},computed:{Map(){return this.$refs["_map"]},AgvNameList(){var e=[];function t(e){y.sn.getters.AGVNameList.forEach((t=>{e.push({value:t,label:t})}))}return y.cy.getters.IsRunMode?(e.push({value:"",label:this.$t("auto-choise-vehicle")}),this.IsDeveloper&&t(e)):t(e),e},tags(){return"move"==this.selectedAction?this.moveable_tags:"charge"==this.selectedAction?this.chargable_tags:"load"==this.selectedAction|"unload"==this.selectedAction|"carry"==this.selectedAction?this.stock_tags:this.parkable_tags},IsDeveloper(){return y.HP.getters.IsDeveloperLogining},IsUserLogin(){return 0!=y.HP.getters.level},bay_names(){var e=w.p.getters.BaysData;return Object.keys(e).map((e=>({tag:e,name:e})))},exchanger_options(){return w.p.getters.AllExangeBatteryStation}},methods:{ActionChangeHandler(e){this.sourceTag=void 0,this.destinTag=void 0;var t="blue";"move"==e&&this.Map.HighLightFeaturesByStationType(0,t),"carry"==e|"load"==e|"unload"==e&&this.Map.HighLightFeaturesByStationType(1,t),"charge"==e&&this.Map.HighLightFeaturesByStationType(3,t)},HandleNavPathPreviewBtnClick(){},DetermineDestinOptions(){return"measure"==this.selectedAction?this.bay_names:"carry"==this.selectedAction?this.downstream_tags:"exchange_battery"==this.selectedAction?this.exchanger_options:this.tags},TaskDeliveryBtnClickHandle(){if(this.selectedAGVName||y.cy.getters.IsRunMode)if(this.selectedAction)if(""==this.destinTag|void 0==this.destinTag)this.$swal.fire({text:"",title:"尚未選擇目的地",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else if("carry"==this.selectedAction&&""==this.sourceTag|void 0==this.sourceTag)this.$swal.fire({text:"",title:"尚未選擇起點",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else{var e=this.destinTag;this.$swal.fire({title:"確定要派送此任務?",text:`${this.selectedAGVName} 執行 ${this.selectedAction.toUpperCase()} 任務,終點:${e}`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"dispatch-order-sweet-alert"}).then((e=>{e.isConfirmed&&this.TaskDeliveryHandle()}))}else this.$swal.fire({text:"",title:"尚未選擇動作",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"});else this.$swal.fire({text:"",title:"尚未選擇車輛",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async TaskDeliveryHandle(){0==y.HP.getters.level&&(this.bypass_eq_status_check=!1),this.wait_task_confirm=!0;var e={confirm:!0,message:""};if("move"==this.selectedAction&&(e=await f.J8.MoveTask(new f.ec(this.selectedAGVName,this.destinTag,50))),"measure"==this.selectedAction&&(e=await f.J8.MeasureTask(new f.FV(this.selectedAGVName,this.destinTag))),"load"==this.selectedAction&&(e=await f.J8.LoadTask(new f.Y4(this.selectedAGVName,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"unload"==this.selectedAction&&(e=await f.J8.UnloadTask(new f.On(this.selectedAGVName,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"carry"==this.selectedAction&&(e=await f.J8.CarryTask(new f.mc(this.selectedAGVName,this.sourceTag,1,this.destinTag,1,this.Cst_ID_Input,50,this.bypass_eq_status_check))),"exchange_battery"==this.selectedAction&&(e=await f.J8.ExangeBatteryTask(new f.Z$(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),"charge"==this.selectedAction&&(e=await f.J8.ChargeTask(new f.fn(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),"park"==this.selectedAction&&(e=await f.J8.ParkTask(new f.Nn(this.selectedAGVName,this.destinTag,50,this.bypass_eq_status_check))),this.wait_task_confirm=!1,200!=e.status){const t=401==e.status;this.$swal.fire({title:t?"須重新進行登入":"任務派送失敗!",text:t?"":e.mesage,icon:"error",showCancelButton:!1,showConfirmButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{t&&(this.show=!1,y.HP.dispatch("logout",""),p.Z.emit("/show-login-view-invoke"))}))}else e.data.confirm?(h.Z.Success(`任務-[${this.selectedAction.toUpperCase()}] 已派送!`,"bottom",2e3),setTimeout((()=>{this.show=!1}),400)):this.$swal.fire({text:e.data.message,title:"任務派送失敗!",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},HandleDrawerClosed(){},MapStationClicked(e){if(e){var t=e.StationType;0==t&&(this.selectedAction="move"),1==t&&(this.selectedAction="unload"),3==t&&(this.selectedAction="charge");var a=this.tags.findLast((t=>t.tag==e.TagNumber));console.info(a),a&&(this.sourceTag=e.TagNumber)}},async HandleFromSelectChanged(e){this.destinTag=void 0,this.downstream_tags=[],this.equipments_options=await(0,S.H5)();var t=this.equipments_options.find((t=>t.TagID==e));if(t){var a=t.ValidDownStreamEndPointNames;console.info(a);var i=this.equipments_options.filter((e=>a.includes(e.Name)));console.info(i),Object.values(i).forEach((e=>{this.downstream_tags.push({tag:e.TagID,name:`${e.Name}(Tag=${e.TagID})`})}))}}},mounted(){p.Z.on("bus-show-task-allocation",((e={agv_name:void 0,agv_type:0,action:"",station_data:new v.ux})=>{this.IsUserLogin||y.cy.getters.IsRunMode?(this.agv_type=e.agv_type,this.sourceTag=void 0,this.destinTag=void 0,this.selectedAGVName=y.cy.getters.IsRunMode?"":void 0,this.moveable_tags=w.p.getters.AllNormalStationOptions,this.stock_tags=w.p.getters.AllEqStation,this.chargable_tags=w.p.getters.AllChargeStation,this.parkable_tags=w.p.getters.AllParkingStationOptions,this.selectedAction=e.action,e.agv_name&&(this.selectedAGVName=e.agv_name),e.station_data&&("carry"==this.selectedAction?(this.sourceTag=e.station_data.TagNumber,this.HandleFromSelectChanged(this.sourceTag)):this.destinTag=e.station_data.TagNumber),this.show=!0):setTimeout((()=>{this.$swal.fire({text:"",title:"請先進行登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{p.Z.emit("/show-login-view-invoke")}))}),200)}))}},C=a(83744);const k=(0,C.Z)(b,[["render",m],["__scopeId","data-v-5f08b114"]]);var T=k},61130:function(e,t,a){"use strict";a.d(t,{Z:function(){return be}});var i=a(66252),s=a(3577);const n=e=>((0,i.dD)("data-v-19b5288c"),e=e(),(0,i.Cn)(),e),o={class:"task-status card-like"},l={key:0,class:"title d-flex flex-row justify-content-between"},r=n((()=>(0,i._)("i",{class:"bi bi-three-dots-vertical"},null,-1))),d={key:1,class:""},c={key:2,class:"column-display-mode"},u=n((()=>(0,i._)("div",{class:"title-display"},"等待/執行中任務",-1))),m=n((()=>(0,i._)("div",{class:"title-display"},"已結束任務",-1))),h={class:"setting-container w-100 bg-light text-start"};function p(e,t,a,n,p,g){const _=(0,i.up)("RunningTaskTable"),w=(0,i.up)("el-tab-pane"),f=(0,i.up)("CompletedTaskTable"),y=(0,i.up)("el-tabs"),v=(0,i.up)("el-checkbox"),S=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",o,[a.show_card_title?((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",null,[r,(0,i.Uk)(" "+(0,s.zw)(e.$t("HomeView.TaskStatus")),1)]),(0,i._)("div",null,[(0,i._)("i",{class:"bi bi-sliders",onClick:t[0]||(t[0]=e=>p.ShowSettingsDrawer=!0)})])])):(0,i.kq)("",!0),"tabs"==a.display_mode?((0,i.wg)(),(0,i.iD)("div",d,[(0,i.Wm)(y,{lazy:"",size:"",type:"border-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{label:e.$t("IncompleteTasks")},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{height:a.height,IncompletedTaskList:g.IncompletedTaskListTbData,display_mode:"cards",taskIDSelected:a.taskIDSelected},null,8,["height","IncompletedTaskList","taskIDSelected"])])),_:1},8,["label"]),(0,i.Wm)(w,{label:e.$t("CompleteTasks")},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{height:a.height,CompletedTaskList:g.CompletedTaskListTbData},null,8,["height","CompletedTaskList"])])),_:1},8,["label"])])),_:1})])):((0,i.wg)(),(0,i.iD)("div",c,[u,(0,i.Wm)(_,{height:a.height,IncompletedTaskList:g.IncompletedTaskListTbData,display_mode:"cards"},null,8,["height","IncompletedTaskList"]),m,(0,i.Wm)(f,{height:a.height,CompletedTaskList:g.CompletedTaskListTbData},null,8,["height","CompletedTaskList"])])),(0,i.Wm)(S,{modelValue:p.ShowSettingsDrawer,"onUpdate:modelValue":t[2]||(t[2]=e=>p.ShowSettingsDrawer=e),title:"任務狀態設定"},{default:(0,i.w5)((()=>[(0,i._)("div",h,[(0,i.Wm)(v,{onChange:e.HandleShowTrafficCkbChg,modelValue:p.Settings.ShowTrafficTask,"onUpdate:modelValue":t[1]||(t[1]=e=>p.Settings.ShowTrafficTask=e),label:"顯示交管任務"},null,8,["onChange","modelValue"])])])),_:1},8,["modelValue"])])}var g=a(89302),_=(a(663),a(25044)),w=a(49963);const f={class:"running-task-table"},y={class:"agv-name"},v={key:0},S={key:0},b={key:1,class:"py-2 text-start",style:{height:"80vh","overflow-y":"auto"}},C=(0,i._)("label",{class:"px-3"},"執行中",-1),k={key:0,class:"no-mission-notify"},T=(0,i._)("label",{class:"px-3"},"等待執行",-1),D={key:1,class:"no-mission-notify"};function V(e,t,a,n,o,l){const r=(0,i.up)("el-table-column"),d=(0,i.up)("el-tag"),c=(0,i.up)("el-tooltip"),u=(0,i.up)("b-button"),m=(0,i.up)("el-table"),h=(0,i.up)("MissionCard"),p=(0,i.up)("el-divider");return(0,i.wg)(),(0,i.iD)("div",f,["table"==a.display_mode?((0,i.wg)(),(0,i.j4)(m,{key:0,"header-cell-style":{color:"black",backgroundColor:"white"},data:l.taskWithSorted,"row-key":"TaskName",size:"large","row-class-name":l.row_class_name,"empty-text":e.$t("TaskTable.NoTasks"),onHeaderDragend:l.HandleHeaderDragEnd,border:"",fit:"",height:a.height,onFilterChange:l.handleFilterChange},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{label:e.$t("TaskTable.TaskName"),width:"100",prop:"TaskName","show-overflow-tooltip":""},null,8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Time"),align:"center",prop:"RecieveTime_Formated",width:"90","show-overflow-tooltip":""},null,8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Action"),align:"center",filters:o.TaskActionFileterOptions,"column-key":"Action","filter-method":l.filterTaskAction,width:"80"},{default:(0,i.w5)((e=>[(0,i.Wm)(d,{type:o.TaskActionTagTypes[e.row.Action]||o.TaskActionTagTypes.default},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(e.row.ActionName),1)])),_:2},1032,["type"])])),_:1},8,["label","filters","filter-method"]),(0,i.Wm)(r,{label:e.$t("TaskTable.TaskStatus"),align:"center",prop:"StateName",width:"80",filters:o.RunningTaskStateOptions,"column-key":"State","filter-method":l.filterTaskState},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{content:e.row.State+"",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{effect:"dark",type:l.GetTaskStateType(e.row.State)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.StateName),1)])),_:2},1032,["type"])])),_:2},1032,["content"])])),_:1},8,["label","filters","filter-method"]),(0,i.Wm)(r,{label:e.$t("TaskTable.ExcuteAgvName"),align:"center",width:"120",prop:"DesignatedAGVName","show-overflow-tooltip":""},{default:(0,i.w5)((e=>[(0,i._)("div",y,(0,s.zw)(e.row.DesignatedAGVName),1)])),_:1},8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Source"),align:"center",prop:"From_Station",width:"110"},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{content:"Tag:"+e.row.From_Station,placement:"right","popper-class":"bg-primary"},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,s.zw)(l.GetStationName(e.row.From_Station)),1)])),_:2},1032,["content"]),"-1"!=e.row.From_Slot?((0,i.wg)(),(0,i.iD)("div",v,"(Slot:"+(0,s.zw)(e.row.From_Slot)+")",1)):(0,i.kq)("",!0)])),_:1},8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Destine"),align:"center",prop:"To_Station",width:"110"},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{content:"Tag:"+e.row.To_Station,placement:"right","popper-class":"bg-primary"},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,s.zw)(l.GetStationName(e.row.To_Station)),1)])),_:2},1032,["content"]),"-1"!=e.row.To_Slot?((0,i.wg)(),(0,i.iD)("div",S,"(Slot:"+(0,s.zw)(e.row.To_Slot)+")",1)):(0,i.kq)("",!0)])),_:1},8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.CstID"),align:"center",width:"120",prop:"Carrier_ID"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID),1)])),_:1},8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Dispatcher"),width:"100",prop:"DispatcherName"},null,8,["label"]),(0,i.wy)((0,i.Wm)(r,{fixed:"right","min-width":"125"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Wm)(u,{variant:"danger",onClick:t=>l.CancelTaskHandler(e.row.TaskName)},{default:(0,i.w5)((()=>[(0,i.Uk)("取消任務")])),_:2},1032,["onClick"])])])),_:1},512),[[w.F8,l.taskCancelable]])])),_:1},8,["data","row-class-name","empty-text","onHeaderDragend","height","onFilterChange"])):((0,i.wg)(),(0,i.iD)("div",b,[C,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.ExecutingTasks,(e=>((0,i.wg)(),(0,i.j4)(h,{key:e.TaskName,mission:e,selected:e.TaskName==a.taskIDSelected},null,8,["mission","selected"])))),128)),0==l.ExecutingTasks.length?((0,i.wg)(),(0,i.iD)("div",k,"No Missions.")):(0,i.kq)("",!0),(0,i.Wm)(p),T,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.WaitingForExecutTasks,(e=>((0,i.wg)(),(0,i.j4)(h,{key:e.TaskName,mission:e},null,8,["mission"])))),128)),0==l.WaitingForExecutTasks.length?((0,i.wg)(),(0,i.iD)("div",D,"No Missions.")):(0,i.kq)("",!0)]))])}a(57658);var A=a(8764);function I(e){return 1==e||2==e||3==e||4==e?"success":6==e?"danger":7==e?"warning":"info"}const x={0:"info",1:"primary",7:"primary",8:"success",9:"primary",default:"info"},E=[{text:"移動",value:0},{text:"取貨",value:1},{text:"放貨",value:7},{text:"充電",value:8},{text:"搬運",value:9}],M=[{text:"執行中",value:1},{text:"完成",value:4},{text:"等待中",value:5},{text:"失敗",value:6},{text:"取消",value:7}],P=M.filter((e=>![4,6,7].includes(e.value))),O=M.filter((e=>[4,6,7].includes(e.value)));var N=a(95320);class L{constructor(e="''",t=100){this.propName=e,this.width=t}}function G(e,t=[new L]){localStorage.setItem(e,JSON.stringify(t))}function R(e){var t=[new L];let a=localStorage.getItem(e);return a&&Object.assign(t,JSON.parse(a)),t}var W=a(53259);const U=e=>((0,i.dD)("data-v-daf9b9c4"),e=e(),(0,i.Cn)(),e),H={class:"mission-card-header py-1 border-bottom"},$={class:"flex-fill text-nowrap"},F={class:"from-to-info d-flex p-2 m-1"},q={style:{width:"140px"}},B={class:"item-name-label"},z={class:"flex-fill"},j={style:{width:"140px"}},Z={class:"item-name-label w-100 text-end"},Q={class:"d-flex justify-content-between p-2 m-1 border-top"},Y={class:"item-name-label"},K={class:"item-name-label"},X=U((()=>(0,i._)("label",{class:"item-name-label"},"VEHICLE",-1))),J={style:{width:"140px"}},ee={class:"item-name-label w-100 text-end"},te={class:"w-100 text-end"};function ae(e,t,a,n,o,l){const r=(0,i.up)("el-button"),d=(0,i.up)("el-step"),c=(0,i.up)("el-steps"),u=(0,i.up)("VehicleInfoCard"),m=(0,i.up)("el-tag"),h=(0,i.up)("el-tooltip");return(0,i.wg)(),(0,i.iD)("div",{class:(0,s.C_)(["mission-card",[1==this.mission.State?"executing":"waiting",o.selectedClassName]])},[(0,i._)("div",H,[(0,i._)("h6",{class:(0,s.C_)(["mx-2 border py-1 px-2 rounded text-light text-nowrap",l.actionTagClass])},(0,s.zw)(l.action),3),(0,i._)("h6",$,"# "+(0,s.zw)(a.mission.TaskName),1),(0,i.Wm)(r,{type:"danger",size:"sm",onClick:t[0]||(t[0]=e=>l.CancelTaskHandler(a.mission.TaskName))},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(1==a.mission.State?e.$t("MissionCard.AbortOrder"):e.$t("MissionCard.CancelOrder")),1)])),_:1})]),(0,i._)("div",F,[(0,i._)("div",q,[(0,i._)("label",B,(0,s.zw)(e.$t("TaskTable.Source")),1),(0,i._)("div",{class:(0,s.C_)(1==this.mission.State?"executing":"")},(0,s.zw)(l.source),3)]),(0,i._)("div",z,[(0,i.Wm)(c,{style:{width:"100%","padding-top":"0px","padding-right":"10px"},active:l.currentStep,"finish-status":"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{style:(0,s.j5)(l.isCarryOrder?{}:{visibility:"hidden"}),title:e.$t("Move")},null,8,["style","title"]),(0,i.Wm)(d,{style:(0,s.j5)(l.isCarryOrder?{}:{visibility:"hidden"}),title:e.$t("Unload")},null,8,["style","title"]),(0,i.Wm)(d,{title:e.$t("Move")},null,8,["title"]),(0,i.Wm)(d,{title:l.finalStepActionDisplay},null,8,["title"])])),_:1},8,["active"])]),(0,i._)("div",j,[(0,i._)("label",Z,(0,s.zw)(e.$t("TaskTable.Destine")),1),(0,i._)("div",{class:(0,s.C_)(["w-100 text-end",1==this.mission.State?"executing":""])},(0,s.zw)(l.destine),3)])]),(0,i._)("div",Q,[(0,i._)("div",null,[(0,i._)("label",Y,(0,s.zw)(e.$t("TaskTable.RecievedTime")),1),(0,i._)("div",null,(0,s.zw)(l.recieveTime),1)]),(0,i._)("div",null,[(0,i._)("label",K,(0,s.zw)(e.$t("TaskTable.Dispatcher")),1),(0,i._)("div",null,(0,s.zw)(l.dispatcherName),1)]),(0,i._)("div",null,[X,(0,i._)("div",null,[(0,i.Wm)(h,{placement:"bottom-end",effect:"light"},{content:(0,i.w5)((()=>[l.executingVehicleInfo?((0,i.wg)(),(0,i.j4)(u,{key:0,vehicleStateData:l.executingVehicleInfo},null,8,["vehicleStateData"])):(0,i.kq)("",!0)])),default:(0,i.w5)((()=>[(0,i.Wm)(m,{effect:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(l.vehicleName),1)])),_:1})])),_:1})])]),(0,i._)("div",J,[(0,i._)("label",ee,(0,s.zw)(e.$t("TaskTable.CstID")),1),(0,i._)("div",te,(0,s.zw)(l.carrierID),1)])])],2)}var ie=a(30381),se=a.n(ie),ne=a(86952),oe={components:{VehicleInfoCard:ne.Z},data(){return{MapPoints:Object.values(N.p.state.MapData.Points),show:!1,isLeaving:!1,selectedClassName:""}},props:{mission:{type:g.Z,default(){return new g.Z({})}},selected:{type:Boolean,default:!1}},watch:{selected(e){this.selectedClassName=e?"selected":""}},computed:{action(){const e=this.mission.Action;switch(e){case 0:return this.$t("Move");case 1:return this.$t("Unload");case 7:return this.$t("Load");case 8:return this.$t("Charge");case 9:return this.$t("Transfer");case 12:return this.$t("Park");case 17:return this.$t("DeepCharge");default:return e}},actionTagClass(){return this.isCarryOrder?"bg-primary":this.isChargeOrder?"bg-success":"bg-dark"},isCarryOrder(){return 9==this.mission.Action},isChargeOrder(){return 8==this.mission.Action||17==this.mission.Action},finalStepActionDisplay(){const e=this.mission.Action;switch(e){case 0:return"Destine";case 1:return this.$t("Unload");case 7:return this.$t("Load");case 8:return this.$t("Charge");case 9:return this.$t("Load");case 12:return this.$t("Park");case 17:return this.$t("DeepCharge");default:return e}},vehicleName(){return""==this.mission.DesignatedAGVName?"Not Assigned":this.mission.DesignatedAGVName},recieveTime(){return se()(this.mission.RecieveTime).format("M/D HH:mm:ss")},state(){return this.mission.StateName+`(${this.mission.State})`},source(){if(!this.isCarryOrder)return"-";const e=this.mission.From_Slot<0?0:this.mission.From_Slot;return this.GetStationName(this.mission.From_Station)+`(Slot:${e})`},destine(){const e=this.mission.To_Slot<0?0:this.mission.To_Slot,t=this.GetStationName(this.mission.To_Station);return 0==this.mission.Action?t:`${t}(Slot:${e})`},carrierID(){return"-1"==this.mission.Carrier_ID?"":this.mission.Carrier_ID},dispatcherName(){return this.mission.DispatcherName},currentStep(){const e=this.mission.currentProgress;return 2==e?0:4==e?1:3==e?2:5==e?3:0},executingVehicleInfo(){if(!this.vehicleName||""==this.vehicleName)return;const e=_.sn.getters.AGVStatesData;return e.find((e=>e.AGV_Name==this.vehicleName))}},methods:{GetStationName(e){if(-1==e)return"-";var t=this.MapPoints.find((t=>t.TagNumber+""==e));return t?t.Graph.Display:e},CancelTaskHandler(e){this.cancelTaskName=e;e.includes("HR");this.$swal.fire({title:"確定要取消任務?",text:"任務ID "+e,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.SendCancelTaskRequest()}))},async SendCancelTaskRequest(){try{await A.J8.Cancel(this.mission.TaskName)}catch(e){e.response&&401===e.response.status&&(console.error("Unauthorized access. Please log in again."),_.HP.commit("setUser",null),this.$swal.fire({text:"",title:"請先進行登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{bus.emit("/show-login-view-invoke")})))}}},mounted(){},beforeUnmount(){this.isLeaving=!0}},le=a(83744);const re=(0,le.Z)(oe,[["render",ae],["__scopeId","data-v-daf9b9c4"]]);var de=re,ce={components:{MissionCard:de},props:{IncompletedTaskList:{type:Array,default(){return new g.Z({})}},height:{type:String,default(){return"260px"}},display_mode:{type:String,default(){return"table"}},taskIDSelected:{type:String,default:""}},data(){return{showCancelTaskConfirm:!1,cancelTaskName:"",columnsSizeSetting:[new L("From_Station",100),new L("To_Station",100)],selectedStateFilters:[],selectedActionFilters:[],RunningTaskStateOptions:P,TaskActionFileterOptions:E,TaskActionTagTypes:x}},computed:{WaitingForExecutTasks(){return this.IncompletedTaskList.filter((e=>5==e.State))},ExecutingTasks(){return this.IncompletedTaskList.filter((e=>1==e.State))},taskCancelable(){return _.HP.getters.IsLogin},MapPoints(){return Object.values(N.p.state.MapData.Points)},taskWithSorted(){let e=this.IncompletedTaskList;return this.selectedStateFilters.length>0&&(e=e.filter((e=>this.selectedStateFilters.includes(e.State)))),this.selectedActionFilters.length>0&&(e=e.filter((e=>this.selectedActionFilters.includes(e.Action)))),e}},methods:{getColumnSize(e="",t=100){var a=this.columnsSizeSetting.find((t=>t.propName==e));return a?a.width:t},HandleHeaderDragEnd(e,t,a,i){let s=a.property,n=this.columnsSizeSetting.find((e=>e.propName==s));n?n.width=e:this.columnsSizeSetting.push(new L(s,e)),G("runningTaskTable-column-size",this.columnsSizeSetting)},filterTaskState(e,t,a){return console.log(t["State"],e),t["State"]===e},filterTaskAction(e,t){return t.Action===e},CancelTaskHandler(e){this.cancelTaskName=e;e.includes("HR");this.$swal.fire({title:"確定要取消任務?",text:"任務ID "+e,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&this.SendCancelTaskRequest()}))},async SendCancelTaskRequest(){try{await A.J8.Cancel(this.cancelTaskName)}catch(e){e.response&&401===e.response.status&&(console.error("Unauthorized access. Please log in again."),_.HP.commit("setUser",null),this.$swal.fire({text:"",title:"請先進行登入",icon:"warning",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((()=>{W.Z.emit("/show-login-view-invoke")})))}},GetTaskStateType(e){return I(e)},GetStationName(e){if(-1==e)return"-";var t=this.MapPoints.find((t=>t.TagNumber+""==e));return t?t.Graph.Display:e},row_class_name({row:e,rowIndex:t}){return e.IsHighestPriorityTask?"highest-priority-task-row":"task-row"},handleFilterChange(e){this.selectedStateFilters=e.State||[],this.selectedActionFilters=e.Action||[]}},mounted(){this.columnsSizeSetting=R("runningTaskTable-column-size")}};const ue=(0,le.Z)(ce,[["render",V]]);var me=ue;const he={class:"completed-task-table"},pe={key:0},ge={key:0};function _e(e,t,a,n,o,l){const r=(0,i.up)("el-table-column"),d=(0,i.up)("el-tag"),c=(0,i.up)("el-tooltip"),u=(0,i.up)("el-button"),m=(0,i.up)("el-table");return(0,i.wg)(),(0,i.iD)("div",he,[(0,i.Wm)(m,{"header-cell-style":{color:"black",backgroundColor:"white"},data:l.SortedOrders,"row-key":"TaskName",border:"",height:a.height,"row-class-name":l.row_class_name,"empty-text":e.$t("TaskTable.NoTasks"),onFilterChange:l.handleFilterChange},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{label:e.$t("TaskTable.TaskName"),prop:"TaskName",width:"180","show-overflow-tooltip":""},null,8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.ExcuteAgvName"),prop:"DesignatedAGVName",width:"100","show-overflow-tooltip":""},null,8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.RecievedTime"),prop:"RecieveTime_Formated",width:"100"},null,8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.FinishTime"),prop:"FinishTime_Formated",width:"100"},null,8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.TaskStatus"),prop:"StateName",filters:o.CompletedTaskStateOptions,"column-key":"State","filter-method":l.filterTaskState,width:"80"},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{content:e.row.State+"",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{effect:"dark",type:l.GetTaskStateType(e.row.State)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.StateName),1)])),_:2},1032,["type"])])),_:2},1032,["content"])])),_:1},8,["label","filters","filter-method"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Action"),prop:"ActionName",filters:o.TaskActionFileterOptions,"filter-method":l.filterTaskAction,width:"80"},{default:(0,i.w5)((e=>[(0,i.Wm)(d,{type:o.TaskActionTagTypes[e.row.Action]||o.TaskActionTagTypes.default},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(e.row.ActionName),1)])),_:2},1032,["type"])])),_:1},8,["label","filters","filter-method"]),(0,i.Wm)(r,{label:e.$t("TaskTable.CstID"),prop:"Carrier_ID"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,s.zw)("-1"==e.row.Carrier_ID?"":e.row.Carrier_ID),1)])),_:1},8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Source")},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{content:"Tag:"+e.row.From_Station,placement:"right","popper-class":"bg-primary"},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,s.zw)(l.GetStationName(e.row.From_Station)),1)])),_:2},1032,["content"]),"-1"!=e.row.From_Slot?((0,i.wg)(),(0,i.iD)("div",pe,"(Slot:"+(0,s.zw)(e.row.From_Slot)+")",1)):(0,i.kq)("",!0)])),_:1},8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Destine")},{default:(0,i.w5)((e=>[(0,i.Wm)(c,{content:"Tag:"+e.row.To_Station,placement:"right","popper-class":"bg-primary"},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,s.zw)(l.GetStationName(e.row.To_Station)),1)])),_:2},1032,["content"]),"-1"!=e.row.To_Slot?((0,i.wg)(),(0,i.iD)("div",ge,"(Slot:"+(0,s.zw)(e.row.To_Slot)+")",1)):(0,i.kq)("",!0)])),_:1},8,["label"]),(0,i.Wm)(r,{label:e.$t("TaskTable.Dispatcher"),prop:"DispatcherName",width:"100"},null,8,["label"]),l.IsUserLogined?((0,i.wg)(),(0,i.j4)(r,{key:0,label:"Action",prop:"DispatcherName",fixed:"right",width:"100"},{default:(0,i.w5)((t=>[(0,i.Wm)(u,{disabled:9==t.row.Action&&t.row.TaskName.toLowerCase().startsWith("m"),type:"primary",size:"small",onClick:e=>l.RedoTask(t.row)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.$t("TaskTable.Reassign")),1)])),_:2},1032,["disabled","onClick"])])),_:1})):(0,i.kq)("",!0)])),_:1},8,["data","height","row-class-name","empty-text","onFilterChange"])])}var we={props:{CompletedTaskList:{type:Array,default(){return[]}},height:{type:String,default(){return"210px"}}},data(){return{selectedStateFilters:[],selectedActionFilters:[],CompletedTaskStateOptions:O,TaskActionFileterOptions:E,TaskActionTagTypes:x}},computed:{MapPoints(){return Object.values(N.p.getters.MapData.Points)},IsUserLogined(){return-1!=_.HP.state.user.Role},SortedOrders(){let e=this.CompletedTaskList;return this.selectedStateFilters.length>0&&(e=e.filter((e=>this.selectedStateFilters.includes(e.State)))),this.selectedActionFilters.length>0&&(e=e.filter((e=>this.selectedActionFilters.includes(e.Action)))),e}},methods:{GetTaskStateType(e){return I(e)},GetStationName(e){if(-1==e)return"-";var t=this.MapPoints.find((t=>t.TagNumber+""==e));return t?t.Graph.Display:e},row_class_name({row:e,rowIndex:t}){return"task-row"},async RedoTask(e=new g.Z({})){let t=1==e.Action||9==e.Action,a=`\n          <div class="w-100 text-start text-primary">${this.$t("TaskTable.TaskName")}</div>\n          <div class="w-100 text-start my-2 px-3 font-weight-bold">${e.TaskName}</div>\n          <div class="w-100 text-start text-primary">${this.$t("TaskTable.Action")}</div>\n          <div class="w-100 text-start my-2 px-3 font-weight-bold">${e.ActionName}</div>\n          <div class="w-100 text-start text-primary">${this.$t("TaskTable.ExcuteAgvName")}</div>\n          <div class="w-100 text-start my-2 px-3 font-weight-bold">${e.DesignatedAGVName}</div>\n          <div class="w-100 text-start text-primary">${this.$t("TaskTable.Source")}</div>\n          <div class="w-100 text-start my-2 px-3 font-weight-bold">${this.GetStationName(e.From_Station)} _Slot: ${e.From_Slot}</div>\n          <div class="w-100 text-start text-primary">${this.$t("TaskTable.Destine")}</div>\n          <div class="w-100 text-start my-2 px-3 font-weight-bold">${this.GetStationName(e.To_Station)} _Slot: ${e.To_Slot}</div>`;t&&(a+=`<div class="w-100 text-end mt-3 border-top pt-2">\n            <input type="checkbox" id="autoSelectVehicle" class="me-1" style="height:24px; width:24px; cursor:pointer;">\n            <label for="autoSelectVehicle" style="font-size:25px; cursor:pointer;">${this.$t("TaskTable.AutoSelectVehicle")}</label>\n          </div>`);const i=await this.$swal.fire({title:this.$t("ConfirmRedoTask"),html:`<div class="border rounded p-2">\n          ${a}\n        </div>`,icon:"question",showCancelButton:!0,confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),customClass:"dispatch-fail-swal",preConfirm:()=>{const e=document.getElementById("autoSelectVehicle");return{autoSelectVehicle:!!e&&e.checked}}});if(!i.isConfirmed)return;const s=await A.J8.RedoTask(e,i.value.autoSelectVehicle);200==s.status&&s.data.confirm?this.$swal.fire({title:this.$t("RedoTaskSuccess"),icon:"success"}):this.$swal.fire({title:this.$t("RedoTaskFail"),icon:"error",html:`<div class="text-danger">${s.data.message}</div> <div class="text-danger border-top pt-2">${s.data.message_en}</div>`,customClass:"dispatch-fail-swal"})},filterTaskState(e,t){return t.State===e},filterTaskAction(e,t){return t.Action===e},handleFilterChange(e){this.selectedStateFilters=e.State||[],this.selectedActionFilters=e.Action||[]}}};const fe=(0,le.Z)(we,[["render",_e]]);var ye=fe,ve={components:{RunningTaskTable:me,CompletedTaskTable:ye},props:{display_mode:{type:String,default:"tabs"},show_card_title:{type:Boolean,default:!0},height:{type:String,defualt:"310px"},taskIDSelected:{type:String,default:""}},data(){return{showCancelTaskConfirm:!1,cancelTaskName:"",ShowSettingsDrawer:!1,Settings:{ShowTrafficTask:!0}}},mounted(){},computed:{taskCancelable(){return _.HP.getters.IsLogin},IncompletedTaskListTbData(){return this.Settings.ShowTrafficTask?this.IncompletedTaskList:this.IncompletedTaskList.filter((e=>!e.DispatcherName.toUpperCase().includes("TRAFFIC")))},CompletedTaskListTbData(){return this.Settings.ShowTrafficTask?this.CompletedTaskList:this.CompletedTaskList.filter((e=>!e.DispatcherName.toUpperCase().includes("TRAFFIC")))},IncompletedTaskList(){return _.Ys.getters.IncompletedTaskList},CompletedTaskList(){return _.Ys.getters.CompletedTaskList}},methods:{}};const Se=(0,le.Z)(ve,[["render",p],["__scopeId","data-v-19b5288c"]]);var be=Se},60351:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Bs}});var i=a(66252),s=a(3577),n=a(49963);const o=e=>((0,i.dD)("data-v-42e90108"),e=e(),(0,i.Cn)(),e),l={class:"d-flex flex-row h-100"},r={class:"flex-fill d-flex flex-column"},d={key:0,class:"w-100 bg-primary text-light rounded p-2 select-mode"},c={class:"d-flex h-100",style:{"overflow-y":"hidden"}},u={key:0,class:"p-0 m-0 w-100"},m={key:1,class:"tab-open text-start"},h={class:"p-2 action-buttons border-bottom"},p={class:"designer"},g=o((()=>(0,i._)("span",{class:"designer-collapse-title"},"路網編輯",-1))),w={class:"text-start border p-3"},f=o((()=>(0,i._)("span",{class:"designer-collapse-title"},"地圖與網格",-1))),y={class:"border p-3"},v=o((()=>(0,i._)("span",{class:"designer-collapse-title"},"樣式",-1))),S={class:"border p-3"},b={class:"w-100 h-100 d-flex",style:{position:"relative"}},C={class:"notifiers",style:{position:"absolute",width:"622px",margin:"12px 60px"}},k={style:{position:"absolute",right:"10px",top:"6px"},class:"d-flex"},T={class:"notify-and-coor-container d-flex"},D={key:1,class:"cursour-coordination-show d-flex flex-column"},V={class:"grid-size-text"},A=["id"],I={key:2},x={key:3},E={class:"custom-buttons"},M=o((()=>(0,i._)("i",{class:"bi bi-house-door-fill"},null,-1))),P=[M],O={key:2,class:"options bg-light border-start text-start px-1 py-3"},N={key:1,class:"rounded d-flex flex-column"},L={class:"border-bottom"},G={class:"mx-1"},R=o((()=>(0,i._)("div",null,[(0,i.Uk)(" ■ Slam:點位位置使用真實座標 "),(0,i._)("br"),(0,i.Uk)("■ 路網:點位顯示位置可隨意變更。 ")],-1))),W={key:3},U={class:"mx-1"},H={class:"mx-1"},$={key:4},F={class:"mx-1"},q={key:5},B={class:"mx-1"},z={key:6},j={class:"mx-1"},Z={key:7,class:"rounded"},Q=o((()=>(0,i._)("span",{class:"mx-1"},"圖例顯示",-1))),Y={class:"rounded"},K=o((()=>(0,i._)("span",{class:"mx-1"},"Rack顯示",-1))),X={key:8,class:"rounded"},J=o((()=>(0,i._)("span",{class:"mx-1"},"Pan/Zoom",-1))),ee={class:"rounded"},te=o((()=>(0,i._)("span",{class:"mx-1"},"Search",-1))),ae={key:9,class:"rounded"},ie=o((()=>(0,i._)("span",{class:"mx-1"},"AGV上報點位模式",-1))),se={class:"bg-light text-start d-flex py-2"};function ne(e,t,a,o,_,M){const ne=(0,i.up)("b-button"),oe=(0,i.up)("el-radio-button"),le=(0,i.up)("el-radio-group"),re=(0,i.up)("el-form-item"),de=(0,i.up)("el-form"),ce=(0,i.up)("el-collapse-item"),ue=(0,i.up)("el-input-number"),me=(0,i.up)("el-divider"),he=(0,i.up)("el-button"),pe=(0,i.up)("ImageEditor"),ge=(0,i.up)("el-dialog"),_e=(0,i.up)("el-switch"),we=(0,i.up)("el-color-picker"),fe=(0,i.up)("el-slider"),ye=(0,i.up)("el-collapse"),ve=(0,i.up)("el-alert"),Se=(0,i.up)("NotifyDisplay"),be=(0,i.up)("BuildToolContainer"),Ce=(0,i.up)("ActionUndoTool"),ke=(0,i.up)("AlignmentToos"),Te=(0,i.up)("RackStatusDisplay"),De=(0,i.up)("VehicleBatteryStatusDisplay"),Ve=(0,i.up)("MapLegend"),Ae=(0,i.up)("el-tooltip"),Ie=(0,i.up)("el-radio"),xe=(0,i.up)("el-option"),Ee=(0,i.up)("el-select"),Me=(0,i.up)("MapPointSettingDrawer"),Pe=(0,i.up)("MapPathSettingDrawer"),Oe=(0,i.up)("MapRegionEditDrawer"),Ne=(0,i.up)("el-tag"),Le=(0,i.up)("el-table-column"),Ge=(0,i.up)("el-table"),Re=(0,i.up)("ContextMenuContainer"),We=(0,i.Q2)("loading");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",{id:"map",class:"map-component",key:_.renderKey},[(0,i._)("div",l,[(0,i._)("div",r,[_.IsSelectAGVMode?((0,i.wg)(),(0,i.iD)("div",d,"選擇 AGV")):(0,i.kq)("",!0),_.IsSelectEQStationMode?((0,i.wg)(),(0,i.iD)("div",{key:1,class:(0,s.C_)(["w-100 rounded p-1 select-mode","charge"==_.TaskDispatchOptions.action_type||"destine"==_.TaskDispatchOptions.direction?"select-destine-notify":"select-source-notify"])},(0,s.zw)("charge"==_.TaskDispatchOptions.action_type?"選擇[充電站]":`${"source"==_.TaskDispatchOptions.direction?e.$t("Map.Notification.SelectSource"):e.$t("Map.Notification.SelectDestine")}`),3)):(0,i.kq)("",!0),(0,i._)("div",c,["edit"==_.EditorOption.EditMode&&a.editable?((0,i.wg)(),(0,i.iD)("div",{key:0,class:(0,s.C_)([_.left_tab_class_name,"border bg-light"])},["tab-close"==_.left_tab_class_name?((0,i.wg)(),(0,i.iD)("div",u,[(0,i._)("i",{onClick:t[0]||(t[0]=()=>{_.left_tab_class_name="tab-open"==_.left_tab_class_name?"tab-close":"tab-open"}),class:"bi bi-chevron-double-right"})])):((0,i.wg)(),(0,i.iD)("div",m,[(0,i._)("i",{onClick:t[1]||(t[1]=()=>{_.left_tab_class_name="tab-open"==_.left_tab_class_name?"tab-close":"tab-open"}),class:"bi bi-chevron-double-left"}),(0,i._)("div",h,[(0,i.Wm)(ne,{size:"sm",variant:"primary",onClick:M.HandlerSaveBtnClick},{default:(0,i.w5)((()=>[(0,i.Uk)("儲存")])),_:1},8,["onClick"]),(0,i.Wm)(ne,{size:"sm",variant:"danger",onClick:M.ReloadMap},{default:(0,i.w5)((()=>[(0,i.Uk)("重新載入")])),_:1},8,["onClick"]),(0,i.Wm)(ne,{size:"sm",variant:"danger",onClick:M.ClearMap},{default:(0,i.w5)((()=>[(0,i.Uk)("重置圖資")])),_:1},8,["onClick"])]),(0,i._)("div",p,[(0,i.Wm)(ye,{modelValue:_.designToolCollapseActive,"onUpdate:modelValue":t[20]||(t[20]=e=>_.designToolCollapseActive=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(ce,{name:"1"},{title:(0,i.w5)((()=>[g])),default:(0,i.w5)((()=>[(0,i._)("div",w,[(0,i.Wm)(de,{size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(re,{label:"點位"},{default:(0,i.w5)((()=>[(0,i.Wm)(le,{disabled:"edit"!=_.EditorOption.EditMode,modelValue:_.EditorOption.EditAction,"onUpdate:modelValue":t[2]||(t[2]=e=>_.EditorOption.EditAction=e),onChange:t[3]||(t[3]=()=>{M.RemoveAllInteractions(),M.RemoveInteraction(_.draw_forbid_regions_interaction),M.AddEditMapInteraction()}),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(oe,{size:"small",value:"add-station"},{default:(0,i.w5)((()=>[(0,i.Uk)("新增點位[1]")])),_:1}),(0,i.Wm)(oe,{size:"small",value:"edit-station"},{default:(0,i.w5)((()=>[(0,i.Uk)("編輯點位[2]")])),_:1}),(0,i.Wm)(oe,{size:"small",value:"remove-station"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除點位[3]")])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1}),(0,i.Wm)(re,{label:"路徑"},{default:(0,i.w5)((()=>[(0,i.Wm)(le,{class:"mx-1",disabled:"edit"!=_.EditorOption.EditMode,modelValue:_.EditorOption.EditAction,"onUpdate:modelValue":t[4]||(t[4]=e=>_.EditorOption.EditAction=e),onChange:t[5]||(t[5]=()=>{M.RemoveAllInteractions(),_.PathEditTempStore=[],M.RemoveInteraction(_.draw_forbid_regions_interaction),M.AddEditMapInteraction()}),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(oe,{size:"small",value:"add-path"},{default:(0,i.w5)((()=>[(0,i.Uk)("新增路徑[4]")])),_:1}),(0,i.Wm)(oe,{size:"small",value:"edit-path"},{default:(0,i.w5)((()=>[(0,i.Uk)("編輯路徑[5]")])),_:1}),(0,i.Wm)(oe,{size:"small",value:"remove-path"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除路徑[6]")])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1}),(0,i.Wm)(re,{label:"區域"},{default:(0,i.w5)((()=>[(0,i.Wm)(le,{class:"mx-1",disabled:"edit"!=_.EditorOption.EditMode,modelValue:_.EditorOption.EditAction,"onUpdate:modelValue":t[7]||(t[7]=e=>_.EditorOption.EditAction=e),size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(oe,{onClick:t[6]||(t[6]=e=>M.HandleAddForbidRegionClicked(_.EditorOption.AddRegionMode.Mode)),size:"small",value:"add-forbid-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("新增管制區[7]")])),_:1}),(0,i.Wm)(oe,{onClick:M.HandleEditForbidRegionClicked,size:"small",value:"edit-forbid-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("編輯管制區[8]")])),_:1},8,["onClick"]),(0,i.Wm)(oe,{onClick:M.HandleDeleteForbidRegionClicked,size:"small",value:"remove-forbid-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除管制區[9]")])),_:1},8,["onClick"]),(0,i.Wm)(oe,{onClick:M.HandleDrawGlobalPathRegionClicked,size:"small",value:"add-global-path-region"},{default:(0,i.w5)((()=>[(0,i.Uk)("繪製道路區域")])),_:1},8,["onClick"])])),_:1},8,["disabled","modelValue"])])),_:1})])),_:1})])])),_:1}),(0,i.Wm)(ce,{name:"2"},{title:(0,i.w5)((()=>[f])),default:(0,i.w5)((()=>[(0,i._)("div",y,[(0,i.Wm)(de,{size:"large","label-width":"120","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(re,{label:"網格尺寸(公尺)"},{default:(0,i.w5)((()=>[(0,i.Wm)(ue,{min:1,step:.1,onChange:M.ModifyGridSize,modelValue:_.MapGridSizeStore,"onUpdate:modelValue":t[8]||(t[8]=e=>_.MapGridSizeStore=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(re,{label:"水平Offset(公尺)"},{default:(0,i.w5)((()=>[(0,i.Wm)(ue,{step:.1,onChange:M.ModifyGridOffset,modelValue:_.MapGridSizeXOffset,"onUpdate:modelValue":t[9]||(t[9]=e=>_.MapGridSizeXOffset=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(re,{label:"垂直Offset(公尺)"},{default:(0,i.w5)((()=>[(0,i.Wm)(ue,{step:.1,onChange:M.ModifyGridOffset,modelValue:_.MapGridSizeYOffset,"onUpdate:modelValue":t[10]||(t[10]=e=>_.MapGridSizeYOffset=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(re,{label:"旋轉"},{default:(0,i.w5)((()=>[(0,i.Wm)(ue,{step:1,min:-180,max:180,onChange:M.ModifyMapRotation,modelValue:_.MapRotation,"onUpdate:modelValue":t[11]||(t[11]=e=>_.MapRotation=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(me),(0,i.Wm)(re,{class:"",label:"地圖背景編輯"},{default:(0,i.w5)((()=>[(0,i.Wm)(he,{size:"large",onClick:M.ImageEditClick},{default:(0,i.w5)((()=>[(0,i.Uk)("上傳與修改")])),_:1},8,["onClick"]),(0,i.Wm)(ge,{modelValue:_.ShowImageEditorDialog,"onUpdate:modelValue":t[12]||(t[12]=e=>_.ShowImageEditorDialog=e),class:""},{default:(0,i.w5)((()=>[(0,i.Wm)(pe,{onOnCropDone:M.HandleImageCropedDone,ref:"imageEditor"},null,8,["onOnCropDone"])])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(re,{label:"調整圖片位置"},{default:(0,i.w5)((()=>[(0,i.Wm)(_e,{size:"large","active-text":"開啟","inactive-text":"關閉","inline-prompt":"",modelValue:_.DragBackgroundImageMode,"onUpdate:modelValue":t[13]||(t[13]=e=>_.DragBackgroundImageMode=e),onChange:t[14]||(t[14]=()=>{_.new_map_img_extent=M.map_img_extent,"visible"!=_.map_image_display&&_.DragBackgroundImageMode&&(_.map_image_display="visible",M.SlamImageDisplayOptHandler())})},null,8,["modelValue"])])),_:1}),(0,i.Wm)(me),(0,i.Wm)(re,{label:"重置路網顯示"},{default:(0,i.w5)((()=>[(0,i.Wm)(he,{type:"danger",onClick:M.ResetRouteModeDisplay},{default:(0,i.w5)((()=>[(0,i.Uk)("重置")])),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1}),(0,i.Wm)(ce,{name:"3"},{title:(0,i.w5)((()=>[v])),default:(0,i.w5)((()=>[(0,i._)("div",S,[(0,i.Wm)(de,{size:"large","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(me,{"content-position":"left"},{default:(0,i.w5)((()=>[(0,i.Uk)("路徑")])),_:1}),(0,i.Wm)(re,{label:"顏色"},{default:(0,i.w5)((()=>[(0,i.Wm)(we,{"show-alpha":"",size:"large",modelValue:_.MapStyles.PathColor,"onUpdate:modelValue":t[15]||(t[15]=e=>_.MapStyles.PathColor=e),onActiveChange:M.HandlePathColorSelected},null,8,["modelValue","onActiveChange"])])),_:1}),(0,i.Wm)(me,{"content-position":"left"},{default:(0,i.w5)((()=>[(0,i.Uk)("一般點位")])),_:1}),(0,i.Wm)(re,{label:"顯示顏色"},{default:(0,i.w5)((()=>[(0,i.Wm)(we,{"show-alpha":"",size:"large",modelValue:_.MapStyles.NormalPointNameColor,"onUpdate:modelValue":t[16]||(t[16]=e=>_.MapStyles.NormalPointNameColor=e),onActiveChange:M.HandleNormalPointNameColorSelected},null,8,["modelValue","onActiveChange"])])),_:1}),(0,i.Wm)(re,{label:"字體大小"},{default:(0,i.w5)((()=>[(0,i.Wm)(fe,{onChange:M.HandleNormalStationTextSizeChanged,size:"large",modelValue:_.MapStyles.NormalPointTextFontSize,"onUpdate:modelValue":t[17]||(t[17]=e=>_.MapStyles.NormalPointTextFontSize=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(me,{"content-position":"left"},{default:(0,i.w5)((()=>[(0,i.Uk)("設備點位")])),_:1}),(0,i.Wm)(re,{label:"顯示顏色"},{default:(0,i.w5)((()=>[(0,i.Wm)(we,{"show-alpha":"",size:"large",modelValue:_.MapStyles.WorkStationPointNameColor,"onUpdate:modelValue":t[18]||(t[18]=e=>_.MapStyles.WorkStationPointNameColor=e),onActiveChange:M.HandleWorkStationNameColorSelected},null,8,["modelValue","onActiveChange"])])),_:1}),(0,i.Wm)(re,{label:"字體大小"},{default:(0,i.w5)((()=>[(0,i.Wm)(fe,{onChange:M.HandleWorkStationTextSizeChanged,size:"large",modelValue:_.MapStyles.WorkStationPointTextFontSize,"onUpdate:modelValue":t[19]||(t[19]=e=>_.MapStyles.WorkStationPointTextFontSize=e)},null,8,["onChange","modelValue"])])),_:1})])),_:1})])])),_:1})])),_:1},8,["modelValue"])])]))],2)):(0,i.kq)("",!0),(0,i._)("div",b,[(0,i._)("div",C,[_.showRedrawControl?((0,i.wg)(),(0,i.j4)(ve,{key:0,style:{"margin-top":"6px","z-index":"4",border:"2px solid #409EFF"},title:"區域重繪",type:"info",closable:!1,class:"redraw-control-alert"},{default:(0,i.w5)((()=>[(0,i._)("div",k,[(0,i.Wm)(he,{type:"danger",onClick:M.HandleCancleRegionRedraw},{default:(0,i.w5)((()=>[(0,i.Uk)("取消")])),_:1},8,["onClick"]),(0,i.Wm)(he,{disabled:!_.isRedrawConfirmable,type:"info",onClick:M.HandleResetRegionRedraw},{default:(0,i.w5)((()=>[(0,i.Uk)("重置")])),_:1},8,["disabled","onClick"]),(0,i.Wm)(he,{disabled:!_.isRedrawConfirmable,type:"primary",onClick:M.HandleCompleteRegionRedraw},{default:(0,i.w5)((()=>[(0,i.Uk)("完成")])),_:1},8,["disabled","onClick"])])])),_:1})):(0,i.kq)("",!0)]),(0,i._)("div",T,[a.editable?((0,i.wg)(),(0,i.j4)(Se,{key:0,EditorOption:_.EditorOption,DragBackgroundImageMode:_.DragBackgroundImageMode},null,8,["EditorOption","DragBackgroundImageMode"])):(0,i.kq)("",!0),((0,i.wg)(),(0,i.iD)("div",D,[(0,i._)("span",{style:(0,s.j5)("dark"==_.map_theme_select?"color:white":"color:rgb(24, 24, 24)")},(0,s.zw)(M.MouseCoordinationDisplay),5),(0,i._)("div",V,"Grid Size:"+(0,s.zw)(M.MapGridSize)+"m",1)]))]),M.mapToolShow?((0,i.wg)(),(0,i.j4)(be,{key:0,class:"build-tool",operation:_.EditorOption.EditAction,onOnRegionToolComponentChange:M.HandleRegionToolComponentChange,onOnPathToolComponentChange:M.HandlePathToolComponentChange},null,8,["operation","onOnRegionToolComponentChange","onOnPathToolComponentChange"])):(0,i.kq)("",!0),(0,i._)("div",{id:a.id,style:(0,s.j5)("dark"==_.map_theme_select?_.map_theme_dark:{}),class:"agv_map flex-fll border"},[a.editable?((0,i.wg)(),(0,i.j4)(Ce,{key:0,class:"action-undo-tool",ref:"undoTool",onOnUnDo:M.HandleUnDoBtnClicked},null,8,["onOnUnDo"])):(0,i.kq)("",!0),0!=_.SelectedFeatures.length?((0,i.wg)(),(0,i.j4)(ke,{key:1,map_display_mode:_.map_display_mode,selectedFeatures:_.SelectedFeatures,rotation:_.MapRotation,class:"align-tool"},null,8,["map_display_mode","selectedFeatures","rotation"])):(0,i.kq)("",!0),(0,i.wy)((0,i._)("div",{class:"multi-select-info"},"已選擇 ["+(0,s.zw)(_.SelectedFeatures.length)+"] 個點位",513),[[n.F8,0!=_.SelectedFeatures.length]]),a.rackInfoShow&&_.rackVisible?((0,i.wg)(),(0,i.iD)("div",I,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(M.RackPortPointFeatures,(e=>((0,i.wg)(),(0,i.j4)(Te,{key:e.get("data")?.TagNumber+"-rack-display"||0,pointData:e.get("data"),dynamicStyle:M.getRackCargoExistStateFeatureLabelStyle(e),tagNumber:e.get("data")?.TagNumber},null,8,["pointData","dynamicStyle","tagNumber"])))),128))])):(0,i.kq)("",!0),"visible"==_.agv_display&&_.vehicleBatVisible?((0,i.wg)(),(0,i.iD)("div",x,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.AGVFeatures,((e,t)=>((0,i.wg)(),(0,i.j4)(De,{key:"vehicle_bat_status_"+t,dynamicStyle:M.getVehicleBatStatusDisplayStyle(e.agv_feature),agvName:e.agv_feature.get("agvname")},null,8,["dynamicStyle","agvName"])))),128))])):(0,i.kq)("",!0)],12,A),!a.editable&&_.legendShow&&"locus_map"!=a.id?((0,i.wg)(),(0,i.j4)(Ve,{key:1,class:"map-ledgend border rounded",style:(0,s.j5)(M.LegendStyle)},null,8,["style"])):(0,i.kq)("",!0),(0,i._)("div",E,[(0,i.Wm)(Ae,{content:"原點",placement:"right"},{default:(0,i.w5)((()=>[(0,i._)("button",{onClick:t[21]||(t[21]=(...e)=>M.GoOriginal&&M.GoOriginal(...e))},P)])),_:1})]),M.IsUserLogin?((0,i.wg)(),(0,i.iD)("div",O,[(0,i.kq)("",!0),a.station_show&&!M.IsOpUsing?((0,i.wg)(),(0,i.iD)("div",N,[(0,i._)("span",L,(0,s.zw)(e.$t("Map.Options.DisplayMode")),1),(0,i.Wm)(le,{modelValue:_.station_name_display_mode,"onUpdate:modelValue":t[23]||(t[23]=e=>_.station_name_display_mode=e),onChange:M.StationNameDisplayOptHandler},{default:(0,i.w5)((()=>[(0,i.Wm)(Ie,{value:"index",size:"large"},{default:(0,i.w5)((()=>[(0,i.Uk)("Index")])),_:1}),(0,i.Wm)(Ie,{value:"name",size:"large"},{default:(0,i.w5)((()=>[(0,i.Uk)("Name")])),_:1}),(0,i.Wm)(Ie,{value:"name_tag",size:"large"},{default:(0,i.w5)((()=>[(0,i.Uk)("Name & Tag")])),_:1}),(0,i.Wm)(Ie,{value:"tag",size:"large"},{default:(0,i.w5)((()=>[(0,i.Uk)("Tag")])),_:1})])),_:1},8,["modelValue","onChange"])])):(0,i.kq)("",!0),M.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",{key:2,class:(0,s.C_)(M.mapModeCLass)},[(0,i._)("span",G,(0,s.zw)(e.$t("Map.Options.MapMode")),1),(0,i.Wm)(Ae,{placement:"left"},{content:(0,i.w5)((()=>[R])),default:(0,i.w5)((()=>[(0,i.Wm)(_e,{onChange:M.MapDisplayModeOptHandler,"inactive-value":"router","active-value":"coordination",width:"70",modelValue:_.map_display_mode,"onUpdate:modelValue":t[24]||(t[24]=e=>_.map_display_mode=e),"inline-prompt":"","inactive-text":e.$t("PathNetwork"),"active-text":"Slam","inactive-color":"seagreen"},null,8,["onChange","modelValue","inactive-text"])])),_:1})],2)),a.agv_show?((0,i.wg)(),(0,i.iD)("div",W,[(0,i._)("span",U,(0,s.zw)(e.$t("Map.Options.AgvVisible")),1),(0,i.Wm)(_e,{onChange:M.AgvDisplayOptHandler,"inactive-value":"none","active-value":"visible",width:"70",modelValue:_.agv_display,"onUpdate:modelValue":t[25]||(t[25]=e=>_.agv_display=e),"inline-prompt":"","inactive-text":e.$t("hidden"),"active-text":e.$t("Show"),"inactive-color":"rgb(146, 148, 153)"},null,8,["onChange","modelValue","inactive-text","active-text"]),(0,i._)("span",H,(0,s.zw)(e.$t("Map.Options.AgvBatVisible")),1),(0,i.Wm)(_e,{disabled:"none"==_.agv_display,onChange:t[26]||(t[26]=()=>{M.SaveSettingsToLocalStorage()}),"inactive-value":!1,"active-value":!0,width:"70",modelValue:_.vehicleBatVisible,"onUpdate:modelValue":t[27]||(t[27]=e=>_.vehicleBatVisible=e),"inline-prompt":"","inactive-text":e.$t("hidden"),"active-text":e.$t("Show"),"inactive-color":"rgb(146, 148, 153)"},null,8,["disabled","modelValue","inactive-text","active-text"])])):(0,i.kq)("",!0),M.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",$,[(0,i._)("span",F,(0,s.zw)(e.$t("Map.Options.BackgroundImage")),1),(0,i.Wm)(_e,{modelValue:_.map_image_display,"onUpdate:modelValue":t[28]||(t[28]=e=>_.map_image_display=e),"inactive-value":"none","inactive-text":e.$t("hidden"),"active-value":"visible","active-text":e.$t("Show"),"inactive-color":"rgb(146, 148, 153)","inline-prompt":"",width:"70",onChange:M.SlamImageDisplayOptHandler},null,8,["modelValue","inactive-text","active-text","onChange"])])),M.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",q,[(0,i._)("span",B,(0,s.zw)(e.$t("Map.Options.PathVisible")),1),(0,i.Wm)(_e,{modelValue:_.routePathsVisible,"onUpdate:modelValue":t[29]||(t[29]=e=>_.routePathsVisible=e),"inactive-text":e.$t("hidden"),"active-text":e.$t("Show"),"inline-prompt":"","inactive-color":"rgb(146, 148, 153)",width:"70",onChange:t[30]||(t[30]=e=>{e?"router"==_.map_display_mode?(_.PathLayerForCoordination.setVisible(!1),_.PathLayerForRouter.setVisible(!0)):(_.PathLayerForCoordination.setVisible(!0),_.PathLayerForRouter.setVisible(!1)):(_.PathLayerForCoordination.setVisible(!1),_.PathLayerForRouter.setVisible(!1)),M.HideNormalStations(!e)})},null,8,["modelValue","inactive-text","active-text"])])),M.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",z,[(0,i._)("span",j,(0,s.zw)(e.$t("Map.Options.RegionVisible")),1),(0,i.Wm)(_e,{disabled:"coordination"!=_.map_display_mode,modelValue:_.regionsVisible,"onUpdate:modelValue":t[31]||(t[31]=e=>_.regionsVisible=e),"inactive-text":e.$t("hidden"),"active-text":e.$t("Show"),"inline-prompt":"","inactive-color":"rgb(146, 148, 153)",width:"70",onChange:t[32]||(t[32]=e=>{_.RegionLayer.setVisible(e&&"coordination"==_.map_display_mode)})},null,8,["disabled","modelValue","inactive-text","active-text"])])),a.editable?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",Z,[Q,(0,i.Wm)(_e,{class:"my-2","inactive-text":"OFF","active-text":"ON","inline-prompt":"",width:"70",modelValue:_.legendShow,"onUpdate:modelValue":t[33]||(t[33]=e=>_.legendShow=e),onChange:M.HandleLedgendShowChanged},null,8,["modelValue","onChange"])])),(0,i._)("div",Y,[K,(0,i.Wm)(_e,{class:"my-2","inactive-text":"OFF","active-text":"ON","active-value":!0,"inactive-value":!1,"inline-prompt":"",width:"70",modelValue:_.rackVisible,"onUpdate:modelValue":t[34]||(t[34]=e=>_.rackVisible=e),onChange:t[35]||(t[35]=()=>{M.SaveSettingsToLocalStorage()})},null,8,["modelValue"])]),a.editable?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",X,[J,(0,i.Wm)(_e,{class:"my-2","inactive-text":"Disable","active-text":"Enable","inline-prompt":"",width:"70",modelValue:_.dragActionLock,"onUpdate:modelValue":t[36]||(t[36]=e=>_.dragActionLock=e),onChange:M.HandleDragLockSwitchChanged},null,8,["modelValue","onChange"])])),(0,i._)("div",ee,[te,(0,i.Wm)(Ee,{filterable:"",clearable:"",modelValue:_.searchTag,"onUpdate:modelValue":t[37]||(t[37]=e=>_.searchTag=e),onChange:M.HandleSearchTagSelected},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(M.allPointsSimpleOptions,(e=>((0,i.wg)(),(0,i.j4)(xe,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onChange"])]),a.editable?((0,i.wg)(),(0,i.iD)("div",ae,[(0,i.Wm)(Ae,{content:"開啟後於車載畫面上傳座標資訊後將會自動新增點位至地圖上"},{default:(0,i.w5)((()=>[ie])),_:1}),(0,i.Wm)(_e,{class:"my-2","inactive-text":"OFF","active-text":"ON","inline-prompt":"",width:"70",modelValue:_.agv_upload_coordination_mode,"onUpdate:modelValue":t[38]||(t[38]=e=>_.agv_upload_coordination_mode=e),onChange:M.HandleAGVUploadCorrdinationChanged},null,8,["modelValue","onChange"])])):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])])])]),(0,i.Wm)(Me,{ref:"ptsetting",onOnLeve:M.HandlePtSettingDrawerLeaved,onOnPointSettingChanged:M.PointSettingChangedHandle},null,8,["onOnLeve","onOnPointSettingChanged"]),(0,i.Wm)(Pe,{SettingsChangedHandler:()=>{M.UpdateStationPathLayer(),M.HandlePathTbRowClick(_.SelectedPathData)},onClosed:M.HandlePathSetingDrawerClosed,ref:"path_editor"},null,8,["SettingsChangedHandler","onClosed"]),(0,i.Wm)(Oe,{onClosed:M.HandleForbidRegionEditDrawerClosed,onOnRedraw:M.HandleRegionRedraw,ref:"forbid_region_editor",SettingsChangedHandler:()=>{}},null,8,["onClosed","onOnRedraw"]),(0,i.Wm)(ge,{onClosed:t[41]||(t[41]=()=>{_.selected_path_feature&&M.RestoreOriginalPathStyle(_.selected_path_feature)}),draggable:"",width:"600",title:"路徑選取",modelValue:_.ShowPathSelectDialog,"onUpdate:modelValue":t[42]||(t[42]=e=>_.ShowPathSelectDialog=e)},{default:(0,i.w5)((()=>[(0,i._)("div",se,[(0,i.Wm)(ne,{size:"sm",variant:"success",onClick:t[39]||(t[39]=()=>{_.PathesCandicats.forEach((e=>{e.IsPassable=!0})),M.UpdateStationPathLayer(),M.HandlePathTbRowClick(_.SelectedPathData)})},{default:(0,i.w5)((()=>[(0,i.Uk)("開放所有道路")])),_:1}),(0,i.Wm)(ne,{class:"mx-2",variant:"danger",size:"sm",onClick:t[40]||(t[40]=()=>{_.PathesCandicats.forEach((e=>{e.IsPassable=!1})),M.UpdateStationPathLayer(),M.HandlePathTbRowClick(_.SelectedPathData)})},{default:(0,i.w5)((()=>[(0,i.Uk)("關閉所有道路")])),_:1})]),(0,i.Wm)(Ge,{data:_.PathesCandicats,border:""},{default:(0,i.w5)((()=>[(0,i.Wm)(Le,{label:"ID",prop:"PathID"},{default:(0,i.w5)((e=>[(0,i.Wm)(Ne,{effect:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.PathID),1)])),_:2},1024)])),_:1}),(0,i.Wm)(Le,{label:"起點Index",prop:"StartPtIndex"}),(0,i.Wm)(Le,{label:"終點Index",prop:"EndPtIndex"}),(0,i.Wm)(Le,{label:"狀態",prop:"IsPassable"},{default:(0,i.w5)((e=>[(0,i.Wm)(Ne,{effect:"dark",type:e.row.IsPassable?"success":"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(e.row.IsPassable?"開放":"封閉"),1)])),_:2},1032,["type"])])),_:1}),(0,i.Wm)(Le,null,{default:(0,i.w5)((e=>[(0,i.Wm)(ne,{variant:"primary",onClick:t=>M.HandlePathSelected(e.row)},{default:(0,i.w5)((()=>[(0,i.Uk)("選取")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),(0,i.wy)((0,i.Wm)(Re,{ref:"contextMenu2"},null,512),[[n.F8,!a.editable]])])),[[We,_.loading]])}a(57658);var oe=a(61120),le=a.n(oe),re=a(40809),de=a(81090),ce=a(19649),ue=a(67315),me=a(92083),he=a(60188),pe=a(69242),ge=a(57276),_e=a(47539),we=a(58958),fe=a(51345),ye=a(21280),ve=a(30283),Se=a(81332),be=a(29356),Ce=a(12327),ke=a(56689),Te=a(3138),De=a(63267),Ve=a(20686),Ae=a(13522),Ie=a(14515),xe=a(7517),Ee=a(99022),Me=a(29619),Pe=a(98683),Oe=a(28641),Ne=a(78793),Le=a(53259),Ge=a(79072),Re=a(95320),We=a(25044);const Ue=(0,i._)("div",null," ??? ",-1);function He(e,t,a,s,n,o){const l=(0,i.up)("el-dialog");return(0,i.wg)(),(0,i.j4)(l,{draggable:"",modal:!1,title:"地圖設置",modelValue:n.show,"onUpdate:modelValue":t[0]||(t[0]=e=>n.show=e)},{default:(0,i.w5)((()=>[Ue])),_:1},8,["modelValue"])}var $e={data(){return{show:!1}}},Fe=a(83744);const qe=(0,Fe.Z)($e,[["render",He]]);var Be=qe;const ze=e=>((0,i.dD)("data-v-37832af2"),e=e(),(0,i.Cn)(),e),je={class:"map-point-setting-drawer"},Ze={class:"header border-bottom"},Qe={class:"draw-content w-100"},Ye={class:"text-start py-2 d-flex"},Ke={class:"text-start d-flex"},Xe={class:"settings px-2"},Je=ze((()=>(0,i._)("span",{class:"collapse-title"},"基本設定",-1))),et={class:"d-flex mx-1 py-4 bg-light w-100",style:{"flex-wrap":"wrap",height:"200px"}},tt=ze((()=>(0,i._)("div",{class:"image-slot"},"錯誤",-1))),at=["onClick"],it={class:"tag"},st=ze((()=>(0,i._)("span",null,"ID",-1))),nt=ze((()=>(0,i._)("span",null,"X",-1))),ot=ze((()=>(0,i._)("span",null,"Y",-1))),lt={class:"mx-2 d-flex"},rt=ze((()=>(0,i._)("label",{class:"mx-2",for:""},"等待進入區域時使用此角度",-1))),dt=ze((()=>(0,i._)("label",{class:"mx-2",for:""},"交管停等中使用此角度",-1))),ct=ze((()=>(0,i._)("span",{class:"collapse-title"},"功能設定",-1))),ut={class:"d-flex flex-column"},mt={class:"d-flex"},ht=ze((()=>(0,i._)("i",{class:"bi bi-question-circle information"},null,-1))),pt=ze((()=>(0,i._)("span",{class:"collapse-title"},"註冊點",-1))),gt={class:"text-start"},_t=ze((()=>(0,i._)("span",{class:"collapse-title"},"分區設定",-1))),wt=ze((()=>(0,i._)("span",{class:"collapse-title"},"顯示設定",-1))),ft={class:"d-flex text-offset"},yt=ze((()=>(0,i._)("span",{class:"mx-3"},"X",-1))),vt=ze((()=>(0,i._)("span",{class:"mx-3"},"Y",-1))),St={class:"d-flex text-offset"},bt=ze((()=>(0,i._)("span",{class:"mx-3"},"X",-1))),Ct=ze((()=>(0,i._)("span",{class:"mx-3"},"Y",-1))),kt=ze((()=>(0,i._)("span",{class:"mx-3"},"Rotation",-1))),Tt=ze((()=>(0,i._)("span",{class:"collapse-title"},"進出點位設定",-1)));function Dt(e,t,a,o,l,r){const d=(0,i.up)("b-button"),c=(0,i.up)("el-input"),u=(0,i.up)("el-form-item"),m=(0,i.up)("el-button"),h=(0,i.up)("el-image"),p=(0,i.up)("el-upload"),g=(0,i.up)("el-option"),_=(0,i.up)("el-select"),w=(0,i.up)("el-input-number"),f=(0,i.up)("el-checkbox"),y=(0,i.up)("el-form"),v=(0,i.up)("el-collapse-item"),S=(0,i.up)("el-tooltip"),b=(0,i.up)("el-table-column"),C=(0,i.up)("el-table"),k=(0,i.up)("RegionsSelector"),T=(0,i.up)("el-collapse"),D=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",je,[(0,i.Wm)(D,{modelValue:l.show,"onUpdate:modelValue":t[42]||(t[42]=e=>l.show=e),size:"40%","close-on-press-escape":!0,"close-on-click-modal":!0,"show-close":!1,modal:!0,"modal-class":"modal-style","before-close":r.CancelBtnClickHandle},{header:(0,i.w5)((()=>[(0,i._)("div",Ze,[(0,i._)("h3",null,"點位設定-"+(0,s.zw)(l.index),1)])])),default:(0,i.w5)((()=>[(0,i._)("div",Qe,[(0,i._)("div",Ye,[(0,i.Wm)(d,{variant:"danger",onClick:r.CancelBtnClickHandle},{default:(0,i.w5)((()=>[(0,i.Uk)("離開")])),_:1},8,["onClick"]),(0,i.Wm)(d,{variant:"primary",onClick:r.SaveBtnClickHandle},{default:(0,i.w5)((()=>[(0,i.Uk)("儲存")])),_:1},8,["onClick"]),(0,i.wy)((0,i._)("div",Ke,[(0,i.Wm)(d,{size:"sm",variant:"primary",onClick:r.Regist},{default:(0,i.w5)((()=>[(0,i.Uk)("註冊")])),_:1},8,["onClick"]),(0,i.Wm)(d,{size:"sm",variant:"danger",onClick:r.Unregist},{default:(0,i.w5)((()=>[(0,i.Uk)("解註冊")])),_:1},8,["onClick"])],512),[[n.F8,!0]])]),(0,i._)("div",Xe,[(0,i.Wm)(T,{modelValue:l.activeNames,"onUpdate:modelValue":t[41]||(t[41]=e=>l.activeNames=e),accordion:!1},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{name:"1"},{title:(0,i.w5)((()=>[Je])),default:(0,i.w5)((()=>[(0,i.Wm)(y,{"label-width":"120px","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{label:"Point Index"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:l.index,"onUpdate:modelValue":t[0]||(t[0]=e=>l.index=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"顯示名稱"},{default:(0,i.w5)((()=>[(0,i._)("div",null,[(0,i.Wm)(c,{modelValue:l.pointData_editing.Graph.Display,"onUpdate:modelValue":t[1]||(t[1]=e=>l.pointData_editing.Graph.Display=e)},null,8,["modelValue"])]),(0,i._)("div",null,[(0,i.wy)((0,i.Wm)(m,{onClick:t[2]||(t[2]=e=>l.pointData_editing.Graph.Display=l.BindingEQInfo.Name)},{default:(0,i.w5)((()=>[(0,i.Uk)("使用繫連的EQ名稱")])),_:1},512),[[n.F8,r.IsEQPoint]])])])),_:1}),r.IsWorkStation?((0,i.wg)(),(0,i.j4)(u,{key:0,label:"顯示圖示"},{default:(0,i.w5)((()=>[(0,i._)("div",et,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.EqIcons,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"icon-container mx-2",style:{width:"64px",height:"84px"},key:e},[(0,i.Wm)(h,{style:(0,s.j5)([{border:e==l.pointData_editing.Graph.ImageName?"4px solid rgb(41, 215, 92)":""},{width:"64px",height:"64px",padding:"3px","border-radius":"8px",cursor:"pointer"}]),src:e,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,fit:"cover",onClick:t=>r.HandleImageClick(e)},{error:(0,i.w5)((()=>[tt])),_:2},1032,["style","src","onClick"]),(0,i._)("div",{squared:"",class:"image-name-display",style:{position:"relative",bottom:"26px",width:"100%"},onClick:t=>r.HandleImageClick(e)},(0,s.zw)(e.split("/").pop()),9,at)])))),128)),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.fileList,(e=>((0,i.wg)(),(0,i.j4)(h,{key:e,style:(0,s.j5)([{border:e.url==l.pointData_editing.Graph.ImageName?"3px solid rgb(49, 132, 253)":""},{width:"64px",height:"64px",padding:"3px","border-radius":"8px",cursor:"pointer",border:"1px dashed red"}]),src:e.url,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,fit:"cover",onClick:t=>r.HandleImageClick(e)},null,8,["style","src","onClick"])))),128)),(0,i.Wm)(p,{"file-list":l.fileList,"onUpdate:fileList":t[3]||(t[3]=e=>l.fileList=e),action:r.icon_upload_url,"list-type":"picture-card","auto-upload":!0,"on-success":r.OnIconUploadSuccess,"show-file-list":!1},{default:(0,i.w5)((()=>[(0,i.Uk)("上傳圖示")])),_:1},8,["file-list","action","on-success"])])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(u,{label:"Tag"},{default:(0,i.w5)((()=>[(0,i._)("div",it,[(0,i._)("div",null,[st,(0,i.Wm)(c,{modelValue:l.pointData_editing.TagNumber,"onUpdate:modelValue":t[4]||(t[4]=e=>l.pointData_editing.TagNumber=e),modelModifiers:{number:!0}},null,8,["modelValue"])]),(0,i._)("div",null,[nt,(0,i.Wm)(c,{modelValue:l.pointData_editing.X,"onUpdate:modelValue":t[5]||(t[5]=e=>l.pointData_editing.X=e)},null,8,["modelValue"])]),(0,i._)("div",null,[ot,(0,i.Wm)(c,{modelValue:l.pointData_editing.Y,"onUpdate:modelValue":t[6]||(t[6]=e=>l.pointData_editing.Y=e)},null,8,["modelValue"])])])])),_:1}),(0,i.Wm)(u,{label:"站點類型"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{modelValue:l.pointData_editing.StationType,"onUpdate:modelValue":t[7]||(t[7]=e=>l.pointData_editing.StationType=e),onChange:r.StationTypeOnChange},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.stationTypes,(e=>((0,i.wg)(),(0,i.j4)(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),(0,i.wy)((0,i._)("div",null,[(0,i.Wm)(c,{disabled:"",modelValue:l.BindingEQInfo.Name,"onUpdate:modelValue":t[8]||(t[8]=e=>l.BindingEQInfo.Name=e)},null,8,["modelValue"])],512),[[n.F8,r.IsEQPoint]])])),_:1}),(0,i.Wm)(u,{label:"角度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:l.pointData_editing.Direction,"onUpdate:modelValue":t[9]||(t[9]=e=>l.pointData_editing.Direction=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"避車角度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:l.pointData_editing.Direction_Avoid,"onUpdate:modelValue":t[10]||(t[10]=e=>l.pointData_editing.Direction_Avoid=e)},null,8,["modelValue"]),(0,i._)("div",lt,[(0,i._)("div",null,[rt,(0,i.Wm)(f,{modelValue:l.pointData_editing.UseAvoidThetaWhenStopAtWaitingPointOfEntryRegion,"onUpdate:modelValue":t[11]||(t[11]=e=>l.pointData_editing.UseAvoidThetaWhenStopAtWaitingPointOfEntryRegion=e)},null,8,["modelValue"])]),(0,i._)("div",null,[dt,(0,i.Wm)(f,{modelValue:l.pointData_editing.AlwayTurnToAvoidThetaWhenWaitingTrafficControl,"onUpdate:modelValue":t[12]||(t[12]=e=>l.pointData_editing.AlwayTurnToAvoidThetaWhenWaitingTrafficControl=e)},null,8,["modelValue"])])])])),_:1}),0!=l.pointData_editing.StationType?((0,i.wg)(),(0,i.j4)(u,{key:1,label:"二次定位點角度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:l.pointData_editing.Direction_Secondary_Point,"onUpdate:modelValue":t[13]||(t[13]=e=>l.pointData_editing.Direction_Secondary_Point=e)},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(u,{label:"雷射模式"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:l.pointData_editing.LsrMode,"onUpdate:modelValue":t[14]||(t[14]=e=>l.pointData_editing.LsrMode=e),step:1},null,8,["modelValue"]),(0,i._)("i",{class:"bi bi-question-circle information",onClick:t[15]||(t[15]=(...e)=>r.HandleLaserModeInfoIconClick&&r.HandleLaserModeInfoIconClick(...e))})])),_:1}),(0,i.Wm)(u,{label:"速度"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:l.pointData_editing.Speed,"onUpdate:modelValue":t[16]||(t[16]=e=>l.pointData_editing.Speed=e),step:.1,precision:1},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"AGV閃避模式"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{modelValue:l.pointData_editing.DodgeMode,"onUpdate:modelValue":t[17]||(t[17]=e=>l.pointData_editing.DodgeMode=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{label:"0",value:0}),(0,i.Wm)(g,{label:"1",value:1}),(0,i.Wm)(g,{label:"2",value:2}),(0,i.Wm)(g,{label:"3",value:3}),(0,i.Wm)(g,{label:"4-一般道路橫向移動(巡檢AGV)",value:4}),(0,i.Wm)(g,{label:"5-電池交換橫向移動(巡檢AGV)",value:5}),(0,i.Wm)(g,{label:"6",value:6}),(0,i.Wm)(g,{label:"7",value:7}),(0,i.Wm)(g,{label:"8",value:8}),(0,i.Wm)(g,{label:"9",value:9}),(0,i.Wm)(g,{label:"10-取消任務時Pass站點(用於避免與WIP內AGV旋轉干涉)",value:10}),(0,i.Wm)(g,{label:"11-地標輔助修正(用於轉角或長走道起點，AGV會追Tag中心)",value:11}),(0,i.Wm)(g,{label:"12-里程計輔助定位(用於窄道)",value:12}),(0,i.Wm)(g,{label:"13",value:13}),(0,i.Wm)(g,{label:"14-里程計輔助定位、偵測色帶(用於窄道、脫離色帶會上報異常)",value:14})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"Direction"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{modelValue:l.pointData_editing.SpinMode,"onUpdate:modelValue":t[18]||(t[18]=e=>l.pointData_editing.SpinMode=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{label:"0-可旋轉",value:0}),(0,i.Wm)(g,{label:"1-不可旋轉",value:1}),(0,i.Wm)(g,{label:"2-向右旋轉",value:2}),(0,i.Wm)(g,{label:"3-向左旋轉",value:3})])),_:1},8,["modelValue"])])),_:1}),r.IsWorkStation?((0,i.wg)(),(0,i.j4)(u,{key:2,label:"任務權重"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{min:1,modelValue:l.pointData_editing.PriorityOfTask,"onUpdate:modelValue":t[19]||(t[19]=e=>l.pointData_editing.PriorityOfTask=e)},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1}),(0,i.Wm)(v,{name:"2"},{title:(0,i.w5)((()=>[ct])),default:(0,i.w5)((()=>[(0,i._)("div",ut,[(0,i.Wm)(f,{modelValue:l.pointData_editing.Enable,"onUpdate:modelValue":t[20]||(t[20]=e=>l.pointData_editing.Enable=e),label:"啟用"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsTrafficCheckPoint,"onUpdate:modelValue":t[21]||(t[21]=e=>l.pointData_editing.IsTrafficCheckPoint=e),label:"交管檢查點"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsStandbyPoint,"onUpdate:modelValue":t[22]||(t[22]=e=>l.pointData_editing.IsStandbyPoint=e),label:"停駐點"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsSegment,"onUpdate:modelValue":t[23]||(t[23]=e=>l.pointData_editing.IsSegment=e),label:"二次定位點"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsParking,"onUpdate:modelValue":t[24]||(t[24]=e=>l.pointData_editing.IsParking=e),label:"可停車點"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsAvoid,"onUpdate:modelValue":t[25]||(t[25]=e=>l.pointData_editing.IsAvoid=e),label:"避車點"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsVirtualPoint,"onUpdate:modelValue":t[26]||(t[26]=e=>l.pointData_editing.IsVirtualPoint=e),label:"虛擬點"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsAutoDoor,"onUpdate:modelValue":t[27]||(t[27]=e=>l.pointData_editing.IsAutoDoor=e),label:"自動門"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsExtinguishing,"onUpdate:modelValue":t[28]||(t[28]=e=>l.pointData_editing.IsExtinguishing=e),label:"消防設備"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsNarrowPath,"onUpdate:modelValue":t[29]||(t[29]=e=>l.pointData_editing.IsNarrowPath=e),label:"窄道"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:l.pointData_editing.IsTransferStation,"onUpdate:modelValue":t[30]||(t[30]=e=>l.pointData_editing.IsTransferStation=e),label:"轉換站(換車用，比如RACK撈爪)"},null,8,["modelValue"]),(0,i._)("div",mt,[(0,i.Wm)(f,{modelValue:l.pointData_editing.IsHighestPriorityStation,"onUpdate:modelValue":t[31]||(t[31]=e=>l.pointData_editing.IsHighestPriorityStation=e),label:"最高優先執行任務站點"},null,8,["modelValue"]),(0,i.Wm)(S,{content:"最高優先執行任務站點，系統會優先執行此站點的任務，且路權會優先給予。",placement:"bottom"},{default:(0,i.w5)((()=>[ht])),_:1})])])])),_:1}),(0,i.Wm)(v,{name:"3"},{title:(0,i.w5)((()=>[pt])),default:(0,i.w5)((()=>[(0,i._)("div",gt,[(0,i.Wm)(m,{onClick:t[32]||(t[32]=()=>{l.RegistersTable.push({index:void 0,tag:void 0,name:void 0})})},{default:(0,i.w5)((()=>[(0,i.Uk)("新增")])),_:1})]),(0,i.Wm)(C,{"row-key":"index",height:"320px",border:"",data:l.RegistersTable},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{label:"Index",prop:"index"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[(0,i.Wm)(_,{onChange:t=>r.HandleIndexSelected(e.row),modelValue:e.row.index,"onUpdate:modelValue":t=>e.row.index=t},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.pointsOptions,(e=>((0,i.wg)(),(0,i.j4)(g,{key:e.index,label:e.index,value:e.index},null,8,["label","value"])))),128))])),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])])])),_:1}),(0,i.Wm)(b,{label:"Tag",prop:"tag"}),(0,i.Wm)(b,{label:"Name",prop:"name"}),(0,i.Wm)(b,{label:"Name"},{default:(0,i.w5)((e=>[(0,i.Wm)(m,{onClick:()=>{l.RegistersTable.splice(l.RegistersTable.indexOf(e.row),1)},type:"danger",size:"small"},{default:(0,i.w5)((()=>[(0,i.Uk)("移除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),(0,i.Wm)(v,{name:"4",disabled:""},{title:(0,i.w5)((()=>[_t])),default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{label:"所屬區域"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{modelValue:l.pointData_editing.Region,"onUpdate:modelValue":t[33]||(t[33]=e=>l.pointData_editing.Region=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,i.Wm)(v,{name:"5"},{title:(0,i.w5)((()=>[wt])),default:(0,i.w5)((()=>[(0,i.Wm)(y,{"label-width":"120px","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{label:"Text Offset"},{default:(0,i.w5)((()=>[(0,i._)("div",ft,[yt,(0,i.Wm)(c,{class:"mx-2",type:"number",modelValue:l.pointData_editing.Graph.textOffsetX,"onUpdate:modelValue":t[34]||(t[34]=e=>l.pointData_editing.Graph.textOffsetX=e)},null,8,["modelValue"]),vt,(0,i.Wm)(c,{class:"mx-2",type:"number",modelValue:l.pointData_editing.Graph.textOffsetY,"onUpdate:modelValue":t[35]||(t[35]=e=>l.pointData_editing.Graph.textOffsetY=e)},null,8,["modelValue"])])])),_:1}),(0,i.Wm)(u,{label:"Rack 顯示"},{default:(0,i.w5)((()=>[(0,i._)("div",St,[bt,(0,i.Wm)(c,{class:"mx-2",type:"number",modelValue:l.pointData_editing.Graph.rackDisplay.OffsetX,"onUpdate:modelValue":t[36]||(t[36]=e=>l.pointData_editing.Graph.rackDisplay.OffsetX=e)},null,8,["modelValue"]),Ct,(0,i.Wm)(c,{class:"mx-2",type:"number",modelValue:l.pointData_editing.Graph.rackDisplay.OffsetY,"onUpdate:modelValue":t[37]||(t[37]=e=>l.pointData_editing.Graph.rackDisplay.OffsetY=e)},null,8,["modelValue"]),kt,(0,i.Wm)(c,{class:"mx-2",type:"number",modelValue:l.pointData_editing.Graph.rackDisplay.Rotation,"onUpdate:modelValue":t[38]||(t[38]=e=>l.pointData_editing.Graph.rackDisplay.Rotation=e)},null,8,["modelValue"])])])),_:1})])),_:1})])),_:1}),3==l.pointData_editing.StationType||7==l.pointData_editing.StationType?((0,i.wg)(),(0,i.j4)(v,{key:0,name:"6"},{title:(0,i.w5)((()=>[Tt])),default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{label:"進入點"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:l.pointData_editing.TagOfInPoint,"onUpdate:modelValue":t[39]||(t[39]=e=>l.pointData_editing.TagOfInPoint=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(u,{label:"退出點"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:l.pointData_editing.TagOfOutPoint,"onUpdate:modelValue":t[40]||(t[40]=e=>l.pointData_editing.TagOfOutPoint=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1},8,["modelValue"])])])])),_:1},8,["modelValue","before-close"])])}var Vt=a(64491),At=a(83592),It=a(91747),xt=a(49996),Et={components:{RegionsSelector:It.Z},data(){return{show:!1,index:-1,pointData:{},pointData_editing:new Ge.ux,RegistersTable:[{index:0,tag:1,name:"1"}],activeNames:[],BindingEQInfo:{ConnOptions:{ConnMethod:0,IP:"127.0.0.1",Port:503,ComPort:"COM1"},Name:"LDULD#2",TagID:2},fileList:[],AOIEqIcons:["/images/qv.png","/images/aoi.png","/images/aos.png","/images/VRS.png","/images/fac-robot2.png"]}},mounted(){},computed:{hasAnyChange(){var e=JSON.stringify(this.pointData),t=JSON.stringify(this.pointData_editing);return e!=t},IsEQPoint(){return 1==this.pointData_editing.StationType},IsWorkStation(){return 0!=this.pointData_editing.StationType},stationTypes(){return At.Ml},potinFullName(){return`[${this.index}] ${this.pointData.Name}`},pointsOptions(){return Re.p.getters.AllPointsOptions},icon_upload_url(){return"http://localhost:5216/api/map/IconUpload"},EqIcons(){return["/images/eq-icon.png","/images/rack.png","/images/qv.png","/images/aoi.png","/images/aos.png","/images/VRS.png","/images/fac-robot2.png"]}},methods:{async Show(e){e.point&&(this.index=e.index,this.pointData=e.point,this.pointData_editing=JSON.parse(JSON.stringify(e.point)),this.InitRegisterTableData(),this.IsEQPoint&&(this.BindingEQInfo=await(0,Vt.CN)(this.pointData.TagNumber)),this.show=!0,setTimeout((()=>{this.$emit("OnPointSettingChanged",{index:this.index,pointData:this.pointData_editing})}),500))},InitRegisterTableData(){this.RegistersTable=[];var e=this.pointData_editing.RegistsPointIndexs;e&&e.forEach((async e=>{var t=await Re.p.dispatch("GetMapPointByIndex",e);t&&this.RegistersTable.push({index:e,tag:t.TagNumber,name:t.Name})}))},ResetRegistPointIndexData(){this.pointData_editing.RegistsPointIndexs=this.RegistersTable.map((e=>e.index))},async StationTypeOnChange(e){1==e&&(this.BindingEQInfo=await(0,Vt.CN)(this.pointData.TagNumber))},SaveBtnClickHandle(){var e=.45,t=[64,64];this.AOIEqIcons.includes(this.pointData_editing.Graph.ImageName)&&(e=.2,t=[470,470]),this.pointData_editing.Graph.ImageSize=t,this.pointData_editing.Graph.ImageScale=e,this.ResetRegistPointIndexData(),this.$emit("OnPointSettingChanged",{index:this.index,pointData:this.pointData_editing}),(0,xt.bM)({title:"Success",message:`${this.potinFullName} 站點設定已暫存，請記得儲存圖資`,duration:1e3}),this.pointData=this.pointData_editing},CheckTagRepeat(){if(this.pointData_editing.TagNumber==this.pointData.TagNumber)return!1;var e=this.pointsOptions.filter((e=>e.tag+""==this.pointData_editing.TagNumber+""));return alert(JSON.stringify(e)),1==e.length},CancelBtnClickHandle(){this.hasAnyChange?(this.show=!1,this.$swal.fire({title:"點位尚未儲存",text:`點位-${this.potinFullName} 設定值變更但尚未儲存，確定要離開?`,icon:"question",showCancelButton:!0,confirmButtonText:"確定",customClass:"my-sweetalert"}).then((e=>{this.show=!e.isConfirmed,this.show||(this.$emit("OnLeve"),this.$emit("OnPointSettingChanged",{index:this.index,pointData:this.pointData}))}))):(this.show=!1,this.$emit("OnLeve"))},async Regist(){var e=await At.ZP.Regist(this.pointData_editing.TagNumber),t=e.result;this.show=!1,this.$swal.fire({text:"",title:`${this.pointData_editing.TagNumber} ${t?"註冊成功":"註冊失敗"}`,icon:t?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.show=!0}))},async Unregist(){var e=await At.ZP.Unregist(this.pointData_editing.TagNumber),t=e.result;this.show=!1,this.$swal.fire({text:"",title:`${this.pointData_editing.TagNumber} ${t?"解除註冊成功":"解除註冊失敗"}`,icon:t?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{this.show=!0}))},HandleIndexSelected(e){var t=e.index;Re.p.dispatch("GetMapPointByIndex",t).then((t=>{e.tag=t.TagNumber,e.name=t.Name}))},HandleDodgeModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">4:一般道路橫向移動(巡檢AGV)<br>5:電池交換橫向移動(巡檢AGV)<br>10:取消任務時Pass站點(用於避免與WIP內AGV旋轉干涉)<br>11:地標輔助修正(用於轉角或長走道起點，AGV會追Tag中心)<br>12:里程計輔助定位(用於窄道)<br>14:里程計輔助定位、偵測色帶(用於窄道、脫離色帶會上報異常)</div>',title:"Dodge Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleSpinModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">0:不可旋轉<br>1:可旋轉<br>2:向右旋轉<br>3:向左旋轉</div>',title:"Spin Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleLaserModeInfoIconClick(){this.show=!1,this.$swal.fire({html:'<div class="text-start">0:Bypass<br>1:Normal<br>2:二次定位<br>3:Normal_Short<br>5:Turning<br>7:Loading<br>10:Special<br>12:Narrow(窄道)<br>13:Norrow_Long</div>',title:"Laser Mode",icon:"information",showCancelButton:!1,customClass:"my-sweetalert"}).then((()=>{this.show=!0}))},HandleImageClick(e){this.pointData_editing.Graph.ImageName=e},HandleUploadIconBtnClick(){},OnIconUploadPreview(e){console.info(e)},OnIconUploadSuccess(e,t,a){console.info(e),this.fileList=[],Re.p.dispatch("DownloadMapData")},HandleIconDelete(e){Re.p.dispatch("DeleteIcon",e),Re.p.dispatch("DownloadMapData")}}};const Mt=(0,Fe.Z)(Et,[["render",Dt],["__scopeId","data-v-37832af2"]]);var Pt=Mt;const Ot={class:"map-path-editor"},Nt={class:"header border-bottom"},Lt={class:"draw-content w-100"};function Gt(e,t,a,n,o,l){const r=(0,i.up)("el-input"),d=(0,i.up)("el-form-item"),c=(0,i.up)("el-input-number"),u=(0,i.up)("el-checkbox"),m=(0,i.up)("el-form"),h=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",Ot,[(0,i.Wm)(h,{modelValue:o.show,"onUpdate:modelValue":t[12]||(t[12]=e=>o.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,onClosed:t[13]||(t[13]=t=>e.$emit("closed",o.PathDataEdit)),"show-close":!1,modal:!0,"modal-class":"modal-style"},{header:(0,i.w5)((()=>[(0,i._)("div",Nt,[(0,i._)("h3",null,"路徑設定:"+(0,s.zw)(o.PathDataEdit.StartPtIndex)+"->"+(0,s.zw)(o.PathDataEdit.EndPtIndex),1)])])),default:(0,i.w5)((()=>[(0,i._)("div",Lt,[(0,i.Wm)(m,{"label-width":"140","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{label:"Path ID"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{disabled:"",modelValue:o.PathDataEdit.PathID,"onUpdate:modelValue":t[0]||(t[0]=e=>o.PathDataEdit.PathID=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"權重"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:o.PathDataEdit.Weight,"onUpdate:modelValue":t[1]||(t[1]=e=>o.PathDataEdit.Weight=e),step:.1,min:1e-4,max:100},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"起點(Index)"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{disabled:"",modelValue:o.PathDataEdit.StartPtIndex,"onUpdate:modelValue":t[2]||(t[2]=e=>o.PathDataEdit.StartPtIndex=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"終點(Index)"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{disabled:"",modelValue:o.PathDataEdit.EndPtIndex,"onUpdate:modelValue":t[3]||(t[3]=e=>o.PathDataEdit.EndPtIndex=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"工位路徑"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{disabled:"",modelValue:o.PathDataEdit.IsEQLink,"onUpdate:modelValue":t[4]||(t[4]=e=>o.PathDataEdit.IsEQLink=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"道路開放"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{onChange:a.SettingsChangedHandler,modelValue:o.PathDataEdit.IsPassable,"onUpdate:modelValue":t[5]||(t[5]=e=>o.PathDataEdit.IsPassable=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(d,{label:"僅允許一台車通行"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.PathDataEdit.IsSingleCar,"onUpdate:modelValue":t[6]||(t[6]=e=>o.PathDataEdit.IsSingleCar=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"是否可旋轉"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.PathDataEdit.IsRotationable,"onUpdate:modelValue":t[7]||(t[7]=e=>o.PathDataEdit.IsRotationable=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"消防通道"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.PathDataEdit.IsExtinguishingPath,"onUpdate:modelValue":t[8]||(t[8]=e=>o.PathDataEdit.IsExtinguishingPath=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"雷射模式"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:o.PathDataEdit.LsrMode,"onUpdate:modelValue":t[9]||(t[9]=e=>o.PathDataEdit.LsrMode=e),step:1},null,8,["modelValue"]),(0,i._)("i",{class:"bi bi-question-circle information",onClick:t[10]||(t[10]=(...t)=>e.HandleLaserModeInfoIconClick&&e.HandleLaserModeInfoIconClick(...t))})])),_:1}),(0,i.Wm)(d,{label:"限速"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{modelValue:o.PathDataEdit.Speed,"onUpdate:modelValue":t[11]||(t[11]=e=>o.PathDataEdit.Speed=e),step:.1,precision:1},null,8,["modelValue"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}var Rt={data(){return{show:!1,PathDataEdit:{StartPtIndex:5,EndPtIndex:0,StartCoordination:[2.653,6.213],EndCoordination:[.531,6.217],PathID:"5_0",IsEQLink:!1,IsSingleCar:!1,IsRotationable:!1,IsPassable:!1,IsExtinguishingPath:!1,Speed:1,LsrMode:0,DodgeMode:0,SpinMode:0,Weight:1}}},props:{SettingsChangedHandler:{type:Function,default(){return()=>{}}}},methods:{Show(e){e&&(this.PathDataEdit=e,this.show=!0)}}};const Wt=(0,Fe.Z)(Rt,[["render",Gt]]);var Ut=Wt;const Ht={class:"forbid-region-edit-drawer"},$t={class:"header border-bottom"},Ft={class:"draw-content",style:{width:"90%"}};function qt(e,t,a,n,o,l){const r=(0,i.up)("el-input"),d=(0,i.up)("el-form-item"),c=(0,i.up)("el-option"),u=(0,i.up)("el-select"),m=(0,i.up)("el-input-number"),h=(0,i.up)("el-checkbox"),p=(0,i.up)("el-button"),g=(0,i.up)("el-form"),_=(0,i.up)("el-drawer");return(0,i.wg)(),(0,i.iD)("div",Ht,[(0,i.Wm)(_,{modelValue:o.show,"onUpdate:modelValue":t[7]||(t[7]=e=>o.show=e),size:"35%","close-on-press-escape":!0,"close-on-click-modal":!0,onClosed:t[8]||(t[8]=t=>e.$emit("closed",e.PathDataEdit)),"show-close":!1,modal:!0,"modal-class":"modal-style"},{header:(0,i.w5)((()=>[(0,i._)("div",$t,[(0,i._)("h3",null,"區域設置:"+(0,s.zw)(l.region_name),1)])])),default:(0,i.w5)((()=>[(0,i._)("div",Ft,[(0,i.Wm)(g,{"label-width":"160","label-position":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{label:"名稱"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{modelValue:o.RegionData.Name,"onUpdate:modelValue":t[0]||(t[0]=e=>o.RegionData.Name=e),onInput:l.ChangeNameDisplay},null,8,["modelValue","onInput"])])),_:1}),(0,i.Wm)(d,{label:"類型"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{disabled:"",modelValue:o.RegionData.RegionType,"onUpdate:modelValue":t[1]||(t[1]=e=>o.RegionData.RegionType=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{value:0,label:"禁制區"}),(0,i.Wm)(c,{value:1,label:"通行區"})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(d,{label:"進入/等待點"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.RegionData.EnteryTags,"onUpdate:modelValue":t[2]||(t[2]=e=>o.RegionData.EnteryTags=e),multiple:"",placeholder:"Select",onChange:l.HandlePropChanged},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.NoramlPointsOptions,(e=>((0,i.wg)(),(0,i.j4)(c,{key:e.tag,label:e.tag+`(${e.name_display})`,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,i.Wm)(d,{label:"路徑僅使用於目的地為"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.RegionData.PathOnlyUseForTagsWhenVehicleFromOutsideRegion,"onUpdate:modelValue":t[3]||(t[3]=e=>o.RegionData.PathOnlyUseForTagsWhenVehicleFromOutsideRegion=e),multiple:"",placeholder:"Select",onChange:l.HandlePropChanged,clearable:""},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.AllNonVirtualPointsOptions,(e=>((0,i.wg)(),(0,i.j4)(c,{key:e.tag,label:e.tag+`(${e.name_display})`,value:e.tag},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,i.Wm)(d,{label:"可容納車輛數"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onChange:l.HandlePropChanged,min:1,max:20,step:1,modelValue:o.RegionData.MaxVehicleCapacity,"onUpdate:modelValue":t[4]||(t[4]=e=>o.RegionData.MaxVehicleCapacity=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(d,{label:"閒置時停車角度限制"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onChange:l.HandlePropChanged,min:-180,max:180,step:.1,modelValue:o.RegionData.ThetaLimitWhenAGVIdling,"onUpdate:modelValue":t[5]||(t[5]=e=>o.RegionData.ThetaLimitWhenAGVIdling=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(d,{label:"窄道區域"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{onChange:l.HandlePropChanged,modelValue:o.RegionData.IsNarrowPath,"onUpdate:modelValue":t[6]||(t[6]=e=>o.RegionData.IsNarrowPath=e)},null,8,["onChange","modelValue"])])),_:1}),(0,i.Wm)(d,{label:"區域"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{type:"danger",onClick:l.HandleReDrawBtnClicked},{default:(0,i.w5)((()=>[(0,i.Uk)("重繪區域")])),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}var Bt={data(){return{show:!1,textFeature:new de.Z,ploygonFeature:new de.Z,RegionData:new Ge.S9("",[])}},props:{SettingsChangedHandler:{type:Function,default(){return()=>{}}}},methods:{Show(e=new Ge.S9("",[]),t=new de.Z,a=new de.Z){console.log(e),this.RegionData=e,this.textFeature=t,this.ploygonFeature=a,this.show=!0},ChangeNameDisplay(e){var t=this.textFeature.getStyle().clone(),a=t.getText().clone();a.setText(e),t.setText(a),this.textFeature.setStyle(t),this.textFeature.set("name",e),this.ploygonFeature.set("name",e);let i=new Ge.S9("",[],-1);Object.assign(i,this.ploygonFeature.get("data")),i.Name=e,this.ploygonFeature.set("data",i),console.log(e),console.log(i)},HandlePropChanged(){this.ploygonFeature.set("data",this.RegionData)},HandleReDrawBtnClicked(){this.$emit("onRedraw",this.RegionData),this.show=!1},Hide(){this.show=!1}},computed:{region_name(){return this.RegionData.Name},AllNonVirtualPointsOptions(){return Re.p.getters.AllNonVirtualStationOptions},NoramlPointsOptions(){var e=[new Ge.Di],t=[new Ge.Di];return Object.assign(e,Re.p.getters.AllNormalStationOptions),Object.assign(t,Re.p.getters.AllParkableStationOptions),[...e,...t].sort(((e,t)=>e.tag-t.tag))}}};const zt=(0,Fe.Z)(Bt,[["render",qt]]);var jt=zt;const Zt={class:"map-quickly-action"},Qt=["textContent"];function Yt(e,t,a,n,o,l){return(0,i.wg)(),(0,i.iD)("div",Zt,[(0,i._)("span",{textContent:(0,s.zw)(l.mapname)},null,8,Qt)])}var Kt={computed:{mapname(){return Re.p.getters.MapName}}};const Xt=(0,Fe.Z)(Kt,[["render",Yt],["__scopeId","data-v-3192d018"]]);var Jt=Xt;const ea={class:"my-2 py-1 border-bottom d-flex flex-row"},ta=(0,i._)("span",{class:"flex-fill"},null,-1),aa={class:""},ia={key:0},sa={class:"w-100"},na={class:"preview"},oa=["src"];function la(e,t,a,n,o,l){const r=(0,i.up)("el-button"),d=(0,i.up)("VuePictureCropper"),c=(0,i.up)("el-divider"),u=(0,i.up)("el-slider");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",ea,[(0,i.Wm)(r,{type:"button",onClick:t[0]||(t[0]=()=>{e.$refs.fileInput.click()})},{default:(0,i.w5)((()=>[(0,i.Uk)("選擇圖片")])),_:1}),(0,i._)("input",{type:"file",ref:"fileInput",onChange:t[1]||(t[1]=(...e)=>l.selectFile&&l.selectFile(...e)),accept:"image/jpg, image/jpeg, image/png, image/gif",style:{display:"none"}},null,544),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Reset")])),_:1}),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Clear")])),_:1}),ta,(0,i.Wm)(r,{onClick:l.getResult,type:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("裁剪")])),_:1},8,["onClick"])]),(0,i._)("div",aa,[(0,i.Wm)(d,{boxStyle:{width:"100%",height:"100%",backgroundColor:"#f8f8f8",margin:"auto"},img:o.pic,options:{viewMode:0,dragMode:"crop"},onReady:l.ready},null,8,["img","onReady"]),o.result.dataURL&&o.result.blobURL?((0,i.wg)(),(0,i.iD)("div",ia,[(0,i.Wm)(c),(0,i._)("div",sa,[(0,i.Wm)(r,{onClick:l.UseCropedImgClick,class:"text-end"},{default:(0,i.w5)((()=>[(0,i.Uk)("確定使用此圖片")])),_:1},8,["onClick"])]),(0,i.Wm)(u,{min:.1,max:1,step:.05,modelValue:o.previewImgScale,"onUpdate:modelValue":t[2]||(t[2]=e=>o.previewImgScale=e),onChange:l.OnPreviewImgSliderChanged},null,8,["modelValue","onChange"]),(0,i.Uk)(" "+(0,s.zw)(o.result.blobURL)+" ",1),(0,i._)("div",na,[(0,i._)("img",{style:(0,s.j5)(o.previewImgStyle),src:o.result.blobURL},null,12,oa)])])):(0,i.kq)("",!0)])],64)}a(62062);var ra=a(59984),da={components:{VuePictureCropper:ra.Z},props:{pic_used:{type:String,default:""}},data(){return{pic:"/images/eq-icon.png",ori_pic:"",result:{dataURL:"",blobURL:"",file:void 0},previewImgScale:.5,previewImgStyle:{transform:"scale(0.5)",transformOrigin:"top left"},uploadFile:void 0}},watch:{pic_used(e,t){console.log(e,t)}},methods:{UseCropedImgClick(){this.$emit("onCropDone",this.result)},ready(){},crop(){ra.n.crop()},OnPreviewImgSliderChanged(){this.previewImgStyle.transform=`scale(${this.previewImgScale})`},async getResult(){if(!ra.n)return;const e=ra.n.getDataURL(),t=await ra.n.getBlob();if(!t)return;const a=await ra.n.getFile({fileName:this.uploadFile.name.split(".")[0]});console.log({base64:e,blob:t,file:a}),this.result.dataURL=e,this.result.blobURL=URL.createObjectURL(t),this.result.file=a},selectFile(e){this.pic="",this.result.dataURL="",this.result.blobURL="";const{files:t}=e.target;if(!t||!t.length)return;const a=t[0],i=new FileReader;i.readAsDataURL(a),i.onload=()=>{this.uploadFile=a,this.pic=String(i.result),this.$refs.uploadInput&&(this.$refs.uploadInput.value="")}}}};const ca=(0,Fe.Z)(da,[["render",la]]);var ua=ca,ma=a(72924);a(663);const ha={class:"map-notify"};function pa(e,t,a,s,n,o){const l=(0,i.up)("el-alert");return(0,i.wg)(),(0,i.iD)("div",ha,["add-station"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:0,class:"notify-text",title:"使用滑鼠[右鍵]點擊地圖新增點位",type:"success",closable:!1})):(0,i.kq)("",!0),"edit-station"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:1,class:"notify-text",title:"使用滑鼠[右鍵]選擇欲編輯之點位",type:"success",closable:!1})):(0,i.kq)("",!0),"remove-station"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:2,class:"notify-text",title:"使用滑鼠[左鍵]選擇欲刪除之點位",type:"error",closable:!1})):(0,i.kq)("",!0),"add-path"==a.EditorOption.EditAction&&"one-direction"==a.EditorOption.AddPathMode.Direction?((0,i.wg)(),(0,i.j4)(l,{key:3,class:"notify-text",title:"使用滑鼠[左鍵]點擊地圖上任意兩個點位以新增一條單行道",type:"success",closable:!1})):(0,i.kq)("",!0),"add-path"==a.EditorOption.EditAction&&"bi-direction"==a.EditorOption.AddPathMode.Direction?((0,i.wg)(),(0,i.j4)(l,{key:4,class:"notify-text",title:"使用滑鼠[左鍵]點擊地圖上任意兩個點位以新增一條雙向道",type:"success",closable:!1})):(0,i.kq)("",!0),"edit-path"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:5,class:"notify-text",title:"使用滑鼠[右鍵]選擇欲編輯之路徑",type:"success",closable:!1})):(0,i.kq)("",!0),"remove-path"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:6,class:"notify-text",title:"使用滑鼠[左鍵]選擇欲刪除之路徑",type:"error",closable:!1})):(0,i.kq)("",!0),"add-forbid-region"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:7,class:"notify-text",title:`使用滑鼠[左鍵/右鍵]在地圖上繪製[${"forbid"==a.EditorOption.AddRegionMode.Mode?"禁制":"通行"}]區(按下[ESC]可取消繪製)`,type:"success"},null,8,["title"])):(0,i.kq)("",!0),"edit-forbid-region"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:8,class:"notify-text",title:"使用滑鼠[左鍵]在地圖上選取欲編輯之管制區)",type:"success"})):(0,i.kq)("",!0),"remove-forbid-region"==a.EditorOption.EditAction?((0,i.wg)(),(0,i.j4)(l,{key:9,class:"notify-text",title:"使用滑鼠[左鍵]在地圖上點擊欲刪除之管制區",type:"error"})):(0,i.kq)("",!0),a.DragBackgroundImageMode?((0,i.wg)(),(0,i.j4)(l,{key:10,class:"notify-text",title:"使用滑鼠[右鍵]點擊並拖曳背景圖片進行位置調整",type:"error"})):(0,i.kq)("",!0)])}var ga={props:{DragBackgroundImageMode:{type:Boolean,default:!1},EditorOption:{type:Object,default(){return{EditMode:"edit",EditAction:"none",AddPathMode:{Direction:"one-direction"},AddRegionMode:{Mode:"forbid"}}}}}};const _a=(0,Fe.Z)(ga,[["render",pa],["__scopeId","data-v-459698c8"]]);var wa=_a;const fa=e=>((0,i.dD)("data-v-1650f366"),e=e(),(0,i.Cn)(),e),ya={class:"map-legend"},va={class:"legend-item-container"},Sa=fa((()=>(0,i._)("div",{class:"image-icon unloadable"},null,-1))),ba={class:"desc"},Ca={class:"legend-item-container"},ka=fa((()=>(0,i._)("div",{class:"image-icon loadable"},null,-1))),Ta={class:"desc"},Da={key:0,class:"legend-item-container"},Va=fa((()=>(0,i._)("div",{class:"image-icon unload-and-loadable"},null,-1))),Aa={class:"desc"},Ia={class:"legend-item-container"},xa=fa((()=>(0,i._)("div",{class:"image-icon maintain"},null,-1))),Ea={class:"desc"},Ma=["onClick","onContextmenu"],Pa={class:"image-icon agv"},Oa={class:"desc"},Na={class:"header d-flex flex-row border-bottom"},La={class:"flex-fill text-start font-weight-bold"},Ga={class:"d-flex flex-column"};function Ra(e,t,a,o,l,r){const d=(0,i.up)("b-button");return(0,i.wg)(),(0,i.iD)("div",ya,[(0,i._)("div",va,[Sa,(0,i._)("div",ba,(0,s.zw)(e.$t("Map.MapLegend.Unloadble")),1)]),(0,i._)("div",Ca,[ka,(0,i._)("div",Ta,(0,s.zw)(e.$t("Map.MapLegend.Loadable")),1)]),r.IsAnyTowLayerEQExist?((0,i.wg)(),(0,i.iD)("div",Da,[Va,(0,i._)("div",Aa,(0,s.zw)(e.$t("Map.MapLegend.UnLoadLoadable")),1)])):(0,i.kq)("",!0),(0,i._)("div",Ia,[xa,(0,i._)("div",Ea,(0,s.zw)(e.$t("Map.MapLegend.Maintaining")),1)]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.CustomAGVStyles,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"legend-item-container agv-container",key:t,onClick:e=>r.HandleAGVLedgendClick(t),onContextmenu:(0,n.iM)((t=>r.onContextMenu(t,e)),["prevent"])},[(0,i._)("div",Pa,[(0,i._)("div",{class:"agv-icon",style:(0,s.j5)({backgroundColor:e.DisplayColor})},null,4)]),(0,i._)("div",Oa,(0,s.zw)(t),1)],40,Ma)))),128)),l.showAgvContextmenu?((0,i.wg)(),(0,i.iD)("div",{key:1,ref:"agv_contextmenu",class:"agv-contextmunu border rounded",style:(0,s.j5)(l.contextmunuStyle)},[(0,i._)("div",Na,[(0,i._)("span",La,(0,s.zw)(l.selectedAGVName),1),(0,i._)("i",{style:{cursor:"pointer"},onClick:t[0]||(t[0]=()=>{l.showAgvContextmenu=!1}),class:"bi bi-x-circle-fill text-danger"})]),(0,i._)("div",Ga,[(0,i.Wm)(d,{variant:"primary",onClick:r.HandleLockAGVBtnClick},{default:(0,i.w5)((()=>[(0,i.Uk)("鎖定")])),_:1},8,["onClick"])])],4)):(0,i.kq)("",!0)])}var Wa={data(){return{showAgvContextmenu:!1,selectedAGVName:"",contextmunuStyle:{bottom:"0px"}}},computed:{CustomAGVStyles(){return Re.p.getters.CustomAGVStyles},IsAnyTowLayerEQExist(){return We.jU.getters.AnyTwoLayerEqExist}},methods:{HandleAGVLedgendClick(e){Le.Z.emit("/cancel_tracking_agv"),Le.Z.emit("/show_agv_at_center",e),this.showAgvContextmenu=!1},onContextMenu(e,t){console.log(t),this.selectedAGVName=t.DisplayText;var a=Object.keys(this.CustomAGVStyles).length;this.contextmunuStyle.bottom=t.Index+1==a?"15px":55*(a-t.Index-1)+"px",this.showAgvContextmenu=!0},HandleLockAGVBtnClick(){Le.Z.emit("invoke-agv-lock",this.selectedAGVName)}}};const Ua=(0,Fe.Z)(Wa,[["render",Ra],["__scopeId","data-v-1650f366"]]);var Ha=Ua;const $a={class:"title text-light"};function Fa(e,t,a,o,l,r){const d=(0,i.up)("MenuForVehicle"),c=(0,i.up)("MenuForEQStationSelected"),u=(0,i.up)("MenuForMultiPointsSelected");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",{class:"map-context-menu-container border rounded p-3",style:(0,s.j5)(l.locationStyle)},[(0,i._)("div",$a,(0,s.zw)(r.getTitle),1),"agv"==l.useFor?((0,i.wg)(),(0,i.j4)(d,{key:0,agvName:l.options.agvName},null,8,["agvName"])):(0,i.kq)("",!0),"eq"==l.useFor?((0,i.wg)(),(0,i.j4)(c,{key:1,eqTag:r.stationTag},null,8,["eqTag"])):(0,i.kq)("",!0),"multi-point"==l.useFor?((0,i.wg)(),(0,i.j4)(u,{key:2,selectedFeatures:l.options.selectedFeatures,onOnDelete:t[0]||(t[0]=()=>{l.show=!1})},null,8,["selectedFeatures"])):(0,i.kq)("",!0)],4)),[[n.F8,l.show]])}const qa={class:"map-right-click-menu"},Ba=["disabled"],za=["disabled"];function ja(e,t,a,s,n,o){return(0,i.wg)(),(0,i.iD)("div",qa,[1==o.agvState.OnlineStatus?((0,i.wg)(),(0,i.iD)("button",{key:0,disabled:o.isAGVDown,onClick:t[0]||(t[0]=(...e)=>o.OfflineRequest&&o.OfflineRequest(...e))},"下線",8,Ba)):((0,i.wg)(),(0,i.iD)("button",{key:1,disabled:o.isAGVDown,onClick:t[1]||(t[1]=(...e)=>o.OnlineRequest&&o.OnlineRequest(...e))},"上線",8,za)),(0,i._)("button",{onClick:t[2]||(t[2]=(...e)=>o.InitVehicle&&o.InitVehicle(...e))},"初始化"),(0,i._)("button",{onClick:t[3]||(t[3]=(...e)=>o.AlarmReset&&o.AlarmReset(...e))},"異常復歸"),(0,i._)("button",{onClick:t[4]||(t[4]=(...e)=>o.EMO&&o.EMO(...e))},"EMO"),(0,i._)("button",{onClick:t[5]||(t[5]=(...e)=>o.RemoveCarrierID&&o.RemoveCarrierID(...e))},"移除卡匣"),(0,i._)("button",{onClick:t[6]||(t[6]=(...e)=>o.EMO&&o.EMO(...e))},"定位"),(0,i._)("button",{onClick:t[7]||(t[7]=e=>o.OpenMaintainPage())},"車輛保養"),(0,i._)("button",{class:"text-danger",onClick:t[8]||(t[8]=e=>o.UnregisterFromNetwork())},"解除路網註冊")])}var Za=a(38418),Qa=a(9669),Ya=a.n(Qa);async function Ka(e){await ti(e,"/api/VMS/EMO")}async function Xa(e){await ti(e,"/api/VMS/ResetAlarm")}async function Ja(e){await ti(e,"/api/VMS/Initialize")}async function ei(e){await ti(e,"/api/VMS/RemoveCassette")}async function ti(e="http://127.0.0.1:8888",t=""){var a=Ya().create({baseURL:e});await a.post(t)}var ai={props:{agvName:{type:String,default:""}},computed:{agvState(){return We.sn.state.agv_states.find((e=>e.AGV_Name==this.agvName))},agvHost(){return this.agvState?`http://${this.agvState.IP}:${this.agvState.Port}`:"http://localhost:7025"},isSimulation(){return!this.agvState||this.agvState.Simulation},isAGVDown(){return!this.agvState||3==this.agvState.MainStatus}},methods:{async InitVehicle(){if(this.isSimulation)await Za.PQ.Initialize(this.agvName);else try{await Ja(this.agvHost)}catch(e){this.HandleAPIRequstError(e)}},async AlarmReset(){if(this.isSimulation)await Za.PQ.Initialize(this.agvName);else try{await Xa(this.agvHost)}catch(e){this.HandleAPIRequstError(e)}},async EMO(){if(this.isSimulation)await Za.PQ.EMO(this.agvName);else try{await Ka(this.agvHost)}catch(e){this.HandleAPIRequstError(e)}},async RemoveCarrierID(){if(this.isSimulation)await Za.PQ.RemoveCargo(this.agvName);else try{await ei(this.agvHost)}catch(e){this.HandleAPIRequstError(e)}},OnlineRequest(){(0,Za.UT)(this.agvName)},OfflineRequest(){(0,Za.PX)(this.agvName)},OpenMaintainPage(){this.$router.push("/vehicle?tab=1")},HandleAPIRequstError(e){this.$swal.fire({text:"",title:e.message,icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})},async UnregisterFromNetwork(){this.$swal.fire({text:`確定要解除[${this.agvName}]路網註冊嗎？`,title:"",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed)try{await(0,Za.vR)(this.agvName)}catch(t){this.$swal.fire({text:t.message,title:"",icon:"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"})}}))}}};const ii=(0,Fe.Z)(ai,[["render",ja]]);var si=ii;const ni={class:"map-right-click-menu"};function oi(e,t,a,s,n,o){return(0,i.wg)(),(0,i.iD)("div",ni,[(0,i._)("button",{onClick:t[0]||(t[0]=(...e)=>o.Delete&&o.Delete(...e))},"刪除"),(0,i._)("button",{onClick:t[1]||(t[1]=(...e)=>o.SetDisabled&&o.SetDisabled(...e))},"禁用"),(0,i._)("button",{onClick:t[2]||(t[2]=(...e)=>o.SetEnabled&&o.SetEnabled(...e))},"啟用")])}var li={props:{selectedFeatures:{type:Array,default(){return[new de.Z]}}},computed:{countOfFeatures(){return this.selectedFeatures.length}},methods:{SetDisabled(){this.selectedFeatures.forEach((e=>{var t=e.get("data");t.Enable=!1,e.set("data",t)})),this._InvokeRestorePt()},SetEnabled(){this.selectedFeatures.forEach((e=>{var t=e.get("data");t.Enable=!0,e.set("data",t)})),this._InvokeRestorePt()},Delete(){this.$emit("onDelete"),this.$swal.fire({text:"",title:`確定要刪除[${this.countOfFeatures}]個點位?`,icon:"question",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&Le.Z.emit("delete-multi-points")}))},_InvokeRestorePt(){Le.Z.emit("restore_points_by_multi_point_changed")}}};const ri=(0,Fe.Z)(li,[["render",oi]]);var di=ri;const ci={class:"map-right-click-menu"},ui={key:0,class:"w-100 d-flex flex-column border-top py-1"},mi=(0,i._)("div",{class:"text-start text-primary font-size-smaller"},"模擬器",-1);function hi(e,t,a,s,n,o){return(0,i.wg)(),(0,i.iD)("div",ci,[(0,i._)("button",{onClick:t[0]||(t[0]=e=>o.GoToSettingPage())},"設定"),(0,i._)("button",{onClick:t[1]||(t[1]=e=>o.GoToEqStatusTable())},"IO/狀態檢視"),(0,i._)("button",{onClick:t[2]||(t[2]=e=>o.GoToSettingPage())},"將AGV定位在此點"),o.isEmulationEq?((0,i.wg)(),(0,i.iD)("div",ui,[mi,(0,i._)("button",{onClick:t[3]||(t[3]=e=>o.SetLoadable())},"設為可入料"),(0,i._)("button",{onClick:t[4]||(t[4]=e=>o.SetUnloadable())},"設為可出料"),(0,i._)("button",{onClick:t[5]||(t[5]=e=>o.SetBusy())},"設為BUSY")])):(0,i.kq)("",!0)])}var pi=a(78538),gi={props:{eqTag:{type:Number,default:0}},computed:{eqOption(){const e=We.jU.state.EqOptions.find((e=>e.TagID==this.eqTag));return e||new pi.W1},isEmulationEq(){return this.eqOption.IsEmulation},eqName(){return this.eqOption.Name}},methods:{SetLoadable(){Vt.PQ.SetState(this.eqName,"load")},SetUnloadable(){Vt.PQ.SetState(this.eqName,"unload")},SetBusy(){Vt.PQ.SetState(this.eqName,"busy")},GoToSettingPage(){this.$router.push(`/sys_settings/Equipment_Setting?eqTag=${this.eqTag}`)},GoToEqStatusTable(){Le.Z.emit("viewEqStatus")}}};const _i=(0,Fe.Z)(gi,[["render",hi]]);var wi=_i;class fi{constructor(){this.agvName="",this.stationName="",this.selectedFeatures=[],this.selectedFeature=new de.Z}}var yi={components:{MenuForVehicle:si,MenuForMultiPointsSelected:di,MenuForEQStationSelected:wi},computed:{getTitle(){return"agv"==this.useFor?this.options.agvName:"eq"==this.useFor?this.options.selectedFeature.get("data").Graph.Display:"multi-point"==this.useFor?`多點編輯 [${this.options.selectedFeatures.length}]`:""},stationTag(){return this.options.selectedFeature?this.options.selectedFeature.get("data").TagNumber:-1}},data(){return{show:!1,locationStyle:{top:"-100px",left:"-100px"},useFor:"",options:new fi}},methods:{showAt(e=[0,0],t="agv",a=new fi){this.useFor=t,this.options=a,this.locationStyle.top=e[1]+"px",this.locationStyle.left=e[0]+"px",this.show=!0},hide(){this.show=!1}}};const vi=(0,Fe.Z)(yi,[["render",Fa],["__scopeId","data-v-5918b98b"]]);var Si=vi;const bi=e=>((0,i.dD)("data-v-049075d6"),e=e(),(0,i.Cn)(),e),Ci={class:"align-tool border"},ki=bi((()=>(0,i._)("i",{class:"bi bi-three-dots-vertical"},null,-1))),Ti=bi((()=>(0,i._)("i",{class:"bi bi-align-top"},null,-1))),Di=[Ti],Vi=bi((()=>(0,i._)("i",{class:"bi bi-align-bottom"},null,-1))),Ai=[Vi],Ii=bi((()=>(0,i._)("i",{class:"bi bi-align-start"},null,-1))),xi=[Ii],Ei=bi((()=>(0,i._)("i",{class:"bi bi-align-end"},null,-1))),Mi=[Ei];function Pi(e,t,a,n,o,l){return(0,i.wg)(),(0,i.iD)("div",Ci,[ki,(0,i._)("button",{onClick:t[0]||(t[0]=(...e)=>l.alignUp&&l.alignUp(...e)),class:"btn align-btn","aria-label":"向上"},Di),(0,i._)("button",{onClick:t[1]||(t[1]=(...e)=>l.alignDown&&l.alignDown(...e)),class:"btn align-btn","aria-label":"向下"},Ai),(0,i._)("button",{onClick:t[2]||(t[2]=(...e)=>l.alignLeft&&l.alignLeft(...e)),class:"btn align-btn","aria-label":"靠左"},xi),(0,i._)("button",{onClick:t[3]||(t[3]=(...e)=>l.alignRight&&l.alignRight(...e)),class:"btn align-btn","aria-label":"靠右"},Mi),(0,i.Uk)(" "+(0,s.zw)(a.rotation),1)])}var Oi={props:{selectedFeatures:{type:Array,default(){return[new de.Z]}},map_display_mode:{type:String,default:"coordination"},rotation:{type:Number,default:0}},computed:{firstFeatureData(){return this.selectedFeatures[0].get("data")},minX(){return Math.min(...this.selectedFeatures.map((e=>{const t=e.get("data");return"coordination"===this.map_display_mode?t.X:t.Graph.X})))},maxX(){return Math.max(...this.selectedFeatures.map((e=>{const t=e.get("data");return"coordination"===this.map_display_mode?t.X:t.Graph.X})))},minY(){return Math.min(...this.selectedFeatures.map((e=>{const t=e.get("data");return"coordination"===this.map_display_mode?t.Y:t.Graph.Y})))},maxY(){return Math.max(...this.selectedFeatures.map((e=>{const t=e.get("data");return"coordination"===this.map_display_mode?t.Y:t.Graph.Y})))}},methods:{alignDown(e=!1){if(void 0!=e.button){if(90===this.rotation)return void this.alignRight(!0);if(-90===this.rotation)return void this.alignLeft(!0);if(180===this.rotation||-180===this.rotation)return void this.alignUp(!0)}const t=this.minY;this.selectedFeatures.forEach((e=>{const a=e.get("data");"coordination"===this.map_display_mode?a.Y=t:a.Graph.Y=t,e.set("data",a)})),console.log("Aligning Down"),this._InvokeRestorePt()},alignUp(e){if(console.log(e),void 0!=e.button){if(90===this.rotation)return void this.alignLeft(!0);if(-90===this.rotation)return void this.alignRight(!0);if(180===this.rotation||-180===this.rotation)return void this.alignDown(!0)}const t=this.maxY;this.selectedFeatures.forEach((e=>{const a=e.get("data");"coordination"===this.map_display_mode?a.Y=t:a.Graph.Y=t,e.set("data",a)})),console.log("Aligning Up"),this._InvokeRestorePt()},alignLeft(e=!1){if(void 0!=e.button){if(90===this.rotation)return void this.alignDown(!0);if(-90===this.rotation)return void this.alignUp(!0);if(180===this.rotation||-180===this.rotation)return void this.alignRight(!0)}const t=this.minX;this.selectedFeatures.forEach((e=>{const a=e.get("data");"coordination"===this.map_display_mode?a.X=t:a.Graph.X=t,e.set("data",a)})),console.log("Aligning Left"),this._InvokeRestorePt()},alignRight(e=!1){if(void 0!=e.button){if(90===this.rotation)return void this.alignUp(!0);if(-90===this.rotation)return void this.alignDown(!0);if(180===this.rotation||-180===this.rotation)return void this.alignLeft(!0)}const t=this.maxX;this.selectedFeatures.forEach((e=>{const a=e.get("data");"coordination"===this.map_display_mode?a.X=t:a.Graph.X=t,e.set("data",a)})),console.log("Aligning Right"),this._InvokeRestorePt()},_InvokeRestorePt(){Le.Z.emit("restore_points_by_multi_point_changed")}}};const Ni=(0,Fe.Z)(Oi,[["render",Pi],["__scopeId","data-v-049075d6"]]);var Li=Ni;const Gi=e=>((0,i.dD)("data-v-727c7ec4"),e=e(),(0,i.Cn)(),e),Ri={class:"action-undo border rounded p-1 bg-light d-flex"},Wi=Gi((()=>(0,i._)("i",{class:"bi bi-arrow-90deg-left"},null,-1))),Ui=Gi((()=>(0,i._)("i",{class:"bi bi-arrow-90deg-right"},null,-1)));function Hi(e,t,a,s,n,o){const l=(0,i.up)("el-button"),r=(0,i.up)("el-tooltip");return(0,i.wg)(),(0,i.iD)("div",Ri,[(0,i.Wm)(r,{content:"復原操作"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{type:"primary",disabled:!o.IsUnDoAllow,onClick:t[0]||(t[0]=e=>o.Undo())},{default:(0,i.w5)((()=>[Wi])),_:1},8,["disabled"])])),_:1}),(0,i.Wm)(r,{content:"取消復原操作"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{type:"primary"},{default:(0,i.w5)((()=>[Ui])),_:1})])),_:1})])}var $i={props:{refPointsLayer:{type:ue.Z,default:new ue.Z},refPathLayer:{type:ue.Z,default:new ue.Z}},data(){return{}},computed:{IsUnDoAllow(){return 0!=this.mapCachesLength},mapCachesLength(){return Re.p.state.TempMapDataStack.length}},methods:{Undo(){this.$emit("onUnDo")}}};const Fi=(0,Fe.Z)($i,[["render",Hi],["__scopeId","data-v-727c7ec4"]]);var qi=Fi;const Bi=e=>((0,i.dD)("data-v-41e6bde5"),e=e(),(0,i.Cn)(),e),zi={class:"map-build-tool-container bg-light border rounded p-2"},ji=Bi((()=>(0,i._)("h5",{class:"border-bottom text-start py-1"},[(0,i._)("i",{class:"bi bi-three-dots-vertical"}),(0,i._)("span",null,"元件")],-1)));function Zi(e,t,a,s,n,o){const l=(0,i.up)("AddPointTool"),r=(0,i.up)("AddPathTool"),d=(0,i.up)("AddForbidRegionTool");return(0,i.wg)(),(0,i.iD)("div",zi,[ji,"add-station"==a.operation?((0,i.wg)(),(0,i.j4)(l,{key:0})):(0,i.kq)("",!0),"add-path"==a.operation?((0,i.wg)(),(0,i.j4)(r,{key:1,onOnDirectionChanged:o.HandlePathToolComponentChange},null,8,["onOnDirectionChanged"])):(0,i.kq)("",!0),"add-forbid-region"==a.operation?((0,i.wg)(),(0,i.j4)(d,{key:2,onOnChanged:o.HandleRegionToolComponentChange},null,8,["onOnChanged"])):(0,i.kq)("",!0)])}const Qi=e=>((0,i.dD)("data-v-5315f8de"),e=e(),(0,i.Cn)(),e),Yi={class:"add-point-tool"},Ki=Qi((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/marker.png",alt:"marker"},null,-1))),Xi=Qi((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/back-sorting.png",alt:"back-sorting"},null,-1))),Ji=Qi((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/robot--v1.png",alt:"robot--v1"},null,-1))),es=Qi((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/rack--v2.png",alt:"rack--v2"},null,-1))),ts=Qi((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/external-Charge-Station-green-electric-energy-others-inmotus-design.png",alt:"external-Charge-Station-green-electric-energy-others-inmotus-design"},null,-1))),as=Qi((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/door.png",alt:"door"},null,-1)));function is(e,t,a,s,n,o){const l=(0,i.up)("el-radio-button"),r=(0,i.up)("el-radio-group");return(0,i.wg)(),(0,i.iD)("div",Yi,[(0,i.Wm)(r,{class:"flex-column",modelValue:n.selectState.selectedComponentName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectState.selectedComponentName=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{value:"normal-point"},{default:(0,i.w5)((()=>[Ki,(0,i.Uk)(" 一般點位 ")])),_:1}),(0,i.Wm)(l,{value:"eq-point"},{default:(0,i.w5)((()=>[Xi,(0,i.Uk)(" 設備 ")])),_:1}),(0,i.Wm)(l,{value:"stocker-point"},{default:(0,i.w5)((()=>[Ji,(0,i.Uk)(" Stocker ")])),_:1}),(0,i.Wm)(l,{value:"rack-point"},{default:(0,i.w5)((()=>[es,(0,i.Uk)(" Rack ")])),_:1}),(0,i.Wm)(l,{value:"charge-station-point"},{default:(0,i.w5)((()=>[ts,(0,i.Uk)(" 充電站 ")])),_:1}),(0,i.Wm)(l,{value:"auto-door-point"},{default:(0,i.w5)((()=>[as,(0,i.Uk)(" 自動門 ")])),_:1})])),_:1},8,["modelValue"])])}var ss=a(81365),ns={data(){return{selectState:new ss.P("add-point","normal-point")}},mounted(){(0,i.YP)((()=>this.selectState),((e,t)=>{console.info(e,t),e&&Re.p.commit("setToolState",e)}),{immediate:!0,deep:!0})}};const os=(0,Fe.Z)(ns,[["render",is],["__scopeId","data-v-5315f8de"]]);var ls=os;const rs=e=>((0,i.dD)("data-v-40e639a2"),e=e(),(0,i.Cn)(),e),ds={class:"add-path-tool"},cs=rs((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/arrow-up.svg",alt:"marker"},null,-1))),us=rs((()=>(0,i._)("img",{width:"32",height:"32",src:"/images/arrows-vertical.svg",alt:"marker"},null,-1)));function ms(e,t,a,s,n,o){const l=(0,i.up)("el-radio-button"),r=(0,i.up)("el-radio-group");return(0,i.wg)(),(0,i.iD)("div",ds,[(0,i.Wm)(r,{class:"flex-column",modelValue:n.direction,"onUpdate:modelValue":t[0]||(t[0]=e=>n.direction=e),onChange:o.onDirectionChange},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{value:"single-direction"},{default:(0,i.w5)((()=>[cs,(0,i.Uk)(" 單向 ")])),_:1}),(0,i.Wm)(l,{value:"bi-direction"},{default:(0,i.w5)((()=>[us,(0,i.Uk)(" 雙向 ")])),_:1})])),_:1},8,["modelValue","onChange"])])}var hs={data(){return{direction:"bi-direction"}},methods:{onDirectionChange(e){this.$emit("onDirectionChanged",e)}}};const ps=(0,Fe.Z)(hs,[["render",ms],["__scopeId","data-v-40e639a2"]]);var gs=ps;const _s=e=>((0,i.dD)("data-v-64abc89e"),e=e(),(0,i.Cn)(),e),ws={class:"add-forbid-region-tool"},fs=_s((()=>(0,i._)("img",{src:"/images/icons8-south-dakota-48.png"},null,-1))),ys=_s((()=>(0,i._)("img",{src:"/images/icons8-truck-ban-48.png"},null,-1)));function vs(e,t,a,s,n,o){const l=(0,i.up)("el-radio-button"),r=(0,i.up)("el-radio-group");return(0,i.wg)(),(0,i.iD)("div",ws,[(0,i.Wm)(r,{onChange:o.HandleChange,class:"flex-column",modelValue:n.selectState.selectedComponentName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectState.selectedComponentName=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{value:"passible"},{default:(0,i.w5)((()=>[fs,(0,i.Uk)("通行區 ")])),_:1}),(0,i.Wm)(l,{value:"forbid"},{default:(0,i.w5)((()=>[ys,(0,i.Uk)(" 禁制區 ")])),_:1})])),_:1},8,["onChange","modelValue"])])}var Ss={data(){return{selectState:new ss.P("add-forbid-region","passible")}},methods:{HandleChange(e){console.info(e),Re.p.commit("setToolState",new ss.P("add-forbid-region",e)),this.$emit("onChanged",e)}}};const bs=(0,Fe.Z)(Ss,[["render",vs],["__scopeId","data-v-64abc89e"]]);var Cs=bs,ks={components:{AddPointTool:ls,AddPathTool:gs,AddForbidRegionTool:Cs},props:{operation:{type:String,default:"add-station"}},data(){return{selectedComponentName:""}},computed:{toolState(){return Re.p.state.toolState}},methods:{HandleRegionToolComponentChange(e){console.info(e),this.$emit("onRegionToolComponentChange",e)},HandlePathToolComponentChange(e){console.info(e),this.$emit("onPathToolComponentChange",e)}}};const Ts=(0,Fe.Z)(ks,[["render",Zi],["__scopeId","data-v-41e6bde5"]]);var Ds=Ts,Vs=a(2781);const As=e=>((0,i.dD)("data-v-e5b10de2"),e=e(),(0,i.Cn)(),e),Is={class:"buffer-cargo-exist-container"},xs=["onClick","onMouseover","onMouseleave"],Es={key:0,class:"port-tooltip",style:{"z-index":"2323"}},Ms={class:"tooltip-content"},Ps=As((()=>(0,i._)("div",null,"Cargo ID:",-1))),Os=As((()=>(0,i._)("div",null,"Cargo ID:",-1)));function Ns(e,t,a,n,o,l){const r=(0,i.up)("el-button");return(0,i.wg)(),(0,i.iD)("div",{class:"rack-status-display",style:(0,s.j5)(a.dynamicStyle)},[(0,i._)("div",Is,[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([2,1,0],(e=>(0,i._)("div",{key:`${a.tagNumber}-${e}`,class:(0,s.C_)(["port",[l.getCargoExisStateClass(a.tagNumber,e),0==e?"first-slot":""]]),onClick:t=>l.HandleRackPortClicked(a.tagNumber,e),onMouseover:t=>l.HandleRackPortMouseOver(e),onMouseleave:t=>l.HandleRackPortMouseLeave(e)},[o.isPortHover[e]&&!l.IsRotated?((0,i.wg)(),(0,i.iD)("div",Es,[(0,i._)("div",Ms,[Ps,(0,i.Wm)(r,{loading:o.cargoIdLoading,text:"",class:"text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(o.displayCargoID),1)])),_:1},8,["loading"])])])):(0,i.kq)("",!0),o.isPortHover[e]&&l.IsRotated?((0,i.wg)(),(0,i.iD)("div",{key:1,style:(0,s.j5)(l.dynamicTooltipStyle)},[(0,i._)("div",{class:"tooltip-content",style:(0,s.j5)(l.dynamicToolTipContentStyle)},[Os,(0,i.Wm)(r,{loading:o.cargoIdLoading,text:"",class:"text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(o.displayCargoID),1)])),_:1},8,["loading"])],4)],4)):(0,i.kq)("",!0)],42,xs))),64))])],4)}var Ls={props:{tagNumber:{type:Number,default:0},pointData:{type:Object,default(){return new Ge.ux}},dynamicStyle:{type:Object,default(){return{position:"absolute",left:"0px",top:"0px",transform:"translate(0, -50%)",zIndex:1}}}},data(){return{isPortHover:{2:!1,1:!1,0:!1},displayCargoID:"556BBDDDS",cargoIdLoading:!1}},methods:{getCargoExisStateClass(e,t){let a="";return We.jU.getters.QueryCargoExist(e,t)&&(a+=" exist-cargo"),We.Ys.getters.AnyOrderAssignTagAndSlot(e,t)&&(a+=" port-order-assigned"),We.jU.getters.QueryPortDisabled(e,t)&&(a+=" port-disable"),a},HandleRackPortClicked(e,t){Le.Z.emit("map-rack-port-clicked",{tag:e,ptData:this.pointData,slot:t})},HandleRackPortMouseOver(e){this.displayCargoID="",this.isPortHover[e]=!0,this.cargoIdLoading=!0,We.jU.dispatch("QueryCargoID",{tag:this.tagNumber,slot:e}).then((e=>{setTimeout((()=>{this.displayCargoID=e,this.cargoIdLoading=!1}),200)}))},HandleRackPortMouseLeave(e){this.isPortHover[e]=!1,this.cargoIdLoading=!1,this.displayCargoID=""}},computed:{dynamicTooltipStyle(){let e=0,t=!1;return this.dynamicStyle.transform&&(e=this.getRotationFromTransform,t=0!=e),t?{transform:`rotate(${-1*e}deg)`}:{}},dynamicToolTipContentStyle(){const e=this.getRotationFromTransform;return e>0&&e<=90?{position:"relative",right:"-40px",top:"-40px"}:e<0&&e>=-90?{position:"relative",right:"10px",top:"-40px"}:{position:"relative",right:"-30px",top:"-10px"}},IsRotated(){let e=0,t=!1;return this.dynamicStyle.transform&&(e=this.getRotationFromTransform,t=0!=e),t},getRotationFromTransform(){const e=this.dynamicStyle.transform.match(/rotate\(([-\d.]+)deg\)/);return e?parseFloat(e[1]):0}}};const Gs=(0,Fe.Z)(Ls,[["render",Ns],["__scopeId","data-v-e5b10de2"]]);var Rs=Gs;function Ws(e,t,a,n,o,l){const r=(0,i.up)("el-tooltip");return(0,i.wg)(),(0,i.iD)("div",{class:"vehicle-bat-status d-flex flex-column",style:(0,s.j5)(a.dynamicStyle)},[(0,i._)("span",{class:(0,s.C_)([l.colorClass])},(0,s.zw)(l.batteryLevel.batLv.toFixed(0))+"%",3),(0,i.Wm)(r,{transition:"el-fade-in-linear",placement:"right",content:l.tooltipContent},{default:(0,i.w5)((()=>[(0,i._)("i",{class:(0,s.C_)([l.iconClass,l.colorClass])},null,2)])),_:1},8,["content"])],4)}var Us={props:{dynamicStyle:{type:Object,default(){return{position:"absolute",left:"0px",top:"0px",transform:"translate(0, -50%)",zIndex:1}}},agvName:{type:String,default:"AGV_"}},computed:{batteryLevel(){return We.sn.getters.VehicleBattery(this.agvName)},iconClass(){const e=this.batteryLevel.batLv,t=this.batteryLevel.isCharging;return t?"bi bi-battery-charging text-success":e>80?"bi bi-battery-full text-success":e>30?"bi bi-battery-half text-warning":"bi bi-battery text-danger"},colorClass(){const e=this.batteryLevel.batLv,t=this.batteryLevel.isCharging;return t||e>80?"text-success":e>30?"text-warning":"text-danger"},tooltipContent(){return`Remain : ${this.batteryLevel.batLv} %`}}};const Hs=(0,Fe.Z)(Us,[["render",Ws],["__scopeId","data-v-7a9d1848"]]);var $s=Hs,Fs={components:{RackStatusDisplay:Rs,VehicleBatteryStatusDisplay:$s,QuicklyAction:Jt,NotifyDisplay:wa,MapLegend:Ha,MapSettingsDialog:Be,MapPointSettingDrawer:Pt,MapPathSettingDrawer:Ut,MapRegionEditDrawer:jt,ImageEditor:ua,ContextMenuContainer:Si,AlignmentToos:Li,ActionUndoTool:qi,BuildToolContainer:Ds},props:{editable:{type:Boolean,default:!1},agv_show:{type:Boolean,default:!0},station_show:{type:Boolean,default:!0},rackInfoShow:{type:Boolean,default:!0},eq_lduld_status_show:{type:Boolean,default:!1},agv_upload_coordi_data:{type:Object,default(){return{}}},task_dispatch_menu_show:{type:Boolean,default:!1},id:{type:String,default(){return"map"}},canva_height:{type:String,default:"670px"}},data(){return{settings:new Ge.l3,map:new be.Z,map_name:"Unkown",renderKey:1,zoom:2,zoom_route:2,center:[0,0],center_route:[0,0],loading:!1,ShowPathSelectDialog:!1,DragBackgroundImageMode:!1,ShowImageEditorDialog:!1,IsPathEditing:!1,selectedSettingTabIndex:0,new_map_img_extent:[],SelectedPathData:{},PathesCandicats:[],_map_stations:[],dragStartPosition:null,map_img_url_for_editor:null,to_upload_image_file:null,ImageLayer:new ce.Z,PointLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:12}),PointRouteLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:13}),EQLDULDStatusLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:20}),PathLayerForCoordination:new ue.Z({source:new ke.Z({features:[]}),zIndex:5}),PathLayerForRouter:new ue.Z({source:new ke.Z({features:[]}),zIndex:6}),AGVLocLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:17}),EQMaintainIconLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:4}),AGVLocusLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:18}),CustomLayer:new ue.Z({source:new ke.Z({features:[]})}),TrafficStateLayer:new Ne.Z({source:new ke.Z,blur:23,radius:23,opacity:1,gradient:["rgba(0, 0, 255, 0)","rgba(0, 255, 0, 1)","rgba(255, 255, 0, 1)","rgba(255, 0, 0, 1)"],zIndex:100}),gridLayer:new ue.Z,TransferTaskIconLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:22}),RegionLayer:new ue.Z({source:new ke.Z({features:[]}),zIndex:1}),AGVFeatures:{},MouseCoordination:void 0,FeatureKeys:{Station:"station",path:"path",nav_path:"nav_path",agv:"agv"},IsDragging:!1,IsAddPathMode:!0,PathEditTempStore:[],EditorOption:{EditMode:"edit",EditAction:"none",AddPathMode:{Direction:"bi-direction"},AddRegionMode:{Mode:()=>Re.p.state.toolState.selectedComponentName}},map_display_mode:"coordination",station_name_display_mode:"name",agv_display:"visible",map_image_display:"visible",left_tab_class_name:"tab-open",previousSelectedFeatures:[],clickedFeature:new de.Z,agv_upload_coordination_mode:!1,editModeContextMenuVisible:!1,taskDispatchContextMenuVisible:!1,legendShow:!0,dragActionLock:!0,routePathsVisible:!0,regionsVisible:!1,rackVisible:!0,vehicleBatVisible:!0,contextMenuTop:0,contextMenuLeft:0,contextMenuOptions:new Ge.xK,firstUseFlag:!0,selected_path_feature:void 0,path_highlight_style:new _e.ZP({stroke:new we.Z({color:"blue",width:8})}),PathesSegmentsForEdit:[],IsSelectAGVMode:!1,IsSelectEQStationMode:!1,TaskDispatchOptions:{action_type:"",direction:"",stations_to_show:[]},draw_forbid_regions_interaction:void 0,draw_global_path_regions_interaction:void 0,delete_forbid_regions_interaction:void 0,edit_forbid_regions_interaction:void 0,mapEditsInteraction:void 0,MapGridSizeStore:0,MapGridSizeXOffset:0,MapGridSizeYOffset:0,MapRotation:0,MapStyles:{PathColor:"red",NormalPointNameColor:"orange",WorkStationPointNameColor:"lime",NormalPointTextFontSize:12,WorkStationPointTextFontSize:18},AgvOperation:{operatingAgvName:"",display:!1,Show(e){this.operatingAgvName=e,this.display=!0}},featureHighlightTimerID:"",highlightingFeatures:[],renderLDULD_StatusTimerId:"",trackingAGVTimer:"",agvSelectedState:{isClicked:!1,agvName:void 0},designToolCollapseActive:["1"],map_theme_select:"light",map_theme_dark:{backgroundColor:"black",color:"white",normalPtTextColor:"white",stationPtTextColor:"gold",pathColor:"lime"},SelectedFeatures:[],showRedrawControl:!1,tempHiddenFeaturesOfRegion:[],isRedrawConfirmable:!1,searchTag:void 0,rackPortFeatures:[],postRenderThrottleTimer:null,agvRenderDebounceTimer:null}},computed:{mapToolShow(){const e=this.EditorOption.EditAction;return this.editable&&("add-station"==e||"add-path"==e||"add-path"==e||"add-forbid-region"==e)},mapModeCLass(){return this.map_display_mode+"_"+(this.editable?"editMode":"")},IsCtrlPressing(){return We.ZP.state.isCtrlPressing},IsUserLogin(){return We.HP.getters.IsLogin},IsOpUsing(){return We.HP.getters.IsOPLogining},userLevel(){return We.HP.state.user.Role},MapServerUrl(){return Re.p.getters.MapServerUrl},map_image_url(){return this.map_img_url_for_editor?this.map_img_url_for_editor:`${this.MapServerUrl}/MapFiles/${Re.p.getters.MapImageName}?version=1`},map_name_with_url(){return`map-${this.$route.name}`},map_img_extent(){return Re.p.getters.Map_Image_Boundary},map_img_size(){return Re.p.getters.Map_Image_Size},PathesSegments(){return Re.p.getters.Pathes},previousSelectedFeature(){return this.previousSelectedFeatures[0]},MouseCoordinationDisplay(){return this.MouseCoordination?`(${this.MouseCoordination[0].toFixed(2)},${this.MouseCoordination[1].toFixed(2)})`:"(-1,-1)"},StationPointsFeatures(){return"coordination"==this.map_display_mode?this.PointLayer.getSource().getFeatures():this.PointRouteLayer.getSource().getFeatures()},RackPortPointFeatures(){let e=e=>{const t=[4,5,41];return t.includes(e)};return this.StationPointsFeatures.filter((t=>e(t.get("data").StationType)))},AGVMapFeatures(){return this.AGVLocLayer.getSource().getFeatures()},ShowWarningNotify(){return"view"!=this.EditorOption.EditMode&&"coordination"==this.map_display_mode},map_station_data(){return Re.p.getters.MapStations},BezierCurves(){return Re.p.getters.BezierCurves},agvs_info(){var e=new Ge.q4(0,[new Ge.Ew]);return Object.assign(e,Re.p.getters.AGVNavInfo),e},agvs_info_other_system(){return Re.p.state.OthersAGVLocateInfo},ControledPathesBySystem(){return Re.p.getters.ControledPathesBySystem},MapGridSize(){return Re.p.state.MapData.Options.gridSize},redrawingRegionName(){return this.tempHiddenFeaturesOfRegion?this.tempHiddenFeaturesOfRegion[0].get("name"):""},allPointsSimpleOptions(){return Object.values(Re.p.state.MapData.Points).sort(((e,t)=>e.TagNumber-t.TagNumber)).map((e=>({value:e.TagNumber,label:e.TagNumber+`(${e.Graph.Display})`})))},toolState(){return Re.p.state.toolState},LegendStyle(){return{bottom:this.IsOpUsing?"0.6rem":"5rem"}}},methods:{saveMapImage(e=`MapImageShot_${Date.now()}.png`){le()(this.map.getTargetElement()).then((t=>{const a=document.createElement("a");a.download=e,a.href=t.toDataURL("image/png"),a.click()}))},getRackCargoExistStateFeatureLabelStyle(e=new de.Z){if(!e||!this.map)return{};e.get("data").TagNumber;const t=this.map.getPixelFromCoordinate(e.getGeometry().getCoordinates());if(!t)return{display:"none"};let a=20,i=0,s=0;const n=e.get("data");if(n){const e=n.Graph.rackDisplay;a=e.OffsetX,i=e.OffsetY,s=e.Rotation}return{position:"absolute",left:`${parseFloat(t[0])+parseFloat(a)}px`,top:` ${parseFloat(t[1])+parseFloat(i)}px`,transform:`rotate(${s}deg) translate(0,-50%)`,transformOrigin:"center center",zIndex:1}},getVehicleBatStatusDisplayStyle(e=new de.Z){if(!e||!this.map)return{};const t=this.map.getPixelFromCoordinate(e.getGeometry().getCoordinates());if(!t)return{display:"none"};const a=20,i=-5;return{position:"absolute",left:`${t[0]+a}px`,top:`${t[1]+i}px`,transform:"translate(0, -50%)",zIndex:1}},HandleRegionToolComponentChange(e){this.HandleAddForbidRegionClicked(e)},HandlePathToolComponentChange(e){this.EditorOption.AddPathMode.Direction=e},async HandleUnDoBtnClicked(){const e=await Re.p.dispatch("GetLastMapData");this.RefreshMap(e)},GoOriginal(){this.map.getView().setCenter([0,0]),this.map.getView().setZoom(1)},GetPointName(e){var t=(0,Ge.G)(e);if(t)return t.Name},ClearMap(){this.$swal.fire({text:"地圖資料將會被清空，變成空白地圖",title:"確定要重置地圖?",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((e=>{e.isConfirmed&&(this.PathesSegmentsForEdit=[],this.PathLayerForCoordination.getSource().clear(),this.PathLayerForRouter.getSource().clear(),this.PointRouteLayer.getSource().clear(),this.PointLayer.getSource().clear(),this.TransferTaskIconLayer.getSource().clear())}))},HandlePathRemoveBtnClick(e){var t=this.PathesSegmentsForEdit.indexOf(e);this.PathesSegmentsForEdit.splice(t,1),this.UpdateStationPathLayer()},HandlePathTbRowClick(e,t,a){this.selected_path_feature&&this.RestoreOriginalPathStyle(this.selected_path_feature);var i=this.PathLayerForCoordination.getSource(),s=i.getFeatures().find((t=>t.get("path_id")==e.PathID));if(s){var n=s.getStyle();if(n[0]=this.path_highlight_style,s.setStyle(n),this.selected_path_feature=s,!this.IsPathEditing){var o=s.getGeometry().getCoordinates()[0];this.map.getView().setCenter(o)}}},RestoreOriginalPathStyle(e){if(e){var t=e.get("ori_stroke_style"),a=e.getStyle();a[0]=t,e.setStyle(a)}},UpdateStationPointLayer(){var e=[],t=[],a=[];for(let r=0;r<this._map_stations.length;r++){var i=this._map_stations[r],s=(0,Ge.HB)(i);e.push(s),0!=i.data.StationType&&a.push(this.CreateEqMaintainingFeature(i.data,s.getGeometry().getCoordinates()));var n=s.get("routeModeFeature");n&&t.push(n)}var o=this.PointLayer.getSource();o.clear(),o.addFeatures(e),this.EQMaintainIconLayer.getSource().addFeatures(a);var l=this.PointRouteLayer.getSource();l.clear(),l.addFeatures(t),this.UpdateEQLDULDFeature()},UpdateStationPathLayer(){var e=this.PathLayerForCoordination.getSource(),t=this.PathLayerForRouter.getSource();e.clear(),t.clear();var a=[],i=[],s=this.PathesSegmentsForEdit,n=function(e,t){e.set("start_pt_index",t.StartPtIndex),e.set("end_pt_index",t.EndPtIndex),e.set("path_id",t.PathID),e.set("isEqLink",t.IsEQLink),e.set("feature_type","path"),e.set("isClose",!t.IsPassable);var a=(0,Ge.bE)(e);e.setStyle(a),e.set("ori_stroke_style",a[0])};return s.forEach((e=>{let t=new de.Z({geometry:new me.Z([e.StartCoordination,e.EndCoordination])});var s=this._map_stations.find((t=>t.index==e.StartPtIndex)),o=this._map_stations.find((t=>t.index==e.EndPtIndex));if(s&&o){let l=new de.Z({geometry:new me.Z([[s.data.Graph.X,s.data.Graph.Y],[o.data.Graph.X,o.data.Graph.Y]])});n(t,e),n(l,e),a.push(t),i.push(l)}})),e.addFeatures(a),t.addFeatures(i),[...i,...a]},UpdateEQLDULDFeature(){if(!this.editable){var e=[];for(let i=0;i<this._map_stations.length;i++){var t=this._map_stations[i],a=(0,Ge.Xl)(t,this.map_display_mode);e.push(a)}var i=this.EQLDULDStatusLayer.getSource();i.clear(),i.addFeatures(e)}},UpdateForbidPointLayer(){this.RegionLayer.getSource().clear();var e=Re.p.getters.Regions;e.forEach((e=>{var t=(0,Ge.H6)(e.Name,e.PolygonCoordinations,e.RegionType);t.region_feature.set("data",e),this.RegionLayer.getSource().addFeatures([t.region_feature,t.text_feature])}))},UpdateAGVLocationOfOtherSystem(e=[]){var t=this.AGVLocLayer.getSource(),a=t.getFeatures(),i=e=>{var t=this.StationPointsFeatures.find((t=>t.get("data").Graph.Display==e));return t?t.getGeometry().getCoordinates():[0,0]};e.forEach((e=>{var s=e.AGVName;if(s&&""!=s){var n=e.Location,o=`other-agv-${s}`,l=a.find((e=>e.get("agv-addition")==o)),r=i(n),d=0==r[0]&&0==r[1];if(!d)if(l)l.setGeometry(new he.Z(r));else{var c=new de.Z({geometry:new he.Z(r)}),u=(0,Ge.IN)(s,"blue");c.setStyle(u),c.set("agvname",s),c.set("feature_type",this.FeatureKeys.agv),c.set("agv-addition",o),t.addFeature(c)}}}))},UpdateAGVLayer(){if("visible"!=this.agv_display)return;var e=(e,t)=>{localStorage.setItem(e,t)},t=e=>{var t=localStorage.getItem(e);return t||""};this.agvs_info.AGVDisplays.forEach((a=>{let i=e=>0==e?"forklift":3==e?"submarine":"unknown";const s=a.vehicleLength/100,n=a.vehicleWidth/100,o=i(a.AgvModel),l=Math.sqrt(Math.pow(s/2,2)+Math.pow(n/2,2));var r=this.CalculateAGVPolygonCoordination(a.Coordination,s,n,a.Theta),d=this.AGVFeatures[a.AgvName];if(d){var c=JSON.stringify(a),u=t(a.AgvName);if(c==u)return;e(a.AgvName,c);var m=a.Coordination,h=a.NavPathCoordinationList;if("router"==this.map_display_mode){h=[];var p=this.StationPointsFeatures.find((e=>e.get("data").TagNumber==a.Tag));p&&(m=p.getGeometry().getCoordinates(),r=this.CalculateAGVPolygonCoordination(m,s,n,a.Theta));var g=this.PointLayer.getSource().getFeatures();const e=a.NavPathCoordinationList.length,t=0==e;if(!t)for(let i=0;i<e;i++){const e=a.NavPathCoordinationList[i];p=g.find((t=>t.getGeometry().getCoordinates()[0]==e[0]&&t.getGeometry().getCoordinates()[1]==e[1]));if(p){var _=this.StationPointsFeatures.find((e=>e.get("index")==p.get("index")));h.push(_.getGeometry().getCoordinates())}}}d.agv_feature.setGeometry(new he.Z(m)),d.cargo_icon_feature.setGeometry(new he.Z(m)),d.safty_region_feture.getGeometry().setCenter(m),d.agv_body_feture.setGeometry(new pe.ZP(r));var w=d.agv_feature.getStyle(),f=w.getImage();"router"!=this.map_display_mode&&(f.setRotation(-1*(a.Theta-90-this.MapRotation)*Math.PI/180),w.setImage(f));var y=a.CurrentAction,v=w.getText(),S=a.DisplayText+(""==y?"":`(${y})`);S+=a.WaitingInfo.IsWaiting?"\r\n"+a.WaitingInfo.Descrption:"",v.setText(S);var b=v.getBackgroundFill();b.setColor(a.AgvStates.is_online?a.TextColor:"rgb(147, 147, 147)"),v.setBackgroundFill(b),d.agv_feature.setStyle(w),d.path_feature.setGeometry(new me.Z(h));const i=We.Ys.getters.IsRunningHighestPriorityTask(a.AgvName),o=i?this.convertColorNameToRGBA(a.TextColor,.5):a.TextColor;d.path_feature.setStyle((0,Ge.DS)(o,7,i?"#ff3636":void 0)),(0,Ge.oy)(d.cargo_icon_feature,a.CargoStatus)}else try{var C=new de.Z({geometry:new he.Z(a.Coordination)});const e=new ge.Z(a.Coordination,l),t=new pe.ZP(r);var k=this.convertColorNameToRGBA(a.TextColor,1),T=this.convertColorNameToRGBA(a.TextColor,.4),D=this.convertColorNameToRGBA(a.TextColor,.2),V=this.convertColorNameToRGBA(a.TextColor,.8);const i=new de.Z(e);i.setStyle(new _e.ZP({fill:new fe.Z({color:D}),stroke:new we.Z({color:V,width:1,lineDash:[13,12]}),text:new ye.Z({text:""})}));const s=new de.Z(t);s.setStyle(new _e.ZP({fill:new fe.Z({color:T}),stroke:new we.Z({color:"grey",width:1,lineCap:"round",lineJoin:"round"})}));var A=(0,Ge.K$)(a.DisplayText,k,o);C.setStyle(A),C.set("agvname",a.AgvName),C.set("feature_type",this.FeatureKeys.agv);var I=new de.Z({geometry:new me.Z([])});I.setStyle((0,Ge.DS)(k,7));var x=C.clone();x.setStyle((0,Ge.Qw)()),this.AGVFeatures[a.AgvName]={agv_feature:C,path_feature:I,cargo_icon_feature:x,safty_region_feture:i,agv_body_feture:s};var E=this.AGVLocLayer.getSource();E.addFeature(x),E.addFeature(C),E.addFeature(i),E.addFeature(s),E.addFeature(I)}catch{console.log("errror")}}))},async ResetRouteModeDisplay(){this.$swal.fire({text:"",title:"確定要重置路網模式?",icon:"warning",showCancelButton:!0,confirmButtonText:"OK",customClass:"my-sweetalert"}).then((async e=>{if(e.isConfirmed){var t=await Re.p.dispatch("ResetMapXYGraphAsCoordinations","");console.log(t);var a=t.confirm,i=t.message;this.$swal.fire({text:a?"":i,title:a?"重置成功":"重置失敗",icon:a?"success":"error",showCancelButton:!1,confirmButtonText:"OK",customClass:"my-sweetalert"}),this.ReloadMap(!1)}}))},CalculateAGVPolygonCoordination(e,t,a,i){let s=i*Math.PI/180,n=Math.cos(s),o=Math.sin(s),[l,r]=e,d=[[l-t/2,r-a/2],[l+t/2,r-a/2],[l+t/2,r+a/2],[l-t/2,r+a/2]],c=d.map((e=>{let[t,a]=e,i=t-l,s=a-r,d=i*n-s*o+l,c=i*o+s*n+r;return[d,c]}));var u=[c.map((e=>[e[0],e[1]]))];return u},UpdateAGVLocByMapMode(e="router",t=new Ge.Ew){var a=this.AGVFeatures[t.AgvName];if(a){var i=this.StationPointsFeatures.find((e=>e.get("data").TagNumber==t.Tag));if(i){var s=i.getGeometry().getCoordinates();a.agv_feature.setGeometry(new he.Z(s)),a.safty_region_feture.getGeometry().setCenter(s);const e=We.sn.getters.VehicleSize(t.AgvName),n=e[0]/100,o=e[1]/100;a.agv_body_feture.setGeometry(new pe.ZP(this.CalculateAGVPolygonCoordination(s,n,o)))}}},convertColorNameToRGBA(e,t=1){var a=document.createElement("div");a.style.color=e,document.body.appendChild(a);var i=window.getComputedStyle(a).color;document.body.removeChild(a);var s=i.replace("rgb","rgba").replace(")",`, ${t})`);return s},setDragPanEnabled(e){this.map.getInteractions().forEach((function(t){t instanceof De.Z&&t.setActive(e),t instanceof Ve.Z&&t.setActive(e),t instanceof Ae.Z&&t.setActive(e)}))},InitMapEventHandler(){let e=e=>{var t=this.map.forEachFeatureAtPixel(e,(e=>{if("agv"===e.get("feature_type")){const t=e.get("agvname");return t}}));this.agvSelectedState.isClicked=void 0!=t,this.agvSelectedState.agvName=t},t=e=>{var t=this.map.forEachFeatureAtPixel(e,(e=>{if(e)return e}));return t};this.map.on("pointermove",(e=>{if(this.DragBackgroundImageMode&&this.dragStartPosition){e.preventDefault();let t=e.coordinate[0]-this.dragStartPosition[0],a=e.coordinate[1]-this.dragStartPosition[1];console.log(t,a),this.new_map_img_extent[0]+=t,this.new_map_img_extent[1]+=a,this.new_map_img_extent[2]+=t,this.new_map_img_extent[3]+=a,this.ResetImageExtend(this.new_map_img_extent),this.dragStartPosition=e.coordinate}this.MouseCoordination=e.coordinate;var t=this.map.forEachFeatureAtPixel(e.pixel,(function(e,t){return e}));this.map.getTargetElement().style.cursor=t?"pointer":""})),this.map.on("pointerup",(e=>{if(this.DragBackgroundImageMode&&(this.dragStartPosition=null),"add-station"==this.EditorOption.EditAction?this.map.getTargetElement().style.cursor="crosshair":this.map.getTargetElement().style.cursor="default",2==e.originalEvent.button){var t="",a=new fi;this.agvSelectedState.isClicked&&!this.editable&&(t="agv",a.agvName=this.agvSelectedState.agvName),this.editable&&this.SelectedFeatures.length>0&&(t="multi-point",a.selectedFeatures=this.SelectedFeatures),!this.editable&&this.clickedFeature&&!this.agvSelectedState.isClicked&&this.clickedFeature.get("data")&&this.clickedFeature.get("data").IsEquipment&&(t="eq",a.selectedFeature=this.clickedFeature),""!=t&&this.userLevel>0&&this.$refs["contextMenu2"].showAt([e.originalEvent.x,e.originalEvent.y],t,a)}})),this.map.on("pointerdown",(a=>{e(a.pixel);var i=t(a.pixel);i&&((0,Vs.O)(i),this.clickedFeature=i,this.editable&&(this.previousSelectedFeatures=[i]));const s=2==a.originalEvent.button;!s&&this.$refs["contextMenu2"]&&this.$refs["contextMenu2"].hide(),this.DragBackgroundImageMode&&s?this.dragStartPosition=a.coordinate:this.map.getTargetElement().style.cursor="grabbing"})),this.map.on("moveend",(e=>{this.SaveSettingsToLocalStorage()})),this.map.on("click",(e=>{var a=t(e.pixel);this.IsCtrlPressing||(this.RestoreStyleOfSelectedFeatures(this.SelectedFeatures),this.SelectedFeatures=[]),this.IsCtrlPressing&&void 0!=a&&(this.SelectedFeatures.includes(a)?(this.RestoreStyleOfSelectedFeatures([a]),this.SelectedFeatures.splice(this.SelectedFeatures.indexOf(a),1)):(a.set("oriStyle",a.getStyle().clone()),this.SelectedFeatures.push(a),this.HighLightFeatureSelected(this.SelectedFeatures,"rgb(13, 110, 253)")))})),this.map.on("postrender",(()=>{this.postRenderThrottleTimer||(this.postRenderThrottleTimer=setTimeout((()=>{this.$forceUpdate(),this.postRenderThrottleTimer=null}),500))}))},HandleDeleteForbidRegionClicked(){var e=()=>{this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.mapEditsInteraction),this.RemoveInteraction(this.edit_forbid_regions_interaction)};e(),this.regionsVisible=!0;var t="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(t),this.AddRemoveForbidRegionInteraction()},HandleEditForbidRegionClicked(){var e=()=>{this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.mapEditsInteraction)};this.regionsVisible=!0,e();var t="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(t),this.AddEditForbidRegionInteraction()},HandleAddForbidRegionClicked(e){var t=()=>{this.RemoveInteraction(this.mapEditsInteraction),this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.edit_forbid_regions_interaction)};t(),this.regionsVisible=!0;var a="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(a),this.AddDrawForbidActionInteraction(e)},HandleDrawGlobalPathRegionClicked(){var e="coordination"!=this.map_display_mode;this.map_display_mode="coordination",this.MapDisplayModeOptHandler(e),this.AddDrawGlobalPathActionInteraction()},AddEditMapInteraction(){this.RemoveForbidRegionOperationInteractions();var e=this;this.mapEditsInteraction=new Ie.Z({handleDownEvent:function(t){const a=2==t.originalEvent.button;e.editModeContextMenuVisible=!1,e.ClearSelectedFeature();var i=t.map,s=i.forEachFeatureAtPixel(t.pixel,(function(e){return e}));this.coordinate_=t.coordinate;var n=e.EditorOption.EditAction;if(!a||!s||"path"!=s.get("feature_type")||"add-station"!=n){if(!s||s.get("grid_line")){if(e.IsDragging=!1,"add-station"!=n||!a)return!1;s=(0,Ge.s6)(t.coordinate,e.GenNewIndexOfStation())}else{if("polygon"==s.get("type")||"text"==s.get("type"))return!1;var o=s.get("feature_type"),l=()=>(e.IsSelectAGVMode||e.IsSelectEQStationMode)&&"agv"==o,r=()=>e.IsSelectEQStationMode&&"station"==o;if(l()){var d=s.get("agvname");Le.Z.emit("/map/agv_selected",d),Le.Z.emit("/map/station_selected",{isAGV:!0,agvName:d})}if(r()){var c=s.get("data");Le.Z.emit("/map/station_selected",c)}}if("lduld"==s.get("feature_type")){var u=s.get("action");return e.HandleLDULDLabelClick(s.get("data"),u),!1}if("view"==e.EditorOption.EditMode)return!1;var m=s.get("feature_type");return this.feature_=s,e.IsDragging=!a,"none"==n&&m!=e.FeatureKeys.Station?!1:(0==t.originalEvent.button?m==e.FeatureKeys.Station&&"remove-station"==n?e.RemoveStation(s):m==e.FeatureKeys.path&&"remove-path"==n?e.RemovePath(s):"add-path"==n&&e.PushPathEndPointData(s):2==t.originalEvent.button&&m==e.FeatureKeys.path&&"edit-path"==n&&e.OpenPath_editor(s),!0)}e.InsertPointAtPathes(s,t.coordinate)},handleDragEvent:function(t){if(e.IsDragging){var a=e.editable,i=e.EditorOption.EditMode,s=e.EditorOption.EditAction;if(a&&"edit"==i&&"add-path"!=s&&"edit-path"!=s&&"remove-path"!=s&&"path"!==this.feature_.get("feature_type")){var n=t.coordinate[0]-this.coordinate_[0],o=t.coordinate[1]-this.coordinate_[1];e.MouseCoordination=this.coordinate_=t.coordinate;var l=(t=new de.Z)=>{var a=t.getGeometry();a.translate(n,o),a=t.getGeometry();var i=t.get("data");if(i){var s=a.getCoordinates();"coordination"==e.map_display_mode?(i.X=s[0],i.Y=s[1]):(i.Graph.X=s[0],i.Graph.Y=s[1]),t.set("data",i)}};e.SelectedFeatures.length>0?e.SelectedFeatures.forEach((e=>l(e))):l(this.feature_)}}},handleUpEvent:function(t){if("view"!=e.EditorOption.EditMode){var a=e.EditorOption.EditAction;if("add-path"!=a&&"remove-path"!=a){if(2==t.originalEvent.button)if("edit-station"==a)e.HandlePtSettingBtnClick();else if("add-station"==a)try{e.AddFeatureToMapLayers(this.feature_)}catch(i){console.error(i),e.HandlePtSettingBtnClick()}e.IsDragging=!1;try{let t=(t=new de.Z)=>{var a=t.get("index");e.ResetPathLinkOfRouteMode(a),e.ResetPathLinkOfCoordinationMode(a)};e.SelectedFeatures.length>0?e.SelectedFeatures.forEach((e=>{t(e)})):t(this.feature_)}catch(i){}}this.feature_=null,this.coordinate_=null}},handleMoveEvent:function(t){var a=e.EditorOption.EditAction;if("view"!=e.EditorOption.EditMode){e.MouseCoordination=t.coordinate;var i=t.map,s=i.forEachFeatureAtPixel(t.pixel,(function(e,t){return e})),n="";if(s){var o=s.get("grid_line");if(o)return;var l=s.get("feature_type"),r={"add-path":e.FeatureKeys.Station,"remove-station":e.FeatureKeys.Station,"remove-path":e.FeatureKeys.path};n="pointer",r[a]&&l!=r[a]&&(n="not-allowed")}else"add-station"==a&&(n="crosshair"),this.feature_=void 0;i.getTargetElement().style.cursor=n}}}),this.map.addInteraction(this.mapEditsInteraction)},AddDrawGlobalPathActionInteraction(){this.RemoveForbidRegionOperationInteractions(),this.RemoveInteraction(this.draw_global_path_regions_interaction);const e="rgba(152, 209, 224,.5)";this.draw_global_path_regions_interaction=new re.ZP({source:this.RegionLayer.getSource(),type:"Polygon",condition:Pe.rM,style:new _e.ZP({fill:new fe.Z({color:e}),stroke:new we.Z({color:"blue",width:1})})});var t=this;this.draw_global_path_regions_interaction.on("drawend",(a=>{var i=t.GetGlobalPathRegionCount(),s=`道路區域-${i}`;const n="path",o=a.feature;o.set("type","polygon"),o.set("name",s),o.set("region_type",n);const l=o.getGeometry().getInteriorPoint().getCoordinates();console.info(l),o.setStyle(new _e.ZP({fill:new fe.Z({color:e}),stroke:new we.Z({width:1})}));const r=new de.Z({geometry:new he.Z(l)});r.set("type","text"),r.set("name",s),r.set("region_type",n),r.setStyle(new _e.ZP({text:new ye.Z({text:s,scale:1.2,fill:new fe.Z({color:"black"})})})),t.RegionLayer.getSource().addFeature(r)})),this.map.addInteraction(this.draw_global_path_regions_interaction)},AddDrawForbidActionInteraction(e="forbid|passible",t=void 0,a=void 0){this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.draw_global_path_regions_interaction);const i="Polygon";var s=this,n="forbid"==e,o=n?"rgba(255, 0, 0,0.5)":"rgba(116, 249, 42,0.5)",l=n?"red":"seagreen";"None"!==i&&(this.draw_forbid_regions_interaction=new re.ZP({source:this.RegionLayer.getSource(),type:i,condition:Pe.rM,style:new _e.ZP({fill:new fe.Z({color:o}),stroke:new we.Z({color:"blue",width:1})})}),a&&this.draw_forbid_regions_interaction.on("drawstart",a),this.draw_forbid_regions_interaction.on("drawend",(a=>{this.saveTempMapData(),setTimeout((()=>{var i=n?s.GetForbidRegionCount():s.GetPassibleRegionCount(),r=n?"orange":"rgb(139, 171, 206)",d=n?`禁制區-${i+1}`:`通行區-${i+1}`;t&&(d=t);const c=a.feature;if(c.set("type","polygon"),c.set("name",d),c.set("region_type",e),t){c.set("redraw",!0);var u=new Ge.S9(d,[]);_.merge(u,this.tempHiddenFeaturesOfRegion.find((e=>e.get("name")==d&&"polygon"==e.get("type"))).get("data")),u.PolygonCoordinations=c.getGeometry().getCoordinates(),c.set("data",u)}const m=c.getGeometry().getInteriorPoint().getCoordinates();console.info(m),c.setStyle(new _e.ZP({fill:new fe.Z({color:o}),stroke:new we.Z({color:l,width:1})}));const h=new de.Z({geometry:new he.Z(m)});h.set("type","text"),h.set("name",d),h.set("region_type",e),t&&h.set("redraw",!0),h.setStyle(new _e.ZP({text:new ye.Z({text:d,scale:1.1,font:"bold 22px Arial",fill:new fe.Z({color:"white"}),backgroundFill:new fe.Z({color:r}),padding:[5,5,5,5]})})),s.RegionLayer.getSource().addFeature(h),s.isRedrawConfirmable=!0}),100)})),this.map.addInteraction(this.draw_forbid_regions_interaction))},AddRemoveForbidRegionInteraction(){this.RemoveInteraction(this.delete_forbid_regions_interaction),this.RemoveInteraction(this.draw_global_path_regions_interaction);var e=this.RegionLayer.getSource();this.delete_forbid_regions_interaction=new Ie.Z({handleDownEvent:function(t){var a=t.map,i=a.forEachFeatureAtPixel(t.pixel,(function(e){return e}));if(i&&"polygon"==i.get("type")){var s=i.get("name");e.removeFeature(i);var n=e.getFeatures().find((e=>e.get("name")==s));e.removeFeature(n),(0,xt.bM)({title:"管制區修改",message:`管制區-${s} 已刪除`,position:"bottom-right",duration:1e3})}}}),this.map.addInteraction(this.delete_forbid_regions_interaction)},AddEditForbidRegionInteraction(){this.RemoveInteraction(this.edit_forbid_regions_interaction),this.RemoveInteraction(this.draw_global_path_regions_interaction);var e=this.$refs["forbid_region_editor"],t=this.RemoveKeyboardPressEventListener;let a=this;this.edit_forbid_regions_interaction=new Ie.Z({handleDownEvent:function(i){var s=i.map,n=s.forEachFeatureAtPixel(i.pixel,(function(e){return e}));if(!n||"polygon"!=n.get("type"))return;if(a.showRedrawControl)return;var o=n.get("name");let l=a.RegionLayer.getSource().getFeatures();var r=l.find((e=>e.get("name")==o&&"text"==e.get("type"))),d=l.find((e=>e.get("name")==o&&"polygon"==e.get("type")));t();var c=new Ge.S9(o,[]);_.merge(c,d.get("data")),console.log(c),e.Show(c,r,d)}}),this.map.addInteraction(this.edit_forbid_regions_interaction)},RemoveAllInteractions(){this.draw_forbid_regions_interaction&&this.map.removeInteraction(this.draw_forbid_regions_interaction),this.draw_global_path_regions_interaction&&this.map.removeInteraction(this.draw_global_path_regions_interaction),this.delete_forbid_regions_interaction&&this.map.removeInteraction(this.delete_forbid_regions_interaction),this.edit_forbid_regions_interaction&&this.map.removeInteraction(this.edit_forbid_regions_interaction),this.mapEditsInteraction&&this.map.removeInteraction(this.mapEditsInteraction)},RemoveInteraction(e){e&&this.map.removeInteraction(e)},RemoveKeyboardPressEventListener(){document.removeEventListener("keydown",this.EditModeKeybordEvents)},HideNormalStations(e){var t=this.StationPointsFeatures.filter((e=>0==e.get("station_type")));t.forEach((t=>{if(e){var a=new _e.ZP({fill:new fe.Z({color:"rgba(0, 0, 0, 0)"}),stroke:new we.Z({color:"rgba(0, 0, 0, 0)"}),image:new ve.Z({radius:0})}),i=t.getStyle().clone();t.set("visible-style",i),t.setStyle(a)}else{var s=t.get("visible-style");t.setStyle(s)}}))},SaveSettingsToLocalStorage(){var e=this.map.getView().getZoom(),t=this.map.getView().getCenter();"coordination"==this.map_display_mode?(this.zoom=e,this.center=t):(this.zoom_route=e,this.center_route=t),this.settings.zoom=this.zoom,this.settings.zoom_route=this.zoom_route,this.settings.mode=this.map_display_mode,this.settings.center=this.center,this.settings.center_route=this.center_route,this.settings.station_name_display_mode=this.station_name_display_mode,this.settings.map_image_display=this.map_image_display,this.settings.legendShow=this.legendShow,this.settings.dragActionLock=this.dragActionLock,this.settings.vehicleBatStatus=this.vehicleBatVisible,this.settings.rackStatusDisplay=this.rackVisible,localStorage.setItem(this.map_name_with_url,JSON.stringify(this.settings))},RestoreSettingsFromLocalStorage(){var e=localStorage.getItem(this.map_name_with_url);e&&(this.settings=new Ge.l3,_.merge(this.settings,JSON.parse(e)),this.station_name_display_mode=this.settings.station_name_display_mode,this.map_image_display=this.settings.map_image_display,this.map_display_mode=this.editable?"coordination":this.settings.mode,this.zoom=this.settings.zoom,this.legendShow=this.settings.legendShow,this.map.getView().setCenter(this.settings.center),this.map.getView().setZoom(this.settings.zoom),this.ImageLayer.setVisible("visible"==this.map_image_display),this.editable?this.dragActionLock=!0:this.IsOpUsing?this.dragActionLock=!1:this.dragActionLock=this.settings.dragActionLock,this.setDragPanEnabled(this.dragActionLock),this.vehicleBatVisible=this.settings.vehicleBatStatus,this.rackVisible=this.settings.rackStatusDisplay)},RemoveStation(e=new de.Z){this.saveTempMapData();var t=function(e,t){var a=e.getFeatures().find((e=>e.get("index")==t));e.removeFeature(a)},a=function(e,t,a){var i=a.get("index"),s=t.filter((e=>e.StartPtIndex==i||e.EndPtIndex==i));s.forEach((a=>{var i=a.PathID,s=e.getFeatures().find((e=>e.get("path_id")==i));e.removeFeature(s);var n=t.indexOf(a);-1!=n&&t.splice(n,1)}))},i=e.get("index");t(this.PointLayer.getSource(),i),t(this.PointRouteLayer.getSource(),i),a(this.PointLayer.getSource(),this.PathesSegmentsForEdit,e);this.UpdateStationPathLayer()},AddFeatureToMapLayers(e){this.saveTempMapData(),this.PointLayer.getSource().addFeature(e),this.PointRouteLayer.getSource().addFeature(e);var t=new Ge.eX;t.index=t.name=e.get("index"),t.tag=e.get("tag"),t.station_type=e.get("station_type"),t.targets=e.get("targets"),t.coordination=e.get("coordination"),t.graph=e.get("graph"),t.data=e.get("data"),this._map_stations.push(t)},RemovePath(e,t=!1){var a=[],i=e.get("path_id"),s=i.split("_"),n=parseInt(s[0]),o=parseInt(s[1]),l=this.PointLayer.getSource().getFeatures().find((e=>e.get("index")==n)),r=l.get("data");delete r.Target[o];r=l.set("data",r);this.PathLayerForCoordination.getSource().removeFeature(e);var d=this.PathesSegmentsForEdit.find((e=>e.PathID==i));if(d){var c=this.PathesSegmentsForEdit.indexOf(d);if(-1!=c&&(this.saveTempMapData(),this.PathesSegmentsForEdit.splice(c,1),this.UpdateStationPathLayer(),a.push(d)),t){var u=`${o}_${n}`,m=this.PathLayerForCoordination.getSource().getFeatures().find((e=>e.get("path_id")==u));if(m){var h=this.RemovePath(m,!1);h.forEach((e=>{a.push(e)}))}}}return a},InsertPointAtPathes(e,t){var a=(0,Ge.s6)(t,this.GenNewIndexOfStation()),i=this.RemovePath(e,!0);this.AddFeatureToMapLayers(a);var s="router"==this.map_display_mode?this.PointRouteLayer.getSource().getFeatures():this.PointLayer.getSource().getFeatures();i.forEach((e=>{if(e&&e.StartPtIndex&&e.EndPtIndex){var t=s.find((t=>t.get("index")==e.StartPtIndex)),i=a,n=a,o=s.find((t=>t.get("index")==e.EndPtIndex));this.GenPath([t,i]),this.GenPath([n,o])}}));this.CalculateNewPointRatioOfPathStart(i[0],a)},CalculateNewPointRatioOfPathStart(e,t){if(e){var a="router"==this.map_display_mode?this.PointRouteLayer.getSource().getFeatures():this.PointLayer.getSource().getFeatures(),i=a.find((t=>t.get("index")==e.StartPtIndex)),s=a.find((t=>t.get("index")==e.EndPtIndex)),n=i.getGeometry().getCoordinates(),o=s.getGeometry().getCoordinates(),l=t.getGeometry().getCoordinates(),r=Math.sqrt(Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2)),d=Math.sqrt(Math.pow(n[0]-l[0],2)+Math.pow(n[1]-l[1],2)),c=d/r;return c}},ResetNewPointCoordination(e,t){this.PointRouteLayer.getSource().getFeatures();var a=this.PointLayer.getSource().getFeatures(),i=t.get("index"),s=a.find((e=>e.get("targets").includes(i))),n=a.find((e=>e.get("index")==t.get("targets")[0])),o=s.getGeometry().getCoordinates(),l=n.getGeometry().getCoordinates(),r=o[0]+(l[0]-o[0])*e,d=o[1]+(l[1]-o[1])*e,c=a.find((e=>e.get("index")==i)),u=c.get("data"),m=[r,d];u.X=m[0],u.Y=m[1],c.set("data",u),this.ResetPathLinkOfRouteMode(i),this.ResetPathLinkOfCoordinationMode(i)},ResetPathLinkOfCoordinationMode(e,t=!1){var a=this.PointLayer.getSource().getFeatures().find((t=>t.get("index")==e)),i=this.PathLayerForCoordination.getSource().getFeatures();try{for(var s=i.filter((t=>t.get("start_pt_index")==e)),n=0;n<s.length;n++){var o=s[n],l=o.get("path_id"),r=this.PathesSegmentsForEdit.find((e=>e.PathID==l));if(o)if(t)source.removeFeature(o),this.PathesSegmentsForEdit.remove(r);else{var d=o.getGeometry(),c=d.getCoordinates()[1],u=a.getGeometry().getCoordinates(),m=new me.Z([u,c]);o.setGeometry(m),o.setStyle((0,Ge.bE)(o)),r.StartCoordination=u}}}catch(w){}try{for(s=i.filter((t=>t.get("end_pt_index")==e)),n=0;n<s.length;n++){var h=s[n],p=this.PathesSegmentsForEdit.find((e=>e.PathID==h.get("path_id")));if(t)source.removeFeature(h),this.PathesSegmentsForEdit.remove(p);else{d=h.getGeometry();var g=d.getCoordinates()[0],_=a.getGeometry().getCoordinates();m=new me.Z([g,_]);h.setGeometry(m),h.setStyle((0,Ge.bE)(h)),p.EndCoordination=_}}}catch(w){}},ResetPathLinkOfRouteMode(e,t=!1){var a=this.PointRouteLayer.getSource().getFeatures().find((t=>t.get("index")==e)),i=this.PathLayerForRouter.getSource().getFeatures();try{for(var s=i.filter((t=>t.get("start_pt_index")==e)),n=0;n<s.length;n++){var o=s[n],l=o.get("path_id"),r=this.PathesSegmentsForEdit.find((e=>e.PathID==l));if(o)if(t)source.removeFeature(o),this.PathesSegmentsForEdit.remove(r);else{var d=o.getGeometry(),c=d.getCoordinates()[1],u=a.getGeometry().getCoordinates(),m=new me.Z([u,c]);o.setGeometry(m),o.setStyle((0,Ge.bE)(o))}}}catch(w){}try{for(s=i.filter((t=>t.get("end_pt_index")==e)),n=0;n<s.length;n++){var h=s[n],p=this.PathesSegmentsForEdit.find((e=>e.PathID==h.get("path_id")));if(t)source.removeFeature(h),this.PathesSegmentsForEdit.remove(p);else{d=h.getGeometry();var g=d.getCoordinates()[0],_=a.getGeometry().getCoordinates();m=new me.Z([g,_]);h.setGeometry(m),h.setStyle((0,Ge.bE)(h))}}}catch(w){}},ResetPathLink(e,t,a=!1){var i=e.getSource(),s=i.getFeatures(),n=s.find((e=>e.get("index")==t));try{var o=s.filter((e=>e.get("start_pt_index")==t));o.forEach((e=>{var t=e.get("path_id"),s=this.PathesSegmentsForEdit.find((e=>e.PathID==t));if(e)if(a)i.removeFeature(e),this.PathesSegmentsForEdit.remove(s);else{var o=e.getGeometry(),l=o.getCoordinates()[1],r=n.getGeometry().getCoordinates(),d=new me.Z([r,l]);e.setGeometry(d),e.setStyle((0,Ge.bE)(e)),s.StartCoordination=r}}))}catch(r){}try{var l=s.filter((e=>e.get("end_pt_index")==t));l.forEach((e=>{var t=this.PathesSegmentsForEdit.find((t=>t.PathID==e.get("path_id")));if(a)i.removeFeature(e),this.PathesSegmentsForEdit.remove(t);else{var s=e.getGeometry(),o=s.getCoordinates()[0],l=n.getGeometry().getCoordinates(),r=new me.Z([o,l]);e.setGeometry(r),e.setStyle((0,Ge.bE)(e)),t.EndCoordination=l}}))}catch(r){}},PushPathEndPointData(e=new de.Z){if(e.get("feature_type")==this.FeatureKeys.Station){if(2==this.PathEditTempStore.length)this.PathEditTempStore=[];else if(1==this.PathEditTempStore.length&&this.PathEditTempStore[0].get("index")==e.get("index"))return;if(this.PathEditTempStore.push(e),2==this.PathEditTempStore.length&&(this.saveTempMapData(),this.GenPath(this.PathEditTempStore),"bi-direction"==this.EditorOption.AddPathMode.Direction)){var t=[this.PathEditTempStore[1],this.PathEditTempStore[0]];this.GenPath(t)}}},GenPath(e=[]){var t=e[0],a=e[1],i=t.get("index"),s=a.get("index"),n=t.get("data").X,o=t.get("data").Y,l=a.get("data").X,r=a.get("data").Y,d=t.getGeometry().getCoordinates(),c=a.getGeometry().getCoordinates(),u=[(d[0]+c[0])/2,(d[1]+c[1])/2],m=((0,Ge.s6)(u,this.GenNewIndexOfStation()),0!=a.get("station_type")||0!=t.get("station_type")),h=`${i}_${s}`;if(!this.PathLayerForCoordination.getSource().getFeatures().find((e=>e.get("path_id")==h))){var p={PathID:h,StartPtIndex:i,EndPtIndex:s,StartCoordination:[n,o],EndCoordination:[l,r],IsEQLink:m,IsSingleCar:!1,IsPassable:!0,IsExtinguishingPath:!1,Speed:1,LsrMode:0,DodgeMode:0,SpinMode:0};this.PathesSegmentsForEdit.push(p);var g=t.get("targets");g||(g=[]);var _=t.get("data");_.Target[s]=1,t.set("data",_),g.push(s),t.set("targets",g),this.UpdateStationPathLayer()}},GenNewIndexOfStation(){var e=this.PointLayer.getSource().getFeatures().map((e=>e.get("index"))),t=e.filter((e=>void 0!=e)).sort(((e,t)=>e-t)),a=0==t.length?0:t[t.length-1]+1;return a},AgvDisplayOptHandler(){this.AGVLocLayer.setVisible("visible"==this.agv_display)},SlamImageDisplayOptHandler(){"coordination"!=this.map_display_mode&&this.UpdateStationPathLayer(),this.ImageLayer.setVisible("visible"==this.map_image_display),this.SaveSettingsToLocalStorage()},MapDisplayModeOptHandler(e=!0){var t="coordination"==this.map_display_mode;this.UpdateStationPathLayer(),this.StationNameDisplayOptHandler(),this.PointLayer.setVisible(t),this.PointRouteLayer.setVisible(!t),this.PathLayerForCoordination.setVisible(t),this.PathLayerForRouter.setVisible(!t),this.RegionLayer.setVisible(t&&this.regionsVisible),this.UpdateEQLDULDFeature(),this.UpdateAGVLocLocation(),e&&this.map.getView().setCenter(t?this.GetMidPointOfCoordinationMode():this.GetMidPointOfRouterMode())},UpdateAGVLocLocation(){this.agvs_info.AGVDisplays.forEach((e=>{this.UpdateAGVLocByMapMode(this.map_display_mode,e)}))},GetMidPointOfRouterMode(){var e=[...this._map_stations];e.sort(((e,t)=>e.graph[0]-t.graph[0]));var t=e[0],a=e[e.length-1],i=(a.graph[0]+t.graph[0])/2;e.sort(((e,t)=>e.graph[1]-t.graph[1])),t=e[0],a=e[e.length-1];var s=(a.graph[1]+t.graph[1])/2;return[i,s]},GetMidPointOfCoordinationMode(){var e=[...this._map_stations];e.sort(((e,t)=>e.coordination[0]-t.coordination[0]));var t=e[0],a=e[e.length-1],i=(a.coordination[0]+t.coordination[0])/2;e.sort(((e,t)=>e.coordination[1]-t.coordination[1])),t=e[0],a=e[e.length-1];var s=(a.coordination[1]+t.coordination[1])/2;return console.log(i,s),[i,s]},StationNameDisplayOptHandler(){this.SetDisplayString(this.station_name_display_mode),this.SaveSettingsToLocalStorage()},ToggleLocus(e){this.AGVLocusLayer.getSource().getFeatures().find((t=>t.get("id")==e))?this.HideLocus(e):this.ShowLocus(e)},ShowLocus(e=[],t="red",a=1,i="red",s=""){this.AGVLocLayer.setVisible(!1);var n=this.AGVLocusLayer.getSource();if(n){var o=[];let l=(0,Ge.tW)(e[e.length-1],!1,"",i);l.set("id",s);let r=new de.Z({geometry:new me.Z(e)});r.set("id",s),r.setStyle((0,Ge.DS)(t,a)),r.set("oriGeometry",r.getGeometry()),l.set("oriGeometry",l.getGeometry()),o.push(r),o.push(l),n.addFeatures(o)}},HideLocusByID(e){var t=this.AGVLocusLayer.getSource(),a=t.getFeatures(),i=a.filter((t=>t.get("id")==e));i.forEach((e=>{e.setGeometry(null)}))},ShowLocusByID(e){var t=this.AGVLocusLayer.getSource(),a=t.getFeatures(),i=a.filter((t=>t.get("id")==e));i.forEach((e=>{e.setGeometry(e.get("oriGeometry"))}))},ClearLocus(){this.AGVLocusLayer.getSource().clear()},HiddenAgvLayer(){this.AGVLocLayer.setVisible(!1)},ShowAgvLayer(){this.AGVLocLayer.setVisible(!0)},async HandlerSaveBtnClick(){if(We.Ys.state.IncompletedTaskListData.find((e=>1==e.State))){const e=await this.$swal.fire({title:"圖資修改警告",text:"有任務正在運行中，變更地圖可能會造成不可預期的錯誤，確定要繼續嗎？",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"});if(!e.isConfirmed)return}if(this.showRedrawControl)if(this.isRedrawConfirmable){const e=await this.$swal.fire({title:"提示",text:"正在重繪管制區域且尚未儲存，是否要儲存當前重繪結果?",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"});e.isConfirmed?this.HandleCompleteRegionRedraw():this.HandleCancleRegionRedraw()}else this.HandleCancleRegionRedraw();const e=this.$refs["forbid_region_editor"];e.Hide(),this.$emit("save",this._GetMapDataCurrent()),this.SelectedFeatures=[]},saveTempMapData(){var e=JSON.parse(JSON.stringify(this._GetMapDataCurrent()));this.$emit("tempSave",e)},_GetMapDataCurrent(){var e={};this.PointLayer.getSource().getFeatures().forEach((t=>{var a=t.get("index"),i=t.get("data");e[a]=i}));var t={Points:e,Pathes:this.PathesSegmentsForEdit,Regions:this.GetRegionsDataFromLayer(),ImageFile:this.to_upload_image_file,ImageExtent:this.new_map_img_extent};return t},HandlePtSettingBtnClick(){this.isCtrlPressing||this.SelectedFeatures.length>0||(this.RemoveKeyboardPressEventListener(),this.editModeContextMenuVisible=!1,this.$refs.ptsetting.Show({index:this.previousSelectedFeature.get("index"),point:this.previousSelectedFeature.get("data")}))},ReloadMap(e=!0){var t=async()=>{this.loading=e,this.map_img_url_for_editor=null,await Re.p.dispatch("DownloadMapData",""),console.log("re-done"),this.RefreshMap(),this.loading=!1};e?this.$swal.fire({title:"確定要重新載入圖資?",icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",customClass:"my-sweetalert"}).then((async e=>{e.isConfirmed&&location.reload()})):t()},DeepClonePathSegmentData(e=void 0){this.PathesSegmentsForEdit=e||JSON.parse(JSON.stringify(this.PathesSegments))},InitMap(){this.map_image_display=Re.p.getters.DefaultShowBackgroundImage?"visible":"";const e=Re.p.getters.Rotation;this.new_map_img_extent=this.map_img_extent;const t=this.map_img_extent,a=new Me.Z({code:"xkcd-image",units:"pixels",extent:t});this.map_name=Re.p.getters.MapName,this.ImageLayer=new ce.Z({source:new Te.Z({url:this.map_image_url,projection:a,imageExtent:t,imageSize:this.map_img_size}),visible:"visible"==this.map_image_display}),this.AGVLocusLayer=new ue.Z({source:new ke.Z({features:[]})}),this.map=new be.Z({layers:[this.ImageLayer,this.RegionLayer,this.EQMaintainIconLayer,this.TransferTaskIconLayer,this.EQLDULDStatusLayer,this.PathLayerForCoordination,this.PathLayerForRouter,this.PointLayer,this.PointRouteLayer,this.AGVLocLayer,this.AGVLocusLayer,this.TrafficStateLayer],target:this.id,renderer:"canvas",view:new Ce.ZP({projection:a,center:[0,0],zoom:1,maxZoom:20,rotation:e*Math.PI/180,animation:!1,duration:0,smoothResolutionConstraint:!1,smoothExtentConstraint:!1,showFullExtent:!0})}),this.AGVLocLayer.setVisible(this.agv_show),this.editable&&(this.PointLayer.setVisible(!1),this.PathLayerForCoordination.setVisible(!1),this.PointRouteLayer.setVisible(!0),this.PathLayerForRouter.setVisible(!0)),this.EQLDULDStatusLayer.setVisible(!this.editable),this.InitMapEventHandler(),this.initGrid(this.map,this.MapGridSize,t),this.IsOpUsing&&this.HideGridLayer(),this.editable&&(this.agv_display="hide")},UpdateTrafficStateLayer(e=[]){this.TrafficStateLayer.getSource().clear(),this.TrafficStateLayer.getSource().addFeatures(e)},ResetImageExtend(e){var t=new Te.Z({url:this.map_image_url,projection:new Me.Z({code:"xkcd-image",units:"pixels",extent:e}),imageExtent:e,imageSize:this.map_img_size});this.ImageLayer.setSource(t)},ResetImage(e){var t=new Te.Z({url:e,projection:new Me.Z({code:"xkcd-image",units:"pixels",extent:this.map_img_extent}),imageExtent:this.map_img_extent,imageSize:this.map_img_size});this.ImageLayer.setSource(t)},initGrid(e,t,a=[-25,-25,15,15],i=-2,s=0){const n=a.map((e=>10*e)),o=t,l=new ke.Z;for(let r=n[0];r<=n[2];r+=o){const e=new de.Z(new me.Z([[r+i,n[1]+s],[r+i,n[3]+s]]));e.set("grid_line",!0),l.addFeature(e)}for(let r=n[1];r<=n[3];r+=o){const e=new de.Z(new me.Z([[n[0]+i,r+s],[n[2]+i,r+s]]));e.set("grid_line",!0),l.addFeature(e)}this.gridLayer=new ue.Z({source:l,name:"gridLayer",style:new _e.ZP({stroke:new we.Z({color:"rgb(197, 206, 255)",width:1})})}),e.addLayer(this.gridLayer)},GetForbidRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"forbid"==e.get("region_type")));return t.length},GetPassibleRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"passible"==e.get("region_type")));return t.length},GetGlobalPathRegionCount(){var e=this.RegionLayer.getSource().getFeatures(),t=e.filter((e=>"polygon"==e.get("type")&&"path"==e.get("region_type")));return t.length},GetRegionsDataFromLayer(){let e=[];var t=this.RegionLayer.getSource().getFeatures(),a=t.filter((e=>"polygon"==e.get("type")));return a.forEach((t=>{var a=t.get("name"),i=t.get("region_type");let s=new Ge.S9("",[],-1);Object.assign(s,t.get("data"));var n=t.getGeometry().flatCoordinates;function o(e){const t=[];let a=[];for(let i=0;i<e.length;i++)a.push(e[i]),i%2===1&&(t.push(a),a=[]);return t}let l=o(n);s.Name=a||`禁制區-${GetForbidRegionCount()+1}`,s.PolygonCoordinations=l,s.RegionType="forbid"==i?0:1,e.push(s)})),console.log(e),e},ResetMapCenterViaAGVLoc(e){var t=this.AGVFeatures[e];if(t){var a=t.agv_feature.getGeometry().getCoordinates();this.map.getView().setCenter(a)}},HandleSettingBtnClick(){this.$refs.settings.show=!0},ClearSelectedFeature(e=!1){if(!this.editable||e){try{this.previousSelectedFeatures.forEach((e=>{var t=e.get("oriStyle");e.setStyle(t)}));var t=this.previousSelectedFeature.get("oriStyle");this.previousSelectedFeature.setStyle(t)}catch{}this.previousSelectedFeatures=[]}},HighLightFeatureSelected(e=[new de.Z],t="red",a=!1){var i=Re.p.state.MapData.Options.workStationTextFontSize;e.forEach((e=>{try{var s=e.getStyle().clone();if(s){var n=s.getText().clone();n&&(n.setBackgroundFill(new fe.Z({color:t})),n.setFill(new fe.Z({color:"white"})),n.setPadding([5,5,5,5]),a?(n.setOffsetY(-20),n.setFont(`bold ${i}px Calibri,sans-serif`)):(n.setOffsetX(0),n.setOffsetY(0),n.setFont(`bold ${i}px Calibri,sans-serif`)),s.setText(n),e.setStyle(s))}}catch(o){}}))},RestoreStyleOfSelectedFeatures(e=[new de.Z]){e.forEach((e=>{try{var t=e.get("oriStyle");e.setStyle(t)}catch(a){}}))},HighLightFeaturesByStationType(e=0,t="red"){var a=this.StationPointsFeatures.filter((t=>t.get("station_type")==e));this.HighLightFeatureSelected(a,t)},HandleAGVUploadData(e=[{TagNumber:0,X:0,Y:0,Theta:0}]){var t=this.PointLayer.getSource().getFeatures();Object.values(e).forEach((e=>{var a=t.find((t=>t.get("data").TagNumber==e.TagNumber));if(a){a.setGeometry(new he.Z([e.X,e.Y]));var i=a.get("data");i.Direction=parseInt(Math.round(e.Theta)),a.set("data",i)}else{var s=new Ge.eX;s.coordination=[e.X,e.Y],s.index=this.GenNewIndexOfStation(),s.station_type=0,s.name=e.TagNumber+"",s.tag=e.TagNumber;var n=new Ge.ux;n.StationType=0,n.X=e.X,n.Y=e.Y,n.Graph.X=parseInt(Math.round(e.X)),n.Graph.Y=parseInt(Math.round(e.Y)),n.Name=e.TagNumber+"",n.TagNumber=e.TagNumber,n.Direction=parseInt(Math.round(e.Theta)),s.data=n;var o=(0,Ge.HB)(s);this.PointLayer.getSource().addFeature(o)}}))},showContextMenu(e){if(e.preventDefault(),!this.editable&&"add-station"!=this.EditorOption.EditAction&&this.previousSelectedFeature){this.contextMenuTop=e.clientY,this.contextMenuLeft=e.clientX;var t=this.previousSelectedFeature.get("feature_type");this.contextMenuOptions.feature_type=t;var a=this.previousSelectedFeature.get("data");a&&(this.contextMenuOptions.title=a.Name,this.contextMenuOptions.point_data=a,this.contextMenuOptions.task_options=new Ge.UY(a.StationType),this.contextMenuOptions.show_task_dispatch=this.task_dispatch_menu_show),this.editModeContextMenuVisible=!0}},HandlePtSettingDrawerLeaved(){this.RemoveKeyboardPressEventListener(),document.addEventListener("keydown",this.EditModeKeybordEvents)},EditModeKeybordEvents(e){var t=e.key.toLowerCase();0!=this.selectedSettingTabIndex||this.IsPathEditing||"edit"!=this.EditorOption.EditMode||("e"==t&&(this.EditorOption.EditMode="edit"),"v"==t&&(this.EditorOption.EditMode="view"),"escape"==t&&(this.draw_forbid_regions_interaction&&this.draw_forbid_regions_interaction.abortDrawing(),this.draw_global_path_regions_interaction&&this.draw_global_path_regions_interaction.abortDrawing()),"1"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="add-station",this.AddEditMapInteraction()),"2"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="edit-station",this.AddEditMapInteraction()),"3"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="remove-station",this.AddEditMapInteraction()),"4"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="add-path",this.AddEditMapInteraction()),"5"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="edit-path",this.AddEditMapInteraction()),"6"==t&&(this.RemoveForbidRegionOperationInteractions(),this.EditorOption.EditAction="remove-path",this.AddEditMapInteraction()),"7"==t&&(this.EditorOption.EditAction="add-forbid-region",this.HandleAddForbidRegionClicked(this.EditorOption.AddRegionMode.Mode)),"8"==t&&(this.EditorOption.EditAction="edit-forbid-region",this.HandleEditForbidRegionClicked()),"9"==t&&(this.EditorOption.EditAction="remove-forbid-region",this.HandleDeleteForbidRegionClicked()))},PointSettingChangedHandle(e){var t=e.index,a=e.pointData,i=function(e,t,a,i=!1){var s=e.getFeatures().find((e=>e.get("index")==t));s.set("data",a),s.set("station_type",a.StationType),s.setStyle((0,Ge.rL)(a.Name,a.StationType,a));var n=s.getStyle(),o=n.clone(),l=o.getText();l.setText(a.Graph.Display);var r=l.getStroke();if(r){var d=r.clone();d.setColor("blue"),l.setStroke(d)}s.setStyle(o),i&&s.setGeometry(new he.Z([a.X,a.Y]))};i(this.PointLayer.getSource(),t,a,!0),i(this.PointRouteLayer.getSource(),t,a);for(var s=0!=a.StationType,n=this.PathesSegmentsForEdit.filter((e=>e.StartPtIndex==t)),o=this.PathesSegmentsForEdit.filter((e=>e.EndPtIndex==t)),l=0;l<n.length;l++)n[l].IsEQLink=s,n[l].StartCoordination=[a.X,a.Y];for(l=0;l<o.length;l++)o[l].IsEQLink=s,o[l].EndCoordination=[a.X,a.Y];this.UpdateStationPathLayer()},HandleMenuTaskBtnClick(e={action:"",station_data:{}}){this.editModeContextMenuVisible=!1;var t=0;"move"==e.action?t=0:"load"==e.action|"unload"==e.action|"carry"==e.action?t=1:"charge"==e.action&&(t=3),this.HighLightFeaturesByStationType(t,"blue"),Le.Z.emit("bus-show-task-allocation",e)},HandleAGVUploadCorrdinationChanged(e){Re.p.dispatch("UploadCoorFunctionSwitch",e)},HandleLedgendShowChanged(e){this.SaveSettingsToLocalStorage()},HandleDragLockSwitchChanged(){this.setDragPanEnabled(this.dragActionLock),this.SaveSettingsToLocalStorage()},HandleLDULDLabelClick(e,t){},EqMaintainIconDisplay(e,t){var a=this.EQMaintainIconLayer.getSource().getFeatures(),i=a.find((t=>t.get("tag")==e));if(i){var s=i.getStyle();s.getImage().setOpacity(t?1:0),i.setStyle(s)}},CreateEqMaintainingFeature(e,t){var a=t,i=new de.Z({geometry:new he.Z(a)});return i.set("tag",e.TagNumber),i.setStyle(new _e.ZP({image:new Se.Z({src:"/maintain-64.png",scale:.8,anchor:[.01,1.6],size:[64,64],opacity:0})})),i},ChangeEQIconByStatus(e,t=3,a=!1,i=!1,s=!1,n=!1){var o=new Se.Z({src:"/images/tray.png",scale:.1,anchor:[.5,.2],size:[1652,781],opacity:.8}),l=new Se.Z({src:"/images/eq-icon.png",scale:.6,anchor:[.5,.2],size:[64,64],opacity:1});try{var r=this.StationPointsFeatures.find((t=>t.get("data").TagNumber==e)),d=r.getStyle().clone(),c=r.get("data").Graph.Display;a?d.setImage(o):d.setImage(l);const g="rgba(67, 149, 237,0.4)",_="rgb(255, 220, 61)",w="rgba(10, 101, 69,.6)",f="rgba(255, 0, 0,.8)",y="rgba(255,255,255,.1)";var u=Re.p.state.MapData.Options.workStationTextColor,m=d.getText(),h=y;if(i?(h=f,c+=`\n(${this.$t("Map.MapLegend.Maintaining")})`,u="white"):1==t?h=_:2==t?h=g:4==t&&(h=w,u="white"),m.setBackgroundFill(new fe.Z({color:h})),s){var p=this.$t("Map.PartsReplacing");c+=`\r\n(${p})`}n&&(c+="\r\n(Reserved)"),m.setText(c),m.setFill(new fe.Z({color:u})),d.setText(m),r.setStyle(d),r.set("oriStyle",d)}catch(g){console.error(g)}},ChangeLDULDStatus(e,t,a){try{var i=1!=t&&2!=t,s=1==t?"load":"unload",n=this.EQLDULDStatusLayer.getSource().getFeatures(),o=n.find((t=>t.get("data").TagNumber==e));if(!o)return;var l=o.getStyle();if(!l)return;var r=l.getText();if(!r)return;this.EqMaintainIconDisplay(e,a);var d="";if(1==t||2==t){let e="zh-Tw"==this.$i18n.locale.toLowerCase();var c=e?" 入料請求":" Load Request",u=e?" 出料請求":" Unload Request";d=1==t?c:u}r.setText(d),r.setBackgroundFill(new fe.Z({color:i?"":1==t?"orange":"blue"})),l.setText(r),o.set("action",s),o.setStyle(l),o.changed()}catch(m){console.error(m)}},RenderEQLDULDStatus(e){console.log("eq data changed"),e.forEach((t=>{let a=new ma.Z;Object.assign(a,t);const i=e.filter((e=>e.Tag==t.Tag)),s=i.length<=1;if(s){const e=a.IsReserved;this.ChangeEQIconByStatus(a.Tag,a.TransferStatus,a.Port_Exist,a.IsMaintaining,a.IsPartsReplacing,e)}else{const e=void 0!=i.find((e=>e.IsReserved)),t=void 0!=i.find((e=>1==e.TransferStatus)),s=void 0!=i.find((e=>2==e.TransferStatus)),n=void 0!=i.find((e=>e.Port_Exist)),o=void 0!=i.find((e=>e.IsMaintaining)),l=void 0!=i.find((e=>e.IsPartsReplacing));t&&s?this.ChangeEQIconByStatus(a.Tag,4,n,o,l,e):t?this.ChangeEQIconByStatus(a.Tag,1,n,o,l,e):s?this.ChangeEQIconByStatus(a.Tag,2,n,o,l,e):this.ChangeEQIconByStatus(a.Tag,3,n,o,l,e)}}))},RefreshMap(e=void 0){this.MapGridSizeStore=Re.p.state.MapData.Options.gridSize,this.MapGridSizeXOffset=Re.p.state.MapData.Options.gridOffsetX,this.MapGridSizeYOffset=Re.p.state.MapData.Options.gridOffsetY,this.ModifyGridOffset(),this._map_stations=JSON.parse(JSON.stringify(e?e.stations:this.map_station_data)),this.DeepClonePathSegmentData(e?e.pathes:void 0),this.UpdateStationPathLayer(),this.UpdateStationPointLayer(),this.MapDisplayModeOptHandler(!1),this.UpdateForbidPointLayer(),this.ModifyMapRotation(Re.p.getters.Rotation),this.ResetImageExtend(this.map_img_extent)},RemoveForbidRegionOperationInteractions(){this.RemoveInteraction(this.draw_forbid_regions_interaction),this.RemoveInteraction(this.edit_forbid_regions_interaction),this.RemoveInteraction(this.delete_forbid_regions_interaction)},OpenPath_editor(e=new de.Z){var t=e.get("path_id");if(t){var a=this.PathesSegmentsForEdit.find((e=>e.PathID==t)),i=a.EndPtIndex+"_"+a.StartPtIndex,s=this.PathesSegmentsForEdit.find((e=>e.PathID==i));this.IsPathEditing=!0,this.SelectedPathData=a,this.HandlePathTbRowClick(a),s?(this.ShowPathSelectDialog=!0,this.PathesCandicats=[a,s]):(this.HandlePathTbRowClick(a),this.$refs["path_editor"].Show(a))}},HandlePathSelected(e){this.IsPathEditing=!0,this.ShowPathSelectDialog=!1,this.SelectedPathData=e,setTimeout((()=>{this.HandlePathTbRowClick(e)}),1e3),this.$refs["path_editor"].Show(e)},HandlePathSetingDrawerClosed(e){this.IsPathEditing=!1,this.selected_path_feature&&this.RestoreOriginalPathStyle(this.selected_path_feature)},HandleForbidRegionEditDrawerClosed(){document.addEventListener("keydown",this.EditModeKeybordEvents)},HandleRegionRedraw(e=new Ge.S9){this.showRedrawControl=!0,this.AddDrawForbidActionInteraction("passible",e.Name,(e=>{this.HandleResetRegionRedraw()}));var t=this.RegionLayer.getSource().getFeatures();let a=t.filter((t=>t.get("name")==e.Name));this.tempHiddenFeaturesOfRegion=a,a&&a.forEach((e=>{this.RegionLayer.getSource().removeFeature(e)}))},SetPathesAsBeControledStyle(){var e=Object.keys(this.ControledPathesBySystem);if(0!=e.length){var t=this.PathLayerForCoordination.getSource();e.forEach((e=>{var a=t.getFeatures().find((t=>t.get("path_id")==e));if(a){var i=a.getStyle(),s=i[0].getStroke();s&&(s.setColor("orange"),i[0].setStroke(s),a.setStyle(i))}})),this.map.render()}},ChangeToSelectAGVMode(){this.RestoredFillColorOfChangedFeature(),this.ChangeFeaturesAsIgnoreStyle(this.StationPointsFeatures,"rgb(222, 222, 222)"),this.IsSelectAGVMode=!0,this.IsSelectEQStationMode=!1,this.AGVLocLayer.setVisible(!0)},ChangeToSelectEQStationMode(){var e="move"==this.TaskDispatchOptions.action_type,t="load"==this.TaskDispatchOptions.action_type,a="unload"==this.TaskDispatchOptions.action_type,i="charge"==this.TaskDispatchOptions.action_type,s="park"==this.TaskDispatchOptions.action_type,n=(this.TaskDispatchOptions.action_type,"destine"==this.TaskDispatchOptions.direction);this.highlightingFeatures=[],"source"==this.TaskDispatchOptions.direction&&(this.RestoredFillColorOfChangedFeature(),this.TransferTaskIconLayer.getSource().clear());var o=this.StationPointsFeatures.filter((e=>e.get("data").IsCharge)),l=this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge)),r=this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge&&0!=e.get("data").StationType)),d=(this.StationPointsFeatures.filter((e=>!e.get("data").IsCharge&&4!=e.get("data").StationType)),this.StationPointsFeatures.filter((e=>0==e.get("data").StationType))),c=this.StationPointsFeatures.filter((e=>e.get("data").IsParking||4==e.get("data").StationType||e.get(5=="data".StationType))),u=d.filter((e=>e.get("data").IsVirtualPoint));if(this.RestoredFillColorOfChangedFeature(),"charge"==this.TaskDispatchOptions.action_type)this.ChangeFeaturesAsIgnoreStyle(l),console.info(o),this.ChangeFeaturesAsCandicatingStyle(o);else if(this.ChangeFeaturesAsIgnoreStyle(o),this.TaskDispatchOptions.stations_to_show&&0!=this.TaskDispatchOptions.stations_to_show.length){var m=this.TaskDispatchOptions.stations_to_show.map((e=>e.tag)),h=this.StationPointsFeatures.filter((e=>0!=e.get("data").StationType&&!m.includes(e.get("data").TagNumber))),p=this.StationPointsFeatures.filter((e=>m.includes(e.get("data").TagNumber)));this.ChangeFeaturesAsIgnoreStyle(h),this.ChangeFeaturesAsCandicatingStyle(p)}else n&&(e?(this.ChangeFeaturesAsIgnoreStyle(r),this.ChangeFeaturesAsIgnoreStyle(u,"grey")):a||t?(this.ChangeFeaturesAsIgnoreStyle(o),this.ChangeFeaturesAsIgnoreStyle(d,"grey"),this.ChangeFeaturesAsCandicatingStyle(r)):i?(this.ChangeFeaturesAsIgnoreStyle(r),this.ChangeFeaturesAsIgnoreStyle(d,"grey")):s?(this.ChangeFeaturesAsIgnoreStyle(r),this.ChangeFeaturesAsIgnoreStyle(d,"grey"),this.ChangeFeaturesAsCandicatingStyle(c)):this.ChangeFeaturesAsIgnoreStyle(this.StationPointsFeatures));if(this.IsSelectAGVMode=!1,this.IsSelectEQStationMode=!0,clearInterval(this.featureHighlightTimerID),!e)var g=0;this.featureHighlightTimerID=setInterval((()=>{var e=(e,t,a)=>{var i=e.getStyle().clone(),s=i.getText(),n=s.getFill().clone();n.setColor(t),s.setFill(n),i.setText(s),e.setStyle(i)};this.highlightingFeatures.forEach((t=>{let a=0==g?Re.p.state.MapData.Options.workStationTextColor:"green",i=0==g?"rgba(9, 76, 176 ,0.1)":"rgba(2, 20, 48 ,0.4)";e(t,a,i)})),g=0==g?1:0}),600)},ChangeToNormalViewMode(){this.highlightingFeatures=[],clearInterval(this.featureHighlightTimerID),this.AGVLocLayer.setVisible(!0),this.StationNameDisplayOptHandler(),this.IsSelectAGVMode=this.IsSelectEQStationMode=!1,this.TransferTaskIconLayer.getSource().clear(),this.RestoredFillColorOfChangedFeature(),setTimeout((()=>{clearInterval(this.featureHighlightTimerID)}),600)},RestoredFillColorOfChangedFeature(){this.StationPointsFeatures.forEach((e=>{e.get("oriStyle")&&e.setStyle(e.get("oriStyle"))})),this.AGVLocLayer.getSource().getFeatures().forEach((e=>{e.get("oriStyle")&&e.setStyle(e.get("oriStyle"))}))},ChangeFeaturesAsIgnoreStyle(e){var t=Re.p.state.MapData.Options.workStationTextColor;e.forEach((e=>{e.set("isSelectable",!1);var a=e.getStyle();if(a){e.set("oriStyle",a);try{var i=a.clone(),s=i.getImage();if(s){var n=s.clone();i.setImage(n)}var o=i.getText();if(o){var l=o.getFill();if(l){var r=l.clone();r.setColor(t),o.setFill(r),e.setStyle(i)}}}catch{}}}))},ChangeFeaturesAsCandicatingStyle(e){var t=Re.p.state.MapData.Options.workStationTextColor;e.forEach((e=>{var a=e.getStyle();if(a){e.set("oriStyle",a.clone());try{var i=a.clone(),s=i.getImage();if(s){var n=s.clone();i.setImage(n)}var o=i.getText();if(o){var l=o.getFill();if(l){var r=l.clone();r.setColor(t),o.setFill(r),e.setStyle(i),this.highlightingFeatures.push(e)}}}catch(d){console.info(d)}}}))},CreateDestineMarkIcon(e){if(!this.editable){var t=()=>{const e="zh-TW"==this.$i18n.locale;var t={move:e?Ge.a_.move.zh:Ge.a_.move.en,carry:e?Ge.a_.carry_destien.zh:Ge.a_.carry_destien.en,load:e?Ge.a_.load.zh:Ge.a_.load.en,unload:e?Ge.a_.unload.zh:Ge.a_.unload.en,charge:e?Ge.a_.charge.zh:Ge.a_.charge.en};return t[this.TaskDispatchOptions.action_type]};if("carry"!=this.TaskDispatchOptions.action_type)this.TransferTaskIconLayer.getSource().clear();else{var a=this.TransferTaskIconLayer.getSource().getFeatures();this.TransferTaskIconLayer.getSource().removeFeature(a[1])}this.AddMarkIconWithText(e,t(),"rgb(246, 166, 19)")}},AddMarkIconWithTextAtAGV(e,t,a="rgb(13, 110, 253)"){var i=this.AGVLocLayer.getSource().getFeatures().find((t=>t.get("agvname")==e));if(i){var s=i.getGeometry().getCoordinates(),n=this.TransferTaskIconLayer.getSource(),o=(0,Ge.Be)(s,t,a);n.addFeature(o)}},AddMarkIconWithText(e,t,a="rgb(13, 110, 253)"){var i=this.StationPointsFeatures.find((t=>t.get("data").TagNumber==e));if(i){var s=i.getGeometry().getCoordinates(),n=this.TransferTaskIconLayer.getSource(),o=(0,Ge.Be)(s,t,a);n.addFeature(o)}},ModifyGridSize(e){this.RemoveGridLayer(),this.initGrid(this.map,e,this.map_img_extent),Re.p.commit("setMapGridSize",e)},ModifyGridOffset(){this.RemoveGridLayer(),this.initGrid(this.map,this.MapGridSize,this.map_img_extent,this.MapGridSizeXOffset,this.MapGridSizeYOffset),Re.p.commit("setMapGridOffsetX",this.MapGridSizeXOffset),Re.p.commit("setMapGridOffsetY",this.MapGridSizeYOffset)},ModifyMapRotation(e=void 0){var t=e||this.MapRotation,a=this.map.getView();a.setRotation(t*Math.PI/180),this.map.setView(a),Re.p.commit("SetRotation",t),this.MapRotation=t},RemoveGridLayer(){var e=this.map.getLayers().getArray(),t=e.find((e=>"gridLayer"===e.get("name")));t&&this.map.removeLayer(t)},HideGridLayer(){this.gridLayer.setVisible(!1)},ImageEditClick(){this.ShowImageEditorDialog=!0,setTimeout((()=>{var e=this.$refs["imageEditor"];console.info(e),e.pic=this.map_image_url}),100)},HandleImageCropedDone(e){this.ShowImageEditorDialog=!1,this.map_img_url_for_editor=e.blobURL,this.to_upload_image_file=e.file,this.ResetImage(this.map_img_url_for_editor)},HandlePathColorSelected(e){Re.p.commit("setPathColor",e),this.SetPathColor(e)},HandleWorkStationNameColorSelected(e,t=!1){t||Re.p.commit("setWorkStationPointTextColor",e),this.GetAllPointsFeatures().filter((e=>0!=e.get("station_type"))).forEach((t=>{this.SetPointTextFillColor(t,e)}))},HandleNormalPointNameColorSelected(e,t=!1){t||Re.p.commit("setNormalPointTextColor",e),this.GetAllPointsFeatures().filter((e=>0==e.get("station_type"))).forEach((t=>{this.SetPointTextFillColor(t,e)}))},HandleWorkStationTextSizeChanged(e){Re.p.commit("setWorkStationPointTextFontSize",e),this.GetAllPointsFeatures().filter((e=>0!=e.get("station_type"))).forEach((t=>{this.SetPointTextFontSize(t,e)}))},HandleNormalStationTextSizeChanged(e){Re.p.commit("setNormalPointTextFontSize",e),this.GetAllPointsFeatures().filter((e=>0==e.get("station_type"))).forEach((t=>{this.SetPointTextFontSize(t,e)}))},GetAllPointsFeatures(){return[...this.PointLayer.getSource().getFeatures(),...this.PointRouteLayer.getSource().getFeatures()]},SetPointTextFillColor(e,t){var a=e.getStyle(),i=a.getText();i.getFill().setColor(t),a.setText(i),e.setStyle(a)},SetPointTextFontSize(e,t){var a=e.getStyle(),i=a.getText();i.setFont(`bold ${t}px Calibri,sans-serif`),a.setText(i),e.setStyle(a)},SetPathColor(e){var t=[...this.PathLayerForRouter.getSource().getFeatures(),...this.PathLayerForCoordination.getSource().getFeatures()];t.forEach((t=>{var a=t.getStyle(),i=a[0];if(i){var s=i.getStroke();s.setColor(e),i.setStroke(s),a[0]=i,t.setStyle(a)}}))},SetDisplayString(e){let t=(t=new de.Z)=>{let a=t.get("data"),i=a.TagNumber+"",s=a.Graph.Display,n=t.get("index")+"";return"name"==e?s:"name_tag"==e?`${s} (${i})`:"tag"==e?i:"index"==e?n:s};const a="index"==e||"tag"==e;this.StationPointsFeatures.forEach((e=>{var i=t(e),s=e.getStyle(),n=s.getText();if(a)n.setOffsetX(-20),n.setOffsetY(-20);else{const t=e.get("data");n.setOffsetX(t.Graph.textOffsetX),n.setOffsetY(t.Graph.textOffsetY)}n.setText(i),s.setText(n),e.setStyle(s)}))},ResetPointEnableStatus(e={1:!0}){var t=this.PointLayer.getSource().getFeatures(),a=this.PointRouteLayer.getSource().getFeatures();let i=(e=1)=>{var i=t.find((t=>t.get("data").TagNumber==e)),s=a.find((t=>t.get("data").TagNumber==e));return[i,s]},s=(e=new de.Z,t=!0)=>{if(e){var a=Re.p.getters.Settings.normalStationTextColor,i=Re.p.getters.Settings.workStationTextColor,s=e.get("data");s.Enable=t,e.set("data",s);var n=0==s.StationType,o=s.Graph.Display,l=e.getStyle().clone(),r=l.getText(),d=r.getFill().clone(),c=n?a:i,u=t?c:"rgb(255, 102, 92)";if(d.setColor(u),r.setFill(d),r.setText(`${o}${t?"":"(已禁用)"}`),n){var m=(0,Ge.h0)(s);l.setImage(m)}l.setText(r),e.setStyle(l),e.changed()}};Object.keys(e).forEach((t=>{let a=e[t];var n=i(t);s(n[0],a),s(n[1],a)}))},HanldeThemeChanged(e){if("dark"==e)this.HandleNormalPointNameColorSelected(this.map_theme_dark.normalPtTextColor,!0),this.HandleWorkStationNameColorSelected(this.map_theme_dark.stationPtTextColor,!0),this.SetPathColor(this.map_theme_dark.pathColor);else{const e=Re.p.state.MapData.Options;this.HandleNormalPointNameColorSelected(e.normalStationTextColor,!0),this.HandleWorkStationNameColorSelected(e.workStationTextColor,!0),this.SetPathColor(e.pathColor)}},HandleCancleRegionRedraw(){this.showRedrawControl=!1;this.$refs["forbid_region_editor"];this.tempHiddenFeaturesOfRegion&&this.RegionLayer.getSource().addFeatures(this.tempHiddenFeaturesOfRegion);var e=this.RegionLayer.getSource().getFeatures();e.filter((e=>e.get("redraw"))).forEach((e=>{this.RegionLayer.getSource().removeFeature(e)})),this.HandleEditForbidRegionClicked(),this.ShowEditingRegionSettingDrawer()},HandleResetRegionRedraw(){var e=this.RegionLayer.getSource().getFeatures();const t=this.redrawingRegionName;let a=e.filter((e=>e.get("name")==t));a&&a.forEach((e=>{this.RegionLayer.getSource().removeFeature(e)})),this.isRedrawConfirmable=!1},HandleCompleteRegionRedraw(){this.showRedrawControl=!1,this.HandleEditForbidRegionClicked(),this.ShowEditingRegionSettingDrawer(),this.$notify({message:`已完成[${this.redrawingRegionName}]區域重繪`,offset:50})},ShowEditingRegionSettingDrawer(){var e=this.$refs["forbid_region_editor"],t=this.redrawingRegionName;let a=this.RegionLayer.getSource().getFeatures();var i=a.find((e=>e.get("name")==t&&"text"==e.get("type"))),s=a.find((e=>e.get("name")==t&&"polygon"==e.get("type"))),n=new Ge.S9(t,[]);_.merge(n,s.get("data")),console.log(n.Name),e.Show(n,i,s)},HandleSearchTagSelected(e){if(this.clickedFeature&&this.clickedFeature.setStyle(this.clickedFeature.get("oriStyle")),!e)return;const t="coordination"==this.map_display_mode?this.PointLayer:this.PointRouteLayer,a=t.getSource().getFeatures(),i=a.find((t=>t.get("data").TagNumber==e));if(!i)return;const s=i.getGeometry().getCoordinates();this.map.getView().setCenter(s),this.map.getView().setZoom(3),i.set("oriStyle",i.getStyle().clone()),this.HighLightFeatureSelected([i],"rgb(13, 110, 253)",!0),this.clickedFeature=i},AddDrawBoxInteraction(){const e=new _e.ZP({backgroundFill:new fe.Z({color:"rgba(255, 165, 0, 1)"})}),t=new xe.Z({style:e});this.map.addInteraction(t);const a=t.getFeatures(),i=new Ee.Z({condition:Pe.QC});let s=()=>{let e=this.PointLayer.getSource();const t=i.getGeometry().getExtent(),s=this.map.getView().getProjection().getExtent(),n=(0,Oe.dz)(s),o=Math.floor((t[0]-s[0])/n),l=Math.floor((t[2]-s[0])/n);for(let r=o;r<=l;++r){const o=Math.max(t[0]-r*n,s[0]),l=Math.min(t[2]-r*n,s[2]),d=[o,t[1],l,t[3]],c=e.getFeaturesInExtent(d).filter((e=>!a.getArray().includes(e)&&e.getGeometry().intersectsExtent(d))),u=this.map.getView().getRotation(),m=u%(Math.PI/2)!==0;if(m){const e=[0,0],t=i.getGeometry().clone();t.translate(-r*n,0),t.rotate(-u,e);const s=t.getExtent();c.forEach((function(t){const i=t.getGeometry().clone();i.rotate(-u,e),i.intersectsExtent(s)&&(a.push(t),t.setStyle(t.get("oriStyle")))}))}else a.extend(c)}};this.map.addInteraction(i),i.on("boxend",s),i.on("boxstart",(function(){a.clear()}))}},mounted(){this.loading=!0,this.editable&&(this.RemoveKeyboardPressEventListener(),document.addEventListener("keydown",this.EditModeKeybordEvents)),this.loading=!0;var e=document.getElementById("map");e&&e.addEventListener("contextmenu",(function(e){e.preventDefault()})),setTimeout((()=>{this.MapGridSizeStore=this.MapGridSize,this.MapGridSizeXOffset=Re.p.state.MapData.Options.gridOffsetX,this.MapGridSizeYOffset=Re.p.state.MapData.Options.gridOffsetY,this.MapStyles.PathColor=Re.p.state.MapData.Options.pathColor,this.MapStyles.NormalPointNameColor=Re.p.state.MapData.Options.normalStationTextColor,this.MapStyles.WorkStationPointNameColor=Re.p.state.MapData.Options.workStationTextColor,this.MapStyles.NormalPointTextFontSize=Re.p.state.MapData.Options.normalStationTextFontSize,this.MapStyles.WorkStationPointTextFontSize=Re.p.state.MapData.Options.workStationTextFontSize,this.DeepClonePathSegmentData(),this.InitMap(),this.RestoreSettingsFromLocalStorage(),this.AddEditMapInteraction(),(0,i.YP)((()=>this.map_display_mode),((e,t)=>{"coordination"==e&&this.editable&&this.$message({message:"當前地圖模式為[Slam]，使用滑鼠拖曳變更點位位置即會變更座標設定。",type:"warning",duration:3e3,placement:"bottom",customClass:"map-elplus-message-style",showClose:!0})}),{immediate:!0}),(0,i.YP)((()=>this.map_station_data),((e,t)=>{e&&this.RefreshMap()}),{deep:!0,immediate:!0}),(0,i.YP)((()=>this.agvs_info),((e,t)=>{e&&JSON.stringify(e)!=JSON.stringify(t)&&(this.agvRenderDebounceTimer&&clearTimeout(this.agvRenderDebounceTimer),this.agvRenderDebounceTimer=setTimeout((()=>{this.UpdateAGVLayer()}),100))}),{deep:!0,immediate:!1}),(0,i.YP)((()=>this.agvs_info_other_system),((e,t)=>{e&&this.UpdateAGVLocationOfOtherSystem(e)}),{deep:!0,immediate:!0}),(0,i.YP)((()=>this.agv_upload_coordi_data),((e={},t)=>{this.agv_upload_coordination_mode&&this.HandleAGVUploadData(e)}),{deep:!0,immediate:!0}),Le.Z.on("/show_agv_at_center",(e=>{this.ResetMapCenterViaAGVLoc(e)})),Le.Z.on("/rerender_agv_layer",(()=>{console.log("rerender_agv_layer"),this.AGVLocLayer.getSource().clear(),this.AGVFeatures={}})),Le.Z.on("/tracking_agv",(e=>{clearInterval(this.trackingAGVTimer),""!=e&&(this.trackingAGVTimer=setInterval((()=>{this.ResetMapCenterViaAGVLoc(e)}),500))})),Le.Z.on("/cancel_tracking_agv",(()=>{clearInterval(this.trackingAGVTimer)})),Le.Z.on("change_to_select_agv_mode",(()=>{this.editable||this.ChangeToSelectAGVMode()})),Le.Z.on("change_to_select_eq_station_mode",(e=>{this.editable||(this.TaskDispatchOptions=JSON.parse(JSON.stringify(e)),this.ChangeToSelectEQStationMode())})),Le.Z.on("change_to_normal_view_mode",(()=>{this.editable||this.ChangeToNormalViewMode()})),Le.Z.on("mark_as_start_station",(e=>{if(!this.editable){console.info(e),this.TransferTaskIconLayer.getSource().clear();var t="zh-TW"==this.$i18n.locale?Ge.a_.carry_source.zh:Ge.a_.carry_source.en;e.isAGV?(t+="(AGV)",this.AddMarkIconWithTextAtAGV(e.agvName,t)):this.AddMarkIconWithText(e,t)}})),Le.Z.on("mark_as_destine_station",(e=>{this.CreateDestineMarkIcon(e)})),Le.Z.on("delete-multi-points",(()=>{this.SelectedFeatures.forEach((e=>{this.RemoveStation(e)})),this.$notify({type:"success",message:`Delete ${this.SelectedFeatures.length} point done`})})),Le.Z.on("restore_points_by_multi_point_changed",(()=>{this.SelectedFeatures.forEach((e=>{var t={index:e.get("index"),pointData:e.get("data")};this.PointSettingChangedHandle(t)})),this.$notify({type:"success",message:`Delete ${this.SelectedFeatures.length} point done`}),this.HighLightFeatureSelected(this.SelectedFeatures,"rgb(230, 162, 60)")})),Le.Z.on("stop_render",(()=>{clearInterval(this.renderLDULD_StatusTimerId)}));var e=document.getElementById(this.id);e&&e.addEventListener("contextmenu",(e=>{e.preventDefault()})),!this.editable&&this.eq_lduld_status_show&&(this.RenderEQLDULDStatus(We.jU.state.EQ),Le.Z.on("eq_data_changed",(e=>{this.RenderEQLDULDStatus(e)}))),this.UpdateAGVLocLocation(),this.loading=!1}),100),Le.Z.on("Map-Point-Enabled-Property-Changed",(async()=>{var e=await Re.p.dispatch("GetPointEnableMap");this.ResetPointEnableStatus(e)}))}};const qs=(0,Fe.Z)(Fs,[["render",ne],["__scopeId","data-v-42e90108"]]);var Bs=qs},91747:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var i=a(66252);function s(e,t,a,s,n,o){const l=(0,i.up)("el-option"),r=(0,i.up)("el-select");return(0,i.wg)(),(0,i.j4)(r,{size:"small",style:{width:"120px"},modelValue:n.selectedRegion,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedRegion=e),onChange:o.handleChange},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.valid_map_regions_options,(e=>((0,i.wg)(),(0,i.j4)(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])}var n=a(95320),o=a(83592),l={props:{default:{type:String}},data(){return{selectedRegion:this.default,valid_map_regions_options:[]}},methods:{handleChange(e){this.selectedRegion=e,this.$emit("input",e)}},mounted(){setTimeout((async()=>{this.valid_map_regions_options=n.p.getters.RegionOptions,this.valid_map_regions_options||(this.valid_map_regions_options=await(0,o.j2)()),this.valid_map_regions_options.unshift({label:"不分區",value:"all"})}),10)}},r=a(83744);const d=(0,r.Z)(l,[["render",s]]);var c=d},86952:function(e,t,a){"use strict";a.d(t,{Z:function(){return M}});var i=a(66252),s=a(3577);const n=e=>((0,i.dD)("data-v-78773153"),e=e(),(0,i.Cn)(),e),o={class:"vehicle-info-card-header p-2 border-bottom"},l={class:"flex-fill"},r=n((()=>(0,i._)("i",{class:"bi bi-circle-fill",style:{"font-size":"10px"}},null,-1))),d={key:0},c={key:1},u={class:"center-content d-flex justify-content-between p-2 m-1"},m={class:"item-name-label"},h={class:"item-name-label"},p={class:"item-name-label"},g={class:"text-bold"},_={class:"item-name-label"},w={class:"footer"},f={class:"station-name"},y={class:"station-name"},v={class:"button-like-container battery-info"},S=n((()=>(0,i._)("div",{class:"battery-head"},null,-1))),b={class:"battery-level-text"},C={class:"button-like-container mx-1",style:{width:"290px"}},k={class:"charge-button-container d-flex flex-column"};function T(e,t,a,n,T,D){const V=(0,i.up)("el-tooltip"),A=(0,i.up)("el-button"),I=(0,i.up)("el-tag"),x=(0,i.up)("el-progress"),E=(0,i.up)("b-button"),M=(0,i.up)("el-popover");return(0,i.wg)(),(0,i.iD)("div",{class:(0,s.C_)(["vehicle-info-card",[a.vehicleStateData.Connected?"connected":"vehicle-card-disconnect",0==a.vehicleStateData.OnlineStatus?"v-Offline":"v-Online"]])},[(0,i._)("div",o,[(0,i._)("div",{class:"vehicle-icon",style:(0,s.j5)(D.StyleOfAGVDisplayColor)},null,4),(0,i._)("h6",l,(0,s.zw)(a.vehicleStateData.AGV_Name),1),(0,i.Wm)(V,{content:"點擊顯示車載頁面",placement:"top"},{default:(0,i.w5)((()=>[(0,i._)("i",{class:"bi bi-globe mx-2",style:{cursor:"pointer"},onClick:t[0]||(t[0]=()=>{e.$emit("OnWebSiteIconClicked",a.vehicleStateData)})})])),_:1}),(0,i.Wm)(A,{class:(0,s.C_)(0!=a.vehicleStateData.OnlineStatus&&a.vehicleStateData.Connected?"text-success":"text-danger"),style:{"font-size":"16px"},onClick:D.HandleOnlineButtonClicked},{icon:(0,i.w5)((()=>[r])),default:(0,i.w5)((()=>[a.vehicleStateData.Connected?((0,i.wg)(),(0,i.iD)("span",c,(0,s.zw)(0==a.vehicleStateData.OnlineStatus?"Offline":"Online"),1)):((0,i.wg)(),(0,i.iD)("span",d,"Disconnect"))])),_:1},8,["class","onClick"])]),(0,i._)("div",u,[(0,i._)("div",null,[(0,i._)("label",m,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.status")),1),(0,i.Wm)(I,{class:"w-100",effect:"dark",type:D.AGVMainStatusDto.type,style:{height:"2rem"}},{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,s.zw)(D.AGVMainStatusDto.text),1)])),_:1},8,["type"])]),(0,i._)("div",null,[(0,i._)("div",null,[(0,i._)("label",h,(0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.position")),1),(0,i.Wm)(V,{content:"追隨AGV，AGV將保持顯示於地圖中央",placement:"top"},{default:(0,i.w5)((()=>[D.IsOpUsing?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("i",{key:0,style:(0,s.j5)([{cursor:"pointer",height:"22px",position:"relative",top:"2px","border-radius":"30px",width:"22px","padding-left":"4px","font-size":"18px"},a.isMapViewTracking?{backgroundColor:"rgb(13, 110, 253)",color:"white"}:{}]),class:"bi bi-eyeglasses mx-1",onClick:t[1]||(t[1]=()=>{e.$emit("OnTrackingVehicleClick",a.vehicleStateData.AGV_Name)})},null,4))])),_:1})]),(0,i._)("div",{class:"text-bold",onClick:t[2]||(t[2]=()=>{e.$emit("OnLocateClicked",a.vehicleStateData.AGV_Name)})},(0,s.zw)(a.vehicleStateData.StationName),1)]),(0,i._)("div",null,[(0,i._)("label",p,(0,s.zw)(e.$t("TaskTable.CstID")),1),(0,i._)("div",g,(0,s.zw)(a.vehicleStateData.CurrentCarrierID),1)]),(0,i._)("div",null,[(0,i._)("label",_,(0,s.zw)(e.$t("TaskTable.TaskName")),1),(0,i._)("div",{class:"text-truncate text-bold task-id",onClick:t[3]||(t[3]=(...e)=>D.HandleTaskIDClicked&&D.HandleTaskIDClicked(...e)),style:{width:"120px"}},(0,s.zw)(D.CurrentOrderID),1)])]),(0,i._)("div",w,[(0,i._)("div",{class:(0,s.C_)(["button-like-container w-100",D.IsOrderRunning?"order-run":"no-order-run"])},[(0,i.Uk)((0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.From"))+" ",1),(0,i._)("span",f,(0,s.zw)(a.vehicleStateData.TaskSourceStationName),1)],2),(0,i._)("div",{class:(0,s.C_)(["button-like-container w-100 mx-1",D.IsOrderRunning?"order-run":"no-order-run"])},[(0,i.Uk)((0,s.zw)(e.$t("HomeView.AGVStatus.AGVStatus.To"))+" ",1),(0,i._)("span",y,(0,s.zw)(a.vehicleStateData.TaskDestineStationName),1)],2),(0,i._)("div",v,[(0,i.Wm)(x,{percentage:a.vehicleStateData.BatteryLevel_1,"stroke-width":"20",striped:"","striped-flow":"",duration:"12"},{default:(0,i.w5)((()=>[S,(0,i._)("div",b,(0,s.zw)(a.vehicleStateData.BatteryLevel_1?a.vehicleStateData.BatteryLevel_1.toFixed(0):0)+"%",1)])),_:1},8,["percentage"])]),(0,i._)("div",C,[(0,i.Wm)(M,{width:"150",placement:"right"},{reference:(0,i.w5)((()=>[(0,i.Wm)(A,{type:"success",class:(0,s.C_)(D.getChargeButtnClass()),onClick:t[4]||(t[4]=()=>e.$emit("ShowAGVChargeConfirmDialog",a.vehicleStateData))},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(2==a.vehicleStateData.Model?e.$t("Exchange Battery"):e.$t("Charge")),1)])),_:1},8,["class"])])),default:(0,i.w5)((()=>[(0,i._)("div",k,[(0,i.Wm)(E,{variant:"warning",style:{width:"100%","margin-bottom":"8px"},onClick:t[5]||(t[5]=()=>e.$emit("ShowAGVChargeConfirmDialog",a.vehicleStateData))},{default:(0,i.w5)((()=>[(0,i.Uk)("一般充電")])),_:1}),(0,i.Wm)(E,{variant:"success",style:{width:"100%","margin-bottom":"8px"},onClick:t[6]||(t[6]=()=>e.$emit("ShowAGVDeepChargeConfirmDialog",a.vehicleStateData))},{default:(0,i.w5)((()=>[(0,i.Uk)("深度充電")])),_:1}),(0,i.Wm)(E,{variant:"light",style:{width:"100%","margin-bottom":"8px"},onClick:t[7]||(t[7]=()=>e.$emit("StopDeepCharge",a.vehicleStateData.AGV_Name))},{default:(0,i.w5)((()=>[(0,i.Uk)("解除深度充電")])),_:1})])])),_:1})])])],2)}a(89302);var D=a(56938),V=(a(8764),a(95320)),A=a(25044),I=(a(30381),{name:"vehicle-info-card",data(){return{}},props:{vehicleStateData:{type:D.Z,default(){return new D.Z}},isMapViewTracking:{type:Boolean,default:!1}},computed:{IsOpUsing(){return A.HP.getters.IsOPLogining},StyleOfAGVDisplayColor(){const e=this.vehicleStateData.AGV_Name;var t="blue";return V.p.getters.CustomAGVStyles[e]&&(t=V.p.getters.CustomAGVStyles[e].DisplayColor),{backgroundColor:t}},AGVMainStatusDto(){const e=this.vehicleStateData.MainStatus;let t="Unknown",a="info";return 1==e?(t=this.$t("AGVStatus.IDLE"),a="warning"):2==e?(t=this.$t("AGVStatus.RUN"),a="success"):3==e?(t=this.$t("AGVStatus.DOWN"),a="danger"):4==e&&(t=this.$t("AGVStatus.CHARGING"),a="default"),{text:t,type:a}},IsOrderRunning(){return this.CurrentOrderStatus.isExecuting},CurrentOrderID(){return this.IsOrderRunning?this.CurrentOrderStatus.order.TaskName:""},CurrentOrderStatus(){const e=this.vehicleStateData.AGV_Name,t=A.Ys.state.IncompletedTaskListData.find((t=>1==t.State&&t.DesignatedAGVName==e));return{order:t,isExecuting:void 0!=t}}},methods:{getChargeButtnClass(){var e=A.sn.getters.VehicleBatteryStatus(this.vehicleStateData.AGV_Name);return 1==e?"charge-deep-charging":"charge-normal"},HandleOnlineButtonClicked(){this.$emit("OnOnlineBtnClicked",this.vehicleStateData)},HandleTaskIDClicked(){this.IsOrderRunning&&this.$emit("onTaskIdClick",this.CurrentOrderID)}},mounted(){},beforeUnmount(){}}),x=a(83744);const E=(0,x.Z)(I,[["render",T],["__scopeId","data-v-78773153"]]);var M=E},6771:function(){},18022:function(){},86045:function(){},98190:function(){},57333:function(){},6139:function(){},19594:function(e){"use strict";e.exports=JSON.parse('{"App":{"Header":{"agvs":"AGVS","view_mode":"View Mode","operating_mode":"Operating mode","op mode":"OP mode","Maintenance mode":"MA mode","Simple mode":"Simple mode","ENG mode":"ENG mode","chinese":"中文","english":"英文","LOGIN":"LOGIN","LOGOUT":"LOGOUT","Switch user":"Switch user","systemalarm":"System Alarm","alarmreset":"Alarm Reset","eqalarm":"EQP Alarm","Turnoffbuzzer":"Buzzer OFF"},"LaterRemindMe":"Notify Later","AutoLogoutNotify":"Logout Automatically","PushOkToRefreshPage":"Push \'OK\' Button To Refresh Page"},"Menu":{"Home":"Home","System Alarm":"System Alarm","wip_manager":"Rack Status","vehicle manager":"Vehicles Settings","system settings":"System Settings","map and display":"Map and Display","map edit":"Map Edit","agv display":"AGV Visualize","vehicle battery managnment":"AGV battery Settings","equipment management":"Equipments Settings","racks management":"Racks Settings","charge station management":"Chargers Data","user management":"Users settings","Querys":"Data Query","Task History":"Task History","Alarm History":"Alarm History","Trajectory":"Trajectory","Instruments Measure Result":"Instruments Measure","utilization rate":"Utilization","Traffic State":"Traffic State","secs_gem_settings":"SECS/GEM Settings"},"HomeView":{"AGVStatus":{"AGVStatus":{"vehicle-status":"Vehicle Status","vms_disconnect":"VMS DisConnect","vehicle-name":"Name","vehicle-statuslist":"Status","task-status":"Task Status","status":"Status","carrierid":"Carrier ID","vehicleconn":"AGVC","position":"Locate","power":"Bat LV","From":"From","To":"To","action":"Action","Time":"Time","Online":"Online","Offline":"Offline","Location":"Locate","OnlineRequest":"Online","OfflineRequest":"Offline"}},"TaskStatus":"TASK STATUS","Map":"Map","EQ_Status":"EQ_Status","EQStatus":{"EQStatus":{"ViewMode":"ViewMode","IO":"IO","Connected":"Connected","DisConnect":"DisConnect","ON":"Signal[ON]","OFF":"Signal[OFF]","Handshake_EQ":"Handshake-EQ","Handshake_AGV":"Handshake-AGV","emulator":"Emulator:","changetoBusy":"Change to Busy","changetoLoad":"Change to Load","changetoUnload":"Change to Unload","Cancel_maintenance":"Cancel Maintenance","Maintenance_Simulation":"Maintenance Simulation","Cancel_replacement_parts":"Cancel replacement parts","Part_replacement_simulation":"Part replacement simulation","EQ_Name":"EQ Name","Main_Status":"Main Status","TransferStatus":"Transfer Status","Exist":"Exist","Instock":"In stock","SoldOut":"Sold Out","CarrierID":"Carrier ID","Load":"Load Request","UnLoad":"UnLoad Request","IsMaintaining":"Maintaining","IsPartsReplacing":"Replacing"}}},"Action":"Action","Vehicle":"Vehicle","source":"From","Remove":"Remove","Choose_Sourse_from_Map":"Select Sourse","Choose_Dest_from_Map":"Select Destine","Choose_Port":"Select Port","Transport":"Transport","Transport_Port":"Transport Port","Choose_Transport_Port_from_Map":"Select Transport Port","TaskDispathActionButton":{"Destine":"To","dispatch-confirm":"DISPATCH","Back To Select Action":"Back","clear-selected":"RE-SELECT"},"Cancel":"Cancel","auto-choise-vehicle":"Auto Assignment","Transfer":"Transfer","Charge":"Charge","Exchange Battery":"Exchange Battery","Measure":"Measure","Move":"Move","Park":"Park","Unload":"Unload","Load":"Load","Dispatch":"DISPATCH","IncompleteTasks":"Incomplete","CompleteTasks":"Completed","Search":{"Search":"Search","Output_csv_file":"Output csv file","Start_Time":"Start Time","End_Time":"End Time","Move":"Move","Load":"Load","UnLoad":"UnLoad","Transfer":"Transfer","Charge":"Charge","Measure":"Measure","ExchangeBattrey":"Exchange Battery","Completed":"Completed","Fail":"Fail","Cancel":"Cancel","Total_First":"Total","Total_Last":" Transaction in Total"},"TaskTable":{"NoTasks":"No Tasks","TaskName":"Task ID","AGV_Name":"AGV Name","EQ_Name":"EQ Name","Time":"Time","Action":"Action","Final":"Final","TaskStatus":"Status","ExcuteAgvName":"AGV Name","Source":"SOURCE","Destine":"DESTINE","Source_Slot":"Source Slot","Destine_Slot":"Destine Slot","Dispatcher":"Dispatcher","Fail_reason":"Fail reason","CstID":"Cargo ID","FinishTime":"End Time","RecievedTime":"Recieve Time","FailureReason":"Failure Reason","UnloadTime":"Unload Time","LoadTime":"Load Time","StartLocation":"Start Location","AGVReadID":"AGV Read ID","Reassign":"Re-Assign","AutoSelectVehicle":"Auto Select Vehicle"},"AlarmTable":{"Time":"Time","Occur_Time":"Occur Time","EQ_Name":"EQ Name","Alarm_code":"Alarm Code","Alarm_description":"Alarm Description","Alarm_Type":"Alarm Type","TaskName":"TaskName","Occur_Tag":"Occur Tag","Duration":"Duration","Clear_OP":"Clear OP","Solution":"Solution","FailureReason":"Failure Reason"},"Rack":{"Creat_ID":"Creat ID","Edit_ID":"Edit ID","Remove_ID":"Remove ID","copy":"copy","Sensor_Flash":"Sensor Flash","Cargo_Spaces":"Cargo Spaces"},"Map":{"Options":{"DisplayMode":"Display","MapMode":"Map Mode","AgvVisible":"AGV Visible","BackgroundImage":"Background Image","PathVisible":"Path Visible","RegionVisible":"Region Visible","AgvBatVisible":"AGV Bat."},"Notification":{"SelectSource":"Select [SOURCE] Equipment","SelectDestine":"Select [DESTINE] Equipment"},"MapLegend":{"Unloadble":"Unloadable","Loadable":"Loadable","Maintaining":"Maintaining","UnLoadLoadable":"Unload/Load"},"PartsReplacing":"Paper Roller Replacing"},"hidden":"Hidden","Show":"Show","PathNetwork":"Path Network","select-vehicle":"SELECT AGV","AGVStatus":{"IDLE":"IDLE","CHARGING":"CHARGING","RUN":"RUN","DOWN":"DOWN"},"TaskAction":{"GoToSource":"Move To Source","GoToDestineUnload":"To Destine Unload","GoToDestineload":"To Destine Load","GoToChargeStation":"To Charge Station","Unloading":"Unloading","Loading":"Loading"},"TaskDispatchNewUI":{"ConfirmDispatchText":"Are you sure you want to dispatch this task?"},"AGVBatterySetting":{"HighBatteryLevel":"High Battery Level","MediumBatteryLevel":"Medium Battery Level","MediumLowBatteryLevel":"Medium Low Battert Level","LowBatteryLevel":"Low Battert Level","CanExecuteAllTask":"CanExecuteAllTask","When AGV is not Charging,all task orders can be executed ":"When AGV is not Charging,all task orders can be executed ","AGVcharging onlyAGVdocharging tasks":"When the AGV is charging, only the AGV is allowed to perform charging tasks. All task orders can be executed after the battery is above the medium-high battery","AGVlowbattery onlyAGVdocharging":"When the AGV is low on battery, it will be unable to perform all task orders except charging tasks","In operation mode, the system will force the AGV to charge":" In operation mode, the system will force the AGV to charge"},"Confirm":"YES","Notifies":{"CanNotDoUnloadWhenAGVHasCargo":" Can\'t do Unload action when AGV has cargo"},"AvalibilityQuery":{"AGVName":"AGVName","StartDate":"StartDate","EndDate":"EndDate","Query":"Query","PieChart":"PieChart","StraightChart":"StraightChart","MTBF/MTTR":"MTBF/MTTR"},"AGVLocus":{"SelectAGV":"SelectAGV","StartTime":"StartTime","EndTime":"EndTime","Search":"Search","TaskID":"TaskID","CostTime":"CostTime(s)","ShowTrack":"ShowTrack","TrackColor":"TrackColor","TrackWidth":"TrackWidth","SaveTrackMap":"Save Track Map","SelectStartDate":"Select Start Date","SelectEndDate":"Select End Date","Success":"Success","Fail":"Fail","taskID":"Task Name","State":"Status","AGV":"Vehicle","FromStation":"Source","ToStation":"Destine"},"InstrumentMeasureQuery":{"StartTime":"StartTime","EndTime":"EndTime","AGV":"AGV","TaskID":"TaskID","MeasureResult":"MeasureResult","Search":"Search","TaskName":"TaskName","AGVName":"AGVName","BayName":"BayName","MeasurePoint":"MeasurePoint","MeasureStartTime":"MeasureStartTime","Lux":"Lux","dB":"dB","Temperature":"Temperature(℃)","Moisture":"Moisture(%)"},"InsMesTrendChart":{"MeasureItem":"MeasureItem","SelectStartDate":"SelectStartDate","SelectEndDate":"SelectEndDate","Search":"Search"},"TaskDispatchFailString":"Task_Dispatch_Fail","visitor":"visitor","ConfirmRedoTask":"Are you sure re-assign this order?","RedoTaskSuccess":"Re-assign Order Success!","RedoTaskFail":"Re-assign Order Fail...","secsGem":{"UnloadButCargoIDReadNotMatched":"CST ID Read Value Not Matched","UnloadButCargoIDReadFail":"CST ID Read Fail","EqUnloadButNoCargo":"Port Unload But Carrier Not Exist","AGVDownWhenLDULDWithCargo":"AGV Error During Load/Unload - Carrier On AGV","AGVDownWhenLDWithoutCargo":"AGV Error During Load - Carrier On Equipment","AGVDownWhenULDWithoutCargo":"AGV Error During Unload - Carrier On Equipment","AGVDownWhenMovingToDestine":"AGV Error While Moving To Destination","OtherErrors":"Other Errors","ZoneIsFull":"Zone Is Full","InterlockError":"Interlock Error","DestineEqLoadReqeustOff":"Destination Equipment Load Request Off","DestineEqHasCargo":"Destination Equipment Has Carrier","DestineEqMachechStateError":"Destination Equipment Mechanical State Error","DestineEqDown":"Destination Equipment Down","SourceEqUnloadReqeustOff":"Source Equipment Unload Request Off","SourceEqNotHasCargo":"Source Equipment No Carrier","SourceEqMachechStateError":"Source Equipment Mechanical State Error","SourceEqDown":"Source Equipment Down","DestineRackPortHasCargo":"Destination Rack Port Has Carrier","SourceRackPortNotHasCargo":"Source Rack Port No Carrier"},"MissionCard":{"CancelOrder":"Cancel","AbortOrder":"Abort"},"DeepCharge":"Deep Charge"}')},46687:function(e){"use strict";e.exports=JSON.parse('{"App":{"Header":{"agvs":"派車系統","operating_mode":"操作模式","op mode":"運轉","Maintenance mode":"維護","view_mode":"檢視模式","Simple mode":"簡易模式","ENG mode":"工程模式","chinese":"Chinese","english":"English","LOGIN":"登入","LOGOUT":"登出","Switch user":"切換使用者","systemalarm":"系統警報","alarmreset":"清除警報","eqalarm":"設備警報","Turnoffbuzzer":"關閉蜂鳴器"},"LaterRemindMe":"稍後再提醒我","AutoLogoutNotify":"已自動登出","PushOkToRefreshPage":"按下 \'OK\' 以重新整理頁面"},"Menu":{"Home":"主頁","System Alarm":"系統警報","wip_manager":"帳籍管理","vehicle manager":"車輛管理","system settings":"系統設置","map and display":"地圖與顯示","map edit":"地圖編輯","agv display":"AGV 視覺化","vehicle battery managnment":"電量管理","equipment management":"設備管理","racks management":"Rack管理","charge station management":"充電站管理","user management":"用戶管理","Querys":"資料查詢","Task History":"歷史任務","Alarm History":"歷史警報","Trajectory":"軌跡查詢","Instruments Measure Result":"儀器量測結果查詢","utilization rate":"稼動率","Traffic State":"交管狀態統計","secs_gem_settings":"SECS/GEM 設定"},"HomeView":{"AGVStatus":{"AGVStatus":{"vehicle-status":"車輛狀態","vms_disconnect":"VMS 斷線","vehicle-name":"車輛名稱","vehicle-statuslist":"AGV 狀態","task-status":"任務狀態","status":"狀態","carrierid":"載物ID","vehicleconn":"車載","position":"位置","power":"電量","From":"起點","To":"目的地","action":"動作","Time":"時間","Online":"已上線","Offline":"離線","Location":"定位","OnlineRequest":"請求上線","OfflineRequest":"請求離線"}},"TaskStatus":"任務狀態","Map":"地圖","EQ_Status":"設備狀態","EQStatus":{"EQStatus":{"ViewMode":"顯示模式","IO":"IO狀態","Connected":"已連線","DisConnect":"斷線","ON":"訊號[ON]","OFF":"訊號[OFF]","Handshake_EQ":"交握訊號-EQ","Handshake_AGV":"交握訊號-AGV","emulator":"模擬器:","changetoBusy":"切換為Busy","changetoLoad":"切換為Load","changetoUnload":"切換為Unload","Cancel_maintenance":"取消維修","Maintenance_Simulation":"維修模擬","Cancel_replacement_parts":"取消更換零件","Part_replacement_simulation":"零件更換模擬","EQ_Name":"設備名稱","Main_Status":"主狀態","TransferStatus":"移載請求","Exist":"帳籍狀態","Instock":"有貨","SoldOut":"無貨","CarrierID":"貨物ID","Load":"可移入","UnLoad":"可移出","IsMaintaining":"維修","IsPartsReplacing":"換紙捲"}}},"Action":"動作","Vehicle":"車輛","source":"來源","Remove":"重新選取","Choose_Sourse_from_Map":"選擇來源","Choose_Dest_from_Map":"選擇目的地","Choose_Port":"選擇port","Transport":"轉運","Transport_Port":"轉運站","Choose_Transport_Port_from_Map":"選擇轉換站","TaskDispathActionButton":{"Destine":"目的地","dispatch-confirm":"派送","Back To Select Action":"返回","clear-selected":"重新選取"},"Cancel":"取消","auto-choise-vehicle":"自動選車","Transfer":"搬運","Charge":"充電","Exchange Battery":"交換電池","Measure":"巡檢量測","Move":"移動","Park":"停車","Unload":"取貨","Load":"放貨","Dispatch":"任務派送","IncompleteTasks":"未完成任務","CompleteTasks":"已完成任務","Search":{"Search":"搜尋","Output_csv_file":"輸出csv檔","Start_Time":"起始時間","End_Time":"結束時間","Move":"移動","Load":"取貨","UnLoad":"放貨","Transfer":"搬運","Charge":"充電","Measure":"量測","ExchangeBattrey":"交換電池","Completed":"完成","Fail":"失敗","Cancel":"取消","Total_First":"共","Total_Last":"筆"},"TaskTable":{"NoTasks":"沒有任務","TaskName":"任務ID","AGV_Name":"AGV名稱","EQ_Name":"設備名稱","Time":"時間","Action":"動作","Final":"執行結果","TaskStatus":"狀態","ExcuteAgvName":"執行車輛","Source":"來源","Destine":"目的地","Source_Slot":"起點 Slot","Destine_Slot":"終點 Slot","Dispatcher":"派工人員","Fail_reason":"失敗原因","CstID":"貨物ID","FinishTime":"結束時間","RecievedTime":"接收時間","FailureReason":"異常描述","UnloadTime":"取料時間","LoadTime":"放料時間","StartLocation":"起始位置","AGVReadID":"AGV讀取ID","Reassign":"重新執行","AutoSelectVehicle":"自動選車","HighestPriorityTask":"最優先任務"},"AlarmTable":{"Time":"時間","Occur_Time":"發生時間","EQ_Name":"設備名稱","Alarm_code":"異常碼","Alarm_description":"警報描述","Alarm_Type":"異常類型","TaskName":"任務名稱","Occur_Tag":"發生地點","Duration":"持續時間(s)","Clear_OP":"清除警報人員","Solution":"排除方法","FailureReason":"異常描述"},"Rack":{"Creat_ID":"新增帳籍","Edit_ID":"修改帳籍","Remove_ID":"移除帳籍","copy":"複製到剪貼簿","Sensor_Flash":"在席Sensor閃爍","Cargo_Spaces":"水位"},"Map":{"Options":{"DisplayMode":"顯示模式","MapMode":"地圖模式","AgvVisible":"顯示 AGV","BackgroundImage":"地圖背景","PathVisible":"路網顯示","RegionVisible":"顯示區域","AgvBatVisible":"AGV電量"},"Notification":{"SelectSource":"選擇[來源]設備","SelectDestine":"選擇[終點]設備"},"MapLegend":{"Unloadble":"貨物可移出","Loadable":"可放貨","Maintaining":"維修中","UnLoadLoadable":"可移出/放貨"},"PartsReplacing":"紙捲更換中"},"hidden":"隱藏","Show":"顯示","PathNetwork":"路網","select-vehicle":"選擇車輛","AGVStatus":{"IDLE":"閒置中","CHARGING":"充電中","DOWN":"當機","RUN":"執行中"},"TaskAction":{"GoToSource":"前往來源設備","GoToDestineUnload":"前往終點設備取貨","GoToDestineload":"前往終點設備放貨","GoToChargeStation":"前往充電站","Unloading":"取貨中","Loading":"放貨中"},"TaskDispatchNewUI":{"ConfirmDispatchText":"確定要派送此任務?"},"AGVBatterySetting":{"HighBatteryLevel":"高電量區","MediumBatteryLevel":"中高電量區","MediumLowBatteryLevel":"中低電量區","LowBatteryLevel":"低電量區","CanExecuteAllTask":"可執行所有任務訂單","When AGV is not Charging,all task orders can be executed":"當AGV非充電時，可執行所有任務訂單。","AGVcharging onlyAGVdocharging tasks":"當AGV進行充電時，僅允許AGV執行充電任務， 等待電量位於中高電量以上方可執行所有任務訂單。","AGVlowbattery onlyAGVdocharging":"當AGV低電量時將無法進行除充電任務以外的所有任務訂單。","In operation mode, the system will force the AGV to charge":" 運轉模式下，系統會強制AGV進行充電。","VehicleName":"車輛名稱","LowBatterytoCharge":"低電量-強制充電(%)","MediumBattery":"中電量(%)","HighBattery":"高電量(%)"},"Confirm":"確定","Notifies":{"CanNotDoUnloadWhenAGVHasCargo":" AGV有料時，無法Unload"},"AvalibilityQuery":{"AGVName":"AGV名稱","StartDate":"起始日期","EndDate":"結束日期","Query":"查詢","PieChart":"圓餅圖","StraightChart":"直條圖","MTBF/MTTR":"MTBF/MTTR分析圖"},"AGVLocus":{"SelectAGV":"車輛選擇","StartTime":"起始時間","EndTime":"結束時間","Search":"查詢","TaskID":"任務ID","CostTime":"花費時間(s)","ShowTrack":"顯示軌跡","TrackColor":"軌跡顏色","TrackWidth":"軌跡寬度","SaveTrackMap":"儲存軌跡圖","SelectStartDate":"選擇開始日期","SelectEndDate":"選擇結束日期","Success":"成功","Fail":"失敗","taskID":"任務ID","State":"任務狀態","AGV":"車輛","FromStation":"來源","ToStation":"目的地"},"InstrumentMeasureQuery":{"StartTime":"開始時間","EndTime":"結束時間","AGV":"AGV","TaskID":"任務ID","MeasureResult":"量測結果","Search":"查詢","TaskName":"任務名稱","AGVName":"AGV名稱","BayName":"Bay名稱","MeasurePoint":"量測點位","MeasureStartTime":"開始量測時間","Lux":"照度(lux)","dB":"分貝(dB)","Temperature":"溫度(℃)","Moisture":"濕度(%)"},"InsMesTrendChart":{"MeasureItem":"量測項目","SelectStartDate":"選擇開始日期","SelectEndDate":"選擇結束日期","Search":"查詢"},"TaskDispatchFailString":"任務派送失敗","visitor":"訪客","ConfirmRedoTask":"確定要重新指派任務?","RedoTaskSuccess":"重新指派任務成功!","RedoTaskFail":"重新指派任務失敗...","secsGem":{"UnloadButCargoIDReadNotMatched":"貨物ID讀值與任務不相符","UnloadButCargoIDReadFail":"貨物ID讀取失敗","EqUnloadButNoCargo":"設備出貨請求但貨物不存在","AGVDownWhenLDULDWithCargo":"取放貨過程中發生異常-Carrier在車上","AGVDownWhenLDWithoutCargo":"放貨過程中發生異常-Carrier在設備上","AGVDownWhenULDWithoutCargo":"取貨過程中發生異常-Carrier在設備上","AGVDownWhenMovingToDestine":"移動至目的地的過程中AGV發生異常","OtherErrors":"其他錯誤","ZoneIsFull":"區域已滿","InterlockError":"互鎖錯誤","DestineEqLoadReqeustOff":"目的地設備放貨請求關閉","DestineEqHasCargo":"目的地設備已有貨物","DestineEqMachechStateError":"目的地設備機械狀態錯誤","DestineEqDown":"目的地設備異常","SourceEqUnloadReqeustOff":"來源設備取貨請求關閉","SourceEqNotHasCargo":"來源設備無貨物","SourceEqMachechStateError":"來源設備機械狀態錯誤","SourceEqDown":"來源設備異常","DestineRackPortHasCargo":"目的地 Rack Port 已有貨物","SourceRackPortNotHasCargo":"來源 Rack Port 無貨物"},"MissionCard":{"CancelOrder":"取消任務","AbortOrder":"中止任務"},"DeepCharge":"深充"}')}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=e,function(){var e=[];a.O=function(t,i,s,n){if(!i){var o=1/0;for(c=0;c<e.length;c++){i=e[c][0],s=e[c][1],n=e[c][2];for(var l=!0,r=0;r<i.length;r++)(!1&n||o>=n)&&Object.keys(a.O).every((function(e){return a.O[e](i[r])}))?i.splice(r--,1):(l=!1,n<o&&(o=n));if(l){e.splice(c--,1);var d=s();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,s,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,i){return a.f[i](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+e+"."+{63:"70d356ff",82:"b37fa411",155:"2262aced",373:"32742953",433:"882c7b10",493:"f843e609",536:"236ba6fc",554:"83e68fa5",705:"4656373b",726:"dadc43de",769:"56d98e1c",811:"98681df8",941:"62239dff",943:"071311fb",955:"565565d5"}[e]+".js"}}(),function(){a.miniCssF=function(e){return"css/"+e+"."+{63:"35c5b4d4",82:"4f034e44",155:"fb8bec7a",373:"96b8b0c3",433:"cbda504e",493:"2b326adf",536:"0c291879",554:"4538051f",811:"42703d8e",941:"157c25eb",943:"6d966e71"}[e]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="gpm_agvs:";a.l=function(i,s,n,o){if(e[i])e[i].push(s);else{var l,r;if(void 0!==n)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+n){l=u;break}}l||(r=!0,l=document.createElement("script"),l.charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+n),l.src=i),e[i]=[s];var m=function(t,a){l.onerror=l.onload=null,clearTimeout(h);var s=e[i];if(delete e[i],l.parentNode&&l.parentNode.removeChild(l),s&&s.forEach((function(e){return e(a)})),t)return t(a)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=m.bind(null,l.onerror),l.onload=m.bind(null,l.onload),r&&document.head.appendChild(l)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){a.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,i,s){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css";var o=function(a){if(n.onerror=n.onload=null,"load"===a.type)i();else{var o=a&&("load"===a.type?"missing":a.type),l=a&&a.target&&a.target.href||t,r=new Error("Loading CSS chunk "+e+" failed.\n("+l+")");r.code="CSS_CHUNK_LOAD_FAILED",r.type=o,r.request=l,n.parentNode&&n.parentNode.removeChild(n),s(r)}};return n.onerror=n.onload=o,n.href=t,a?a.parentNode.insertBefore(n,a.nextSibling):document.head.appendChild(n),n},t=function(e,t){for(var a=document.getElementsByTagName("link"),i=0;i<a.length;i++){var s=a[i],n=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(n===e||n===t))return s}var o=document.getElementsByTagName("style");for(i=0;i<o.length;i++){s=o[i],n=s.getAttribute("data-href");if(n===e||n===t)return s}},i=function(i){return new Promise((function(s,n){var o=a.miniCssF(i),l=a.p+o;if(t(o,l))return s();e(i,l,null,s,n)}))},s={143:0};a.f.miniCss=function(e,t){var a={63:1,82:1,155:1,373:1,433:1,493:1,536:1,554:1,811:1,941:1,943:1};s[e]?t.push(s[e]):0!==s[e]&&a[e]&&t.push(s[e]=i(e).then((function(){s[e]=0}),(function(t){throw delete s[e],t})))}}}(),function(){var e={143:0};a.f.j=function(t,i){var s=a.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise((function(a,i){s=e[t]=[a,i]}));i.push(s[2]=n);var o=a.p+a.u(t),l=new Error,r=function(i){if(a.o(e,t)&&(s=e[t],0!==s&&(e[t]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",l.name="ChunkLoadError",l.type=n,l.request=o,s[1](l)}};a.l(o,r,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,i){var s,n,o=i[0],l=i[1],r=i[2],d=0;if(o.some((function(t){return 0!==e[t]}))){for(s in l)a.o(l,s)&&(a.m[s]=l[s]);if(r)var c=r(a)}for(t&&t(i);d<o.length;d++)n=o[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},i=self["webpackChunkgpm_agvs"]=self["webpackChunkgpm_agvs"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=a.O(void 0,[998],(function(){return a(45520)}));i=a.O(i)})();
//# sourceMappingURL=app.e08a2509.js.map